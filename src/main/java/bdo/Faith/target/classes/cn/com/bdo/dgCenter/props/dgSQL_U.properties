#\u66F4\u65B0\u6807\u51C6\u7A0B\u5E8F\u4F7F\u7528\u6B21\u6570
#DG_U00001=UPDATE asdb.k_auditprogram kap LEFT JOIN (SELECT dgap.auditprogramId, COUNT(dgap.auditprogramId) useCount FROM bdo_dg.dg_auditprogram dgap WHERE dgap.level = 0 AND dgap.ACTIVE_FLAG = '1' GROUP BY dgap.auditprogramId) b ON kap.autoId = b.auditprogramId SET kap.useCount = IFNULL(b.useCount, 0) WHERE kap.subjectId IN ('{subjectIds}')
#\u590D\u5236\u524D\u7F6E\u9879\u76EE\uFF1A\u66F4\u65B0\u79D1\u76EE\u8BA4\u5B9A
DG_U00002=UPDATE bdo_dg.dg_tbsubjectcontract a inner join (SELECT autoId, customerId, projectId FROM bdo_dg.dg_tbsubjectcontract WHERE customerId = {targetCustomerId} AND projectId = {targetProjectId}) aa on aa.autoId = a.autoId and aa.customerId = a.customerId LEFT JOIN bdo_dg.dg_tbsubjectcontract b ON ( a.tbSubjectId = b.tbSubjectId OR a.tbSubjectCode = b.tbSubjectCode ) AND a.baseSubjectId = b.baseSubjectId AND a.userSubjectName= b.userSubjectName SET a.plancsE = b.plancsE, a.plancsC = b.plancsC, a.plancsA = b.plancsA, a.plancsV = b.plancsV, a.plancsP = b.plancsP, a.plansE = b.plansE, a.plansC = b.plansC, a.plansA = b.plansA, a.plansV = b.plansV, a.plansP = b.plansP WHERE b.customerId = {srcCustomerId} AND b.projectId = {srcProjectId} and b.yyyy={yyyy} 
#DG_U00002=UPDATE bdo_dg.dg_tbsubjectcontract a LEFT JOIN bdo_dg.dg_tbsubjectcontract b ON ( a.tbSubjectId = b.tbSubjectId OR a.tbSubjectCode = b.tbSubjectCode ) AND a.baseSubjectId = b.baseSubjectId AND a.userSubjectId = b.userSubjectId SET a.plancsE = b.plancsE, a.plancsC = b.plancsC, a.plancsA = b.plancsA, a.plancsV = b.plancsV, a.plancsP = b.plancsP, a.plansE = b.plansE, a.plansC = b.plansC, a.plansA = b.plansA, a.plansV = b.plansV, a.plansP = b.plansP WHERE a.customerId = {targetCustomerId} AND a.projectId = {targetProjectId} AND b.customerId = {srcCustomerId} AND b.projectId = {srcProjectId}
#\u590D\u5236\u524D\u7F6E\u9879\u76EE\uFF1A\u66F4\u65B0\u79D1\u76EE\u6811\u7236\u8282\u70B9\u6307\u5411--\u5BA2\u6237\u79D1\u76EE\u8282\u70B9
#DG_U00003=UPDATE bdo_dg.dg_subjecttree a LEFT JOIN bdo_dg.dg_subjecttree b ON a.parentId = b.autoId AND b.nodeType = 'TBSUBJECT' left join bdo_dg.dg_subjecttree c ON c.parentId = b.parentId AND c.nodeType = 'TBSUBJECT' SET a.parentId = c.autoId WHERE a.customerId = {customerId} AND a.projectId = {projectId} AND a.nodeType = 'SUBJECT' AND c.customerId = {customerId} AND c.projectId = {projectId} AND b.customerId = {srcCustomerId} AND b.projectId = {srcProjectId}
#\u590D\u5236\u524D\u7F6E\u9879\u76EE\uFF1A\u66F4\u65B0\u79D1\u76EE\u6811\u7236\u8282\u70B9\u6307\u5411--TB\u79D1\u76EE\u8282\u70B9
#DG_U00004=UPDATE bdo_dg.dg_subjecttree a LEFT JOIN bdo_dg.dg_subjecttree b ON b.nodeType = 'AUDITEVIDENCE' SET a.parentId = b.autoId WHERE a.customerId = {customerId} AND a.projectId = {projectId} AND a.nodeType = 'TBSUBJECT' AND b.customerId = {customerId} AND b.projectId = {projectId}
#\u590D\u5236\u524D\u7F6E\u9879\u76EE\uFF1A\u66F4\u65B0\u5BA1\u8BA1\u7A0B\u5E8F\u7236\u8282\u70B9
#DG_U00005=UPDATE bdo_dg.dg_auditprogram a LEFT JOIN bdo_dg.dg_auditprogram b ON b.parentId = a.parentId AND b.level = 0 SET a.parentId = b.autoId, b.parentId = b.autoId WHERE a.customerId = {customerId} AND a.projectId = {projectId} AND a.level = 1
#\u590D\u5236\u524D\u7F6E\u9879\u76EE\uFF1A\u66F4\u65B0\u5BA1\u8BA1\u7A0B\u5E8F\u5BF9\u5E94\u79D1\u76EE\u6811\u8282\u70B9
#DG_U00006=UPDATE bdo_dg.dg_auditprogram a LEFT JOIN bdo_dg.dg_subjecttree b ON b.subjectId = a.subjectId SET a.subjecttreeId = b.autoId WHERE a.customerId = {customerId} AND a.projectId = {projectId} AND b.customerId = {customerId} AND b.projectId = {projectId} AND b.nodeType = 'SUBJECT'
#\u8BBE\u7F6E\u9ED8\u8BA4\u5E95\u7A3F\u7F16\u5236\u4EBA
#DG_U00007=update bdo_dg.dg_auditprogram a inner join ( select a.autoId, a.customerId, tbsc.subjectEditors from bdo_dg.dg_auditprogram a LEFT JOIN bdo_dg.dg_project p ON p.projectId = a.projectId and p.customerId = a.customerId LEFT JOIN bdo_dg.dg_tbsubjectcontract tbsc ON tbsc.projectId = a.projectId AND tbsc.customerId = a.customerId AND tbsc.userSubjectId = a.subjectId AND tbsc.yyyy = p.year WHERE a.ACTIVE_FLAG = '1' AND a.customerId = {param1} AND a.projectId = {param2} and tbsc.subjectEditors is not null ) b on a.autoId = b.autoId and a.customerId = b.customerId set a.workpaperEditor = b.subjectEditors
#\u66F4\u65B0tb\u79D1\u76EE\u5BF9\u7167\u8868
DG_U00008=UPDATE bdo_dg.dg_tbsubjectcontract a INNER JOIN (SELECT autoId, customerId FROM bdo_dg.dg_tbsubjectcontract WHERE customerId = {customerId} AND projectId = {projectId} AND userSubjectId = '{userSubjectId}' ) b ON b.autoId = a.autoId AND b.customerId = a.customerId SET a.adjustValue = 0 
#\u66F4\u65B0tb\u79D1\u76EE\u5BF9\u7167\u8868--\u5BA1\u8BA1\u8C03\u6574\u6570
DG_U00009=UPDATE bdo_dg.dg_tbsubjectcontract a INNER JOIN (SELECT autoId, customerId FROM bdo_dg.dg_tbsubjectcontract WHERE customerId = {param1} AND projectId = {param2}) b ON b.autoId = a.autoId AND b.customerId = a.customerId SET a.adjustValue = 0 
#\u66F4\u65B0tb\u79D1\u76EE\u5BF9\u7167\u8868--\u5BA2\u6237\u8C03\u6574\u6570
DG_U00010=UPDATE bdo_dg.dg_tbsubjectcontract a INNER JOIN (SELECT autoId, customerId FROM bdo_dg.dg_tbsubjectcontract WHERE customerId = {param1} AND projectId = {param2}) b ON b.autoId = a.autoId AND b.customerId = a.customerId SET a.cusAdjustValue = 0 
#\u91CD\u7F6E\u672A\u5BA1\u62A5\u8868\u53D8\u52A8\u539F\u56E0
DG_U00011=UPDATE bdo_dg.dg_unauditreport a INNER JOIN (SELECT customerId, yyyy, projectId, colCode FROM bdo_dg.dg_unauditreport WHERE customerId = {param1} AND projectId = {param2}) b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.projectId = a.projectId AND b.colCode = a.colCode SET a.changeReason = null 
#\u91CD\u7F6E\u5BA1\u5B9A\u62A5\u8868\u53D8\u52A8\u539F\u56E0
DG_U00012=UPDATE bdo_dg.dg_unauditreport a INNER JOIN (SELECT customerId, yyyy, projectId, colCode FROM bdo_dg.dg_unauditreport WHERE customerId = {param1} AND projectId = {param2}) b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.projectId = a.projectId AND b.colCode = a.colCode SET a.finallyChangeReason = null 
#\u5C06\u67D0\u4E2A\u5BA2\u6237\u67D0\u4E2A\u6A21\u677F\u5185\u5927\u4E8E\u67D0\u4E2AsortNo\u503C\u7684\u6240\u6709tb\u79D1\u76EEsortNo\u51CF\u4E00\uFF08\u7528\u4E8E\u5220\u9664\u67D0\u4E2Atb\u79D1\u76EE\u65F6\u4FDD\u6301\u5176\u4ED6\u79D1\u76EEsortNo\u4FDD\u6301\u8FDE\u7EED\uFF09
DG_U00013 = UPDATE bdo_dg.dg_projecttb set sortNo = sortNo-1  WHERE customerId = '{param1}' AND projectId = '{param2}' AND sortNo > '{param3}'
#\u73B0\u91D1\u6D41\u91CF\u8868\uFF1A\u91CD\u7F6E\uFF1A\u66F4\u65B0\u5E95\u7A3F\u8868dg_workpaper\u65F6\u95F4
DG_U00014=UPDATE bdo_dg.dg_workpaper a SET a.last_update_date = NOW(), a.creation_date = NOW() WHERE a.autoId = {param1} AND a.customerId = {param2} AND a.projectId = {param3}
