#\u5224\u65AD\u5BA2\u6237\u6570\u636E\u662F\u5426\u5728\u5BFC\u5165\u4E2D
FA00018=SELECT 1 FROM bdo_fin.fin_customer where customerId = ? and status = 1
#\u67E5\u8BE2\u5F85\u5BFC\u5165\u8BB0\u5F55
FA00021=SELECT * FROM bdo_fin.fin_importlist WHERE importState = {param1} AND libFlag IN ({param3}) order by CREATION_DATE ASC limit {param2}
#\u83B7\u53D6E\u5BA1\u901A\u6821\u9A8C\u7ED3\u679C
FA10101=SELECT a.customerId, a.year, a.uploadUser, a.checkoutResult FROM bdo_fin.fin_tasklist a WHERE a.customerId = {param1} AND year = {param2}
#\u83B7\u53D6\u6570\u636E\u662F\u5426\u4FEE\u6539\u8FC7
FA10102=SELECT COUNT(0) AS DATAISEDIT FROM bdo_fin.fin_record WHERE customerId = {param1} AND yyyy = {param2}
#\u67E5\u8BE2\u4FEE\u6539\u8BB0\u5F55
FA10103=SELECT subjectId,CASE type WHEN 1 THEN '\u5916\u5E01\u671F\u521D\u4FEE\u6B63' WHEN 2 THEN '\u79D1\u76EE\u65B9\u5411\u4FEE\u6B63' END AS editType,content,CREATED_BY AS __ueditUser,DATE_FORMAT(CREATION_DATE,'%Y-%m-%d %H:%i:%S') AS editDate FROM bdo_fin.fin_record WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} ORDER BY CREATION_DATE DESC
#\u79D1\u76EE\u671F\u521D\u6570\u548C\u671F\u672B\u6570\u6821\u9A8C
FA10224=SELECT a. NAME,a.TITLE,a.NUM,IFNULL(a.AMOUNT,0) AS AMOUNT from (SELECT '\u79D1\u76EE\u671F\u521D\u6570\u548C\u671F\u672B\u6570\u6821\u9A8C' AS NAME,'\u672C\u5E74\u671F\u521D\u6570\u548C\u4E0A\u5E74\u671F\u672B\u6570\u76F8\u7B49' AS TITLE,COUNT(0) AS NUM,SUM(a.direction * a.remain) AS AMOUNT FROM bdo_fin.fin_account a left join(SELECT subjectid,(direction * balance) AS amount FROM bdo_fin.fin_account WHERE customerid ={param1} AND subyearmonth ={param3} AND subMonth = 12 GROUP BY subjectid) b ON a.subjectId = b.subjectId WHERE customerId = {param1} AND subYearMonth = {param2} AND a.subMonth = 1 AND(a.direction * a.remain) = IFNULL(b.amount,0) UNION ALL SELECT '\u79D1\u76EE\u671F\u521D\u6570\u548C\u671F\u672B\u6570\u6821\u9A8C' AS NAME,'\u672C\u5E74\u671F\u521D\u6570\u548C\u4E0A\u5E74\u671F\u672B\u6570\u4E0D\u76F8\u7B49' AS TITLE,COUNT(0) AS NUM,SUM(a.direction * a.remain) AS AMOUNT FROM bdo_fin.fin_account a left join(SELECT subjectid,(direction * balance) AS amount FROM bdo_fin.fin_account WHERE customerid ={param1} AND subyearmonth ={param3} AND subMonth = 12 GROUP BY subjectid) b ON a.subjectId = b.subjectId WHERE customerId = {param1} AND subYearMonth = {param2} AND a.subMonth = 1 AND(a.direction * a.remain) <> IFNULL(b.amount,0)) a 
#\u67E5\u635F\u76CA\u662F\u5426\u7ED3\u8F6C\u6821\u9A8C\u8BE6\u7EC6
FA10310=SELECT a.customerId,a.subYearMonth,a.subjectId,a.subjectFullName1 AS fullName,IF(a.direction=1,'\u501F','\u8D37') AS direction,sum(case when a.subMonth=1 then remain else 0 end) remain,sum(case when a.subMonth=12 then balance else 0 end) balance,sum(case when a.subMonth=12 then debitTotalOcc else 0 end) debitTotalOcc,sum(case when a.subMonth=12 then creditTotalOcc else 0 end) creditTotalOcc,ABS(SUM(tranDebitOcc-tranCreditOcc)) tranOcc,IFNULL(b.amount,0) as amount FROM bdo_fin.fin_account a left join(SELECT subjectid,(direction * balance) AS amount FROM bdo_fin.fin_account WHERE customerid ={param1} AND subyearmonth ={param5} AND subMonth = 12 GROUP BY subjectid) b ON a.subjectId = b.subjectId WHERE customerId = {param1} AND subyearmonth = {param2} {param4} GROUP BY a.subjectid 
#\u4F59\u989D\u8868 \u6570\u636E\u7C7B\u578B \u6811
FA20001=SELECT a.autoId AS id, a.name, a.name AS label, a.value, a.parentId, IF (a.parentId IS NULL, 'false', 'true') AS leaf FROM bdo_fin.fin_dataname a WHERE a.ACTIVE_FLAG = '1' /*START #param19# AND a.name LIKE '%{param19}%' #param19# END*/ /*START #param20# AND a.parentId IS NULL #param20# END*/ /*START #param21# AND a.parentId = '{param1}' #param21# END*/ ORDER BY a.value
#\u67E5\u8BE2\u5BFC\u5165\u65E5\u5FD7
FA30032=select fileName,uploadTime from bdo_fin.fin_fileupload where 1=1 /*START #param1#   AND   customerId='{param1}' #param1#  END*/  /*START #param2#   AND   DATE_FORMAT(uploadTime,'%Y-%m-%d')='{param2}' #param2#  END*/  ORDER BY uploadTime desc
#\u67E5\u8BE2\u591A\u79D1\u76EE\u5206\u6790
FA30064=SELECT assItemId,assItemCustomerName FROM bdo_fin.fin_assitemsame where customerId ={lockCustomerId} AND yyyy ={param2}
#\u67E5\u8BE2\u6838\u7B97\u540C\u5BA2\u6237\u5BF9\u7167\u8868
FA30065=select t1.autoId,t1.customerId,t1.yyyy,t1.assItemCustomerName,t1.assItemId,t1.assItemName,t1.assTotalName,t1.subjectId,t1.subjectName from bdo_fin.fin_assitemsame t1 where t1.customerId={lockCustomerId} and t1.yyyy={param2} /*START #param3# and t1.assItemCustomerName like '%{param3}%' #param3# END*/ 
#\u6839\u636E\u62BD\u51ED\u7ED3\u679C\u67E5\u8BE2\u51ED\u8BC1
FA30081=select autoId,accPackageId,customerId,yyyy,month,voucherId,oldVoucherId,typeId,vchDate,serail,summary,subjectId,dirction,occurValue,currRate,currValue,currency,subjectname1,subjectFullName1 from bdo_fin.fin_subjectentry where customerId = {lockCustomerId} and yyyy={param2} and voucherId in({param3}) 

CD100102=select * from ((select t.subjectId,t.standName as dataName,t.remain as remain,t.remain as remainF,t.balance as balance,t.balance as balanceF from bdo_fin.fin_account t where t.customerId={param1} and t.subjectId like '{param2}%' and t.subYearMonth={param3} and t.subMonth ={param4} and t.isLeaf1='1' and t.standName ='\u4EBA\u6C11\u5E01') union all(select t.subjectId,t.standName as dataName,t.remain as remain,t.remainF as remainF,t.balance as balance,t.balanceF as balanceF from bdo_fin.fin_accountall t where t.customerId={param1} and t.subjectId like '{param2}%' and t.subYearMonth={param3} and t.subMonth ={param4} and t.isLeaf1='1' order by t.standName)) temp 
CD100103=SELECT * from ((SELECT t.standName as dataName,sum(t.direction*t.debitOcc) as debitOcc,sum(t.direction*t.creditOcc) as creditOcc FROM bdo_fin.fin_account t WHERE t.customerId ={param1} AND t.subjectId LIKE '{param2}%' AND t.subYearMonth ={param3} AND t.subMonth BETWEEN {param4} and {param5} AND t.isLeaf1 = '1' AND t.standName = '\u4EBA\u6C11\u5E01') UNION ALL(SELECT t.standName as dataName,sum(t.direction*t.debitOccF) as debitOcc,sum(t.direction*t.creditOccF) as creditOcc FROM bdo_fin.fin_accountall t WHERE t.customerId ={param1} AND t.subjectId LIKE '{param2}%' AND t.subYearMonth ={param3} AND t.subMonth BETWEEN {param4} and {param5} AND t.isLeaf1 = '1' GROUP BY t.standName ORDER BY t.standName)) temp 
CD100104=SELECT t.`year` FROM bdo_dg.dg_project t WHERE t.customerId ={param1} and t.projectId = {param2} 
CD100105=SELECT t.subjectId,sum(case when t.dirction = 1 then 1 else 0 end) as debit,sum(case when t.dirction = -1 then 1 else 0 end) as credit FROM bdo_fin.fin_subjectentry t WHERE t.customerId ={param1} and t.subjectId = {param2} AND t.yyyy ={param3} AND t.month BETWEEN {param4} and {param5} 

#\u6570\u636E\u5BFC\u5165\u540C\u6B65\u5BA2\u6237
FN000001=SELECT group_concat(distinct libFlag) FROM bdo_fin.fin_importlist WHERE importState='2' AND ACTIVE_FLAG = '1' and IFNULL(errorCount,0) < 3
#\u67E5\u8BE2\u5DF2\u5B8C\u6210\u672A\u540C\u6B65\u7684\u5BFC\u5165\u4EFB\u52A1
FN000002=SELECT autoId,customerId,yyyy,uploadUser FROM bdo_fin.fin_importlist WHERE importState = '4' AND synCustomer <> '2'
#\u67E5\u8BE2\u5DF2\u5B8C\u6210\u672A\u5206\u6790\u7684\u5BFC\u5165\u4EFB\u52A1
FN000003=SELECT * FROM bdo_fin.fin_importlist WHERE importState = '4' AND isAnalysis = '0' /*START #analysisId# AND customerId NOT IN ({analysisId}) #analysisId# END*/ order by autoId
#\u5F53\u524D\u6B63\u5728\u5BF9\u5E94\u51ED\u8BC1\u5206\u6790\u7684\u6570\u636E
FN000004=SELECT GROUP_CONCAT(DISTINCT projectId) AS analysisId FROM bdo_fin.fin_customerstatus WHERE isVoucherAnalsis = '1'


####################\u5BA1\u8BA1\u5E73\u53F0 \u67E5\u8BE2#################### 
#\u5224\u65AD\u5BA2\u6237\u6570\u636E\u662F\u5426\u5728\u5BFC\u5165\u4E2D
FIN000002=SELECT status FROM bdo_fin.fin_customer WHERE projectId = ? AND systemId = ?
#\u5224\u65AD\u8D22\u52A1\u5E93\u662F\u5426\u5B58\u5728
FIN000004=SELECT COUNT(0) AS HASDB FROM information_schema.SCHEMATA where SCHEMA_NAME = '{lockDbName}'
#\u67E5\u8BE2\u79D1\u76EE\u6811
FIN000005=SELECT aa.id, aa.label AS `name`, aa.label, aa.value, IF(LENGTH(aa.parentId) = 1, '', aa.parentId) as parentId, aa.leaf FROM( SELECT a.subjectId AS `id`, CONCAT(a.subjectId, '-', a.subjectFullName) AS `label`, a.subjectId AS `value`, IF( LENGTH(a.parentSubjectId) = 0, SUBSTR(a.subjectId, 1, 1), a.parentSubjectId) AS parentId, IF(a.isLeaf1 = 0, 'false', 'true') AS leaf FROM {lockDbName}.fin_accpkgsubject a WHERE  a.customerId = {lockCustomerId} AND a.yyyy={lockYyyy} ) aa WHERE  1 = 1 /*START #param2# AND aa.parentId like '{param2}%' #param2# END*/ /*START #param19# AND aa.label LIKE '%{param19}%' #param19# END*/ ORDER BY aa.id, aa.value
#\u67E5\u8BE2\u4E00\u7EA7\u79D1\u76EE
FIN000006=SELECT aa.id, aa.label AS `name`, aa.label, aa.value, IF(LENGTH(aa.parentId) = 1, '', aa.parentId) as parentId, aa.leaf FROM( SELECT a.subjectId AS `id`, CONCAT(a.subjectId, '-', a.subjectFullName) AS `label`, a.subjectId AS `value`, IF( LENGTH(a.parentSubjectId) = 0, SUBSTR(a.subjectId, 1, 1), a.parentSubjectId) AS parentId, 'true' AS leaf FROM {lockDbName}.fin_accpkgsubject a WHERE  a.customerId = {lockCustomerId} AND a.yyyy={lockYyyy} AND a.level1 = 1 ) aa WHERE  1 = 1 /*START #param2# AND aa.parentId like '{param2}%' #param2# END*/ /*START #param19# AND aa.label LIKE '%{param19}%' #param19# END*/ ORDER BY aa.id, aa.value
#\u83B7\u53D6\u4E0A\u6B21\u5BFC\u5165\u7684\u4EBA
FIN000008=SELECT uploadUser FROM (SELECT uploadUser,customerId,yyyy,uploadTime FROM bdo_fin.fin_importlist WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND importState = '4' UNION SELECT uploadUser,customerId,year AS yyyy,LAST_UPDATE_DATE AS uploadTime FROM bdo_fin.fin_tasklist WHERE customerId = {lockCustomerId} AND year = {lockYyyy} ORDER BY uploadTime DESC LIMIT 1) a
#\u6309\u9879\u76EE\u83B7\u53D6db\u8FDE\u63A5\u4FE1\u606F
FIN000009=SELECT a.customerId,a.yyyy,a.officeId,a.departmentId,a.poolName,a.dbName,b.poolUrl,b.connDriver,b.connUrl,b.connUser,b.connPwd,b.poolConfig FROM bdo_fin.fin_control_new a INNER JOIN bdo_fin.fin_dbconfig b ON b.poolName=a.poolName WHERE a.projectId={lockProjectId} /*START #lockYyyy# AND a.yyyy={lockYyyy} #lockYyyy# END*/ AND a.systemId = '{systemId}' ORDER BY a.uploadTime DESC LIMIT 1
####################\u8D22\u52A1\u4E2D\u5FC3####################
########\u4F59\u989D\u8868########
#\u4F59\u989D\u8868 \u4E0D\u5206\u6708 \u672C\u4F4D\u5E01
FIN100001=SELECT a.customerId,a.yyyy,a.subjectId,a.subjectName,a.direction,a.currency,a.remain,a.remainF,a.debitOcc,a.debitOccF,a.creditOcc,a.creditOccF,a.balance,a.balanceF,a.fullName,a.level1,a.isLeaf1,a.hasAssItem FROM (SELECT aa.customerId,aa.yyyy,aa.subjectId,aa.subjectName,IF(aa.direction=1,'\u501F','\u8D37') AS direction,aa.currency,SUM(aa.remain) AS remain,SUM(aa.remainF) AS remainF,SUM(aa.debitOcc) AS debitOcc,SUM(aa.debitOccF) AS debitOccF,SUM(aa.creditOcc) AS creditOcc,SUM(aa.creditOccF) AS creditOccF,SUM(aa.balance) AS balance,SUM(aa.balanceF) AS balanceF,aa.fullName,aa.level1,aa.isLeaf1,aa.hasAssItem FROM (SELECT a.customerId,a.yyyy,a.subMonth,a.subjectId,a.subjectName,0 AS remain,CASE WHEN a.subMonth={param3} THEN a.remain ELSE 0 END AS remainF,0 AS debitOcc,CASE WHEN a.subMonth BETWEEN {param3} AND {param4} THEN a.debitOcc ELSE 0 END AS debitOccF,0 AS creditOcc,CASE WHEN a.subMonth BETWEEN {param3} AND {param4} THEN a.creditOcc ELSE 0 END AS creditOccF,0 AS balance,CASE WHEN a.subMonth={param4} THEN a.balance ELSE 0 END AS balanceF,a.direction,'' AS currency,a.subjectFullName AS fullName,a.level1,a.isLeaf1,a.hasAssItem FROM {lockDbName}.fin_account a WHERE 1=1 AND a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.subMonth>={param3} AND a.subMonth<={param4} /*START #param5# AND a.subjectId IN({param5}) #param5# END*/ /*START #param6# AND a.subjectId LIKE '{param6}%' #param6# END*/ /*START #param7# AND a.level1 {param7} #param7# END*/ /*START #param8# AND a.isLeaf1={param8} #param8# END*/) aa GROUP BY aa.customerId,aa.yyyy,aa.subjectId,aa.currency ORDER BY aa.customerId,aa.yyyy,aa.subjectId,aa.currency) a WHERE 1=1 /*START #param9# AND a.balanceF<>0 #param9# END*/ ORDER BY a.customerId,a.yyyy,a.subjectId,a.currency
#\u4F59\u989D\u8868 \u4E0D\u5206\u6708 \u5254\u9664\u7ED3\u8F6C \u672C\u4F4D\u5E01
FIN100002=SELECT a.customerId,a.yyyy,a.subjectId,a.subjectName,a.direction,a.currency,a.remain,a.remainF,a.debitOcc,a.debitOccF,a.creditOcc,a.creditOccF,a.balance,a.balanceF,a.fullName,a.level1,a.isLeaf1,a.hasAssItem FROM ((SELECT aa.customerId,aa.yyyy,aa.subjectId,aa.subjectName,IF(aa.direction=1,'\u501F','\u8D37') AS direction,aa.currency,SUM(aa.remain) AS remain,SUM(aa.remainF) AS remainF,SUM(aa.debitOcc) AS debitOcc,SUM(aa.debitOccF) AS debitOccF,SUM(aa.creditOcc) AS creditOcc,SUM(aa.creditOccF) AS creditOccF,SUM(aa.remain)+aa.direction*(SUM(aa.debitOcc)-SUM(aa.creditOcc)) AS balance,SUM(aa.remainF)+aa.direction*(SUM(aa.debitOccF)-SUM(aa.creditOccF)) AS balanceF,aa.fullName,aa.level1,aa.isLeaf1,aa.hasAssItem FROM (SELECT a.customerId,a.yyyy,a.subMonth,a.subjectId,a.subjectName AS subjectName,'' AS remain,CASE WHEN a.subMonth={param3} THEN a.remain ELSE 0 END AS remainF,'' AS debitOcc,CASE WHEN a.subMonth BETWEEN {param3} AND {param4} THEN a.debitOccNoTran ELSE 0 END AS debitOccF,'' AS creditOcc,CASE WHEN a.subMonth BETWEEN {param3} AND {param4} THEN a.creditOccNoTran ELSE 0 END AS creditOccF,'' AS balance,CASE WHEN a.subMonth={param4} THEN a.balance ELSE 0 END AS balanceF,a.direction,'' AS currency,a.subjectFullName AS fullName,a.level1,a.isLeaf1,a.hasAssItem FROM {lockDbName}.fin_account a WHERE 1=1 AND a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.subMonth>={param3} AND a.subMonth<={param4} /*START #param5# AND a.subjectId IN({param5}) #param5# END*/ /*START #param6# AND a.subjectId LIKE '{param6}%' #param6# END*/ /*START #param7# AND a.level1 {param7} #param7# END*/ /*START #param8# AND a.isLeaf1={param8} #param8# END*/) aa GROUP BY aa.customerId,aa.yyyy,aa.subjectId,aa.currency)) a WHERE 1=1 /*START #param9# AND a.balanceF<>0 #param9# END*/ ORDER BY a.customerId,a.yyyy,a.subjectId,a.currency
#\u4F59\u989D\u8868 \u5206\u6708 \u672C\u4F4D\u5E01
FIN100003=SELECT * FROM (SELECT a.customerId,a.yyyy,a.subjectId,a.subjectName,IF(a.direction=1,'\u501F','\u8D37') AS direction,'' AS currency,a.subjectFullName AS fullName,a.level1,a.isLeaf1,a.hasAssItem,'' AS monthValue,GROUP_CONCAT({param10} ORDER BY a.subMonth) AS monthValueF FROM {lockDbName}.fin_account a WHERE 1=1 AND a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.subMonth>={param3} AND a.subMonth<={param4} /*START #param5# AND a.subjectId IN({param5}) #param5# END*/ /*START #param6# AND a.subjectId LIKE '{param6}%' #param6# END*/ /*START #param7# AND a.level1 {param7} #param7# END*/ /*START #param8# AND a.isLeaf1={param8} #param8# END*/ GROUP BY a.customerId,a.yyyy,a.subjectId,a.currency) a ORDER BY a.customerId,a.yyyy,a.subjectId,a.currency
#\u4F59\u989D\u8868>\u79D1\u76EE\u5206\u7C7B\u8D26
FIN100004=SELECT a.subjectId,a.subjectFullName,a.direction,a.subMonth,a.debitOcc,a.creditOcc,a.balance,a.tranDebitOcc,a.tranCreditOcc FROM ((SELECT NULL AS subjectId,'>\u671F\u521D' AS subjectFullName,NULL AS direction,NULL AS subMonth,NULL AS debitOcc,NULL AS creditOcc,remain AS balance,NULL AS tranDebitOcc,NULL AS tranCreditOcc,1 AS sort FROM {lockDbName}.fin_account WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND subjectId='{param3}' AND subMonth=1) UNION (SELECT subjectId,subjectFullName,IF(direction=1,'\u501F','\u8D37') AS direction,LPAD(subMonth,2,0) AS subMonth,debitOcc,creditOcc,balance,tranDebitOcc,tranCreditOcc,2 AS sort FROM {lockDbName}.fin_account WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND subjectId='{param3}') UNION (SELECT '' AS subjectId,'>\u5408\u8BA1' AS subjectFullName,'' AS direction,'' AS subMonth,SUM(CASE WHEN subMonth=12 THEN debitTotalOcc ELSE 0 END) AS debitOcc,SUM(CASE WHEN subMonth=12 THEN creditTotalOcc ELSE 0 END) AS creditOcc,SUM(CASE WHEN subMonth=12 THEN balance ELSE 0 END) AS balance,SUM(tranDebitOcc) AS tranDebitOcc,SUM(tranCreditOcc) AS tranCreditOcc,3 AS sort FROM {lockDbName}.fin_account WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND subjectId='{param3}')) a ORDER BY a.sort,a.subMonth+0
#\u4F59\u989D\u8868>\u79D1\u76EE\u5206\u7C7B\u8D26>\u79D1\u76EE\u660E\u7EC6\u8D26 \u67E5\u8BE2\u521D\u671F\u4F59\u989D
FIN100005=SELECT customerId,yyyy,subjectId,NULL AS voucherId,NULL AS oldVoucherId,NULL AS vchDate,NULL AS typeId,NULL AS serail,'>\u671F\u521D\u4F59\u989D' AS summary,NULL AS direction,NULL AS debitOcc,NULL AS creditOcc,NULL AS oppositeAccountTop,NULL AS oppositeAccountLast,IFNULL(remain,0) AS remain,NULL AS tranDebitOcc,NULL AS tranCreditOcc FROM {lockDbName}.fin_account WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND subMonth = {startMonth} AND subjectId = '{subjectId}'
#\u4F59\u989D\u8868>\u79D1\u76EE\u5206\u7C7B\u8D26>\u79D1\u76EE\u660E\u7EC6\u8D26 \u67E5\u8BE2\u660E\u7EC6\u53D1\u751F\u989D\u7ED3\u8F6C\u989D
FIN100006=SELECT * from (SELECT customerId,yyyy,month,subjectId,subjectFullName,voucherId,oldVoucherId,vchDate,typeId,serail,summary,IF(direction=1,'\u501F','\u8D37') AS direction,currRate,currency,occurValue,CASE WHEN direction=1 THEN occurValue ELSE 0 END AS debitOcc,CASE WHEN direction=-1 THEN occurValue ELSE 0 END AS creditOcc,CASE WHEN direction=1 THEN currValue ELSE 0 END AS debitOccF,CASE WHEN direction=-1 THEN currValue ELSE 0 END AS creditOccF, {subjectType} AS dfkm,NULL AS remain,CASE WHEN direction=1 AND isTransferVoucher=1 THEN occurValue ELSE 0 END AS tranDebitOcc,CASE WHEN direction=-1 AND isTransferVoucher=1 THEN occurValue ELSE 0 END AS tranCreditOcc {viewnum} FROM {lockDbName}.fin_subjectentry WHERE customerId={lockCustomerId} AND yyyy>={lockYyyy} AND yyyy<={endYyyy} AND subjectId in ({subjectId}) /*START #subMonth# AND month={subMonth} #subMonth# END*/ /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ /*START #vchDateStart# AND vchDate >= '{vchDateStart}' #vchDateStart# END*/ /*START #vchDateEnd# AND vchDate <= '{vchDateEnd}' #vchDateEnd# END*/ /*START #voucharType# {voucharType} #voucharType# END*/ /*START #summary# {summary} #summary# END*/) a ORDER BY {sortCol}
#\u4F59\u989D\u8868>\u79D1\u76EE\u5206\u7C7B\u8D26>\u79D1\u76EE\u660E\u7EC6\u8D26>\u51ED\u8BC1\u8BE6\u7EC6
FIN100009=SELECT a.customerId,'0' AS type,a.subjectId,a.subjectFullName,a.vchDate,a.voucherId,a.serail,a.summary,a.oldVoucherId,IF(a.direction=1,a.occurValue,0) AS debitOcc,IF(a.direction=1,a.currValue,0) AS debitOccF,IF(a.direction=-1,a.occurValue,0) AS creditOcc,IF(a.direction=-1,a.currValue,0) AS creditOccF,a.currrate,a.currValue,a.currency,IF(a.isTransferVoucher=1,'\u662F','\u5426') AS isTransferVoucher FROM {lockDbName}.fin_subjectentry a WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.vchDate='{vchDate}' AND a.voucherId='{voucherId}' AND a.typeId='{typeId}' ORDER BY a.vchDate,a.voucherId,a.serail
#\u4F59\u989D\u8868>\u79D1\u76EE\u5206\u7C7B\u8D26>\u79D1\u76EE\u660E\u7EC6\u8D26>\u51ED\u8BC1\u8BE6\u7EC6 \u5236\u5355\u4EBA\u8BB0\u8D26\u4EBA\u5BA1\u6838\u4EBA
FIN100010=SELECT voucherFillUser,voucherAuditUser,voucherKeepUser,voucherDirector FROM {lockDbName}.fin_subjectvoucher WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND typeId='{param2}' AND voucherId='{param3}' AND vchDate='{param4}'
#\u4F59\u989D\u8868>\u79D1\u76EE\u5206\u7C7B\u8D26>\u79D1\u76EE\u660E\u7EC6\u8D26>\u51ED\u8BC1\u8BE6\u7EC6 \u8BBE\u7F6E\u7ED3\u8F6C fin_account 
FIN100011=SELECT a.autoId,a.customerId,a.subjectId,a.yyyy,a.subMonth,a.debitOcc,a.creditOcc FROM {lockDbName}.fin_account a WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.subMonth={month} AND a.subjectId IN(SELECT a1.subjectId FROM {lockDbName}.fin_accpkgsubject a1,{lockDbName}.fin_accpkgsubject a2 WHERE a1.customerId={lockCustomerId} AND a1.yyyy={lockYyyy} AND a1.customerId=a2.customerId AND a1.yyyy=a2.yyyy AND a2.subjectId='{subjectId}' AND a2.subjectFullId LIKE concat(a1.subjectFullId,'/%') union all SELECT a1.subjectId FROM {lockDbName}.fin_accpkgsubject a1 WHERE a1.customerId={lockCustomerId} AND a1.yyyy={lockYyyy} AND a1.subjectId='{subjectId}')
#\u4F59\u989D\u8868>\u79D1\u76EE\u5206\u7C7B\u8D26>\u79D1\u76EE\u660E\u7EC6\u8D26>\u51ED\u8BC1\u8BE6\u7EC6 \u67E5\u8BE2\u7ED3\u8F6C\u6216\u53D6\u6D88\u7ED3\u8F6C\u7684\u6570\u989D
FIN100012=SELECT SUM(IF(direction=1,IFNULL(occurValue,0),0) ) AS tranDebitOcc,SUM(IF(direction=-1,IFNULL(occurValue,0),0) ) AS tranCreditOcc,SUM(IF(direction=1,IFNULL(currValue,0),0) ) AS tranDebitOccF,SUM(IF(direction=-1,IFNULL(currValue,0),0) ) AS tranCreditOccF FROM {lockDbName}.fin_subjectentry WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} /*START #month# AND month={month} #month# END*/ AND subjectId IN(SELECT a1.subjectId FROM {lockDbName}.fin_accpkgsubject a1,{lockDbName}.fin_accpkgsubject a2 WHERE a1.customerId={lockCustomerId} AND a1.yyyy={lockYyyy} AND a1.customerId=a2.customerId AND a1.yyyy=a2.yyyy AND a2.subjectId='{subjectId}' AND a1.subjectFullId LIKE concat(a2.subjectFullId,'/%') union all SELECT a1.subjectId FROM {lockDbName}.fin_accpkgsubject a1 WHERE a1.customerId={lockCustomerId} AND a1.yyyy={lockYyyy} AND a1.subjectId='{subjectId}') AND isTransferVoucher=1 /*START #currency# AND currency='{currency}' #currency# END*/
#\u4F59\u989D\u8868>\u79D1\u76EE\u5206\u7C7B\u8D26>\u79D1\u76EE\u660E\u7EC6\u8D26>\u51ED\u8BC1\u8BE6\u7EC6 \u8BBE\u7F6E\u7ED3\u8F6C  fin_accountall
FIN100013=SELECT a.autoId,a.customerId,a.subjectId,a.yyyy,a.subMonth,a.currency,a.debitOcc,a.creditOcc,a.debitOccF,a.creditOccF FROM {lockDbName}.fin_accountall a WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.subMonth={month} AND a.subjectId IN(SELECT a1.subjectId FROM {lockDbName}.fin_accpkgsubject a1,{lockDbName}.fin_accpkgsubject a2 WHERE a1.customerId={lockCustomerId} AND a1.yyyy={lockYyyy} AND a1.customerId=a2.customerId AND a1.yyyy=a2.yyyy AND a2.subjectId='{subjectId}' AND a2.subjectFullId LIKE concat(a1.subjectFullId,'/%') union all SELECT a1.subjectId FROM {lockDbName}.fin_accpkgsubject a1 WHERE a1.customerId={lockCustomerId} AND a1.yyyy={lockYyyy} AND a1.subjectId='{subjectId}')
#\u4F59\u989D\u8868>\u79D1\u76EE\u5206\u7C7B\u8D26>\u79D1\u76EE\u660E\u7EC6\u8D26>\u51ED\u8BC1\u8BE6\u7EC6 \u67E5\u8BE2\u7ED3\u8F6C\u6216\u53D6\u6D88\u7ED3\u8F6C\u7684\u6570\u989D
FIN100014=SELECT SUM(IF(direction=1,IFNULL(occurValue,0),0) ) AS tranDebitOcc,SUM(IF(direction=-1,IFNULL(occurValue,0),0) ) AS tranCreditOcc,SUM(IF(direction=1,IFNULL(currValue,0),0) ) AS tranDebitOccF,SUM(IF(direction=-1,IFNULL(currValue,0),0) ) AS tranCreditOccF FROM {lockDbName}.fin_subjectentry WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} /*START #month# AND month={month} #month# END*/ AND subjectId IN(SELECT a1.subjectId FROM {lockDbName}.fin_accpkgsubject a1,{lockDbName}.fin_accpkgsubject a2 WHERE a1.customerId={lockCustomerId} AND a1.yyyy={lockYyyy} AND a1.customerId=a2.customerId AND a1.yyyy=a2.yyyy AND a2.subjectId='{subjectId}' AND a1.subjectFullId LIKE concat(a2.subjectFullId,'/%') union all SELECT a1.subjectId FROM {lockDbName}.fin_accpkgsubject a1 WHERE a1.customerId={lockCustomerId} AND a1.yyyy={lockYyyy} AND a1.subjectId='{subjectId}') AND isTransferVoucher=1 /*START #currency# AND currency='{currency}' #currency# END*/
#\u4F59\u989D\u8868 \u4E0D\u5206\u6708 \u542B\u5916\u5E01
FIN100016=SELECT a.customerId,a.yyyy,a.subjectId,a.subjectName,a.direction,a.currency,a.remain,a.remainF,a.debitOcc,a.debitOccF,a.creditOcc,a.creditOccF,a.balance,a.balanceF,a.fullName,a.level1,a.isLeaf1,a.hasAssItem FROM ((SELECT aa.customerId,aa.yyyy,aa.subjectId,aa.subjectName,IF(aa.direction=1,'\u501F','\u8D37') AS direction,aa.currency,SUM(aa.remain) AS remain,SUM(aa.remainF) AS remainF,SUM(aa.debitOcc) AS debitOcc,SUM(aa.debitOccF) AS debitOccF,SUM(aa.creditOcc) AS creditOcc,SUM(aa.creditOccF) AS creditOccF,SUM(aa.balance) AS balance,SUM(aa.balanceF) AS balanceF,aa.fullName,aa.level1,aa.isLeaf1,aa.hasAssItem FROM (SELECT a.customerId,a.yyyy,a.subMonth,a.subjectId,a.subjectName,0 AS remain,CASE WHEN a.subMonth={param3} THEN a.remain ELSE 0 END AS remainF,0 AS debitOcc,CASE WHEN a.subMonth BETWEEN {param3} AND {param4} THEN a.debitOcc ELSE 0 END AS debitOccF,0 AS creditOcc,CASE WHEN a.subMonth BETWEEN {param3} AND {param4} THEN a.creditOcc ELSE 0 END AS creditOccF,0 AS balance,CASE WHEN a.subMonth={param4} THEN a.balance ELSE 0 END AS balanceF,a.direction,'' AS currency,a.subjectFullName AS fullName,a.level1,a.isLeaf1,a.hasAssItem FROM {lockDbName}.fin_account a WHERE 1=1 AND a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.subMonth>={param3} AND a.subMonth<={param4} /*START #param5# AND a.subjectId IN({param5}) #param5# END*/ /*START #param6# AND a.subjectId LIKE '{param6}%' #param6# END*/ /*START #param7# AND a.level1 {param7} #param7# END*/ /*START #param8# AND a.isLeaf1={param8} #param8# END*/) aa GROUP BY aa.customerId,aa.yyyy,aa.subjectId,aa.currency ORDER BY aa.customerId,aa.yyyy,aa.subjectId,aa.currency) UNION (SELECT aa.customerId,aa.yyyy,aa.subjectId,aa.subjectName,IF(aa.direction=1,'\u501F','\u8D37') AS direction,aa.currency,SUM(aa.remain) AS remain,SUM(aa.remainF) AS remainF,SUM(aa.debitOcc) AS debitOcc,SUM(aa.debitOccF) AS debitOccF,SUM(aa.creditOcc) AS creditOcc,SUM(aa.creditOccF) AS creditOccF,SUM(aa.balance) AS balancee,SUM(aa.balanceF) AS balanceF,aa.fullName,aa.level1,aa.isLeaf1,aa.hasAssItem FROM (SELECT a.customerId,a.yyyy,a.subMonth,a.subjectId,a.subjectName,CASE WHEN a.subMonth={param3} THEN a.remain ELSE 0 END AS remain,CASE WHEN a.subMonth={param3} THEN a.remainF ELSE 0 END AS remainF,CASE WHEN a.subMonth BETWEEN {param3} AND {param4} THEN a.debitOcc ELSE 0 END AS debitOcc,CASE WHEN a.subMonth BETWEEN {param3} AND {param4} THEN a.debitOccF ELSE 0 END AS debitOccF,CASE WHEN a.subMonth BETWEEN {param3} AND {param4} THEN a.creditOcc ELSE 0 END AS creditOcc,CASE WHEN a.subMonth BETWEEN {param3} AND {param4} THEN a.creditOccF ELSE 0 END AS creditOccF,CASE WHEN a.subMonth={param4} THEN a.balance ELSE 0 END AS balance,CASE WHEN a.subMonth={param4} THEN a.balanceF ELSE 0 END AS balanceF,a.direction,IF(a.currency IS NULL OR a.currency='0' OR a.currency='','',CONCAT('\u5916\u5E01:',a.currency)) AS currency,a.subjectFullName AS fullName,a.level1,a.isLeaf1,a.hasAssItem FROM {lockDbName}.fin_accountall a WHERE 1=1 AND a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.subMonth>={param3} AND a.subMonth<={param4} /*START #param5# AND a.subjectId IN({param5}) #param5# END*/ /*START #param6# AND a.subjectId LIKE '{param6}%' #param6# END*/ /*START #param7# AND a.level1 {param7} #param7# END*/ /*START #param8# AND a.isLeaf1={param8} #param8# END*/) aa GROUP BY aa.customerId,aa.yyyy,aa.subjectId,aa.currency ORDER BY aa.customerId,aa.yyyy,aa.subjectId,aa.currency)) a WHERE 1=1 /*START #param9# AND a.balanceF<>0 #param9# END*/ ORDER BY a.customerId,a.yyyy,a.subjectId,a.currency
#\u4F59\u989D\u8868 \u4E0D\u5206\u6708 \u5254\u9664\u7ED3\u8F6C \u542B\u5916\u5E01
FIN100017=SELECT a.customerId,a.yyyy,a.subjectId,a.subjectName,a.direction,a.currency,a.remain,a.remainF,a.debitOcc,a.debitOccF,a.creditOcc,a.creditOccF,a.balance,a.balanceF,a.fullName,a.level1,a.isLeaf1,a.hasAssItem FROM ((SELECT aa.customerId,aa.yyyy,aa.subjectId,aa.subjectName,IF(aa.direction=1,'\u501F','\u8D37') AS direction,aa.currency,SUM(aa.remain) AS remain,SUM(aa.remainF) AS remainF,SUM(aa.debitOcc) AS debitOcc,SUM(aa.debitOccF) AS debitOccF,SUM(aa.creditOcc) AS creditOcc,SUM(aa.creditOccF) AS creditOccF,SUM(aa.remain)+aa.direction*(SUM(aa.debitOcc)-SUM(aa.creditOcc)) AS balance,SUM(aa.remainF)+aa.direction*(SUM(aa.debitOccF)-SUM(aa.creditOccF)) AS balanceF,aa.fullName,aa.level1,aa.isLeaf1,aa.hasAssItem FROM (SELECT a.customerId,a.yyyy,a.subMonth,a.subjectId,a.subjectName AS subjectName,0 AS remain,CASE WHEN a.subMonth={param3} THEN a.remain ELSE 0 END AS remainF,0 AS debitOcc,CASE WHEN a.subMonth BETWEEN {param3} AND {param4} THEN a.debitOccNoTran ELSE 0 END AS debitOccF,0 AS creditOcc,CASE WHEN a.subMonth BETWEEN {param3} AND {param4} THEN a.creditOccNoTran ELSE 0 END AS creditOccF,0 AS balance,CASE WHEN a.subMonth={param4} THEN a.balance ELSE 0 END AS balanceF,a.direction,'' AS currency,a.subjectFullName AS fullName,a.level1,a.isLeaf1,a.hasAssItem FROM {lockDbName}.fin_account a WHERE 1=1 AND a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.subMonth>={param3} AND a.subMonth<={param4} /*START #param5# AND a.subjectId IN({param5}) #param5# END*/ /*START #param6# AND a.subjectId LIKE '{param6}%' #param6# END*/ /*START #param7# AND a.level1 {param7} #param7# END*/ /*START #param8# AND a.isLeaf1={param8} #param8# END*/) aa GROUP BY aa.customerId,aa.yyyy,aa.subjectId,aa.currency) UNION (SELECT aa.customerId,aa.yyyy,aa.subjectId,aa.subjectName,IF(aa.direction=1,'\u501F','\u8D37') AS direction,aa.currency,SUM(aa.remain) AS remain,SUM(aa.remainF) AS remainF,SUM(aa.debitOcc) AS debitOcc,SUM(aa.debitOccF) AS debitOccF,SUM(aa.creditOcc) AS creditOcc,SUM(aa.creditOccF) AS creditOccF,SUM(aa.remain)+aa.direction*(SUM(aa.debitOcc)-SUM(aa.creditOcc)) AS balance,SUM(aa.remainF)+aa.direction*(SUM(aa.debitOccF)-SUM(aa.creditOccF)) AS balanceF,aa.fullName,aa.level1,aa.isLeaf1,aa.hasAssItem FROM (SELECT a.customerId,a.yyyy,a.subMonth,a.subjectId,a.subjectName AS subjectName,CASE WHEN a.subMonth={param3} THEN a.remain ELSE 0 END AS remain,CASE WHEN a.subMonth={param3} THEN a.remainF ELSE 0 END AS remainF,CASE WHEN a.subMonth BETWEEN {param3} AND {param4} THEN a.debitOccNoTran ELSE 0 END AS debitOcc,CASE WHEN a.subMonth BETWEEN {param3} AND {param4} THEN a.debitOccNoTranF ELSE 0 END AS debitOccF,CASE WHEN a.subMonth BETWEEN {param3} AND {param4} THEN a.creditOccNoTran ELSE 0 END AS creditOcc,CASE WHEN a.subMonth BETWEEN {param3} AND {param4} THEN a.creditOccNoTranF ELSE 0 END AS creditOccF,a.direction,IF(a.currency IS NULL OR a.currency='0' OR a.currency='','',CONCAT('\u5916\u5E01:',a.currency)) AS currency,a.subjectFullName AS fullName,a.level1,a.isLeaf1,a.hasAssItem FROM {lockDbName}.fin_accountall a WHERE 1=1 AND a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.subMonth>={param3} AND a.subMonth<={param4} /*START #param5# AND a.subjectId IN({param5}) #param5# END*/ /*START #param6# AND a.subjectId LIKE '{param6}%' #param6# END*/ /*START #param7# AND a.level1 {param7} #param7# END*/ /*START #param8# AND a.isLeaf1={param8} #param8# END*/) aa GROUP BY aa.customerId,aa.yyyy,aa.subjectId,aa.currency)) a WHERE 1=1 /*START #param9# AND a.balanceF<>0 #param9# END*/ ORDER BY a.customerId,a.yyyy,a.subjectId,a.currency
#\u4F59\u989D\u8868 \u5206\u6708 \u542B\u5916\u5E01
FIN100018=SELECT * FROM ((SELECT a.customerId,a.yyyy,a.subjectId,a.subjectName,IF(a.direction=1,'\u501F','\u8D37') AS direction,'' AS currency,a.subjectFullName AS fullName,a.level1,a.isLeaf1,a.hasAssItem,'' AS monthValue,GROUP_CONCAT({param10} ORDER BY a.subMonth) AS monthValueF FROM {lockDbName}.fin_account a WHERE 1=1 AND a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.subMonth>={param3} AND a.subMonth<={param4} /*START #param5# AND a.subjectId IN({param5}) #param5# END*/ /*START #param6# AND a.subjectId LIKE '{param6}%' #param6# END*/ /*START #param7# AND a.level1 {param7} #param7# END*/ /*START #param8# AND a.isLeaf1={param8} #param8# END*/ GROUP BY a.customerId,a.yyyy,a.subjectId,a.currency) UNION (SELECT a.customerId,a.yyyy,a.subjectId,a.subjectName,IF(a.direction=1,'\u501F','\u8D37') AS direction,IF(a.currency IS NULL OR a.currency='0' OR a.currency='','',CONCAT('\u5916\u5E01:',a.currency)) AS currency,a.subjectFullName AS fullName,a.level1,a.isLeaf1,a.hasAssItem,GROUP_CONCAT({param10} ORDER BY a.subMonth) AS monthValue,GROUP_CONCAT({param11} ORDER BY a.subMonth) AS monthValueF FROM {lockDbName}.fin_accountall a WHERE 1=1 AND a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.subMonth>={param3} AND a.subMonth<={param4} /*START #param5# AND a.subjectId IN({param5}) #param5# END*/ /*START #param6# AND a.subjectId LIKE '{param6}%' #param6# END*/ /*START #param7# AND a.level1 {param7} #param7# END*/ /*START #param8# AND a.isLeaf1={param8} #param8# END*/ GROUP BY a.customerId,a.yyyy,a.subjectId,a.currency)) a ORDER BY a.customerId,a.yyyy,a.subjectId,a.currency
#\u4F59\u989D\u8868>\u79D1\u76EE\u5206\u7C7B\u8D26>\u79D1\u76EE\u660E\u7EC6\u8D26>\u51ED\u8BC1\u8BE6\u7EC6 \u663E\u793A\u6838\u7B97
FIN100019=SELECT * FROM (SELECT a.customerId,'0' AS type,a.subjectId,a.subjectFullName,a.vchDate,a.voucherId,a.serail,a.serail AS sortNum,a.summary,a.oldVoucherId,IF(a.direction=1,a.occurValue,0) AS debitOcc,IF(a.direction=-1,a.occurValue,0) AS creditOcc,a.currrate,a.currValue,a.currency,IF(a.isTransferVoucher=1,'\u662F','\u5426') AS isTransferVoucher FROM {lockDbName}.fin_subjectentry a WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.vchDate='{vchDate}' AND a.voucherId='{voucherId}' AND a.typeId='{typeId}' UNION SELECT a.customerId,'1' AS type,a.assItemId AS subjectId,a.assTotalName AS subjectFullName,a.vchDate,a.voucherId,CONCAT(a.serail,'-\u6838\u7B97')  AS serail,a.serail AS sortNum,a.summary,a.oldVoucherId,IF(a.direction=1,a.occurValue,0) AS debitOcc,IF(a.direction=-1,a.occurValue,0) AS creditOcc,a.currrate,a.currValue,a.currency,'' AS isTransferVoucher FROM {lockDbName}.fin_assitementry a WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.vchDate='{vchDate}' AND a.voucherId='{voucherId}' AND a.typeId='{typeId}') a ORDER BY a.vchDate,a.voucherId,a.sortNum,a.type
#\u4F59\u989D\u8868>\u79D1\u76EE\u7ED3\u6784\u5206\u6790
FIN100020=SELECT * from (SELECT a.customerId,a.yyyy,a.subMonth,a.subjectId,a.subjectName,a.direction,a.subjectFullName,a.level1,a.isLeaf1,sum(case when a.subMonth={param2} then a.remain else 0 end) as remain,sum(case when a.subMonth BETWEEN {param2} AND {param3} then a.debitOcc else 0 end) as debitOcc,sum(case when a.subMonth BETWEEN {param2} AND {param3} then a.creditOcc else 0 end) as creditOcc,sum(case when a.subMonth={param3} then a.balance else 0 end) as balance FROM {lockDbName}.fin_account a inner join {lockDbName}.fin_accpkgsubject b on a.customerId = b.customerId and a.yyyy = b.yyyy and a.subjectId = b.subjectId and (b.parentSubjectId = '{param1}' or b.subjectId = '{param1}') where a.customerId = {lockCustomerId} and a.yyyy = {lockYyyy} group by a.subjectId) a order by a.level1 desc,a.subjectId
########\u4F59\u989D\u8868########
########\u591A\u5E74\u4F59\u989D\u8868########
#\u591A\u5E74\u4F59\u989D\u8868 \u4E00\u5E74 \u4E0D\u5206\u6708
FIN101001=SELECT a.customerId,a.yyyy,a.subjectId,a.subjectName,a.direction,a.currency,a.remain,a.debitOcc,a.creditOcc,a.balance,a.fullName,a.level1,a.isLeaf1 FROM (SELECT aa.customerId,aa.yyyy,aa.subjectId,aa.subjectName,IF(aa.direction=1,'\u501F','\u8D37') AS direction,aa.currency,SUM(aa.remain) AS remain,SUM(aa.debitOcc) AS debitOcc,SUM(aa.creditOcc) AS creditOcc,SUM(aa.balance) AS balance,aa.fullName,aa.level1,aa.isLeaf1 FROM (SELECT a.customerId,a.yyyy,a.subMonth,a.subjectId,a.subjectName AS subjectName,CASE WHEN a.subMonth={param2} THEN a.remain ELSE 0 END AS remain,CASE WHEN a.subMonth BETWEEN {param2} AND {param3} THEN a.debitOcc ELSE 0 END AS debitOcc,CASE WHEN a.subMonth BETWEEN {param2} AND {param3} THEN a.creditOcc ELSE 0 END AS creditOcc,CASE WHEN a.subMonth={param3} THEN a.balance ELSE 0 END AS balance,a.direction,'' AS currency,a.subjectFullName AS fullName,a.level1,a.isLeaf1 FROM {lockDbName}.fin_account a WHERE 1=1 AND a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.subMonth BETWEEN {param2} AND {param3} /*START #param4# AND a.subjectId IN({param4}) #param4# END*/ /*START #param5# AND a.subjectId LIKE '{param5}%' #param5# END*/ /*START #param6# AND a.isLeaf1={param6} #param6# END*/ /*START #param7# AND a.level1 {param7} #param7# END*/) aa GROUP BY aa.customerId,aa.yyyy,aa.subjectId,aa.currency) a ORDER BY a.customerId,a.yyyy,a.subjectId,a.currency
#\u591A\u5E74\u4F59\u989D\u8868 \u4E00\u5E74 \u5206\u6708
FIN101002=SELECT * FROM (SELECT aa.customerId,aa.yyyy,aa.subjectId,aa.subjectName,IF(aa.direction=1,'\u501F','\u8D37') AS direction,aa.currency,{param24} aa.fullName,aa.level1,aa.isLeaf1 FROM (SELECT a.customerId,a.yyyy,a.subMonth,a.subjectId,a.subjectName AS subjectName,{param25} a.direction,'' AS currency,a.subjectFullName AS fullName,a.level1,a.isLeaf1 FROM {lockDbName}.fin_account a WHERE 1=1 AND a.customerId={lockCustomerId} AND a.yyyy BETWEEN {lockYyyy} AND {param1} /*START #param4# AND a.subjectId IN({param4}) #param4# END*/ /*START #param5# AND a.subjectId LIKE '{param5}%' #param5# END*/ /*START #param6# AND a.isLeaf1={param6} #param6# END*/ /*START #param7# AND a.level1 {param7} #param7# END*/) aa GROUP BY aa.customerId,aa.yyyy,aa.subjectId,aa.currency) a ORDER BY a.customerId,a.yyyy,a.subjectId,a.currency
#\u591A\u5E74\u4F59\u989D\u8868 \u591A\u5E74 \u5206\u6708/\u4E0D\u5206\u6708
FIN101003=SELECT * FROM (SELECT aa.customerId,aa.subjectId,aa.subjectName,IF(aa.direction=1,'\u501F','\u8D37') AS direction,aa.currency,{param24} aa.fullName,aa.level1,aa.isLeaf1 FROM (SELECT a.customerId,a.subMonth,a.subjectId,a.subjectName AS subjectName,{param25} a.direction,'' AS currency,a.subjectFullName AS fullName,a.level1,a.isLeaf1 FROM {lockDbName}.fin_account a WHERE 1=1 AND a.customerId={lockCustomerId} AND a.yyyy>={lockYyyy} AND a.yyyy<={param1} /*START #param4# AND a.subjectId IN({param4}) #param4# END*/ /*START #param5# AND a.subjectId LIKE '{param5}%' #param5# END*/ /*START #param6# AND a.isLeaf1 {param6} #param6# END*/ /*START #param7# AND a.level1 {param7} #param7# END*/) aa GROUP BY aa.customerId,aa.subjectId) a ORDER BY a.customerId,a.subjectId
#\u591A\u5E74\u4F59\u989D\u8868 \u671F\u521D,\u501F\u65B9,\u8D37\u65B9,\u671F\u672B \u53D8\u5316
FIN101005=SELECT * {param23} FROM (SELECT aa.customerId,aa.subjectId,aa.subjectName,IF(aa.direction=1,'\u501F','\u8D37') AS direction,aa.currency,{param24} aa.fullName,aa.level1,aa.isLeaf1 FROM (SELECT a.customerId,a.subMonth,a.subjectId,a.subjectName AS subjectName,{param25} a.direction,'' AS currency,a.subjectFullName AS fullName,a.level1,a.isLeaf1 FROM {lockDbName}.fin_account a WHERE 1=1 AND a.customerId={lockCustomerId} AND a.yyyy>={lockYyyy} AND a.yyyy<={param1} /*START #param4# AND a.subjectId IN({param4}) #param4# END*/ /*START #param5# AND a.subjectId LIKE '{param5}%' #param5# END*/ /*START #param6# AND a.isLeaf1 {param6} #param6# END*/ /*START #param7# AND a.level1 {param7} #param7# END*/) aa GROUP BY aa.customerId,aa.subjectId) a ORDER BY a.customerId,a.subjectId
########\u591A\u5E74\u4F59\u989D\u8868########
########\u6838\u7B97\u4F59\u989D\u8868########
#\u6838\u7B97\u4F59\u989D\u8868 \u4E0D\u5206\u6708
FIN102001=SELECT a.customerId,a.yyyy,a.subjectId,a.subjectName,a.assItemId,a.assItemName,a.direction,a.currency,a.remain,a.remainF,a.debitOcc,a.debitOccF,a.creditOcc,a.creditOccF,a.balance,a.balanceF,a.subjectFullName,a.fullName,a.level1,a.isLeaf1 FROM (SELECT aa.customerId,aa.yyyy,aa.subjectId,aa.subjectName,aa.assItemId,aa.assItemName,IF(aa.direction=1,'\u501F','\u8D37') AS direction,aa.currency,SUM(aa.remain) AS remain,SUM(aa.remainF) AS remainF,SUM(aa.debitOcc) AS debitOcc,SUM(aa.debitOccF) AS debitOccF,SUM(aa.creditOcc) AS creditOcc,SUM(aa.creditOccF) AS creditOccF,SUM(aa.balance) AS balance,SUM(aa.balanceF) AS balanceF,aa.subjectFullName,aa.fullName,aa.level1,aa.isLeaf1 FROM (SELECT a.customerId,a.yyyy,a.subMonth,a.subjectId,a.subjectName,a.assItemId,a.assItemName,0 AS remain,CASE WHEN a.subMonth={param3} THEN a.remain ELSE 0 END AS remainF,0 AS debitOcc,CASE WHEN a.subMonth BETWEEN {param3} AND {param4} THEN a.debitOcc ELSE 0 END AS debitOccF,0 AS creditOcc,CASE WHEN a.subMonth BETWEEN {param3} AND {param4} THEN a.creditOcc ELSE 0 END AS creditOccF,0 AS balance,CASE WHEN a.subMonth={param4} THEN a.balance ELSE 0 END AS balanceF,a.direction,'' AS currency,a.subjectFullName,a.assTotalName AS fullName,a.level1,a.isLeaf1 FROM {lockDbName}.fin_assitementryacc a WHERE 1=1 AND a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.subMonth>={param3} AND a.subMonth<={param4} /*START #param5# AND a.subjectId IN({param5}) #param5# END*/ /*START #param6# AND a.subjectId LIKE '{param6}%' #param6# END*/ /*START #param7# AND a.assItemId LIKE '{param7}%' #param7# END*/) aa GROUP BY aa.customerId,aa.yyyy,aa.subjectId,aa.assItemId,aa.currency ORDER BY aa.customerId,aa.yyyy,aa.subjectId,aa.assItemId,aa.currency) a ORDER BY a.customerId,a.yyyy,a.subjectId,a.assItemId,a.currency
#\u6838\u7B97\u4F59\u989D\u8868 \u5206\u6708
FIN102002=SELECT * FROM (SELECT a.customerId,a.yyyy,a.subjectId,a.subjectName,a.assItemId,a.assItemName,IF(a.direction=1,'\u501F','\u8D37') AS direction,'' AS currency,a.subjectFullName,a.assTotalName AS fullName,a.level1,a.isLeaf1,'' AS monthValue,GROUP_CONCAT({param10} ORDER BY a.subMonth) AS monthValueF FROM {lockDbName}.fin_assitementryacc a WHERE 1=1 AND a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.subMonth>={param3} AND a.subMonth<={param4} /*START #param5# AND a.subjectId IN({param5}) #param5# END*/ /*START #param6# AND a.subjectId LIKE '{param6}%' #param6# END*/ /*START #param7# AND a.assItemId LIKE '{param7}%' #param7# END*/ GROUP BY a.customerId,a.yyyy,a.subjectId,a.assItemId,a.currency) a ORDER BY a.customerId,a.yyyy,a.subjectId,a.assItemId,a.currency
#\u6838\u7B97\u4F59\u989D\u8868 \u6838\u7B97\u5206\u7C7B\u8D26
FIN102003=SELECT a.subjectId,a.subjectFullName,a.assItemId,a.assTotalName,a.direction,a.subMonth,a.debitOcc,a.creditOcc,a.balance,a.tranDebitOcc,a.tranCreditOcc FROM ((SELECT NULL AS subjectId,NULL AS subjectFullName,NULL AS assItemId,'>\u671F\u521D' AS assTotalName,NULL AS direction,NULL AS subMonth,NULL AS debitOcc,NULL AS creditOcc,remain AS balance,NULL AS tranDebitOcc,NULL AS tranCreditOcc,1 AS sort FROM {lockDbName}.fin_assitementryacc WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND subjectId='{param3}' AND assItemId='{param4}' AND subMonth=1) UNION (SELECT subjectId,subjectFullName,assItemId,assTotalName,IF(direction=1,'\u501F','\u8D37') AS direction,LPAD(subMonth,2,0) AS subMonth,debitOcc,creditOcc,balance,tranDebitOcc,tranCreditOcc,2 AS sort FROM {lockDbName}.fin_assitementryacc WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND subjectId='{param3}' AND assItemId='{param4}') UNION (SELECT '' AS subjectId,'' AS subjectFullName,'' AS assItemId,'>\u5408\u8BA1' AS assTotalName,'' AS direction,'' AS subMonth,SUM(CASE WHEN subMonth=12 THEN debitTotalOcc ELSE 0 END) AS debitOcc,SUM(CASE WHEN subMonth=12 THEN creditTotalOcc ELSE 0 END) AS creditOcc,SUM(CASE WHEN subMonth=12 THEN balance ELSE 0 END) AS balance,SUM(tranDebitOcc) AS tranDebitOcc,SUM(tranCreditOcc) AS tranCreditOcc,3 AS sort FROM {lockDbName}.fin_assitementryacc WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND subjectId='{param3}' AND assItemId='{param4}')) a ORDER BY a.sort,a.subMonth+0
#\u6838\u7B97\u4F59\u989D\u8868 \u6838\u7B97\u660E\u7EC6\u8D26
FIN102004=SELECT a.customerId,a.yyyy,a.subjectId,a.subjectName,a.assItemId,a.assTotalName,a.voucherId,a.oldVoucherId,a.vchDate,a.typeId,a.serail,a.summary,IF(a.direction=1,'\u501F','\u8D37') AS direction,CASE WHEN a.direction=1 THEN a.occurValue ELSE 0 END AS debitOcc,CASE WHEN a.direction=-1 THEN a.occurValue ELSE 0 END AS creditOcc,b.oppositeAccountTop,b.oppositeAccountLast,b.oppositeSubjectValue,b.oppositeTopSubjectValue,NULL AS remain FROM {lockDbName}.fin_assitementry a LEFT JOIN {lockDbName}.fin_subjectentry b ON b.autoId = a.subjectEntryId INNER JOIN {lockDbName}.fin_assitem c ON c.customerId = a.customerId AND c.yyyy = a.yyyy AND c.subjectId = a.subjectId AND c.assItemId = a.assItemId AND (c.assItemFullId LIKE '%|{assItemId}|%' OR c.assItemFullId LIKE '{assItemId}|%' OR c.assItemFullId LIKE '%|{assItemId}' OR c.assItemFullId = '{assItemId}') WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.subjectId = '{subjectId}' AND b.month={subMonth} ORDER BY a.vchDate,a.voucherId,a.serail
#\u6838\u7B97\u9879\u76EE\u6811
FIN102005=SELECT DISTINCT a.assItemId AS id, a.assItemId AS value, a.assItemName AS text, IF(b.num IS NULL,CONCAT(a.assItemId, ' : ', a.assTotalName),CONCAT(a.assItemId, ' : ', a.assTotalName, ' (', b.num, ')')) AS label, IF(a.isLeaf1 = 0, 'false', 'true') AS leaf, a.parentAssItemId AS parentid FROM {lockDbName}.fin_assitem a left join (select parentAssItemId,count(distinct assItemId) as num from {lockDbName}.fin_assitem WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #param11# AND subjectFullId REGEXP '{param11}' #param11# END*/ /*START #param19# AND assItemName LIKE '%{param19}%' #param19# END*/ group by parentAssItemId) b on a.assItemId = b.parentAssItemId WHERE a.isLeaf1 = 0 AND a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} /*START #param11# AND a.subjectFullId REGEXP '{param11}' #param11# END*/ /*START #param19# AND a.assItemName LIKE '%{param19}%' #param19# END*/ ORDER BY a.customerId, a.yyyy, a.assItemId 
FIN102006=SELECT DISTINCT a.assItemId AS id, IF(b.num IS NULL,CONCAT(a.assItemId, ' : ', a.assTotalName),CONCAT(a.assItemId, ' : ', a.assTotalName, ' (', b.num, ')')) AS label, a.assTotalName AS text, a.assItemName AS qtip, IF(a.isLeaf1 = 0, 'false', 'true') AS leaf, a.parentAssItemId AS parentid FROM {lockDbName}.fin_assitem a left join (select parentAssItemId,count(distinct assItemId) as num from {lockDbName}.fin_assitem WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #param11# AND subjectFullId REGEXP '{param11}' #param11# END*/ /*START #param19# AND assItemName LIKE '%{param19}%' #param19# END*/ group by parentAssItemId) b on a.assItemId = b.parentAssItemId WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} /*START #param1# AND a.parentAssItemId = '{param1}' and a.assItemId <> a.parentAssItemId #param1# END*/ /*START #param11# AND subjectFullId REGEXP '{param11}' #param11# END*/ /*START #param19# AND a.assItemName LIKE '%{param19}%' #param19# END*/ ORDER BY a.customerId, a.yyyy, a.assItemId limit 20 
FIN102007=select c.id,c.value,c.text,if(d.num is null,c.label,CONCAT(c.label,' (',d.num,')')) as label,c.leaf,c.parentid from (SELECT b.*,IF(@tmp=parentid,@rank:=@rank + 1,@rank:=1) as new_rank,@tmp:=parentid as tmp from (SELECT DISTINCT a.assItemId AS id, a.assItemId AS value, a.assItemName AS text, CONCAT(a.assItemId, ' : ', a.assTotalName) AS  label, IF(a.isLeaf1 = 0, 'false', 'true') AS leaf, a.parentAssItemId AS parentid,@tmp:=null, @rank:=0 FROM {lockDbName}.fin_assitem a WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} /*START #param11# AND a.subjectId LIKE '{param11}%' #param11# END*/ /*START #param19# AND a.assItemName LIKE '%{param19}%' #param19# END*/ ORDER BY a.customerId, a.yyyy, a.parentAssItemId) b ) c left join (select parentid,count(parentid) num from (SELECT DISTINCT a.assItemId AS id, a.parentAssItemId AS parentid FROM {lockDbName}.fin_assitem a WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} /*START #param11# AND a.subjectId LIKE '{param11}%' #param11# END*/ /*START #param19# AND a.assItemName LIKE '%{param19}%' #param19# END*/ ORDER BY a.customerId, a.yyyy, a.parentAssItemId) b group by parentid) d on c.id = d.parentid where new_rank <= 20 ORDER BY id
#\u6838\u7B97\u4F59\u989D\u8868 \u4E0D\u5206\u6708 \u542B\u5916\u5E01
FIN102008=SELECT a.customerId,a.yyyy,a.subjectId,a.subjectName,a.assItemId,a.assItemName,a.direction,a.currency,a.remain,a.remainF,a.debitOcc,a.debitOccF,a.creditOcc,a.creditOccF,a.balance,a.balanceF,a.subjectFullName,a.fullName,a.level1,a.isLeaf1 FROM ((SELECT aa.customerId,aa.yyyy,aa.subjectId,aa.subjectName,aa.assItemId,aa.assItemName,IF(aa.direction=1,'\u501F','\u8D37') AS direction,aa.currency,SUM(aa.remain) AS remain,SUM(aa.remainF) AS remainF,SUM(aa.debitOcc) AS debitOcc,SUM(aa.debitOccF) AS debitOccF,SUM(aa.creditOcc) AS creditOcc,SUM(aa.creditOccF) AS creditOccF,SUM(aa.balance) AS balance,SUM(aa.balanceF) AS balanceF,aa.subjectFullName,aa.fullName,aa.level1,aa.isLeaf1 FROM (SELECT a.customerId,a.yyyy,a.subMonth,a.subjectId,a.subjectName,a.assItemId,a.assItemName,0 AS remain,CASE WHEN a.subMonth={param3} THEN a.remain ELSE 0 END AS remainF,0 AS debitOcc,CASE WHEN a.subMonth BETWEEN {param3} AND {param4} THEN a.debitOcc ELSE 0 END AS debitOccF,0 AS creditOcc,CASE WHEN a.subMonth BETWEEN {param3} AND {param4} THEN a.creditOcc ELSE 0 END AS creditOccF,0 AS balance,CASE WHEN a.subMonth={param4} THEN a.balance ELSE 0 END AS balanceF,a.direction,'' AS currency,a.subjectFullName,a.assTotalName AS fullName,a.level1,a.isLeaf1 FROM {lockDbName}.fin_assitementryacc a WHERE 1=1 AND a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.subMonth>={param3} AND a.subMonth<={param4} /*START #param5# AND a.subjectId IN({param5}) #param5# END*/ /*START #param6# AND a.subjectId LIKE '{param6}%' #param6# END*/ /*START #param7# AND a.assItemId LIKE '{param7}%' #param7# END*/) aa GROUP BY aa.customerId,aa.yyyy,aa.subjectId,aa.assItemId,aa.currency ORDER BY aa.customerId,aa.yyyy,aa.subjectId,aa.assItemId,aa.currency) UNION (SELECT aa.customerId,aa.yyyy,aa.subjectId,aa.subjectName,aa.assItemId,aa.assItemName,IF(aa.direction=1,'\u501F','\u8D37') AS direction,aa.currency,SUM(aa.remain) AS remain,SUM(aa.remainF) AS remainF,SUM(aa.debitOcc) AS debitOcc,SUM(aa.debitOccF) AS debitOccF,SUM(aa.creditOcc) AS creditOcc,SUM(aa.creditOccF) AS creditOccF,SUM(aa.balance) AS balancee,SUM(aa.balanceF) AS balanceF,aa.subjectFullName,aa.fullName,aa.level1,aa.isLeaf1 FROM (SELECT a.customerId,a.yyyy,a.subMonth,a.subjectId,a.subjectName,a.assItemId,a.assItemName,CASE WHEN a.subMonth={param3} THEN a.remain ELSE 0 END AS remain,CASE WHEN a.subMonth={param3} THEN a.remainF ELSE 0 END AS remainF,CASE WHEN a.subMonth BETWEEN {param3} AND {param4} THEN a.debitOcc ELSE 0 END AS debitOcc,CASE WHEN a.subMonth BETWEEN {param3} AND {param4} THEN a.debitOccF ELSE 0 END AS debitOccF,CASE WHEN a.subMonth BETWEEN {param3} AND {param4} THEN a.creditOcc ELSE 0 END AS creditOcc,CASE WHEN a.subMonth BETWEEN {param3} AND {param4} THEN a.creditOccF ELSE 0 END AS creditOccF,CASE WHEN a.subMonth={param4} THEN a.balance ELSE 0 END AS balance,CASE WHEN a.subMonth={param4} THEN a.balanceF ELSE 0 END AS balanceF,a.direction,IF(a.currency IS NULL OR a.currency='0' OR a.currency='','',CONCAT('\u5916\u5E01:',a.currency)) AS currency,a.subjectFullName,a.assTotalName AS fullName,a.level1,a.isLeaf1 FROM {lockDbName}.fin_assitementryaccall a WHERE 1=1 AND a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.subMonth>={param3} AND a.subMonth<={param4} /*START #param5# AND a.subjectId IN({param5}) #param5# END*/ /*START #param6# AND a.subjectId LIKE '{param6}%' #param6# END*/ /*START #param7# AND a.assItemId LIKE'{param7}%' #param7# END*/) aa GROUP BY aa.customerId,aa.yyyy,aa.subjectId,aa.assItemId,aa.currency ORDER BY aa.customerId,aa.yyyy,aa.subjectId,aa.assItemId,aa.currency)) a ORDER BY a.customerId,a.yyyy,a.subjectId,a.assItemId,a.currency
#\u6838\u7B97\u4F59\u989D\u8868 \u5206\u6708 \u542B\u5916\u5E01
FIN102009=SELECT * FROM ((SELECT a.customerId,a.yyyy,a.subjectId,a.subjectName,a.assItemId,a.assItemName,IF(a.direction=1,'\u501F','\u8D37') AS direction,'' AS currency,a.subjectFullName,a.assTotalName AS fullName,a.level1,a.isLeaf1,'' AS monthValue,GROUP_CONCAT({param10} ORDER BY a.subMonth) AS monthValueF FROM {lockDbName}.fin_assitementryacc a WHERE 1=1 AND a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.subMonth>={param3} AND a.subMonth<={param4} /*START #param5# AND a.subjectId IN({param5}) #param5# END*/ /*START #param6# AND a.subjectId LIKE '{param6}%' #param6# END*/ /*START #param7# AND a.assItemId LIKE '{param7}%' #param7# END*/ GROUP BY a.customerId,a.yyyy,a.subjectId,a.assItemId,a.currency) UNION (SELECT a.customerId,a.yyyy,a.subjectId,a.subjectName,a.assItemId,a.assItemName,IF(a.direction=1,'\u501F','\u8D37') AS direction,IF(a.currency IS NULL OR a.currency='0' OR a.currency='','',CONCAT('\u5916\u5E01:',a.currency)) AS currency,a.subjectFullName,a.assTotalName AS fullName,a.level1,a.isLeaf1,GROUP_CONCAT({param10} ORDER BY a.subMonth) AS monthValue,GROUP_CONCAT({param11} ORDER BY a.subMonth) AS monthValueF FROM {lockDbName}.fin_assitementryaccall a WHERE 1=1 AND a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.subMonth>={param3} AND a.subMonth<={param4} /*START #param5# AND a.subjectId IN({param5}) #param5# END*/ /*START #param6# AND a.subjectId LIKE '{param6}%' #param6# END*/ /*START #param7# AND a.assItemId LIKE '{param7}%' #param7# END*/ GROUP BY a.customerId,a.yyyy,a.subjectId,a.assItemId,a.currency)) a ORDER BY a.customerId,a.yyyy,a.subjectId,a.assItemId,a.currency
#\u6838\u7B97\u4F59\u989D\u8868>\u6838\u7B97\u5206\u7C7B\u8D26>\u6838\u7B97\u660E\u7EC6\u8D26 \u67E5\u8BE2\u521D\u671F\u4F59\u989D
FIN102010=SELECT '>\u671F\u521D\u4F59\u989D' AS summary,SUM(IFNULL(remain,0)) AS remain FROM {lockDbName}.fin_assitementryacc WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND subMonth = {startMonth} AND subjectId = '{subjectId}' /*START #assItemId# AND assItemId = '{assItemId}' #assItemId# END*/
#\u6838\u7B97\u4F59\u989D\u8868 \u6838\u7B97\u660E\u7EC6\u8D26(\u591A\u6708)
FIN102011=SELECT * from (SELECT a.customerId,a.yyyy,month(a.vchDate) as month,a.subjectId,a.subjectName,CONCAT(a.subjectId,'-',a.subjectFullName) AS subjectShow,a.assItemId,a.assTotalName,a.voucherId,a.oldVoucherId,a.vchDate,a.typeId,a.serail,a.summary,IF(a.direction=1,'\u501F','\u8D37') AS direction,CASE WHEN a.direction=1 THEN a.occurValue ELSE 0 END AS debitOcc,CASE WHEN a.direction=-1 THEN a.occurValue ELSE 0 END AS creditOcc,CASE WHEN a.direction=1 THEN a.currValue ELSE 0 END AS debitOccF,CASE WHEN a.direction=-1 THEN a.currValue ELSE 0 END AS creditOccF,{subjectType} AS dfkm,NULL AS remain,c.direction as subjectDirection {viewnum} FROM {lockDbName}.fin_assitementry a inner join {lockDbName}.fin_accpkgsubject c on a.customerId = c.customerId and a.yyyy = c.yyyy and a.subjectId = c.subjectId LEFT JOIN {lockDbName}.fin_subjectentry b ON b.autoId = a.subjectEntryId WHERE a.customerId={lockCustomerId} AND a.yyyy>={lockYyyy} AND a.yyyy<={endYyyy} /*START #subjectId# AND a.subjectId in ({subjectId}) #subjectId# END*/ AND a.assItemId LIKE '{assItemId}%' /*START #startMonth# AND month(a.vchDate) BETWEEN {startMonth} AND {endMonth} #startMonth# END*/ /*START #vchDateStart# AND a.vchDate >= '{vchDateStart}' #vchDateStart# END*/ /*START #vchDateEnd# AND a.vchDate <= '{vchDateEnd}' #vchDateEnd# END*/ /*START #summary# {summary} #summary# END*/) a ORDER BY {sortCol}
########\u6838\u7B97\u4F59\u989D\u8868########
########\u660E\u7EC6\u8868########
#\u660E\u7EC6\u8D26\u753B\u9762
FIN103001=SELECT autoId, customerId,yyyy,voucherId,oldVoucherId,typeId,vchDate,serail,summary,subjectId,direction,occurValue,currRate,currValue,currency,quantity,unitPrice,unitName,subjectName,subjectFullName,debitsubjects,creditsubjects,voucherFillUser,voucherAuditUser,voucherKeepUser,voucherAffixCount,voucherDebitOcc,voucherCreditOcc,voucherDirector,oppositeAccountTop,oppositeAccountLast,ACTIVE_FLAG,CASE direction WHEN 1 THEN OccurValue ELSE 0.00 END AS debit,CASE direction WHEN 1 THEN currValue ELSE 0.00 END AS debitCurr,CASE direction WHEN -1 THEN OccurValue ELSE 0.00 END AS credit,CASE direction WHEN -1 THEN currValue ELSE 0.00 END AS creditCurr,'' AS debitRemain FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy BETWEEN {lockYyyy} AND {param4} AND subjectId LIKE '{param2}%' AND SUBSTRING(vchDate,1,7) BETWEEN '{param3}' AND '{param5}' /*START #param6# AND voucherFillUser='{param6}' #param6# END*/ /*START #param7# AND voucherAuditUser='{param7}' #param7# END*/ /*START #param8# AND {param8} #param8# END*/ /*START #param17# AND {param17} #param17# END*/ /*START #param18# AND {param18} #param18# END*/ ORDER BY vchDate,typeid,ABS(oldvoucherid),serail
FIN103002=SELECT customerId,yyyy,subjectId,subjectName,direction,currency,SUM(CASE WHEN subMonth=1 THEN debitRemain ELSE 0 END) AS debitRemain,SUM(CASE WHEN subMonth=1 THEN creditRemain ELSE 0 END) AS creditRemain,SUM(CASE WHEN subMonth=1 THEN remain ELSE 0 END) AS remain,SUM(debitOcc) AS debitTotalOcc,SUM(creditOcc) AS creditTotalOcc,SUM(tranDebitOcc) AS tranDebitTotalOcc,SUM(tranCreditOcc) AS tranCreditTotalOcc,SUM(debitOccNoTran) AS debitTotalOccNoTran,SUM(creditOccNoTran) AS creditTotalOccNoTran,SUM(CASE WHEN subMonth=12 THEN debitBalance ELSE 0 END) AS debitBalance,SUM(CASE WHEN subMonth=12 THEN creditBalance ELSE 0 END) AS creditBalance,SUM(CASE WHEN subMonth=12 THEN balance ELSE 0 END) AS balance,isLeaf1,level1,subjectFullName,ACTIVE_FLAG FROM {lockDbName}.fin_account WHERE customerId = {lockCustomerId} AND yyyy BETWEEN {lockYyyy} AND {endYear}
FIN103003=SELECT '' AS autoId,'' AS customerId,'' AS yyyy,'' AS voucherId,'' AS oldVoucherId,'' AS typeId,'' AS vchDate,'' AS Serail,'' AS summary,'' AS subjectId,'' AS direction,'' AS OccurValue,'' AS CurrRate,'' AS CurrValue,'' AS Currency,'' AS Quantity,'' AS UnitPrice,'' AS UnitName,'' AS subjectName,'' AS SubjectFullName1,'' AS debitsubjects,'' AS creditsubjects,'' AS voucherFillUser,'' AS voucherAuditUser,'' AS voucherKeepUser,'' AS voucherAffixCount,'' AS voucherDebitOcc,'' AS voucherCreditOcc,'' AS voucherDirector, '' AS ACTIVE_FLAG,DebitOcc,CreditOcc,Balance,DebitTotalOcc,CreditTotalOcc,DebitBalance,concat(subjectId,'-',yyyy,'-',subMonth) mKey FROM {lockDbName}.fin_account WHERE customerId = {lockCustomerId} AND subjectId LIKE '{subjectId}%' AND yyyy BETWEEN {lockYyyy} AND {endYear} AND CONCAT(yyyy,'-',subMonth) BETWEEN {startDate} AND {endDate}
########\u660E\u7EC6\u8868########
########\u6838\u7B97\u660E\u7EC6\u8868########
#\u6838\u7B97\u660E\u7EC6\u8D26
#\u660E\u7EC6+\u6838\u7B97\u660E\u7EC6
FIN104001=SELECT * FROM(SELECT '0' as type,a.voucherId,a.serail,a.summary,a.subjectId,a.subjectFullName AS subjectFullName,IF(a.direction=1,a.occurValue,0.00) AS debitValue,IF(a.direction=-1,a.occurValue,0.00) AS crebitValue,a.currrate,a.currValue,a.currency,IF(a.isTransferVoucher=1,'\u662F','\u5426') AS isTransferVoucher FROM {lockDbName}.fin_subjectentry a WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.typeId='{param2}' AND a.oldVoucherId='{param3}' AND a.vchDate='{param4}' UNION SELECT '1' as type,a.voucherId,CONCAT(a.serail,'-\u6838\u7B97') AS serail,a.summary,a.assItemId,b.assTotalName,IF(a.direction=1,a.occurValue,0.00) AS debitValue,IF(a.direction=-1,a.occurValue,0.00) AS crebitValue,a.currrate,a.currValue,a.currency,'' FROM {lockDbName}.fin_assitementry a LEFT JOIN {lockDbName}.fin_assitem b ON a.assItemId=b.assItemId AND a.yyyy=b.yyyy AND a.customerId=b.customerId AND a.subjectId=b.subjectId WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.typeId='{param2}' AND a.oldVoucherId='{param3}' AND a.vchDate='{param4}') a ORDER BY a.voucherId,a.serail
#\u6838\u7B97\u660E\u7EC6\u8D26\u7A7F\u900F\u51ED\u8BC1\u8BE6\u7EC6
FIN104002=SELECT a.*,'0' AS type,t.subjectFullName as subjectFullName FROM(SELECT customerId,yyyy,subjectId,voucherId,oldvoucherId,vchDate,typeId,serail,assItemId,summary,direction,occurValue,currRate,currValue,currency,quantity,unitName,unitPrice,if(direction=-1,occurValue,0.00) as crebitValue,if(direction=1,occurValue,0.00) as debitValue,IF(isTransferVoucher=1,'\u662F','\u5426') AS isTransferVoucher FROM {lockDbName}.fin_assitementry WHERE customerId={lockCustomerId} AND voucherId={param3} AND typeId='{param2}' AND vchDate='{param4}') a LEFT JOIN {lockDbName}.fin_accpkgsubject t ON a.subjectId=t.subjectId AND a.customerId=t.customerId AND t.yyyy={lockYyyy} ORDER BY a.serail
#\u6838\u7B97\u660E\u7EC6\u8D26 \u67E5\u8BE2\u521D\u671F\u4F59\u989D
FIN104003=SELECT '>\u671F\u521D\u4F59\u989D' AS summary,SUM(IFNULL(remain,0)) AS remain FROM {lockDbName}.fin_assitementryacc WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND subMonth = {startMonth} /*START #subjectId# AND subjectId in ({subjectId}) #subjectId# END*/ /*START #assItemId# AND assItemId = '{assItemId}' #assItemId# END*/ /*START #isLeaf# AND isLeaf1 = {isLeaf} #isLeaf# END*/
########\u6838\u7B97\u660E\u7EC6\u8868########
########\u51ED\u8BC1\u67E5\u8BE2########
#\u51ED\u8BC1\u67E5\u8BE2 \u6309\u5206\u5F55\u67E5\u8BE2 
FIN105001=SELECT * FROM(SELECT a.voucherId,a.vchDate,a.typeId,a.oldVoucherId,a.serail,a.summary,a.subjectId,a.subjectFullName,IF(a.direction=1,a.occurValue,0.00) AS debitValue,IF(a.direction=-1,a.occurValue,0.00) AS crebitValue,a.autoId,a.currrate,a.currValue,a.currency,a.quantity,a.unitPrice,a.unitName,a.customerId,a.yyyy FROM {lockDbName}.fin_subjectentry a WHERE 1=1 /*START #lockCustomerId# AND a.customerId={lockCustomerId} #lockCustomerId# END*/ /*START #lockYyyy# AND a.yyyy BETWEEN {lockYyyy} AND {param1} #lockYyyy# END*/ /*START #param2# AND a.vchDate BETWEEN '{param2}' AND '{param3}' #param2# END*/ /*START #param4# AND SUBSTRING(a.vchDate,1,7) BETWEEN '{param4}' AND '{param5}' #param4# END*/ /*START #param6# AND a.subjectId LIKE '{param6}%' #param6# END*/ /*START #param7# AND a.subjectId NOT LIKE '{param7}%' #param7# END*/ /*START #param8# AND a.typeId='{param8}' #param8# END*/ /*START #param9# AND a.oldVoucherId='{param9}' #param9# END*/ /*START #param10# AND a.summary LIKE '%{param10}%' #param10# END*/ /*START #param15# AND voucherFillUser='{param15}' #param15# END*/ /*START #param16# AND voucherFillUser='{param16}' #param16# END*/ /*START #param17# AND {param17} #param17# END*/ /*START #param18# AND {param18} #param18# END*/) a WHERE 1=1 /*START #param25# AND a.currency='' #param25# END*/ /*START #param11# AND abs(debitValue) {param11} #param11# END*/ /*START #param12# AND abs(crebitValue) {param12} #param12# END*/ /*START #param13# AND abs(currValue) {param13} #param13# END*/ /*START #param14# AND(abs(debitValue) {param14} or abs(crebitValue) {param14}) #param14# END*/ order by a.vchDate,a.oldVoucherId,a.serail
#\u51ED\u8BC1\u67E5\u8BE2 \u6309\u51ED\u8BC1\u67E5\u8BE2 
FIN105002=SELECT a.voucherId,a.vchDate,a.typeId,a.oldVoucherId,a.serail,a.summary,a.subjectId,a.subjectFullName AS subjectFullName,IF(a.direction=1,a.occurValue,0.00) AS debitValue,IF(a.direction=1,a.currValue,0.00) AS debitCurrValue,IF(a.direction=-1,a.occurValue,0.00) AS crebitValue,IF(a.direction=-1,a.currValue,0.00) AS crebitCurrValue,a.autoId,a.currrate,a.currValue,a.currency,a.quantity,a.unitPrice,a.unitName,a.customerId,a.yyyy FROM {lockDbName}.fin_subjectentry a WHERE 1=1 AND a.customerId={lockCustomerId} /*START #param25# AND a.currency='' #param25# END*/ /*START #lockYyyy# AND a.yyyy BETWEEN {lockYyyy} AND {param1} #lockYyyy# END*/ /*START #param2# AND a.vchDate BETWEEN '{param2}' AND '{param3}' #param2# END*/ /*START #param4# AND SUBSTRING(a.vchDate,1,7) BETWEEN '{param4}' AND '{param5}' #param4# END*/ AND voucherId IN(SELECT DISTINCT voucherId FROM(SELECT a.voucherId,IF(a.direction=1,a.occurValue,0.00) AS debitValue,IF(a.direction=-1,a.occurValue,0.00) AS crebitValue,a.currValue FROM {lockDbName}.fin_subjectentry a WHERE 1 = 1 /*START #lockCustomerId# AND a.customerId={lockCustomerId} #lockCustomerId# END*/ /*START #lockYyyy# AND a.yyyy BETWEEN {lockYyyy} AND {param1} #lockYyyy# END*/ /*START #param2# AND a.vchDate BETWEEN '{param2}' AND '{param3}' #param2# END*/ /*START #param4# AND SUBSTRING(a.vchDate,1,7) BETWEEN '{param4}' AND '{param5}' #param4# END*/ /*START #param6# AND a.subjectId LIKE '{param6}%' #param6# END*/ /*START #param7# AND a.subjectId NOT LIKE '{param7}%' #param7# END*/ /*START #param8# AND a.typeId='{param8}' #param8# END*/ /*START #param9# a.oldVoucherId='{param9}' #param9# END*/ /*START #param10# AND a.summary LIKE '%{param10}%' #param10# END*/ /*START #param15# AND voucherFillUser='{param15}' #param15# END*/ /*START #param16# AND voucherAuditUser='{param16}' #param16# END*/ /*START #param17# AND {param17} #param17# END*/ /*START #param18# AND {param18} #param18# END*/) a WHERE 1=1 /*START #param11# AND abs(debitValue) {param11} #param11# END*/ /*START #param12# AND abs(crebitValue) {param12} #param12# END*/ /*START #param13# AND abs(currValue) {param13} #param13# END*/ /*START #param14# AND(abs(debitValue) {param14} or abs(crebitValue) {param14}) #param14# END*/) ORDER BY a.vchDate,a.oldVoucherId,a.serail
#\u51ED\u8BC1\u67E5\u8BE2 \u6307\u5B9A\u79D1\u76EE\u67E5\u8BE2\u6240\u6709\u5B50\u79D1\u76EE
FIN105003=SELECT GROUP_CONCAT(a.subjectId) AS subjectIds FROM {lockDbName}.fin_accpkgsubject a WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.parentSubjectId IN({param3})
#\u51ED\u8BC1\u67E5\u8BE2 \u67E5\u8BE2\u6307\u5B9A\u671F\u95F4\u5206\u5F55\u79D1\u76EE
FIN105004=SELECT DISTINCT subjectId FROM {lockDbName}.fin_subjectentry WHERE 1 = 1 AND customerId={lockCustomerId} /*START #lockYyyy# AND yyyy>={lockYyyy} #lockYyyy# END*/ /*START #param3# AND yyyy<={param3} #param3# END*/ /*START #param4# AND SUBSTRING(vchDate,1,7) BETWEEN '{param4}' AND '{param5}' #param4# END*/ /*START #param6# AND vchDate BETWEEN '{param6}' AND '{param7}' #param6# END*/ AND subjectId LIKE '{param8}%'
#\u67E5\u8BE2\u7B26\u5408\u6761\u4EF6\u7684\u51ED\u8BC1\u53F7
FIN105005=SELECT GROUP_CONCAT(DISTINCT voucherId) AS voucherId FROM (SELECT voucherId,IF(direction=1,occurValue,0) AS debitOcc,IF(direction=-1,occurValue,0) AS crebitOcc FROM {lockDbName}.fin_subjectentry WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} /*START #param1# AND month >= {param1} #param1# END*/ /*START #param2# AND month <= {param2} #param2# END*/ /*START #param3# AND STR_TO_DATE(vchDate,'%Y-%m-%d') >= STR_TO_DATE('{param3}','%Y-%m-%d') #param3# END*/ /*START #param4# AND STR_TO_DATE(vchDate,'%Y-%m-%d') <= STR_TO_DATE('{param4}','%Y-%m-%d') #param4# END*/ /*START #param5# AND subjectId LIKE '{param5}%' #param5# END*/ /*START #param6# AND subjectId NOT LIKE '{param6}%' #param6# END*/ /*START #param7# AND typeId='{param7}' #param7# END*/ /*START #param8# AND oldVoucherId='{param8}' #param8# END*/ /*START #param9# {param9} #param9# END*/ /*START #param10# AND occurValue {param10} #param10# END*/ /*START #param11# AND currValue {param11} #param11# END*/ /*START #param15# {param15} #param15# END*/) a WHERE 1 = 1 /*START #param12# AND debitOcc {param12} #param12# END*/ /*START #param13# AND crebitOcc {param13} #param13# END*/
#\u6309\u51ED\u8BC1\u53F7\u67E5\u8BE2
FIN105006=SELECT autoId,customerId,yyyy,month,subjectId,subjectName,subjectFullName,vchDate,vchTime,typeId,voucherId,oldVoucherId,serail,summary,direction,IF(direction=1,occurValue,0) AS debitOcc,IF(direction=-1,occurValue,0) AS crebitOcc,currrate,currency,IF(direction=1,currValue,0) AS debitOccF,IF(direction=-1,currValue,0) AS crebitOccF,oppositeSubjectValue AS dfkm,occurValue,quantity,unitPrice,unitName FROM {lockDbName}.fin_subjectentry a WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND voucherId IN ({param1}) ORDER BY vchDate,voucherId,serail
#\u51ED\u8BC1\u5206\u7EC4\u67E5\u8BE2
FIN105007=SELECT customerId,yyyy,groupType,groupId,voucherId,debitSubjects,creditSubjects,debitOcc,creditOcc,voucherNum,vchDateNum,vchMonthNum FROM {lockDbName}.fin_subjectvouchergroup a WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.groupType = {param1} /*START #param2# AND CONCAT(',', voucherId, ',') REGEXP '{param2}' #param2# END*/ order by abs(a.debitOcc) desc,a.groupId
#\u6309\u51ED\u8BC1\u53F7\u67E5\u8BE2\u65E5\u671F
FIN105008=SELECT customerId,vchDate,voucherId,oldVoucherId,typeId FROM {lockDbName}.fin_subjectentry a WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND voucherId IN ({param1}) group by voucherId ORDER BY vchDate,voucherId
#\u67E5\u8BE2\u6700\u540E\u5BFC\u5165\u65F6\u95F4
FIN105009=SELECT max(a.CREATION_DATE) as lastDate FROM {lockDbName}.fin_subjectentry a WHERE customerId={lockCustomerId} AND yyyy={lockYyyy}
#\u5206\u7EC4\u5BFC\u51FA\u67E5\u8BE2
FIN105010=SELECT a.autoId,a.customerId,a.yyyy,a.month,a.subjectId,a.subjectName,a.subjectFullName,a.vchDate,a.vchTime,a.typeId,a.voucherId,a.oldVoucherId,a.serail,a.summary,a.direction,IF(a.direction=1,a.occurValue,0) AS debitOcc,IF(a.direction=-1,a.occurValue,0) AS crebitOcc,a.currrate,a.currency,IF(a.direction=1,a.currValue,0) AS debitOccF,IF(a.direction=-1,a.currValue,0) AS crebitOccF,a.oppositeSubjectValue AS dfkm,a.occurValue, b.groupId FROM {lockDbName}.fin_subjectentry a inner join {lockDbName}.fin_subjectvouchergroup b on a.customerId = b.customerId and a.yyyy = b.yyyy and CONCAT(',', b.voucherId, ',') REGEXP CONCAT(',', a.voucherId, ',') WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND b.groupType = {param1} AND a.voucherId IN ({param2}) order by abs(b.debitOcc) desc,b.groupId,a.vchDate,a.voucherId,a.serail
#\u51ED\u8BC1\u5206\u7EC4\u67E5\u8BE2\u51ED\u8BC1\u53F7
FIN105011=SELECT GROUP_CONCAT(voucherId) as voucherId FROM {lockDbName}.fin_subjectvouchergroup a WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.groupType = {param1} /*START #param2# AND CONCAT(',', voucherId, ',') REGEXP '{param2}' #param2# END*/
########\u51ED\u8BC1\u67E5\u8BE2########
########\u79D1\u76EE\u7EDD\u5BF9\u6570########
#\u79D1\u76EE\u7EDD\u5BF9\u6570 \u4E00\u89C8\u5217\u8868
FIN106001=SELECT aa.subjectId,aa.subjectName {param12} FROM((SELECT subjectId,CONCAT(REPEAT('&nbsp;&nbsp;',a.level1-1),a.subjectName) AS subjectName,a.yyyy,a.subMonth {param11} FROM {lockDbName}.fin_account a WHERE a.customerId={lockCustomerId} /*START #param9# AND a.level1 {param9} #param9# END*/ /*START #param10# AND a.isLeaf1=1 #param10# END*/ GROUP BY a.customerId,a.yyyy,a.subjectId)) aa WHERE 1=1 AND aa.yyyy<={param1} AND aa.yyyy>={param5} /*START #param6# AND aa.subjectId IN({param6}) #param6# END*/ /*START #param7# AND aa.subjectId LIKE '{param7}%' #param7# END*/ GROUP BY aa.subjectId ORDER BY aa.subjectId
#\u79D1\u76EE\u7EDD\u5BF9\u6570 \u6708\u5EA6\u53D8\u5316
FIN106002=SELECT aa.customerId,aa.yyyy,aa.subjectId,aa.subjectName {param6},aa.fullName FROM(SELECT a.customerId,a.yyyy,a.subjectId,a.subjectName {param7},a.subjectFullName AS fullName FROM {lockDbName}.fin_account a WHERE 1=1 /*START #lockCustomerId# AND a.customerId={lockCustomerId} #lockCustomerId# END*/ /*START #lockYyyy# AND a.yyyy<={lockYyyy} #lockYyyy# END*/ /*START #param3# AND a.yyyy>={param3} #param3# END*/ GROUP BY a.customerId,a.yyyy,a.subjectId,a.subMonth) aa WHERE 1=1 /*START #lockCustomerId# AND aa.customerId={lockCustomerId} #lockCustomerId# END*/ /*START #lockYyyy# AND aa.yyyy<={lockYyyy} #lockYyyy# END*/ /*START #param3# AND aa.yyyy>={param3} #param3# END*/ /*START #param4# AND aa.subjectId IN({param4}) #param4# END*/ GROUP BY aa.customerId,aa.yyyy,aa.subjectId ORDER BY aa.customerId,aa.yyyy,aa.subjectId
#\u79D1\u76EE\u7EDD\u5BF9\u6570 \u4E00\u89C8\u5217\u8868(\u81EA\u5B9A\u4E49\u5206\u7EC4\u67E5\u8BE2)
FIN106003=SELECT aa.subjectId,aa.subjectName {param14} FROM((SELECT '{param12}' AS subjectId,'{param13}' AS subjectName,a.yyyy,a.subMonth {param11} FROM {lockDbName}.fin_account a WHERE a.customerId={lockCustomerId} /*START #param9# AND a.level1 {param9} #param9# END*/ /*START #param10# AND a.isLeaf1=1 #param10# END*/ GROUP BY a.customerId,a.yyyy)) aa WHERE 1=1 AND aa.yyyy<={param1} AND aa.yyyy>={param5} /*START #param6# AND aa.subjectId IN({param6}) #param6# END*/ /*START #param7# AND aa.subjectId LIKE '{param7}%' #param7# END*/ GROUP BY aa.subjectId ORDER BY aa.subjectId
#\u79D1\u76EE\u7EDD\u5BF9\u6570 \u6708\u5EA6\u53D8\u5316(\u81EA\u5B9A\u4E49\u5206\u7EC4\u67E5\u8BE2)
FIN106004=SELECT aa.customerId,aa.yyyy,aa.subjectId,aa.subjectName {param6},aa.fullName FROM(SELECT a.customerId,a.yyyy,'{param12}' AS subjectId,'{param13}' AS subjectName {param7},'{param13}' AS fullName FROM {lockDbName}.fin_account a WHERE 1=1 /*START #lockCustomerId# AND a.customerId={lockCustomerId} #lockCustomerId# END*/ GROUP BY a.customerId,a.yyyy,a.subMonth) aa WHERE 1=1 /*START #lockCustomerId# AND aa.customerId={lockCustomerId} #lockCustomerId# END*/ /*START #lockYyyy# AND aa.yyyy<={lockYyyy} #lockYyyy# END*/ /*START #param3# AND aa.yyyy>={param3} #param3# END*/ /*START #param4# AND aa.subjectId IN({param4}) #param4# END*/ GROUP BY aa.customerId,aa.yyyy,aa.subjectId ORDER BY aa.customerId,aa.yyyy,aa.subjectId
########\u79D1\u76EE\u7EDD\u5BF9\u6570########
########\u5927\u91D1\u989D\u51ED\u8BC1\u5206\u6790########
#\u5927\u91D1\u989D\u51ED\u8BC1\u5206\u6790
#\u5927\u91D1\u989D\u51ED\u8BC1\u5206\u6790 \u7EDF\u8BA1\u56FE\u5408\u8BA1\u91D1\u989D
FIN107001=SELECT month AS Mdate,SUM(occurValue) AS sumValue FROM {lockDbName}.fin_subjectentry WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} /*START #param1# AND subjectId LIKE '{param1}%' #param1# END*/ /*START #param2# AND occurValue>={param2} #param2# END*/ /*START #param3# AND occurValue<={param3} #param3# END*/ AND direction={param4} GROUP BY MDate ORDER BY MDate
#\u5927\u91D1\u989D\u51ED\u8BC1\u5206\u6790 \u7EDF\u8BA1\u56FE\u51ED\u8BC1\u6570\u91CF
FIN107002=SELECT Mdate,COUNT(Mdate) as sumValue FROM(SELECT month AS Mdate,voucherId AS sumValue FROM {lockDbName}.fin_subjectentry WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} /*START #param1# AND subjectId LIKE '{param1}%' #param1# END*/ /*START #param2# AND occurValue>={param2} #param2# END*/ /*START #param3# AND occurValue<={param3} #param3# END*/ AND direction={param4} ORDER BY Mdate) AS a GROUP BY Mdate ORDER BY Mdate
#\u5927\u91D1\u989D\u51ED\u8BC1\u5206\u6790 \u51ED\u8BC1\u6570\u91CF
FIN107003=SELECT COUNT(sumValue) as sumValue FROM(SELECT month AS Mdate,voucherId AS sumValue FROM {lockDbName}.fin_subjectentry WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} /*START #param1# AND subjectId LIKE '{param1}%' #param1# END*/ /*START #param2# AND occurValue>={param2} #param2# END*/ /*START #param3# AND occurValue<={param3} #param3# END*/ AND direction={param4} GROUP BY voucherId ORDER BY Mdate) AS a ORDER BY Mdate
#\u5927\u91D1\u989D\u660E\u7EC6\u5206\u6790 \u70B9\u51FB\u67F1\u72B6\u56FE
FIN107004=SELECT autoId,customerId,yyyy,voucherId,oldVoucherId,typeId,vchDate,serail,summary,subjectId,direction,occurValue,currRate,currValue,currency,quantity,unitPrice,unitName,subjectName,oppositeAccountTop,oppositeSubjectValue,oppositeTopSubjectValue,subjectFullName,debitsubjects,creditsubjects,voucherFillUser,voucherAuditUser,voucherKeepUser,voucherAffixCount,voucherDebitOcc,voucherCreditOcc,voucherDirector,CASE direction WHEN 1 THEN OccurValue ELSE 0.00 END AS debit,CASE direction WHEN-1 THEN OccurValue ELSE 0.00 END AS credit,'' AS debitRemain FROM {lockDbName}.fin_subjectentry WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} /*START #param1# AND subjectId LIKE '{param1}%' #param1# END*/ /*START #param2# AND occurValue>={param2} #param2# END*/ /*START #param3# AND occurValue<={param3} #param3# END*/ /*START #param5# AND month='{param5}' #param5# END*/ AND direction={param4} ORDER BY vchDate,voucherId
########\u5927\u91D1\u989D\u51ED\u8BC1\u5206\u6790########
########\u975E\u5E38\u7528\u79D1\u76EE\u5206\u6790########
#\u975E\u5E38\u7528\u79D1\u76EE \u83B7\u53D6\u7B26\u5408\u6761\u4EF6\u7684\u79D1\u76EE
FIN108001=SELECT GROUP_CONCAT(CONCAT('\"',subjectId,'\"')) FROM (SELECT subjectId,COUNT(DISTINCT voucherId) AS voucherCount FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #minValue# AND ABS(occurValue) >= {minValue} #minValue# END*/ /*START #maxValue# AND ABS(occurValue) <= {maxValue} #maxValue# END*/ GROUP BY subjectId) a WHERE 1 = 1 /*START #voucherCount# AND a.voucherCount <= {voucherCount} #voucherCount# END*/  
#\u975E\u5E38\u7528\u79D1\u76EE \u6839\u636E\u79D1\u76EE\u67E5\u8BE2\u51ED\u8BC1,\u5206\u5F55\u6570\u91CF
FIN108002=SELECT * FROM (SELECT a.subjectId,a.subjectFullName,COUNT(DISTINCT voucherId) AS vchCount,COUNT(DISTINCT voucherId,serail) AS jourCount,SUM(ABS(dr)+ABS(cr)) AS absvalue,SUM(dr-cr) AS amount FROM (SELECT subjectId,subjectFullName,vchDate,voucherId,oldVoucherId,serail,CASE direction WHEN 1 THEN occurValue ELSE 0 END AS dr,CASE direction WHEN-1 THEN occurValue ELSE 0 END AS cr FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND subjectId IN ({subjectId}) ORDER BY vchDate,voucherId,serail) a GROUP BY a.subjectId) a ORDER BY a.absvalue desc,a.vchCount,a.jourCount,a.subjectId
#\u975E\u5E38\u7528\u79D1\u76EE \u997C\u56FE\u6570\u636E
FIN108003=SELECT subjectFullName AS name,COUNT(0) AS value,customerId,yyyy,subjectId FROM {lockDbName}.fin_subjectentry AS s WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND s.subjectId IN(SELECT distinct subjectId FROM {lockDbName}.fin_subjectentry WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} /*START #param4# AND ABS(occurValue)>={param4} #param4# END*/ /*START #param5# AND ABS(occurValue)<={param5} #param5# END*/) GROUP BY s.subjectId /*START #param2# HAVING value<={param2} #param2# END*/ ORDER BY value
#\u975E\u5E38\u7528\u79D1\u76EE \u6839\u636E\u79D1\u76EE\u67E5\u8BE2\u51ED\u8BC1\u5206\u5F55
FIN108004=SELECT subjectId,subjectFullName,vchDate,voucherId,oldVoucherId,serail,summary,CASE direction WHEN 1 THEN occurValue ELSE 0 END AS dr,CASE direction WHEN-1 THEN occurValue ELSE 0 END AS cr FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND subjectId IN ({subjectId}) ORDER BY subjectId,vchDate,voucherId,serail
#\u975E\u5E38\u7528\u79D1\u76EE\u51ED\u8BC1\u8BE6\u7EC6
FIN108005=SELECT a.customerId,a.yyyy,a.subjectId,a.subjectFullName,a.vchDate,a.typeId,a.voucherId,a.serail,a.summary,a.direction,a.oldVoucherId,IF(a.direction=1,a.occurValue,0) AS debitOcc,IF(a.direction=-1,a.occurValue,0) AS creditOcc,a.currrate,a.currValue,a.currency FROM {lockDbName}.fin_subjectentry a WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND a.voucherId IN(SELECT distinct voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND subjectId='{param1}') ORDER BY vchDate,voucherId,serail
########\u975E\u5E38\u7528\u79D1\u76EE\u5206\u6790########
########\u5BF9\u5E94\u51ED\u8BC1\u5206\u6790########
#\u83B7\u53D6\u53D1\u751F\u989D
FIN109001=SELECT SUM(occurValue) AS occurValue FROM {lockDbName}.fin_subjectentry WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND month >= {startMonth} AND month <= {endMonth} AND subjectId IN ({subjectId}) AND direction={direction} {viewType}
#\u83B7\u53D6\u79D1\u76EE\u51ED\u8BC1\u6570\u91CF
FIN109002=SELECT COUNT(DISTINCT voucherId) AS voucherCount FROM {lockDbName}.fin_subjectentry WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND month >= {startMonth} AND month <= {endMonth} /*START #fxVoucherId# AND voucherId IN ({fxVoucherId}) #fxVoucherId# END*/ AND subjectId IN ({fxSubjectId}) AND direction = {fxDirection} {viewType}
#\u83B7\u53D6\u79D1\u76EE\u53CA\u5176\u5B50\u79D1\u76EE
FIN109003=SELECT GROUP_CONCAT(CONCAT('\"',subjectId,'\"')) AS subjectIds FROM {lockDbName}.fin_accpkgsubject WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND subjectFullId REGEXP '{subjectId}' /*START #subjectLevel# AND level1 = {subjectLevel} #subjectLevel# END*/ /*START #isLeaf# AND isLeaf1 = {isLeaf} #isLeaf# END*/
#\u901A\u8FC7\u79D1\u76EE\u83B7\u53D6\u4E0B\u7EA7\u7EA7\u522B
FIN109004=SELECT level1 FROM {lockDbName}.fin_accpkgsubject WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND subjectId = '{subjectId}'
#\u5305\u542B\u5206\u6790\u79D1\u76EE\u7684\u51ED\u8BC1
FIN109005=SELECT GROUP_CONCAT(DISTINCT voucherId) AS voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND month >= {startMonth} AND month <= {endMonth} /*START #subjectId# AND subjectId IN ({subjectId}) AND direction = {direction} #subjectId# END*/ {voucherType}
####\u5BF9\u5E94\u51ED\u8BC1\u5206\u6790 \u591A\u501F\u591A\u8D37\u5206\u6790
#\u4E00\u501F\u6216\u4E00\u8D37\u79D1\u76EE\u6C47\u603B
#\u501F\u65B9\u5206\u6790
FIN109006=SELECT a.customerId,a.yyyy,a.oneSubjectId,b.subjectFullName,a.sumValue,a.voucherCount,a.avgValue,a.largeValue,b.isLeaf1,b.level1 AS subjectLevel FROM (SELECT a.customerId,a.yyyy,SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',{subjectLevel}),'/',-1) AS oneSubjectId,SUM(a.occurValue) AS sumValue,COUNT(DISTINCT a.voucherId) AS voucherCount,ROUND(SUM(a.occurValue)/COUNT(DISTINCT a.voucherId),2) AS avgValue,MAX(a.occurValue) AS largeValue FROM (SELECT customerId,yyyy,voucherId,CASE WHEN (direction = -1 AND drCount=1 AND crCount>=1) THEN subjectId WHEN (direction = 1 AND drCount > 1 AND crCount = 1 AND subjectId IN ({fxSubjectId})) THEN creditsubjects ELSE NULL END AS subjectId,CASE WHEN (direction = -1 AND drCount=1 AND crCount>=1) THEN occurValue WHEN (direction = 1 AND drCount > 1 AND crCount = 1 AND subjectId IN ({fxSubjectId})) THEN occurValue ELSE NULL END AS occurValue FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND month >= {startMonth} AND month <= {endMonth} AND voucherId IN ({fxVoucherId})) a INNER JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = {lockCustomerId} AND b.yyyy = {lockYyyy} AND b.subjectId = a.subjectId WHERE 1 = 1 /*START #dySubjectId# AND a.subjectId IN ({dySubjectId}) #dySubjectId# END*/ GROUP BY SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',{subjectLevel}),'/',-1)) a INNER JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = {lockCustomerId} AND b.yyyy = {lockYyyy} AND b.subjectId = a.oneSubjectId WHERE 1 = 1 AND b.level1 = {subjectLevel} ORDER BY a.oneSubjectId
#\u8D37\u65B9\u5206\u6790
FIN109007=SELECT a.customerId,a.yyyy,a.oneSubjectId,b.subjectFullName,a.sumValue,a.voucherCount,a.avgValue,a.largeValue,b.isLeaf1,b.level1 AS subjectLevel FROM (SELECT a.customerId,a.yyyy,SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',{subjectLevel}),'/',-1) AS oneSubjectId,SUM(a.occurValue) AS sumValue,COUNT(DISTINCT a.voucherId) AS voucherCount,ROUND(SUM(a.occurValue)/COUNT(DISTINCT a.voucherId),2) AS avgValue,MAX(a.occurValue) AS largeValue FROM (SELECT customerId,yyyy,voucherId,CASE WHEN (direction = 1 AND drCount>=1 AND crCount=1) THEN subjectId WHEN (direction = -1 AND drCount = 1 AND crCount > 1 AND subjectId IN ({fxSubjectId})) THEN debitsubjects ELSE NULL END AS subjectId,CASE WHEN (direction = 1 AND drCount>=1 AND crCount=1) THEN occurValue WHEN (direction = -1 AND drCount = 1 AND crCount > 1 AND subjectId IN ({fxSubjectId})) THEN occurValue ELSE NULL END AS occurValue FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND month >= {startMonth} AND month <= {endMonth} AND voucherId IN ({fxVoucherId})) a INNER JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = {lockCustomerId} AND b.yyyy = {lockYyyy} AND b.subjectId = a.subjectId WHERE 1 = 1 /*START #dySubjectId# AND a.subjectId IN ({dySubjectId}) #dySubjectId# END*/ GROUP BY SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',{subjectLevel}),'/',-1)) a INNER JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = {lockCustomerId} AND b.yyyy = {lockYyyy} AND b.subjectId = a.oneSubjectId WHERE 1 = 1 AND b.level1 = {subjectLevel} ORDER BY a.oneSubjectId
#\u591A\u501F\u591A\u8D37\u79D1\u76EE\u6C47\u603B
FIN109008=SELECT a.customerId,a.yyyy,a.oneSubjectId,b.subjectFullName,c.sumValue,a.voucherCount,ROUND(c.sumValue/a.voucherCount,2) AS avgValue,a.largeValue,b.isLeaf1,b.level1 AS subjectLevel FROM (SELECT a.customerId,a.yyyy,SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',{subjectLevel}),'/',-1) AS oneSubjectId,COUNT(DISTINCT a.voucherId) AS voucherCount,MAX(ABS(a.occurValue)) AS largeValue FROM {lockDbName}.fin_subjectentry a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.subjectId = a.subjectId WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.month >= {startMonth} AND a.month <= {endMonth} AND a.subjectId NOT IN ({fxSubjectId}) AND a.voucherId  IN ({fxVoucherId}) /*START #dySubjectId# AND a.subjectId IN ({dySubjectId}) #dySubjectId# END*/ GROUP BY SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',{subjectLevel}),'/',-1)) a INNER JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.subjectId = a.oneSubjectId LEFT JOIN (SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',{subjectLevel}),'/',-1) AS subjectId,SUM(a.corrValue) AS sumValue FROM {lockDbName}.fin_subjectvouchercorr a INNER JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.subjectId = a.corrSubjectId WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.month >= {startMonth} AND a.month <= {endMonth} AND a.voucherType IN ('m','s','r') AND a.voucherId IN ({fxVoucherId}) AND a.subjectId IN ({fxSubjectId}) AND a.direction = {fxDirection} GROUP BY SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',{subjectLevel}),'/',-1)) c ON c.subjectId = a.oneSubjectId WHERE 1 = 1 AND b.level1 = {subjectLevel} ORDER BY a.oneSubjectId
#FIN109008=SELECT a.customerId,a.yyyy,a.oneSubjectId,b.subjectFullName,a.voucherCount,'' AS avgValue,'' AS largeValue,b.isLeaf1,b.level1 AS subjectLevel FROM (SELECT a.customerId,a.yyyy,SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',{subjectLevel}),'/',-1) AS oneSubjectId,COUNT(DISTINCT a.voucherId) AS voucherCount FROM {lockDbName}.fin_subjectentry a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.subjectId = a.subjectId WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.month >= {startMonth} AND a.month <= {endMonth} AND a.direction = {dyDirection} AND a.voucherId  IN ({fxVoucherId}) /*START #dySubjectId# AND a.subjectId IN ({dySubjectId}) #dySubjectId# END*/ GROUP BY SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',{subjectLevel}),'/',-1)) a INNER JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.subjectId = a.oneSubjectId WHERE 1 = 1 AND b.level1 = {subjectLevel} ORDER BY a.oneSubjectId
#\u591A\u501F\u591A\u8D37\u79D1\u76EE\u53D1\u751F\u989D
#FIN109009=SELECT IFNULL(SUM(corrValue),0) AS sumValue FROM {lockDbName}.fin_subjectvouchercorr WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND month >= {startMonth} AND month <= {endMonth} AND voucherId IN ({fxVoucherId}) AND direction = {fxDirection} AND corrSubjectId LIKE '{dySubjectId}%'
#\u540C\u501F\u540C\u8D37\u79D1\u76EE\u6C47\u603B
#FIN109010=SELECT a.customerId,a.yyyy,a.oneSubjectId,b.subjectFullName,a.voucherCount,'' AS avgValue,'' AS largeValue,b.isLeaf1,b.level1 AS subjectLevel FROM (SELECT a.customerId,a.yyyy,SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',{subjectLevel}),'/',-1) AS oneSubjectId,COUNT(DISTINCT a.voucherId) AS voucherCount FROM {lockDbName}.fin_subjectentry a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.subjectId = a.subjectId WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.month >= {startMonth} AND a.month <= {endMonth} AND a.direction = {fxDirection} AND a.voucherId  IN ({fxVoucherId}) /*START #dySubjectId# AND a.subjectId IN ({dySubjectId}) #dySubjectId# END*/ GROUP BY SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',{subjectLevel}),'/',-1)) a INNER JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.subjectId = a.oneSubjectId WHERE 1 = 1 AND b.level1 = {subjectLevel} ORDER BY a.oneSubjectId
FIN109010=SELECT a.customerId,a.yyyy,a.oneSubjectId,b.subjectFullName,c.sumValue,a.voucherCount,ROUND(c.sumValue/a.voucherCount,2) AS avgValue,a.largeValue,b.isLeaf1,b.level1 AS subjectLevel FROM (SELECT a.customerId,a.yyyy,SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',{subjectLevel}),'/',-1) AS oneSubjectId,COUNT(DISTINCT a.voucherId) AS voucherCount,MAX(ABS(a.occurValue)) AS largeValue FROM {lockDbName}.fin_subjectentry a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.subjectId = a.subjectId WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.month >= {startMonth} AND a.month <= {endMonth} AND a.subjectId NOT IN ({fxSubjectId}) AND a.voucherId  IN ({fxVoucherId}) /*START #dySubjectId# AND a.subjectId IN ({dySubjectId}) #dySubjectId# END*/ GROUP BY SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',{subjectLevel}),'/',-1)) a INNER JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.subjectId = a.oneSubjectId LEFT JOIN (SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',{subjectLevel}),'/',-1) AS subjectId,SUM(a.corrValue) AS sumValue FROM {lockDbName}.fin_subjectvouchercorr a INNER JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.subjectId = a.corrSubjectId WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.month >= {startMonth} AND a.month <= {endMonth} AND a.voucherType IN ('m','s','r') AND a.voucherId IN ({fxVoucherId}) AND a.subjectId IN ({fxSubjectId}) AND a.direction = {fxDirection} GROUP BY SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',{subjectLevel}),'/',-1)) c ON c.subjectId = a.oneSubjectId WHERE 1 = 1 AND b.level1 = {subjectLevel} ORDER BY a.oneSubjectId
#\u540C\u501F\u540C\u8D37\u79D1\u76EE\u53D1\u751F\u989D
#FIN109011=SELECT IFNULL(SUM(corrValue),0) AS sumValue FROM {lockDbName}.fin_subjectvouchercorr WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND month >= {startMonth} AND month <= {endMonth} AND voucherId IN ({fxVoucherId}) AND direction = {fxDirection} AND corrSubjectId LIKE '{dySubjectId}%'
####\u5BF9\u5E94\u51ED\u8BC1\u5206\u6790 \u5BF9\u5E94\u51ED\u8BC1\u5206\u6790
#\u5BF9\u5E94\u51ED\u8BC1\u5206\u6790\u67E5\u8BE2
#FIN109012=SELECT a.oneSubjectId,SUM(a.voucherCount) AS voucherCount,IFNULL(SUM(a.sumValue),0) AS sumValue,IFNULL(MAX(a.largeValue),0) AS largeValue,IFNULL(ROUND(SUM(a.sumValue)/SUM(a.voucherCount),2),0) AS avgValue,IF(-1=1,'\u501F','\u8D37') AS direction,b.subjectFullName,b.isLeaf1,b.level1 AS subjectLevel FROM ((SELECT SUBSTRING_INDEX(b.subjectFullId,'/',1) AS oneSubjectId,COUNT(DISTINCT voucherId) AS voucherCount,SUM(occurValue) AS sumValue,MAX(occurValue) AS largeValue FROM (SELECT voucherId,CASE WHEN direction={dyDirection} AND {dyDirection}=-1 THEN subjectId WHEN direction={fxDirection} AND drCount > 1 AND subjectId NOT IN ({subjectId}) AND {dyDirection}=-1 THEN REPLACE(creditsubjects,',','') WHEN direction={dyDirection} AND {dyDirection}=1 THEN subjectId WHEN direction={fxDirection} AND crCount > 1 AND subjectId NOT IN ({subjectId}) AND {dyDirection}=1 THEN REPLACE(debitsubjects,',','') ELSE NULL END AS subjectId,CASE WHEN direction={dyDirection} AND {dyDirection}=-1 THEN occurValue WHEN direction={fxDirection} AND drCount > 1 AND subjectId NOT IN ({subjectId}) AND {dyDirection}=-1 THEN -1*occurValue WHEN direction={dyDirection} AND {dyDirection}=1 THEN occurValue WHEN direction={fxDirection} AND crCount > 1 AND subjectId NOT IN ({subjectId}) AND {dyDirection}=1 THEN -1*occurValue ELSE 0 END AS occurValue FROM {lockDbName}.fin_subjectentry WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND month BETWEEN {startMonth} AND {endMonth} AND voucherId IN ({voucherId})) a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId={lockCustomerId} AND b.yyyy={lockYyyy} AND b.subjectId=a.subjectId WHERE a.subjectId>'' GROUP BY SUBSTRING_INDEX(b.subjectFullId,'/',1)) UNION (SELECT SUBSTRING_INDEX(b2.subjectFullId,'/',1) AS oneSubjectId,COUNT(DISTINCT b1.voucherId) AS voucherCount,SUM(b3.corrValue) AS sumValue,MAX(b3.corrValue) AS largeValue FROM {lockDbName}.fin_subjectentry b1 LEFT JOIN {lockDbName}.fin_accpkgsubject b2 ON b2.customerId=b1.customerId AND b2.yyyy=b1.yyyy AND b2.subjectId=b1.subjectId LEFT JOIN {lockDbName}.fin_subjectvouchercorr b3 ON b3.customerId=b1.customerId AND b3.yyyy=b1.yyyy AND b3.voucherId=b1.voucherId AND b3.serail=b1.serail AND b3.subjectId LIKE '{fxSubjectId}%' WHERE b1.customerId={lockCustomerId} AND b1.yyyy={lockYyyy} AND b1.month BETWEEN {startMonth} AND {endMonth} AND b1.direction={dyDirection} AND b1.voucherId IN ({manyVoucherIds}) GROUP BY SUBSTRING_INDEX(b2.subjectFullId,'/',1)) UNION (SELECT SUBSTRING_INDEX(b2.subjectFullId,'/',1) AS oneSubjectId,COUNT(DISTINCT b1.voucherId) AS voucherCount,SUM(b3.corrValue) AS sumValue,MAX(b3.corrValue) AS largeValue FROM {lockDbName}.fin_subjectentry b1 LEFT JOIN {lockDbName}.fin_accpkgsubject b2 ON b2.customerId=b1.customerId AND b2.yyyy=b1.yyyy AND b2.subjectId=b1.subjectId LEFT JOIN {lockDbName}.fin_subjectvouchercorr b3 ON b3.customerId=b1.customerId AND b3.yyyy=b1.yyyy AND b3.voucherId=b1.voucherId AND b3.serail=b1.serail AND b3.subjectId LIKE '{fxSubjectId}%' WHERE b1.customerId={lockCustomerId} AND b1.yyyy={lockYyyy} AND b1.month BETWEEN {startMonth} AND {endMonth} AND b1.direction={fxDirection} AND b1.voucherId IN ({sameVoucherIds}) GROUP BY SUBSTRING_INDEX(b2.subjectFullId,'/',1))) a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId={lockCustomerId} AND b.yyyy={lockYyyy} AND b.subjectId=a.oneSubjectId GROUP BY a.oneSubjectId ORDER BY a.oneSubjectId
#\u67E5\u8BE2\u4E0B\u7EA7\u5305\u542B\u591A\u501F\u591A\u8D37
#FIN109013=SELECT a.oneSubjectId,SUM(a.voucherCount) AS voucherCount,IFNULL(SUM(a.sumValue),0) AS sumValue,IFNULL(MAX(a.largeValue),0) AS largeValue,IFNULL(ROUND(SUM(a.sumValue)/SUM(a.voucherCount),2),0) AS avgValue,IF(-1=1,'\u501F','\u8D37') AS direction,b.subjectFullName,b.isLeaf1,b.level1 AS subjectLevel FROM ((SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',{viewSubjectLevel}),'/',-1) AS oneSubjectId,COUNT(DISTINCT voucherId) AS voucherCount,SUM(occurValue) AS sumValue,MAX(occurValue) AS largeValue FROM (SELECT voucherId,CASE WHEN direction={dyDirection} AND {dyDirection}=-1 THEN subjectId WHEN direction={fxDirection} AND drCount > 1 AND subjectId NOT IN ({subjectId}) AND {dyDirection}=-1 THEN REPLACE(creditsubjects,',','') WHEN direction={dyDirection} AND {dyDirection}=1 THEN subjectId WHEN direction={fxDirection} AND crCount > 1 AND subjectId NOT IN ({subjectId}) AND {dyDirection}=1 THEN REPLACE(debitsubjects,',','') ELSE NULL END AS subjectId,CASE WHEN direction={dyDirection} AND {dyDirection}=-1 THEN occurValue WHEN direction={fxDirection} AND drCount > 1 AND subjectId NOT IN ({subjectId}) AND {dyDirection}=-1 THEN -1*occurValue WHEN direction={dyDirection} AND {dyDirection}=1 THEN occurValue WHEN direction={fxDirection} AND crCount > 1 AND subjectId NOT IN ({subjectId}) AND {dyDirection}=1 THEN -1*occurValue ELSE 0 END AS occurValue FROM {lockDbName}.fin_subjectentry WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND month BETWEEN {startMonth} AND {endMonth} AND voucherId IN ({voucherId})) a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId={lockCustomerId} AND b.yyyy={lockYyyy} AND b.subjectId=a.subjectId WHERE a.subjectId>'' GROUP BY SUBSTRING_INDEX(b.subjectFullId,'/',{viewSubjectLevel})) UNION (SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(b2.subjectFullId,'/',{viewSubjectLevel}),'/',-1) AS oneSubjectId,COUNT(DISTINCT b1.voucherId) AS voucherCount,SUM(b3.corrValue) AS sumValue,MAX(b3.corrValue) AS largeValue FROM {lockDbName}.fin_subjectentry b1 LEFT JOIN {lockDbName}.fin_accpkgsubject b2 ON b2.customerId=b1.customerId AND b2.yyyy=b1.yyyy AND b2.subjectId=b1.subjectId LEFT JOIN {lockDbName}.fin_subjectvouchercorr b3 ON b3.customerId=b1.customerId AND b3.yyyy=b1.yyyy AND b3.voucherId=b1.voucherId AND b3.serail=b1.serail AND b3.subjectId LIKE '{fxSubjectId}%' WHERE b1.customerId={lockCustomerId} AND b1.yyyy={lockYyyy} AND b1.month BETWEEN {startMonth} AND {endMonth} AND b1.direction={dyDirection} AND b1.voucherId IN ({manyVoucherIds}) GROUP BY SUBSTRING_INDEX(b2.subjectFullId,'/',{viewSubjectLevel})) UNION (SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(b2.subjectFullId,'/',{viewSubjectLevel}),'/',-1) AS oneSubjectId,COUNT(DISTINCT b1.voucherId) AS voucherCount,SUM(b3.corrValue) AS sumValue,MAX(b3.corrValue) AS largeValue FROM {lockDbName}.fin_subjectentry b1 LEFT JOIN {lockDbName}.fin_accpkgsubject b2 ON b2.customerId=b1.customerId AND b2.yyyy=b1.yyyy AND b2.subjectId=b1.subjectId LEFT JOIN {lockDbName}.fin_subjectvouchercorr b3 ON b3.customerId=b1.customerId AND b3.yyyy=b1.yyyy AND b3.voucherId=b1.voucherId AND b3.serail=b1.serail AND b3.subjectId LIKE '{fxSubjectId}%' WHERE b1.customerId={lockCustomerId} AND b1.yyyy={lockYyyy} AND b1.month BETWEEN {startMonth} AND {endMonth} AND b1.direction={fxDirection} AND b1.voucherId IN ({sameVoucherIds}) GROUP BY SUBSTRING_INDEX(b2.subjectFullId,'/',{viewSubjectLevel}))) a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId={lockCustomerId} AND b.yyyy={lockYyyy} AND b.subjectId=a.oneSubjectId WHERE a.oneSubjectId LIKE '{viewSubject}%' GROUP BY a.oneSubjectId ORDER BY a.oneSubjectId
####\u5BF9\u5E94\u51ED\u8BC1\u5206\u6790 \u5BF9\u5E94\u51ED\u8BC1\u6C47\u603B
#\u83B7\u53D6\u6240\u6709\u591A\u501F\u591A\u8D37,\u540C\u501F\u540C\u8D37\u51ED\u8BC1\u53F7
FIN109014=SELECT GROUP_CONCAT(DISTINCT voucherId) AS voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND month >= {startMonth} AND month <= {endMonth} {voucherType}
#\u83B7\u53D6\u5206\u6790\u65B9\u5411\u4E0B\u6240\u6709\u591A\u501F\u591A\u8D37,\u540C\u501F\u540C\u8D37\u79D1\u76EE
FIN109015=SELECT {lockCustomerId} AS customerId,{lockYyyy} AS yyyy,a.subjectId,b.subjectFullName,voucherValue,b.isLeaf1,b.level1 AS subjectLevel,a.isMany,a.isSame,a.mvoucherIds,a.svoucherIds FROM (SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',{subjectLevel}),'/',-1) AS subjectId,SUM(a.occurValue) AS voucherValue,SUM(a.isMany)>0 AS isMany,SUM(a.isSame)>0 AS isSame,GROUP_CONCAT(DISTINCT a.mvoucherId) AS mvoucherIds,GROUP_CONCAT(DISTINCT a.svoucherId) AS svoucherIds FROM (SELECT subjectId,occurValue,1 AS isMany,0 AS isSame,voucherId AS mvoucherId,NULL AS svoucherId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND month >= {startMonth} AND month <= {endMonth} AND (drCount > 1 AND crCount > 1) AND direction = {fxDirection} UNION ALL SELECT subjectId,occurValue,0 AS isMany,1 AS isSame,NULL AS mvoucherId,voucherId AS svoucherId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND month >= {startMonth} AND month <= {endMonth} AND (drCount = 0 OR crCount = 0) AND direction = {fxDirection}) a INNER JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = {lockCustomerId} AND b.yyyy = {lockYyyy} AND b.subjectId = a.subjectId WHERE 1 = 1 /*START #fxSubjectId# AND a.subjectId IN ({fxSubjectId}) #fxSubjectId# END*/ GROUP BY SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',{subjectLevel}),'/',-1)) a INNER JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = {lockCustomerId} AND b.yyyy = {lockYyyy} AND b.subjectId = a.subjectId WHERE 1 = 1 AND b.level1 = {subjectLevel} ORDER BY a.subjectId
#\u83B7\u53D6\u5206\u6790\u65B9\u5411\u4E0B\u6240\u6709\u591A\u501F\u591A\u8D37,\u540C\u501F\u540C\u8D37\u79D1\u76EE\u7684\u5BF9\u5E94\u53D1\u751F\u989D
FIN109016=SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(s.subjectFullId,'/',{subjectLevel}),'/',-1) AS subjectId,SUM(a.corrValue) AS dyValue1,SUM(b.corrValue) AS dyValue2 FROM (SELECT subjectId,SUM(corrValue) AS corrValue FROM {lockDbName}.fin_subjectvouchercorr WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND month >= {startMonth} AND month <= {endMonth} AND voucherType IN ('m','s') AND direction = {fxDirection} AND voucherId IN ({fxVoucherId}) GROUP BY subjectId) a LEFT JOIN (SELECT subjectId,SUM(corrValue) AS corrValue FROM (SELECT corrSubjectId AS subjectId,SUM(corrValue) AS corrValue FROM {lockDbName}.fin_subjectvouchercorr WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND month >= {startMonth} AND month <= {endMonth} AND voucherType IN ('m','s') AND direction = {dyDirection} AND corrDirection = {fxDirection} AND voucherId IN ({mVoucherId}) GROUP BY corrSubjectId UNION ALL SELECT corrSubjectId AS subjectId,SUM(-1 * corrValue) AS corrValue FROM {lockDbName}.fin_subjectvouchercorr WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND month >= {startMonth} AND month <= {endMonth} AND voucherType IN ('m','s') AND direction = {fxDirection} AND corrDirection = {fxDirection} AND voucherId IN ({mVoucherId}) GROUP BY corrSubjectId UNION ALL SELECT corrSubjectId AS subjectId,SUM(-1 * corrValue) AS corrValue FROM {lockDbName}.fin_subjectvouchercorr WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND month >= {startMonth} AND month <= {endMonth} AND voucherType IN ('m','s') AND direction = {fxDirection} AND voucherId IN ({sVoucherId}) GROUP BY corrSubjectId) a GROUP BY a.subjectId) b ON b.subjectId = a.subjectId INNER JOIN {lockDbName}.fin_accpkgsubject s ON s.customerId = {lockCustomerId} AND s.yyyy = {lockYyyy} AND s.subjectId = a.subjectId WHERE s.level1 >= {subjectLevel} GROUP BY SUBSTRING_INDEX(s.subjectFullId,'/',{subjectLevel})
#FIN109017=SELECT a.customerId,a.yyyy,a.corrSubjectId AS dySubject,a.dyValue1,b.dyValue2,c.subjectFullName AS dySubjectNm,a.isMany,a.isSame,IFNULL(a.dyValue1=b.dyValue2,0) AS isEqual FROM (SELECT customerId,yyyy,corrSubjectId,SUM(corrValue) AS dyValue1,voucherType='M' AS isMany,voucherType='S' AS isSame FROM {lockDbName}.fin_subjectvouchercorr WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND month >= {startMonth} AND month <= {endMonth} AND voucherId IN ({fxVoucherId}) AND direction = {fxDirection} AND subjectId IN ({fxSubjectId}) GROUP BY corrSubjectId) a LEFT JOIN (SELECT subjectId,SUM(corrValue) AS dyValue2 FROM {lockDbName}.fin_subjectvouchercorr WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND month >= {startMonth} AND month <= {endMonth} AND voucherId IN ({fxVoucherId}) AND direction = {dyDirection} AND corrSubjectId IN ({fxSubjectId}) GROUP BY subjectId) b ON b.subjectId = a.corrSubjectId INNER JOIN {lockDbName}.fin_accpkgsubject c ON c.customerId = {lockCustomerId} AND c.yyyy = {lockYyyy} AND c.subjectId = a.corrSubjectId GROUP BY a.corrSubjectId ORDER BY a.corrSubjectId
FIN109017=SELECT a.customerId,a.yyyy,a.corrSubjectId AS dySubject,a.dyValue1,b.dyValue2,c.subjectFullName AS dySubjectNm,a.isMany,a.isSame,IFNULL(a.dyValue1=b.dyValue2,0) AS isEqual,a.mvoucherIds,a.svoucherIds FROM (SELECT customerId,yyyy,corrSubjectId,SUM(corrValue) AS dyValue1,SUM(voucherType='M')>0 AS isMany,SUM(voucherType='S')>0 AS isSame,GROUP_CONCAT(DISTINCT IF(voucherType='M',voucherId,NULL)) AS mvoucherIds,GROUP_CONCAT(DISTINCT IF(voucherType='S',voucherId,NULL)) AS svoucherIds FROM {lockDbName}.fin_subjectvouchercorr WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND month >= {startMonth} AND month <= {endMonth} AND voucherType IN ('m','s') AND voucherId IN ({fxVoucherId}) AND direction = {fxDirection} AND subjectId IN ({fxSubjectId}) GROUP BY corrSubjectId) a LEFT JOIN (SELECT a.subjectId,SUM(dyValue2) AS dyValue2 FROM (SELECT subjectId,SUM(corrValue) AS dyValue2 FROM {lockDbName}.fin_subjectvouchercorr WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND month >= {startMonth} AND month <= {endMonth} AND voucherType IN ('m','s') AND direction = {dyDirection} AND corrSubjectId IN ({fxSubjectId}) AND voucherId IN ({mVoucherId}) GROUP BY subjectId UNION ALL SELECT subjectId,SUM(-1 * corrValue) AS dyValue2 FROM {lockDbName}.fin_subjectvouchercorr WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND month >= {startMonth} AND month <= {endMonth} AND voucherType IN ('m','s') AND direction = {fxDirection} AND corrDirection = {fxDirection} AND corrSubjectId IN ({fxSubjectId}) AND voucherId IN ({mVoucherId}) GROUP BY subjectId UNION ALL SELECT subjectId,SUM(-1 * corrValue) AS dyValue2 FROM {lockDbName}.fin_subjectvouchercorr WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND month >= {startMonth} AND month <= {endMonth} AND voucherType IN ('m','s') AND direction = {fxDirection} AND corrSubjectId IN ({fxSubjectId}) AND voucherId IN ({sVoucherId}) GROUP BY subjectId) a GROUP BY a.subjectId) b ON b.subjectId = a.corrSubjectId INNER JOIN {lockDbName}.fin_accpkgsubject c ON c.customerId = {lockCustomerId} AND c.yyyy = {lockYyyy} AND c.subjectId = a.corrSubjectId GROUP BY a.corrSubjectId ORDER BY a.corrSubjectId
####\u5BF9\u5E94\u51ED\u8BC1\u5206\u6790\u5217\u8868
#\u5305\u542B\u5206\u6790\u79D1\u76EE,\u5BF9\u5E94\u79D1\u76EE\u7684\u51ED\u8BC1
#\u4E00\u501F\u4E00\u8D37 \u4E00\u501F\u591A\u8D37 \u4E00\u8D37\u591A\u501F \u591A\u501F\u591A\u8D37
FIN109020=SELECT GROUP_CONCAT(DISTINCT voucherId) AS voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND subjectId IN ({dySubjectId}) AND month >= {startMonth} AND month <= {endMonth} AND voucherId IN ({fxVoucherId})
#\u540C\u501F\u540C\u8D37
FIN109021=SELECT GROUP_CONCAT(DISTINCT voucherId) AS voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND subjectId IN ({dySubjectId}) AND direction = {fxDirection} AND month >= {startMonth} AND month <= {endMonth} AND voucherId IN ({fxVoucherId}) AND (drCount = 0 OR crCount = 0)
#\u5168\u90E8
FIN109022=SELECT GROUP_CONCAT(DISTINCT voucherId) AS voucherId FROM (SELECT voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND subjectId IN ({dySubjectId}) AND month >= {startMonth} AND month <= {endMonth} AND voucherId IN ({fxVoucherId}) AND (drCount >= 1 AND crCount >= 1) UNION SELECT voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND subjectId IN ({dySubjectId}) AND direction = {fxDirection} AND month >= {startMonth} AND month <= {endMonth} AND voucherId IN ({fxVoucherId}) AND (drCount = 0 OR crCount = 0)) a
#\u83B7\u53D6\u8981\u5206\u6790\u7684\u51ED\u8BC1\u5206\u5F55\u53CA\u5206\u6790\u4FE1\u606F
#FIN109023=SELECT a.autoId,a.customerId,a.yyyy,a.vchDate,a.voucherId,a.oldVoucherId,a.serail,a.typeId,a.summary,a.subjectId,a.subjectFullName,a.direction,a.occurValue,CONCAT(IFNULL(a.debitsubjects,''),',',IFNULL(a.creditsubjects,'')) AS subjectIds,CASE a.direction WHEN 1 THEN a.occurValue ELSE 0 END AS drValue,CASE a.direction WHEN -1 THEN a.occurValue ELSE 0 END AS crValue,b.corrSubject,IFNULL(c.isBalance,0) AS isBalance FROM {lockDbName}.fin_subjectentry a LEFT JOIN (SELECT a.customerId,a.yyyy,a.voucherId,a.serail,GROUP_CONCAT(CONCAT(a.corrSubjectId,':',ROUND(a.corrValue,2)) ORDER BY a.corrSubjectId) AS corrSubject FROM {lockDbName}.fin_subjectvouchercorr a WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.voucherId IN ({fxVoucherId}) GROUP BY a.customerId,a.yyyy,a.voucherId,a.serail) b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.voucherId = a.voucherId AND b.serail = a.serail LEFT JOIN (SELECT a.customerId,a.yyyy,a.voucherId,a.subjectId,a.direction,a.corrValue=b.corrValue AS isBalance FROM (SELECT customerId,yyyy,voucherId,subjectId,direction,SUM(corrValue) AS corrValue FROM {lockDbName}.fin_subjectvouchercorr a WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.voucherId IN ({fxVoucherId}) GROUP BY customerId,yyyy,voucherId,subjectId,direction) a LEFT JOIN (SELECT customerId,yyyy,voucherId,corrSubjectId,direction,SUM(corrValue) AS corrValue FROM {lockDbName}.fin_subjectvouchercorr a WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.voucherId IN ({fxVoucherId}) GROUP BY customerId,yyyy,voucherId,corrSubjectId,direction) b ON b.voucherId = a.voucherId AND b.corrSubjectId = a.subjectId AND b.direction <> a.direction) c ON c.customerId = a.customerId AND c.yyyy = a.yyyy AND c.voucherId = a.voucherId AND c.subjectId = a.subjectId AND (a.occurValue*a.direction*c.direction)>0 WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.month >= {startMonth} AND a.month <= {endMonth} AND a.voucherId IN ({fxVoucherId}) ORDER BY vchDate,voucherId,serail
#\u67E5\u8BE2\u591A\u501F\u591A\u8D37\u540C\u501F\u540C\u8D37\u51ED\u8BC1\u5206\u5F55
#FIN109023=SELECT a.autoId,a.customerId,a.yyyy,a.vchDate,a.voucherId,a.oldVoucherId,a.serail,a.typeId,a.summary,a.subjectId,a.subjectFullName,a.direction,a.occurValue,CONCAT(IFNULL(a.debitsubjects,''),',',IFNULL(a.creditsubjects,'')) AS subjectIds,CASE a.direction WHEN 1 THEN a.occurValue ELSE 0 END AS drValue,CASE a.direction WHEN -1 THEN a.occurValue ELSE 0 END AS crValue,b.corrValue,b.corrSubject FROM {lockDbName}.fin_subjectentry a LEFT JOIN (SELECT a.customerId,a.yyyy,a.voucherId,a.serail,SUM(a.corrValue) AS corrValue,GROUP_CONCAT(CONCAT(a.corrSubjectId,':',ROUND(a.corrValue,2)) ORDER BY a.corrSubjectId) AS corrSubject FROM {lockDbName}.fin_subjectvouchercorr a WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.voucherId IN ({fxVoucherId}) GROUP BY a.customerId,a.yyyy,a.voucherId,a.serail) b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.voucherId = a.voucherId AND b.serail = a.serail WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.month >= {startMonth} AND a.month <= {endMonth} AND a.voucherId IN ({fxVoucherId}) ORDER BY vchDate,voucherId,serail
#\u591A\u501F\u591A\u8D37
#FIN109023=SELECT a.autoId,a.customerId,a.yyyy,a.vchDate,a.voucherId,a.oldVoucherId,a.serail,a.typeId,a.summary,a.subjectId,a.subjectFullName,a.direction,a.occurValue,d.subjectIds,CASE a.direction WHEN 1 THEN a.occurValue ELSE 0 END AS drValue,CASE a.direction WHEN -1 THEN a.occurValue ELSE 0 END AS crValue,b.corrSubject,c.isBalance FROM {lockDbName}.fin_subjectentry a LEFT JOIN (SELECT a.customerId,a.yyyy,a.voucherId,a.serail,GROUP_CONCAT(CONCAT(a.corrDirection,':',a.corrSubjectId,'|',ROUND(a.corrValue,2)) ORDER BY a.corrSubjectId) AS corrSubject FROM {lockDbName}.fin_subjectvouchercorr a WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.voucherId IN ({fxVoucherId}) GROUP BY a.customerId,a.yyyy,a.voucherId,a.serail) b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.voucherId = a.voucherId AND b.serail = a.serail LEFT JOIN (SELECT a.voucherId,a.subjectId,a.direction,IF(a.voucherValue = IFNULL(b.fxValue,0) AND a.voucherValue = IFNULL(c.dyValue,0), '1', '0') AS isBalance FROM (SELECT voucherId,subjectId,direction,SUM(occurValue) AS voucherValue FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND month >= {startMonth} AND month <= {endMonth} AND voucherId IN ({fxVoucherId}) GROUP BY voucherId,subjectId,direction) a LEFT JOIN (SELECT voucherId,subjectId,direction,SUM(corrValue) AS fxValue FROM {lockDbName}.fin_subjectvouchercorr WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND voucherId IN ({fxVoucherId}) GROUP BY voucherId,subjectId,direction) b ON b.voucherId = a.voucherId AND b.subjectId = a.subjectId AND b.direction = a.direction LEFT JOIN (SELECT voucherId,corrSubjectId AS subjectId,direction,SUM(corrValue) AS dyValue FROM {lockDbName}.fin_subjectvouchercorr WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND voucherId IN ({fxVoucherId}) GROUP BY voucherId,corrSubjectId,direction) c ON c.voucherId = a.voucherId AND c.subjectId = a.subjectId AND c.direction <> a.direction) c ON c.voucherId = a.voucherId AND c.subjectId = a.subjectId AND c.direction = a.direction LEFT JOIN (SELECT voucherId,GROUP_CONCAT(DISTINCT CONCAT(direction,':',subjectId) ORDER BY direction DESC,subjectId) AS subjectIds FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND month >= {startMonth} AND month <= {endMonth} AND voucherId IN ({fxVoucherId}) GROUP BY voucherId) d ON d.voucherId = a.voucherId WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.month >= {startMonth} AND a.month <= {endMonth} AND a.voucherId IN ({fxVoucherId}) ORDER BY vchDate,voucherId,serail
FIN109023=SELECT a.autoId,a.customerId,a.yyyy,a.vchDate,a.voucherId,a.oldVoucherId,a.serail,a.typeId,a.summary,a.subjectId,a.subjectFullName,a.direction,a.occurValue,d.subjectIds,CASE a.direction WHEN 1 THEN a.occurValue ELSE 0 END AS drValue,CASE a.direction WHEN -1 THEN a.occurValue ELSE 0 END AS crValue,b.corrSubject,b.corrSubjectText,a.occurValue=b.corrValue AS isBalance FROM {lockDbName}.fin_subjectentry a LEFT JOIN (SELECT a.customerId,a.yyyy,a.vchDate,a.voucherId,a.serail,GROUP_CONCAT(CONCAT(a.corrDirection,':',a.corrSubjectId,'|',ROUND(a.corrValue,2)) ORDER BY a.corrSubjectId) AS corrSubject,GROUP_CONCAT(CONCAT(IF(a.corrDirection=1,'\u501F','\u8D37'),a.corrSubjectId,' : ',ROUND(a.corrValue,2)) ORDER BY a.corrSubjectId SEPARATOR '; ') AS corrSubjectText,SUM(a.corrValue) AS corrValue FROM {lockDbName}.fin_subjectvouchercorr a WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.month >= {startMonth} AND a.month <= {endMonth} AND a.voucherType IN ('m','s') AND a.voucherId IN ({fxVoucherId}) GROUP BY a.customerId,a.yyyy,a.vchDate,a.voucherId,a.serail) b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.vchDate = a.vchDate AND b.voucherId = a.voucherId AND b.serail = a.serail LEFT JOIN (SELECT voucherId,GROUP_CONCAT(DISTINCT CONCAT(direction,':',subjectId) ORDER BY direction DESC,subjectId) AS subjectIds FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND month >= {startMonth} AND month <= {endMonth} AND voucherId IN ({fxVoucherId}) GROUP BY voucherId) d ON d.voucherId = a.voucherId WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.month >= {startMonth} AND a.month <= {endMonth} AND a.voucherId IN ({fxVoucherId}) ORDER BY vchDate,voucherId,serail
#\u540C\u501F\u540C\u8D37
#FIN109024=SELECT a.autoId,a.customerId,a.yyyy,a.vchDate,a.voucherId,a.oldVoucherId,a.serail,a.typeId,a.summary,a.subjectId,a.subjectFullName,a.direction,a.occurValue,d.subjectIds,CASE a.direction WHEN 1 THEN a.occurValue ELSE 0 END AS drValue,CASE a.direction WHEN -1 THEN a.occurValue ELSE 0 END AS crValue,b.corrSubject,c.isBalance FROM {lockDbName}.fin_subjectentry a LEFT JOIN (SELECT a.customerId,a.yyyy,a.voucherId,a.serail,GROUP_CONCAT(CONCAT(a.corrDirection,':',a.corrSubjectId,'|',ROUND(a.corrValue,2)) ORDER BY a.corrSubjectId) AS corrSubject FROM {lockDbName}.fin_subjectvouchercorr a WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.voucherId IN ({fxVoucherId}) GROUP BY a.customerId,a.yyyy,a.voucherId,a.serail) b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.voucherId = a.voucherId AND b.serail = a.serail LEFT JOIN (SELECT a.voucherId,a.subjectId,a.direction,IF(a.voucherValue = IFNULL(b.fxValue,0) AND a.voucherValue = IFNULL(c.dyValue,0), '1', '0') AS isBalance FROM (SELECT voucherId,subjectId,direction,SUM(occurValue) AS voucherValue FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND month >= {startMonth} AND month <= {endMonth} AND voucherId IN ({fxVoucherId}) GROUP BY voucherId,subjectId,direction) a LEFT JOIN (SELECT voucherId,subjectId,direction,SUM(corrValue) AS fxValue FROM {lockDbName}.fin_subjectvouchercorr WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND voucherId IN ({fxVoucherId}) GROUP BY voucherId,subjectId,direction) b ON b.voucherId = a.voucherId AND b.subjectId = a.subjectId AND b.direction = a.direction LEFT JOIN (SELECT voucherId,corrSubjectId AS subjectId,direction,SUM(-1 * corrValue) AS dyValue FROM {lockDbName}.fin_subjectvouchercorr WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND voucherId IN ({fxVoucherId}) GROUP BY voucherId,corrSubjectId,direction) c ON c.voucherId = a.voucherId AND c.subjectId = a.subjectId AND c.direction = a.direction) c ON c.voucherId = a.voucherId AND c.subjectId = a.subjectId AND c.direction = a.direction LEFT JOIN (SELECT voucherId,GROUP_CONCAT(DISTINCT CONCAT(direction,':',subjectId) ORDER BY direction DESC,subjectId) AS subjectIds FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND month >= {startMonth} AND month <= {endMonth} AND voucherId IN ({fxVoucherId}) GROUP BY voucherId) d ON d.voucherId = a.voucherId WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.month >= {startMonth} AND a.month <= {endMonth} AND a.voucherId IN ({fxVoucherId}) ORDER BY vchDate,voucherId,serail
FIN109024=SELECT a.autoId,a.customerId,a.yyyy,a.vchDate,a.voucherId,a.oldVoucherId,a.serail,a.typeId,a.summary,a.subjectId,a.subjectFullName,a.direction,a.occurValue,d.subjectIds,CASE a.direction WHEN 1 THEN a.occurValue ELSE 0 END AS drValue,CASE a.direction WHEN -1 THEN a.occurValue ELSE 0 END AS crValue,b.corrSubject,a.occurValue=b.corrValue AS isBalance FROM {lockDbName}.fin_subjectentry a LEFT JOIN (SELECT a.customerId,a.yyyy,a.voucherId,a.serail,GROUP_CONCAT(CONCAT(a.corrDirection,':',a.corrSubjectId,'|',ROUND(a.corrValue,2)) ORDER BY a.corrSubjectId) AS corrSubject,SUM(a.corrValue) AS corrValue FROM {lockDbName}.fin_subjectvouchercorr a WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.voucherType IN ('m','s') AND a.voucherId IN ({fxVoucherId}) GROUP BY a.customerId,a.yyyy,a.voucherId,a.serail) b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.voucherId = a.voucherId AND b.serail = a.serail LEFT JOIN (SELECT voucherId,GROUP_CONCAT(DISTINCT CONCAT(direction,':',subjectId) ORDER BY direction DESC,subjectId) AS subjectIds FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND month >= {startMonth} AND month <= {endMonth} AND voucherId IN ({fxVoucherId}) GROUP BY voucherId) d ON d.voucherId = a.voucherId WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.month >= {startMonth} AND a.month <= {endMonth} AND a.voucherId IN ({fxVoucherId}) ORDER BY vchDate,voucherId,serail
#\u67E5\u8BE2\u51ED\u8BC1(\u4E0D\u542B\u5206\u6790\u6570\u636E)
FIN109025=SELECT autoId,customerId,yyyy,voucherId,oldVoucherId,serail,vchDate,typeId,summary,subjectId,subjectFullName,CASE WHEN direction = 1 THEN occurValue ELSE 0 END AS drValue,CASE WHEN direction = -1 THEN occurValue ELSE 0 END AS crValue FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND month >= {startMonth} AND month <= {endMonth} AND voucherId IN ({fxVoucherId}) ORDER BY vchDate, voucherId, serail
#\u591A\u501F\u591A\u8D37\u5BF9\u5E94\u91D1\u989D
FIN109026=SELECT SUM(corrValue) AS dyValue FROM {lockDbName}.fin_subjectvouchercorr WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND voucherType IN ('m','s') AND voucherId = {voucherId} AND direction != {direction} AND corrSubjectId LIKE '{subjectId}%'
#\u540C\u501F\u540C\u8D37\u5BF9\u5E94\u91D1\u989D
FIN109027=SELECT SUM(-1 * corrValue) AS dyValue FROM {lockDbName}.fin_subjectvouchercorr WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND voucherType IN ('m','s') AND voucherId = {voucherId} AND serail != {serail} AND corrSubjectId LIKE '{subjectId}%'
#\u4FDD\u5B58\u5206\u6790\u7684\u6821\u9A8C
#FIN109030=SELECT a.voucherId,a.vchDate,a.oldVoucherId,a.subjectId,a.subjectFullName,a.dyValue1,b.dyValue2 FROM (SELECT voucherId,vchDate,oldVoucherId,subjectId,subjectFullName,SUM(occurValue) AS dyValue1 FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND month >= {startMonth} AND month <= {endMonth} AND direction = {fxDirection} AND voucherId = {voucherId} AND subjectId LIKE '{fxSubjectId}%' GROUP BY customerId,yyyy,voucherId,subjectId) a LEFT JOIN (SELECT voucherId,subjectId,SUM(corrValue) AS dyValue2 FROM {lockDbName}.fin_subjectvouchercorr WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND month >= {startMonth} AND month <= {endMonth} AND direction = {fxDirection} AND voucherId IN ({voucherId}) GROUP BY customerId,yyyy,voucherId,subjectId) b ON b.voucherId = a.voucherId AND b.subjectId = a.subjectId WHERE a.dyValue1 <> 0 AND a.dyValue1 <> b.dyValue2
FIN109030=SELECT a.voucherId,a.vchDate,a.oldVoucherId,a.subjectId,a.subjectFullName,a.dyValue1,b.dyValue2 FROM (SELECT voucherId,vchDate,oldVoucherId,serail,subjectId,subjectFullName,direction*occurValue AS dyValue1 FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND month >= {startMonth} AND month <= {endMonth} AND voucherId = {voucherId} AND serail = {serail}) a LEFT JOIN (SELECT voucherId,serail,SUM(direction*corrValue) AS dyValue2 FROM {lockDbName}.fin_subjectvouchercorr WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND month >= {startMonth} AND month <= {endMonth} AND voucherType IN ('m','s') AND voucherId = {voucherId} AND serail = {serail} GROUP BY customerId,yyyy,voucherId,serail) b ON b.voucherId = a.voucherId AND b.serail = a.serail WHERE a.dyValue1 <> 0 AND b.dyValue2 <> 0 AND a.dyValue1 <> b.dyValue2
#\u83B7\u53D6\u5BF9\u65B9\u79D1\u76EE
FIN109031=SELECT GROUP_CONCAT(DISTINCT SUBSTRING_INDEX(a.subjectFullName,'/',1) ORDER BY a.subjectId) AS firstName,GROUP_CONCAT(DISTINCT a.subjectFullName ORDER BY a.subjectId) as lastName,GROUP_CONCAT(DISTINCT CONCAT(a.subjectFullName, ':', round(b.corrValue,2)) ORDER BY a.subjectId) AS oppositeSubjectValue FROM {lockDbName}.fin_accpkgsubject a inner join (SELECT DISTINCT customerId,yyyy,corrSubjectId,sum(corrValue) as corrValue FROM {lockDbName}.fin_subjectvouchercorr WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND month >= {startMonth} AND month <= {endMonth} AND voucherType IN ('m','s','r') AND voucherId = {voucherId} AND serail = {serail} group by corrSubjectId) b ON a.customerId = b.customerId AND a.yyyy = b.yyyy AND a.subjectId = b.corrSubjectId  WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} 
FIN109032=SELECT SUBSTRING_INDEX(a.subjectFullName, '/', 1) as topSubjectName,round(sum(b.corrValue), 2) AS oppositeTopValue FROM {lockDbName}.fin_accpkgsubject a inner join (SELECT DISTINCT customerId,yyyy,corrSubjectId,sum(corrValue) as corrValue FROM {lockDbName}.fin_subjectvouchercorr WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND month >= {startMonth} AND month <= {endMonth} AND voucherType IN ('m','s','r') AND voucherId = {voucherId} AND serail = {serail} group by corrSubjectId) b ON a.customerId = b.customerId AND a.yyyy = b.yyyy AND a.subjectId = b.corrSubjectId  WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} group by SUBSTRING_INDEX(a.subjectFullId, '/', 1) ORDER BY a.subjectId
####\u4E00\u952E\u63A8\u8350\u5206\u6790
#\u67E5\u8BE2\u6240\u6709\u4E00\u822C\u51ED\u8BC1(\u4E00\u501F\u6216\u4E00\u8D37)
FIN109034=SELECT customerId,yyyy,month,voucherId,oldVoucherId,vchDate,serail,typeId,subjectId,direction,occurValue FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND month = {month} AND voucherId NOT IN ({voucherId}) AND ((drCount = 1 AND crCount >= 1) OR (drCount >= 1 AND crCount = 1)) ORDER BY vchDate,voucherId,serail
#\u67E5\u8BE2\u6240\u6709\u591A\u501F\u591A\u8D37\u51ED\u8BC1
FIN109035=SELECT customerId,yyyy,month,voucherId,oldVoucherId,vchDate,serail,typeId,subjectId,direction,occurValue FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND month = {month} AND voucherId NOT IN ({voucherId}) AND (drCount > 1 AND crCount > 1) ORDER BY vchDate,voucherId,serail
#\u67E5\u8BE2\u6240\u6709\u540C\u501F\u540C\u8D37\u51ED\u8BC1
FIN109036=SELECT customerId,yyyy,month,voucherId,oldVoucherId,vchDate,serail,typeId,subjectId,direction,occurValue FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND month = {month} AND voucherId NOT IN ({voucherId}) AND (drCount = 0 OR crCount = 0) ORDER BY vchDate,voucherId,serail
#\u67E5\u8BE2\u672C\u5E74\u5229\u6DA6\u79D1\u76EE
FIN109037=SELECT subjectId FROM {lockDbName}.fin_accpkgsubject WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND subjectName = '{subjectName}'
#\u67E5\u8BE2\u6240\u6709\u5305\u542B\u672C\u5E74\u5229\u6DA6\u51ED\u8BC1
FIN109038=SELECT GROUP_CONCAT(DISTINCT voucherId) AS voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND month = {month} AND subjectId IN ({subjectId}) AND ((drCount > 1 AND crCount > 1) OR (drCount = 0 OR crCount = 0))
#\u6309\u51ED\u8BC1\u53F7\u67E5\u8BE2
FIN109039=SELECT customerId,yyyy,month,voucherId,oldVoucherId,vchDate,serail,typeId,subjectId,direction,occurValue,CASE WHEN subjectId IN ({subjectId}) THEN 1 ELSE 0 END AS isSpecial FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND voucherId IN ({voucherId}) ORDER BY voucherId,serail
#\u5173\u8054\u65B9\u4EA4\u6613\u5206\u6790
FIN109040=SELECT '0' AS type,a.autoId,a.customerId,a.yyyy,a.vchDate,a.voucherId,a.oldVoucherId,a.serail,a.typeId,a.summary,a.subjectId,a.subjectFullName,a.direction,a.occurValue,d.subjectIds,CASE a.direction WHEN 1 THEN a.occurValue ELSE 0 END AS drValue,CASE a.direction WHEN -1 THEN a.occurValue ELSE 0 END AS crValue,b.corrSubject,a.occurValue=b.corrValue AS isBalance FROM {lockDbName}.fin_subjectentry a LEFT JOIN (SELECT a.customerId,a.yyyy,a.voucherId,a.serail,GROUP_CONCAT(CONCAT(a.corrDirection,':',a.corrSubjectId,'|',ROUND(a.corrValue,2)) ORDER BY a.corrSubjectId) AS corrSubject,SUM(a.corrValue) AS corrValue FROM {lockDbName}.fin_subjectvouchercorr a WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.voucherType IN ('m','s','r') AND CONCAT(a.vchDate,{finSplit1},a.oldVoucherId,{finSplit1},a.typeId) IN ({fxVoucherId}) GROUP BY a.customerId,a.yyyy,a.voucherId,a.serail) b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.voucherId = a.voucherId AND b.serail = a.serail LEFT JOIN (SELECT voucherId,GROUP_CONCAT(DISTINCT CONCAT(direction,':',subjectId) ORDER BY direction DESC,subjectId) AS subjectIds FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND CONCAT(vchDate,{finSplit1},oldVoucherId,{finSplit1},typeId) IN ({fxVoucherId}) GROUP BY voucherId) d ON d.voucherId = a.voucherId WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND CONCAT(a.vchDate,{finSplit1},a.oldVoucherId,{finSplit1},a.typeId) IN ({fxVoucherId}) ORDER BY vchDate,voucherId,serail
#\u5173\u8054\u65B9\u4EA4\u6613\u5206\u6790\uFF08\u663E\u793A\u6838\u7B97\uFF09
FIN109041=SELECT * from (SELECT '0' AS type,a.autoId,a.customerId,a.yyyy,a.vchDate,a.voucherId,a.oldVoucherId,a.serail,a.typeId,a.summary,a.subjectId,a.subjectFullName,a.direction,a.occurValue,d.subjectIds,CASE a.direction WHEN 1 THEN a.occurValue ELSE 0 END AS drValue,CASE a.direction WHEN -1 THEN a.occurValue ELSE 0 END AS crValue,b.corrSubject,a.occurValue=b.corrValue AS isBalance FROM {lockDbName}.fin_subjectentry a LEFT JOIN (SELECT a.customerId,a.yyyy,a.voucherId,a.serail,GROUP_CONCAT(CONCAT(a.corrDirection,':',a.corrSubjectId,'|',ROUND(a.corrValue,2)) ORDER BY a.corrSubjectId) AS corrSubject,SUM(a.corrValue) AS corrValue FROM {lockDbName}.fin_subjectvouchercorr a WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.voucherType IN ('m','s','r') AND CONCAT(a.vchDate,{finSplit1},a.oldVoucherId,{finSplit1},a.typeId) IN ({fxVoucherId}) GROUP BY a.customerId,a.yyyy,a.voucherId,a.serail) b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.voucherId = a.voucherId AND b.serail = a.serail LEFT JOIN (SELECT voucherId,GROUP_CONCAT(DISTINCT CONCAT(direction,':',subjectId) ORDER BY direction DESC,subjectId) AS subjectIds FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND CONCAT(vchDate,{finSplit1},oldVoucherId,{finSplit1},typeId) IN ({fxVoucherId}) GROUP BY voucherId) d ON d.voucherId = a.voucherId WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND CONCAT(a.vchDate,{finSplit1},a.oldVoucherId,{finSplit1},a.typeId) IN ({fxVoucherId}) union all SELECT '1' AS type,a.autoId,a.customerId,a.yyyy,a.vchDate,a.voucherId,a.oldVoucherId,CONCAT(a.serail,'-\u6838\u7B97'),a.typeId,a.summary,a.assItemId as subjectId,a.assTotalName as subjectFullName,a.direction,a.occurValue,'' as subjectIds,CASE a.direction WHEN 1 THEN a.occurValue ELSE 0 END AS drValue,CASE a.direction WHEN -1 THEN a.occurValue ELSE 0 END AS crValue,'' as corrSubject,'' AS isBalance FROM {lockDbName}.fin_assitementry a where a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND CONCAT(a.vchDate,{finSplit1},a.oldVoucherId,{finSplit1},a.typeId) IN ({fxVoucherId})) a ORDER BY vchDate,voucherId,serail
#\u67E5\u8BE2\u5173\u8054\u65B9\u4EA4\u6613\u5206\u6790\u8FC7\u7684\u51ED\u8BC1
FIN109042=SELECT IFNULL(GROUP_CONCAT(DISTINCT voucherId),'') AS voucherId FROM {lockDbName}.fin_subjectvouchercorr a WHERE a.customerId = {lockCustomerId} AND yyyy={lockYyyy} AND month >= {startMonth} AND month <= {endMonth} AND subjectId IN ({subjectId}) AND direction={direction} AND voucherType = '{voucherType}'
#\u5173\u8054\u65B9\u5BF9\u8D26\u79D1\u76EE\u6C47\u603B
FIN109043=SELECT a.customerId,a.yyyy,a.oneSubjectId,b.subjectFullName,c.sumValue,a.voucherCount,ROUND(c.sumValue/a.voucherCount,2) AS avgValue,a.largeValue,b.isLeaf1,b.level1 AS subjectLevel,a.voucherKey FROM (SELECT a.customerId,a.yyyy,SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',{subjectLevel}),'/',-1) AS oneSubjectId,COUNT(DISTINCT a.voucherId) AS voucherCount,MAX(ABS(a.occurValue)) AS largeValue,GROUP_CONCAT(DISTINCT CONCAT(vchDate,'{finSplit1}',oldVoucherId,'{finSplit1}',typeId) SEPARATOR '{finSplit2}') AS voucherKey FROM {lockDbName}.fin_subjectentry a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.subjectId = a.subjectId WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.month >= {startMonth} AND a.month <= {endMonth} AND a.direction = {dyDirection} AND a.voucherId  IN ({fxVoucherId}) /*START #dySubjectId# AND a.subjectId IN ({dySubjectId}) #dySubjectId# END*/ GROUP BY SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',{subjectLevel}),'/',-1)) a INNER JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.subjectId = a.oneSubjectId LEFT JOIN (SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',{subjectLevel}),'/',-1) AS subjectId,SUM(a.corrValue) AS sumValue FROM {lockDbName}.fin_subjectvouchercorr a INNER JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.subjectId = a.corrSubjectId WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.month >= {startMonth} AND a.month <= {endMonth} AND a.voucherType IN ('m','s','r') AND a.voucherId IN ({fxVoucherId}) AND a.subjectId IN ({fxSubjectId}) AND a.direction = {fxDirection} GROUP BY SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',{subjectLevel}),'/',-1)) c ON c.subjectId = a.oneSubjectId WHERE 1 = 1 AND b.level1 = {subjectLevel} ORDER BY a.oneSubjectId
#\u67E5\u8BE2\u5173\u8054\u65B9\u4EA4\u6613\u5206\u6790\u8FC7\u7684\u51ED\u8BC1
FIN109044=SELECT GROUP_CONCAT(DISTINCT CONCAT(vchDate,'{finSplit1}',oldVoucherId,'{finSplit1}',typeId) SEPARATOR '{finSplit2}') AS voucherKey FROM {lockDbName}.fin_subjectvouchercorr a WHERE a.customerId = {lockCustomerId} AND yyyy={lockYyyy} AND month >= {startMonth} AND month <= {endMonth} AND subjectId IN ({subjectId}) AND direction={direction} AND voucherType = '{voucherType}'
#\u67E5\u8BE2\u6240\u6709\u5B50\u96C6\u6838\u7B97
FIN109045=SELECT GROUP_CONCAT(DISTINCT CONCAT('\"',a.assItemId,'\"')) AS assItemIds FROM {lockDbName}.fin_assitem a WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} /*START #subjectId# AND a.subjectId IN ({subjectId}) #subjectId# END*/ AND a.assItemFullId REGEXP '{assItemId}'
#\u501F\u65B9\u79D1\u76EE\u5BF9\u65B9\u79D1\u76EE\u5217\u8868(\u4E00\u501F,\u4E00\u8D37,\u591A\u501F\u591A\u8D37,\u540C\u501F\u540C\u8D37)
FIN109046=SELECT s2.customerId,s2.yyyy,SUBSTRING_INDEX(SUBSTRING_INDEX(s2.subjectFullId,'/',{subjectLevel}),'/',-1) AS oneSubjectId,SUBSTRING_INDEX(s2.subjectFullName,'/',{subjectLevel}) AS subjectFullName,a.direction,ROUND(SUM(a.occurValue),2) AS sumValue,COUNT(DISTINCT a.voucherId) AS voucherCount,ROUND(SUM(ABS(a.occurValue))/COUNT(DISTINCT a.voucherId),2) AS avgValue,ROUND(MAX(ABS(a.occurValue)),2) AS largeValue,GROUP_CONCAT(DISTINCT a.voucherId) AS voucherIds,s3.level1 AS subjectLevel,s3.isLeaf1 FROM (SELECT debitsubjects AS subjectId,subjectId AS corrSubjectId,'-1' AS direction,occurValue,voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND month>={startMonth} AND month<={endMonth} AND direction=-1 AND voucherId IN ({voucherId1}) /*START #dySubjectId# AND subjectId IN ({dySubjectId}) #dySubjectId# END*/ UNION ALL SELECT subjectId,creditsubjects AS corrSubjectId,'-1' AS direction,occurValue,voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND month>={startMonth} AND month<={endMonth} AND direction=1 AND subjectId IN ({fxSubjectId}) AND voucherId IN ({voucherId2}) /*START #dySubjectId# AND creditsubjects IN ({dySubjectId}) #dySubjectId# END*/ UNION ALL SELECT subjectId,corrSubjectId,corrDirection AS direction,corrValue AS occurValue,voucherId FROM {lockDbName}.fin_subjectvouchercorr WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND month>={startMonth} AND month<={endMonth} AND voucherType IN ('m','s') AND direction=1 AND subjectId IN ({fxSubjectId}) /*START #dySubjectId# AND corrSubjectId IN ({dySubjectId}) #dySubjectId# END*/) a INNER JOIN {lockDbName}.fin_accpkgsubject s2 ON s2.customerId={lockCustomerId} AND s2.yyyy={lockYyyy} AND s2.subjectId=a.corrSubjectId INNER JOIN {lockDbName}.fin_accpkgsubject s3 ON s3.customerId={lockCustomerId} AND s3.yyyy={lockYyyy} AND s3.subjectId=SUBSTRING_INDEX(SUBSTRING_INDEX(s2.subjectFullId,'/',{subjectLevel}),'/',-1) GROUP BY SUBSTRING_INDEX(s2.subjectFullId,'/',{subjectLevel}) ORDER BY s2.subjectId
#\u8D37\u65B9\u79D1\u76EE\u5BF9\u65B9\u79D1\u76EE\u5217\u8868(\u4E00\u501F,\u4E00\u8D37,\u591A\u501F\u591A\u8D37,\u540C\u501F\u540C\u8D37)
FIN109047=SELECT s2.customerId,s2.yyyy,SUBSTRING_INDEX(SUBSTRING_INDEX(s2.subjectFullId,'/',{subjectLevel}),'/',-1) AS oneSubjectId,SUBSTRING_INDEX(s2.subjectFullName,'/',{subjectLevel}) AS subjectFullName,a.direction,ROUND(SUM(a.occurValue),2) AS sumValue,COUNT(DISTINCT a.voucherId) AS voucherCount,ROUND(SUM(ABS(a.occurValue))/COUNT(DISTINCT a.voucherId),2) AS avgValue,ROUND(MAX(ABS(a.occurValue)),2) AS largeValue,GROUP_CONCAT(DISTINCT a.voucherId) AS voucherIds,s3.level1 AS subjectLevel,s3.isLeaf1 FROM (SELECT creditsubjects AS subjectId,subjectId AS corrSubjectId,'1' AS direction,occurValue,voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND month>={startMonth} AND month<={endMonth} AND direction=1 AND voucherId IN ({voucherId1}) /*START #dySubjectId# AND subjectId IN ({dySubjectId}) #dySubjectId# END*/ UNION ALL SELECT subjectId,debitsubjects AS corrSubjectId,'1' AS direction,occurValue,voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND month>={startMonth} AND month<={endMonth} AND direction=-1 AND subjectId IN ({fxSubjectId}) AND voucherId IN ({voucherId2}) /*START #dySubjectId# AND creditsubjects IN ({dySubjectId}) #dySubjectId# END*/ UNION ALL SELECT subjectId,corrSubjectId,corrDirection AS direction,corrValue AS occurValue,voucherId FROM {lockDbName}.fin_subjectvouchercorr WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND month>={startMonth} AND month<={endMonth} AND voucherType IN ('m','s') AND direction=-1 AND subjectId IN ({fxSubjectId}) /*START #dySubjectId# AND corrSubjectId IN ({dySubjectId}) #dySubjectId# END*/) a INNER JOIN {lockDbName}.fin_accpkgsubject s2 ON s2.customerId={lockCustomerId} AND s2.yyyy={lockYyyy} AND s2.subjectId=a.corrSubjectId INNER JOIN {lockDbName}.fin_accpkgsubject s3 ON s3.customerId={lockCustomerId} AND s3.yyyy={lockYyyy} AND s3.subjectId=SUBSTRING_INDEX(SUBSTRING_INDEX(s2.subjectFullId,'/',{subjectLevel}),'/',-1) GROUP BY SUBSTRING_INDEX(s2.subjectFullId,'/',{subjectLevel}) ORDER BY s2.subjectId
#\u501F\u65B9\u79D1\u76EE\u5BF9\u65B9\u79D1\u76EE\u5217\u8868(\u4E00\u501F,\u4E00\u8D37)
FIN109048=SELECT s2.customerId,s2.yyyy,SUBSTRING_INDEX(SUBSTRING_INDEX(s2.subjectFullId,'/',{subjectLevel}),'/',-1) AS oneSubjectId,SUBSTRING_INDEX(s2.subjectFullName,'/',{subjectLevel}) AS subjectFullName,a.direction,ROUND(SUM(a.occurValue),2) AS sumValue,COUNT(DISTINCT a.voucherId) AS voucherCount,ROUND(SUM(ABS(a.occurValue))/COUNT(DISTINCT a.voucherId),2) AS avgValue,ROUND(MAX(ABS(a.occurValue)),2) AS largeValue,GROUP_CONCAT(DISTINCT a.voucherId) AS voucherIds,s3.level1 AS subjectLevel,s3.isLeaf1 FROM (SELECT debitsubjects AS subjectId,subjectId AS corrSubjectId,'-1' AS direction,occurValue,voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND month>={startMonth} AND month<={endMonth} AND direction=-1 AND voucherId IN ({voucherId1}) /*START #dySubjectId# AND subjectId IN ({dySubjectId}) #dySubjectId# END*/ UNION ALL SELECT subjectId,creditsubjects AS corrSubjectId,'-1' AS direction,occurValue,voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND month>={startMonth} AND month<={endMonth} AND direction=1 AND subjectId IN ({fxSubjectId}) AND voucherId IN ({voucherId2}) /*START #dySubjectId# AND creditsubjects IN ({dySubjectId}) #dySubjectId# END*/) a INNER JOIN {lockDbName}.fin_accpkgsubject s2 ON s2.customerId={lockCustomerId} AND s2.yyyy={lockYyyy} AND s2.subjectId=a.corrSubjectId INNER JOIN {lockDbName}.fin_accpkgsubject s3 ON s3.customerId={lockCustomerId} AND s3.yyyy={lockYyyy} AND s3.subjectId=SUBSTRING_INDEX(SUBSTRING_INDEX(s2.subjectFullId,'/',{subjectLevel}),'/',-1) GROUP BY SUBSTRING_INDEX(s2.subjectFullId,'/',{subjectLevel}) ORDER BY s2.subjectId
#\u8D37\u65B9\u79D1\u76EE\u5BF9\u65B9\u79D1\u76EE\u5217\u8868(\u4E00\u501F,\u4E00\u8D37)
FIN109049=SELECT s2.customerId,s2.yyyy,SUBSTRING_INDEX(SUBSTRING_INDEX(s2.subjectFullId,'/',{subjectLevel}),'/',-1) AS oneSubjectId,SUBSTRING_INDEX(s2.subjectFullName,'/',{subjectLevel}) AS subjectFullName,a.direction,ROUND(SUM(a.occurValue),2) AS sumValue,COUNT(DISTINCT a.voucherId) AS voucherCount,ROUND(SUM(ABS(a.occurValue))/COUNT(DISTINCT a.voucherId),2) AS avgValue,ROUND(MAX(ABS(a.occurValue)),2) AS largeValue,GROUP_CONCAT(DISTINCT a.voucherId) AS voucherIds,s3.level1 AS subjectLevel,s3.isLeaf1 FROM (SELECT creditsubjects AS subjectId,subjectId AS corrSubjectId,'1' AS direction,occurValue,voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND month>={startMonth} AND month<={endMonth} AND direction=1 AND voucherId IN ({voucherId1}) /*START #dySubjectId# AND subjectId IN ({dySubjectId}) #dySubjectId# END*/ UNION ALL SELECT subjectId,debitsubjects AS corrSubjectId,'1' AS direction,occurValue,voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND month>={startMonth} AND month<={endMonth} AND direction=-1 AND subjectId IN ({fxSubjectId}) AND voucherId IN ({voucherId2}) /*START #dySubjectId# AND creditsubjects IN ({dySubjectId}) #dySubjectId# END*/) a INNER JOIN {lockDbName}.fin_accpkgsubject s2 ON s2.customerId={lockCustomerId} AND s2.yyyy={lockYyyy} AND s2.subjectId=a.corrSubjectId INNER JOIN {lockDbName}.fin_accpkgsubject s3 ON s3.customerId={lockCustomerId} AND s3.yyyy={lockYyyy} AND s3.subjectId=SUBSTRING_INDEX(SUBSTRING_INDEX(s2.subjectFullId,'/',{subjectLevel}),'/',-1) GROUP BY SUBSTRING_INDEX(s2.subjectFullId,'/',{subjectLevel}) ORDER BY s2.subjectId
#\u501F\u65B9\u79D1\u76EE\u5BF9\u65B9\u79D1\u76EE\u5217\u8868(\u591A\u501F\u591A\u8D37)
FIN109050=SELECT s.customerId,s.yyyy,a.oneSubjectId,s.subjectFullName,ROUND(IFNULL(b.sumValue,0),2) AS sumValue,IFNULL(a.voucherCount,0) AS voucherCount,ROUND(IFNULL(b.avgValue,0),2) AS avgValue,ROUND(IFNULL(b.largeValue,0),2) AS largeValue,IFNULL(a.voucherIds,0) AS voucherIds,s.level1 AS subjectLevel,s.isLeaf1 FROM (SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',{subjectLevel}),'/',-1) AS oneSubjectId,COUNT(DISTINCT voucherId) AS voucherCount,GROUP_CONCAT(DISTINCT voucherId) AS voucherIds FROM {lockDbName}.fin_subjectentry a INNER JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId=a.customerId AND b.yyyy=a.yyyy AND b.subjectId=a.subjectId WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.month>={startMonth} AND a.month<={endMonth} AND a.voucherId IN ({fxVoucherId}) /*START #dySubjectId# AND a.subjectId IN ({dySubjectId}) #dySubjectId# END*/ AND a.drCount>1 AND a.crCount>1 GROUP BY SUBSTRING_INDEX(b.subjectFullId,'/',{subjectLevel})) a LEFT JOIN (SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(s2.subjectFullId,'/',{subjectLevel}),'/',-1) AS oneSubjectId,SUBSTRING_INDEX(s2.subjectFullName,'/',{subjectLevel}) AS subjectFullName,a.direction,SUM(a.occurValue) AS sumValue,SUM(ABS(a.occurValue))/COUNT(DISTINCT a.voucherId) AS avgValue,MAX(ABS(a.occurValue)) AS largeValue FROM (SELECT subjectId,corrSubjectId,corrDirection AS direction,corrValue AS occurValue,voucherId FROM  {lockDbName}.fin_subjectvouchercorr WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND month>={startMonth} AND month<={endMonth} AND voucherType = 'm' AND direction=1 AND subjectId IN ({fxSubjectId}) /*START #dySubjectId# AND corrSubjectId IN ({dySubjectId}) #dySubjectId# END*/) a INNER JOIN {lockDbName}.fin_accpkgsubject s2 ON s2.customerId={lockCustomerId} AND s2.yyyy={lockYyyy} AND s2.subjectId=a.corrSubjectId GROUP BY SUBSTRING_INDEX(s2.subjectFullId,'/',{subjectLevel})) b ON b.oneSubjectId=a.oneSubjectId INNER JOIN {lockDbName}.fin_accpkgsubject s ON s.customerId={lockCustomerId} AND s.yyyy={lockYyyy} AND s.subjectId=a.oneSubjectId ORDER BY a.oneSubjectId
#\u8D37\u65B9\u79D1\u76EE\u5BF9\u65B9\u79D1\u76EE\u5217\u8868(\u591A\u501F\u591A\u8D37)
FIN109051=SELECT s.customerId,s.yyyy,a.oneSubjectId,s.subjectFullName,ROUND(IFNULL(b.sumValue,0),2) AS sumValue,IFNULL(a.voucherCount,0) AS voucherCount,ROUND(IFNULL(b.avgValue,0),2) AS avgValue,ROUND(IFNULL(b.largeValue,0),2) AS largeValue,IFNULL(a.voucherIds,0) AS voucherIds,s.level1 AS subjectLevel,s.isLeaf1 FROM (SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',{subjectLevel}),'/',-1) AS oneSubjectId,COUNT(DISTINCT voucherId) AS voucherCount,GROUP_CONCAT(DISTINCT voucherId) AS voucherIds FROM {lockDbName}.fin_subjectentry a INNER JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId=a.customerId AND b.yyyy=a.yyyy AND b.subjectId=a.subjectId WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.month>={startMonth} AND a.month<={endMonth} AND a.voucherId IN ({fxVoucherId}) /*START #dySubjectId# AND a.subjectId IN ({dySubjectId}) #dySubjectId# END*/ AND a.drCount>1 AND a.crCount>1 GROUP BY SUBSTRING_INDEX(b.subjectFullId,'/',{subjectLevel})) a LEFT JOIN (SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(s2.subjectFullId,'/',{subjectLevel}),'/',-1) AS oneSubjectId,SUBSTRING_INDEX(s2.subjectFullName,'/',{subjectLevel}) AS subjectFullName,a.direction,SUM(a.occurValue) AS sumValue,SUM(ABS(a.occurValue))/COUNT(DISTINCT a.voucherId) AS avgValue,MAX(ABS(a.occurValue)) AS largeValue FROM (SELECT subjectId,corrSubjectId,corrDirection AS direction,corrValue AS occurValue,voucherId FROM  {lockDbName}.fin_subjectvouchercorr WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND month>={startMonth} AND month<={endMonth} AND voucherType = 'm' AND direction=-1 AND subjectId IN ({fxSubjectId}) /*START #dySubjectId# AND corrSubjectId IN ({dySubjectId}) #dySubjectId# END*/) a INNER JOIN {lockDbName}.fin_accpkgsubject s2 ON s2.customerId={lockCustomerId} AND s2.yyyy={lockYyyy} AND s2.subjectId=a.corrSubjectId GROUP BY SUBSTRING_INDEX(s2.subjectFullId,'/',{subjectLevel})) b ON b.oneSubjectId=a.oneSubjectId INNER JOIN {lockDbName}.fin_accpkgsubject s ON s.customerId={lockCustomerId} AND s.yyyy={lockYyyy} AND s.subjectId=a.oneSubjectId ORDER BY a.oneSubjectId
#\u501F\u65B9\u79D1\u76EE\u5BF9\u65B9\u79D1\u76EE\u5217\u8868(\u540C\u501F\u540C\u8D37)
FIN109052=SELECT s.customerId,s.yyyy,a.oneSubjectId,s.subjectFullName,ROUND(IFNULL(b.sumValue,0),2) AS sumValue,IFNULL(a.voucherCount,0) AS voucherCount,ROUND(IFNULL(b.avgValue,0),2) AS avgValue,ROUND(IFNULL(b.largeValue,0),2) AS largeValue,IFNULL(a.voucherIds,0) AS voucherIds,s.level1 AS subjectLevel,s.isLeaf1 FROM (SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',{subjectLevel}),'/',-1) AS oneSubjectId,COUNT(DISTINCT voucherId) AS voucherCount,GROUP_CONCAT(DISTINCT voucherId) AS voucherIds FROM {lockDbName}.fin_subjectentry a INNER JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId=a.customerId AND b.yyyy=a.yyyy AND b.subjectId=a.subjectId WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.month>={startMonth} AND a.month<={endMonth} AND a.voucherId IN ({fxVoucherId}) /*START #dySubjectId# AND a.subjectId IN ({dySubjectId}) #dySubjectId# END*/ AND (a.drCount=0 OR a.crCount=0) GROUP BY SUBSTRING_INDEX(b.subjectFullId,'/',{subjectLevel})) a LEFT JOIN (SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(s2.subjectFullId,'/',{subjectLevel}),'/',-1) AS oneSubjectId,SUBSTRING_INDEX(s2.subjectFullName,'/',{subjectLevel}) AS subjectFullName,a.direction,SUM(a.occurValue) AS sumValue,SUM(ABS(a.occurValue))/COUNT(DISTINCT a.voucherId) AS avgValue,MAX(ABS(a.occurValue)) AS largeValue FROM (SELECT subjectId,corrSubjectId,corrDirection AS direction,corrValue AS occurValue,voucherId FROM  {lockDbName}.fin_subjectvouchercorr WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND month>={startMonth} AND month<={endMonth} AND voucherType = 's' AND direction=1 AND subjectId IN ({fxSubjectId}) /*START #dySubjectId# AND corrSubjectId IN ({dySubjectId}) #dySubjectId# END*/) a INNER JOIN {lockDbName}.fin_accpkgsubject s2 ON s2.customerId={lockCustomerId} AND s2.yyyy={lockYyyy} AND s2.subjectId=a.corrSubjectId GROUP BY SUBSTRING_INDEX(s2.subjectFullId,'/',{subjectLevel})) b ON b.oneSubjectId=a.oneSubjectId INNER JOIN {lockDbName}.fin_accpkgsubject s ON s.customerId={lockCustomerId} AND s.yyyy={lockYyyy} AND s.subjectId=a.oneSubjectId ORDER BY a.oneSubjectId
#\u8D37\u65B9\u79D1\u76EE\u5BF9\u65B9\u79D1\u76EE\u5217\u8868(\u540C\u501F\u540C\u8D37)
FIN109053=SELECT s.customerId,s.yyyy,a.oneSubjectId,s.subjectFullName,ROUND(IFNULL(b.sumValue,0),2) AS sumValue,IFNULL(a.voucherCount,0) AS voucherCount,ROUND(IFNULL(b.avgValue,0),2) AS avgValue,ROUND(IFNULL(b.largeValue,0),2) AS largeValue,IFNULL(a.voucherIds,0) AS voucherIds,s.level1 AS subjectLevel,s.isLeaf1 FROM (SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',{subjectLevel}),'/',-1) AS oneSubjectId,COUNT(DISTINCT voucherId) AS voucherCount,GROUP_CONCAT(DISTINCT voucherId) AS voucherIds FROM {lockDbName}.fin_subjectentry a INNER JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId=a.customerId AND b.yyyy=a.yyyy AND b.subjectId=a.subjectId WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.month>={startMonth} AND a.month<={endMonth} AND a.voucherId IN ({fxVoucherId}) /*START #dySubjectId# AND a.subjectId IN ({dySubjectId}) #dySubjectId# END*/ AND (a.drCount=0 OR a.crCount=0) GROUP BY SUBSTRING_INDEX(b.subjectFullId,'/',{subjectLevel})) a LEFT JOIN (SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(s2.subjectFullId,'/',{subjectLevel}),'/',-1) AS oneSubjectId,SUBSTRING_INDEX(s2.subjectFullName,'/',{subjectLevel}) AS subjectFullName,a.direction,SUM(a.occurValue) AS sumValue,SUM(ABS(a.occurValue))/COUNT(DISTINCT a.voucherId) AS avgValue,MAX(ABS(a.occurValue)) AS largeValue FROM (SELECT subjectId,corrSubjectId,corrDirection AS direction,corrValue AS occurValue,voucherId FROM  {lockDbName}.fin_subjectvouchercorr WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND month>={startMonth} AND month<={endMonth} AND voucherType = 's' AND direction=-1 AND subjectId IN ({fxSubjectId}) /*START #dySubjectId# AND corrSubjectId IN ({dySubjectId}) #dySubjectId# END*/) a INNER JOIN {lockDbName}.fin_accpkgsubject s2 ON s2.customerId={lockCustomerId} AND s2.yyyy={lockYyyy} AND s2.subjectId=a.corrSubjectId GROUP BY SUBSTRING_INDEX(s2.subjectFullId,'/',{subjectLevel})) b ON b.oneSubjectId=a.oneSubjectId INNER JOIN {lockDbName}.fin_accpkgsubject s ON s.customerId={lockCustomerId} AND s.yyyy={lockYyyy} AND s.subjectId=a.oneSubjectId ORDER BY a.oneSubjectId
#\u591A\u501F\u591A\u8D37\u4E00\u89C8
#\u67E5\u8BE2\u501F\u65B9 \u4E00\u501F,\u4E00\u8D37\u6216\u591A\u8D37
FIN109054=SELECT GROUP_CONCAT(DISTINCT voucherId) AS voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND month>={startMonth} AND month<={endMonth} AND subjectId IN ({fxSubjectId}) AND direction=1 AND (drCount=1 AND crCount>=1)
#\u67E5\u8BE2\u501F\u65B9 \u591A\u501F\u4E00\u8D37
FIN109055=SELECT GROUP_CONCAT(DISTINCT voucherId) AS voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND month>={startMonth} AND month<={endMonth} AND subjectId IN ({fxSubjectId}) AND direction=1 AND (drCount>1 AND crCount=1)
#\u67E5\u8BE2\u8D37\u65B9 \u4E00\u501F\u6216\u591A\u501F,\u4E00\u8D37
FIN109056=SELECT GROUP_CONCAT(DISTINCT voucherId) AS voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND month>={startMonth} AND month<={endMonth} AND subjectId IN ({fxSubjectId}) AND direction=-1 AND (drCount>=1 AND crCount=1)
#\u67E5\u8BE2\u8D37\u65B9 \u4E00\u501F\u591A\u8D37
FIN109057=SELECT GROUP_CONCAT(DISTINCT voucherId) AS voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND month>={startMonth} AND month<={endMonth} AND subjectId IN ({fxSubjectId}) AND direction=-1 AND (drCount=1 AND crCount>1)
#\u591A\u501F\u591A\u8D37\u51ED\u8BC1\u6570\u91CF\u91D1\u989D\u7B49
FIN109058=SELECT GROUP_CONCAT(DISTINCT voucherId) AS voucherId,SUM(occurValue) AS occurValue,COUNT(DISTINCT voucherId) AS voucherCount FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND month >= {startMonth} AND month <= {endMonth} AND subjectId IN ({subjectId}) AND direction = {direction} {voucherType}
#\u67E5\u8BE2\u5206\u6790\u7684\u51ED\u8BC1\u603B\u6570\u91CF
FIN109059=SELECT COUNT(0) AS totalVoucher FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND month >= {startMonth} AND month <= {endMonth}
#\u5BF9\u5E94\u51ED\u8BC1\u5206\u6790\u660E\u7EC6
FIN109060=SELECT a.autoId,a.customerId,a.yyyy,a.vchDate,a.voucherId,a.oldVoucherId,a.serail,a.typeId,a.summary,a.subjectId,a.subjectFullName,a.direction,a.occurValue,d.subjectIds,CASE a.direction WHEN 1 THEN a.occurValue ELSE 0 END AS drValue,CASE a.direction WHEN -1 THEN a.occurValue ELSE 0 END AS crValue,b.corrSubject,b.corrSubjectText,a.occurValue=b.corrValue AS isBalance FROM {lockDbName}.fin_subjectentry a LEFT JOIN (SELECT a.customerId,a.yyyy,a.voucherId,a.serail,GROUP_CONCAT(CONCAT(a.corrDirection,':',a.corrSubjectId,'|',ROUND(a.corrValue,2)) ORDER BY a.corrSubjectId) AS corrSubject,GROUP_CONCAT(CONCAT(IF(a.corrDirection=1,'\u501F','\u8D37'),a.corrSubjectId,' : ',ROUND(a.corrValue,2)) ORDER BY a.corrSubjectId SEPARATOR '; ') AS corrSubjectText,SUM(a.corrValue) AS corrValue FROM {lockDbName}.fin_subjectvouchercorr a WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.month >= {startMonth} AND a.month <= {endMonth} AND a.voucherType = '{fxType}' AND a.voucherId = {fxVoucherId} AND a.vchDate = '{vchDate}' AND a.oldVoucherId = {oldVoucherId} GROUP BY a.customerId,a.yyyy,a.voucherId,a.serail) b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.voucherId = a.voucherId AND b.serail = a.serail LEFT JOIN (SELECT voucherId,GROUP_CONCAT(DISTINCT CONCAT(direction,':',subjectId) ORDER BY direction DESC,subjectId) AS subjectIds FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND month >= {startMonth} AND month <= {endMonth} AND voucherId = {fxVoucherId} AND vchDate = '{vchDate}' AND oldVoucherId = {oldVoucherId} GROUP BY voucherId) d ON d.voucherId = a.voucherId WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.month >= {startMonth} AND a.month <= {endMonth} AND a.voucherId = {fxVoucherId} AND a.vchDate = '{vchDate}' AND a.oldVoucherId = {oldVoucherId} ORDER BY vchDate,voucherId,serail
########\u5BF9\u5E94\u51ED\u8BC1\u5206\u6790########
########\u672C\u798F\u7279\u5206\u6790########
#\u672C\u798F\u7279
#\u4F59\u989D\u8868 \u660E\u7EC6\u8D26 \u67E5\u8BE2\u521D\u671F\u4F59\u989D
FIN110001=SELECT autoId, customerId,yyyy,voucherId,oldVoucherId,typeId,vchDate,serail,summary,subjectId,direction,occurValue,currRate,currValue,currency,quantity,unitPrice,unitName,subjectName,subjectFullName,debitsubjects,creditsubjects,voucherFillUser,voucherAuditUser,voucherKeepUser,voucherAffixCount,voucherDebitOcc,voucherCreditOcc,voucherDirector,oppositeAccountTop,oppositeAccountLast,oppositeSubjectValue,oppositeTopSubjectValue,ACTIVE_FLAG,CASE direction WHEN 1 THEN OccurValue ELSE 0.00 END AS debit,CASE direction WHEN 1 THEN currValue ELSE 0.00 END AS debitCurr,CASE direction WHEN -1 THEN OccurValue ELSE 0.00 END AS credit,CASE direction WHEN -1 THEN currValue ELSE 0.00 END AS creditCurr,'' AS debitRemain FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #param2# AND subjectId in ({param2}) #param2# END*/ /*START #param3# AND s1 = '{param3}' #param3# END*/ /*START #param4# AND month = '{param4}' #param4# END*/ /*START #param5# AND ABS(occurValue ) >= {param5} #param5# END*/ /*START #param6# AND ABS(occurValue ) < {param6} #param6# END*/ ORDER BY vchDate,typeid,ABS(oldvoucherid),serail
#\u7EDF\u8BA1\u79D1\u76EE\u7684\u9996\u4F4D\u6570\u5B57
FIN110002=select s1,count(1) as cnt from {lockDbName}.fin_subjectentry where customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND subjectId in ({param2}) group by s1
#\u7EDF\u8BA1\u67F1\u72B6\u56FE
FIN110003=select sum(case t.month when 1 then 1 else 0 end) as m1,sum(case t.month when 2 then 1 else 0 end) as m2,sum(case t.month when 3 then 1 else 0 end) as m3,sum(case t.month when 4 then 1 else 0 end) as m4,sum(case t.month when 5 then 1 else 0 end) as m5,sum(case t.month when 6 then 1 else 0 end) as m6,sum(case t.month when 7 then 1 else 0 end) as m7,sum(case t.month when 8 then 1 else 0 end) as m8,sum(case t.month when 9 then 1 else 0 end) as m9,sum(case t.month when 10 then 1 else 0 end) as m10,sum(case t.month when 11 then 1 else 0 end) as m11,sum(case t.month when 12 then 1 else 0 end) as m12 FROM {lockDbName}.fin_subjectentry t where customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #param2# AND subjectId in ({param2}) #param2# END*/ AND s1 = '{param3}' /*START #param4# AND ABS(t.occurValue ) >= {param4} #param4# END*/ /*START #param5# AND ABS(t.occurValue ) < {param5} #param5# END*/
#\u91D1\u989D\u5206\u5C42
FIN110004=select sum(CASE WHEN ABS(t.occurValue ) >= {param3} * 1 and ABS(t.occurValue ) < {param3} * 10000 then 1 else 0 end) as m1,sum(CASE WHEN ABS(t.occurValue ) >= {param3} * 10000 and ABS(t.occurValue ) < {param3} * 100000 then 1 else 0 end) as m2,sum(CASE WHEN ABS(t.occurValue ) >= {param3} * 100000 and ABS(t.occurValue ) < {param3} * 1000000 then 1 else 0 end) as m3,sum(CASE WHEN ABS(t.occurValue ) >= {param3} * 1000000 and ABS(t.occurValue ) < {param3} * 10000000 then 1 else 0 end) as m4,sum(CASE WHEN ABS(t.occurValue ) >= {param3} * 10000000 then 1 else 0 end) as m5,sum(1) as m6 FROM {lockDbName}.fin_subjectentry t where customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #param2# AND subjectId in ({param2}) #param2# END*/ AND s1 = '{param3}'
########\u672C\u798F\u7279\u5206\u6790########
########\u591A\u79D1\u76EE\u6302\u8D26\u5206\u6790########
#\u591A\u79D1\u76EE\u5206\u6790
#\u67E5\u8BE2\u591A\u79D1\u76EE\u5206\u6790
FIN120001=SELECT t1.customerId,t1.yyyy,{param5},t1.subjectId,t3.subjectName,t1.assItemId,t1.assTotalName,t1.balance,t3.subjectFullName,t3.subjectFullId FROM (SELECT customerId,yyyy,subjectId,assItemId,assTotalName,SUM(  balance ) balance FROM {lockDbName}.fin_assitementryacc WHERE customerId ={lockCustomerId} AND yyyy ={lockYyyy} AND subMOnth = 12 and subjectId in (SELECT a2.subjectId FROM {lockDbName}.fin_accpkgsubject a1 ,{lockDbName}.fin_accpkgsubject a2 WHERE a1.customerId = {lockCustomerId} AND a1.yyyy ={lockYyyy} /*START #param3# AND a1.subjectId in {param3} #param3# END*/ AND a1.customerId = a2.customerId AND a1.yyyy = a2.yyyy AND a2.subjectFullId LIKE CONCAT(a1.subjectFullId,'/%') UNION SELECT a1.subjectId FROM {lockDbName}.fin_accpkgsubject a1 WHERE a1.customerId = {lockCustomerId} AND a1.yyyy ={lockYyyy} /*START #param3# AND a1.subjectId in {param3} #param3# END*/) GROUP BY customerId,yyyy,subjectId,assItemId,assTotalName) t1,(SELECT * FROM {lockDbName}.fin_accpkgsubject where customerId ={lockCustomerId} AND yyyy ={lockYyyy}) t3 WHERE t1.customerId = t3.customerId AND t1.yyyy = t3.yyyy AND t1.subjectId = t3.subjectId AND t1.assItemId in {param4} order by assItemCustomerName
#\u67E5\u8BE2\u6838\u7B97\u79D1\u76EE
FIN120002=SELECT DISTINCT a.assItemId AS id, a.assItemId, a.assItemName, CONCAT(a.assItemId, ' : ', a.assTotalName) AS label, IF(a.isLeaf1 = 0, 'false', 'true') AS leaf, a.parentAssItemId AS parentid FROM {lockDbName}.fin_assitem a WHERE a.isLeaf1 = 1 AND a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy}  /*START #param3# AND a.assItemName LIKE '%{param3}%' #param3# END*/ ORDER BY a.assItemId
#\u67E5\u8BE2\u591A\u79D1\u76EE\u6838\u7B97\u79D1\u76EE
FIN120003=select t2.assItemId,t2.assItemName,t2.assTotalName,GROUP_CONCAT(subjectId) as subjectId,GROUP_CONCAT(subjectName) as subjectName from {lockDbName}.fin_assitem t2 WHERE t2.customerId ={lockCustomerId} AND t2.yyyy ={lockYyyy} and t2.assItemId = '{assItemId}' group by t2.customerId,t2.yyyy,t2.assItemId,t2.assItemName,t2.assTotalName
########\u591A\u79D1\u76EE\u6302\u8D26\u5206\u6790########
####################\u8D22\u52A1\u4E2D\u5FC3####################
####################\u5BA2\u6237\u95E8\u6237####################
#\u6570\u636E\u6821\u9A8C
#\u83B7\u53D6E\u5BA1\u901A\u6821\u9A8C\u7ED3\u679C
FIN200001=SELECT a.customerId,a.year,a.uploadUser,a.checkoutResult FROM bdo_fin.fin_tasklist a WHERE a.customerId={lockCustomerId} AND year={lockYyyy}
#\u83B7\u53D6\u6570\u636E\u662F\u5426\u4FEE\u6539\u8FC7
FIN200002=SELECT type,IF(type='3',content,'') AS content,DATE_FORMAT(CREATION_DATE,'%Y-%m-%d %T') AS editDate FROM bdo_fin.fin_record WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND type IN ('3','4') ORDER BY CREATION_DATE DESC
#\u67E5\u8BE2\u51ED\u8BC1,\u5206\u5F55\u603B\u6570,\u501F,\u8D37\u53CA\u603B\u91D1\u989D
FIN200003=SELECT COUNT(0) AS JOURNALNUM,b.VOUCHERNUM,c.ASSNUM,SUM(CASE WHEN a.direction=1 THEN a.occurValue ELSE 0 END) AS DEBIT,SUM(CASE WHEN a.direction=-1 THEN a.occurValue ELSE 0 END) AS CREDIT,SUM(a.occurValue) AS AMOUNT FROM {lockDbName}.fin_subjectentry a LEFT JOIN( SELECT a.customerId,a.yyyy,COUNT(0) AS VOUCHERNUM FROM {lockDbName}.fin_subjectvoucher a WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy}) b ON b.customerId=a.customerId AND b.yyyy=a.yyyy LEFT JOIN(SELECT a.customerId,a.yyyy,COUNT(0) AS ASSNUM FROM {lockDbName}.fin_assitementry a WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy}) c ON c.customerId=a.customerId AND c.yyyy=a.yyyy WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy}
#\u5E73\u8861\u6027\u6821\u9A8C
FIN200004=SELECT a.NAME,a.TITLE,a.NUM,IFNULL(a.AMOUNT,0) AS AMOUNT FROM((SELECT '\u5E73\u8861\u6027\u6821\u9A8C' AS NAME,'\u5E73\u8861\u51ED\u8BC1' AS TITLE,COUNT(0) AS NUM,SUM(a.debitocc+a.creditocc) AS AMOUNT FROM {lockDbName}.fin_subjectvoucher a WHERE 1=1 AND a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.debitocc=a.creditocc) UNION(SELECT '\u5E73\u8861\u6027\u6821\u9A8C' AS NAME,'\u4E0D\u5E73\u8861\u51ED\u8BC1' AS TITLE,COUNT(0) AS NUM,SUM(a.debitocc+a.creditocc) AS AMOUNT FROM {lockDbName}.fin_subjectvoucher a WHERE 1=1 AND a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.debitocc<>a.creditocc) ) a
#\u79D1\u76EE\u7F16\u7801\u6821\u9A8C
FIN200005=SELECT a.NAME,a.TITLE,a.NUM,IFNULL(a.AMOUNT,0) AS AMOUNT FROM((SELECT '\u79D1\u76EE\u7F16\u7801\u6821\u9A8C' AS NAME,'\u6709\u79D1\u76EE\u7F16\u7801' AS TITLE,COUNT(0) AS NUM,SUM(a.occurValue) AS AMOUNT FROM {lockDbName}.fin_subjectentry a WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.subjectId>'' AND a.subjectId IS NOT NULL) UNION(SELECT '\u79D1\u76EE\u7F16\u7801\u6821\u9A8C' AS NAME,'\u65E0\u79D1\u76EE\u7F16\u7801' AS TITLE,COUNT(0) AS NUM,SUM(a.occurValue) AS AMOUNT FROM {lockDbName}.fin_subjectentry a WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND NOT(a.subjectId>'' AND a.subjectId IS NOT NULL) ) ) a
#\u5236\u5355\u4EBA\u6821\u9A8C
FIN200006=SELECT a.NAME,a.TITLE,a.NUM,IFNULL(a.AMOUNT,0) AS AMOUNT FROM((SELECT '\u5236\u5355\u4EBA\u6821\u9A8C' AS NAME,'\u6709\u5236\u5355\u4EBA' AS TITLE,COUNT(0) AS NUM,SUM(a.debitocc+a.creditocc) AS AMOUNT FROM {lockDbName}.fin_subjectvoucher a WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.voucherFillUser>'' AND a.voucherFillUser IS NOT NULL) UNION(SELECT '\u5236\u5355\u4EBA\u6821\u9A8C' AS NAME,'\u65E0\u5236\u5355\u4EBA' AS TITLE,COUNT(0) AS NUM,SUM(a.debitocc+a.creditocc) AS AMOUNT FROM {lockDbName}.fin_subjectvoucher a WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND NOT(a.voucherFillUser>'' AND a.voucherFillUser IS NOT NULL) ) ) a
#\u51ED\u8BC1\u7C7B\u578B\u6821\u9A8C
FIN200007=SELECT a.NAME,a.TITLE,a.NUM,IFNULL(a.AMOUNT,0) AS AMOUNT FROM((SELECT '\u51ED\u8BC1\u7C7B\u578B\u6821\u9A8C' AS NAME,'\u6709\u51ED\u8BC1\u7C7B\u578B' AS TITLE,COUNT(0) AS NUM,SUM(a.debitocc+a.creditocc) AS AMOUNT FROM {lockDbName}.fin_subjectvoucher a WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.typeId>'' AND a.typeId IS NOT NULL) UNION(SELECT '\u51ED\u8BC1\u7C7B\u578B\u6821\u9A8C' AS NAME,'\u65E0\u51ED\u8BC1\u7C7B\u578B' AS TITLE,COUNT(0) AS NUM,SUM(a.debitocc+a.creditocc) AS AMOUNT FROM {lockDbName}.fin_subjectvoucher a WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND NOT(a.typeId>'') ) ) a
#\u51ED\u8BC1\u7F16\u53F7\u6821\u9A8C
FIN200008=SELECT a.NAME,a.TITLE,a.NUM,IFNULL(a.AMOUNT,0) AS AMOUNT FROM((SELECT '\u51ED\u8BC1\u7F16\u53F7\u6821\u9A8C' AS NAME,'\u6709\u51ED\u8BC1\u7F16\u53F7' AS TITLE,COUNT(0) AS NUM,SUM(a.debitocc+a.creditocc) AS AMOUNT FROM {lockDbName}.fin_subjectvoucher a WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.voucherId>'' AND a.oldVoucherId > '') UNION(SELECT '\u51ED\u8BC1\u7F16\u7801\u6821\u9A8C' AS NAME,'\u65E0\u51ED\u8BC1\u7F16\u53F7' AS TITLE,COUNT(0) AS NUM,SUM(a.debitocc+a.creditocc) AS AMOUNT FROM {lockDbName}.fin_subjectvoucher a WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND NOT(a.voucherId>'' AND a.oldVoucherId >''))) a
#\u91D1\u989D\u8D1F\u6570\u6821\u9A8C
FIN200009=SELECT a.NAME,a.TITLE,a.NUM,IFNULL(a.AMOUNT,0) AS AMOUNT FROM((SELECT '\u91D1\u989D\u8D1F\u6570\u6821\u9A8C' AS NAME,'\u53D1\u751F\u989D\u4E0D\u662F\u8D1F\u6570' AS TITLE,COUNT(0) AS NUM,SUM(ABS(a.occurValue)) AS AMOUNT FROM {lockDbName}.fin_subjectentry a WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.occurValue>=0) UNION(SELECT '\u91D1\u989D\u8D1F\u6570\u6821\u9A8C' AS NAME,'\u53D1\u751F\u989D\u662F\u8D1F\u6570' AS TITLE,COUNT(0) AS NUM,SUM(ABS(a.occurValue)) AS AMOUNT FROM {lockDbName}.fin_subjectentry a WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.occurValue<0) ) a
#\u79D1\u76EE\u4F59\u989D\u3001\u53D1\u751F\u989D\u5E73\u8861\u6027\u6821\u9A8C
FIN200010=SELECT a.NAME,a.TITLE,a.NUM,IFNULL(a.AMOUNT,0) AS AMOUNT FROM((SELECT '\u79D1\u76EE\u4F59\u989D\u3001\u53D1\u751F\u989D\u6821\u9A8C' AS NAME,'\u51ED\u8BC1\u53D1\u751F\u989D\u5408\u8BA1\u548C\u79D1\u76EE\u53D1\u751F\u989D\u4E00\u81F4' AS TITLE,COUNT(0) AS NUM,SUM(a.debitOcc+a.creditOcc) AS AMOUNT FROM(SELECT a.customerId,a.yyyy,a.subjectId,a.subjectName AS subjectName,MAX(CASE WHEN a.subMonth=1 THEN a.remain END) AS remainP,SUM(CASE WHEN 1<=a.subMonth<=12 THEN a.debitOcc END) AS debitOccP,SUM(CASE WHEN 1<=a.subMonth<=12 THEN a.creditOcc END) AS creditOccP,MAX(CASE WHEN a.subMonth=12 THEN  a.balance END) AS balanceP,IFNULL(b.debitOcc,0) AS debitOccS,IFNULL(b.creditOcc,0) AS creditOccS,a.direction,a.isLeaf1 AS isLeaf1,a.level1 AS subLevel,a.subjectFullName AS fullName,SUM(CASE WHEN a.isLeaf1=1 THEN a.debitOcc END) AS debitOcc,SUM(CASE WHEN a.isLeaf1=1 THEN a.debitOcc END) AS creditOcc FROM {lockDbName}.fin_account a LEFT JOIN(SELECT t1.customerId,t1.yyyy AS yyyy,t2.parentSubjectId AS subjectId,SUM(CASE WHEN t1.direction=1 THEN t1.occurValue ELSE 0 END) AS debitOcc,SUM(CASE WHEN t1.direction=-1 THEN t1.occurValue ELSE 0 END) AS creditOcc FROM(SELECT b.customerId,b.yyyy,b.subjectId,b.direction,b.occurValue FROM {lockDbName}.fin_subjectentry b WHERE b.customerId={lockCustomerId} AND b.yyyy={lockYyyy}) t1,(SELECT a1.customerId,a1.yyyy,a1.subjectId parentSubjectId,a2.subjectId FROM {lockDbName}.fin_accpkgsubject a1,{lockDbName}.fin_accpkgsubject a2 WHERE a1.customerId={lockCustomerId} AND a1.yyyy={lockYyyy} AND a2.customerId={lockCustomerId} AND a2.yyyy={lockYyyy} AND a2.subjectFullId LIKE CONCAT(a1.subjectFullId,'/%') UNION SELECT a1.customerId,a1.yyyy,a1.subjectId parentSubjectId,a1.subjectId FROM {lockDbName}.fin_accpkgsubject a1 WHERE a1.customerId={lockCustomerId} AND a1.yyyy={lockYyyy}) t2 WHERE t1.customerId=t2.customerId AND t1.yyyy=t2.yyyy AND t1.subjectId=t2.subjectId GROUP BY t1.customerId,t1.yyyy,t2.parentSubjectId) b ON b.customerId=a.customerId AND b.yyyy=a.yyyy AND b.subjectId=a.subjectId WHERE 1=1 AND a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} GROUP BY a.customerId,a.yyyy,a.subjectId ORDER BY a.customerId,a.yyyy,a.subjectId) a WHERE 1=1 AND(a.debitOccP=a.debitOccS AND a.creditOccP=a.creditOccS) ) UNION(SELECT '\u79D1\u76EE\u4F59\u989D\u3001\u53D1\u751F\u989D\u5E73\u8861\u6027\u6821\u9A8C' AS NAME,'\u51ED\u8BC1\u53D1\u751F\u989D\u5408\u8BA1\u548C\u79D1\u76EE\u53D1\u751F\u989D\u4E0D\u4E00\u81F4' AS TITLE,COUNT(0) AS NUM,IFNULL(SUM(a.debitOcc+a.creditOcc),0) AS AMOUNT FROM(SELECT a.customerId,a.yyyy,a.subjectId,a.subjectName AS subjectName,MAX(CASE WHEN a.subMonth=1 THEN a.remain END) AS remainP,SUM(CASE WHEN 1<=a.subMonth<=12 THEN a.debitOcc END) AS debitOccP,SUM(CASE WHEN 1<=a.subMonth<=12 THEN a.creditOcc END) AS creditOccP,MAX(CASE WHEN a.subMonth=12 THEN  a.balance END) AS balanceP,IFNULL(b.debitOcc,0) AS debitOccS,IFNULL(b.creditOcc,0) AS creditOccS,a.direction,a.isLeaf1 AS isLeaf1,a.level1 AS subLevel,a.subjectFullName AS fullName,SUM(CASE WHEN a.isLeaf1=1 THEN a.debitOcc END) AS debitOcc,SUM(CASE WHEN a.isLeaf1=1 THEN a.debitOcc END) AS creditOcc FROM {lockDbName}.fin_account a LEFT JOIN(SELECT t1.customerId,t1.yyyy AS yyyy,t2.parentSubjectId AS subjectId,SUM(CASE WHEN t1.direction=1 THEN t1.occurValue ELSE 0 END) AS debitOcc,SUM(CASE WHEN t1.direction=-1 THEN t1.occurValue ELSE 0 END) AS creditOcc FROM(SELECT b.customerId,b.yyyy,b.subjectId,b.direction,b.occurValue FROM {lockDbName}.fin_subjectentry b WHERE b.customerId={lockCustomerId} AND b.yyyy={lockYyyy}) t1,(SELECT a1.customerId,a1.yyyy,a1.subjectId parentSubjectId,a2.subjectId FROM {lockDbName}.fin_accpkgsubject a1,{lockDbName}.fin_accpkgsubject a2 WHERE a1.customerId={lockCustomerId} AND a1.yyyy={lockYyyy} AND a2.customerId={lockCustomerId} AND a2.yyyy={lockYyyy} AND a2.subjectFullId LIKE CONCAT(a1.subjectFullId,'/%') UNION SELECT a1.customerId,a1.yyyy,a1.subjectId parentSubjectId,a1.subjectId FROM {lockDbName}.fin_accpkgsubject a1 WHERE a1.customerId={lockCustomerId} AND a1.yyyy={lockYyyy}) t2 WHERE t1.customerId=t2.customerId AND t1.yyyy=t2.yyyy AND t1.subjectId=t2.subjectId GROUP BY t1.customerId,t1.yyyy,t2.parentSubjectId) b ON b.customerId=a.customerId AND b.yyyy=a.yyyy AND b.subjectId=a.subjectId WHERE 1=1 AND a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} GROUP BY a.customerId,a.yyyy,a.subjectId ORDER BY a.customerId,a.yyyy,a.subjectId) a WHERE 1=1 AND NOT(a.debitOccP=a.debitOccS AND a.creditOccP=a.creditOccS) ) ) a
#\u5206\u5F55\u6458\u8981\u6821\u9A8C
FIN200011=SELECT a.NAME,a.TITLE,a.NUM,IFNULL(a.AMOUNT,0) AS AMOUNT FROM((SELECT '\u5206\u5F55\u6458\u8981\u6821\u9A8C' AS NAME,'\u6458\u8981\u4E0D\u5305\u542B\u5173\u952E\u5B57' AS TITLE,COUNT(0) AS NUM,SUM(a.occurValue) AS AMOUNT FROM {lockDbName}.fin_subjectentry a WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.summary NOT REGEXP '^(-) ?[1-9][0-9]*(.) [0-9]*$|(\u8F67\u5DEE) |(\u51B2\u62B5) |^[[:space:]]*$') UNION(SELECT '\u5206\u5F55\u6458\u8981\u6821\u9A8C' AS NAME,'\u6458\u8981\u5305\u542B\u5173\u952E\u5B57' AS TITLE,COUNT(0) AS NUM,SUM(a.occurValue) AS AMOUNT FROM {lockDbName}.fin_subjectentry a WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.summary REGEXP '^(-) ?[1-9][0-9]*(.) [0-9]*$|(\u8F67\u5DEE) |(\u51B2\u62B5) |^[[:space:]]*$') ) a
#\u79D1\u76EE\u91CD\u590D\u6821\u9A8C
FIN200012=(SELECT '\u79D1\u76EE\u91CD\u590D\u6821\u9A8C' AS NAME,'\u79D1\u76EE\u4E0D\u91CD\u590D' AS TITLE,COUNT(0) AS NUM,IFNULL(SUM(a.debitOcc+a.creditOcc),0) AS AMOUNT FROM(SELECT a.customerId,a.yyyy,a.voucherId,a.oldVoucherId,a.summary,SUM(a.debitOcc) AS debitOcc,SUM(a.creditOcc) AS creditOcc FROM(SELECT a.customerId,a.yyyy,a.voucherId,a.oldVoucherId,a.summary,CASE WHEN a.direction=1 THEN a.occurValue ELSE 0 END AS debitOcc,CASE WHEN a.direction=-1 THEN a.occurValue ELSE 0 END AS creditOcc FROM {lockDbName}.fin_subjectentry a LEFT JOIN(SELECT DISTINCT a.voucherId FROM(SELECT COUNT(0) AS REPEATFLAG,a.voucherId FROM(SELECT a.customerId,a.yyyy,a.voucherId,a.oldVoucherId,a.subjectId,a.direction FROM {lockDbName}.fin_subjectentry a WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} GROUP BY a.customerId,a.yyyy,a.voucherId,a.subjectId,a.direction) a GROUP BY a.customerId,a.yyyy,a.voucherId,a.subjectId) a WHERE a.REPEATFLAG>1) a1 ON a.voucherId=a1.voucherId WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a1.voucherId IS NULL) a GROUP BY a.customerId,a.yyyy,a.voucherId) a) UNION(SELECT '\u79D1\u76EE\u91CD\u590D\u6821\u9A8C' AS NAME,'\u79D1\u76EE\u91CD\u590D' AS TITLE,COUNT(0) AS NUM,IFNULL(SUM(a.debitOcc+a.creditOcc),0) AS AMOUNT FROM(SELECT a.customerId,a.yyyy,a.voucherId,a.oldVoucherId,a.summary,SUM(a.debitOcc) AS debitOcc,SUM(a.creditOcc) AS creditOcc FROM(SELECT a.customerId,a.yyyy,a.voucherId,a.oldVoucherId,a.summary,CASE WHEN a.direction=1 THEN a.occurValue ELSE 0 END AS debitOcc,CASE WHEN a.direction=-1 THEN a.occurValue ELSE 0 END AS creditOcc FROM {lockDbName}.fin_subjectentry a LEFT JOIN(SELECT DISTINCT a.voucherId FROM(SELECT COUNT(0) AS REPEATFLAG,a.voucherId FROM(SELECT a.customerId,a.yyyy,a.voucherId,a.oldVoucherId,a.subjectId,a.direction FROM {lockDbName}.fin_subjectentry a WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} GROUP BY a.customerId,a.yyyy,a.voucherId,a.subjectId,a.direction) a GROUP BY a.customerId,a.yyyy,a.voucherId,a.subjectId) a WHERE a.REPEATFLAG>1) a2 ON a.voucherId=a2.voucherId WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a2.voucherId IS NOT NULL) a GROUP BY a.customerId,a.yyyy,a.voucherId) a) 
#\u501F\u65B9\u6216\u8D37\u65B9\u96F6\u91D1\u989D\u6821\u9A8C
FIN200013=SELECT a.NAME,a.TITLE,a.NUM,IFNULL(a.AMOUNT,0) AS AMOUNT FROM((SELECT '\u501F\u65B9\u6216\u8D37\u65B9\u96F6\u91D1\u989D\u6821\u9A8C' AS NAME,'\u501F\u65B9\u548C\u8D37\u65B9\u975E0' AS TITLE,COUNT(0) AS NUM,SUM(a.debitocc+a.creditocc) AS AMOUNT FROM {lockDbName}.fin_subjectvoucher a WHERE 1=1 AND a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.debitocc * a.creditocc<>0) UNION(SELECT '\u501F\u65B9\u6216\u8D37\u65B9\u96F6\u91D1\u989D\u6821\u9A8C' AS NAME,'\u501F\u65B9\u6216\u8D37\u65B9\u4E3A0' AS TITLE,COUNT(0) AS NUM,SUM(a.debitocc+a.creditocc) AS AMOUNT FROM {lockDbName}.fin_subjectvoucher a WHERE 1=1 AND a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.debitocc * a.creditocc=0) ) a
#\u5F55\u5165\u65E5\u671F\u5F02\u5E38\u6821\u9A8C
FIN200014=SELECT a.NAME,a.TITLE,a.NUM,IFNULL(a.AMOUNT,0) AS AMOUNT FROM((SELECT '\u5F55\u5165\u65E5\u671F\u5F02\u5E38\u6821\u9A8C' AS NAME,'\u5F55\u5165\u65E5\u671F\u6B63\u5E38' AS TITLE,COUNT(0) AS NUM,SUM(a.debitocc+a.creditocc) AS AMOUNT FROM {lockDbName}.fin_subjectvoucher a LEFT JOIN bdo_base.base_holiday b ON b.holiday=a.vchDate WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND(b.TYPE IS NULL AND a.vchDate IS NOT NULL AND a.vchDate>'') ) UNION(SELECT '\u5F55\u5165\u65E5\u671F\u5F02\u5E38\u6821\u9A8C' AS NAME,'\u5F55\u5165\u65E5\u671F\u5F02\u5E38' AS TITLE,COUNT(0) AS NUM,SUM(a.debitocc+a.creditocc) AS AMOUNT FROM {lockDbName}.fin_subjectvoucher a LEFT JOIN bdo_base.base_holiday b ON b.holiday=a.vchDate WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND NOT(b.TYPE IS NULL AND a.vchDate IS NOT NULL AND a.vchDate>'') ) ) a
#\u5236\u5355\u4EBA\u3001\u5BA1\u6838\u4EBA\u6821\u9A8C
FIN200015=SELECT a.NAME,a.TITLE,a.NUM,IFNULL(a.AMOUNT,0) AS AMOUNT FROM((SELECT '\u5236\u5355\u4EBA\u3001\u5BA1\u6838\u4EBA\u6821\u9A8C' AS NAME,'\u5236\u5355\u4EBA\u3001\u5BA1\u6838\u4EBA\u4E0D\u540C' AS TITLE,COUNT(0) AS NUM,SUM(a.debitocc+a.creditocc) AS AMOUNT FROM {lockDbName}.fin_subjectvoucher a WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND IFNULL(a.voucherFillUser,'')<>IFNULL(a.voucherAuditUser,'') ) UNION(SELECT '\u5236\u5355\u4EBA\u3001\u5BA1\u6838\u4EBA\u6821\u9A8C' AS NAME,'\u5236\u5355\u4EBA\u3001\u5BA1\u6838\u4EBA\u76F8\u540C' AS TITLE,COUNT(0) AS NUM,SUM(a.debitocc+a.creditocc) AS AMOUNT FROM {lockDbName}.fin_subjectvoucher a WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND IFNULL(a.voucherFillUser,'')=IFNULL(a.voucherAuditUser,'') ) ) a
#\u4F59\u989D\u8868\u7EA7\u6B21\u6821\u9A8C
FIN200016=SELECT a.NAME,a.TITLE,a.NUM,IFNULL(a.AMOUNT,0) AS AMOUNT FROM((SELECT '\u4F59\u989D\u8868\u7EA7\u6B21\u6821\u9A8C' AS NAME,'\u4F59\u989D\u8868\u5404\u6B21\u7EA7\u660E\u7EC6\u5408\u8BA1\u6570\u4E0E\u4E0A\u4E00\u7EA7\u76F8\u7B49' AS TITLE,COUNT(0) AS NUM,SUM(a.debitOccP+a.creditOccP) AS AMOUNT FROM(SELECT a.subjectId,a.fullName,a.direction,a.remain AS remainP,a.debitOcc AS debitOccP,a.creditOcc AS creditOccP,a.balance AS balanceP,b.remain AS remainS,b.debitOcc AS debitOccS,b.creditOcc AS creditOccS,b.balance AS balanceS,IF(a.remain=b.remain AND a.debitOcc=b.debitOcc AND a.creditOcc=b.creditOcc AND a.balance=b.balance,1,0) AS EQFLAG FROM(SELECT a.subjectId,a.subjectFullName AS fullName,a.direction,SUM(CASE WHEN a.subMonth=1 THEN a.remain ELSE 0 END) remain,SUM(debitOcc) AS debitOcc,SUM(creditOcc) AS creditOcc,SUM(CASE WHEN a.subMonth=12 THEN a.balance ELSE 0 END) balance FROM {lockDbName}.fin_account a WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} GROUP BY a.customerId,a.yyyy,a.subjectId) a LEFT JOIN((SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',1),'/',-1) AS subjectId,a.direction,SUM(CASE WHEN a.subMonth=1 THEN a.remain ELSE 0 END) remain,SUM(debitOcc) AS debitOcc,SUM(creditOcc) AS creditOcc,SUM(CASE WHEN a.subMonth=12 THEN a.balance ELSE 0 END) balance FROM {lockDbName}.fin_account a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId=a.customerId AND b.yyyy=a.yyyy AND b.subjectId=a.subjectId WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.isLeaf1=1 AND CHAR_LENGTH(b.subjectFullId)-CHAR_LENGTH(REPLACE(b.subjectFullId,'/','') )>=0 GROUP BY a.customerId,a.yyyy,SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',1),'/',-1) ) UNION(SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',2),'/',-1) AS subjectId,a.direction,SUM(CASE WHEN a.subMonth=1 THEN a.remain ELSE 0 END) remain,SUM(debitOcc) AS debitOcc,SUM(creditOcc) AS creditOcc,SUM(CASE WHEN a.subMonth=12 THEN a.balance ELSE 0 END) balance FROM {lockDbName}.fin_account a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId=a.customerId AND b.yyyy=a.yyyy AND b.subjectId=a.subjectId WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.isLeaf1=1 AND CHAR_LENGTH(b.subjectFullId)-CHAR_LENGTH(REPLACE(b.subjectFullId,'/','') )>=1 GROUP BY a.customerId,a.yyyy,SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',2),'/',-1) ) UNION(SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',3),'/',-1) AS subjectId,a.direction,SUM(CASE WHEN a.subMonth=1 THEN a.remain ELSE 0 END) remain,SUM(debitOcc) AS debitOcc,SUM(creditOcc) AS creditOcc,SUM(CASE WHEN a.subMonth=12 THEN a.balance ELSE 0 END) balance FROM {lockDbName}.fin_account a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId=a.customerId AND b.yyyy=a.yyyy AND b.subjectId=a.subjectId WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.isLeaf1=1 AND CHAR_LENGTH(b.subjectFullId)-CHAR_LENGTH(REPLACE(b.subjectFullId,'/','') )>=2 GROUP BY a.customerId,a.yyyy,SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',3),'/',-1) ) UNION(SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',4),'/',-1) AS subjectId,a.direction,SUM(CASE WHEN a.subMonth=1 THEN a.remain ELSE 0 END) remain,SUM(debitOcc) AS debitOcc,SUM(creditOcc) AS creditOcc,SUM(CASE WHEN a.subMonth=12 THEN a.balance ELSE 0 END) balance FROM {lockDbName}.fin_account a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId=a.customerId AND b.yyyy=a.yyyy AND b.subjectId=a.subjectId WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.isLeaf1=1 AND CHAR_LENGTH(b.subjectFullId)-CHAR_LENGTH(REPLACE(b.subjectFullId,'/','') )>=3 GROUP BY a.customerId,a.yyyy,SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',4),'/',-1) ) UNION(SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',5),'/',-1) AS subjectId,a.direction,SUM(CASE WHEN a.subMonth=1 THEN a.remain ELSE 0 END) remain,SUM(debitOcc) AS debitOcc,SUM(creditOcc) AS creditOcc,SUM(CASE WHEN a.subMonth=12 THEN a.balance ELSE 0 END) balance FROM {lockDbName}.fin_account a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId=a.customerId AND b.yyyy=a.yyyy AND b.subjectId=a.subjectId WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.isLeaf1=1 AND CHAR_LENGTH(b.subjectFullId)-CHAR_LENGTH(REPLACE(b.subjectFullId,'/','') )>=4 GROUP BY a.customerId,a.yyyy,SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',5),'/',-1) ) ) b ON b.subjectId=a.subjectId) a WHERE EQFLAG=1) UNION(SELECT '\u4F59\u989D\u8868\u7EA7\u6B21\u6821\u9A8C' AS NAME,'\u4F59\u989D\u8868\u5404\u6B21\u7EA7\u660E\u7EC6\u5408\u8BA1\u6570\u4E0E\u4E0A\u4E00\u7EA7\u4E0D\u76F8\u7B49' AS TITLE,COUNT(0) AS NUM,SUM(a.debitOccP+a.creditOccP) AS AMOUNT FROM(SELECT a.subjectId,a.fullName,a.direction,a.remain AS remainP,a.debitOcc AS debitOccP,a.creditOcc AS creditOccP,a.balance AS balanceP,b.remain AS remainS,b.debitOcc AS debitOccS,b.creditOcc AS creditOccS,b.balance AS balanceS,IF(a.remain=b.remain AND a.debitOcc=b.debitOcc AND a.creditOcc=b.creditOcc AND a.balance=b.balance,1,0) AS EQFLAG FROM(SELECT a.subjectId,a.subjectFullName AS fullName,a.direction,SUM(CASE WHEN a.subMonth=1 THEN a.remain ELSE 0 END) remain,SUM(debitOcc) AS debitOcc,SUM(creditOcc) AS creditOcc,SUM(CASE WHEN a.subMonth=12 THEN a.balance ELSE 0 END) balance FROM {lockDbName}.fin_account a WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} GROUP BY a.customerId,a.yyyy,a.subjectId) a LEFT JOIN((SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',1),'/',-1) AS subjectId,a.direction,SUM(CASE WHEN a.subMonth=1 THEN a.remain ELSE 0 END) remain,SUM(debitOcc) AS debitOcc,SUM(creditOcc) AS creditOcc,SUM(CASE WHEN a.subMonth=12 THEN a.balance ELSE 0 END) balance FROM {lockDbName}.fin_account a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId=a.customerId AND b.yyyy=a.yyyy AND b.subjectId=a.subjectId WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.isLeaf1=1 AND CHAR_LENGTH(b.subjectFullId)-CHAR_LENGTH(REPLACE(b.subjectFullId,'/','') )>=0 GROUP BY a.customerId,a.yyyy,SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',1),'/',-1) ) UNION(SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',2),'/',-1) AS subjectId,a.direction,SUM(CASE WHEN a.subMonth=1 THEN a.remain ELSE 0 END) remain,SUM(debitOcc) AS debitOcc,SUM(creditOcc) AS creditOcc,SUM(CASE WHEN a.subMonth=12 THEN a.balance ELSE 0 END) balance FROM {lockDbName}.fin_account a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId=a.customerId AND b.yyyy=a.yyyy AND b.subjectId=a.subjectId WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.isLeaf1=1 AND CHAR_LENGTH(b.subjectFullId)-CHAR_LENGTH(REPLACE(b.subjectFullId,'/','') )>=1 GROUP BY a.customerId,a.yyyy,SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',2),'/',-1) ) UNION(SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',3),'/',-1) AS subjectId,a.direction,SUM(CASE WHEN a.subMonth=1 THEN a.remain ELSE 0 END) remain,SUM(debitOcc) AS debitOcc,SUM(creditOcc) AS creditOcc,SUM(CASE WHEN a.subMonth=12 THEN a.balance ELSE 0 END) balance FROM {lockDbName}.fin_account a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId=a.customerId AND b.yyyy=a.yyyy AND b.subjectId=a.subjectId WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.isLeaf1=1 AND CHAR_LENGTH(b.subjectFullId)-CHAR_LENGTH(REPLACE(b.subjectFullId,'/','') )>=2 GROUP BY a.customerId,a.yyyy,SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',3),'/',-1) ) UNION(SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',4),'/',-1) AS subjectId,a.direction,SUM(CASE WHEN a.subMonth=1 THEN a.remain ELSE 0 END) remain,SUM(debitOcc) AS debitOcc,SUM(creditOcc) AS creditOcc,SUM(CASE WHEN a.subMonth=12 THEN a.balance ELSE 0 END) balance FROM {lockDbName}.fin_account a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId=a.customerId AND b.yyyy=a.yyyy AND b.subjectId=a.subjectId WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.isLeaf1=1 AND CHAR_LENGTH(b.subjectFullId)-CHAR_LENGTH(REPLACE(b.subjectFullId,'/','') )>=3 GROUP BY a.customerId,a.yyyy,SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',4),'/',-1) ) UNION(SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',5),'/',-1) AS subjectId,a.direction,SUM(CASE WHEN a.subMonth=1 THEN a.remain ELSE 0 END) remain,SUM(debitOcc) AS debitOcc,SUM(creditOcc) AS creditOcc,SUM(CASE WHEN a.subMonth=12 THEN a.balance ELSE 0 END) balance FROM {lockDbName}.fin_account a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId=a.customerId AND b.yyyy=a.yyyy AND b.subjectId=a.subjectId WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.isLeaf1=1 AND CHAR_LENGTH(b.subjectFullId)-CHAR_LENGTH(REPLACE(b.subjectFullId,'/','') )>=4 GROUP BY a.customerId,a.yyyy,SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',5),'/',-1) ) ) b ON b.subjectId=a.subjectId) a WHERE EQFLAG=0) ) a 
#\u8F85\u52A9\u6838\u7B97\u9879\u76EE\u3001\u4F59\u989D\u6838\u5BF9\u6821\u9A8C
FIN200017=SELECT a.NAME,a.TITLE,a.NUM,IFNULL(a.AMOUNT,0) AS AMOUNT FROM((SELECT '\u8F85\u52A9\u6838\u7B97\u9879\u76EE\u3001\u4F59\u989D\u6838\u5BF9\u6821\u9A8C' AS NAME,'\u8F85\u52A9\u6838\u7B97\u9879\u76EE\u3001\u4F59\u989D\u76F8\u7B49' AS TITLE,COUNT(0) AS NUM,SUM(a.balanceP) AS AMOUNT FROM(SELECT a.customerId,a.yyyy,a.subjectId,a.fullName,a.direction,a.remain AS remainP,a.debitOcc AS debitOccP,a.creditOcc AS creditOccP,a.balance AS balanceP,b.remain AS remainS,b.debitOcc AS debitOccS,b.creditOcc AS creditOccS,b.balance AS balanceS,IF(a.remain=b.remain AND a.debitOcc=b.debitOcc AND a.creditOcc=b.creditOcc AND a.balance=b.balance,1,0) AS EQFLAG FROM(SELECT a.customerId,a.yyyy,a.subjectId,a.subjectFullName AS fullName,a.direction,SUM(CASE WHEN a.subMonth=1 THEN a.remain ELSE 0 END) remain,SUM(debitOcc) AS debitOcc,SUM(creditOcc) AS creditOcc,SUM(CASE WHEN a.subMonth=12 THEN a.balance ELSE 0 END) balance FROM {lockDbName}.fin_account a WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.hasAssItem=1 GROUP BY a.customerId,a.yyyy,a.subjectId) a LEFT JOIN (SELECT a.customerId,a.yyyy,a.subjectId,a.subjectFullName AS fullName,a.direction,SUM(CASE WHEN a.subMonth=1 THEN a.remain ELSE 0 END) remain,SUM(debitOcc) AS debitOcc,SUM(creditOcc) AS creditOcc,SUM(CASE WHEN a.subMonth=12 THEN a.balance ELSE 0 END) balance FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.isLeaf1=1 GROUP BY a.customerId,a.yyyy,a.subjectId) b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.subjectId = a.subjectId) a WHERE a.EQFLAG=1) UNION (SELECT '\u8F85\u52A9\u6838\u7B97\u9879\u76EE\u3001\u4F59\u989D\u6838\u5BF9\u6821\u9A8C' AS NAME,'\u8F85\u52A9\u6838\u7B97\u9879\u76EE\u3001\u4F59\u989D\u4E0D\u7B49' AS TITLE,COUNT(0) AS NUM,SUM(a.balanceP) AS AMOUNT FROM(SELECT a.customerId,a.yyyy,a.subjectId,a.fullName,a.direction,a.remain AS remainP,a.debitOcc AS debitOccP,a.creditOcc AS creditOccP,a.balance AS balanceP,b.remain AS remainS,b.debitOcc AS debitOccS,b.creditOcc AS creditOccS,b.balance AS balanceS,IF(a.remain=b.remain AND a.debitOcc=b.debitOcc AND a.creditOcc=b.creditOcc AND a.balance=b.balance,1,0) AS EQFLAG FROM(SELECT a.customerId,a.yyyy,a.subjectId,a.subjectFullName AS fullName,a.direction,SUM(CASE WHEN a.subMonth=1 THEN a.remain ELSE 0 END) remain,SUM(debitOcc) AS debitOcc,SUM(creditOcc) AS creditOcc,SUM(CASE WHEN a.subMonth=12 THEN a.balance ELSE 0 END) balance FROM {lockDbName}.fin_account a WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.hasAssItem=1 GROUP BY a.customerId,a.yyyy,a.subjectId) a LEFT JOIN (SELECT a.customerId,a.yyyy,a.subjectId,a.subjectFullName AS fullName,a.direction,SUM(CASE WHEN a.subMonth=1 THEN a.remain ELSE 0 END) remain,SUM(debitOcc) AS debitOcc,SUM(creditOcc) AS creditOcc,SUM(CASE WHEN a.subMonth=12 THEN a.balance ELSE 0 END) balance FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.isLeaf1=1 GROUP BY a.customerId,a.yyyy,a.subjectId) b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.subjectId = a.subjectId) a WHERE a.EQFLAG=0)) a
#\u6838\u7B97\u4F59\u989D<0\u6821\u9A8C
FIN200018=SELECT '\u6838\u7B97\u4F59\u989D\u6821\u9A8C' AS NAME,'\u6838\u7B97\u4F59\u989D\u4E0D\u5C0F\u4E8E0' AS TITLE,COUNT(0) AS NUM,SUM(ABS(a.balance)) AS AMOUNT FROM (SELECT customerId,yyyy,subjectId,SUM(balance) AS balance FROM {lockDbName}.fin_assitementryacc WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND subMonth=12 AND isLeaf1=1 GROUP BY customerId,yyyy,subjectId) a WHERE a.balance>=0 UNION ALL SELECT '\u6838\u7B97\u4F59\u989D\u6821\u9A8C' AS NAME,'\u6838\u7B97\u4F59\u989D\u5C0F\u4E8E0' AS TITLE,COUNT(0) AS NUM,SUM(ABS(a.balance)) AS AMOUNT FROM (SELECT customerId,yyyy,subjectId,SUM(balance) AS balance FROM {lockDbName}.fin_assitementryacc WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND subMonth=12 AND isLeaf1=1 GROUP BY customerId,yyyy,subjectId) a WHERE a.balance<0
#\u635F\u76CA\u662F\u5426\u7ED3\u8F6C\u6821\u9A8C
FIN200019=SELECT a.NAME,a.TITLE,a.NUM,IFNULL(a.AMOUNT,0) AS AMOUNT FROM(SELECT '\u635F\u76CA\u662F\u5426\u7ED3\u8F6C\u6821\u9A8C' AS NAME,'\u635F\u76CA\u7ED3\u8F6C\u79D1\u76EE' AS TITLE,COUNT(0) AS NUM,SUM(b.amount) AS AMOUNT FROM {lockDbName}.fin_account a,(SELECT subjectId,ABS(SUM(tranDebitOcc-tranCreditOcc) ) amount FROM {lockDbName}.fin_account WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} group by subjectId) b WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND a.subjectId=b.subjectId AND subMonth=12 AND balance=0 AND LEFT(a.subjectId,1) IN (SELECT LEFT(subjectId,1) FROM {lockDbName}.fin_accpkgsubject WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND subjectName IN('\u4E3B\u8425\u4E1A\u52A1\u6536\u5165','\u8425\u4E1A\u6536\u5165')) union all SELECT '\u635F\u76CA\u662F\u5426\u7ED3\u8F6C\u6821\u9A8C' AS NAME,'\u635F\u76CA\u672A\u7ED3\u8F6C\u79D1\u76EE' AS TITLE,COUNT(0) AS NUM,SUM(a.balance) AS AMOUNT FROM {lockDbName}.fin_account a WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND subMonth=12 AND balance<>0 AND LEFT(a.subjectId,1) IN (SELECT LEFT(subjectId,1) FROM {lockDbName}.fin_accpkgsubject WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND subjectName IN('\u4E3B\u8425\u4E1A\u52A1\u6536\u5165','\u8425\u4E1A\u6536\u5165'))) a
#\u5236\u5355\u4EBA\u5BF9\u5E94\u5206\u5F55
FIN200020=SELECT IFNULL(a.voucherFillUser,'\u65E0\u5236\u5355\u4EBA') AS voucherFillUser,COUNT(0) AS journalNum,SUM(a.debitOcc) AS debitOcc,SUM(a.creditOcc) AS creditOcc,SUM(a.debitOcc+a.creditOcc) AS totalOcc FROM(SELECT a.customerId,a.yyyy,a.voucherFillUser,CASE WHEN a.direction=1 THEN a.occurValue ELSE 0 END AS debitOcc,CASE WHEN a.direction=-1 THEN a.occurValue ELSE 0 END AS creditOcc FROM {lockDbName}.fin_subjectentry a WHERE 1=1 AND a.customerId={lockCustomerId} AND a.yyyy={lockYyyy}) a GROUP BY a.customerId,a.yyyy,a.voucherFillUser
#\u79D1\u76EE\u671F\u521D\u6570\u548C\u671F\u672B\u6570\u6821\u9A8C
FIN200021=SELECT a.NAME,a.TITLE,a.NUM,IFNULL(a.AMOUNT, 0) AS AMOUNT FROM (SELECT '\u79D1\u76EE\u671F\u521D\u6570\u548C\u671F\u672B\u6570\u6821\u9A8C' AS NAME,'\u672C\u5E74\u671F\u521D\u6570\u548C\u4E0A\u5E74\u671F\u672B\u6570\u76F8\u7B49' AS TITLE,COUNT(0) AS NUM,SUM(a.remain) AS AMOUNT FROM {lockDbName}.fin_account a left join (SELECT subjectId,(balance) AS amount FROM {lockDbName}.fin_account WHERE customerId ={lockCustomerId} AND yyyy ={param3} AND subMonth = 12 GROUP BY subjectId) b ON a.subjectId = b.subjectId WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND a.subMonth = 1 AND (a.remain) = IFNULL(b.amount,0) UNION ALL SELECT '\u79D1\u76EE\u671F\u521D\u6570\u548C\u671F\u672B\u6570\u6821\u9A8C' AS NAME,'\u672C\u5E74\u671F\u521D\u6570\u548C\u4E0A\u5E74\u671F\u672B\u6570\u4E0D\u76F8\u7B49' AS TITLE,COUNT(0) AS NUM,SUM(a.remain) AS AMOUNT FROM {lockDbName}.fin_account a left join (SELECT subjectId,(balance) AS amount FROM {lockDbName}.fin_account WHERE customerId ={lockCustomerId} AND yyyy ={param3} AND subMonth = 12 GROUP BY subjectId) b ON a.subjectId = b.subjectId WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND a.subMonth = 1 AND (a.remain) <> IFNULL(b.amount,0)) a
#\u6838\u7B97\u79D1\u76EE\u671F\u521D\u6570\u548C\u671F\u672B\u6570\u6821\u9A8C
FIN200022=SELECT a.NAME,a.TITLE,a.NUM,IFNULL(a.AMOUNT, 0) AS AMOUNT FROM (SELECT '\u6838\u7B97\u79D1\u76EE\u671F\u521D\u6570\u548C\u671F\u672B\u6570\u6821\u9A8C' AS NAME,'\u6838\u7B97\u672C\u5E74\u671F\u521D\u6570\u548C\u4E0A\u5E74\u671F\u672B\u6570\u76F8\u7B49' AS TITLE,COUNT(0) AS NUM,SUM(a.remain) AS AMOUNT FROM {lockDbName}.fin_assitementryacc a left join (SELECT assItemId,subjectId,(balance) AS amount FROM {lockDbName}.fin_assitementryacc WHERE customerId ={lockCustomerId} AND yyyy ={param3} AND subMonth = 12 GROUP BY assItemId,subjectId) b ON a.subjectId = b.subjectId and a.assItemId = b.assItemId WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND a.subMonth = 1 AND (a.remain) = IFNULL(b.amount,0) UNION ALL SELECT '\u6838\u7B97\u79D1\u76EE\u671F\u521D\u6570\u548C\u671F\u672B\u6570\u6821\u9A8C' AS NAME,'\u6838\u7B97\u672C\u5E74\u671F\u521D\u6570\u548C\u4E0A\u5E74\u671F\u672B\u6570\u4E0D\u76F8\u7B49' AS TITLE,COUNT(0) AS NUM,SUM(a.remain) AS AMOUNT FROM {lockDbName}.fin_assitementryacc a left join (SELECT assItemId,subjectId,(balance) AS amount FROM {lockDbName}.fin_assitementryacc WHERE customerId ={lockCustomerId} AND yyyy ={param3} AND subMonth = 12 GROUP BY assItemId,subjectId) b ON a.subjectId = b.subjectId and a.assItemId = b.assItemId WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND a.subMonth = 1 AND (a.remain) <> IFNULL(b.amount,0)) a
#\u4F59\u989D\u8868\u548C\u5916\u5E01\u4F59\u989D\u8868\u671F\u521D\u6570\u6821\u9A8C
FIN200023=SELECT a.NAME,a.TITLE,a.NUM,IFNULL(a.AMOUNT, 0) AS AMOUNT FROM (SELECT '\u4F59\u989D\u8868\u548C\u5916\u5E01\u4F59\u989D\u8868\u671F\u521D\u6570\u6821\u9A8C' AS NAME,'\u4F59\u989D\u8868\u548C\u5916\u5E01\u4F59\u989D\u8868\u671F\u521D\u6570\u76F8\u7B49' AS TITLE,COUNT(0) AS NUM,SUM(a.remain) AS AMOUNT FROM (SELECT b.customerId,b.yyyy,b.subjectId,IFNULL(a.remain,0) AS remain,SUM(IFNULL(b.remainF,0)) AS remainF FROM {lockDbName}.fin_accountall b LEFT JOIN {lockDbName}.fin_account a ON a.customerId = b.customerId AND a.yyyy = b.yyyy AND a.subjectId = b.subjectId AND a.isLeaf1 = 1 AND a.subMonth = 1 WHERE b.customerId = {lockCustomerId} AND b.yyyy = {lockYyyy} AND b.isLeaf1 = 1 AND b.subMonth = 1 GROUP BY b.customerId,b.yyyy,b.subjectId HAVING remain = remainF) a UNION ALL SELECT '\u4F59\u989D\u8868\u548C\u5916\u5E01\u4F59\u989D\u8868\u671F\u521D\u6570\u6821\u9A8C' AS NAME,'\u4F59\u989D\u8868\u548C\u5916\u5E01\u4F59\u989D\u8868\u671F\u521D\u6570\u4E0D\u76F8\u7B49' AS TITLE,COUNT(0) AS NUM,SUM(a.remain) AS AMOUNT FROM (SELECT b.customerId,b.yyyy,b.subjectId,IFNULL(a.remain,0) AS remain,SUM(IFNULL(b.remainF,0)) AS remainF FROM {lockDbName}.fin_accountall b LEFT JOIN {lockDbName}.fin_account a ON a.customerId = b.customerId AND a.yyyy = b.yyyy AND a.subjectId = b.subjectId AND a.isLeaf1 = 1 AND a.subMonth = 1 WHERE b.customerId = {lockCustomerId} AND b.yyyy = {lockYyyy} AND b.isLeaf1 = 1 AND b.subMonth = 1 GROUP BY b.customerId,b.yyyy,b.subjectId HAVING remain != remainF) a) a
#\u4F59\u989D\u8868\u548C\u5916\u5E01\u4F59\u989D\u8868\u671F\u672B\u6570\u6821\u9A8C
FIN200024=SELECT a.NAME,a.TITLE,a.NUM,IFNULL(a.AMOUNT, 0) AS AMOUNT FROM (SELECT '\u4F59\u989D\u8868\u548C\u5916\u5E01\u4F59\u989D\u8868\u671F\u672B\u6570\u6821\u9A8C' AS NAME,'\u4F59\u989D\u8868\u548C\u5916\u5E01\u4F59\u989D\u8868\u671F\u672B\u6570\u76F8\u7B49' AS TITLE,COUNT(0) AS NUM,SUM(a.balance) AS AMOUNT FROM (SELECT b.customerId,b.yyyy,b.subjectId,IFNULL(a.balance,0) AS balance,SUM(IFNULL(b.balanceF,0)) AS balanceF FROM {lockDbName}.fin_accountall b LEFT JOIN {lockDbName}.fin_account a ON a.customerId = b.customerId AND a.yyyy = b.yyyy AND a.subjectId = b.subjectId AND a.isLeaf1 = 1 AND a.subMonth = 12 WHERE b.customerId = {lockCustomerId} AND b.yyyy = {lockYyyy} AND b.isLeaf1 = 1 AND b.subMonth = 12 GROUP BY b.customerId,b.yyyy,b.subjectId HAVING balance = balanceF) a UNION ALL SELECT '\u4F59\u989D\u8868\u548C\u5916\u5E01\u4F59\u989D\u8868\u671F\u672B\u6570\u6821\u9A8C' AS NAME,'\u4F59\u989D\u8868\u548C\u5916\u5E01\u4F59\u989D\u8868\u671F\u672B\u6570\u4E0D\u76F8\u7B49' AS TITLE,COUNT(0) AS NUM,SUM(a.balance) AS AMOUNT FROM (SELECT b.customerId,b.yyyy,b.subjectId,IFNULL(a.balance,0) AS balance,SUM(IFNULL(b.balanceF,0)) AS balanceF FROM {lockDbName}.fin_accountall b LEFT JOIN {lockDbName}.fin_account a ON a.customerId = b.customerId AND a.yyyy = b.yyyy AND a.subjectId = b.subjectId AND a.isLeaf1 = 1 AND a.subMonth = 12 WHERE b.customerId = {lockCustomerId} AND b.yyyy = {lockYyyy} AND b.isLeaf1 = 1 AND b.subMonth = 12 GROUP BY b.customerId,b.yyyy,b.subjectId HAVING balance != balanceF) a) a
#\u6838\u7B97\u4F59\u989D\u8868\u548C\u5916\u5E01\u6838\u7B97\u4F59\u989D\u8868\u671F\u521D\u6570\u6821\u9A8C
FIN200025=SELECT a.NAME,a.TITLE,a.NUM,IFNULL(a.AMOUNT, 0) AS AMOUNT FROM (SELECT '\u6838\u7B97\u4F59\u989D\u8868\u548C\u5916\u5E01\u6838\u7B97\u4F59\u989D\u8868\u671F\u521D\u6570\u6821\u9A8C' AS NAME,'\u6838\u7B97\u4F59\u989D\u8868\u548C\u5916\u5E01\u6838\u7B97\u4F59\u989D\u8868\u671F\u521D\u6570\u76F8\u7B49' AS TITLE,COUNT(0) AS NUM,SUM(a.remain) AS AMOUNT FROM (SELECT b.customerId,b.yyyy,b.subjectId,b.assItemId,IFNULL(a.remain,0) AS remain,SUM(IFNULL(b.remainF,0)) AS remainF FROM {lockDbName}.fin_assitementryaccall b LEFT JOIN {lockDbName}.fin_assitementryacc a ON a.customerId = b.customerId AND a.yyyy = b.yyyy AND a.subjectId = b.subjectId AND a.assItemId = b.assItemId AND a.isLeaf1 = 1 AND a.subMonth = 1 WHERE b.customerId = {lockCustomerId} AND b.yyyy = {lockYyyy} AND b.isLeaf1 = 1 AND b.subMonth = 1 GROUP BY b.customerId,b.yyyy,b.subjectId,b.assItemId HAVING remain = remainF) a UNION ALL SELECT '\u6838\u7B97\u4F59\u989D\u8868\u548C\u5916\u5E01\u6838\u7B97\u4F59\u989D\u8868\u671F\u521D\u6570\u6821\u9A8C' AS NAME,'\u6838\u7B97\u4F59\u989D\u8868\u548C\u5916\u5E01\u6838\u7B97\u4F59\u989D\u8868\u671F\u521D\u6570\u4E0D\u76F8\u7B49' AS TITLE,COUNT(0) AS NUM,SUM(a.remain) AS AMOUNT FROM (SELECT b.customerId,b.yyyy,b.subjectId,b.assItemId,IFNULL(a.remain,0) AS remain,SUM(IFNULL(b.remainF,0)) AS remainF FROM {lockDbName}.fin_assitementryaccall b LEFT JOIN {lockDbName}.fin_assitementryacc a ON a.customerId = b.customerId AND a.yyyy = b.yyyy AND a.subjectId = b.subjectId AND a.assItemId = b.assItemId AND a.isLeaf1 = 1 AND a.subMonth = 1 WHERE b.customerId = {lockCustomerId} AND b.yyyy = {lockYyyy} AND b.isLeaf1 = 1 AND b.subMonth = 1 GROUP BY b.customerId,b.yyyy,b.subjectId,b.assItemId HAVING remain != remainF) a) a
#\u6838\u7B97\u4F59\u989D\u8868\u548C\u5916\u5E01\u6838\u7B97\u4F59\u989D\u8868\u671F\u672B\u6570\u6821\u9A8C
FIN200026=SELECT a.NAME,a.TITLE,a.NUM,IFNULL(a.AMOUNT, 0) AS AMOUNT FROM (SELECT '\u6838\u7B97\u4F59\u989D\u8868\u548C\u5916\u5E01\u6838\u7B97\u4F59\u989D\u8868\u671F\u672B\u6570\u6821\u9A8C' AS NAME,'\u6838\u7B97\u4F59\u989D\u8868\u548C\u5916\u5E01\u6838\u7B97\u4F59\u989D\u8868\u671F\u672B\u6570\u76F8\u7B49' AS TITLE,COUNT(0) AS NUM,SUM(a.balance) AS AMOUNT FROM (SELECT b.customerId,b.yyyy,b.subjectId,b.assItemId,IFNULL(a.balance,0) AS balance,SUM(IFNULL(b.balanceF,0)) AS balanceF FROM {lockDbName}.fin_assitementryaccall b LEFT JOIN {lockDbName}.fin_assitementryacc a ON a.customerId = b.customerId AND a.yyyy = b.yyyy AND a.subjectId = b.subjectId AND a.assItemId = b.assItemId AND a.isLeaf1 = 1 AND a.subMonth = 12 WHERE b.customerId = {lockCustomerId} AND b.yyyy = {lockYyyy} AND b.isLeaf1 = 1 AND b.subMonth = 12 GROUP BY b.customerId,b.yyyy,b.subjectId,b.assItemId HAVING balance = balanceF) a UNION ALL SELECT '\u6838\u7B97\u4F59\u989D\u8868\u548C\u5916\u5E01\u6838\u7B97\u4F59\u989D\u8868\u671F\u672B\u6570\u6821\u9A8C' AS NAME,'\u6838\u7B97\u4F59\u989D\u8868\u548C\u5916\u5E01\u6838\u7B97\u4F59\u989D\u8868\u671F\u672B\u6570\u4E0D\u76F8\u7B49' AS TITLE,COUNT(0) AS NUM,SUM(a.balance) AS AMOUNT FROM (SELECT b.customerId,b.yyyy,b.subjectId,b.assItemId,IFNULL(a.balance,0) AS balance,SUM(IFNULL(b.balanceF,0)) AS balanceF FROM {lockDbName}.fin_assitementryaccall b LEFT JOIN {lockDbName}.fin_assitementryacc a ON a.customerId = b.customerId AND a.yyyy = b.yyyy AND a.subjectId = b.subjectId AND a.assItemId = b.assItemId AND a.isLeaf1 = 1 AND a.subMonth = 12 WHERE b.customerId = {lockCustomerId} AND b.yyyy = {lockYyyy} AND b.isLeaf1 = 1 AND b.subMonth = 12 GROUP BY b.customerId,b.yyyy,b.subjectId,b.assItemId HAVING balance != balanceF) a) a
#\u67E5\u8BE2\u5236\u5355\u4EBA\u548C\u5BA1\u6838\u4EBA\u6743\u9650
FIN200027=SELECT a.customerId,a.yyyy,a.userName,a.roleName,a.subjectId,a.subjectName from {lockDbName}.fin_subjectvoucherAuth a where a.customerId={lockCustomerId} /*START #param1# AND a.yyyy={param1} #param1# END*/
#\u5236\u5355\u4EBA\u548C\u5BA1\u6838\u4EBA\u6743\u9650\u6821\u9A8C
FIN200028=SELECT a.NAME,a.TITLE,a.NUM,IFNULL(a.AMOUNT, 0) AS AMOUNT FROM (select '\u7F16\u5236\u4EBA\u5458\u6743\u9650\u6821\u9A8C' AS NAME,'\u7F16\u5236\u4EBA\u5458\u6743\u9650\u6B63\u786E' AS TITLE,sum(case when fillNum > 0 and auditNum > 0 then 1 else 0 end) AS NUM,sum(case when fillNum > 0 and auditNum > 0 then t1.debitocc + t1.creditocc else 0 end) AS AMOUNT from {lockDbName}.fin_subjectvoucher t1 inner join (select a.voucherId,sum(case when (SUBSTRING_INDEX(b.subjectFullId, '/', 1) = c.subjectId or c.subjectId = '') and c.roleName = '\u5236\u5355\u4EBA' then 1 else 0 end) as fillNum,sum(case when ((SUBSTRING_INDEX(b.subjectFullId, '/', 1) = c.subjectId or c.subjectId = '') and c.roleName = '\u5BA1\u6838\u4EBA') or (a.voucherAuditUser = '' or a.voucherAuditUser is null) then 1 else 0 end) as auditNum from {lockDbName}.fin_subjectentry a inner join {lockDbName}.fin_accpkgsubject b on a.subjectId = b.subjectId and a.customerId = b.customerId and a.yyyy = b.yyyy left join {lockDbName}.fin_subjectvoucherauth c on a.customerId = c.customerId and a.yyyy = c.yyyy and ((a.voucherFillUser = c.userName and c.roleName = '\u5236\u5355\u4EBA') or (a.voucherAuditUser = c.userName and c.roleName = '\u5BA1\u6838\u4EBA')) where a.customerId = {lockCustomerId} and a.yyyy = {lockYyyy} group by a.voucherId) t2 on t1.oldVoucherId = t2.voucherId where t1.customerId = {lockCustomerId} and t1.yyyy = {lockYyyy} union all select '\u7F16\u5236\u4EBA\u5458\u6743\u9650\u6821\u9A8C' AS NAME,'\u7F16\u5236\u4EBA\u5458\u6743\u9650\u4E0D\u6B63\u786E' AS TITLE,sum(case when fillNum > 0 and auditNum > 0 then 0 else 1 end) AS NUM,sum(case when fillNum > 0 and auditNum > 0 then 0 else t1.debitocc + t1.creditocc end) AS AMOUNT from {lockDbName}.fin_subjectvoucher t1 inner join (select a.voucherId,sum(case when (SUBSTRING_INDEX(b.subjectFullId, '/', 1) = c.subjectId or c.subjectId = '') and c.roleName = '\u5236\u5355\u4EBA' then 1 else 0 end) as fillNum,sum(case when ((SUBSTRING_INDEX(b.subjectFullId, '/', 1) = c.subjectId or c.subjectId = '') and c.roleName = '\u5BA1\u6838\u4EBA') or (a.voucherAuditUser = '' or a.voucherAuditUser is null) then 1 else 0 end) as auditNum from {lockDbName}.fin_subjectentry a inner join {lockDbName}.fin_accpkgsubject b on a.subjectId = b.subjectId and a.customerId = b.customerId and a.yyyy = b.yyyy left join {lockDbName}.fin_subjectvoucherauth c on a.customerId = c.customerId and a.yyyy = c.yyyy and ((a.voucherFillUser = c.userName and c.roleName = '\u5236\u5355\u4EBA') or (a.voucherAuditUser = c.userName and c.roleName = '\u5BA1\u6838\u4EBA')) where a.customerId = {lockCustomerId} and a.yyyy = {lockYyyy} group by a.voucherId) t2 on t1.oldVoucherId = t2.voucherId where t1.customerId = {lockCustomerId} and t1.yyyy = {lockYyyy}) a
#\u6821\u9A8C\u8BE6\u7EC6\u5217\u8868
#\u67E5\u8BE2\u51ED\u8BC1\u8BE6\u7EC6\u4FE1\u606F
FIN201001=SELECT a.customerId,a.yyyy,a.oldVoucherId AS voucherId,a.voucherId AS oldVoucherId,a.typeId,a.vchDate,a.voucherFillUser,a.voucherAuditUser,a.voucherKeepUser,a.debitocc,a.creditocc,b.type AS dateType FROM {lockDbName}.fin_subjectvoucher a LEFT JOIN bdo_base.base_holiday b ON b.holiday = a.vchDate WHERE 1=1 AND a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} /*START #param4# {param4} #param4# END*/ ORDER BY a.customerId,a.yyyy,a.voucherId,a.vchDate
#\u67E5\u8BE2\u5206\u5F55\u8BE6\u7EC6\u4FE1\u606F
FIN201002=SELECT a.customerId,a.yyyy,a.voucherId,a.oldVoucherId,a.vchDate,a.typeId,a.summary,a.subjectId,IF(a.direction=1,'\u501F','\u8D37') AS direction,a.occurValue,a.currRate,a.currValue,a.currency,a.voucherFillUser AS voucherFillUser,a.voucherAuditUser AS voucherAuditUser,a.voucherKeepUser AS voucherKeepUser,a.subjectName AS subjectName,a.subjectFullName AS fullName,b.type AS dateType FROM {lockDbName}.fin_subjectentry a LEFT JOIN bdo_base.base_holiday b ON b.holiday=a.vchDate WHERE 1=1 AND a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} /*START #param4# {param4} #param4# END*/ ORDER BY a.customerId,a.yyyy,a.voucherId,a.oldVoucherId,a.serail
#\u79D1\u76EE\u4F59\u989D\u3001\u53D1\u751F\u989D\u5E73\u8861\u6027\u6821\u9A8C\u8BE6\u7EC6
FIN201003=SELECT a.customerId,a.yyyy,a.subjectId,a.subjectName,a.remainP,a.debitOccP,a.debitOccS,a.creditOccP,a.creditOccS,a.balanceP,IF(a.direction=1,'\u501F','\u8D37') AS direction,a.isLeaf1,a.subLevel,a.fullName,a.debitOcc,a.creditOcc FROM(SELECT a.customerId,a.yyyy,a.subjectId,a.subjectName AS subjectName,MAX(CASE WHEN a.subMonth=1 THEN  a.remain END) AS remainP,SUM(CASE WHEN 1<=a.subMonth<=12 THEN a.debitOcc END) AS debitOccP,IFNULL(b.debitOccS,0) AS debitOccS,SUM(CASE WHEN 1<=a.subMonth<=12 THEN a.creditOcc END) AS creditOccP,IFNULL(b.creditOccS,0) AS creditOccS,MAX(CASE WHEN a.subMonth=12 THEN  a.balance END) AS balanceP,a.direction,a.isLeaf1 AS isLeaf1,a.level1 AS subLevel,a.subjectFullName AS fullName,SUM(CASE WHEN a.isLeaf1=1 AND 1<=a.subMonth<=12 THEN a.debitOcc END) AS debitOcc,SUM(CASE WHEN a.isLeaf1=1 AND 1<=a.subMonth<=12 THEN a.creditOcc END) AS creditOcc FROM {lockDbName}.fin_account a LEFT JOIN(SELECT t1.customerId,t1.yyyy AS yyyy,t2.parentSubjectId AS subjectId,SUM(CASE WHEN t1.direction=1 THEN t1.occurValue ELSE 0 END) AS debitOccS,SUM(CASE WHEN t1.direction=-1 THEN t1.occurValue ELSE 0 END) AS creditOccS FROM(SELECT b.customerId,b.yyyy,b.subjectId,b.direction,b.occurValue FROM {lockDbName}.fin_subjectentry b WHERE b.customerId={lockCustomerId} AND b.yyyy={lockYyyy}) t1,(SELECT a1.customerId,a1.yyyy,a1.subjectId parentSubjectId,a2.subjectId FROM {lockDbName}.fin_accpkgsubject a1,{lockDbName}.fin_accpkgsubject a2 WHERE a1.customerId={lockCustomerId} AND a1.yyyy={lockYyyy} AND a2.customerId={lockCustomerId} AND a2.yyyy={lockYyyy} AND a2.subjectFullId LIKE CONCAT(a1.subjectFullId,'/%') UNION SELECT a1.customerId,a1.yyyy,a1.subjectId parentSubjectId,a1.subjectId FROM {lockDbName}.fin_accpkgsubject a1 WHERE a1.customerId={lockCustomerId} AND a1.yyyy={lockYyyy}) t2 WHERE t1.customerId=t2.customerId AND t1.yyyy=t2.yyyy AND t1.subjectId=t2.subjectId GROUP BY t1.customerId,t1.yyyy,t2.parentSubjectId) b ON b.customerId=a.customerId AND b.yyyy=a.yyyy AND b.subjectId=a.subjectId WHERE 1=1 AND a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} GROUP BY a.customerId,a.yyyy,a.subjectId ORDER BY a.customerId,a.yyyy,a.subjectId) a WHERE 1=1 AND /*START #param4# {param4} #param4# END*/(a.debitOccP=a.debitOccS AND a.creditOccP=a.creditOccS) ORDER BY a.customerId,a.yyyy,a.subjectId
#\u79D1\u76EE\u91CD\u590D\u6821\u9A8C\u8BE6\u7EC6
FIN201004=SELECT a.customerId,a.yyyy,a.voucherId,a.oldVoucherId,a.typeId,a.vchDate,a.voucherFillUser AS voucherFillUser,a.voucherAuditUser AS voucherAuditUser,a.voucherKeepUser AS voucherKeepUser,SUM(CASE WHEN a.direction=1 THEN a.occurValue ELSE 0 END) AS debitocc,SUM(CASE WHEN a.direction=-1 THEN a.occurValue ELSE 0 END) AS creditocc FROM {lockDbName}.fin_subjectentry a WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.voucherId /*START #param4# {param4} #param4# END*/ IN(SELECT DISTINCT a.voucherId FROM(SELECT COUNT(0) AS REPEATFLAG,a.voucherId FROM(SELECT a.customerId,a.yyyy,a.voucherId,a.subjectId,a.direction FROM {lockDbName}.fin_subjectentry a WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} GROUP BY a.customerId,a.yyyy,a.voucherId,a.subjectId,a.direction) a GROUP BY a.customerId,a.yyyy,a.voucherId,a.subjectId) a WHERE a.REPEATFLAG>1) GROUP BY a.customerId,a.yyyy,a.voucherId ORDER BY a.customerId,a.yyyy,a.oldVoucherId,a.vchDate
#\u4F59\u989D\u8868\u7EA7\u6B21\u6821\u9A8C\u8BE6\u7EC6
FIN201005=SELECT a.subjectId,a.fullName,IF(a.direction=1,'\u501F','\u8D37') AS direction,a.remain AS remainP,a.debitOcc AS debitOccP,a.creditOcc AS creditOccP,a.balance AS balanceP,b.remain AS remainS,b.debitOcc AS debitOccS,b.creditOcc AS creditOccS,b.balance AS balanceS,{param25} AS EQFLAG FROM(SELECT a.subjectId,a.subjectFullName AS fullName,a.direction,SUM(CASE WHEN a.subMonth=1 THEN a.remain ELSE 0 END) remain,SUM(debitOcc) AS debitOcc,SUM(creditOcc) AS creditOcc,SUM(CASE WHEN a.subMonth=12 THEN a.balance ELSE 0 END) balance FROM {lockDbName}.fin_account a WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} GROUP BY a.customerId,a.yyyy,a.subjectId) a LEFT JOIN((SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',1),'/',-1) AS subjectId,a.direction,SUM(CASE WHEN a.subMonth=1 THEN a.remain ELSE 0 END) remain,SUM(debitOcc) AS debitOcc,SUM(creditOcc) AS creditOcc,SUM(CASE WHEN a.subMonth=12 THEN a.balance ELSE 0 END) balance FROM {lockDbName}.fin_account a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId=a.customerId AND b.yyyy=a.yyyy AND b.subjectId=a.subjectId WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.isLeaf1=1 AND CHAR_LENGTH(b.subjectFullId)-CHAR_LENGTH(REPLACE(b.subjectFullId,'/','') )>=0 GROUP BY a.customerId,a.yyyy,SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',1),'/',-1) ) UNION(SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',2),'/',-1) AS subjectId,a.direction,SUM(CASE WHEN a.subMonth=1 THEN a.remain ELSE 0 END) remain,SUM(debitOcc) AS debitOcc,SUM(creditOcc) AS creditOcc,SUM(CASE WHEN a.subMonth=12 THEN a.balance ELSE 0 END) balance FROM {lockDbName}.fin_account a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId=a.customerId AND b.yyyy=a.yyyy AND b.subjectId=a.subjectId WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.isLeaf1=1 AND CHAR_LENGTH(b.subjectFullId)-CHAR_LENGTH(REPLACE(b.subjectFullId,'/','') )>=1 GROUP BY a.customerId,a.yyyy,SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',2),'/',-1) ) UNION(SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',3),'/',-1) AS subjectId,a.direction,SUM(CASE WHEN a.subMonth=1 THEN a.remain ELSE 0 END) remain,SUM(debitOcc) AS debitOcc,SUM(creditOcc) AS creditOcc,SUM(CASE WHEN a.subMonth=12 THEN a.balance ELSE 0 END) balance FROM {lockDbName}.fin_account a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId=a.customerId AND b.yyyy=a.yyyy AND b.subjectId=a.subjectId WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.isLeaf1=1 AND CHAR_LENGTH(b.subjectFullId)-CHAR_LENGTH(REPLACE(b.subjectFullId,'/','') )>=2 GROUP BY a.customerId,a.yyyy,SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',3),'/',-1) ) UNION(SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',4),'/',-1) AS subjectId,a.direction,SUM(CASE WHEN a.subMonth=1 THEN a.remain ELSE 0 END) remain,SUM(debitOcc) AS debitOcc,SUM(creditOcc) AS creditOcc,SUM(CASE WHEN a.subMonth=12 THEN a.balance ELSE 0 END) balance FROM {lockDbName}.fin_account a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId=a.customerId AND b.yyyy=a.yyyy AND b.subjectId=a.subjectId WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.isLeaf1=1 AND CHAR_LENGTH(b.subjectFullId)-CHAR_LENGTH(REPLACE(b.subjectFullId,'/','') )>=3 GROUP BY a.customerId,a.yyyy,SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',4),'/',-1) ) UNION(SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',5),'/',-1) AS subjectId,a.direction,SUM(CASE WHEN a.subMonth=1 THEN a.remain ELSE 0 END) remain,SUM(debitOcc) AS debitOcc,SUM(creditOcc) AS creditOcc,SUM(CASE WHEN a.subMonth=12 THEN a.balance ELSE 0 END) balance FROM {lockDbName}.fin_account a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId=a.customerId AND b.yyyy=a.yyyy AND b.subjectId=a.subjectId WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.isLeaf1=1 AND CHAR_LENGTH(b.subjectFullId)-CHAR_LENGTH(REPLACE(b.subjectFullId,'/','') )>=4 GROUP BY a.customerId,a.yyyy,SUBSTRING_INDEX(SUBSTRING_INDEX(b.subjectFullId,'/',5),'/',-1) ) ) b ON b.subjectId=a.subjectId WHERE {param25}={param4}
#\u6821\u9A8C\u4F59\u989D\u8868\u67E5\u8BE2
FIN201006=SELECT a.subjectId,a.fullName,IF(a.direction=1,'\u501F','\u8D37') AS direction,a.remain AS remainP,a.debitOcc AS debitOccP,a.creditOcc AS creditOccP,a.balance AS balanceP,b.remain AS remainS,b.debitOcc AS debitOccS,b.creditOcc AS creditOccS,b.balance AS balanceS FROM(SELECT a.customerId,a.yyyy,a.subjectId,a.subjectFullName AS fullName,a.direction,SUM(CASE WHEN a.subMonth=1 THEN a.remain ELSE 0 END) remain,SUM(debitOcc) AS debitOcc,SUM(creditOcc) AS creditOcc,SUM(CASE WHEN a.subMonth=12 THEN a.balance ELSE 0 END) balance FROM {lockDbName}.fin_account a WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.hasAssItem=1 GROUP BY a.customerId,a.yyyy,a.subjectId) a LEFT JOIN (SELECT a.customerId,a.yyyy,a.subjectId,a.subjectFullName AS fullName,a.direction,SUM(CASE WHEN a.subMonth=1 THEN a.remain ELSE 0 END) remain,SUM(debitOcc) AS debitOcc,SUM(creditOcc) AS creditOcc,SUM(CASE WHEN a.subMonth=12 THEN a.balance ELSE 0 END) balance FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.isLeaf1=1 GROUP BY a.customerId,a.yyyy,a.subjectId) b ON b.customerId = a.customerId AND b.yyyy=a.yyyy AND b.subjectId=a.subjectId WHERE {param25}={param4}
#\u67E5\u635F\u76CA\u662F\u5426\u7ED3\u8F6C\u6821\u9A8C\u8BE6\u7EC6
FIN201007=SELECT * FROM(SELECT a.customerId,a.yyyy,a.subjectId,a.subjectFullName AS fullName,IF(a.direction=1,'\u501F','\u8D37') AS direction,sum(case when a.subMonth=1 then remain else 0 end) remain,sum(case when a.subMonth=12 then balance else 0 end) balance,sum(case when a.subMonth=12 then debitTotalOcc else 0 end) debitTotalOcc,sum(case when a.subMonth=12 then creditTotalOcc else 0 end) creditTotalOcc,ABS(SUM(tranDebitOcc-tranCreditOcc) ) tranOcc FROM {lockDbName}.fin_account a WHERE customerid={lockCustomerId} AND yyyy={lockYyyy} AND LEFT(a.subjectId,1) IN (SELECT LEFT(subjectId,1) FROM {lockDbName}.fin_accpkgsubject WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND subjectName IN('\u4E3B\u8425\u4E1A\u52A1\u6536\u5165','\u8425\u4E1A\u6536\u5165')) group by customerid,yyyy,subjectId,subjectFullName,direction) t WHERE {param4}
#\u67E5\u8BE2\u51ED\u8BC1
FIN201008=SELECT a.customerId,a.yyyy,a.voucherId AS oldVoucherId,a.typeId,a.vchDate,a.voucherFillUser,a.voucherAuditUser,a.voucherKeepUser,a.debitocc,a.creditocc FROM {lockDbName}.fin_subjectvoucher a WHERE 1=1 AND a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} /*START #param3# AND a.voucherId='{param3}' #param3# END*/ /*START #param4# AND a.vchDate='{param4}' #param4# END*/ ORDER BY a.customerId,a.yyyy,a.voucherId,a.vchDate
#\u67E5\u8BE2\u5206\u5F55
FIN201009=SELECT a.customerId,a.yyyy,a.voucherId,a.oldVoucherId,a.vchDate,a.typeId,a.summary,a.subjectId,IF(a.direction=1,'\u501F','\u8D37') AS direction,a.occurValue,a.currRate,a.currValue,a.currency,a.voucherFillUser,a.voucherAuditUser,a.voucherKeepUser,a.subjectName,a.subjectFullName FROM {lockDbName}.fin_subjectentry a WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} /*START #param3# AND a.oldVoucherId='{param3}' #param3# END*/ /*START #param4# AND a.vchDate='{param4}' #param4# END*/ /*START #param5# AND a.subjectId LIKE '{param5}%' #param5# END*/ ORDER BY a.customerId,a.yyyy,a.voucherId,a.oldVoucherId,a.serail
#\u67E5\u79D1\u76EE\u671F\u521D\u6570\u548C\u671F\u672B\u6570\u6821\u9A8C\u8BE6\u7EC6
FIN201010=SELECT a.customerId,a.yyyy,a.subjectId,a.subjectFullName AS fullName,IF(a.direction=1,'\u501F','\u8D37') AS direction,sum(case when a.subMonth=1 then remain else 0 end) remain,sum(case when a.subMonth=12 then balance else 0 end) balance,sum(case when a.subMonth=12 then debitTotalOcc else 0 end) debitTotalOcc,sum(case when a.subMonth=12 then creditTotalOcc else 0 end) creditTotalOcc,ABS(SUM(tranDebitOcc-tranCreditOcc) ) tranOcc ,IFNULL(b.amount,0) as amount FROM {lockDbName}.fin_account a left join (SELECT subjectid,(balance) AS amount FROM {lockDbName}.fin_account WHERE customerId ={lockCustomerId} AND yyyy ={param5} AND subMonth = 12 GROUP BY subjectId) b ON a.subjectId = b.subjectId WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} {param4} GROUP BY a.subjectId 
#\u67E5\u6838\u7B97\u79D1\u76EE\u671F\u521D\u6570\u548C\u671F\u672B\u6570\u6821\u9A8C\u8BE6\u7EC6
FIN201011=SELECT a.customerId,a.yyyy,a.assItemId,a.assTotalName,a.subjectId,a.subjectFullName AS fullName,IF(a.direction=1,'\u501F','\u8D37') AS direction,sum(case when a.subMonth=1 then remain else 0 end) remain,sum(case when a.subMonth=12 then balance else 0 end) balance,sum(case when a.subMonth=12 then debitTotalOcc else 0 end) debitTotalOcc,sum(case when a.subMonth=12 then creditTotalOcc else 0 end) creditTotalOcc,ABS(SUM(tranDebitOcc-tranCreditOcc) ) tranOcc ,IFNULL(b.amount,0) as amount FROM {lockDbName}.fin_assitementryacc a left join (SELECT assItemId,subjectid,(balance) AS amount FROM {lockDbName}.fin_assitementryacc WHERE customerId ={lockCustomerId} AND yyyy ={param5} AND subMonth = 12 GROUP BY assItemId,subjectId) b ON a.subjectId = b.subjectId and a.assItemId = b.assItemId WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} {param4} GROUP BY a.assItemId,a.subjectId 
#\u67E5\u4F59\u989D\u8868\u548C\u5916\u5E01\u4F59\u989D\u8868\u671F\u521D\u6570\u6821\u9A8C\u8BE6\u7EC6
#FIN201012=SELECT a.*, b.remainF,b.balanceF from (select b.customerId,b.yyyy,b.subMonth,b.subjectId,sum(case when b.subMonth=1 then remainF else 0 end) as remainF,sum(case when b.subMonth=12 then balanceF else 0 end) as balanceF from {lockDbName}.fin_accountall b where b.customerId = {lockCustomerId} and b.yyyy = {lockYyyy} group by b.customerId,b.yyyy,b.subjectId) b left join (SELECT a.customerId,a.yyyy,a.subMonth,a.subjectId,a.subjectFullName AS fullName,IF(a.direction=1,'\u501F','\u8D37') AS direction,sum(case when a.subMonth=1 then remain else 0 end) AS remain,sum(case when a.subMonth=12 then balance else 0 end) AS balance FROM {lockDbName}.fin_account a WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} GROUP BY a.customerId,a.yyyy,a.subjectId ) a ON a.customerId = b.customerId and a.yyyy = b.yyyy and a.subjectId = b.subjectId WHERE 1 = 1 /*START #param4# AND IFNULL(a.remain,'') = IFNULL(b.remainF,'') #param4# END*/ /*START #param5# AND IFNULL(a.remain,'') <> IFNULL(b.remainF,'') #param5# END*/ /*START #param6# AND IFNULL(a.balance,'') = IFNULL(b.balanceF,'') #param6# END*/ /*START #param7# AND IFNULL(a.balance,'') <> IFNULL(b.balanceF,'') #param7# END*/
FIN201012=SELECT * FROM (SELECT b.customerId,b.yyyy,b.subjectId,b.subjectFullName AS fullName,IF(b.direction=1,'\u501F','\u8D37') AS direction,IFNULL(a.remain,0) AS remain,SUM(IFNULL(b.remainF,0)) AS remainF FROM {lockDbName}.fin_accountall b LEFT JOIN {lockDbName}.fin_account a ON a.customerId = b.customerId AND a.yyyy = b.yyyy AND a.subjectId = b.subjectId AND a.isLeaf1 = 1 AND a.subMonth = 1 WHERE b.customerId = {lockCustomerId} AND b.yyyy = {lockYyyy} AND b.isLeaf1 = 1 AND b.subMonth = 1 GROUP BY b.customerId,b.yyyy,b.subjectId /*START #param4# HAVING remain = remainF #param4# END*/ /*START #param5# HAVING remain != remainF #param5# END*/ ORDER BY b.customerId,b.yyyy,b.subjectId) a
#\u67E5\u4F59\u989D\u8868\u548C\u5916\u5E01\u4F59\u989D\u8868\u671F\u672B\u6570\u6821\u9A8C\u8BE6\u7EC6
#FIN201013=SELECT a.*, b.remainF,b.balanceF from (select b.customerId,b.yyyy,b.subMonth,b.subjectId,b.assItemId,sum(case when b.subMonth=1 then remainF else 0 end) as remainF,sum(case when b.subMonth=12 then balanceF else 0 end) as balanceF from {lockDbName}.fin_assitementryaccall b where b.customerId = {lockCustomerId} and b.yyyy = {lockYyyy} group by b.customerId,b.yyyy,b.subjectId,b.assItemId) b left join (SELECT a.customerId,a.yyyy,a.subMonth,a.assItemId,a.assTotalName,a.subjectId,a.subjectFullName AS fullName,IF(a.direction=1,'\u501F','\u8D37') AS direction,sum(case when a.subMonth=1 then remain else 0 end) AS remain,sum(case when a.subMonth=12 then balance else 0 end) AS balance FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} GROUP BY a.customerId,a.yyyy,a.subjectId,a.assItemId ) a ON a.customerId = b.customerId and a.yyyy = b.yyyy and a.subjectId = b.subjectId and a.assItemId = b.assItemId WHERE 1 = 1 /*START #param4# AND IFNULL(a.remain,'') = IFNULL(b.remainF,'') #param4# END*/ /*START #param5# AND IFNULL(a.remain,'') <> IFNULL(b.remainF,'') #param5# END*/ /*START #param6# AND IFNULL(a.balance,'') = IFNULL(b.balanceF,'') #param6# END*/ /*START #param7# AND IFNULL(a.balance,'') <> IFNULL(b.balanceF,'') #param7# END*/
FIN201013=SELECT * FROM (SELECT b.customerId,b.yyyy,b.subjectId,b.subjectFullName AS fullName,IF(b.direction=1,'\u501F','\u8D37') AS direction,IFNULL(a.balance,0) AS balance,SUM(IFNULL(b.balanceF,0)) AS balanceF FROM {lockDbName}.fin_accountall b LEFT JOIN {lockDbName}.fin_account a ON a.customerId = b.customerId AND a.yyyy = b.yyyy AND a.subjectId = b.subjectId AND a.isLeaf1 = 1 AND a.subMonth = 12 WHERE b.customerId = {lockCustomerId} AND b.yyyy = {lockYyyy} AND b.isLeaf1 = 1 AND b.subMonth = 12 GROUP BY b.customerId,b.yyyy,b.subjectId /*START #param4# HAVING balance = balanceF #param4# END*/ /*START #param5# HAVING balance != balanceF #param5# END*/ ORDER BY b.customerId,b.yyyy,b.subjectId) a
#\u67E5\u770B\u5206\u5F55\u5F55\u5165\u4EBA\u5458
FIN201014=SELECT '\u5236\u5355\u4EBA' AS userType,IFNULL(GROUP_CONCAT(DISTINCT voucherFillUser),'') AS voucherUser FROM {lockDbName}.fin_subjectvoucher WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND voucherFillUser>'' UNION ALL SELECT '\u8BB0\u8D26\u4EBA' AS userType,IFNULL(GROUP_CONCAT(DISTINCT voucherKeepUser),'') AS voucherUser FROM {lockDbName}.fin_subjectvoucher WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND voucherKeepUser>'' UNION ALL SELECT '\u5BA1\u6838\u4EBA' AS userType,IFNULL(GROUP_CONCAT(DISTINCT voucherAuditUser),'') AS voucherUser FROM {lockDbName}.fin_subjectvoucher WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND voucherAuditUser>''
#\u67E5\u6838\u7B97\u4F59\u989D\u8868\u548C\u5916\u5E01\u6838\u7B97\u4F59\u989D\u8868\u671F\u521D\u6570\u6821\u9A8C\u8BE6\u7EC6
#FIN201015=SELECT a.*, b.remainF,b.balanceF from (select b.customerId,b.yyyy,b.subMonth,b.subjectId,sum(case when b.subMonth=1 then remainF else 0 end) as remainF,sum(case when b.subMonth=12 then balanceF else 0 end) as balanceF from {lockDbName}.fin_accountall b where b.customerId = {lockCustomerId} and b.yyyy = {lockYyyy} group by b.customerId,b.yyyy,b.subjectId) b left join (SELECT a.customerId,a.yyyy,a.subMonth,a.subjectId,a.subjectFullName AS fullName,IF(a.direction=1,'\u501F','\u8D37') AS direction,sum(case when a.subMonth=1 then remain else 0 end) AS remain,sum(case when a.subMonth=12 then balance else 0 end) AS balance FROM {lockDbName}.fin_account a WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} GROUP BY a.customerId,a.yyyy,a.subjectId ) a ON a.customerId = b.customerId and a.yyyy = b.yyyy and a.subjectId = b.subjectId WHERE 1 = 1 /*START #param4# AND IFNULL(a.remain,'') = IFNULL(b.remainF,'') #param4# END*/ /*START #param5# AND IFNULL(a.remain,'') <> IFNULL(b.remainF,'') #param5# END*/ /*START #param6# AND IFNULL(a.balance,'') = IFNULL(b.balanceF,'') #param6# END*/ /*START #param7# AND IFNULL(a.balance,'') <> IFNULL(b.balanceF,'') #param7# END*/
FIN201015=SELECT * FROM (SELECT b.customerId,b.yyyy,b.subjectId,b.subjectFullName AS fullName,IF(b.direction=1,'\u501F','\u8D37') AS direction,b.assItemId,b.assTotalName,IFNULL(a.remain,0) AS remain,SUM(IFNULL(b.remainF,0)) AS remainF FROM {lockDbName}.fin_assitementryaccall b LEFT JOIN {lockDbName}.fin_assitementryacc a ON a.customerId = b.customerId AND a.yyyy = b.yyyy AND a.subjectId = b.subjectId AND a.assItemId = b.assItemId AND a.isLeaf1 = 1 AND a.subMonth = 1 WHERE b.customerId = {lockCustomerId} AND b.yyyy = {lockYyyy} AND b.isLeaf1 = 1 AND b.subMonth = 1 GROUP BY b.customerId,b.yyyy,b.subjectId,b.assItemId /*START #param4# HAVING remain = remainF #param4# END*/ /*START #param5# HAVING remain != remainF #param5# END*/ ORDER BY b.customerId,b.yyyy,b.subjectId,b.assItemId) a
#\u67E5\u6838\u7B97\u4F59\u989D\u8868\u548C\u5916\u5E01\u6838\u7B97\u4F59\u989D\u8868\u671F\u672B\u6570\u6821\u9A8C\u8BE6\u7EC6
#FIN201016=SELECT a.*, b.remainF,b.balanceF from (select b.customerId,b.yyyy,b.subMonth,b.subjectId,b.assItemId,sum(case when b.subMonth=1 then remainF else 0 end) as remainF,sum(case when b.subMonth=12 then balanceF else 0 end) as balanceF from {lockDbName}.fin_assitementryaccall b where b.customerId = {lockCustomerId} and b.yyyy = {lockYyyy} group by b.customerId,b.yyyy,b.subjectId,b.assItemId) b left join (SELECT a.customerId,a.yyyy,a.subMonth,a.assItemId,a.assTotalName,a.subjectId,a.subjectFullName AS fullName,IF(a.direction=1,'\u501F','\u8D37') AS direction,sum(case when a.subMonth=1 then remain else 0 end) AS remain,sum(case when a.subMonth=12 then balance else 0 end) AS balance FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} GROUP BY a.customerId,a.yyyy,a.subjectId,a.assItemId ) a ON a.customerId = b.customerId and a.yyyy = b.yyyy and a.subjectId = b.subjectId and a.assItemId = b.assItemId WHERE 1 = 1 /*START #param4# AND IFNULL(a.remain,'') = IFNULL(b.remainF,'') #param4# END*/ /*START #param5# AND IFNULL(a.remain,'') <> IFNULL(b.remainF,'') #param5# END*/ /*START #param6# AND IFNULL(a.balance,'') = IFNULL(b.balanceF,'') #param6# END*/ /*START #param7# AND IFNULL(a.balance,'') <> IFNULL(b.balanceF,'') #param7# END*/
FIN201016=SELECT * FROM (SELECT b.customerId,b.yyyy,b.subjectId,b.subjectFullName AS fullName,IF(b.direction=1,'\u501F','\u8D37') AS direction,b.assItemId,b.assTotalName,IFNULL(a.balance,0) AS balance,SUM(IFNULL(b.balanceF,0)) AS balanceF FROM {lockDbName}.fin_assitementryaccall b LEFT JOIN {lockDbName}.fin_assitementryacc a ON a.customerId = b.customerId AND a.yyyy = b.yyyy AND a.subjectId = b.subjectId AND a.assItemId = b.assItemId AND a.isLeaf1 = 1 AND a.subMonth = 12 WHERE b.customerId = {lockCustomerId} AND b.yyyy = {lockYyyy} AND b.isLeaf1 = 1 AND b.subMonth = 12 GROUP BY b.customerId,b.yyyy,b.subjectId,b.assItemId /*START #param4# HAVING balance = balanceF #param4# END*/ /*START #param5# HAVING balance != balanceF #param5# END*/ ORDER BY b.customerId,b.yyyy,b.subjectId,b.assItemId) a
#\u67E5\u8BE2\u5236\u5355\u4EBA\u548C\u5BA1\u6838\u4EBA\u6743\u9650\u6821\u9A8C\u8BE6\u7EC6
FIN201017=SELECT a.customerId,a.yyyy,b.voucherId,a.voucherId AS oldVoucherId,a.typeId,a.vchDate,a.voucherFillUser,a.voucherAuditUser,a.voucherKeepUser,a.debitocc,a.creditocc FROM {lockDbName}.fin_subjectvoucher a inner join (select a.voucherId,sum(case when (SUBSTRING_INDEX(b.subjectFullId, '/', 1) = c.subjectId or c.subjectId = '') and c.roleName = '\u5236\u5355\u4EBA' then 1 else 0 end) as fillNum,sum(case when ((SUBSTRING_INDEX(b.subjectFullId, '/', 1) = c.subjectId or c.subjectId = '') and c.roleName = '\u5BA1\u6838\u4EBA') or (a.voucherAuditUser = '' or a.voucherAuditUser is null) then 1 else 0 end) as auditNum from {lockDbName}.fin_subjectentry a inner join {lockDbName}.fin_accpkgsubject b on a.subjectId = b.subjectId and a.customerId = b.customerId and a.yyyy = b.yyyy left join {lockDbName}.fin_subjectvoucherauth c on a.customerId = b.customerId and a.yyyy = b.yyyy and ((a.voucherFillUser = c.userName and c.roleName = '\u5236\u5355\u4EBA') or (a.voucherAuditUser = c.userName and c.roleName = '\u5BA1\u6838\u4EBA')) where a.customerId = {lockCustomerId} and a.yyyy = {lockYyyy} group by a.voucherId) b on a.oldVoucherId = b.voucherId where a.customerId = {lockCustomerId} and a.yyyy = {lockYyyy} /*START #param4# {param4} #param4# END*/ ORDER BY a.customerId,a.yyyy,a.voucherId,a.vchDate
#\u67E5\u8BE2\u5236\u5355\u4EBA\u548C\u5BA1\u6838\u4EBA\u6743\u9650\u6821\u9A8C\u9519\u8BEF\u4EBA\u5458
FIN201018=SELECT userName from (SELECT CASE WHEN fillNum = 0 then a.voucherFillUser end as userName FROM (select a.voucherId,a.voucherFillUser,a.voucherAuditUser,sum(case when (SUBSTRING_INDEX(b.subjectFullId, '/', 1) = c.subjectId or c.subjectId = '') and c.roleName = '\u5236\u5355\u4EBA' then 1 else 0 end) as fillNum,sum(case when ((SUBSTRING_INDEX(b.subjectFullId, '/', 1) = c.subjectId or c.subjectId = '') and c.roleName = '\u5BA1\u6838\u4EBA') or (a.voucherAuditUser = '' or a.voucherAuditUser is null) then 1 else 0 end) as auditNum from {lockDbName}.fin_subjectentry a inner join {lockDbName}.fin_accpkgsubject b on a.subjectId = b.subjectId and a.customerId = b.customerId and a.yyyy = b.yyyy left join {lockDbName}.fin_subjectvoucherauth c on a.customerId = b.customerId and a.yyyy = b.yyyy and ((a.voucherFillUser = c.userName and c.roleName = '\u5236\u5355\u4EBA') or (a.voucherAuditUser = c.userName and c.roleName = '\u5BA1\u6838\u4EBA')) where a.customerId = {lockCustomerId} and a.yyyy = {lockYyyy} group by a.voucherId) a union SELECT CASE WHEN auditNum = 0 then a.voucherAuditUser end as userName FROM (select a.voucherId,a.voucherFillUser,a.voucherAuditUser,sum(case when (SUBSTRING_INDEX(b.subjectFullId, '/', 1) = c.subjectId or c.subjectId = '') and c.roleName = '\u5236\u5355\u4EBA' then 1 else 0 end) as fillNum,sum(case when ((SUBSTRING_INDEX(b.subjectFullId, '/', 1) = c.subjectId or c.subjectId = '') and c.roleName = '\u5BA1\u6838\u4EBA') or (a.voucherAuditUser = '' or a.voucherAuditUser is null) then 1 else 0 end) as auditNum from {lockDbName}.fin_subjectentry a inner join {lockDbName}.fin_accpkgsubject b on a.subjectId = b.subjectId and a.customerId = b.customerId and a.yyyy = b.yyyy left join {lockDbName}.fin_subjectvoucherauth c on a.customerId = b.customerId and a.yyyy = b.yyyy and ((a.voucherFillUser = c.userName and c.roleName = '\u5236\u5355\u4EBA') or (a.voucherAuditUser = c.userName and c.roleName = '\u5BA1\u6838\u4EBA')) where a.customerId = {lockCustomerId} and a.yyyy = {lockYyyy} group by a.voucherId) a ) a group by userName
#\u79D1\u6570\u636E\u4FEE\u6B63
#\u67E5\u8BE2\u6240\u6709\u79D1\u76EE
FIN202001=SELECT DISTINCT t1.customerId,t1.yyyy,t1.subjectId,t1.subjectFullId,IFNULL(t1.direction,1) AS direction,t1.isLeaf1 FROM {lockDbName}.fin_accpkgsubject t1 WHERE t1.customerId={lockCustomerId} AND t1.yyyy={lockYyyy} AND(t1.subjectFullId LIKE '{subjectId}/%' OR t1.subjectFullId='{subjectId}') 
#\u67E5\u8BE2\u6240\u6709\u6838\u7B97\u79D1\u76EE
FIN202002=SELECT DISTINCT t1.customerId,t1.yyyy,t1.subjectId,t1.subjectFullId,t1.assItemId,t1.assItemFullId,IFNULL(t1.direction,1) AS direction,t1.isLeaf1 FROM {lockDbName}.fin_assitem t1,(SELECT t2.subjectId FROM {lockDbName}.fin_accpkgsubject t2 WHERE t2.customerId={lockCustomerId} AND t2.yyyy={lockYyyy} AND(t2.subjectFullId LIKE '{subjectId}/%' OR t2.subjectFullId='{subjectId}')) t2 WHERE t1.customerId={lockCustomerId} AND t1.yyyy={lockYyyy} AND t1.subjectId=t2.subjectId
#\u67E5\u8BE2\u4F59\u989D\u8868\u548C\u5916\u5E01\u4F59\u989D\u8868\u671F\u521D\u91D1\u989D\u4E0D\u76F8\u7B49\u7684\u6570\u636E
#\u67E5\u8BE2\u4F59\u989D\u8868\u548C\u5916\u5E01\u4F59\u989D\u8868\u671F\u521D\u91D1\u989D\u4E0D\u76F8\u7B49\u7684\u6570\u636E
FIN202003=SELECT t1.customerId,t1.yyyy,t1.subMonth,t1.subjectId,t1.debitRemain,t1.creditRemain,t2.debitRemainF,t2.creditRemainF FROM(SELECT t1.customerId,t1.yyyy,t1.subMonth,t1.subjectId,t1.debitRemain,t1.creditRemain FROM {lockDbName}.fin_account t1 WHERE t1.customerId={lockCustomerId} AND t1.yyyy={lockYyyy} /*START #param3# AND t1.subjectId LIKE '{param3}%' #param3# END*/ AND t1.subMonth=1 AND t1.isLeaf1=1) t1,(SELECT t1.customerId,t1.yyyy,t1.subMonth,t1.subjectId,SUM(t1.debitRemainF) debitRemainF,SUM(t1.creditRemainF) creditRemainF FROM {lockDbName}.fin_accountall t1 WHERE t1.customerId={lockCustomerId} AND t1.yyyy={lockYyyy} /*START #param3# AND t1.subjectId LIKE '{param3}%' #param3# END*/ AND t1.subMonth=1 AND t1.isLeaf1=1 GROUP BY t1.subjectId) t2 WHERE t1.customerId=t2.customerId AND t1.yyyy=t2.yyyy AND t1.subMonth=t2.subMonth AND t1.subjectId=t2.subjectId /*START #param4# AND(t1.debitRemain<>t2.debitRemainF OR t1.creditRemain<>t2.creditRemainF) #param4# END*/
#\u67E5\u8BE2\u4F59\u989D\u8868\u501F\u8D37\u65B9\u5411\u4FEE\u6B63
#FIN202004=SELECT t1.customerId,t1.yyyy,t1.subjectId,t1.subjectName,t1.currency,t1.direction,sum(case when t1.subMonth=1 then t1.debitRemain else 0 end) as debitRemain,sum(case when t1.subMonth=1 then t1.creditRemain else 0 end) as creditRemain,sum(t1.debitOcc) as debitOcc,sum(t1.creditOcc) as creditOcc,sum(case when t1.subMonth=12 then t1.balance else 0 end) as balance FROM {lockDbName}.fin_account t1 WHERE t1.customerId={lockCustomerId} AND t1.yyyy={lockYyyy} /*START #param3# AND t1.subjectId='{param3}' #param3# END*/ AND t1.level1=1 group by t1.customerId,t1.yyyy,t1.subjectId,t1.subjectName,t1.currency,t1.direction
FIN202004=SELECT a.customerId,a.yyyy,a.subjectId,a.subjectName,a.direction,'' AS currency,b.debitRemain,b.creditRemain,b.remain,b.debitOcc,b.creditOcc,b.debitBalance,b.creditBalance,b.balance FROM {lockDbName}.fin_accpkgsubject a LEFT JOIN (SELECT customerId,yyyy,subjectId,SUM(CASE WHEN subMonth = 1 THEN debitRemain ELSE 0 END) AS debitRemain,SUM(CASE WHEN subMonth = 1 THEN creditRemain ELSE 0 END) AS creditRemain,SUM(CASE WHEN subMonth = 1 THEN remain ELSE 0 END) AS remain,SUM(CASE WHEN subMonth = 12 THEN debitTotalOcc ELSE 0 END) AS debitOcc,SUM(CASE WHEN subMonth = 12 THEN creditTotalOcc ELSE 0 END) AS creditOcc,SUM(CASE WHEN subMonth = 12 THEN debitBalance ELSE 0 END) AS debitBalance,SUM(CASE WHEN subMonth = 12 THEN creditBalance ELSE 0 END) AS creditBalance,SUM(CASE WHEN subMonth = 12 THEN balance ELSE 0 END) AS balance FROM {lockDbName}.fin_account WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #param3# AND subjectId = '{param3}' #param3# END*/ AND level1 = 1 GROUP BY customerId,yyyy,subjectId) b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.subjectId = a.subjectId WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.level1 = 1 /*START #param3# AND a.subjectId = '{param3}' #param3# END*/ ORDER BY a.subjectId
#\u67E5\u8BE2\u4F59\u989D\u8868\u6240\u6709\u672B\u7EA7\u79D1\u76EE
FIN202005=select a1.customerId,a1.yyyy,a1.subMonth,a1.subjectId,a1.subjectName,a1.currency,a1.debitRemain,a1.creditRemain from {lockDbName}.fin_account a1, (SELECT DISTINCT t1.customerId,t1.yyyy,t1.subjectId,t1.subjectFullId,IFNULL(t1.direction,1) AS direction,t1.isLeaf1 FROM {lockDbName}.fin_accpkgsubject t1 WHERE t1.customerId={lockCustomerId} AND t1.yyyy={lockYyyy} AND(t1.subjectFullId LIKE '{subjectId}/%' OR t1.subjectFullId='{subjectId}') ) a2 where a1.customerId ={lockCustomerId} AND a1.yyyy ={lockYyyy} and a1.subMonth = 1 and a1.subjectId = a2.subjectId and a2.isLeaf1 = 1
#\u67E5\u8BE2\u5916\u5E01\u4F59\u989D\u8868\u6240\u6709\u672B\u7EA7\u79D1\u76EE
FIN202006=select a1.customerId,a1.yyyy,a1.subMonth,a1.subjectId,a1.subjectName,a1.currency,a1.debitRemain,a1.creditRemain,a1.debitRemainF,a1.creditRemainF from {lockDbName}.fin_accountall a1, (SELECT DISTINCT t1.customerId,t1.yyyy,t1.subjectId,t1.subjectFullId,IFNULL(t1.direction,1) AS direction,t1.isLeaf1 FROM {lockDbName}.fin_accpkgsubject t1 WHERE t1.customerId={lockCustomerId} AND t1.yyyy={lockYyyy} AND(t1.subjectFullId LIKE '{subjectId}/%' OR t1.subjectFullId='{subjectId}') ) a2 where a1.customerId ={lockCustomerId} AND a1.yyyy ={lockYyyy} and a1.subMonth = 1 and a1.subjectId = a2.subjectId and a2.isLeaf1 = 1
#\u67E5\u8BE2\u6838\u7B97\u4F59\u989D\u8868\u6240\u6709\u672B\u7EA7\u79D1\u76EE
FIN202007=select a1.customerId,a1.yyyy,a1.subMonth,a1.subjectId,a1.subjectName,a1.assItemId,a1.assItemName,a1.debitRemain,a1.creditRemain from {lockDbName}.fin_assitementryacc a1, (SELECT DISTINCT t1.customerId,t1.yyyy,t1.subjectId,t1.subjectFullId,t1.assItemId,t1.assItemFullId,IFNULL(t1.direction,1) AS direction,t1.isLeaf1 FROM {lockDbName}.fin_assitem t1,(SELECT t2.subjectId FROM {lockDbName}.fin_accpkgsubject t2 WHERE t2.customerId={lockCustomerId} AND t2.yyyy={lockYyyy} AND(t2.subjectFullId LIKE '{subjectId}/%' OR t2.subjectFullId='{subjectId}')) t2 WHERE t1.customerId={lockCustomerId} AND t1.yyyy={lockYyyy} AND t1.subjectId=t2.subjectId ) a2 where a1.customerId ={lockCustomerId} AND a1.yyyy ={lockYyyy} and a1.subMonth = 1 and a1.subjectId = a2.subjectId and a1.assItemId = a2.assItemId and a2.isLeaf1 = 1
#\u67E5\u8BE2\u5916\u5E01\u6838\u7B97\u4F59\u989D\u8868\u6240\u6709\u672B\u7EA7\u79D1\u76EE
FIN202008=select a1.customerId,a1.yyyy,a1.subMonth,a1.subjectId,a1.subjectName,a1.assItemId,a1.assItemName,a1.currency,a1.debitRemain,a1.creditRemain,a1.debitRemainF,a1.creditRemainF from {lockDbName}.fin_assitementryaccall a1, (SELECT DISTINCT t1.customerId,t1.yyyy,t1.subjectId,t1.subjectFullId,t1.assItemId,t1.assItemFullId,IFNULL(t1.direction,1) AS direction,t1.isLeaf1 FROM {lockDbName}.fin_assitem t1,(SELECT t2.subjectId FROM {lockDbName}.fin_accpkgsubject t2 WHERE t2.customerId={lockCustomerId} AND t2.yyyy={lockYyyy} AND(t2.subjectFullId LIKE '{subjectId}/%' OR t2.subjectFullId='{subjectId}')) t2 WHERE t1.customerId={lockCustomerId} AND t1.yyyy={lockYyyy} AND t1.subjectId=t2.subjectId ) a2 where a1.customerId ={lockCustomerId} AND a1.yyyy ={lockYyyy} and a1.subMonth = 1 and a1.subjectId = a2.subjectId and a1.assItemId = a2.assItemId and a2.isLeaf1 = 1
#\u67E5\u8BE2\u672C\u5E74\u5229\u6DA6\u5BF9\u65B9\u79D1\u76EE
FIN202009=select a.customerId,a.yyyy,a.subjectId,a.subjectFullName,a.oldVoucherId,a.voucherId,a.typeId,a.vchDate,a.direction,a.occurValue,a.oppositeAccountTop,a.oppositeAccountLast,a.oppositeSubjectValue,a.oppositeTopSubjectValue from {lockDbName}.fin_subjectentry a inner join (SELECT t2.customerId,t2.yyyy,t2.subjectId FROM {lockDbName}.fin_accpkgsubject t2 WHERE t2.customerId={lockCustomerId} AND t2.yyyy={lockYyyy} /*START #param3# AND (t2.subjectFullId LIKE '{param3}/%' OR t2.subjectFullId='{param3}') #param3# END*/) t2 on a.customerId = t2.customerId and a.yyyy = t2.yyyy and a.subjectId = t2.subjectId where a.customerId={lockCustomerId} AND a.yyyy={lockYyyy}
#\u67E5\u8BE2\u542B\u6709\u672C\u5E74\u5229\u6DA6\u7684\u51ED\u8BC1
FIN202010=select a.voucherId,((a.drCount > 1 AND a.crCount > 1) OR (a.drCount = 0 OR a.crCount = 0)) AS isDjdd from {lockDbName}.fin_subjectentry a where a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.subjectId IN ({subjectId}) group by a.customerId,a.yyyy,a.voucherId
#\u67E5\u8BE2\u672C\u5E74\u5229\u6DA6\u5BF9\u65B9\u79D1\u76EE
FIN202011=select autoId,case when t2.subjectId is null then a3 else a1 end as oppositeAccountLast,case when t2.subjectId is null then a4 else a2 end as oppositeAccountTop from {lockDbName}.fin_subjectentry a inner join (select a.customerId,a.yyyy,a.voucherId,GROUP_CONCAT(distinct case when t2.subjectId is null then a.subjectFullName else null end) as a1,GROUP_CONCAT(distinct case when t2.subjectId is null then substring_index(a.subjectFullName,'/',1) else null end) as a2,GROUP_CONCAT(distinct case when t2.subjectId is not null then a.subjectFullName else null end) as a3,GROUP_CONCAT(distinct case when t2.subjectId is not null then substring_index(a.subjectFullName,'/',1) else null end) as a4 from {lockDbName}.fin_subjectentry a left join (SELECT t2.customerId,t2.yyyy,t2.subjectId FROM {lockDbName}.fin_accpkgsubject t2 WHERE t2.customerId={lockCustomerId} AND t2.yyyy={lockYyyy} /*START #param3# AND (t2.subjectFullId LIKE '{param3}/%' OR t2.subjectFullId='{param3}') #param3# END*/) t2 on a.customerId = t2.customerId and a.yyyy = t2.yyyy and a.subjectId = t2.subjectId where a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} and a.voucherId in ({param4}) group by a.voucherId) b ON a.customerId = b.customerId AND a.yyyy = b.yyyy and a.voucherId = b.voucherId left join (SELECT t2.customerId,t2.yyyy,t2.subjectId FROM {lockDbName}.fin_accpkgsubject t2 WHERE t2.customerId={lockCustomerId} AND t2.yyyy={lockYyyy} /*START #param3# AND (t2.subjectFullId LIKE '{param3}/%' OR t2.subjectFullId='{param3}') #param3# END*/) t2 on a.customerId = t2.customerId and a.yyyy = t2.yyyy and a.subjectId = t2.subjectId where a.customerId={lockCustomerId} AND a.yyyy={lockYyyy}
#\u67E5\u8BE2\u6240\u6709\u7ED3\u8F6C\u51ED\u8BC1
FIN202012=SELECT customerId,yyyy,vchDate,typeId,oldVoucherId,voucherId,serail,summary,subjectId,subjectFullName,CASE direction WHEN 1 THEN occurValue ELSE 0 END AS debitOcc,CASE direction WHEN -1 THEN occurValue ELSE 0 END AS creditOcc FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND isTransferVoucher = '1' ORDER BY vchDate,voucherId,serail
#\u67E5\u8BE2\u6D89\u53CA\u51ED\u8BC1
FIN202014=SELECT GROUP_CONCAT(DISTINCT voucherId) AS voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND subjectId IN ({subjectId})
#\u67E5\u8BE2\u79D1\u76EE\u6811
FIN202015=SELECT subjectId,subjectName,subjectFullName,direction,level1 AS subjectLevel,parentSubjectId FROM {lockDbName}.fin_accpkgsubject WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy}
#\u67E5\u8BE2\u79D1\u76EE\u6811
FIN202016=SELECT subjectId,subjectName,direction FROM {lockDbName}.fin_accpkgsubject WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #subjectId# AND subjectId IN ({subjectId}) #subjectId# END*/
FIN202017=SELECT MAX(level1) AS maxLevel FROM {lockDbName}.fin_accpkgsubject WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND subjectId IN ({subjectId})
FIN202018=SELECT a.customerId,a.yyyy,a.subMonth,b.parentSubjectId AS subjectId,b.direction,a.currency,SUM(a.hasAssItem)>0 AS hasAssItem FROM {lockDbName}.fin_account a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.subjectId = a.subjectId LEFT JOIN {lockDbName}.fin_account c ON c.customerId = b.customerId AND c.yyyy = b.yyyy AND c.subjectId = b.parentSubjectId AND c.subMonth = a.subMonth WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND b.parentSubjectId > '' AND c.subjectId IS NULL AND a.subjectId IN ({subjectId}) GROUP BY b.parentSubjectId,a.subMonth
FIN202019=SELECT a.customerId,a.yyyy,a.subMonth,b.parentSubjectId AS subjectId,b.direction,a.currency,SUM(a.hasAssItem)>0 AS hasAssItem FROM {lockDbName}.fin_accountall a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.subjectId = a.subjectId LEFT JOIN {lockDbName}.fin_accountall c ON c.customerId = b.customerId AND c.yyyy = b.yyyy AND c.subjectId = b.parentSubjectId AND c.subMonth = a.subMonth AND c.currency = a.currency WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND b.parentSubjectId > '' AND c.subjectId IS NULL AND a.subjectId IN ({subjectId}) GROUP BY b.parentSubjectId,a.subMonth,a.currency

#\u6570\u636E\u5BFC\u5165
#\u67E5\u8BE2\u8D22\u52A1\u8D26\u5957\u5BFC\u5165\u8BB0\u5F55
FIN203001=SELECT a.customerId,a.customerName,a.yyyy,a.uploadUser AS __uuploadUser,a.checkoutResult,a.uploadTime,a.fileName,a.importState,a.uploadTime AS importStartDate,a.endTime AS importEndDate FROM bdo_fin.fin_importlist a WHERE 1=1 /*START #lockCustomerId# AND a.customerId={lockCustomerId} #lockCustomerId# END*/ /*START #lockYyyy# AND a.yyyy={lockYyyy} #lockYyyy# END*/ AND a.uploadUser= {param1} ORDER BY a.uploadTime DESC
#\u67E5\u8BE2\u6240\u6709\u8D22\u52A1\u8D26\u5957
FIN203002=SELECT a.projectId,a.projectName,a.customerId,a.customerName,a.yyyy,a.departmentId,a.departmentId AS __ddepartmentId,a.finSource,DATE_FORMAT(a.uploadTime,'%Y-%m-%d %T') AS lastDate,a.uploadUser AS __ulastUser FROM bdo_fin.fin_control_new a WHERE a.ACTIVE_FLAG = 1 AND a.customerId IN ({param2}) /*START #param1# AND a.customerId={param1} #param1# END*/
#\u67E5\u8BE2\u662F\u5426\u6709\u8D22\u52A1\u6570\u636E
FIN203004=SELECT IF(COUNT(0) > 0, 1, 0) AS HASDATA FROM {lockDbName}.fin_account WHERE customerId={lockCustomerId} AND yyyy={nextYyyy}
#\u5220\u96640\u91D1\u989D\u8D22\u52A1\u6570\u636E--\u79D1\u76EE\u8868fin_accpkgsubject
FIN203005=INSERT INTO {lockDbName}.fin_accpkgsubject(customerId,yyyy,subjectId,parentSubjectId,subjectFullId,subjectName,direction,currency,isLeaf1,level1,subjectFullName,CREATION_DATE,CREATED_BY,LAST_UPDATE_DATE,LAST_UPDATED_BY) SELECT customerId,'{lockYyyy}' AS yyyy,subjectId,parentSubjectId,subjectFullId,subjectName,direction,currency,isLeaf1,level1,subjectFullName,'{CREATION_DATE}' AS CREATION_DATE,'{CREATED_BY}' AS CREATED_BY,'{CREATION_DATE}' AS LAST_UPDATE_DATE,'{CREATED_BY}' AS LAST_UPDATED_BY FROM {lockDbName}.fin_accpkgsubject WHERE customerId = '{lockCustomerId}' AND yyyy = '{nextYyyy}'
#\u5220\u96640\u91D1\u989D\u8D22\u52A1\u6570\u636E--\u4F59\u989D\u8868fin_account
FIN203006=INSERT INTO {lockDbName}.fin_account(customerId,yyyy,subMonth,subjectId,subjectName,direction,currency,debitRemain,creditRemain,remain,debitOcc,creditOcc,tranDebitOcc,tranCreditOcc,debitOccNoTran,creditOccNoTran,debitTotalOcc,creditTotalOcc,debitBalance,creditBalance,balance,isLeaf1,level1,subjectFullName,hasAssItem,CREATION_DATE,CREATED_BY,LAST_UPDATE_DATE,LAST_UPDATED_BY) SELECT customerId,'{lockYyyy}' AS yyyy,subMonth,subjectId,subjectName,direction,currency,'0' AS debitRemain,'0' AS creditRemain,'0' AS remain,'0' AS debitOcc,'0' AS creditOcc,'0' AS tranDebitOcc,'0' AS tranCreditOcc,'0' AS debitOccNoTran,'0' AS creditOccNoTran,'0' AS debitTotalOcc,'0' AS creditTotalOcc,'0' AS debitBalance,'0' AS creditBalance,'0' AS balance,isLeaf1,level1,subjectFullName,'0' AS hasAssItem,'{CREATION_DATE}' AS CREATION_DATE,'{CREATED_BY}' AS CREATED_BY,'{CREATION_DATE}' AS LAST_UPDATE_DATE,'{CREATED_BY}' AS LAST_UPDATED_BY FROM {lockDbName}.fin_account WHERE customerId = '{lockCustomerId}' AND yyyy = '{nextYyyy}'
#\u5220\u96640\u91D1\u989D\u8D22\u52A1\u6570\u636E--\u5916\u5E01\u4F59\u989D\u8868fin_accountall
FIN203007=INSERT INTO {lockDbName}.fin_accountall(customerId,yyyy,subMonth,subjectId,subjectName,direction,currency,debitRemain,creditRemain,remain,debitOcc,creditOcc,tranDebitOcc,tranCreditOcc,debitOccNoTran,creditOccNoTran,debitTotalOcc,creditTotalOcc,debitBalance,creditBalance,balance,debitRemainF,creditRemainF,remainF,debitOccF,creditOccF,tranDebitOccF,tranCreditOccF,debitOccNoTranF,creditOccNoTranF,debitTotalOccF,creditTotalOccF,debitBalanceF,creditBalanceF,balanceF,isLeaf1,level1,subjectFullName,hasAssItem,CREATION_DATE,CREATED_BY,LAST_UPDATE_DATE,LAST_UPDATED_BY) SELECT customerId,'{lockYyyy}' AS yyyy,subMonth,subjectId,subjectName,direction,currency,'0' AS debitRemain,'0' AS creditRemain,'0' AS remain,'0' AS debitOcc,'0' AS creditOcc,'0' AS tranDebitOcc,'0' AS tranCreditOcc,'0' AS debitOccNoTran,'0' AS creditOccNoTran,'0' AS debitTotalOcc,'0' AS creditTotalOcc,'0' AS debitBalance,'0' AS creditBalance,'0' AS balance,'0' AS debitRemainF,'0' AS creditRemainF,'0' AS remainF,'0' AS debitOccF,'0' AS creditOccF,'0' AS tranDebitOccF,'0' AS tranCreditOccF,'0' AS debitOccNoTranF,'0' AS creditOccNoTranF,'0' AS debitTotalOccF,'0' AS creditTotalOccF,'0' AS debitBalanceF,'0' AS creditBalanceF,'0' AS balanceF,isLeaf1,level1,subjectFullName,'0' AS hasAssItem,'{CREATION_DATE}' AS CREATION_DATE,'{CREATED_BY}' AS CREATED_BY,'{CREATION_DATE}' AS LAST_UPDATE_DATE,'{CREATED_BY}' AS LAST_UPDATED_BY FROM {lockDbName}.fin_accountall WHERE customerId = '{lockCustomerId}' AND yyyy = '{nextYyyy}'
#\u67E5\u8BE2\u79D1\u76EE\u8868
FIN203008=SELECT customerId,yyyy,subjectId,parentSubjectId,subjectFullId,subjectName,direction,currency,isLeaf1,level1,subjectFullName from {lockDbName}.fin_accpkgsubject where customerId={customerId} AND yyyy={yyyy}
#\u67E5\u8BE2\u6570\u636E\u5BFC\u5165\u4EBA
FIN203009=SELECT a.uploadUser,a.LAST_UPDATE_DATE from bdo_fin.fin_importlist a where a.customerId = {customerId} and a.yyyy = {yyyy} union select a.uploadUser,a.LAST_UPDATE_DATE from bdo_fin.fin_tasklist a where a.customerId = {customerId} and a.year = {yyyy} order by LAST_UPDATE_DATE desc
#\u67E5\u8BE2\u662F\u5426\u6709\u4F59\u989D\u8868\u548C\u660E\u7EC6\u6570\u636E
FIN203010=SELECT count(1) as dataNum from {lockDbName}.fin_account where customerId={customerId} AND yyyy={yyyy} union all SELECT count(1) as dataNum from {lockDbName}.fin_subjectentry where customerId={customerId} AND yyyy={yyyy}
#\u67E5\u8BE2\u5408\u5E76\u5217\u8868
FIN203011=select a.autoId,a.customerId,a.customerName,a.projectId,a.projectName,a.yyyy,a.mainCustomerId,a.mainCustomerName,a.mergeCustomerIds,a.mergeCustomerNames,a.mergeUser AS __umergeUser,a.mergeStatus,a.mergeMessage,a.LAST_UPDATE_DATE,a.isMergeRemain from bdo_fin.fin_datamergelist a where 1=1 /*START #param1# and a.customerId = {param1} #param1# END*/ /*START #param2# and a.yyyy = {param2} #param2# END*/ and a.departmentId = {param3} order by a.LAST_UPDATE_DATE desc
#\u67E5\u8BE2\u67E5\u8BE2\u8868\u662F\u5426\u5B58\u5728
FIN203012=select 1 from information_schema.TABLES where TABLE_NAME = '{tableName}' and TABLE_SCHEMA = '{schemaName}'
#\u67E5\u8BE2\u79D1\u76EE\u5408\u5E76\u8868\u6570\u636E\u590D\u5236\u5230\u4E34\u65F6\u5E93
FIN203013=select * from {lockDbName}.fin_mergesubject where yyyy = {yyyy}
#\u67E5\u8BE2\u6838\u7B97\u5408\u5E76\u8868\u6570\u636E\u590D\u5236\u5230\u4E34\u65F6\u5E93
FIN203014=select * from {lockDbName}.fin_mergeassitem where yyyy = {yyyy}
#\u67E5\u8BE2\u79D1\u76EE\u5408\u5E76\u8868\u6570\u636E\u590D\u5236\u5230\u4E34\u65F6\u5E93
FIN203015=select * from {lockDbName}.fin_accpkgsubject where customerId = {customerId} and yyyy = {yyyy}
#\u67E5\u8BE2\u6838\u7B97\u5408\u5E76\u8868\u6570\u636E\u590D\u5236\u5230\u4E34\u65F6\u5E93
FIN203016=select customerId, yyyy, assItemId, assItemName, parentAssItemId, assItemFullId, assTotalName, isLeaf1, level1, CREATION_DATE, CREATED_BY, LAST_UPDATE_DATE, LAST_UPDATED_BY, ABOLITION_DATE, ABOLISHED_BY, PROGRAM_APPLICATION_ID, PROGRAM_ID, ACTIVE_FLAG from {lockDbName}.fin_assitem where customerId = {customerId} and yyyy = {yyyy} group by customerId,yyyy,assItemId
#\u4E34\u65F6\u5BA2\u6237
#\u4E34\u65F6\u5BA2\u6237\u4E00\u89C8
FIN204001=SELECT a.userCustomerId,a.userCustomerName,a.CREATION_DATE AS createDate,date_add(ifnull(b.importEndDate,b.importStartDate),interval 90 day) as validDate FROM bdo_fin.fin_usercustomer a left join bdo_fin.fin_customer b on a.userCustomerId = b.customerId WHERE a.userId = {userId} /*START #param1# AND a.userCustomerName LIKE '%{param1}%' #param1# END*/ 
#\u67E5\u8BE2\u6307\u5B9A\u7528\u6237\u4E0B\u6700\u5927\u4E34\u65F6\u5BA2\u6237ID
FIN204002=SELECT LPAD(IFNULL(MAX(cusseqId),0)+1,3,0) AS cusseqId FROM bdo_fin.fin_usercustomer WHERE userId=?
#\u67E5\u8BE2\u67E5\u770B\u4E34\u65F6\u5BA2\u6237\u7684\u7528\u6237
FIN204003=SELECT a.id AS userId,a.name AS userName FROM bdo_base.base_user a INNER JOIN bdo_fin.fin_usercustomerauth b ON b.userId = a.id AND b.userCustomerId = {param1}
#\u6A21\u677F\u5BFC\u5165\u4E0B\u62C9\u6846
FIN204004=SELECT userCustomerId AS value,userCustomerName AS label FROM bdo_fin.fin_usercustomer WHERE userId = {param1} ORDER BY userCustomerName ASC
#\u67E5\u8BE2\u4E34\u65F6\u5BA2\u6237\u7528\u6237\u6240\u5C5E\u673A\u6784
FIN204005=SELECT dp2.hrDeptCode FROM bdo_fin.fin_usercustomer a INNER JOIN bdo_base.base_user b ON b.id = a.userId LEFT JOIN bdo_base.base_department dp1 ON dp1.autoid = b.departmentid LEFT JOIN bdo_base.base_department dp2 ON dp2.autoid = dp1.firstItemId WHERE a.userCustomerId = {customerId}
#\u83B7\u53D6\u5DF2\u7ECF\u5BFC\u5165\u6570\u636E\u7684\u4E34\u65F6\u5BA2\u6237
FIN204006=SELECT DISTINCT CONCAT('[\u4E34]',a.label) AS label,a.value,dp2.hrDeptCode AS office FROM ((SELECT a.userCustomerId AS value,a.userCustomerName AS label,a.userId FROM bdo_fin.fin_usercustomer a INNER JOIN bdo_fin.fin_customer c ON c.customerId = a.userCustomerId WHERE a.userId = {param1}) UNION (SELECT a.userCustomerId AS value,a.userCustomerName AS label,a.userId FROM bdo_fin.fin_usercustomer a LEFT JOIN bdo_fin.fin_usercustomerauth b ON b.userCustomerId = a.userCustomerId INNER JOIN bdo_fin.fin_customer c ON c.customerId = a.userCustomerId WHERE b.userId = {param1})) a INNER JOIN bdo_base.base_user b ON b.id = a.userId LEFT JOIN bdo_base.base_department dp1 ON dp1.autoid = b.departmentid LEFT JOIN bdo_base.base_department dp2 ON dp2.autoid = dp1.firstItemId ORDER BY a.value
#\u6839\u636E\u540D\u79F0\u83B7\u53D6\u4E34\u65F6\u5BA2\u6237
FIN204007=SELECT a.userCustomerId AS customerId,dp1.hrDeptCode AS departCode,dp2.hrDeptCode AS officeCode FROM bdo_fin.fin_usercustomer a LEFT JOIN bdo_base.base_user u ON u.id = a.userId LEFT JOIN bdo_base.base_department dp1 ON dp1.autoid = u.departmentid LEFT JOIN bdo_base.base_department dp2 ON dp2.autoid = dp1.firstItemId WHERE a.userCustomerName = '{customerName}' AND u.hrLoginId = '{loginId}' LIMIT 1
#\u6839\u636EID\u83B7\u53D6\u4E34\u65F6\u5BA2\u6237
FIN204008=SELECT a.userCustomerId AS customerId,dp1.hrDeptCode AS departCode,dp2.hrDeptCode AS officeCode FROM bdo_fin.fin_usercustomer a LEFT JOIN bdo_base.base_user u ON u.id = a.userId LEFT JOIN bdo_base.base_department dp1 ON dp1.autoid = u.departmentid LEFT JOIN bdo_base.base_department dp2 ON dp2.autoid = dp1.firstItemId WHERE a.userCustomerId = '{customerId}' AND u.hrLoginId = '{loginId}' LIMIT 1
#\u67E5\u8BE2\u4E34\u65F6\u5BA2\u6237\u6811
FIN204009=SELECT aa.id, aa.label AS `name`, aa.label, aa.value, IF(LENGTH(aa.parentId) = 1, '', aa.parentId) as parentId, aa.leaf FROM( SELECT a.userCustomerId AS `id`, CONCAT(a.userCustomerId, '-', a.userCustomerName) AS `label`, a.userCustomerId AS `value`, '1' AS parentId, 'true' AS leaf FROM bdo_fin.fin_usercustomer a left join bdo_fin.fin_customer b on a.userCustomerId = b.customerId WHERE a.userId = {param1}) aa ORDER BY aa.id, aa.value
####################\u5BA2\u6237\u95E8\u6237####################
####################\u5176\u4ED6\u6A21\u5757####################
#\u67E5\u8BE2 \u5DF2\u5B8C\u6210\u673A\u8003\u548C90\u5929\u5185\u672A\u901A\u8FC7\u673A\u8003\u7684\u5BA2\u6237
FIN800001=SELECT GROUP_CONCAT(DISTINCT customerId) AS customerId FROM (SELECT customerId FROM asdb.ot_project WHERE oteLevel=200 AND isOtePassed='1' UNION SELECT customerId FROM asdb.ot_project WHERE oteLevel=200 AND IFNULL(isOtePassed,0)=0 AND DATEDIFF(NOW(),STR_TO_DATE(startDate,'%Y-%m-%d'))>{overdueDate}) a
#\u67E5\u8BE2 \u8981\u5220\u9664\u7684fin_control\u8BB0\u5F55
FIN800002=SELECT * FROM bdo_fin.fin_control_new WHERE projectId IN ({projectId}) AND systemId = '{systemId}'
#\u67E5\u8BE2 \u4E0A\u6B21\u5BFC\u5165\u572890\u5929\u4EE5\u524D\u7684\u4E34\u65F6\u5BA2\u6237
FIN800003=SELECT GROUP_CONCAT(DISTINCT a.userCustomerId) AS customerId FROM bdo_fin.fin_usercustomer a LEFT JOIN bdo_fin.fin_customer b ON b.customerId=a.userCustomerId WHERE DATEDIFF(NOW(),STR_TO_DATE(b.importEndDate,'%Y-%m-%d'))>{overdueDate}
#\u6700\u540E\u4E0A\u4F20\u6570\u636E\u572890\u5929\u524D\u7684\u7528\u6237\u5BA2\u6237\u8D22\u52A1\u6570\u636E
FIN800004=SELECT GROUP_CONCAT(DISTINCT projectId) AS projectId FROM bdo_fin.fin_customer WHERE status='0' AND LENGTH(projectId)=10 AND DATEDIFF(NOW(),STR_TO_DATE(importEndDate,'%Y-%m-%d'))>{overdueDate}
#\u67E5\u8BE2\u6838\u7B97\u5E94\u6536\u8D26\u6B3E\u56DE\u6536\u7387\u548C\u672C\u671F\u9500\u552E\u7EDF\u8BA1
FIN800005=select a.assItemId as companyId,a.assItemName as companyName,sum(case when a.subMonth=1 then a.remain else 0 end) as remain,sum(case when a.subMonth=12 then a.debitTotalOcc else 0 end) as debitOcc,sum(case when a.subMonth=12 then a.creditTotalOcc else 0 end) as creditOcc,sum(case when a.subMonth=12 then a.balance else 0 end) as balance,IFNULL(b.writeOffValue,0) as writeOffValue,IFNULL(b.salesValue,0) as salesValue from {lockDbName}.fin_assitementryacc a inner join (SELECT t2.subjectId FROM {lockDbName}.fin_accpkgsubject t1 ,{lockDbName}.fin_accpkgsubject t2 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ={lockYyyy} AND t1.subjectId = '{param1}' AND t1.customerId = t2.customerId AND t1.yyyy = t2.yyyy AND t2.subjectFullId LIKE CONCAT(t1.subjectFullId,'/%') UNION SELECT t1.subjectId FROM {lockDbName}.fin_accpkgsubject t1 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ={lockYyyy} AND t1.subjectId = '{param1}') c on a.subjectId = c.subjectId inner join (SELECT distinct a2.assItemId FROM {lockDbName}.fin_assitem a1,{lockDbName}.fin_assitem a2 WHERE a1.customerId = {lockCustomerId} AND a1.yyyy = {lockYyyy} AND a1.assItemId in ({param2}) AND a1.customerId = a2.customerId AND a1.yyyy = a2.yyyy AND a1.subjectId = a2.subjectId AND a2.assItemFullId LIKE CONCAT(a1.assItemFullId,'|%') and a2.isLeaf1 = 1 UNION SELECT t1.assItemId FROM {lockDbName}.fin_assitem t1 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ={lockYyyy} AND t1.assItemId in ({param2}) and t1.isLeaf1 = 1) d on a.assItemId = d.assItemId left join (select a.assItemId,sum(case when b.summary regexp '{param3}' and b.direction = -1 then a.occurValue else 0 end) as writeOffValue,sum(case when b.oppositeAccountLast regexp (select GROUP_CONCAT(subjectName SEPARATOR '|') from (SELECT t1.subjectName FROM {lockDbName}.fin_accpkgsubject t1 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ={lockYyyy} AND t1.subjectId in ({param4})) t1) and b.direction = 1 then a.occurValue else 0 end) as salesValue from {lockDbName}.fin_assitementry a inner join (SELECT t2.subjectId FROM {lockDbName}.fin_accpkgsubject t1 ,{lockDbName}.fin_accpkgsubject t2 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ={lockYyyy} AND t1.subjectId = '{param1}' AND t1.customerId = t2.customerId AND t1.yyyy = t2.yyyy AND t2.subjectFullId LIKE CONCAT(t1.subjectFullId,'/%') UNION SELECT t1.subjectId FROM {lockDbName}.fin_accpkgsubject t1 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ={lockYyyy} AND t1.subjectId = '{param1}') c on a.subjectId = c.subjectId inner join {lockDbName}.fin_subjectentry b on a.subjectEntryId = b.autoId WHERE a.customerId = '{lockCustomerId}' AND a.yyyy ='{lockYyyy}' group by a.assItemId) b on a.assItemId = b.assItemId WHERE a.customerId = '{lockCustomerId}' AND a.yyyy ='{lockYyyy}' GROUP BY a.assItemId order by a.assItemId
#\u67E5\u8BE2\u79D1\u76EE\u5E94\u6536\u8D26\u6B3E\u56DE\u6536\u7387\u548C\u672C\u671F\u9500\u552E\u7EDF\u8BA1
FIN800006=select a.subjectId as companyId,a.subjectName as companyName,sum(case when a.subMonth=1 then a.remain else 0 end) as remain,sum(case when a.subMonth=12 then a.debitTotalOcc else 0 end) as debitOcc,sum(case when a.subMonth=12 then a.creditTotalOcc else 0 end) as creditOcc,sum(case when a.subMonth=12 then a.balance else 0 end) as balance,IFNULL(b.writeOffValue,0) as writeOffValue,IFNULL(b.salesValue,0) as salesValue from {lockDbName}.fin_account a inner join (SELECT t2.subjectId FROM {lockDbName}.fin_accpkgsubject t1 ,{lockDbName}.fin_accpkgsubject t2 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ={lockYyyy} AND t1.subjectId = '{param1}' AND t1.customerId = t2.customerId AND t1.yyyy = t2.yyyy AND t2.subjectFullId LIKE CONCAT(t1.subjectFullId,'/%') and t2.isLeaf1 = 1 UNION SELECT t1.subjectId FROM {lockDbName}.fin_accpkgsubject t1 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ={lockYyyy} AND t1.subjectId = '{param1}' and t1.isLeaf1 = 1) c on a.subjectId = c.subjectId left join (select a.subjectId,sum(case when a.summary regexp '{param3}' and a.direction = -1 then a.occurValue else 0 end) as writeOffValue,sum(case when a.oppositeAccountLast regexp (select GROUP_CONCAT(subjectName SEPARATOR '|') from (SELECT t1.subjectName FROM {lockDbName}.fin_accpkgsubject t1 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ={lockYyyy} AND t1.subjectId in ({param4})) t1) and a.direction = 1 then a.occurValue else 0 end) as salesValue from {lockDbName}.fin_subjectentry a inner join (SELECT t2.subjectId FROM {lockDbName}.fin_accpkgsubject t1 ,{lockDbName}.fin_accpkgsubject t2 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ={lockYyyy} AND t1.subjectId = '{param1}' AND t1.customerId = t2.customerId AND t1.yyyy = t2.yyyy AND t2.subjectFullId LIKE CONCAT(t1.subjectFullId,'/%') UNION SELECT t1.subjectId FROM {lockDbName}.fin_accpkgsubject t1 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ={lockYyyy} AND t1.subjectId = '{param1}') c on a.subjectId = c.subjectId WHERE a.customerId = '{lockCustomerId}' AND a.yyyy ='{lockYyyy}' group by a.subjectId) b on a.subjectId = b.subjectId WHERE a.customerId = '{lockCustomerId}' AND a.yyyy ='{lockYyyy}' GROUP BY a.subjectId order by a.subjectId
####################\u5176\u4ED6\u6A21\u5757####################
####################\u9879\u76EE\u4E2D\u5FC3####################
#\u9879\u76EE\u4E2D\u5FC3 \u67E5\u627E\u8F85\u52A9\u6838\u7B97
FIN900001=SELECT customerId,assItemId,assItemName FROM {lockDbName}.fin_assitem WHERE customerId = {param1} AND yyyy = {param3} GROUP BY assItemId
#\u8BD5\u7B97\u5E73\u8861\u8868 \u79D1\u76EE\u5BF9\u7167
#\u5224\u65AD\u662F\u5426\u6709\u8D22\u52A1\u6570\u636E
FIN900002=SELECT COUNT(1) FROM {lockDbName}.fin_account WHERE customerId = {customerId} AND yyyy = {yyyy}
#\u53D6\u6307\u5B9A\u5BA2\u6237\u8D26\u5957\u989D\u5EA6\u6700\u5927\u6708\u4EFD
FIN900003=SELECT max(subMonth) as endMonth FROM {lockDbName}.fin_account WHERE customerId = {customerId} AND yyyy = {yyyy}
#\u83B7\u53D6\u79D1\u76EE\u6570\u636E
FIN900004=SELECT a.subjectId AS userSubjectId, a.subjectFullName AS userSubjectName, a.level1 AS level0, a.isLeaf1 AS isLeaf0, IFNULL(a.remain, 0.00) AS remain, IFNULL(a.debitRemain, 0.00) AS debitRemain, IFNULL(a.creditRemain, 0.00) AS creditRemain, IFNULL(c.debitTotalOcc, 0.00) AS debitTotalOcc, IFNULL(c.creditTotalOcc, 0.00) AS creditTotalOcc, IFNULL(c.tranDebitTotalOcc, 0.00) AS tranDebitTotalOcc, IFNULL(c.tranCreditTotalOcc, 0.00) AS tranCreditTotalOcc, IFNULL(b.balance, 0.00) AS balance, a.direction FROM (SELECT subjectId, subjectFullName, isLeaf1, level1,  remain AS remain, debitRemain, creditRemain, direction FROM {lockDbName}.fin_account WHERE customerId = {customerId} AND yyyy = {yyyy} AND submonth = {startMonth}) a LEFT JOIN (SELECT subjectid, subjectFullName, debitBalance, creditBalance, debitTotalOcc, creditTotalOcc,  balance AS balance, direction FROM {lockDbName}.fin_account WHERE customerId = {customerId} AND yyyy = {yyyy} AND submonth = {endMonth}) b ON a.subjectId = b.subjectId LEFT JOIN (SELECT subjectId, subjectFullName,SUM(debitOcc) AS debitTotalOcc,SUM(creditOcc) AS creditTotalOcc, SUM(tranDebitOcc) AS tranDebitTotalOcc, SUM(tranCreditOcc) AS tranCreditTotalOcc FROM {lockDbName}.fin_account WHERE customerId = {customerId} AND yyyy = {yyyy} AND submonth >= {startMonth} AND submonth <= {endMonth} GROUP BY subjectId) c ON a.subjectId = c.subjectId
#\u67E5\u8BE2\u8D22\u52A1\u79D1\u76EE
FIN900005=SELECT subjectId, parentSubjectId,level1,subjectFullId, subjectName, subjectFullName, isLeaf1 AS isLeaf FROM {lockDbName}.fin_accpkgsubject WHERE customerId={customerId} AND yyyy={yyyy}
#\u5BA2\u6237\u6570\u91CF
FIN900006=SELECT GROUP_CONCAT(DISTINCT customerId) FROM (SELECT customerId FROM bdo_fin.fin_customer WHERE customerId IN ({param1}) UNION SELECT customerId FROM bdo_dg.dg_project WHERE customerId IN ({param1})) a
#\u67E5\u8BE2\u6240\u6709\u8F85\u52A9\u6838\u7B97
FIN900007=SELECT a.assItemId, a.assItemName, a.parentAssItemId, GROUP_CONCAT(a.subjectId) AS subjectId FROM {lockDbName}.fin_assitem a WHERE a.customerId = {customerId} AND a.yyyy = {yyyy} GROUP BY a.assItemId
FIN900008=SELECT direction FROM {lockDbName}.fin_accpkgsubject WHERE customerId = {customerId} AND yyyy = {yyyy} AND subjectId = {subjectId}
#\u6307\u5B9A\u79D1\u76EE\u5B50\u6570\u636E\u67E5\u8BE2
FIN900009=SELECT a.subjectId AS userSubjectId, a.subjectFullName AS userSubjectName, a.level1 AS level0, a.isLeaf1 AS isLeaf0, IFNULL(a.remain, 0.00) AS remain, IFNULL(a.debitremain, 0.00) AS debitRemain, IFNULL(a.creditremain, 0.00) AS creditRemain, IFNULL(c.debittotalocc, 0.00) AS debitTotalOcc, IFNULL(c.credittotalocc, 0.00) AS creditTotalOcc, IFNULL(c.tranDebitTotalOcc, 0.00) AS tranDebitTotalOcc, IFNULL(c.tranCreditTotalOcc, 0.00) AS tranCreditTotalOcc, IFNULL(c.debitOccNoTran, 0.00) AS debitTotalOccNoTran, IFNULL(c.creditOccNoTran, 0.00) AS creditTotalOccNoTran, IFNULL(b.balance, 0.00) AS balance, b.direction FROM (SELECT subjectId, subjectFullName, isLeaf1, level1,  remain AS remain, debitRemain, creditRemain, direction FROM {lockDbName}.fin_account WHERE customerId = {param1} AND yyyy = {param2} AND subMonth = {param3} AND subjectId LIKE '{param5}%' AND subjectId <> '{param5}' AND level1 = {param6}) a LEFT JOIN (SELECT subjectid, subjectFullName, debitBalance, creditBalance,  balance AS balance, direction FROM {lockDbName}.fin_account WHERE customerId = {param1} AND yyyy = {param2} AND subMonth = {param4} AND subjectId LIKE '{param5}%' AND subjectId <> '{param5}' AND level1 = {param6}) b ON a.subjectId = b.subjectId LEFT JOIN (SELECT subjectId, subjectFullName, SUM(debitOcc) AS debitTotalOcc, SUM(creditOcc) AS creditTotalOcc, SUM(tranDebitOcc) AS tranDebitTotalOcc, SUM(tranCreditOcc) AS tranCreditTotalOcc, SUM(debitOccNoTran) AS debitOccNoTran, SUM(creditOccNoTran) AS creditOccNoTran FROM {lockDbName}.fin_account WHERE customerId = {param1} AND yyyy = {param2} AND subMonth >= {param3} AND subMonth <= {param4} AND subjectId LIKE '{param5}%' AND subjectId <> '{param5}' AND level1 = {param6} GROUP BY subjectId) c ON a.subjectId = c.subjectId
#\u6307\u5B9A\u4E00\u7EA7\u79D1\u76EE\u6570\u636E\u67E5\u8BE2
FIN900010=SELECT a.subjectId AS userSubjectId, a.subjectFullName AS userSubjectName, a.level1 AS level0, a.isLeaf1 AS isLeaf0, IFNULL(a.remain, 0.00) AS remain, IFNULL(a.debitremain, 0.00) AS debitRemain, IFNULL(a.creditremain, 0.00) AS creditRemain, IFNULL(c.debittotalocc, 0.00) AS debitTotalOcc, IFNULL(c.credittotalocc, 0.00) AS creditTotalOcc, IFNULL(c.tranDebitTotalOcc, 0.00) AS tranDebitTotalOcc, IFNULL(c.tranCreditTotalOcc, 0.00) AS tranCreditTotalOcc, IFNULL(b.balance, 0.00) AS balance, b.direction FROM (SELECT subjectId, subjectFullName,isLeaf1,level1, remain AS remain, debitremain, creditremain, direction FROM {lockDbName}.fin_account WHERE customerId = {customerId} AND yyyy = {yyyy} AND subMonth = {startMonth} AND subjectId = '{subjectId}') a, (SELECT subjectid, subjectFullName, debitbalance, creditbalance,  balance AS balance, direction FROM {lockDbName}.fin_account WHERE customerId = {customerId} AND yyyy = {yyyy} AND subMonth = {endMonth} AND subjectId = '{subjectId}') b , (SELECT subjectId, subjectName AS accname,SUM(debitOcc) AS debittotalocc,SUM(creditOcc) AS credittotalocc, SUM(tranDebitOcc) AS tranDebitTotalOcc, SUM(tranCreditOcc) AS tranCreditTotalOcc FROM {lockDbName}.fin_account WHERE customerId = {customerId} AND yyyy = {yyyy} AND subMonth >= {startMonth} AND subMonth <= {endMonth} AND subjectId = '{subjectId}' ) c
# \u79D1\u76EE\u5BF9\u7167 \u624B\u52A8\u586B\u5199\u6DFB\u52A0  \u6839\u636E1\u7EA7\u79D1\u76EEid\\u67E5\u8BE2\u501F\u8D37\u65B9\u5411
FIN900011=SELECT direction FROM {lockDbName}.fin_accpkgsubject WHERE customerId = {customerId} AND yyyy = {yyyy} AND subjectId = '{subjectId}'
#\u67E5\u8BE2\u6307\u5B9A\u5BA2\u6237\u3001\u5E74\u4EFD\u3001\u79D1\u76EE\u7684\u671F\u672B\u6C47\u603B\u6570 \u501F\u8D37\u65B9\u5411
FIN900012=SELECT  balance  FROM {lockDbName}.fin_account WHERE customerId = {customerId} AND yyyy = {yyyy} AND subjectId = '{subjectId}' AND subMonth = {subMonth}
#\u83B7\u53D6\u8D26\u9F84\u6570\u636E
FIN900013=SELECT a.assItemId, a.assItemName, a.remain, a.balance, a.debitTotalOcc as debitAmount, a.creditTotalOcc as creditAmount FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId = '{customerId}' AND a.subjectId LIKE '{accId}%' AND a.isLeaf1 = '1' AND a.yyyy = '{subYearMonth}' AND a.subMonth = '{subMonth}'
#\u67E5\u8BE2\u6307\u5B9A\u5BA2\u6237\u3001\u5E74\u4EFD\u3001\u79D1\u76EE\u7684 \u501F\u8D37\u65B9\u5411
FIN900014=SELECT direction  FROM {lockDbName}.fin_account WHERE customerId = {customerId} AND yyyy = {year} AND subjectId = '{subjectId}'
####\u5F80\u6765
##\u67E5\u8BE2\u51ED\u8BC1\u53F7
#\u4E00\u501F\u4E00\u8D37
FIN900015=SELECT GROUP_CONCAT(DISTINCT voucherId) AS voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND subjectId LIKE '{subjectId}%' AND direction = {fxDirection} AND drCount = 1 AND crCount = 1
#\u4E00\u501F\u591A\u8D37
FIN900016=SELECT GROUP_CONCAT(DISTINCT voucherId) AS voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND subjectId LIKE '{subjectId}%' AND direction = {fxDirection} AND drCount = 1 AND crCount > 1
#\u4E00\u8D37\u591A\u501F
FIN900017=SELECT GROUP_CONCAT(DISTINCT voucherId) AS voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND subjectId LIKE '{subjectId}%' AND direction = {fxDirection} AND drCount > 1 AND crCount = 1
#\u591A\u501F\u591A\u8D37
FIN900018=SELECT GROUP_CONCAT(DISTINCT voucherId) AS voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND subjectId LIKE '{subjectId}%' AND direction = {fxDirection} AND drCount > 1 AND crCount > 1
#\u540C\u501F\u540C\u8D37
FIN900019=SELECT GROUP_CONCAT(DISTINCT voucherId) AS voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND subjectId LIKE '{subjectId}%' AND direction = {fxDirection} AND (drCount = 0 OR crCount = 0)
#\u79D1\u76EE\u7684\u5BF9\u65B9\u79D1\u76EE
FIN900020=SELECT a.subjectId,a.debitOcc,a.creditOcc,a.debitVoucherId,a.creditVoucherId,b.subjectFullName,SUBSTRING_INDEX(b.subjectFullId,'/',1) AS topSubjectId,SUBSTRING_INDEX(b.subjectFullName,'/',1) AS topSubjectName,voucherKey FROM (SELECT subjectId,occurValue AS debitOcc,0 AS creditOcc,voucherId AS debitVoucherId,NULL AS creditVoucherId,CONCAT(vchDate,'{finSplit1}',oldVoucherId,'{finSplit1}',typeId) AS voucherKey FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ /*START #startDate# AND STR_TO_DATE(vchDate,'%Y-%m-%d') NOT BETWEEN STR_TO_DATE('{startDate}','%Y-%m-%d') AND STR_TO_DATE('{endDate}','%Y-%m-%d') #startDate# END*/ /*START #eliminateVoucherIds# AND voucherId NOT IN ({eliminateVoucherIds}) #eliminateVoucherIds# END*/ AND direction = -1 AND voucherId IN (SELECT DISTINCT voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ /*START #startDate# AND STR_TO_DATE(vchDate,'%Y-%m-%d') NOT BETWEEN STR_TO_DATE('{startDate}','%Y-%m-%d') AND STR_TO_DATE('{endDate}','%Y-%m-%d') #startDate# END*/ /*START #eliminateVoucherIds# AND voucherId NOT IN ({eliminateVoucherIds}) #eliminateVoucherIds# END*/ AND subjectId IN ({subjectId}) AND direction = 1 AND drCount = 1 AND crCount >= 1) /*START #analyzedVoucherId# AND voucherId NOT IN ({analyzedVoucherId}) #analyzedVoucherId# END*/ UNION ALL SELECT creditsubjects AS subjectId,occurValue AS debitOcc,0 AS creditOcc,voucherId AS debitVoucherId,NULL AS creditVoucherId,CONCAT(vchDate,'{finSplit1}',oldVoucherId,'{finSplit1}',typeId) AS voucherKey FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ /*START #startDate# AND STR_TO_DATE(vchDate,'%Y-%m-%d') NOT BETWEEN STR_TO_DATE('{startDate}','%Y-%m-%d') AND STR_TO_DATE('{endDate}','%Y-%m-%d') #startDate# END*/ /*START #eliminateVoucherIds# AND voucherId NOT IN ({eliminateVoucherIds}) #eliminateVoucherIds# END*/ AND direction = 1 AND subjectId IN ({subjectId}) AND voucherId IN (SELECT DISTINCT voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ /*START #startDate# AND STR_TO_DATE(vchDate,'%Y-%m-%d') NOT BETWEEN STR_TO_DATE('{startDate}','%Y-%m-%d') AND STR_TO_DATE('{endDate}','%Y-%m-%d') #startDate# END*/ /*START #eliminateVoucherIds# AND voucherId NOT IN ({eliminateVoucherIds}) #eliminateVoucherIds# END*/ AND subjectId IN ({subjectId}) AND direction = 1 AND drCount > 1 AND crCount = 1) /*START #analyzedVoucherId# AND voucherId NOT IN ({analyzedVoucherId}) #analyzedVoucherId# END*/ UNION ALL SELECT corrSubjectId AS subjectId,corrValue AS debitOcc,0 AS creditOcc,voucherId AS debitVoucherId,NULL AS creditVoucherId,CONCAT(vchDate,'{finSplit1}',oldVoucherId,'{finSplit1}',typeId) AS voucherKey FROM {lockDbName}.fin_subjectvouchercorr WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND voucherType IN ('m','s','r') /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ /*START #startDate# AND STR_TO_DATE(vchDate,'%Y-%m-%d') NOT BETWEEN STR_TO_DATE('{startDate}','%Y-%m-%d') AND STR_TO_DATE('{endDate}','%Y-%m-%d') #startDate# END*/ /*START #eliminateVoucherIds# AND voucherId NOT IN ({eliminateVoucherIds}) #eliminateVoucherIds# END*/ AND direction = 1 AND subjectId IN ({subjectId}) UNION ALL SELECT subjectId,0 AS debitOcc,occurValue AS creditOcc,NULL AS debitVoucherId,voucherId AS creditVoucherId,CONCAT(vchDate,'{finSplit1}',oldVoucherId,'{finSplit1}',typeId) AS voucherKey FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ /*START #startDate# AND STR_TO_DATE(vchDate,'%Y-%m-%d') NOT BETWEEN STR_TO_DATE('{startDate}','%Y-%m-%d') AND STR_TO_DATE('{endDate}','%Y-%m-%d') #startDate# END*/ /*START #eliminateVoucherIds# AND voucherId NOT IN ({eliminateVoucherIds}) #eliminateVoucherIds# END*/ AND direction = 1 AND voucherId IN (SELECT DISTINCT voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ /*START #startDate# AND STR_TO_DATE(vchDate,'%Y-%m-%d') NOT BETWEEN STR_TO_DATE('{startDate}','%Y-%m-%d') AND STR_TO_DATE('{endDate}','%Y-%m-%d') #startDate# END*/ /*START #eliminateVoucherIds# AND voucherId NOT IN ({eliminateVoucherIds}) #eliminateVoucherIds# END*/ AND subjectId IN ({subjectId}) AND direction = -1 AND drCount >= 1 AND crCount = 1) /*START #analyzedVoucherId# AND voucherId NOT IN ({analyzedVoucherId}) #analyzedVoucherId# END*/ UNION ALL SELECT debitsubjects AS subjectId,0 AS debitOcc,occurValue AS creditOcc,NULL AS debitVoucherId,voucherId AS creditVoucherId,CONCAT(vchDate,'{finSplit1}',oldVoucherId,'{finSplit1}',typeId) AS voucherKey FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ /*START #startDate# AND STR_TO_DATE(vchDate,'%Y-%m-%d') NOT BETWEEN STR_TO_DATE('{startDate}','%Y-%m-%d') AND STR_TO_DATE('{endDate}','%Y-%m-%d') #startDate# END*/ /*START #eliminateVoucherIds# AND voucherId NOT IN ({eliminateVoucherIds}) #eliminateVoucherIds# END*/ AND direction = -1 AND subjectId IN ({subjectId}) AND voucherId IN (SELECT DISTINCT voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ /*START #startDate# AND STR_TO_DATE(vchDate,'%Y-%m-%d') NOT BETWEEN STR_TO_DATE('{startDate}','%Y-%m-%d') AND STR_TO_DATE('{endDate}','%Y-%m-%d') #startDate# END*/ /*START #eliminateVoucherIds# AND voucherId NOT IN ({eliminateVoucherIds}) #eliminateVoucherIds# END*/ AND subjectId IN ({subjectId}) AND direction = -1 AND drCount = 1 AND crCount > 1) /*START #analyzedVoucherId# AND voucherId NOT IN ({analyzedVoucherId}) #analyzedVoucherId# END*/ UNION ALL SELECT corrSubjectId AS subjectId,0 AS debitOcc,corrValue AS creditOcc,NULL AS debitVoucherId,voucherId AS creditVoucherId,CONCAT(vchDate,'{finSplit1}',oldVoucherId,'{finSplit1}',typeId) AS voucherKey FROM {lockDbName}.fin_subjectvouchercorr WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND voucherType IN ('m','s','r') /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ /*START #startDate# AND STR_TO_DATE(vchDate,'%Y-%m-%d') NOT BETWEEN STR_TO_DATE('{startDate}','%Y-%m-%d') AND STR_TO_DATE('{endDate}','%Y-%m-%d') #startDate# END*/ /*START #eliminateVoucherIds# AND voucherId NOT IN ({eliminateVoucherIds}) #eliminateVoucherIds# END*/ AND direction = -1 AND subjectId IN ({subjectId})) a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = {lockCustomerId} AND b.yyyy = {lockYyyy} AND b.subjectId = a.subjectId ORDER BY a.subjectId
#\u6839\u636E\u4E00\u7EA7\u79D1\u76EE+\u6838\u7B97\u83B7\u53D6\u672B\u7EA7\u79D1\u76EE+\u6838\u7B97
FIN900022=SELECT subjectId,assItemId FROM {lockDbName}.fin_assitem WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND subjectId IN ({subjectId}) AND assItemId = '{assItemId}'
#\u6838\u7B97\u7684\u5BF9\u65B9\u79D1\u76EE
#FIN900023=SELECT a.subjectId,a.debitOcc,a.creditOcc,b.subjectFullName,GROUP_CONCAT(SUBSTRING_INDEX(b.subjectFullId,'/',1)) AS topSubjectId,GROUP_CONCAT(SUBSTRING_INDEX(b.subjectFullName,'/',1)) AS topSubjectName,voucherKey,voucherId,serail FROM (SELECT b.creditsubjects AS subjectId,b.occurValue AS debitOcc,0 AS creditOcc,CONCAT(b.vchDate,'{finSplit1}',b.oldVoucherId,'{finSplit1}',b.typeId) AS voucherKey,a.voucherId,a.serail FROM {lockDbName}.fin_assitementry a INNER JOIN {lockDbName}.fin_subjectentry b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.voucherId = a.voucherId AND b.serail = a.serail AND b.autoId = a.subjectEntryId WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} /*START #startMonth# AND b.month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND b.month <= {endMonth} #endMonth# END*/ AND a.subjectId IN ({subjectId}) AND a.assItemId = '{assitemId}' AND a.direction = 1 AND ((b.drCount = 1 AND b.crCount >= 1) OR (b.drCount >= 1 AND b.crCount = 1)) /*START #analyzedVoucherId# AND a.voucherId NOT IN ({analyzedVoucherId}) #analyzedVoucherId# END*/ UNION ALL SELECT c.corrSubjectId AS subjectId,c.corrValue AS debitOcc,0 AS creditOcc,CONCAT(b.vchDate,'{finSplit1}',b.oldVoucherId,'{finSplit1}',b.typeId) AS voucherKey,a.voucherId,a.serail FROM {lockDbName}.fin_assitementry a INNER JOIN {lockDbName}.fin_subjectentry b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.voucherId = a.voucherId AND b.serail = a.serail AND b.autoId = a.subjectEntryId INNER JOIN {lockDbName}.fin_subjectvouchercorr c ON c.customerId = a.customerId AND c.yyyy = a.yyyy AND c.voucherId = a.voucherId AND c.serail = a.serail WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} /*START #startMonth# AND b.month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND b.month <= {endMonth} #endMonth# END*/ AND a.subjectId IN ({subjectId}) AND a.assItemId = '{assitemId}' AND a.direction = 1 UNION ALL SELECT b.debitsubjects AS subjectId,0 AS debitOcc,b.occurValue AS creditOcc,CONCAT(b.vchDate,'{finSplit1}',b.oldVoucherId,'{finSplit1}',b.typeId) AS voucherKey,a.voucherId,a.serail FROM {lockDbName}.fin_assitementry a INNER JOIN {lockDbName}.fin_subjectentry b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.voucherId = a.voucherId AND b.serail = a.serail AND b.autoId = a.subjectEntryId WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} /*START #startMonth# AND b.month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND b.month <= {endMonth} #endMonth# END*/ AND a.subjectId IN ({subjectId}) AND a.assItemId = '{assitemId}' AND a.direction = -1 AND ((b.drCount = 1 AND b.crCount >= 1) OR (b.drCount >= 1 AND b.crCount = 1)) /*START #analyzedVoucherId# AND a.voucherId NOT IN ({analyzedVoucherId}) #analyzedVoucherId# END*/ UNION ALL SELECT c.corrSubjectId AS subjectId,0 AS debitOcc,c.corrValue AS creditOcc,CONCAT(b.vchDate,'{finSplit1}',b.oldVoucherId,'{finSplit1}',b.typeId) AS voucherKey,a.voucherId,a.serail FROM {lockDbName}.fin_assitementry a INNER JOIN {lockDbName}.fin_subjectentry b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.voucherId = a.voucherId AND b.serail = a.serail AND b.autoId = a.subjectEntryId INNER JOIN {lockDbName}.fin_subjectvouchercorr c ON c.customerId = a.customerId AND c.yyyy = a.yyyy AND c.voucherId = a.voucherId AND c.serail = a.serail WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} /*START #startMonth# AND b.month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND b.month <= {endMonth} #endMonth# END*/ AND a.subjectId IN ({subjectId}) AND a.assItemId = '{assitemId}' AND a.direction = -1) a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = {lockCustomerId} AND b.yyyy = {lockYyyy} AND FIND_IN_SET(b.subjectId,a.subjectId) GROUP BY voucherId,serail ORDER BY a.subjectId
#FIN900023=SELECT a.subjectId,a.debitOcc,a.creditOcc,b.subjectFullName,GROUP_CONCAT(SUBSTRING_INDEX(b.subjectFullId,'/',1)) AS topSubjectId,GROUP_CONCAT(SUBSTRING_INDEX(b.subjectFullName,'/',1)) AS topSubjectName,voucherKey,voucherId,serail FROM (SELECT CASE WHEN a.direction = 1 THEN a.creditsubjects ELSE a.debitsubjects END AS subjectId,CASE WHEN a.direction = 1 THEN a.occurValue ELSE 0 END AS debitOcc,CASE WHEN a.direction = -1 THEN a.occurValue ELSE 0 END AS creditOcc,CONCAT(b.vchDate,'{finSplit1}',b.oldVoucherId,'{finSplit1}',b.typeId) AS voucherKey,a.voucherId,a.serail FROM {lockDbName}.fin_subjectentry a INNER JOIN {lockDbName}.fin_assitementry b ON b.subjectEntryId = a.autoId WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} /*START #startMonth# AND a.month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND a.month <= {endMonth} #endMonth# END*/ /*START #analyzedVoucherId# AND a.voucherId NOT IN ({analyzedVoucherId}) #analyzedVoucherId# END*/ AND ((a.drCount = 1 AND a.crCount >= 1) OR (a.drCount >= 1 AND a.crCount = 1)) AND a.subjectId IN ({subjectId}) AND b.assItemId = '{assItemId}' UNION ALL SELECT a.corrSubjectId AS subjectId,CASE WHEN a.direction = 1 THEN a.corrValue ELSE 0 END AS debitOcc,CASE WHEN a.direction = -1 THEN a.corrValue ELSE 0 END AS creditOcc,CONCAT(b.vchDate,'{finSplit1}',b.oldVoucherId,'{finSplit1}',b.typeId) AS voucherKey,a.voucherId,a.serail FROM {lockDbName}.fin_subjectvouchercorr a INNER JOIN {lockDbName}.fin_assitementry b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.voucherId = a.voucherId AND b.serail = a.serail WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} /*START #startMonth# AND a.month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND a.month <= {endMonth} #endMonth# END*/ AND a.subjectId IN ({subjectId}) AND b.assItemId = '{assItemId}') a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = {lockCustomerId} AND b.yyyy = {lockYyyy} AND FIND_IN_SET(b.subjectId,a.subjectId) GROUP BY voucherId,serail ORDER BY a.subjectId
FIN900023=SELECT CASE WHEN a.direction = 1 THEN a.creditsubjects ELSE a.debitsubjects END AS subjectId,CASE WHEN a.direction = 1 THEN a.occurValue ELSE 0 END AS debitOcc,CASE WHEN a.direction = -1 THEN a.occurValue ELSE 0 END AS creditOcc,CONCAT(b.vchDate,'{finSplit1}',b.oldVoucherId,'{finSplit1}',b.typeId) AS voucherKey,a.voucherId,a.serail FROM {lockDbName}.fin_subjectentry a INNER JOIN {lockDbName}.fin_assitementry b ON b.subjectEntryId = a.autoId WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} /*START #startMonth# AND a.month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND a.month <= {endMonth} #endMonth# END*/ /*START #analyzedVoucherId# AND a.voucherId NOT IN ({analyzedVoucherId}) #analyzedVoucherId# END*/ AND ((a.drCount = 1 AND a.crCount >= 1) OR (a.drCount >= 1 AND a.crCount = 1)) AND a.subjectId IN ({subjectId}) AND b.assItemId = '{assItemId}' UNION ALL SELECT a.corrSubjectId AS subjectId,CASE WHEN a.direction = 1 THEN a.corrValue ELSE 0 END AS debitOcc,CASE WHEN a.direction = -1 THEN a.corrValue ELSE 0 END AS creditOcc,CONCAT(b.vchDate,'{finSplit1}',b.oldVoucherId,'{finSplit1}',b.typeId) AS voucherKey,a.voucherId,a.serail FROM {lockDbName}.fin_subjectvouchercorr a INNER JOIN {lockDbName}.fin_assitementry b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.voucherId = a.voucherId AND b.serail = a.serail WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.voucherType IN ('m','s','r') /*START #startMonth# AND a.month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND a.month <= {endMonth} #endMonth# END*/ AND a.subjectId IN ({subjectId}) AND b.assItemId = '{assItemId}'
#\u83B7\u53D6\u5DF2\u5206\u6790\u7684\u4E00\u501F\u6216\u4E00\u8D37\u51ED\u8BC1\u53F7
FIN900024=SELECT GROUP_CONCAT(DISTINCT voucherId) FROM {lockDbName}.fin_subjectvouchercorr WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND voucherType = 'r'
#\u83B7\u53D6\u4E0B\u7EA7\u79D1\u76EE
FIN900025=SELECT a.subjectId,a.subjectName,a.subjectFullName,a.balance,a.isLeaf1 FROM {lockDbName}.fin_account a INNER JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.subjectId = a.subjectId AND b.parentSubjectId IN ({subjectId}) WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.subMonth = {endMonth} AND a.balance < 0
#\u83B7\u53D6\u79D1\u76EE\u4E0B\u7684\u6838\u7B97
FIN900026=SELECT a.subjectId,a.subjectName,a.subjectFullName,a.assItemId,a.assItemName,a.assTotalName,a.balance,a.isLeaf1 FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.subMonth = {endMonth} AND a.subjectId = {subjectId} AND a.balance < 0
#\u83B7\u53D6\u6240\u6709\u91D1\u989D<0\u7684\u672B\u7EA7\u79D1\u76EE\u548C\u6838\u7B97
FIN900027=SELECT a.subjectId,b.subjectFullId,a.subjectFullName AS subjectName,'' AS assItemId,'' AS assItemName,a.balance,a.direction FROM {lockDbName}.fin_account a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.subjectId = a.subjectId WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.subMonth = {endMonth} AND a.subjectId IN ({subjectId}) AND a.isLeaf1 = 1 AND a.hasAssItem = 0 AND a.balance < 0 UNION SELECT a.subjectId,b.subjectFullId,a.subjectFullName,assItemId,assItemName,a.balance,a.direction FROM {lockDbName}.fin_assitementryacc a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.subjectId = a.subjectId WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.subMonth = {endMonth} AND a.subjectId IN ({subjectId}) /*START #assItemId# AND a.assItemId IN ({assItemId}) #assItemId# END*/ AND a.isLeaf1 = 1 AND a.balance < 0 ORDER BY subjectId,assItemId
#\u73B0\u91D1\u6D41\u91CF\u8868--\u79D1\u76EE\u7684\u5BF9\u65B9\u79D1\u76EE
FIN900028=SELECT a.topBaseSubjectId AS topSubjectId, a.topBaseSubjectName AS topSubjectName, a.baseSubjectId AS subjectId, a.baseSubjectFullName AS subjectName, '0' AS hasUsedDebit, '0' AS hasUsedCredit, GROUP_CONCAT(DISTINCT a.oldVoucherId) AS oldVoucherId, GROUP_CONCAT(DISTINCT a.voucherId) AS voucherId, SUM(a.occurValue) AS occurValue, SUM(a.debitOcc) AS debitOcc, SUM(a.negaDebitOcc) AS negaDebitOcc, SUM(a.posiDebitOcc) AS posiDebitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.negaCreditOcc) AS negaCreditOcc, SUM(a.posiCreditOcc) AS posiCreditOcc, SUM(a.debitVoucherNum) AS debitVoucherNum, SUM(a.creditVoucherNum) AS creditVoucherNum, GROUP_CONCAT(a.debitVoucherId) AS debitVoucherId, GROUP_CONCAT(a.negaDebitVoucherId) AS negaDebitVoucherId, GROUP_CONCAT(a.posiDebitVoucherId) AS posiDebitVoucherId, GROUP_CONCAT(a.creditVoucherId) AS creditVoucherId, GROUP_CONCAT(a.negaCreditVoucherId) AS negaCreditVoucherId, GROUP_CONCAT(a.posiCreditVoucherId) AS posiCreditVoucherId FROM ( SELECT SUBSTRING_INDEX(b.subjectFullId, '/', 1) AS topBaseSubjectId, SUBSTRING_INDEX(b.subjectFullName, '/', 1) AS topBaseSubjectName, a.subjectId AS topSubjectId, b.subjectFullName AS topSubjectName, SUBSTRING_INDEX(c.subjectFullId, '/', 1) AS baseSubjectId, SUBSTRING_INDEX(c.subjectFullName, '/', 1) AS baseSubjectFullName, a.baseSubjectId AS subjectId, c.subjectFullName AS subjectFullName, GROUP_CONCAT(DISTINCT a.oldVoucherId) AS oldVoucherId, GROUP_CONCAT(DISTINCT a.voucherId) AS voucherId, GROUP_CONCAT(DISTINCT a.vchDate) AS vchDate, GROUP_CONCAT(DISTINCT a.serail) AS serail, SUM(a.occurValue) AS occurValue, SUM(a.debitOcc) AS debitOcc, SUM(a.negaDebitOcc) AS negaDebitOcc, SUM(a.posiDebitOcc) AS posiDebitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.negaCreditOcc) AS negaCreditOcc, SUM(a.posiCreditOcc) AS posiCreditOcc, COUNT(DISTINCT a.debitVoucherId) AS debitVoucherNum, COUNT(DISTINCT a.creditVoucherId) AS creditVoucherNum, GROUP_CONCAT(DISTINCT a.debitVoucherId) AS debitVoucherId, GROUP_CONCAT( DISTINCT a.negaDebitVoucherId ) AS negaDebitVoucherId, GROUP_CONCAT( DISTINCT a.posiDebitVoucherId ) AS posiDebitVoucherId, GROUP_CONCAT(DISTINCT a.creditVoucherId) AS creditVoucherId, GROUP_CONCAT( DISTINCT a.negaCreditVoucherId ) AS negaCreditVoucherId, GROUP_CONCAT( DISTINCT a.posiCreditVoucherId ) AS posiCreditVoucherId FROM ( SELECT a.baseSubjectId, a.subjectId, a.vchDate, a.oldVoucherId, a.voucherId, a.serail, a.occurValue, a.debitOcc, a.debitVoucherId, a.negaDebitOcc, a.negaDebitVoucherId, a.posiDebitOcc, a.posiDebitVoucherId, a.creditOcc, a.creditVoucherId, a.negaCreditOcc, a.negaCreditVoucherId, a.posiCreditOcc, a.posiCreditVoucherId FROM ( SELECT subjectId, debitsubjects AS baseSubjectId, oldVoucherId, vchDate, serail, occurValue, occurValue AS debitOcc, CASE WHEN occurValue < 0 THEN occurValue ELSE 0 END AS negaDebitOcc, CASE WHEN occurValue >= 0 THEN occurValue ELSE 0 END AS posiDebitOcc, 0 AS creditOcc, 0 AS negaCreditOcc, 0 AS posiCreditOcc, voucherId, voucherId AS debitVoucherId, CASE WHEN occurValue < 0 THEN voucherId ELSE NULL END AS negaDebitVoucherId, CASE WHEN occurValue >= 0 THEN voucherId ELSE NULL END AS posiDebitVoucherId, NULL AS creditVoucherId, NULL AS negaCreditVoucherId, NULL AS posiCreditVoucherId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ AND direction = -1 AND voucherId IN ( SELECT DISTINCT voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ AND subjectId IN ({subjectId}) AND direction = 1 AND drCount = 1 AND crCount >= 1 ) /*START #analyzedVoucherId# AND voucherId NOT IN ({analyzedVoucherId}) #analyzedVoucherId# END*/ UNION ALL SELECT creditsubjects AS subjectId, subjectId AS baseSubjectId, oldVoucherId, vchDate, serail, occurValue, occurValue AS debitOcc, CASE WHEN occurValue < 0 THEN occurValue ELSE 0 END AS negaDebitOcc, CASE WHEN occurValue >= 0 THEN occurValue ELSE 0 END AS posiDebitOcc, 0 AS creditOcc, 0 AS negaCreditOcc, 0 AS posiCreditOcc, voucherId, voucherId AS debitVoucherId, CASE WHEN occurValue < 0 THEN voucherId ELSE NULL END AS negaDebitVoucherId, CASE WHEN occurValue >= 0 THEN voucherId ELSE NULL END AS posiDebitVoucherId, NULL AS creditVoucherId, NULL AS negaCreditVoucherId, NULL AS posiCreditVoucherId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ AND direction = 1 AND subjectId IN ({subjectId}) AND voucherId IN ( SELECT DISTINCT voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ AND subjectId IN ({subjectId}) AND direction = 1 AND drCount > 1 AND crCount = 1 ) /*START #analyzedVoucherId# AND voucherId NOT IN ({analyzedVoucherId}) #analyzedVoucherId# END*/ UNION ALL SELECT corrSubjectId AS subjectId, subjectId AS baseSubjectId, oldVoucherId, vchDate, serail, corrValue, corrValue AS debitOcc, CASE WHEN corrValue < 0 THEN corrValue ELSE 0 END AS negaDebitOcc, CASE WHEN corrValue >= 0 THEN corrValue ELSE 0 END AS posiDebitOcc, 0 AS creditOcc, 0 AS negaCreditOcc, 0 AS posiCreditOcc, voucherId, voucherId AS debitVoucherId, CASE WHEN corrValue < 0 THEN voucherId ELSE NULL END AS negaDebitVoucherId, CASE WHEN corrValue >= 0 THEN voucherId ELSE NULL END AS posiDebitVoucherId, NULL AS creditVoucherId, NULL AS negaCreditVoucherId, NULL AS posiCreditVoucherId FROM {lockDbName}.fin_subjectvouchercorr WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND voucherType IN ('m','s','r') /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ AND direction = 1 AND subjectId IN ({subjectId}) UNION ALL SELECT subjectId, creditsubjects AS baseSubjectId, oldVoucherId, vchDate, serail, occurValue, 0 AS debitOcc, 0 AS negaDebitOcc, 0 AS posiDebitOcc, occurValue AS creditOcc, CASE WHEN occurValue < 0 THEN occurValue ELSE 0 END AS negaCreditOcc, CASE WHEN occurValue >= 0 THEN occurValue ELSE 0 END AS posiCreditOcc, voucherId, NULL AS debitVoucherId, NULL AS negaDebitVoucherId, NULL AS posiDebitVoucherId, voucherId AS creditVoucherId, CASE WHEN occurValue < 0 THEN voucherId ELSE NULL END AS negaCreditVoucherId, CASE WHEN occurValue >= 0 THEN voucherId ELSE NULL END AS posiCreditVoucherId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ AND direction = 1 AND voucherId IN ( SELECT DISTINCT voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ AND subjectId IN ({subjectId}) AND direction = -1 AND drCount >= 1 AND crCount = 1 ) /*START #analyzedVoucherId# AND voucherId NOT IN ({analyzedVoucherId}) #analyzedVoucherId# END*/ UNION ALL SELECT debitsubjects AS subjectId, subjectId AS baseSubjectId, oldVoucherId, vchDate, serail, occurValue, 0 AS debitOcc, 0 AS negaDebitOcc, 0 AS posiDebitOcc, occurValue AS creditOcc, CASE WHEN occurValue < 0 THEN occurValue ELSE 0 END AS negaCreditOcc, CASE WHEN occurValue >= 0 THEN occurValue ELSE 0 END AS posiCreditOcc, voucherId, NULL AS debitVoucherId, NULL AS negaDebitVoucherId, NULL AS posiDebitVoucherId, voucherId AS creditVoucherId, CASE WHEN occurValue < 0 THEN voucherId ELSE NULL END AS negaCreditVoucherId, CASE WHEN occurValue >= 0 THEN voucherId ELSE NULL END AS posiCreditVoucherId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ AND direction = -1 AND subjectId IN ({subjectId}) AND voucherId IN ( SELECT DISTINCT voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ AND subjectId IN ({subjectId}) AND direction = -1 AND drCount = 1 AND crCount > 1 ) /*START #analyzedVoucherId# AND voucherId NOT IN ({analyzedVoucherId}) #analyzedVoucherId# END*/ UNION ALL SELECT corrSubjectId AS subjectId, subjectId AS baseSubjectId, oldVoucherId, vchDate, serail, corrValue, 0 AS debitOcc, 0 AS negaDebitOcc, 0 AS posiDebitOcc, corrValue AS creditOcc, CASE WHEN corrValue < 0 THEN corrValue ELSE 0 END AS negaCreditOcc, CASE WHEN corrValue >= 0 THEN corrValue ELSE 0 END AS posiCreditOcc, voucherId, NULL AS debitVoucherId, NULL AS negaDebitVoucherId, NULL AS posiDebitVoucherId, voucherId AS creditVoucherId, CASE WHEN corrValue < 0 THEN voucherId ELSE NULL END AS negaCreditVoucherId, CASE WHEN corrValue >= 0 THEN voucherId ELSE NULL END AS posiCreditVoucherId FROM {lockDbName}.fin_subjectvouchercorr WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND voucherType IN ('m','s','r') /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ AND direction = -1 AND subjectId IN ({subjectId})) a {eliminate} ORDER BY a.baseSubjectId, a.vchDate ) a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = {lockCustomerId} AND b.yyyy = {lockYyyy} AND b.subjectId = a.subjectId LEFT JOIN {lockDbName}.fin_accpkgsubject c ON c.customerId = {lockCustomerId} AND c.yyyy = {lockYyyy} AND c.subjectId = a.baseSubjectId GROUP BY a.baseSubjectId, a.subjectId ) a GROUP BY a.topBaseSubjectId ORDER BY a.topBaseSubjectId
#\u67E5\u627E\u672A\u5206\u6790\u7684\u51ED\u8BC1\u53F7
FIN900029=SELECT GROUP_CONCAT(DISTINCT voucherId) FROM (SELECT a.voucherId,a.serail,a.occurValue,SUM(IFNULL(b.corrValue,0)) AS corrValue FROM {lockDbName}.fin_subjectentry a LEFT JOIN {lockDbName}.fin_subjectvouchercorr b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.voucherId = a.voucherId AND b.serail = a.serail WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.subjectId IN ({subjectId}) /*START #startMonth# AND a.month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND a.month <= {endMonth} #endMonth# END*/ /*START #startDate# AND STR_TO_DATE(a.vchDate,'%Y-%m-%d') NOT BETWEEN STR_TO_DATE('{startDate}','%Y-%m-%d') AND STR_TO_DATE('{endDate}','%Y-%m-%d') #startDate# END*/ /*START #eliminateVoucherIds# AND a.voucherId NOT IN ({eliminateVoucherIds}) #eliminateVoucherIds# END*/ AND ((a.drCount > 1 AND a.crCount > 1) OR (a.drCount = 0 OR a.crCount = 0)) GROUP BY a.customerId,a.yyyy,a.voucherId,a.serail HAVING occurValue <> corrValue) a
#\u67E5\u627E\u672A\u5206\u6790\u7684\u51ED\u8BC1
FIN900030=SELECT a.voucherId,a.vchDate,a.oldVoucherId,a.typeId,a.debitsubjects,GROUP_CONCAT(DISTINCT CASE WHEN a.direction = 1 THEN a.subjectName ELSE NULL END) AS debitSubjectName,a.creditsubjects,GROUP_CONCAT(DISTINCT CASE WHEN a.direction = -1 THEN a.subjectName ELSE NULL END) AS creditSubjectName,SUM(CASE WHEN a.direction = 1 THEN a.occurValue ELSE 0 END) AS debitOcc,SUM(CASE WHEN a.direction = -1 THEN a.occurValue ELSE 0 END) AS creditOcc FROM {lockDbName}.fin_subjectentry a WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} /*START #startMonth# AND a.month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND a.month <= {endMonth} #endMonth# END*/ AND a.voucherId IN ({unAnalyVoucherIds}) GROUP BY a.voucherId ORDER BY a.voucherId
#\u73B0\u91D1\u6D41\u91CF\u8868--\u6838\u7B97\u7684\u5BF9\u65B9\u79D1\u76EE
FIN900031=SELECT a.topSubjectId, a.topSubjectName, a.baseTopSubjectId AS subjectId, a.baseTopSubjectName AS subjectName, '0' AS hasUsedDebit, '0' AS hasUsedCredit, GROUP_CONCAT(DISTINCT a.oldVoucherId) AS oldVoucherId, GROUP_CONCAT(DISTINCT a.voucherId) AS voucherId, SUM(a.occurValue) AS occurValue, SUM(a.debitOcc) AS debitOcc, SUM(a.negaDebitOcc) AS negaDebitOcc, SUM(a.posiDebitOcc) AS posiDebitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.negaCreditOcc) AS negaCreditOcc, SUM(a.posiCreditOcc) AS posiCreditOcc, SUM(a.debitVoucherNum) AS debitVoucherNum, SUM(a.creditVoucherNum) AS creditVoucherNum, GROUP_CONCAT(DISTINCT a.debitVoucherId) AS debitVoucherId, GROUP_CONCAT( DISTINCT a.negaDebitVoucherId ) AS negaDebitVoucherId, GROUP_CONCAT( DISTINCT a.posiDebitVoucherId ) AS posiDebitVoucherId, GROUP_CONCAT(DISTINCT a.creditVoucherId) AS creditVoucherId, GROUP_CONCAT( DISTINCT a.negaCreditVoucherId ) AS negaCreditVoucherId, GROUP_CONCAT( DISTINCT a.posiCreditVoucherId ) AS posiCreditVoucherId FROM ( SELECT GROUP_CONCAT(DISTINCT a.subjectId) AS subjectId, GROUP_CONCAT( DISTINCT SUBSTRING_INDEX(b.subjectFullId, '/', 1) ORDER BY b.subjectId ) AS topSubjectId, GROUP_CONCAT( DISTINCT SUBSTRING_INDEX(b.subjectFullName, '/', 1) ORDER BY b.subjectId ) AS topSubjectName, GROUP_CONCAT(DISTINCT a.baseSubjectId) AS baseSubjectId, GROUP_CONCAT( DISTINCT SUBSTRING_INDEX(c.subjectFullId, '/', 1) ORDER BY c.subjectId ) AS baseTopSubjectId, GROUP_CONCAT( DISTINCT SUBSTRING_INDEX(c.subjectFullName, '/', 1) ORDER BY c.subjectId ) AS baseTopSubjectName, a.oldVoucherId, a.voucherId, a.vchDate, a.serail, a.occurValue, a.debitOcc, a.negaDebitOcc, a.posiDebitOcc, a.creditOcc, a.negaCreditOcc, a.posiCreditOcc, a.debitVoucherNum, a.creditVoucherNum, a.debitVoucherId, a.negaDebitVoucherId, a.posiDebitVoucherId, a.creditVoucherId, a.negaCreditVoucherId, a.posiCreditVoucherId FROM ( SELECT a.subjectId, a.baseSubjectId, GROUP_CONCAT(DISTINCT a.oldVoucherId) AS oldVoucherId, GROUP_CONCAT(DISTINCT a.voucherId) AS voucherId, GROUP_CONCAT(DISTINCT a.vchDate) AS vchDate, GROUP_CONCAT(DISTINCT a.serail) AS serail, SUM(a.occurValue) AS occurValue, SUM(a.debitOcc) AS debitOcc, SUM(a.negaDebitOcc) AS negaDebitOcc, SUM(a.posiDebitOcc) AS posiDebitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.negaCreditOcc) AS negaCreditOcc, SUM(a.posiCreditOcc) AS posiCreditOcc, COUNT(DISTINCT a.debitVoucherId) AS debitVoucherNum, COUNT(DISTINCT a.creditVoucherId) AS creditVoucherNum, GROUP_CONCAT(DISTINCT a.debitVoucherId) AS debitVoucherId, GROUP_CONCAT( DISTINCT a.negaDebitVoucherId ) AS negaDebitVoucherId, GROUP_CONCAT( DISTINCT a.posiDebitVoucherId ) AS posiDebitVoucherId, GROUP_CONCAT(DISTINCT a.creditVoucherId) AS creditVoucherId, GROUP_CONCAT( DISTINCT a.negaCreditVoucherId ) AS negaCreditVoucherId, GROUP_CONCAT( DISTINCT a.posiCreditVoucherId ) AS posiCreditVoucherId FROM ( SELECT a.* FROM ( SELECT b.creditsubjects AS subjectId, b.subjectId AS baseSubjectId, b.occurValue AS debitOcc, CASE WHEN b.occurValue < 0 THEN b.occurValue ELSE 0 END AS negaDebitOcc, CASE WHEN b.occurValue >= 0 THEN b.occurValue ELSE 0 END AS posiDebitOcc, 0 AS creditOcc, 0 AS negaCreditOcc, 0 AS posiCreditOcc, b.vchDate, b.oldVoucherId, b.voucherId, b.serail, b.occurValue, b.voucherId AS debitVoucherId, CASE WHEN b.occurValue < 0 THEN b.voucherId ELSE NULL END AS negaDebitVoucherId, CASE WHEN b.occurValue >= 0 THEN b.voucherId ELSE NULL END AS posiDebitVoucherId, NULL AS creditVoucherId, NULL AS negaCreditVoucherId, NULL AS posiCreditVoucherId FROM {lockDbName}.fin_assitementry a INNER JOIN {lockDbName}.fin_subjectentry b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.voucherId = a.voucherId AND b.serail = a.serail AND b.autoId = a.subjectEntryId WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} /*START #startMonth# AND b.month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND b.month <= {endMonth} #endMonth# END*/ AND a.subjectId IN ({subjectId}) {eliminate} AND a.assItemId = '{assitemId}' AND a.direction = 1 AND ((b.drCount = 1 AND b.crCount >= 1) OR (b.drCount >= 1 AND b.crCount = 1)) /*START #analyzedVoucherId# AND a.voucherId NOT IN ({analyzedVoucherId}) #analyzedVoucherId# END*/ UNION ALL SELECT c.corrSubjectId AS subjectId, c.subjectId AS baseSubjectId, c.corrValue AS debitOcc, CASE WHEN c.corrValue < 0 THEN c.corrValue ELSE 0 END AS negaDebitOcc, CASE WHEN c.corrValue >= 0 THEN c.corrValue ELSE 0 END AS posiDebitOcc, 0 AS creditOcc, 0 AS negaCreditOcc, 0 AS posiCreditOcc, c.vchDate, c.oldVoucherId, c.voucherId, c.serail, c.corrValue AS occurValue, c.voucherId AS debitVoucherId, CASE WHEN c.corrValue < 0 THEN c.voucherId ELSE NULL END AS negaDebitVoucherId, CASE WHEN c.corrValue >= 0 THEN c.voucherId ELSE NULL END AS posiDebitVoucherId, NULL AS creditVoucherId, NULL AS negaCreditVoucherId, NULL AS posiCreditVoucherId FROM {lockDbName}.fin_assitementry a INNER JOIN {lockDbName}.fin_subjectentry b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.voucherId = a.voucherId AND b.serail = a.serail AND b.autoId = a.subjectEntryId INNER JOIN {lockDbName}.fin_subjectvouchercorr c ON c.customerId = a.customerId AND c.yyyy = a.yyyy AND c.voucherId = a.voucherId AND c.serail = a.serail WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND c.voucherType IN ('m','s','r') /*START #startMonth# AND b.month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND b.month <= {endMonth} #endMonth# END*/ AND a.subjectId IN ({subjectId}) {eliminate} AND a.assItemId = '{assitemId}' AND a.direction = 1 UNION ALL SELECT b.debitsubjects AS subjectId, b.subjectId AS subjectId, 0 AS debitOcc, 0 AS negaDebitOcc, 0 AS posiDebitOcc, b.occurValue AS creditOcc, CASE WHEN b.occurValue < 0 THEN b.occurValue ELSE 0 END AS negaCreditOcc, CASE WHEN b.occurValue >= 0 THEN b.occurValue ELSE 0 END AS posiCreditOcc, b.vchDate, b.oldVoucherId, b.voucherId, b.serail, b.occurValue, NULL AS debitVoucherId, NULL AS negaDebitVoucherId, NULL AS posiDebitVoucherId, b.voucherId AS creditVoucherId, CASE WHEN b.occurValue < 0 THEN b.voucherId ELSE NULL END AS negaCreditVoucherId, CASE WHEN b.occurValue >= 0 THEN b.voucherId ELSE NULL END AS posiCreditVoucherId FROM {lockDbName}.fin_assitementry a INNER JOIN {lockDbName}.fin_subjectentry b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.voucherId = a.voucherId AND b.serail = a.serail AND b.autoId = a.subjectEntryId WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} /*START #startMonth# AND b.month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND b.month <= {endMonth} #endMonth# END*/ AND a.subjectId IN ({subjectId}) {eliminate} AND a.assItemId = '{assitemId}' AND a.direction = -1 AND ((b.drCount = 1 AND b.crCount >= 1) OR (b.drCount >= 1 AND b.crCount = 1)) /*START #analyzedVoucherId# AND a.voucherId NOT IN ({analyzedVoucherId}) #analyzedVoucherId# END*/ UNION ALL SELECT c.corrSubjectId AS subjectId, c.subjectId AS baseSubjectId, 0 AS debitOcc, 0 AS negaDebitOcc, 0 AS posiDebitOcc, c.corrValue AS creditOcc, CASE WHEN c.corrValue < 0 THEN c.corrValue ELSE 0 END AS negaCreditOcc, CASE WHEN c.corrValue >= 0 THEN c.corrValue ELSE 0 END AS posiCreditOcc, c.vchDate, c.oldVoucherId, c.voucherId, c.serail, c.corrValue AS occurValue, NULL AS debitVoucherId, NULL AS negaDebitVoucherId, NULL AS posiDebitVoucherId, c.voucherId AS creditVoucherId, CASE WHEN c.corrValue < 0 THEN c.voucherId ELSE NULL END AS negaCreditVoucherId, CASE WHEN c.corrValue >= 0 THEN c.voucherId ELSE NULL END AS posiCreditVoucherId FROM {lockDbName}.fin_assitementry a INNER JOIN {lockDbName}.fin_subjectentry b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.voucherId = a.voucherId AND b.serail = a.serail AND b.autoId = a.subjectEntryId INNER JOIN {lockDbName}.fin_subjectvouchercorr c ON c.customerId = a.customerId AND c.yyyy = a.yyyy AND c.voucherId = a.voucherId AND c.serail = a.serail WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND c.voucherType IN ('m','s','r') /*START #startMonth# AND b.month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND b.month <= {endMonth} #endMonth# END*/ AND a.subjectId IN ({subjectId}) {eliminate} AND a.assItemId = '{assitemId}' AND a.direction = -1 ) a {eliminate1} ORDER BY a.baseSubjectId, a.subjectId ) a GROUP BY a.subjectId, a.baseSubjectId ) a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = {lockCustomerId} AND b.yyyy = {lockYyyy} AND FIND_IN_SET(b.subjectId, a.subjectId) LEFT JOIN {lockDbName}.fin_accpkgsubject c ON c.customerId = {lockCustomerId} AND c.yyyy = {lockYyyy} AND FIND_IN_SET( c.subjectId, a.baseSubjectId ) GROUP BY a.subjectId ORDER BY a.subjectId ) a GROUP BY a.topSubjectId ORDER BY a.topSubjectId
#\u5185\u90E8\u4EA4\u6613\u62B5\u6D88\u63A5\u53E3
FIN900032=SELECT a.subjectId,CASE WHEN a.direction = 1 THEN a.creditsubjects ELSE a.debitsubjects END AS corrSubjectId,a.direction,a.occurValue,a.voucherId,a.serail,a.oldVoucherId,a.month,a.vchDate FROM {lockDbName}.fin_subjectentry a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.subjectId = a.subjectId WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} /*START #startMonth# AND a.month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND a.month <= {endMonth} #endMonth# END*/ AND ((a.drCount = 1 AND a.crCount >= 1) OR (a.drCount >= 1 AND a.crCount = 1)) /*START #viewVoucherId# AND a.voucherId IN ({viewVoucherId}) #viewVoucherId# END*/ /*START #analyzedVoucherId# AND a.voucherId NOT IN ({analyzedVoucherId}) #analyzedVoucherId# END*/ UNION ALL SELECT a.subjectId,a.corrSubjectId,a.direction,a.corrValue,a.voucherId,a.serail,a.oldVoucherId,a.month,a.vchDate FROM {lockDbName}.fin_subjectvouchercorr a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.subjectId = a.subjectId WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.voucherType IN ('m','s','r') /*START #startMonth# AND a.month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND a.month <= {endMonth} #endMonth# END*/ /*START #viewVoucherId# AND a.voucherId IN ({viewVoucherId}) #viewVoucherId# END*/ ORDER BY voucherId,serail
FIN900033=SELECT a.subjectId,CASE WHEN a.direction = 1 THEN b.creditsubjects ELSE b.debitsubjects END AS corrSubjectId,a.direction,a.occurValue,a.voucherId,a.serail,a.oldVoucherId,b.month,a.vchDate FROM {lockDbName}.fin_assitementry a INNER JOIN {lockDbName}.fin_subjectentry b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.autoId = a.subjectEntryId INNER JOIN {lockDbName}.fin_accpkgsubject c ON c.customerId = a.customerId AND c.yyyy = a.yyyy AND c.subjectId = a.subjectId WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} /*START #startMonth# AND b.month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND b.month <= {endMonth} #endMonth# END*/ AND ((b.drCount = 1 AND b.crCount >= 1) OR (b.drCount >= 1 AND b.crCount = 1)) /*START #viewVoucherId# AND a.voucherId IN ({viewVoucherId}) #viewVoucherId# END*/ /*START #analyzedVoucherId# AND a.voucherId NOT IN ({analyzedVoucherId}) #analyzedVoucherId# END*/ AND a.assItemId IN ({assItemId}) UNION ALL SELECT a.subjectId,b.corrSubjectId,a.direction,b.corrValue,a.voucherId,a.serail,a.oldVoucherId,b.month,a.vchDate FROM {lockDbName}.fin_assitementry a INNER JOIN {lockDbName}.fin_subjectvouchercorr b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.voucherId = a.voucherId AND b.serail = a.serail INNER JOIN {lockDbName}.fin_accpkgsubject c ON c.customerId = a.customerId AND c.yyyy = a.yyyy AND c.subjectId = a.subjectId WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND c.voucherType IN ('m','s','r') /*START #startMonth# AND b.month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND b.month <= {endMonth} #endMonth# END*/ /*START #viewVoucherId# AND a.voucherId IN ({viewVoucherId}) #viewVoucherId# END*/ AND a.assItemId IN ({assItemId}) ORDER BY voucherId,serail
#\u67E5\u8BE2\u6307\u5B9A\u79D1\u76EE\u5BF9\u65B9\u79D1\u76EE\u5217\u8868
FIN900034=SELECT debitsubjects AS subjectId,subjectId AS corrSubjectId,'-1' AS direction,occurValue,voucherId,serail,vchDate,oldVoucherId,typeId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND direction = -1 /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ AND voucherId IN (SELECT DISTINCT voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ AND subjectId IN ({subjectId}) AND direction = 1 AND (drCount = 1 AND crCount >= 1)) /*START #analyzedVoucherId# AND voucherId NOT IN ({analyzedVoucherId}) #analyzedVoucherId# END*/ UNION ALL SELECT creditsubjects AS subjectId,subjectId AS corrSubjectId,'1' AS direction,occurValue,voucherId,serail,vchDate,oldVoucherId,typeId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND direction = 1 /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ AND voucherId IN (SELECT DISTINCT voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ AND subjectId IN ({subjectId}) AND direction = -1 AND (drCount >= 1 AND crCount = 1)) /*START #analyzedVoucherId# AND voucherId NOT IN ({analyzedVoucherId}) #analyzedVoucherId# END*/ UNION ALL SELECT subjectId,creditsubjects AS corrSubjectId,'-1' AS direction,occurValue,voucherId,serail,vchDate,oldVoucherId,typeId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND direction = 1 /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ AND subjectId IN ({subjectId}) AND voucherId IN (SELECT DISTINCT voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ AND subjectId IN ({subjectId}) AND direction = 1 AND (drCount > 1 AND crCount = 1)) /*START #analyzedVoucherId# AND voucherId NOT IN ({analyzedVoucherId}) #analyzedVoucherId# END*/ UNION ALL SELECT subjectId,debitsubjects AS corrSubjectId,'1' AS direction,occurValue,voucherId,serail,vchDate,oldVoucherId,typeId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND direction = -1 /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ AND subjectId IN ({subjectId}) AND voucherId IN (SELECT DISTINCT voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ AND subjectId IN ({subjectId}) AND direction = -1 AND (drCount = 1 AND crCount > 1)) /*START #analyzedVoucherId# AND voucherId NOT IN ({analyzedVoucherId}) #analyzedVoucherId# END*/ UNION ALL SELECT subjectId,corrSubjectId,corrDirection AS direction,corrValue,voucherId,serail,vchDate,oldVoucherId,typeId FROM {lockDbName}.fin_subjectvouchercorr WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND voucherType IN ('m','s','r') AND direction = 1 /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ AND subjectId IN ({subjectId}) UNION ALL SELECT subjectId,corrSubjectId,corrDirection AS direction,corrValue,voucherId,serail,vchDate,oldVoucherId,typeId FROM {lockDbName}.fin_subjectvouchercorr WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND voucherType IN ('m','s','r') AND direction = -1 /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ AND subjectId IN ({subjectId}) ORDER BY voucherId,serail
#\u67E5\u8BE2\u6307\u5B9A\u6838\u7B97\u79D1\u76EE\u5BF9\u65B9\u79D1\u76EE\u5217\u8868
FIN900035=SELECT a.subjectId,b.assItemId,CASE WHEN a.direction = 1 THEN a.creditsubjects ELSE a.debitsubjects END AS corrSubjectId,a.direction,a.occurValue AS corrValue,a.voucherId,a.serail,a.vchDate,a.oldVoucherId,a.typeId FROM {lockDbName}.fin_subjectentry a INNER JOIN {lockDbName}.fin_assitementry b ON b.subjectEntryId = a.autoId WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} /*START #startMonth# AND a.month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND a.month <= {endMonth} #endMonth# END*/ /*START #analyzedVoucherId# AND a.voucherId NOT IN ({analyzedVoucherId}) #analyzedVoucherId# END*/ AND ((a.drCount = 1 AND a.crCount >= 1) OR (a.drCount >= 1 AND a.crCount = 1)) AND a.subjectId IN ({subjectId}) AND b.assItemId IN ({assItemId}) UNION ALL SELECT a.subjectId,b.assItemId,a.corrSubjectId,a.direction,a.corrValue,a.voucherId,a.serail,a.vchDate,a.oldVoucherId,a.typeId FROM {lockDbName}.fin_subjectvouchercorr a INNER JOIN {lockDbName}.fin_assitementry b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.voucherId = a.voucherId AND b.serail = a.serail WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.voucherType IN ('m','s','r') /*START #startMonth# AND a.month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND a.month <= {endMonth} #endMonth# END*/ AND a.subjectId IN ({subjectId}) AND b.assItemId IN ({assItemId}) ORDER BY voucherId,serail
#\u83B7\u53D6\u8D26\u9F84\u503A\u52A1\u4EBA\u6570\u636E
FIN900036=select a.subjectId,a.subjectName,case when c.assItemId is null then a.subjectId else c.assItemId end as assItemId,case when c.assItemName is null then a.subjectName else c.assItemName end as assItemName,case when c.balance is null then b.balance else c.balance end as balance from {lockDbName}.fin_accpkgsubject a left join {lockDbName}.fin_account b on a.customerId = b.customerId and a.yyyy = b.yyyy and a.subjectId = b.subjectId and b.isLeaf1 = 1 left join {lockDbName}.fin_assitementryacc c on b.customerId = c.customerId and b.yyyy = c.yyyy and b.subMonth = c.subMonth and b.subjectId = c.subjectId and c.isLeaf1 = 1 where a.customerId = {lockCustomerId} and a.yyyy = {lockYyyy} and b.subMonth = {subMonth} and c.subMonth = {subMonth} and (a.subjectFullId like '{subjectId}/%' or a.subjectFullId = '{subjectId}') and a.isLeaf1 = 1 order by a.subjectId,c.assItemId
#\u83B7\u53D6\u79D1\u76EE\u7684\u6240\u6709\u5B50\u79D1\u76EE
FIN900037=SELECT a.subjectId, a.subjectName, a.subjectFullName FROM {lockDbName}.fin_accpkgsubject a WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.subjectId LIKE '{param1}%'
#\u83B7\u53D6\u79D1\u76EE\u7684\u6240\u6709\u4E0B\u7EA7\u79D1\u76EE
FIN900038=SELECT a.subjectId, a.subjectName, a.subjectFullName FROM {lockDbName}.fin_accpkgsubject a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectId LIKE '{param4}%' AND a.level1 = ( SELECT a.level1 + 1 FROM {lockDbName}.fin_accpkgsubject a WHERE a.customerId = {param1} AND a.yyyy ={param2} AND a.subjectId = '{param4}' )
#\u83B7\u53D6\u79D1\u76EE,\u671F\u672B\u6570,\u671F\u521D\u6570\u5217\u8868
FIN900039=SELECT a.subjectId, a.subjectName, a.subjectFullName, null AS assItemId, null AS assItemName, a.balance, a.remain, a.debitOcc, a.debitTotalOcc, a.creditTotalOcc  FROM {lockDbName}.fin_account a  WHERE a.customerId = {customerId}  AND a.yyyy = {projectYear}  AND a.subMonth = {subMonth}  AND a.subjectId in ({subjectIds})  ORDER BY a.subjectId
#\u83B7\u53D6A11-\u5B58\u8D27\u5E95\u7A3F\u6570\u636E
FIN900040=SELECT a.subjectId, a.subjectName, a.subjectFullName, null AS assItemId, null AS assItemName, a.remain, a.debitTotalOcc, a.creditTotalOcc FROM {lockDbName}.fin_account a  WHERE a.customerId = {customerId} AND a.yyyy = {projectYear} AND a.subMonth = {subMonth} AND a.subjectId IN ( {subjectIds} ) ORDER BY a.subjectId,a.assItemId
#\u6839\u636E\u79D1\u76EE\u7F16\u53F7\u83B7\u53D6\u79D1\u76EE\u8868\u4FE1\u606F
FIN900041=SELECT customerId, yyyy, subjectId, subjectName, parentSubjectId, subjectFullId, subjectFullName, direction, currency, isLeaf1, level1 FROM {lockDbName}.fin_accpkgsubject WHERE customerId = {param1} AND yyyy = {param2} AND subjectId = '{param3}' 
#\u67E5\u8BE2\u7B26\u5408\u6761\u4EF6\u7684\u5BA1\u8BA1\u6761\u4EF6
FIN900042=SELECT a.yyyy as subYearMonth,a.subMonth, a.assItemId,a.subjectId as accId,a.subjectName AS accName, a.assItemName, a.remain, a.balance, a.debitTotalOcc as debitAmount, a.creditTotalOcc as creditAmount, 1 AS hasAssItem FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId = '{customerId}' AND a.subjectId LIKE '{accId}%' AND a.isLeaf1 = '1' AND a.yyyy >= '{subYearMonth}' AND a.subMonth  = '{subMonth}' union select b.yyyy AS subYearMonth, b.subMonth, null, b.subjectId AS accId,b.subjectName AS accName, null, b.remain, b.balance, b.debitTotalOcc AS debitAmount, b.creditTotalOcc AS creditAmount, b.hasAssItem FROM {lockDbName}.fin_account b WHERE b.customerId = '{customerId}' AND b.subjectId LIKE '{accId}%' AND b.isLeaf1 = '1' AND b.yyyy >= '{subYearMonth}' AND b.subMonth = '{subMonth}'and b.hasAssItem !=1
##20200605 \u67E5\u8BE2\u6570\u636E\u6765\u6E90\u589E\u52A0fin_account\u8868, \u67E5\u8BE2\u542B\u8F85\u52A9\u6838\u7B97\u7684\u4F59\u989D\u8868\u6570\u636E\uFF0C\u8BA1\u7B97\u8D26\u9F84\u7528
FIN900043=SELECT b.yyyy AS subYearMonth, b.subMonth, b.subjectId AS accId,b.subjectName AS accName, b.remain, b.balance, b.debitTotalOcc AS debitAmount, b.creditTotalOcc AS creditAmount, b.hasAssItem FROM {lockDbName}.fin_account b WHERE b.customerId = '{customerId}' AND b.subjectId LIKE '{accId}%' AND b.isLeaf1 = '1' AND b.yyyy = '{subYearMonth}' AND b.subMonth = '{subMonth}'and b.hasAssItem =1
##20200605 \u67E5\u8BE2\u6570\u636E\u6765\u6E90\u589E\u52A0fin_account\u8868, \u67E5\u8BE2\u542B\u8F85\u52A9\u6838\u7B97\u7684\u4F59\u989D\u8868\u6570\u636E\uFF0C\u5224\u65AD\u671F\u521D\u4E0E\u4E0A\u4E00\u5E74\u671F\u672B\u503C\u662F\u5426\u4E00\u81F4\u7528
FIN900044=SELECT b.yyyy AS subYearMonth, b.subMonth, b.subjectId AS accId,b.subjectName AS accName, b.remain, b.balance, b.debitTotalOcc AS debitAmount, b.creditTotalOcc AS creditAmount, b.hasAssItem FROM {lockDbName}.fin_account b WHERE b.customerId = '{customerId}' AND b.subjectId LIKE '{accId}%' AND b.isLeaf1 = '1' AND b.yyyy >= '{subYearMonth}' AND b.subMonth = '{subMonth}'and b.hasAssItem =1
##\u8D26\u9F84\u5206\u6790 - cg
##20200529 \u67E5\u8BE2\u6570\u636E\u6765\u6E90\u589E\u52A0fin_account\u8868,\u6761\u4EF6\u4E0E\u79D1\u76EE\u6838\u7B97\u4F59\u989D\u8868\u4E00\u81F4\uFF0C\u589E\u52A0\u6761\u4EF6 hasAssItem\u662F\u5426\u542B\u8F85\u52A9\u6838\u7B97\uFF08\u5426\uFF09
FIN900045=SELECT a.yyyy as subYearMonth,a.subMonth, a.assItemId,a.subjectId as accId,a.subjectName AS accName, a.assItemName, a.remain, a.balance, a.debitTotalOcc as debitAmount, a.creditTotalOcc as creditAmount ,1 as hasAssItem FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId = '{customerId}' AND a.subjectId LIKE '{accId}%' AND a.isLeaf1 = '1' AND a.yyyy = '{subYearMonth}' AND a.subMonth = '{subMonth}' union select b.yyyy AS subYearMonth, b.subMonth, null, b.subjectId AS accId,b.subjectName AS accName, null, b.remain, b.balance, b.debitTotalOcc AS debitAmount, b.creditTotalOcc AS creditAmount, b.hasAssItem FROM {lockDbName}.fin_account b WHERE b.customerId = '{customerId}' AND b.subjectId LIKE '{accId}%' AND b.isLeaf1 = '1' AND b.yyyy = '{subYearMonth}' AND b.subMonth = '{subMonth}'and b.hasAssItem !=1
#\u83B7\u53D6\u5168\u90E8\u79D1\u76EE\u540D\u79F0
FIN900046=SELECT DISTINCT subjectId  FROM {lockDbName}.fin_accpkgsubject WHERE customerId = {customerId} AND yyyy = {yyyy} AND (subjectFullId LIKE '{subjectId}/%'  OR subjectId = '{subjectId}' OR subjectFullId LIKE '%/{subjectId}/%') AND isLeaf1 = '1'
#\u83B7\u53D6\u79D1\u76EE\u4E0B\u7684\u6838\u7B97\u660E\u7EC6
FIN900047=SELECT b.subjectId, b.subjectName,  b.subjectFullName, b.assItemId, b.assItemName, b.balance, b.remain, b.debitOcc, b.debitTotalOcc, b.creditTotalOcc FROM {lockDbName}.fin_assitementryacc b WHERE b.customerId = {customerId}  AND b.yyyy = {projectYear}  AND b.subMonth = {subMonth} AND b.subjectId IN ({subjectIds}) ORDER BY b.subjectId,b.assItemId

####################\u9879\u76EE\u4E2D\u5FC3--\u73B0\u91D1\u6D41\u91CF\u8868--\u76F4\u63A5\u6CD5####################
#\u73B0\u91D1\u6D41\u91CF\u8868--\u79D1\u76EE
FINXJ928=SELECT a.subjectId, a.subjectName, a.subjectIdTop, a.subjectNameTop, a.oppoSubjectId, a.oppoSubjectName, a.oppoSubjectIdTop, a.oppoSubjectNameTop, a.month, a.oldVoucherId, a.voucherId, a.vchDate, a.typeId, a.serail, a.summary, a.direction, SUM(a.occurValue) AS occurValue FROM (SELECT a.subjectId, b.subjectFullName AS subjectName, SUBSTRING_INDEX(b.subjectFullId, '/', 1) AS subjectIdTop, SUBSTRING_INDEX(b.subjectFullName, '/', 1) AS subjectNameTop, a.oppoSubjectId, c.subjectFullName AS oppoSubjectName, SUBSTRING_INDEX(c.subjectFullId, '/', 1) AS oppoSubjectIdTop, SUBSTRING_INDEX(c.subjectFullName, '/', 1) AS oppoSubjectNameTop, a.month, a.oldVoucherId, a.voucherId, a.vchDate, a.typeId, a.serail, a.summary, a.direction, a.occurValue FROM ( SELECT subjectId AS oppoSubjectId, debitsubjects AS subjectId, month, oldVoucherId, voucherId, vchDate, typeId, serail, summary, 1 AS direction, occurValue FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ AND direction = -1 AND voucherId IN ( SELECT DISTINCT voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ AND subjectId IN ({subjectId}) AND direction = 1 AND drCount = 1 AND crCount >= 1 ) /*START #analyzedVoucherId# AND voucherId NOT IN ({analyzedVoucherId}) #analyzedVoucherId# END*/ UNION ALL SELECT creditsubjects AS oppoSubjectId, subjectId, month, oldVoucherId, voucherId, vchDate, typeId, serail, summary, 1 AS direction, occurValue FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ AND direction = 1 AND subjectId IN ({subjectId}) AND voucherId IN ( SELECT DISTINCT voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ AND subjectId IN ({subjectId}) AND direction = 1 AND drCount > 1 AND crCount = 1 ) /*START #analyzedVoucherId# AND voucherId NOT IN ({analyzedVoucherId}) #analyzedVoucherId# END*/ UNION ALL SELECT a.corrSubjectId AS oppoSubjectId, a.subjectId, a.month, a.oldVoucherId, a.voucherId, a.vchDate, a.typeId, a.serail, b.summary, 1 AS direction, a.corrValue AS occurValue FROM {lockDbName}.fin_subjectvouchercorr a INNER JOIN {lockDbName}.fin_subjectentry b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.voucherId = a.voucherId AND b.serail = a.serail WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.voucherType IN ('m','s','r') /*START #startMonth# AND a.month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND a.month <= {endMonth} #endMonth# END*/ AND a.direction = 1 AND a.subjectId IN ({subjectId}) UNION ALL SELECT subjectId AS oppoSubjectId, creditsubjects AS subjectId, month, oldVoucherId, voucherId, vchDate, typeId, serail, summary, -1 AS direction, occurValue FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ AND direction = 1 AND voucherId IN ( SELECT DISTINCT voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ AND subjectId IN ({subjectId}) AND direction = -1 AND drCount >= 1 AND crCount = 1 ) /*START #analyzedVoucherId# AND voucherId NOT IN ({analyzedVoucherId}) #analyzedVoucherId# END*/ UNION ALL SELECT debitsubjects AS oppoSubjectId, subjectId, month, oldVoucherId, voucherId, vchDate, typeId, serail, summary, -1 AS direction, occurValue FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ AND direction = -1 AND subjectId IN ({subjectId}) AND voucherId IN ( SELECT DISTINCT voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ AND subjectId IN ({subjectId}) AND direction = -1 AND drCount = 1 AND crCount > 1 ) /*START #analyzedVoucherId# AND voucherId NOT IN ({analyzedVoucherId}) #analyzedVoucherId# END*/ UNION ALL SELECT a.corrSubjectId AS oppoSubjectId, a.subjectId, a.month, a.oldVoucherId, a.voucherId, a.vchDate, a.typeId, a.serail, b.summary, -1 AS direction, a.corrValue AS occurValue FROM {lockDbName}.fin_subjectvouchercorr a INNER JOIN {lockDbName}.fin_subjectentry b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.voucherId = a.voucherId AND b.serail = a.serail WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.voucherType IN ('m','s','r') /*START #startMonth# AND a.month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND a.month <= {endMonth} #endMonth# END*/ AND a.direction = -1 AND a.subjectId IN ({subjectId})) a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = {lockCustomerId} AND b.yyyy = {lockYyyy} AND b.subjectId = a.subjectId LEFT JOIN {lockDbName}.fin_accpkgsubject c ON c.customerId = {lockCustomerId} AND c.yyyy = {lockYyyy} AND c.subjectId = a.oppoSubjectId {eliminate} /*START #startDate# WHERE a.vchDate >= '{startDate}' AND a.vchDate <= '{enDate}' #startDate# END*/ ) a GROUP BY a.subjectId, a.oppoSubjectId, a.voucherId, a.direction ORDER BY a.subjectId, a.vchDate
FINXJ929=SELECT a.subjectId, a.subjectName, a.subjectIdTop, a.subjectNameTop, GROUP_CONCAT(DISTINCT a.oppoSubjectId) AS oppoSubjectId, GROUP_CONCAT(DISTINCT a.oppoSubjectName) AS oppoSubjectName, GROUP_CONCAT(DISTINCT a.oppoSubjectIdTop) AS oppoSubjectIdTop, GROUP_CONCAT(DISTINCT a.oppoSubjectNameTop) AS oppoSubjectNameTop, a.month, a.oldVoucherId, a.voucherId, a.vchDate, a.typeId, GROUP_CONCAT(DISTINCT a.serail) AS serail, GROUP_CONCAT(DISTINCT a.summary) AS summary, a.direction, SUM(a.occurValue) AS occurValue FROM ( SELECT a.subjectId, b.subjectFullName AS subjectName, SUBSTRING_INDEX(b.subjectFullId, '/', 1) AS subjectIdTop, SUBSTRING_INDEX(b.subjectFullName, '/', 1) AS subjectNameTop, a.oppoSubjectId, c.subjectFullName AS oppoSubjectName, SUBSTRING_INDEX(c.subjectFullId, '/', 1) AS oppoSubjectIdTop, SUBSTRING_INDEX(c.subjectFullName, '/', 1) AS oppoSubjectNameTop, a.month, a.oldVoucherId, a.voucherId, a.vchDate, a.typeId, a.serail, a.summary, a.direction, a.occurValue FROM ( SELECT subjectId AS oppoSubjectId, debitsubjects AS subjectId, MONTH, oldVoucherId, voucherId, vchDate, typeId, serail, summary, 1 AS direction, occurValue FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ AND direction = -1 AND voucherId IN ( SELECT DISTINCT voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ AND subjectId IN ({subjectId}) AND voucherId IN ({entryIds}) AND direction = 1 AND drCount = 1 AND crCount >= 1 ) /*START #analyzedVoucherId# AND voucherId NOT IN ({analyzedVoucherId}) #analyzedVoucherId# END*/ UNION ALL SELECT creditsubjects AS oppoSubjectId, subjectId, MONTH, oldVoucherId, voucherId, vchDate, typeId, serail, summary, 1 AS direction, occurValue FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ AND direction = 1 AND subjectId IN ({subjectId}) AND voucherId IN ( SELECT DISTINCT voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ AND subjectId IN ({subjectId}) AND voucherId IN ({entryIds}) AND direction = 1 AND drCount > 1 AND crCount = 1 ) /*START #analyzedVoucherId# AND voucherId NOT IN ({analyzedVoucherId}) #analyzedVoucherId# END*/ UNION ALL SELECT a.corrSubjectId AS oppoSubjectId, a.subjectId, a.month, a.oldVoucherId, a.voucherId, a.vchDate, a.typeId, a.serail, b.summary, 1 AS direction, a.corrValue AS occurValue FROM {lockDbName}.fin_subjectvouchercorr a INNER JOIN {lockDbName}.fin_subjectentry b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.voucherId = a.voucherId AND b.serail = a.serail WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.voucherType IN ('m','s','r') /*START #startMonth# AND a.month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND a.month <= {endMonth} #endMonth# END*/ AND a.direction = 1 AND a.subjectId IN ({subjectId}) AND a.voucherId IN ({entryIds}) UNION ALL SELECT subjectId AS oppoSubjectId, creditsubjects AS subjectId, MONTH, oldVoucherId, voucherId, vchDate, typeId, serail, summary, -1 AS direction, occurValue FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ AND direction = 1 AND voucherId IN ( SELECT DISTINCT voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ AND subjectId IN ({subjectId}) AND voucherId IN ({entryIds}) AND direction = -1 AND drCount >= 1 AND crCount = 1 ) /*START #analyzedVoucherId# AND voucherId NOT IN ({analyzedVoucherId}) #analyzedVoucherId# END*/ UNION ALL SELECT debitsubjects AS oppoSubjectId, subjectId, MONTH, oldVoucherId, voucherId, vchDate, typeId, serail, summary, -1 AS direction, occurValue FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ AND direction = -1 AND subjectId IN ({subjectId}) AND voucherId IN ( SELECT DISTINCT voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ AND subjectId IN ({subjectId}) AND voucherId IN ({entryIds}) AND direction = -1 AND drCount = 1 AND crCount > 1 ) /*START #analyzedVoucherId# AND voucherId NOT IN ({analyzedVoucherId}) #analyzedVoucherId# END*/ UNION ALL SELECT a.corrSubjectId AS oppoSubjectId, a.subjectId, a.month, a.oldVoucherId, a.voucherId, a.vchDate, a.typeId, a.serail, b.summary, -1 AS direction, a.corrValue AS occurValue FROM {lockDbName}.fin_subjectvouchercorr a INNER JOIN {lockDbName}.fin_subjectentry b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.voucherId = a.voucherId AND b.serail = a.serail WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.voucherType IN ('m','s','r') /*START #startMonth# AND a.month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND a.month <= {endMonth} #endMonth# END*/ AND a.direction = -1 AND a.subjectId IN ({subjectId}) AND a.voucherId IN ({entryIds})) a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = {lockCustomerId} AND b.yyyy = {lockYyyy} AND b.subjectId = a.subjectId LEFT JOIN {lockDbName}.fin_accpkgsubject c ON c.customerId = {lockCustomerId} AND c.yyyy = {lockYyyy} AND c.subjectId = a.oppoSubjectId {eliminate} ORDER BY a.subjectId, a.vchDate ) a WHERE a.oppoSubjectIdTop = '{oppoSubjectId}' AND a.voucherId IN ({entryIds}) GROUP BY a.voucherId, a.direction ORDER BY a.vchDate
FINXJ930=SELECT a.* FROM ( SELECT a.subjectId, b.subjectFullName AS subjectName, SUBSTRING_INDEX(b.subjectFullId, '/', 1) AS subjectIdTop, SUBSTRING_INDEX(b.subjectFullName, '/', 1) AS subjectNameTop, a.oppoSubjectId, c.subjectFullName AS oppoSubjectName, SUBSTRING_INDEX(c.subjectFullId, '/', 1) AS oppoSubjectIdTop, SUBSTRING_INDEX(c.subjectFullName, '/', 1) AS oppoSubjectNameTop, a.month, a.oldVoucherId, a.voucherId, a.vchDate, a.typeId, a.serail, a.summary, a.direction, a.occurValue FROM ( SELECT subjectId AS oppoSubjectId, debitsubjects AS subjectId, MONTH, oldVoucherId, voucherId, vchDate, typeId, serail, summary, 1 AS direction, occurValue FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ AND direction = -1 AND voucherId IN ( SELECT DISTINCT voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ AND subjectId IN ({subjectId}) AND voucherId IN ({entryIds}) AND direction = 1 AND drCount = 1 AND crCount >= 1 ) /*START #analyzedVoucherId# AND voucherId NOT IN ({analyzedVoucherId}) #analyzedVoucherId# END*/ UNION ALL SELECT creditsubjects AS oppoSubjectId, subjectId, MONTH, oldVoucherId, voucherId, vchDate, typeId, serail, summary, 1 AS direction, occurValue FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ AND direction = 1 AND subjectId IN ({subjectId}) AND voucherId IN ( SELECT DISTINCT voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ AND subjectId IN ({subjectId}) AND voucherId IN ({entryIds}) AND direction = 1 AND drCount > 1 AND crCount = 1 ) /*START #analyzedVoucherId# AND voucherId NOT IN ({analyzedVoucherId}) #analyzedVoucherId# END*/ UNION ALL SELECT a.corrSubjectId AS oppoSubjectId, a.subjectId, a.month, a.oldVoucherId, a.voucherId, a.vchDate, a.typeId, a.serail, b.summary, 1 AS direction, a.corrValue AS occurValue FROM {lockDbName}.fin_subjectvouchercorr a INNER JOIN {lockDbName}.fin_subjectentry b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.voucherId = a.voucherId AND b.serail = a.serail WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.voucherType IN ('m','s','r') /*START #startMonth# AND a.month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND a.month <= {endMonth} #endMonth# END*/ AND a.direction = 1 AND a.subjectId IN ({subjectId}) AND a.voucherId IN ({entryIds}) UNION ALL SELECT subjectId AS oppoSubjectId, creditsubjects AS subjectId, MONTH, oldVoucherId, voucherId, vchDate, typeId, serail, summary, -1 AS direction, occurValue FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ AND direction = 1 AND voucherId IN ( SELECT DISTINCT voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ AND subjectId IN ({subjectId}) AND voucherId IN ({entryIds}) AND direction = -1 AND drCount >= 1 AND crCount = 1 ) /*START #analyzedVoucherId# AND voucherId NOT IN ({analyzedVoucherId}) #analyzedVoucherId# END*/ UNION ALL SELECT debitsubjects AS oppoSubjectId, subjectId, MONTH, oldVoucherId, voucherId, vchDate, typeId, serail, summary, -1 AS direction, occurValue FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ AND direction = -1 AND subjectId IN ({subjectId}) AND voucherId IN ( SELECT DISTINCT voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #startMonth# AND month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND month <= {endMonth} #endMonth# END*/ AND subjectId IN ({subjectId}) AND voucherId IN ({entryIds}) AND direction = -1 AND drCount = 1 AND crCount > 1 ) /*START #analyzedVoucherId# AND voucherId NOT IN ({analyzedVoucherId}) #analyzedVoucherId# END*/ UNION ALL SELECT a.corrSubjectId AS oppoSubjectId, a.subjectId, a.month, a.oldVoucherId, a.voucherId, a.vchDate, a.typeId, a.serail, b.summary, -1 AS direction, a.corrValue AS occurValue FROM {lockDbName}.fin_subjectvouchercorr a INNER JOIN {lockDbName}.fin_subjectentry b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.voucherId = a.voucherId AND b.serail = a.serail WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.voucherType IN ('m','s','r') /*START #startMonth# AND a.month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND a.month <= {endMonth} #endMonth# END*/ AND a.direction = -1 AND a.subjectId IN ({subjectId}) AND a.voucherId IN ({entryIds})) a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = {lockCustomerId} AND b.yyyy = {lockYyyy} AND b.subjectId = a.subjectId LEFT JOIN {lockDbName}.fin_accpkgsubject c ON c.customerId = {lockCustomerId} AND c.yyyy = {lockYyyy} AND c.subjectId = a.oppoSubjectId {eliminate} ORDER BY a.subjectId, a.vchDate ) a WHERE a.oppoSubjectIdTop = '{oppoSubjectId}' AND a.voucherId IN ({entryIds})
#\u73B0\u91D1\u6D41\u91CF\u8868--\u6838\u7B97
FINXJ931=SELECT GROUP_CONCAT(DISTINCT a.oppoSubjectId) AS oppoSubjectId, GROUP_CONCAT( DISTINCT c.subjectFullName ORDER BY c.subjectId ) AS oppoSubjectName, GROUP_CONCAT( DISTINCT SUBSTRING_INDEX(c.subjectFullId, '/', 1) ORDER BY c.subjectId ) AS oppoSubjectIdTop, GROUP_CONCAT( DISTINCT SUBSTRING_INDEX(c.subjectFullName, '/', 1) ORDER BY c.subjectId ) AS oppoSubjectNameTop, GROUP_CONCAT(DISTINCT a.subjectId) AS subjectId, GROUP_CONCAT( DISTINCT b.subjectFullName ORDER BY b.subjectId ) AS subjectName, GROUP_CONCAT( DISTINCT SUBSTRING_INDEX(b.subjectFullId, '/', 1) ORDER BY b.subjectId ) AS subjectIdTop, GROUP_CONCAT( DISTINCT SUBSTRING_INDEX(b.subjectFullName, '/', 1) ORDER BY b.subjectId ) AS subjectNameTop, a.month, a.oldVoucherId, a.voucherId, a.vchDate, a.typeId, a.serail, a.summary, a.direction, a.occurValue FROM ( SELECT b.creditsubjects AS oppoSubjectId, b.subjectId, b.month, b.oldVoucherId, b.voucherId, b.vchDate, b.typeId, b.serail, b.summary, 1 AS direction, b.occurValue FROM {lockDbName}.fin_assitementry a INNER JOIN {lockDbName}.fin_subjectentry b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.voucherId = a.voucherId AND b.serail = a.serail AND b.autoId = a.subjectEntryId WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} /*START #startMonth# AND b.month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND b.month <= {endMonth} #endMonth# END*/ AND a.subjectId IN ({subjectId}) {eliminate} AND a.assItemId = '{assitemId}' AND a.direction = 1 AND ((b.drCount = 1 AND b.crCount >= 1) OR (b.drCount >= 1 AND b.crCount = 1)) /*START #analyzedVoucherId# AND a.voucherId NOT IN ({analyzedVoucherId}) #analyzedVoucherId# END*/ UNION ALL SELECT c.corrSubjectId AS oppoSubjectId, c.subjectId, c.month, c.oldVoucherId, c.voucherId, c.vchDate, c.typeId, c.serail, b.summary, 1 AS direction, c.corrValue AS occurValue FROM {lockDbName}.fin_assitementry a INNER JOIN {lockDbName}.fin_subjectentry b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.voucherId = a.voucherId AND b.serail = a.serail AND b.autoId = a.subjectEntryId INNER JOIN {lockDbName}.fin_subjectvouchercorr c ON c.customerId = a.customerId AND c.yyyy = a.yyyy AND c.voucherId = a.voucherId AND c.serail = a.serail WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND c.voucherType IN ('m','s','r') /*START #startMonth# AND b.month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND b.month <= {endMonth} #endMonth# END*/ AND a.subjectId IN ({subjectId}) {eliminate} AND a.assItemId = '{assitemId}' AND a.direction = 1 UNION ALL SELECT b.debitsubjects AS subjectId, b.subjectId AS oppoSubjectId, b.month, b.oldVoucherId, b.voucherId, b.vchDate, b.typeId, b.serail, b.summary, -1 AS direction, b.occurValue FROM {lockDbName}.fin_assitementry a INNER JOIN {lockDbName}.fin_subjectentry b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.voucherId = a.voucherId AND b.serail = a.serail AND b.autoId = a.subjectEntryId WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} /*START #startMonth# AND b.month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND b.month <= {endMonth} #endMonth# END*/ AND a.subjectId IN ({subjectId}) {eliminate} AND a.assItemId = '{assitemId}' AND a.direction = -1 AND ((b.drCount = 1 AND b.crCount >= 1) OR (b.drCount >= 1 AND b.crCount = 1)) /*START #analyzedVoucherId# AND a.voucherId NOT IN ({analyzedVoucherId}) #analyzedVoucherId# END*/ UNION ALL SELECT c.corrSubjectId AS oppoSubjectId, c.subjectId, c.month, c.oldVoucherId, c.voucherId, c.vchDate, c.typeId, c.serail, b.summary, -1 AS direction, c.corrValue AS occurValue FROM {lockDbName}.fin_assitementry a INNER JOIN {lockDbName}.fin_subjectentry b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.voucherId = a.voucherId AND b.serail = a.serail AND b.autoId = a.subjectEntryId INNER JOIN {lockDbName}.fin_subjectvouchercorr c ON c.customerId = a.customerId AND c.yyyy = a.yyyy AND c.voucherId = a.voucherId AND c.serail = a.serail WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND c.voucherType IN ('m','s','r') /*START #startMonth# AND b.month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND b.month <= {endMonth} #endMonth# END*/ AND a.subjectId IN ({subjectId}) {eliminate} AND a.assItemId = '{assitemId}' AND a.direction = -1 ) a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = {lockCustomerId} AND b.yyyy = {lockYyyy} AND FIND_IN_SET(b.subjectId, a.subjectId) LEFT JOIN {lockDbName}.fin_accpkgsubject c ON c.customerId = {lockCustomerId} AND c.yyyy = {lockYyyy} AND FIND_IN_SET( c.subjectId, a.oppoSubjectId ) /*START #startDate# WHERE a.vchDate >= '{startDate}' AND a.vchDate <= '{enDate}' #startDate# END*/ GROUP BY a.oppoSubjectId, a.subjectId ORDER BY a.oppoSubjectId, a.subjectId
FINXJ932=SELECT a.subjectId, a.subjectName, a.subjectIdTop, a.subjectNameTop, GROUP_CONCAT(DISTINCT a.oppoSubjectId) AS oppoSubjectId, GROUP_CONCAT(DISTINCT a.oppoSubjectName) AS oppoSubjectName, GROUP_CONCAT(DISTINCT a.oppoSubjectIdTop) AS oppoSubjectIdTop, GROUP_CONCAT(DISTINCT a.oppoSubjectNameTop) AS oppoSubjectNameTop, a.month, a.oldVoucherId, a.voucherId, a.vchDate, a.typeId, GROUP_CONCAT(DISTINCT a.serail) AS serail, GROUP_CONCAT(DISTINCT a.summary) AS summary, a.direction, SUM(a.occurValue) AS occurValue FROM ( SELECT GROUP_CONCAT(DISTINCT a.oppoSubjectId) AS oppoSubjectId, GROUP_CONCAT( DISTINCT c.subjectFullName ORDER BY c.subjectId ) AS oppoSubjectName, GROUP_CONCAT( DISTINCT SUBSTRING_INDEX(c.subjectFullId, '/', 1) ORDER BY c.subjectId ) AS oppoSubjectIdTop, GROUP_CONCAT( DISTINCT SUBSTRING_INDEX(c.subjectFullName, '/', 1) ORDER BY c.subjectId ) AS oppoSubjectNameTop, GROUP_CONCAT(DISTINCT a.subjectId) AS subjectId, GROUP_CONCAT( DISTINCT b.subjectFullName ORDER BY b.subjectId ) AS subjectName, GROUP_CONCAT( DISTINCT SUBSTRING_INDEX(b.subjectFullId, '/', 1) ORDER BY b.subjectId ) AS subjectIdTop, GROUP_CONCAT( DISTINCT SUBSTRING_INDEX(b.subjectFullName, '/', 1) ORDER BY b.subjectId ) AS subjectNameTop, a.month, a.oldVoucherId, a.voucherId, a.vchDate, a.typeId, a.serail, a.summary, a.direction, a.occurValue FROM ( SELECT b.creditsubjects AS oppoSubjectId, b.subjectId, b.month, b.oldVoucherId, b.voucherId, b.vchDate, b.typeId, b.serail, b.summary, 1 AS direction, b.occurValue FROM {lockDbName}.fin_assitementry a INNER JOIN {lockDbName}.fin_subjectentry b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.voucherId = a.voucherId AND b.serail = a.serail AND b.autoId = a.subjectEntryId WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} /*START #startMonth# AND b.month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND b.month <= {endMonth} #endMonth# END*/ AND a.subjectId IN ({subjectId}) {eliminate} AND a.assItemId = '{assitemId}' AND a.direction = 1 AND ((b.drCount = 1 AND b.crCount >= 1) OR (b.drCount >= 1 AND b.crCount = 1)) /*START #analyzedVoucherId# AND a.voucherId NOT IN ({analyzedVoucherId}) #analyzedVoucherId# END*/ UNION ALL SELECT c.corrSubjectId AS oppoSubjectId, c.subjectId, c.month, c.oldVoucherId, c.voucherId, c.vchDate, c.typeId, c.serail, b.summary, 1 AS direction, c.corrValue AS occurValue FROM {lockDbName}.fin_assitementry a INNER JOIN {lockDbName}.fin_subjectentry b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.voucherId = a.voucherId AND b.serail = a.serail AND b.autoId = a.subjectEntryId INNER JOIN {lockDbName}.fin_subjectvouchercorr c ON c.customerId = a.customerId AND c.yyyy = a.yyyy AND c.voucherId = a.voucherId AND c.serail = a.serail WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND c.voucherType IN ('m','s','r') /*START #startMonth# AND b.month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND b.month <= {endMonth} #endMonth# END*/ AND a.subjectId IN ({subjectId}) {eliminate} AND a.assItemId = '{assitemId}' AND a.direction = 1 UNION ALL SELECT b.debitsubjects AS subjectId, b.subjectId AS oppoSubjectId, b.month, b.oldVoucherId, b.voucherId, b.vchDate, b.typeId, b.serail, b.summary, -1 AS direction, b.occurValue FROM {lockDbName}.fin_assitementry a INNER JOIN {lockDbName}.fin_subjectentry b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.voucherId = a.voucherId AND b.serail = a.serail AND b.autoId = a.subjectEntryId WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} /*START #startMonth# AND b.month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND b.month <= {endMonth} #endMonth# END*/ AND a.subjectId IN ({subjectId}) {eliminate} AND a.assItemId = '{assitemId}' AND a.direction = -1 AND ((b.drCount = 1 AND b.crCount >= 1) OR (b.drCount >= 1 AND b.crCount = 1)) /*START #analyzedVoucherId# AND a.voucherId NOT IN ({analyzedVoucherId}) #analyzedVoucherId# END*/ UNION ALL SELECT c.corrSubjectId AS oppoSubjectId, c.subjectId, c.month, c.oldVoucherId, c.voucherId, c.vchDate, c.typeId, c.serail, b.summary, -1 AS direction, c.corrValue AS occurValue FROM {lockDbName}.fin_assitementry a INNER JOIN {lockDbName}.fin_subjectentry b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.voucherId = a.voucherId AND b.serail = a.serail AND b.autoId = a.subjectEntryId INNER JOIN {lockDbName}.fin_subjectvouchercorr c ON c.customerId = a.customerId AND c.yyyy = a.yyyy AND c.voucherId = a.voucherId AND c.serail = a.serail WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND c.voucherType IN ('m','s','r') /*START #startMonth# AND b.month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND b.month <= {endMonth} #endMonth# END*/ AND a.subjectId IN ({subjectId}) {eliminate} AND a.assItemId = '{assitemId}' AND a.direction = -1 ) a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = {lockCustomerId} AND b.yyyy = {lockYyyy} AND FIND_IN_SET(b.subjectId, a.subjectId) LEFT JOIN {lockDbName}.fin_accpkgsubject c ON c.customerId = {lockCustomerId} AND c.yyyy = {lockYyyy} AND FIND_IN_SET( c.subjectId, a.oppoSubjectId ) GROUP BY a.oppoSubjectId, a.subjectId ORDER BY a.oppoSubjectId, a.subjectId ) a WHERE a.voucherId IN ({entryIds}) AND a.oppoSubjectIdTop = '{oppoSubjectId}' GROUP BY a.voucherId, a.direction ORDER BY a.vchDate
FINXJ933=SELECT a.* FROM ( SELECT GROUP_CONCAT(DISTINCT a.oppoSubjectId) AS oppoSubjectId, GROUP_CONCAT( DISTINCT c.subjectFullName ORDER BY c.subjectId ) AS oppoSubjectName, GROUP_CONCAT( DISTINCT SUBSTRING_INDEX(c.subjectFullId, '/', 1) ORDER BY c.subjectId ) AS oppoSubjectIdTop, GROUP_CONCAT( DISTINCT SUBSTRING_INDEX(c.subjectFullName, '/', 1) ORDER BY c.subjectId ) AS oppoSubjectNameTop, GROUP_CONCAT(DISTINCT a.subjectId) AS subjectId, GROUP_CONCAT( DISTINCT b.subjectFullName ORDER BY b.subjectId ) AS subjectName, GROUP_CONCAT( DISTINCT SUBSTRING_INDEX(b.subjectFullId, '/', 1) ORDER BY b.subjectId ) AS subjectIdTop, GROUP_CONCAT( DISTINCT SUBSTRING_INDEX(b.subjectFullName, '/', 1) ORDER BY b.subjectId ) AS subjectNameTop, a.month, a.oldVoucherId, a.voucherId, a.vchDate, a.typeId, a.serail, a.summary, a.direction, a.occurValue FROM ( SELECT b.creditsubjects AS oppoSubjectId, b.subjectId, b.month, b.oldVoucherId, b.voucherId, b.vchDate, b.typeId, b.serail, b.summary, 1 AS direction, b.occurValue FROM {lockDbName}.fin_assitementry a INNER JOIN {lockDbName}.fin_subjectentry b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.voucherId = a.voucherId AND b.serail = a.serail AND b.autoId = a.subjectEntryId WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} /*START #startMonth# AND b.month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND b.month <= {endMonth} #endMonth# END*/ AND a.subjectId IN ({subjectId}) {eliminate} AND a.assItemId = '{assitemId}' AND a.direction = 1 AND ((b.drCount = 1 AND b.crCount >= 1) OR (b.drCount >= 1 AND b.crCount = 1)) /*START #analyzedVoucherId# AND a.voucherId NOT IN ({analyzedVoucherId}) #analyzedVoucherId# END*/ UNION ALL SELECT c.corrSubjectId AS oppoSubjectId, c.subjectId, c.month, c.oldVoucherId, c.voucherId, c.vchDate, c.typeId, c.serail, b.summary, 1 AS direction, c.corrValue AS occurValue FROM {lockDbName}.fin_assitementry a INNER JOIN {lockDbName}.fin_subjectentry b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.voucherId = a.voucherId AND b.serail = a.serail AND b.autoId = a.subjectEntryId INNER JOIN {lockDbName}.fin_subjectvouchercorr c ON c.customerId = a.customerId AND c.yyyy = a.yyyy AND c.voucherId = a.voucherId AND c.serail = a.serail WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND c.voucherType IN ('m','s','r') /*START #startMonth# AND b.month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND b.month <= {endMonth} #endMonth# END*/ AND a.subjectId IN ({subjectId}) {eliminate} AND a.assItemId = '{assitemId}' AND a.direction = 1 UNION ALL SELECT b.debitsubjects AS subjectId, b.subjectId AS oppoSubjectId, b.month, b.oldVoucherId, b.voucherId, b.vchDate, b.typeId, b.serail, b.summary, -1 AS direction, b.occurValue FROM {lockDbName}.fin_assitementry a INNER JOIN {lockDbName}.fin_subjectentry b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.voucherId = a.voucherId AND b.serail = a.serail AND b.autoId = a.subjectEntryId WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} /*START #startMonth# AND b.month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND b.month <= {endMonth} #endMonth# END*/ AND a.subjectId IN ({subjectId}) {eliminate} AND a.assItemId = '{assitemId}' AND a.direction = -1 AND ((b.drCount = 1 AND b.crCount >= 1) OR (b.drCount >= 1 AND b.crCount = 1)) /*START #analyzedVoucherId# AND a.voucherId NOT IN ({analyzedVoucherId}) #analyzedVoucherId# END*/ UNION ALL SELECT c.corrSubjectId AS oppoSubjectId, c.subjectId, c.month, c.oldVoucherId, c.voucherId, c.vchDate, c.typeId, c.serail, b.summary, -1 AS direction, c.corrValue AS occurValue FROM {lockDbName}.fin_assitementry a INNER JOIN {lockDbName}.fin_subjectentry b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.voucherId = a.voucherId AND b.serail = a.serail AND b.autoId = a.subjectEntryId INNER JOIN {lockDbName}.fin_subjectvouchercorr c ON c.customerId = a.customerId AND c.yyyy = a.yyyy AND c.voucherId = a.voucherId AND c.serail = a.serail WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND c.voucherType IN ('m','s','r') /*START #startMonth# AND b.month >= {startMonth} #startMonth# END*/ /*START #endMonth# AND b.month <= {endMonth} #endMonth# END*/ AND a.subjectId IN ({subjectId}) {eliminate} AND a.assItemId = '{assitemId}' AND a.direction = -1 ) a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = {lockCustomerId} AND b.yyyy = {lockYyyy} AND FIND_IN_SET(b.subjectId, a.subjectId) LEFT JOIN {lockDbName}.fin_accpkgsubject c ON c.customerId = {lockCustomerId} AND c.yyyy = {lockYyyy} AND FIND_IN_SET( c.subjectId, a.oppoSubjectId ) GROUP BY a.oppoSubjectId, a.subjectId ORDER BY a.oppoSubjectId, a.subjectId ) a WHERE a.voucherId IN ({entryIds}) AND a.oppoSubjectIdTop = '{oppoSubjectId}'
#\u73B0\u91D1\u7B49\u4EF7\u7269\u79D1\u76EE\u671F\u672B\u4F59\u989D
FINXJ001=SELECT a.* FROM ( SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName, a.assItemId, a.assItemName, SUM(a.remain) AS remain, SUM(a.balance) AS balance, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc FROM ( SELECT a.customerId, a.yyyy, a.subMonth, a.subjectId, a.subjectName, '' AS assItemId, '' AS assItemName, CASE WHEN a.subMonth = 1 THEN a.remain ELSE '' END AS remain, CASE WHEN a.subMonth = {param3} THEN a.balance ELSE '' END AS balance, a.debitOcc, a.creditOcc FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param3} AND a.subjectId = '{param4}' ) a GROUP BY a.customerId, a.yyyy, a.subjectId UNION ALL SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName, a.assItemId, a.assItemName, SUM(a.remain) AS remain, SUM(a.balance) AS balance, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc FROM ( SELECT a.customerId, a.yyyy, a.subMonth, a.subjectId, a.subjectName, a.assItemId, a.assItemName, CASE WHEN a.subMonth = 1 THEN a.remain ELSE '' END AS remain, CASE WHEN a.subMonth = {param3} THEN a.balance ELSE '' END AS balance, a.debitOcc, a.creditOcc FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param3} AND a.subjectId LIKE CONCAT('{param4}', '%') AND a.assItemId = '{param5}' ) a GROUP BY a.customerId, a.yyyy, a.subjectId, a.assItemId ) a WHERE a.customerId = {param1} AND a.yyyy = {param2} /*START #param4# AND a.subjectId = '{param4}' #param4# END*/ /*START #param5# AND a.subjectId LIKE CONCAT('{param4}', '%') #param5# END*/ AND a.assItemId = '{param5}'
#\u67E5\u8BE2\u79D1\u76EE\u6811
FINXJ002=SELECT a.*, b.remain, b.debitOcc, b.creditOcc, b.balance FROM ( SELECT aa.customerId, aa.yyyy, aa.subjectId, aa.subjectName, aa.leaf, aa. LEVEL, IF ( LENGTH(aa.parentId) = 1, '', aa.parentId ) AS parentId, aa.subjectFullId, aa.subjectFullName, aa.title FROM ( SELECT a.customerId, a.yyyy, a.subjectId, CONCAT( a.subjectId, '-', a.subjectFullName ) AS title, a.subjectName, IF ( LENGTH(a.parentSubjectId) = 0, SUBSTR(a.subjectId, 1, 1), a.parentSubjectId ) AS parentId, IF (a.isLeaf1 = 0, 'false', 'true') AS leaf, a.level1 AS LEVEL, a.subjectFullName, a.subjectFullId FROM {lockDbName}.fin_accpkgsubject a WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} ) aa ORDER BY aa.subjectId, aa.parentId, aa. LEVEL DESC ) a LEFT JOIN ( SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName, a.subjectFullName, a.dataName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.yyyy, a.subMonth, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, a.debitOcc, a.creditOcc, CASE WHEN a.subMonth = 12 THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} ) a GROUP BY a.customerId, a.yyyy, a.subjectId ) b ON a.customerId = b.customerId AND a.subjectId = b.subjectId
#\u67E5\u8BE2\u6838\u7B97\u6811
FINXJ003=SELECT DISTINCT a.assItemId AS id, a.assItemId, a.assItemName, IF ( b.num IS NULL, CONCAT( a.assItemId, ' : ', a.assTotalName ), CONCAT( a.assItemId, ' : ', a.assTotalName, ' (', b.num, ')' )) AS title, IF (a.isLeaf1 = 0, FALSE, TRUE) AS isLeaf, a.parentAssItemId AS parentId, a.level1, SUBSTRING_INDEX(a.subjectFullId, '/', 1) AS oneSubjectId FROM {lockDbName}.fin_assitem a LEFT JOIN ( SELECT parentAssItemId, count(DISTINCT assItemId) AS num FROM {lockDbName}.fin_assitem WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND subjectId LIKE '{param1}%' /*START #param3# AND assItemName LIKE '%{param3}%' #param3# END*/ GROUP BY parentAssItemId ) b ON a.assItemId = b.parentAssItemId WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param1}%' /*START #param2# AND a.assItemId LIKE CONCAT('%','{param2}','%') #param2# END*/ /*START #param3# AND a.assItemName LIKE CONCAT('%','{param3}','%') #param3# END*/ /*START #param4# AND CONCAT(a.assItemId,'-',a.assItemName) like CONCAT('%','{param4}','%') #param4# END*/ ORDER BY a.customerId, a.yyyy, a.assItemId LIMIT 50 
#\u6839\u636E\u51ED\u8BC1\u53F7\u83B7\u53D6\u51ED\u8BC1
FINXJ004=SELECT a.autoId, a.customerId, a.yyyy, a.month, a.subjectId, a.oldVoucherId, a.voucherId, a.vchDate, a.vchTime, a.typeId, a.serail, a.summary, a.direction, a.currency, a.occurValue, a.currRate, a.currValue, a.voucherKeepUser, a.voucherAuditUser, a.quantity, a.unitPrice, a.unitName, a.subjectName, a.subjectFullName, a.debitsubjects, a.creditsubjects, a.drCount, a.crCount, a.voucherDebitOcc, a.voucherCreditOcc, a.oppositeAccountTop, a.oppositeAccountLast, a.correspondOccurValue, a.voucherAffixCount, a.voucherDirector, a.isTransferVoucher FROM {lockDbName}.fin_subjectentry a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.voucherId = {param3} 
#\u8D22\u52A1\u8D26\u5957\u79D1\u76EE(subjectId)
FINXJ005=SELECT a.subjectId, a.subjectName, a.subjectFullId, a.subjectFullName, SUBSTRING_INDEX(a.subjectFullId, '/', 1) AS baseSubjectId, SUBSTRING_INDEX(a.subjectFullName, '/', 1) AS baseSubjectName FROM {lockDbName}.fin_accpkgsubject a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectId = '{param3}' 
#\u8D22\u52A1\u5E93\u662F\u5426\u5B58\u5728\u8868fin_cashflow
FINXJ006=SELECT table_name FROM information_schema.TABLES WHERE table_schema = '{lockDbName}' and table_name = 'fin_cashflow';
#\u8D22\u52A1\u8D26\u5957\u79D1\u76EE(subjectFullName)
FINXJ007=SELECT a.subjectId, a.subjectName, a.subjectFullId, a.subjectFullName, SUBSTRING_INDEX(a.subjectFullId, '/', 1) AS baseSubjectId, SUBSTRING_INDEX(a.subjectFullName, '/', 1) AS baseSubjectName FROM {lockDbName}.fin_accpkgsubject a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectFullName = '{param3}'
#\u8D22\u52A1\u8D26\u5957\u79D1\u76EE\u8F85\u52A9\u6838\u7B97(subjectName)(subjectName)
FINXJ008=SELECT a.assItemId, a.assItemName, a.assItemFullId, a.assTotalName, SUBSTRING_INDEX(a.assItemFullId, '|', 1) AS baseSubjectId, SUBSTRING_INDEX(a.assTotalName, '|', 1) AS baseSubjectName FROM {lockDbName}.fin_assitem a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectId IN ({param3}) AND a.assItemName = '{param4}'
#\u53D7\u9650\u6570\u636E\u6C47\u603B
FINXJ009=SELECT a.* FROM ( SELECT a.subjectIdTop AS subjectId, CASE WHEN a.oppoSubjectIdTop IN ({param4}) THEN CONCAT( a.subjectNameTop, '(\u53D7\u9650)' ) ELSE a.subjectNameTop END AS subjectName, a.oppoSubjectIdTop AS oppoSubjectId, a.oppoSubjectNameTop AS oppoSubjectName, a.direction, SUM(a.occurValue) AS occurValue FROM {lockDbName}.fin_cashflow a WHERE a.customerId = {param1} AND a.projectId = {param2} AND a.yyyy = {param3} AND a.direction = 1 GROUP BY a.subjectIdTop, a.oppoSubjectIdTop UNION ALL SELECT a.oppoSubjectIdTop AS subjectId, a.oppoSubjectNameTop AS subjectName, a.subjectIdTop AS oppoSubjectId, CASE WHEN a.oppoSubjectIdTop IN ({param4}) THEN CONCAT( a.subjectNameTop, '(\u53D7\u9650)' ) ELSE a.subjectNameTop END AS oppoSubjectName, a.direction, SUM(a.occurValue) AS occurValue FROM {lockDbName}.fin_cashflow a WHERE a.customerId = {param1} AND a.projectId = {param2} AND a.yyyy = {param3} AND a.direction = -1 GROUP BY a.subjectIdTop, a.oppoSubjectIdTop ) a ORDER BY a.subjectId, a.oppoSubjectId
#\u5173\u8054\u65B9-\u6838\u7B97-\u51ED\u8BC1\u5206\u5F55
FINXJ010=SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName, a.subjectFullName, a.assItemId, a.assItemName, a.assTotalName, a.oldVoucherId, a.voucherId, a.vchDate, a.serail, a.summary, a.direction, a.occurValue, a.subjectEntryId FROM {lockDbName}.fin_assitementry a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.assItemId = '{param3}' AND a.subjectId IN ({param4})
#\u5173\u8054\u65B9-\u6838\u7B97-\u51ED\u8BC1\u5206\u5F55-GROUP
FINXJ011=SELECT GROUP_CONCAT(DISTINCT a.voucherId) AS voucherIds FROM {lockDbName}.fin_assitementry a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.assItemId = '{param3}' AND a.subjectId IN ({param4})
#\u8D22\u52A1\u5E93\u521B\u5EFA\u8868
FINXJC01=CREATE TABLE {lockDbName}.fin_cashflow ( `autoId` INT (11) NOT NULL AUTO_INCREMENT COMMENT '\u81EA\u589EID', `customerId` INT (10) NOT NULL COMMENT '\u5BA2\u6237\u7F16\u53F7', `projectId` INT (20) NOT NULL COMMENT '\u9879\u76EE\u7F16\u53F7', `yyyy` INT (4) DEFAULT NULL COMMENT '\u5E74\u5EA6', `subjectId` TEXT DEFAULT NULL COMMENT '\u79D1\u76EE\u7F16\u53F7', `subjectName` TEXT DEFAULT NULL COMMENT '\u79D1\u76EE\u540D\u79F0', `subjectIdTop` TEXT DEFAULT NULL COMMENT '\u79D1\u76EE\u7F16\u53F7--\u4E00\u7EA7', `subjectNameTop` TEXT DEFAULT NULL COMMENT '\u79D1\u76EE\u540D\u79F0--\u4E00\u7EA7', `oppoSubjectId` TEXT DEFAULT NULL COMMENT '\u5BF9\u65B9\u79D1\u76EE\u7F16\u53F7', `oppoSubjectName` TEXT DEFAULT NULL COMMENT '\u5BF9\u65B9\u79D1\u76EE\u540D\u79F0', `oppoSubjectIdTop` TEXT DEFAULT NULL COMMENT '\u5BF9\u65B9\u79D1\u76EE\u7F16\u53F7--\u4E00\u7EA7', `oppoSubjectNameTop` TEXT DEFAULT NULL COMMENT '\u5BF9\u65B9\u79D1\u76EE\u540D\u79F0--\u4E00\u7EA7', `month` INT (2) DEFAULT '0' COMMENT '\u6708', `oldVoucherId` VARCHAR (50) DEFAULT NULL COMMENT '\u539F\u59CB\u6570\u636E\u51ED\u8BC1ID', `voucherId` VARCHAR (50) DEFAULT NULL COMMENT '\u7CFB\u7EDF\u751F\u6210\u51ED\u8BC1ID', `vchDate` VARCHAR (10) DEFAULT NULL COMMENT '\u51ED\u8BC1\u65E5\u671F', `typeId` VARCHAR (200) DEFAULT NULL COMMENT '\u51ED\u8BC1\u7C7B\u578B', `serail` INT (10) DEFAULT '0' COMMENT '\u5206\u5F55\u53F7', `summary` VARCHAR (200) DEFAULT NULL COMMENT '\u6458\u8981', `direction` INT (2) DEFAULT '0' COMMENT '\u501F\u8D37\u65B9\u5411', `occurValue` DECIMAL (30, 4) DEFAULT '0.0000' COMMENT '\u53D1\u751F\u989D(\u672C\u4F4D\u5E01)', `isEliminate` VARCHAR (1) DEFAULT '0' COMMENT '0\uFF1A\u975E\u53D7\u9650 1\uFF1A\u53D7\u9650', `isInner` VARCHAR (1) DEFAULT '0' COMMENT '0\uFF1A\u975E\u5185\u90E8 1\uFF1A\u5185\u90E8', `isUsed` VARCHAR (1) DEFAULT '0' COMMENT '0\uFF1A\u672A\u4F7F\u7528 1\uFF1A\u5DF2\u4F7F\u7528', `CREATION_DATE` DATETIME DEFAULT NULL COMMENT '\u521B\u5EFA\u65E5', `CREATED_BY` VARCHAR (20) DEFAULT NULL COMMENT '\u521B\u5EFA\u4EBAID', `LAST_UPDATE_DATE` DATETIME DEFAULT NULL COMMENT '\u6700\u540E\u66F4\u65B0\u65E5', `LAST_UPDATED_BY` VARCHAR (20) DEFAULT NULL COMMENT '\u6700\u540E\u66F4\u65B0\u4EBAID', `ABOLITION_DATE` DATETIME DEFAULT NULL COMMENT '\u5220\u9664\u65E5', `ABOLISHED_BY` VARCHAR (20) DEFAULT NULL COMMENT '\u5220\u9664\u4EBAID', `PROGRAM_APPLICATION_ID` VARCHAR (20) DEFAULT NULL COMMENT '\u4ECE\u54EA\u4E2A\u7CFB\u7EDF\u64CD\u4F5C\u7684\u6570\u636E', `PROGRAM_ID` VARCHAR (20) DEFAULT NULL COMMENT '\u54EA\u4E2A\u7A0B\u5E8F\u64CD\u4F5C\u7684\u6570\u636E', `ACTIVE_FLAG` VARCHAR (1) DEFAULT '1' COMMENT '0:\u65E0\u6548\u6570\u636E\uFF1B1\uFF1A\u6709\u6548\u6570\u636E', PRIMARY KEY (`autoId`, `customerId`), KEY `indexkey1` (`customerId`, `projectId`)) ENGINE = INNODB DEFAULT CHARSET = utf8 COMMENT = '\u73B0\u91D1\u6D41\u91CF\u8868\u8D22\u52A1\u51ED\u8BC1\u6570\u636E\u8868';
#\u8D22\u52A1\u5E93\u8868\u5220\u9664\u6570\u636E
FINXJD01=DELETE FROM {lockDbName}.fin_cashflow WHERE customerId = {param1} AND projectId = {param2} AND yyyy = {param3}
####################\u9879\u76EE\u4E2D\u5FC3--\u73B0\u91D1\u6D41\u91CF\u8868--\u76F4\u63A5\u6CD5####################
####################\u9879\u76EE\u4E2D\u5FC3####################
####################\u5E95\u7A3F\u53D6\u6570####################
#bdo_fin.fin_account\u4F59\u989D\u8868--\u6700\u5927\u6708\u4EFD--customerId\u3001subjectId\u3001subYearMonth
FINDG000001=SELECT MAX(a.subMonth) AS maxSubMonth FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param3} AND a.subjectId LIKE '{param2}%'
#bdo_fin.fin_accountall\u5916\u5E01\u4F59\u989D\u8868--\u6700\u5927\u6708\u4EFD--customerId\u3001subjectId\u3001subYearMonth
FINDG000002=SELECT MAX(a.subMonth) AS maxSubMonth FROM {lockDbName}.fin_accountall a WHERE a.customerId = {param1} AND a.yyyy = {param3} AND a.subjectId LIKE '{param2}%'
#bdo_fin.fin_assitementryacc\u6708\u6838\u7B97\u5206\u5F55\u8868--\u6700\u5927\u6708\u4EFD--customerId\u3001subYearMonth\u3001accId
FINDG000003=SELECT MAX(a.subMonth) AS maxSubMonth FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId = {param1} AND a.yyyy = {param3} AND a.subjectId LIKE '{param2}%'
#bdo_fin.fin_subjectentry\u51ED\u8BC1\u5206\u5F55\u8868--\u6700\u5927\u6708\u4EFD--customerId\u3001yyyy\u3001subjectId
FINDG000004=SELECT MAX(a.month) AS maxSubMonth FROM {lockDbName}.fin_subjectentry a WHERE a.customerId = {param1} AND a.yyyy = {param3} AND a.subjectId LIKE '{param2}%'
#\u66FF\u4EE3\u6D4B\u8BD5\u53D6\u6570
FINDG000005=select a.autoId,a.customerId,a.yyyy,a.month,a.voucherId,a.oldVoucherId,a.typeId,a.vchDate,a.serail,a.summary,a.subjectId,a.direction,b.occurValue,a.currRate,a.currValue,a.currency,a.subjectname,a.subjectFullName,IF (a.direction = 1,a.occurValue,0.00) AS debitValue,IF (a.direction = -1,a.occurValue,0.00) AS crebitValue,a.oppositeAccountLast,a.occurValue as confirmValue,a.oldVoucherId as oldVoucherIdNext,a.vchDate as vchDateNext,a.summary as summaryNext,a.occurValue as occurValueNext,a.oppositeAccountLast as oppositeAccountLastNext from {lockDbName}.fin_subjectentry a inner join {lockDbName}.fin_assitementry d on a.autoId = d.subjectEntryId and d.assItemId = '{param11}' /*START #param7# inner join (SELECT t2.subjectId FROM {lockDbName}.fin_accpkgsubject t1 ,{lockDbName}.fin_accpkgsubject t2 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ='{lockYyyy}' AND t1.subjectId = '{param1}' AND t1.customerId = t2.customerId AND t1.yyyy = t2.yyyy AND t2.subjectFullId LIKE CONCAT(t1.subjectFullId,'/%') UNION SELECT t1.subjectId FROM {lockDbName}.fin_accpkgsubject t1 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ='{lockYyyy}' AND t1.subjectId = '{param1}') c on a.subjectId = c.subjectId #param7# END*/,(select b.*,@total := @total + b.occurValue as total,@rownum := @rownum + 1 as rownum from (SELECT @total := 0,@rownum := 0) a,(select t.autoId,t.vchDate,t.yyyy,SUM(t.occurValue) as occurValue from {lockDbName}.fin_subjectentry t inner join {lockDbName}.fin_assitementry d on t.autoId = d.subjectEntryId and d.assItemId = '{param11}' inner join (SELECT t2.subjectId FROM {lockDbName}.fin_accpkgsubject t1 ,{lockDbName}.fin_accpkgsubject t2 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ='{lockYyyy}' AND t1.subjectId = '{param1}' AND t1.customerId = t2.customerId AND t1.yyyy = t2.yyyy AND t2.subjectFullId LIKE CONCAT(t1.subjectFullId,'/%') UNION SELECT t1.subjectId FROM {lockDbName}.fin_accpkgsubject t1 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ='{lockYyyy}' AND t1.subjectId = '{param1}') c on t.subjectId = c.subjectId where t.customerId = {lockCustomerId} /*START #param2# and t.vchDate < '{param2}' #param2# END*/ /*START #param3# and t.vchDate >= '{param3}' #param3# END*/ and t.direction = {param4} group by t.autoId,t.vchDate,t.yyyy ) b ORDER BY b.vchDate /*START #param2# desc #param2# END*/,b.autoId /*START #param2# desc #param2# END*/) b where a.autoId = b.autoId and a.yyyy = b.yyyy and b.rownum <= {rownum} ORDER BY a.vchDate /*START #param2# DESC #param2# END*/,a.voucherId /*START #param2# DESC #param2# END*/,a.autoId
#\u66FF\u4EE3\u6D4B\u8BD5\u67E5\u8BE2\u6838\u7B97\u671F\u521D\u671F\u672B
FINDG000006=select a.assItemId,a.assItemName,sum(case when a.subMonth=1 then a.remain else 0 end) as remain,sum(case when a.subMonth={param2} then a.debitTotalOcc else 0 end) as debitTotalOcc,sum(case when a.subMonth={param2} then a.creditTotalOcc else 0 end) as creditTotalOcc,sum(case when a.subMonth={param2} then a.balance else 0 end) as balance from {lockDbName}.fin_assitementryacc a inner join (SELECT t2.subjectId FROM {lockDbName}.fin_accpkgsubject t1 ,{lockDbName}.fin_accpkgsubject t2 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ='{lockYyyy}' AND t1.subjectId = '{param1}' AND t1.customerId = t2.customerId AND t1.yyyy = t2.yyyy AND t2.subjectFullId LIKE CONCAT(t1.subjectFullId,'/%') UNION SELECT t1.subjectId FROM {lockDbName}.fin_accpkgsubject t1 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ='{lockYyyy}' AND t1.subjectId = '{param1}') c on a.subjectId = c.subjectId WHERE a.customerId = '{lockCustomerId}' AND a.yyyy ='{lockYyyy}' and a.assItemId = '{param3}'
#\u66FF\u4EE3\u6D4B\u8BD5\u67E5\u8BE2\u5BA1\u8BA1\u65E5\u6B62\u589E\u52A0\u51CF\u5C11
FINDG000007=select a.assItemName,ifnull(sum(a.debitTotalOcc),0) as debitTotalOcc,ifnull(sum(a.creditTotalOcc),0) as creditTotalOcc from {lockDbName}.fin_assitementryacc a inner join (SELECT t2.subjectId FROM {lockDbName}.fin_accpkgsubject t1 ,{lockDbName}.fin_accpkgsubject t2 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ='{lockYyyy}' AND t1.subjectId = '{param1}' AND t1.customerId = t2.customerId AND t1.yyyy = t2.yyyy AND t2.subjectFullId LIKE CONCAT(t1.subjectFullId,'/%') UNION SELECT t1.subjectId FROM {lockDbName}.fin_accpkgsubject t1 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ='{lockYyyy}' AND t1.subjectId = '{param1}') c on a.subjectId = c.subjectId WHERE a.customerId = '{lockCustomerId}' AND a.yyyy >= {lockYyyy} and a.subMonth={param2} and a.assItemId = '{param3}'
#\u66FF\u4EE3\u6D4B\u8BD5\u67E5\u8BE2\u671F\u672B\u4F59\u989D\u6392\u540D
FINDG000008=select b.assItemId,b.balance from (select a.assItemName,a.assItemId,sum(a.balance) as balance from {lockDbName}.fin_assitementryacc a inner join (SELECT t2.subjectId FROM {lockDbName}.fin_accpkgsubject t1 ,{lockDbName}.fin_accpkgsubject t2 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ='{lockYyyy}' AND t1.subjectId = '{param1}' AND t1.customerId = t2.customerId AND t1.yyyy = t2.yyyy AND t2.subjectFullId LIKE CONCAT(t1.subjectFullId,'/%') UNION SELECT t1.subjectId FROM {lockDbName}.fin_accpkgsubject t1 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ='{lockYyyy}' AND t1.subjectId = '{param1}') c on a.subjectId = c.subjectId WHERE a.customerId = '{lockCustomerId}' AND a.yyyy ='{lockYyyy}' AND a.subMonth={param2} and a.isLeaf1 = 1 GROUP BY a.assItemId) b where 1=1 /*START #param3# and b.balance >= {param3} #param3# END*/ order by b.balance /*START #param5# desc #param5# END*/  /*START #param4# limit {param4} #param4# END*/
#\u66FF\u4EE3\u6D4B\u8BD5\u67E5\u8BE2\u671F\u672B\u4F59\u989D\u5360\u6BD4
FINDG000009=SELECT c.* FROM (select b.*,@total := @total + b.balance as total from (SELECT @total := 0) a,(select a.assItemName,a.assItemId,sum(a.balance) as balance from {lockDbName}.fin_assitementryacc a inner join (SELECT t2.subjectId FROM {lockDbName}.fin_accpkgsubject t1 ,{lockDbName}.fin_accpkgsubject t2 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ='{lockYyyy}' AND t1.subjectId = '{param1}' AND t1.customerId = t2.customerId AND t1.yyyy = t2.yyyy AND t2.subjectFullId LIKE CONCAT(t1.subjectFullId,'/%') UNION SELECT t1.subjectId FROM {lockDbName}.fin_accpkgsubject t1 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ='{lockYyyy}' AND t1.subjectId = '{param1}') c on a.subjectId = c.subjectId WHERE a.customerId = '{lockCustomerId}' AND a.yyyy ='{lockYyyy}' AND a.subMonth={param2} and a.isLeaf1 = 1 GROUP BY a.assItemId) b order by b.balance desc ) c where (c.total - c.balance < {param3} OR c.total = c.balance)
#\u66FF\u4EE3\u6D4B\u8BD5\u8BA1\u7B97\u7D2F\u52A0\u5230\u4F59\u989D\u7684\u6570\u636E
FINDG000010=select IF(min(IF(b.total >= {param5},rownum,null)) is null,max(rownum), min(IF(b.total >= {param5},rownum,null))) as rownum from (select b.*,@total := @total + b.occurValue as total,@rownum := @rownum + 1 as rownum from (SELECT @total := 0,@rownum := 0) a,(select t.autoId,t.vchDate,t.yyyy,SUM(t.occurValue) as occurValue from {lockDbName}.fin_subjectentry t inner join {lockDbName}.fin_assitementry d on t.autoId = d.subjectEntryId and d.assItemId = '{param11}' inner join (SELECT t2.subjectId FROM {lockDbName}.fin_accpkgsubject t1 ,{lockDbName}.fin_accpkgsubject t2 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ='{lockYyyy}' AND t1.subjectId = '{param1}' AND t1.customerId = t2.customerId AND t1.yyyy = t2.yyyy AND t2.subjectFullId LIKE CONCAT(t1.subjectFullId,'/%') UNION SELECT t1.subjectId FROM {lockDbName}.fin_accpkgsubject t1 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ='{lockYyyy}' AND t1.subjectId = '{param1}') c on t.subjectId = c.subjectId where t.customerId = {lockCustomerId} /*START #param2# and t.vchDate < '{param2}' #param2# END*/ /*START #param3# and t.vchDate >= '{param3}' #param3# END*/ and t.direction = {param4} group by t.autoId,t.vchDate,t.yyyy ) b ORDER BY b.vchDate /*START #param2# desc #param2# END*/,b.autoId /*START #param2# desc #param2# END*/) b 
#\u4F59\u989D\u660E\u7EC6\u8868 \u5171\u901A\u67E5\u8BE2
FINDG000011=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, a.remain, a.balance, SUM(IFNULL(a.creditOcc, 0)) AS creditOcc, SUM(IFNULL(a.debitOcc, 0)) AS debitOcc, SUM( IFNULL(a.creditOccNoTran, 0)) AS creditOccNoTran, SUM(IFNULL(a.debitOccNoTran, 0)) AS debitOccNoTran, a.hasAssItem FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, SUM(a.remain) AS remain, SUM(a.balance) AS balance, "" AS creditOcc, "" AS debitOcc, "" AS creditOccNoTran, "" AS debitOccNoTran, MAX(a.hasAssItem) AS hasAssItem FROM ( SELECT a.customerId, a.subjectId, a.subjectName AS subjectName, a.subjectFullName AS subjectFullName, CASE WHEN a.subMonth = 01 THEN a.remain END AS remain, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.hasAssItem FROM {lockDbName}.fin_accountall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ) a GROUP BY a.subjectId UNION SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, MAX(a.remain) AS remain, MAX(a.balance) AS balance, SUM(a.creditOcc) AS creditOcc, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOccNoTran) AS creditOccNoTran, SUM(a.debitOccNoTran) AS debitOccNoTran, a.hasAssItem FROM ( SELECT a.customerId, a.subjectId, a.subjectName AS subjectName, a.subjectFullName AS subjectFullName, CASE WHEN a.subMonth = 01 THEN a.remain END AS remain, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END END AS debitOcc, CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END END AS creditOcc, CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction END AS debitOccNoTran, CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction END AS creditOccNoTran, a.hasAssItem FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ) a GROUP BY a.subjectId ) a GROUP BY a.subjectId
FINDG000012=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, a.assItemId, a.assItemName, a.yyyy, a.remain, a.balance, SUM(IFNULL(a.debitOcc, 0)) AS debitOcc, SUM(IFNULL(a.creditOcc, 0)) AS creditOcc, SUM(IFNULL(a.debitOccNoTran, 0)) AS debitOccNoTran, SUM( IFNULL(a.creditOccNoTran, 0)) AS creditOccNoTran FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, a.assItemId, a.assItemName, a.yyyy, SUM(a.remain) AS remain, SUM(a.balance) AS balance, "" AS debitOcc, "" AS creditOcc, "" AS debitOccNoTran, "" AS creditOccNoTran FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, a.assItemId, a.assItemName, a.yyyy, CASE WHEN a.subMonth = 01 THEN a.remain END AS remain, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance FROM {lockDbName}.fin_assitementryaccall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId IN ({param4}) AND a.subMonth <= {param5} ) a GROUP BY a.customerId, a.subjectId, a.assItemId UNION SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, a.assItemId, a.assItemName, a.yyyy, SUM(a.remain) AS remain, SUM(a.balance) AS balance, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.debitOccNoTran) AS debitOccNoTran, SUM(a.creditOccNoTran) AS creditOccNoTran FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, a.assItemId, a.assItemName, a.yyyy, CASE WHEN a.subMonth = 01 THEN a.remain END AS remain, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END END AS debitOcc, CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END END AS creditOcc, CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction END AS debitOccNoTran, CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction END AS creditOccNoTran FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId IN ({param4}) AND a.subMonth <= {param5} ) a GROUP BY a.customerId, a.subjectId, a.assItemId ) a GROUP BY a.customerId, a.subjectId, a.assItemId
#1001-0100-\u5E93\u5B58\u73B0\u91D1\u660E\u7EC6\u4F59\u989D\u8868
FINDG100101=SELECT a.customerId, a.subjectId, CASE WHEN a.level1 <> 1 THEN a.subjectName ELSE a.dataName END AS dataName, a.subjectFullName, a.debitOcc, SUM(a.debitOccF) AS debitOccF, a.level1, a.isLeaf1, "" AS assItemId, "" AS assItemName FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, a.balance AS debitOcc, "" AS debitOccF, a.level1, a.isLeaf1 FROM {lockDbName}.fin_accountall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth = {param6} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 UNION SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, a.balance AS debitOcc, a.balance AS debitOccF, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth = {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
#1001-0300-\u5E93\u5B58\u73B0\u91D1\u53D1\u751F\u989D\u5206\u6790\u67E5\u9A8C
FINDG100102=SELECT * FROM (( SELECT t.subjectId, t.subjectName AS dataName, t.remain AS remain, t.remain AS remainF, t.balance AS balance, t.balance AS balanceF FROM {lockDbName}.fin_account t WHERE t.customerId ={param1} AND t.subjectId LIKE '{param2}%' AND t.yyyy ={param3} AND t.subMonth ={param4} AND t.isLeaf1 = '1' AND t.subjectName = '\u4EBA\u6C11\u5E01' ) UNION ALL ( SELECT t.subjectId, t.subjectName AS dataName, t.remain AS remain, t.remainF AS remainF, t.balance AS balance, t.balanceF AS balanceF FROM {lockDbName}.fin_accountall t WHERE t.customerId ={param1} AND t.subjectId LIKE '{param2}%' AND t.yyyy ={param3} AND t.subMonth ={param4} AND t.isLeaf1 = '1' ORDER BY t.subjectName )) temp
FINDG100103=SELECT * FROM (( SELECT t.subjectName AS dataName, sum(t.direction * t.debitOcc) AS debitOcc, sum(t.direction * t.creditOcc) AS creditOcc FROM {lockDbName}.fin_account t WHERE t.customerId ={param1} AND t.subjectId LIKE '{param2}%' AND t.yyyy ={param3} AND t.subMonth BETWEEN {param4} AND {param5} AND t.isLeaf1 = '1' AND t.subjectName = '\u4EBA\u6C11\u5E01' ) UNION ALL ( SELECT t.subjectName AS currency, sum(t.direction * t.debitOccF) AS debitOcc, sum(t.direction * t.creditOccF) AS creditOcc FROM {lockDbName}.fin_accountall t WHERE t.customerId ={param1} AND t.subjectId LIKE '{param2}%' AND t.yyyy ={param3} AND t.subMonth BETWEEN {param4} AND {param5} AND t.isLeaf1 = '1' GROUP BY t.subjectName ORDER BY t.subjectName )) temp
FINDG100105=SELECT t.subjectId, sum( CASE WHEN t.direction = 1 THEN 1 ELSE 0 END ) AS debit, sum( CASE WHEN t.direction = -1 THEN 1 ELSE 0 END ) AS credit FROM {lockDbName}.fin_subjectentry t WHERE t.customerId ={param1} AND t.subjectId = {param2} AND t.yyyy ={param3} AND t.month BETWEEN {param4} AND {param5}
#1002-0100-\u94F6\u884C\u5B58\u6B3E\u660E\u7EC6\u4F59\u989D\u8868
FINDG100201=SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName, a.assItemId, a.assItemName, SUM(a.debitOcc) AS debitOcc, a.debitRate, a.debitOccF, a.hasAssItem, a.dataName FROM ( SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName, "" AS assItemId, "" AS assItemName, CASE WHEN a.balance = "" THEN SUM(a.balanceF) ELSE a.balance END AS debitOcc, CASE WHEN a.balance = "" THEN 1 WHEN a.balance = 0 THEN 0 ELSE SUM(a.balanceF) / a.balance END AS debitRate, SUM(a.balanceF) AS debitOccF, MAX(a.hasAssItem) AS hasAssItem, a.dataName FROM (( SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName, SUM(a.balance) AS balance, "" AS balanceF, a.hasAssItem, a.dataName FROM ( SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, "" balanceF, a.hasAssItem, a.currency AS dataName FROM {lockDbName}.fin_accountall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ) a GROUP BY a.customerId, a.yyyy, a.subjectId ) UNION ( SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName, a.balance, SUM(a.balanceF) AS balanceF, a.hasAssItem, a.dataName FROM ( SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName, "" AS balance, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balanceF, a.hasAssItem, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ) a GROUP BY a.customerId, a.yyyy, a.subjectId )) a GROUP BY a.customerId, a.yyyy, a.subjectId ORDER BY a.subjectId) a GROUP BY a.customerId, a.yyyy, a.subjectId, a.assItemId
FINDG100202=SELECT a.customerId, a.yyyy, a.subjectId, b.subjectName AS subjectName, a.assItemId, a.assItemName, a.debitOcc, a.debitRate, a.debitOccF, a.dataName FROM ( SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName, a.assItemId, a.assItemName, CASE WHEN a.balance = "" THEN SUM(a.balanceF) ELSE a.balance END AS debitOcc, CASE WHEN a.balance = "" THEN 1 WHEN a.balance = 0 THEN 0 ELSE SUM(a.balanceF) / a.balance END AS debitRate, SUM(a.balanceF) AS debitOccF, a.dataName FROM (( SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName, a.assItemId, a.assItemName, SUM(a.balance) AS balance, "" AS balanceF, a.dataName FROM ( SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName, a.assItemId, a.assItemName, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, "" AS balanceF, a.currency AS dataName FROM {lockDbName}.fin_assitementryaccall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId IN ({param4}) AND a.subMonth <= {param5} ) a GROUP BY a.customerId, a.yyyy, a.subjectId, a.assItemId ) UNION ( SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName, a.assItemId, a.assItemName, a.balance, SUM(a.balanceF) AS balanceF, a.dataName FROM ( SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName, a.assItemId, a.assItemName, a.balance, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balanceF, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId IN ({param4}) AND a.subMonth <= {param5} ) a GROUP BY a.customerId, a.yyyy, a.subjectId, a.assItemId )) a GROUP BY a.customerId, a.yyyy, a.subjectId, a.assItemId ORDER BY a.subjectId, a.assItemId ) a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON a.customerId = b.customerId AND a.yyyy = b.yyyy AND a.subjectId = b.subjectId
FINDG100203=SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName, a.assItemId, a.assItemName, SUM(a.debitOcc) AS debitOcc, SUM(a.debitRate) AS debitRate, SUM(a.debitOccF) AS debitOccF, a.dataName FROM ( SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName, "" AS assItemId, "" AS assItemName, CASE WHEN a.balance = "" THEN SUM(a.balanceF) ELSE a.balance END AS debitOcc, CASE WHEN a.balance = "" THEN 1 WHEN a.balance = 0 THEN 0 ELSE SUM(a.balanceF) / a.balance END AS debitRate, SUM(a.balanceF) AS debitOccF, a.dataName FROM (( SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName, SUM(a.balance) AS balance, "" AS balanceF, a.dataName FROM ( SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, "" AS balanceF, a.currency AS dataName FROM {lockDbName}.fin_accountall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ) a GROUP BY a.customerId, a.yyyy, a.subjectId ) UNION ( SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName, a.balance, SUM(a.balanceF) AS balanceF, a.dataName FROM ( SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName, "" AS balance, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balanceF, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ) a GROUP BY a.customerId, a.yyyy, a.subjectId )) a GROUP BY a.customerId, a.yyyy, a.subjectId ORDER BY a.subjectId ) a GROUP BY a.customerId, a.yyyy, a.subjectId
FINDG100205=SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName, a.assItemId, a.assItemName, a.debitOcc, SUM(a.debitOccF) AS debitOccF, a.dataName FROM ( SELECT a.customerId, a.yyyy, "" AS subjectId, "" AS subjectName, a.assItemId, a.assItemName, SUM(a.balance) AS debitOcc, "" AS debitOccF, a.currency AS dataName FROM {lockDbName}.fin_assitementryaccall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subMonth = {param5} AND a.assItemId LIKE '{param3}%' GROUP BY a.assItemId UNION SELECT a.customerId, a.yyyy, "" AS subjectId, "" AS subjectName, a.assItemId, a.assItemName, SUM(a.balance) AS debitOcc, SUM(a.balance) AS debitOccF, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subMonth = {param5} AND a.assItemId LIKE '{param3}%' GROUP BY a.assItemId ) a GROUP BY a.customerId, a.yyyy, a.subjectId
#1002-0400-\u94F6\u884C\u5B58\u6B3E\u672C\u671F\u53D1\u751F\u989D\u5206\u6790
FINDG100204=SELECT a.*, IFNULL(b.debit, 0) AS debitNum, IFNULL(c.credit, 0) AS creditNum FROM ( SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName, a.direction, a.currency, CASE WHEN a.remain = "" THEN 0.00 ELSE a.remain END AS remain, SUM(a.remainF) AS remainF, a.debitOcc, SUM(a.debitOccF) AS debitOccF, a.creditOcc, SUM(a.creditOccF) AS creditOccF, CASE WHEN a.balance = "" THEN 0.00 ELSE a.balance END AS balance, SUM(a.balanceF) AS balanceF, a.fullName, a.level1, a.isLeaf1, MAX(a.hasAssItem ) AS hasAssItem FROM (( SELECT aa.customerId, aa.yyyy, aa.subjectId, aa.subjectName, IF (aa.direction < 0, '\u8D37', '\u501F') AS direction, aa.currency, SUM(aa.remain) AS remain, SUM(aa.remainF) AS remainF, SUM(aa.debitOcc) AS debitOcc, SUM(aa.debitOccF) AS debitOccF, SUM(aa.creditOcc) AS creditOcc, SUM(aa.creditOccF) AS creditOccF, SUM(aa.balance) AS balance, SUM(aa.balanceF) AS balanceF, aa.fullName, aa.level1, aa.isLeaf1, aa.hasAssItem FROM ( SELECT a.customerId, a.yyyy, a.subMonth, a.subjectId, a.subjectName AS subjectName, CASE WHEN a.subMonth = 01 THEN a.remain END AS remain, "" AS remainF, CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN a.debitOcc END AS debitOcc, "" AS debitOccF, CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN a.creditOcc END AS creditOcc, "" AS creditOccF, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, "" AS balanceF, a.direction, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', a.currency ) AS currency, a.subjectFullName AS fullName, a.level1 AS level1, a.isLeaf1 AS isLeaf1, a.hasAssItem FROM {lockDbName}.fin_accountall a ) aa WHERE aa.customerId = {param1} AND aa.yyyy = {param2} AND aa.isLeaf1 = 1 AND aa.subjectId LIKE '{param4}%' GROUP BY aa.customerId, aa.yyyy, aa.subjectId, aa.currency ORDER BY aa.customerId, aa.yyyy, aa.subjectId, aa.currency ) UNION ( SELECT aa.customerId, aa.yyyy, aa.subjectId, aa.subjectName, IF (aa.direction < 0, '\u8D37', '\u501F') AS direction, aa.currency, SUM(aa.remainF) AS remain, SUM(aa.remainF) AS remainF, SUM(aa.debitOcc) AS debitOcc, SUM(aa.debitOccF) AS debitOccF, SUM(aa.creditOcc) AS creditOcc, SUM(aa.creditOccF) AS creditOccF, SUM(aa.balance) AS balance, SUM(aa.balanceF) AS balanceF, aa.fullName, aa.level1, aa.isLeaf1, aa.hasAssItem FROM ( SELECT a.customerId, a.yyyy, a.subMonth, a.subjectId, a.subjectName AS subjectName, "" AS remain, CASE WHEN a.subMonth = 01 THEN a.remain END AS remainF, "" AS debitOcc, CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN a.debitOcc END AS debitOccF, "" AS creditOcc, CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN a.creditOcc END AS creditOccF, "" AS balance, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balanceF, a.direction, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', a.currency ) AS currency, a.subjectFullName AS fullName, a.level1 AS level1, a.isLeaf1 AS isLeaf1, a.hasAssItem FROM {lockDbName}.fin_account a ) aa WHERE aa.customerId = {param1} AND aa.yyyy = {param2} AND aa.isLeaf1 = 1 AND aa.subjectId LIKE '{param4}%' GROUP BY aa.customerId, aa.yyyy, aa.subjectId, aa.currency ORDER BY aa.customerId, aa.yyyy, aa.subjectId, aa.currency )) a GROUP BY a.customerId, a.yyyy, a.subjectId ORDER BY a.subjectId ASC, a.currency DESC ) a LEFT JOIN ( SELECT a.subjectId, COUNT(a.direction) AS debit FROM {lockDbName}.fin_subjectentry a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a. MONTH BETWEEN 1 AND {param5} AND a.direction = 1 AND a.subjectId LIKE '{param4}%' GROUP BY a.subjectId ) b ON a.subjectId = b.subjectId LEFT JOIN ( SELECT a.subjectId, COUNT(a.direction) AS credit FROM {lockDbName}.fin_subjectentry a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a. MONTH BETWEEN 1 AND {param5} AND a.direction = -1 AND a.subjectId LIKE '{param4}%' GROUP BY a.subjectId ) c ON a.subjectId = c.subjectId
FINDG100206=SELECT a.*, IFNULL(b.debit, 0) AS debitNum, IFNULL(c.credit, 0) AS creditNum FROM ( SELECT a.customerId, a.yyyy, a.subjectId, a.assItemName AS subjectName, a.assItemId, a.assItemName, a.direction, a.currency, CASE WHEN a.remain = "" THEN 0.00 ELSE a.remain END AS remain, SUM(a.remainF) AS remainF, a.debitOcc, SUM(a.debitOccF) AS debitOccF, a.creditOcc, SUM(a.creditOccF) AS creditOccF, CASE WHEN a.balance = "" THEN 0.00 ELSE a.balance END AS balance, SUM(a.balanceF) AS balanceF, a.subjectFullName FROM (( SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName, a.assItemId, a.assItemName, IF (a.direction < 0, '\u8D37', '\u501F') AS direction, a.currency, SUM(a.remain) AS remain, SUM(a.remainF) AS remainF, SUM(a.debitOcc) AS debitOcc, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOcc) AS creditOcc, SUM(a.creditOccF) AS creditOccF, SUM(a.balance) AS balance, SUM(a.balanceF) AS balanceF, a.subjectFullName FROM ( SELECT a.customerId, a.yyyy, a.subMonth, a.subjectId, a.subjectName, a.assItemId, a.assItemName, CASE WHEN a.subMonth = 01 THEN a.remain END AS remain, "" AS remainF, CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN a.debitOcc END AS debitOcc, "" AS debitOccF, CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN a.creditOcc END AS creditOcc, "" AS creditOccF, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, "" AS balanceF, a.direction, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', a.currency ) AS currency, a.subjectFullName FROM {lockDbName}.fin_assitementryaccall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId IN ({param4})) a GROUP BY a.customerId, a.yyyy, a.subjectId, a.assItemId ) UNION ( SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName, a.assItemId, a.assItemName, IF (a.direction < 0, '\u8D37', '\u501F') AS direction, a.currency, SUM(a.remainF) AS remain, SUM(a.remainF) AS remainF, SUM(a.debitOcc) AS debitOcc, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOcc) AS creditOcc, SUM(a.creditOccF) AS creditOccF, SUM(a.balance) AS balance, SUM(a.balanceF) AS balanceF, a.subjectFullName FROM ( SELECT a.customerId, a.yyyy, a.subMonth, a.subjectId, a.subjectName, a.assItemId, a.assItemName, "" AS remain, CASE WHEN a.subMonth = 01 THEN a.remain END AS remainF, "" AS debitOcc, CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN a.debitOcc END AS debitOccF, "" AS creditOcc, CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN a.creditOcc END AS creditOccF, "" AS balance, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balanceF, a.direction, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', a.currency ) AS currency, a.subjectFullName FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId IN ({param4})) a GROUP BY a.customerId, a.yyyy, a.subjectId, a.assItemId )) a GROUP BY a.customerId, a.yyyy, a.subjectId, a.assItemId ORDER BY a.subjectId ASC, a.assItemId ASC ) a LEFT JOIN ( SELECT a.subjectId, a.assItemId, COUNT(a.direction) AS debit FROM {lockDbName}.fin_assitementry a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND RIGHT (LEFT(a.vchDate, 7), 2) <= {param5} AND a.direction = 1 AND a.subjectId IN ({param4}) GROUP BY a.subjectId, a.assItemId ) b ON a.subjectId = b.subjectId AND a.assItemId = b.assItemId LEFT JOIN ( SELECT a.subjectId, a.assItemId, COUNT(a.direction) AS credit FROM {lockDbName}.fin_assitementry a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND RIGHT (LEFT(a.vchDate, 7), 2) <= {param5} AND a.direction = -1 AND a.subjectId IN ({param4}) GROUP BY a.subjectId, a.assItemId ) c ON a.subjectId = c.subjectId AND a.assItemId = c.assItemId
#1003-0100-\u5176\u4ED6\u8D27\u5E01\u8D44\u91D1\u660E\u7EC6\u4F59\u989D\u8868
FINDG100301=SELECT a.subjectId,a.accName,a.subjectName,"" AS assItemId,"" AS assItemName,a.currency,a.debitOcc,SUM(a.debitOccF) AS debitOccF FROM (SELECT a.subjectId,a.subjectFullName AS accName,a.subjectName,a.currency,a.balance AS debitOcc,"" AS debitOccF FROM {lockDbName}.fin_accountall a WHERE a.customerId={param1} AND a.yyyy={param2} AND a.subMonth={param6} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1=1 UNION SELECT a.subjectId,a.subjectFullName AS accName,a.subjectName,IF (a.currency='0','\u4EBA\u6C11\u5E01',CONCAT('\u5916\u5E01:',a.currency)) AS currency,a.balance AS debitOcc,a.balance AS debitOccF FROM {lockDbName}.fin_account a WHERE a.customerId={param1} AND a.yyyy={param2} AND a.subMonth={param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1=1) a GROUP BY a.accName
#1101-0100-\u4EA4\u6613\u6027\u91D1\u878D\u8D44\u4EA7\u660E\u7EC6\u8868
FINDG110101=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, a.dataName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
#1121-0100-\u5E94\u6536\u7968\u636E\u660E\u7EC6\u8868
FINDG112101=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, a.dataName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
#1122-0100-\u5E94\u6536\u8D26\u6B3E\u660E\u7EC6\u8868
FINDG112201=SELECT a.customerId, a.subjectId, a.subjectName, "" AS assItemId, "" AS assItemName, IF (a.direction < 0, '\u8D37', '\u501F') AS direction, a.currency, a.remain, SUM(a.remainF) AS remainF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.balance, SUM(a.balanceF) AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, MAX(a.hasAssItem) AS hasAssItem, 0 AS afterAmount FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.direction, a.currency, SUM(a.remain) AS remain, "" AS remainF, "" AS debitOccF, "" AS creditOccF, SUM(a.balance) AS balance, "" AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM ( SELECT a.customerId, a.subMonth, a.subjectId, a.subjectName, a.direction, a.currency, CASE WHEN a.subMonth = 01 THEN a.remain END AS remain, "" AS remainF, "" AS debitOccF, "" AS creditOccF, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, "" AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM {lockDbName}.fin_accountall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ORDER BY a.subjectId ) a GROUP BY a.customerId, a.subjectId UNION SELECT a.customerId, a.subjectId, a.subjectName, a.direction, a.currency, SUM(a.remain) AS remain, SUM(a.remain) AS remainF, SUM(a.debitOcc) AS debitOccF, SUM(a.creditOcc) AS creditOccF, SUM(a.balance) AS balance, SUM(a.balance) AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM ( SELECT a.customerId, a.subMonth, a.subjectId, a.subjectName, a.direction, CASE WHEN a.currency = 0 THEN '\u4EBA\u6C11\u5E01' ELSE a.currency END AS currency, CASE WHEN a.subMonth = 01 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ORDER BY a.subjectId ) a GROUP BY a.customerId, a.subjectId ) a GROUP BY a.customerId, a.subjectId
FINDG112202=SELECT a.customerId, a.subjectId, b.subjectName, a.yyyy, a.assItemId, a.assItemName, a.direction, a.remain, a.remainF, a.balance, a.balanceF, a.debitOccF, a.creditOccF, a.currency, a.afterAmount FROM ( SELECT a.*, IFNULL(b.occurValue, 0) AS afterAmount FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, SUM(a.remain) AS remain, SUM(a.remainF) AS remainF, SUM(a.balance) AS balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, SUM(a.remain) AS remain, SUM(a.remainF) AS remainF, SUM(a.balance) AS balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, SUM(a.remain) AS remain, "" AS remainF, SUM(a.balance) AS balance, "" AS balanceF, "" AS debitOccF, "" AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.subMonth, a.assItemId, a.assItemName, a.direction, CASE WHEN a.subMonth = 01 THEN a.remain END remain, "" AS remainF, CASE WHEN a.subMonth = {param5} THEN a.balance END balance, "" AS balanceF, "" AS debitOccF, "" AS creditOccF, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', CONCAT('\u5916\u5E01:', a.currency)) AS currency FROM {lockDbName}.fin_assitementryaccall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId IN ({param4}) AND a.subMonth <= {param5} ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId UNION SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, SUM(a.remain) AS remain, SUM(a.remainF) AS remainF, SUM(a.balance) AS balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOcc) AS debitOccF, SUM(a.creditOcc) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.subMonth, a.assItemId, a.assItemName, a.direction, CASE WHEN a.subMonth = 01 THEN a.remain END remain, CASE WHEN a.subMonth = 01 THEN a.remain END remainF, CASE WHEN a.subMonth = {param5} THEN a.balance END balance, CASE WHEN a.subMonth = {param5} THEN a.balance END balanceF, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', CONCAT('\u5916\u5E01:', a.currency)) AS currency FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId IN ({param4}) AND a.subMonth <= {param5} ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId ) a LEFT JOIN ( SELECT a.customerId, a.subjectId, a.assItemId, SUM(a.occurValue) AS occurValue FROM ( SELECT a.customerId, a.yyyy, a.subjectId, a.assItemId, b.voucherId, c.occurValue FROM ( SELECT a.customerId, a.yyyy, a.subjectId, a.assItemId FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId = {param1} AND a.isLeaf1 = 1 AND a.subjectId IN ({param4}) AND (( a.subMonth > {param5} AND a.yyyy = {param2} ) OR (a.yyyy > {param2})) GROUP BY a.customerId, a.subjectId, a.assItemId, a.yyyy ) a, ( SELECT a.* FROM {lockDbName}.fin_assitementry a WHERE a.customerId = {param1} AND (( RIGHT (LEFT(a.vchDate, 7), 2) > {param5} AND a.yyyy = {param2} ) OR (a.yyyy > {param2})) AND a.subjectId IN ({param4})) b, ( SELECT a.* FROM ( SELECT a.customerId, a.yyyy, a.subjectId, a.voucherId, a.oldVoucherId, a.vchDate, a.serail, CASE WHEN GROUP_CONCAT( DISTINCT a.oppositeAccountTop ) LIKE '%\u5E93\u5B58\u73B0\u91D1%' THEN 1 WHEN GROUP_CONCAT( DISTINCT a.oppositeAccountTop ) LIKE '%\u94F6\u884C\u5B58\u6B3E%' THEN 1 WHEN GROUP_CONCAT( DISTINCT a.oppositeAccountTop ) LIKE '%\u5176\u4ED6\u8D27\u5E01\u8D44\u91D1%' THEN 1 ELSE 0 END AS isTrue, a.occurValue FROM {lockDbName}.fin_subjectentry a WHERE a.customerId = {param1} AND (( a. MONTH > {param5} AND a.yyyy = {param2} ) OR (a.yyyy > {param2})) AND a.direction = -1 AND a.subjectId IN ({param4}) GROUP BY a.customerId, a.yyyy, a.subjectId, a.voucherId, a.serail ) a WHERE a.isTrue = 1 ) c WHERE a.customerId = {param1} AND a.customerId = b.customerId AND a.yyyy = b.yyyy AND a.subjectId = b.subjectId AND a.assItemId = b.assItemId AND b.customerId = c.customerId AND b.yyyy = c.yyyy AND b.subjectId = c.subjectId AND b.voucherId = c.voucherId AND b.oldvoucherId = c.oldVoucherId AND b.vchDate = c.vchDate AND b.serail = c.serail AND c.isTrue = 1 ) a GROUP BY a.customerId, a.subjectId, a.assItemId ) b ON a.customerId = b.customerId AND a.subjectId = b.subjectId AND a.assItemId = b.assItemId ) a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.subjectId = a.subjectId
FINDG112203=SELECT a.*, IFNULL(b.occurValue, 0) AS afterAmount FROM ( SELECT a.customerId, a.yyyy, a.assItemId AS subjectId, a.assItemName AS subjectName, a.direction, SUM(a.remain) AS remain, SUM(a.remainF) AS remainF, SUM(a.balance) AS balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, SUM(a.remain) AS remain, SUM(a.remainF) AS remainF, SUM(a.balance) AS balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, a.remain, SUM(a.remainF) AS remainF, a.balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, SUM(a.remain) AS remain, "" AS remainF, SUM(a.balance) AS balance, "" AS balanceF, "" AS debitOccF, "" AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.subMonth, a.assItemId, a.assItemName, a.direction, CASE WHEN a.subMonth = 01 THEN a.remain END remain, "" AS remainF, CASE WHEN a.subMonth = {param5} THEN a.balance END balance, "" AS balanceF, "" AS debitOccF, "" AS creditOccF, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', CONCAT('\u5916\u5E01:', a.currency)) AS currency FROM {lockDbName}.fin_assitementryaccall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId IN ({param4}) AND a.subMonth <= {param5} ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId UNION SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, SUM(a.remain) AS remain, SUM(a.remainF) AS remainF, SUM(a.balance) AS balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOcc) AS debitOccF, SUM(a.creditOcc) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.subMonth, a.assItemId, a.assItemName, a.direction, CASE WHEN a.subMonth = 01 THEN a.remain END remain, CASE WHEN a.subMonth = 01 THEN a.remain END remainF, CASE WHEN a.subMonth = {param5} THEN a.balance END balance, CASE WHEN a.subMonth = {param5} THEN a.balance END balanceF, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', CONCAT('\u5916\u5E01:', a.currency)) AS currency FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId IN ({param4}) AND a.subMonth <= {param5} ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId ) a GROUP BY a.customerId, a.assItemId ) a LEFT JOIN ( SELECT a.customerId, a.subjectId, a.assItemId, SUM(a.occurValue) AS occurValue FROM ( SELECT a.customerId, a.yyyy, a.subjectId, a.assItemId, b.voucherId, c.occurValue FROM ( SELECT a.customerId, a.yyyy, a.subjectId, a.assItemId FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId = {param1} AND a.isLeaf1 = 1 AND a.subjectId IN ({param4}) AND (( a.subMonth > {param5} AND a.yyyy = {param2} ) OR (a.yyyy > {param2})) GROUP BY a.customerId, a.subjectId, a.assItemId, a.yyyy ) a, ( SELECT a.* FROM {lockDbName}.fin_assitementry a WHERE a.customerId = {param1} AND (( RIGHT (LEFT(a.vchDate, 7), 2) > {param5} AND a.yyyy = {param2} ) OR (a.yyyy > {param2})) AND a.subjectId IN ({param4})) b, ( SELECT a.* FROM ( SELECT a.customerId, a.yyyy, a.subjectId, a.voucherId, a.oldVoucherId, a.vchDate, a.serail, CASE WHEN GROUP_CONCAT( DISTINCT a.oppositeAccountTop ) LIKE '%\u5E93\u5B58\u73B0\u91D1%' THEN 1 WHEN GROUP_CONCAT( DISTINCT a.oppositeAccountTop ) LIKE '%\u94F6\u884C\u5B58\u6B3E%' THEN 1 WHEN GROUP_CONCAT( DISTINCT a.oppositeAccountTop ) LIKE '%\u5176\u4ED6\u8D27\u5E01\u8D44\u91D1%' THEN 1 ELSE 0 END AS isTrue, a.occurValue FROM {lockDbName}.fin_subjectentry a WHERE a.customerId = {param1} AND (( a. MONTH > {param5} AND a.yyyy = {param2} ) OR (a.yyyy > {param2})) AND a.direction = -1 AND a.subjectId IN ({param4}) GROUP BY a.customerId, a.yyyy, a.subjectId, a.voucherId, a.serail ) a WHERE a.isTrue = 1 ) c WHERE a.customerId = {param1} AND a.customerId = b.customerId AND a.yyyy = b.yyyy AND a.subjectId = b.subjectId AND a.assItemId = b.assItemId AND b.customerId = c.customerId AND b.yyyy = c.yyyy AND b.subjectId = c.subjectId AND b.voucherId = c.voucherId AND b.oldvoucherId = c.oldVoucherId AND b.vchDate = c.vchDate AND b.serail = c.serail AND c.isTrue = 1 ) a GROUP BY a.customerId, a.subjectId, a.assItemId ) b ON a.customerId = b.customerId AND a.subjectId = b.assItemId
FINDG112204=SELECT a.customerId, a.subjectId, CONCAT('\u5C0F\u8BA1\uFF1A', a.subjectName) AS subjectName, "" AS assItemId, "" AS assItemName, IF (a.direction < 0, '\u8D37', '\u501F') AS direction, a.currency, a.remain, SUM(a.remainF) AS remainF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.balance, SUM(a.balanceF) AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, MAX(a.hasAssItem) AS hasAssItem, 0 AS afterAmount FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.direction, a.currency, SUM(a.remain) AS remain, "" AS remainF, "" AS debitOccF, "" AS creditOccF, SUM(a.balance) AS balance, "" AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM ( SELECT a.customerId, a.subMonth, a.subjectId, a.subjectName, a.direction, a.currency, CASE WHEN a.subMonth = 01 THEN a.remain END AS remain, "" AS remainF, "" AS debitOccF, "" AS creditOccF, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, "" AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM {lockDbName}.fin_accountall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND ( a.level1 = 2 OR (a.isLeaf1 = 1 AND a.level1 = 1)) AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ORDER BY a.subjectId ) a GROUP BY a.customerId, a.subjectId UNION SELECT a.customerId, a.subjectId, a.subjectName, a.direction, a.currency, SUM(a.remain) AS remain, SUM(a.remain) AS remainF, SUM(a.debitOcc) AS debitOccF, SUM(a.creditOcc) AS creditOccF, SUM(a.balance) AS balance, SUM(a.balance) AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM ( SELECT a.customerId, a.subMonth, a.subjectId, a.subjectName, a.direction, CASE WHEN a.currency = 0 THEN '\u4EBA\u6C11\u5E01' ELSE a.currency END AS currency, CASE WHEN a.subMonth = 01 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND ( a.level1 = 2 OR (a.isLeaf1 = 1 AND a.level1 = 1)) AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ORDER BY a.subjectId ) a GROUP BY a.customerId, a.subjectId ) a GROUP BY a.customerId, a.subjectId
#1122-0150-\u5E94\u6536\u8D26\u6B3E\u660E\u7EC6\u8868(\u5BA1\u5B9A)
FINDG112215=SELECT a.customerId, a.yyyy, a.subjectId, a.assItemId, a.assItemName AS subjectName, a.fullName, a.direction, a.currency, a.debitRemain, a.creditRemain, a.debitOcc, a.debitOccF, a.creditOcc, a.creditOccF, a.debitBalance, a.creditBalance, a.balance, a.balanceF, a.direction, a.level1, a.isLeaf1 FROM (( SELECT aa.customerId, aa.yyyy, aa.subjectId, aa.assItemId, aa.assItemName, aa.fullName, IF (aa.direction < 0, '\u8D37', '\u501F') AS direction, aa.currency, MAX(aa.debitRemain) AS debitRemain, MAX(aa.creditRemain) AS creditRemain, SUM(aa.debitOcc) AS debitOcc, SUM(aa.debitOccF) AS debitOccF, SUM(aa.creditOcc) AS creditOcc, SUM(aa.creditOccF) AS creditOccF, MAX(aa.debitBalance) AS debitBalance, MAX(aa.creditBalance) AS creditBalance, SUM(aa.balance) AS balance, SUM(aa.balanceF) AS balanceF, aa.level1, aa.isLeaf1 FROM ( SELECT a.customerId, a.yyyy, a.subjectId AS subjectId, a.assItemId, a.assItemName, a.assTotalName AS fullName, "" AS remain, CASE WHEN a.subMonth = 01 THEN a.debitRemain END AS debitRemain, CASE WHEN a.subMonth = 01 THEN a.creditRemain END AS creditRemain, "" AS debitOcc, CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END END AS debitOccF, "" AS creditOcc, CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END END AS creditOccF, CASE WHEN a.subMonth = {param5} THEN a.debitBalance END AS debitBalance, CASE WHEN a.subMonth = {param5} THEN a.creditBalance END AS creditBalance, "" AS balance, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balanceF, a.direction, IF ( a.currency = '0', "", CONCAT('\u5916\u5E01:', a.currency)) AS currency, a.level1 AS level1, a.isLeaf1 AS isLeaf1 FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectId LIKE '{param4}%' ) aa GROUP BY aa.customerId, aa.yyyy, aa.subjectId, aa.currency, aa.assitemId ORDER BY aa.customerId, aa.yyyy, aa.subjectId )) a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ORDER BY a.subjectId, a.assItemId, a.currency DESC
#1123-0100-\u9884\u4ED8\u8D26\u6B3E\u660E\u7EC6\u8868
FINDG112301=SELECT a.customerId, a.subjectId, a.subjectName, "" AS assItemId, "" AS assItemName, IF (a.direction < 0, '\u8D37', '\u501F') AS direction, a.currency, a.remain, SUM(a.remainF) AS remainF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.balance, SUM(a.balanceF) AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem, 0 AS afterAmount FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.direction, a.currency, SUM(a.remain) AS remain, "" AS remainF, "" AS debitOccF, "" AS creditOccF, SUM(a.balance) AS balance, "" AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM ( SELECT a.customerId, a.subMonth, a.subjectId, a.subjectName, a.direction, a.currency, CASE WHEN a.subMonth = 01 THEN a.remain END AS remain, "" AS remainF, "" AS debitOccF, "" AS creditOccF, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, "" AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM {lockDbName}.fin_accountall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ORDER BY a.subjectId ) a GROUP BY a.customerId, a.subjectId UNION SELECT a.customerId, a.subjectId, a.subjectName, a.direction, a.currency, SUM(a.remain) AS remain, SUM(a.remain) AS remainF, SUM(a.debitOcc) AS debitOccF, SUM(a.creditOcc) AS creditOccF, SUM(a.balance) AS balance, SUM(a.balance) AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM ( SELECT a.customerId, a.subMonth, a.subjectId, a.subjectName, a.direction, CASE WHEN a.currency = 0 THEN '\u4EBA\u6C11\u5E01' ELSE a.currency END AS currency, CASE WHEN a.subMonth = 01 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ORDER BY a.subjectId ) a GROUP BY a.customerId, a.subjectId ) a GROUP BY a.customerId, a.subjectId
FINDG112302=SELECT a.customerId, a.subjectId, b.subjectName, a.yyyy, a.assItemId, a.assItemName, a.direction, a.remain, a.remainF, a.balance, a.balanceF, a.debitOccF, a.creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, SUM(a.remain) AS remain, SUM(a.remainF) AS remainF, SUM(a.balance) AS balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, a.remain, SUM(a.remainF) AS remainF, a.balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, SUM(a.remain) AS remain, "" AS remainF, SUM(a.balance) AS balance, "" AS balanceF, "" AS debitOccF, "" AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.subMonth, a.assItemId, a.assItemName, a.direction, CASE WHEN a.subMonth = 01 THEN a.remain END AS remain, "" AS remainF, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, "" AS balanceF, "" AS debitOccF, "" AS creditOccF, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', CONCAT('\u5916\u5E01:', a.currency)) AS currency FROM {lockDbName}.fin_assitementryaccall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId IN ({param4}) AND a.subMonth <= {param5} ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId UNION SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, SUM(a.remain) AS remain, SUM(a.remainF) AS remainF, SUM(a.balance) AS balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOcc) AS debitOccF, SUM(a.creditOcc) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.subMonth, a.assItemId, a.assItemName, a.direction, CASE WHEN a.subMonth = 01 THEN a.remain END remain, CASE WHEN a.subMonth = 01 THEN a.remain END remainF, CASE WHEN a.subMonth = {param5} THEN a.balance END balance, CASE WHEN a.subMonth = {param5} THEN a.balance END balanceF, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', CONCAT('\u5916\u5E01:', a.currency)) AS currency FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId IN ({param4}) AND a.subMonth <= {param5} ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId ) a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.subjectId = a.subjectId
FINDG112303=SELECT a.customerId, a.yyyy, a.assItemId AS subjectId, a.assItemName AS subjectName, a.direction, SUM(a.remain) AS remain, SUM(a.remainF) AS remainF, SUM(a.balance) AS balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, SUM(a.remain) AS remain, SUM(a.remainF) AS remainF, SUM(a.balance) AS balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, a.remain, SUM(a.remainF) AS remainF, a.balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, SUM(a.remain) AS remain, "" AS remainF, SUM(a.balance) AS balance, "" AS balanceF, "" AS debitOccF, "" AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.subMonth, a.assItemId, a.assItemName, a.direction, CASE WHEN a.subMonth = 01 THEN a.remain END remain, "" AS remainF, CASE WHEN a.subMonth = {param5} THEN a.balance END balance, "" AS balanceF, "" AS debitOccF, "" AS creditOccF, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', CONCAT('\u5916\u5E01:', a.currency)) AS currency FROM {lockDbName}.fin_assitementryaccall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId IN ({param4}) AND a.subMonth <= {param5} ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId UNION SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, SUM(a.remain) AS remain, SUM(a.remainF) AS remainF, SUM(a.balance) AS balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOcc) AS debitOccF, SUM(a.creditOcc) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.subMonth, a.assItemId, a.assItemName, a.direction, CASE WHEN a.subMonth = 01 THEN a.remain END remain, CASE WHEN a.subMonth = 01 THEN a.remain END remainF, CASE WHEN a.subMonth = {param5} THEN a.balance END balance, CASE WHEN a.subMonth = {param5} THEN a.balance END balanceF, a.debitOcc, a.creditOcc, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', CONCAT('\u5916\u5E01:', a.currency)) AS currency FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId IN ({param4}) AND a.subMonth <= {param5} ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId ) a GROUP BY a.customerId, a.assItemId
FINDG112304=SELECT a.customerId, a.subjectId, CONCAT( '\u5C0F\u8BA1\uFF1A', a.subjectName ) AS subjectName, "" AS assItemId, "" AS assItemName, IF ( a.direction < 0, '\u8D37', '\u501F' ) AS direction, a.currency, a.remain, SUM(a.remainF) AS remainF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.balance, SUM(a.balanceF) AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, MAX(a.hasAssItem) AS hasAssItem, 0 AS afterAmount FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.direction, a.currency, SUM(a.remain) AS remain, "" AS remainF, "" AS debitOccF, "" AS creditOccF, SUM(a.balance) AS balance, "" AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM ( SELECT a.customerId, a.subMonth, a.subjectId, a.subjectName, a.direction, a.currency, CASE WHEN a.subMonth = 01 THEN a.remain END AS remain, "" AS remainF, "" AS debitOccF, "" AS creditOccF, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, "" AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM {lockDbName}.fin_accountall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND ( a.level1 = 2 OR (a.isLeaf1 = 1 AND a.level1 = 1)) AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ORDER BY a.subjectId ) a GROUP BY a.customerId, a.subjectId UNION SELECT a.customerId, a.subjectId, a.subjectName, a.direction, a.currency, SUM(a.remain) AS remain, SUM(a.remain) AS remainF, SUM(a.debitOcc) AS debitOccF, SUM(a.creditOcc) AS creditOccF, SUM(a.balance) AS balance, SUM(a.balance) AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM ( SELECT a.customerId, a.subMonth, a.subjectId, a.subjectName, a.direction, CASE WHEN a.currency = 0 THEN '\u4EBA\u6C11\u5E01' ELSE a.currency END AS currency, CASE WHEN a.subMonth = 01 THEN a.remain END AS remain, a.debitOcc, a.creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND ( a.level1 = 2 OR (a.isLeaf1 = 1 AND a.level1 = 1)) AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ORDER BY a.subjectId ) a GROUP BY a.customerId, a.subjectId ) a GROUP BY a.customerId, a.subjectId
#1125-0100-\u5E94\u6536\u6B3E\u9879\u878D\u8D44\u660E\u7EC6\u8868
FINDG112501=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, a.dataName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
#1131-0100-\u5E94\u6536\u80A1\u660E\u7EC6\u8868
FINDG113101=SELECT a.customerId,a.subjectId,a.subjectName,a.subjectFullName,"" AS assItemId,"" AS assItemName,a.remain,a.balance,SUM(IFNULL(a.creditOccF,0)) AS creditOccF,SUM(IFNULL(a.debitOccF,0)) AS debitOccF,SUM(IFNULL(a.creditOccFNext,0)) AS creditOccFNext,a.hasAssItem,0 AS remainOneYear FROM (SELECT a.customerId,a.subjectId,a.subjectName,a.subjectFullName,SUM(a.remain) AS remain,SUM(a.balance) AS balance,"" AS creditOccF,"" AS debitOccF,"" AS creditOccFNext,MAX(a.hasAssItem) AS hasAssItem FROM (SELECT a.customerId,a.subjectId,a.subjectName AS subjectName,a.subjectFullName AS subjectFullName,CASE WHEN a.subMonth=01 THEN a.remain END AS remain,CASE WHEN a.subMonth={param5} THEN a.balance END AS balance,"" AS debitOccF,"" AS creditOccF,"" AS creditOccFNext,a.hasAssItem FROM {lockDbName}.fin_accountall a WHERE a.customerId={param1} AND a.yyyy={param2} AND a.isLeaf1=1 AND a.subjectId LIKE '{param4}%' AND a.subMonth<={param5}) a GROUP BY a.subjectId UNION SELECT a.customerId,a.subjectId,a.subjectName,a.subjectFullName,MAX(a.remain) AS remain,MAX(a.balance) AS balance,SUM(a.creditOccF) AS creditOccF,SUM(a.debitOccF) AS debitOccF,SUM(IFNULL(a.creditOccFNext,0)) AS creditOccFNext,a.hasAssItem FROM (SELECT a.customerId,a.subjectId,a.subjectName AS subjectName,a.subjectFullName AS subjectFullName,CASE WHEN a.subMonth=01 THEN a.remain END AS remain,CASE WHEN a.subMonth={param5} THEN a.balance END AS balance,CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction< 0 THEN a.creditOcc ELSE a.debitOcc END END AS debitOccF,CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction< 0 THEN a.debitOcc ELSE a.creditOcc END END AS creditOccF,CASE WHEN b.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN b.direction< 0 THEN b.debitOcc ELSE b.creditOcc END END AS creditOccFNext,b.hasAssItem FROM {lockDbName}.fin_account a LEFT JOIN {lockDbName}.fin_account b ON a.customerId=b.customerId AND b.yyyy={param6} AND a.isLeaf1=b.isLeaf1 AND a.subjectId=b.subjectId AND a.subMonth=b.subMonth WHERE a.customerId={param1} AND a.yyyy={param2} AND a.isLeaf1=1 AND a.subjectId LIKE '{param4}%' AND a.subMonth<={param5}) a GROUP BY a.subjectId) a GROUP BY a.subjectId
FINDG113102=SELECT a.customerId,a.subjectId,a.subjectName,a.subjectFullName,a.assItemId,a.assItemName,a.yyyy,a.remain,a.balance,SUM(IFNULL(a.debitOccF,0)) AS debitOccF,SUM(IFNULL(a.creditOccF,0)) AS creditOccF,SUM(IFNULL(a.creditOccFNext,0)) AS creditOccFNext,0 AS remainOneYear FROM (SELECT a.customerId,a.subjectId,a.subjectName,a.subjectFullName,a.assItemId,a.assItemName,a.yyyy,SUM(a.remain) AS remain,SUM(a.balance) AS balance,"" AS debitOccF,"" AS creditOccF,"" AS creditOccFNext FROM (SELECT a.customerId,a.subjectId,a.subjectName,a.subjectFullName,a.assItemId,a.assItemName,a.yyyy,CASE WHEN a.subMonth=01 THEN a.remain END AS remain,CASE WHEN a.subMonth={param5} THEN a.balance END AS balance,"" AS debitOccF,"" AS creditOccF,"" AS creditOccFNext FROM {lockDbName}.fin_assitementryaccall a WHERE a.customerId={param1} AND a.yyyy={param2} AND a.isLeaf1=1 AND a.subjectId IN ({param4}) AND a.subMonth<={param5}) a GROUP BY a.customerId,a.subjectId,a.assItemId UNION SELECT a.customerId,a.subjectId,a.subjectName,a.subjectFullName,a.assItemId,a.assItemName,a.yyyy,SUM(a.remain) AS remain,SUM(a.balance) AS balance,SUM(a.debitOccF) AS debitOccF,SUM(a.creditOccF) AS creditOccF,SUM(IFNULL(a.creditOccFNext,0)) AS creditOccFNext FROM (SELECT a.customerId,a.subjectId,a.subjectName,a.subjectFullName,a.assItemId,a.assItemName,a.yyyy,CASE WHEN a.subMonth=01 THEN a.remain END AS remain,CASE WHEN a.subMonth={param5} THEN a.balance END AS balance,CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction< 0 THEN a.creditOcc ELSE a.debitOcc END END AS debitOccF,CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction< 0 THEN a.debitOcc ELSE a.creditOcc END END AS creditOccF,CASE WHEN b.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN b.direction< 0 THEN b.debitOcc ELSE b.creditOcc END END AS creditOccFNext FROM {lockDbName}.fin_assitementryacc a LEFT JOIN {lockDbName}.fin_assitementryacc b ON a.customerId=b.customerId AND b.yyyy={param6} AND a.isLeaf1=b.isLeaf1 AND a.subjectId=b.subjectId AND a.subMonth=b.subMonth AND a.assItemId = b.assItemId WHERE a.customerId={param1} AND a.yyyy={param2} AND a.isLeaf1=1 AND a.subjectId IN ({param4}) AND a.subMonth<={param5}) a GROUP BY a.customerId,a.subjectId,a.assItemId) a GROUP BY a.customerId,a.subjectId,a.assItemId
#1132-0100-\u5E94\u6536\u5229\u606F\u660E\u7EC6\u8868
FINDG113201=SELECT a.subjectId, a.subjectName, a.subjectFullName, a.remain, SUM(a.remainF) AS remainF, a.balance, SUM(a.balanceF) AS balanceF, SUM(a.creditOccF) AS creditOccF, SUM(a.debitOccF) AS debitOccF, a.direction, a.isLeaf1, a.level1, a.currency, a.hasAssItem FROM ( SELECT a.subjectId, a.subjectName, a.subjectFullName, SUM(a.remain) AS remain, "" AS remainF, SUM(a.balance) AS balance, "" AS balanceF, "" AS creditOccF, "" AS debitOccF, a.direction, a.isLeaf1, a.level1, a.currency, MAX(a.hasAssItem) AS hasAssItem FROM ( SELECT a.subjectId, a.subjectName AS subjectName, a.subjectFullName AS subjectFullName, CASE WHEN subMonth = 01 THEN a.remain END AS remain, "" AS remainF, CASE WHEN subMonth = {param5} THEN a.balance END AS balance, "" AS balanceF, "" AS debitOccF, "" AS creditOccF, a.direction, a.isLeaf1, a.level1, IF ( a.currency = '0', "", a.currency ) AS currency, a.hasAssItem FROM {lockDbName}.fin_accountall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.submonth <= {param5} ) a GROUP BY a.subjectId UNION SELECT a.subjectId, a.subjectName, a.subjectFullName, MAX(a.remain) AS remain, MAX(a.remainF) AS remainF, MAX(a.balance) AS balance, MAX(a.balanceF) AS balanceF, SUM(a.creditOccF) AS creditOccF, SUM(a.debitOccF) AS debitOccF, a.direction, a.isLeaf1, a.level1, a.currency, a.hasAssItem FROM ( SELECT a.subjectId, a.subjectName AS subjectName, a.subjectFullName AS subjectFullName, CASE WHEN subMonth = 01 THEN a.remain END AS remain, CASE WHEN subMonth = 01 THEN a.remain END AS remainF, CASE WHEN subMonth = {param5} THEN a.balance END AS balance, CASE WHEN subMonth = {param5} THEN a.balance END AS balanceF, CASE WHEN subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END END AS debitOccF, CASE WHEN subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END END AS creditOccF, a.direction, a.isLeaf1, a.level1, IF ( a.currency = '0', "", a.currency ) AS currency, a.hasAssItem FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.submonth <= {param5} ) a GROUP BY a.subjectId ) a GROUP BY a.subjectId
FINDG113202=SELECT a.customerId, a.subjectId, a.subjectName, a.assItemId, a.assItemName, a.yyyy, a.remain, SUM(a.remainF) AS remainF, a.balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.direction, a.currency FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.assItemId, a.assItemName, a.yyyy, SUM(a.remain) AS remain, "" AS remainF, SUM(a.balance) AS balance, "" AS balanceF, "" AS debitOccF, "" AS creditOccF, a.direction, a.currency FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.assItemId, a.assItemName, a.yyyy, CASE WHEN a.subMonth = 01 THEN a.remain END AS remain, "" AS remainF, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, "" AS balanceF, "" AS debitOccF, "" AS creditOccF, a.direction, IF ( a.currency = '0', "", a.currency ) AS currency FROM {lockDbName}.fin_assitementryaccall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId IN ({param4}) AND a.subMonth <= {param5} ) a GROUP BY a.customerId, a.subjectId, a.assItemId UNION SELECT a.customerId, a.subjectId, a.subjectName, a.assItemId, a.assItemName, a.yyyy, SUM(a.remain) AS remain, SUM(a.remainF) AS remainF, SUM(a.balance) AS balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, a.direction, a.currency FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.assItemId, a.assItemName, a.yyyy, CASE WHEN a.subMonth = 01 THEN a.remain END AS remain, CASE WHEN a.subMonth = 01 THEN a.remain END AS remainF, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balanceF, CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END END AS debitOcc, CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END END AS creditOcc, a.direction, IF ( a.currency = '0', "", a.currency ) AS currency FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId IN ({param4}) AND a.subMonth <= {param5} ) a GROUP BY a.customerId, a.subjectId, a.assItemId ) a GROUP BY a.customerId, a.subjectId, a.assItemId
FINDG113204=SELECT a.subjectId, a.subjectName, a.subjectFullName, a.remain, SUM(a.remainF) AS remainF, a.balance, SUM(a.balanceF) AS balanceF, SUM(a.creditOccF) AS creditOccF, SUM(a.debitOccF) AS debitOccF, a.direction, a.isLeaf1, a.level1, a.currency FROM ( SELECT a.subjectId, a.subjectName, a.subjectFullName, SUM(a.remain) AS remain, "" AS remainF, SUM(a.balance) AS balance, "" AS balanceF, "" AS creditOccF, "" AS debitOccF, a.direction, a.isLeaf1, a.level1, a.currency FROM ( SELECT a.subjectId, a.subjectName AS subjectName, a.subjectFullName AS subjectFullName, CASE WHEN subMonth = 01 THEN a.remain END AS remain, "" AS remainF, CASE WHEN subMonth = {param5} THEN a.balance END AS balance, "" AS balanceF, "" AS debitOccF, "" AS creditOccF, a.direction, a.isLeaf1, a.level1, IF ( a.currency = '0', "", a.currency ) AS currency FROM {lockDbName}.fin_accountall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND ( a.level1 = 2 OR (a.isLeaf1 = 1 AND a.level1 = 1)) AND a.subjectId LIKE '{param4}%' AND a.submonth <= {param5} ) a GROUP BY a.subjectId UNION SELECT a.subjectId, a.subjectName, a.subjectFullName, SUM(a.remain) AS remain, SUM(a.remainF) AS remainF, SUM(a.balance) AS balance, SUM(a.balanceF) AS balanceF, SUM(a.creditOccF) AS creditOccF, SUM(a.debitOccF) AS debitOccF, a.direction, a.isLeaf1, a.level1, a.currency FROM ( SELECT a.subjectId, a.subjectName AS subjectName, a.subjectFullName AS subjectFullName, CASE WHEN subMonth = 01 THEN a.remain END AS remain, CASE WHEN subMonth = 01 THEN a.remain END AS remainF, CASE WHEN subMonth = {param5} THEN a.balance END AS balance, CASE WHEN subMonth = {param5} THEN a.balance END AS balanceF, CASE WHEN subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END END AS debitOccF, CASE WHEN subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END END AS creditOccF, a.direction, a.isLeaf1, a.level1, IF ( a.currency = '0', "", a.currency ) AS currency FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND ( a.level1 = 2 OR (a.isLeaf1 = 1 AND a.level1 = 1)) AND a.subjectId LIKE '{param4}%' AND a.submonth <= {param5} ) a GROUP BY a.subjectId ) a GROUP BY a.subjectId
#1132-0200-\u5E94\u6536\u5229\u606F\u590D\u6838
FINDG113203=SELECT a.subjectId, IFNULL(a.subjectName, "") subjectName, IFNULL(c.vchDate, "") vchDate, IFNULL(c.currValue, 0) currValue FROM {lockDbName}.fin_accpkgsubject a LEFT JOIN {lockDbName}.fin_assitem b ON a.subjectId = b.subjectId AND a.customerId = b.customerId AND a.yyyy = b.yyyy AND b.isLeaf1 = 1 LEFT JOIN {lockDbName}.fin_assitementry c ON b.subjectId = c.subjectId AND b.yyyy = c.yyyy AND b.customerId = c.customerId AND b.assItemId = c.assItemId WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.level1 = 2 AND a.subjectId LIKE '{param4}%' ORDER BY c.vchDate DESC
#1221-0100-\u5176\u4ED6\u5E94\u6536\u6B3E\u660E\u7EC6\u8868
FINDG122101=SELECT a.customerId, a.subjectId, a.subjectName, "" AS assItemId, "" AS assItemName, IF (a.direction < 0, '\u8D37', '\u501F') AS direction, a.currency, a.remain, SUM(a.remainF) AS remainF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.balance, SUM(a.balanceF) AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, MAX(a.hasAssItem) AS hasAssItem, 0 AS afterAmount FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.direction, a.currency, SUM(a.remain) AS remain, "" AS remainF, "" AS debitOccF, "" AS creditOccF, SUM(a.balance) AS balance, "" AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM ( SELECT a.customerId, a.subMonth, a.subjectId, a.subjectName, a.direction, a.currency, CASE WHEN a.subMonth = 01 THEN a.remain END AS remain, "" AS remainF, "" AS debitOccF, "" AS creditOccF, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, "" AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM {lockDbName}.fin_accountall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ORDER BY a.subjectId ) a GROUP BY a.customerId, a.subjectId UNION SELECT a.customerId, a.subjectId, a.subjectName, a.direction, a.currency, SUM(a.remain) AS remain, SUM(a.remain) AS remainF, SUM(a.debitOcc) AS debitOccF, SUM(a.creditOcc) AS creditOccF, SUM(a.balance) AS balance, SUM(a.balance) AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM ( SELECT a.customerId, a.subMonth, a.subjectId, a.subjectName, a.direction, CASE WHEN a.currency = 0 THEN '\u4EBA\u6C11\u5E01' ELSE a.currency END AS currency, CASE WHEN a.subMonth = 01 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ORDER BY a.subjectId ) a GROUP BY a.customerId, a.subjectId ) a GROUP BY a.customerId, a.subjectId
FINDG122102=SELECT a.customerId, a.subjectId, b.subjectName, a.yyyy, a.assItemId, a.assItemName, a.direction, a.remain, a.remainF, a.balance, a.balanceF, a.debitOccF, a.creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, SUM(a.remain) AS remain, SUM(a.remainF) AS remainF, SUM(a.balance) AS balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, a.remain, SUM(a.remainF) AS remainF, a.balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, SUM(a.remain) AS remain, "" AS remainF, SUM(a.balance) AS balance, "" AS balanceF, "" AS debitOccF, "" AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.subMonth, a.assItemId, a.assItemName, a.direction, CASE WHEN a.subMonth = 01 THEN a.remain END remain, "" AS remainF, CASE WHEN a.subMonth = {param5} THEN a.balance END balance, "" AS balanceF, "" AS debitOccF, "" AS creditOccF, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', CONCAT('\u5916\u5E01:', a.currency)) AS currency FROM {lockDbName}.fin_assitementryaccall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId IN ({param4}) AND a.subMonth <= {param5} ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId UNION SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, SUM(a.remain) AS remain, SUM(a.remainF) AS remainF, SUM(a.balance) AS balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOcc) AS debitOccF, SUM(a.creditOcc) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.subMonth, a.assItemId, a.assItemName, a.direction, CASE WHEN a.subMonth = 01 THEN a.remain END remain, CASE WHEN a.subMonth = 01 THEN a.remain END remainF, CASE WHEN a.subMonth = {param5} THEN a.balance END balance, CASE WHEN a.subMonth = {param5} THEN a.balance END balanceF, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', CONCAT('\u5916\u5E01:', a.currency)) AS currency FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId IN ({param4}) AND a.subMonth <= {param5} ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId ) a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.subjectId = a.subjectId
FINDG122103=SELECT a.customerId, a.yyyy, a.assItemId AS subjectId, a.assItemName AS subjectName, a.direction, SUM(a.remain) AS remain, SUM(a.remainF) AS remainF, SUM(a.balance) AS balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, SUM(a.remain) AS remain, SUM(a.remainF) AS remainF, SUM(a.balance) AS balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, a.remain, SUM(a.remainF) AS remainF, a.balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, SUM(a.remain) AS remain, "" AS remainF, SUM(a.balance) AS balance, "" AS balanceF, "" AS debitOccF, "" AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.subMonth, a.assItemId, a.assItemName, a.direction, CASE WHEN a.subMonth = 01 THEN a.remain END remain, "" AS remainF, CASE WHEN a.subMonth = {param5} THEN a.balance END balance, "" AS balanceF, "" AS debitOccF, "" AS creditOccF, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', CONCAT('\u5916\u5E01:', a.currency)) AS currency FROM {lockDbName}.fin_assitementryaccall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId IN ({param4}) AND a.subMonth <= {param5} ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId UNION SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, SUM(a.remain) AS remain, SUM(a.remainF) AS remainF, SUM(a.balance) AS balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOcc) AS debitOccF, SUM(a.creditOcc) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.subMonth, a.assItemId, a.assItemName, a.direction, CASE WHEN a.subMonth = 01 THEN a.remain END remain, CASE WHEN a.subMonth = 01 THEN a.remain END remainF, CASE WHEN a.subMonth = {param5} THEN a.balance END balance, CASE WHEN a.subMonth = {param5} THEN a.balance END balanceF, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', CONCAT('\u5916\u5E01:', a.currency)) AS currency FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId IN ({param4}) AND a.subMonth <= {param5} ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId ) a GROUP BY a.customerId, a.assItemId
FINDG122104=SELECT a.customerId, a.subjectId, CONCAT('\u5C0F\u8BA1\uFF1A', a.subjectName) AS subjectName, "" AS assItemId, "" AS assItemName, IF (a.direction < 0, '\u8D37', '\u501F') AS direction, a.currency, a.remain, SUM(a.remainF) AS remainF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.balance, SUM(a.balanceF) AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, MAX(a.hasAssItem) AS hasAssItem, 0 AS afterAmount FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.direction, a.currency, SUM(a.remain) AS remain, "" AS remainF, "" AS debitOccF, "" AS creditOccF, SUM(a.balance) AS balance, "" AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM ( SELECT a.customerId, a.subMonth, a.subjectId, a.subjectName, a.direction, a.currency, CASE WHEN a.subMonth = 01 THEN a.remain END AS remain, "" AS remainF, "" AS debitOccF, "" AS creditOccF, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, "" AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM {lockDbName}.fin_accountall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND ( a.level1 = 2 OR (a.isLeaf1 = 1 AND a.level1 = 1)) AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ORDER BY a.subjectId ) a GROUP BY a.customerId, a.subjectId UNION SELECT a.customerId, a.subjectId, a.subjectName, a.direction, a.currency, SUM(a.remain) AS remain, SUM(a.remain) AS remainF, SUM(a.debitOcc) AS debitOccF, SUM(a.creditOcc) AS creditOccF, SUM(a.balance) AS balance, SUM(a.balance) AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM ( SELECT a.customerId, a.subMonth, a.subjectId, a.subjectName, a.direction, CASE WHEN a.currency = 0 THEN '\u4EBA\u6C11\u5E01' ELSE a.currency END AS currency, CASE WHEN a.subMonth = 01 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND ( a.level1 = 2 OR (a.isLeaf1 = 1 AND a.level1 = 1)) AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ORDER BY a.subjectId ) a GROUP BY a.customerId, a.subjectId ) a GROUP BY a.customerId, a.subjectId
#1401-0010-\u6750\u6599\u91C7\u8D2D\uFF08\u5728\u9014\u7269\u8D44\uFF09\u7684\u660E\u7EC6\u8868
FINDG140101=SELECT a.customerId, a.yyyy, a.subMonth, a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, SUM(a.remain) AS remain, SUM(a.balance) AS balance, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, a.dataName, a.direction, a.isLeaf1, a.level1, a.hasAssItem FROM ( SELECT a.customerId, a.yyyy, a.subMonth, a.subjectId, a.subjectName, a.subjectFullName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', a.currency ) AS dataName, a.direction, a.isLeaf1, a.level1, a.hasAssItem FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' ) a GROUP BY a.customerId, a.yyyy, a.subjectId
#1403-0010-\u539F\u6750\u6599\u660E\u7EC6\u8868
FINDG140301=SELECT a.customerId, a.yyyy, a.subMonth, a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, SUM(a.remain) AS remain, SUM(a.balance) AS balance, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, a.dataName, a.direction, a.isLeaf1, a.level1, a.hasAssItem FROM ( SELECT a.customerId, a.yyyy, a.subMonth, a.subjectId, a.subjectName, a.subjectFullName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', a.currency ) AS dataName, a.direction, a.isLeaf1, a.level1, a.hasAssItem FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' ) a GROUP BY a.customerId, a.yyyy, a.subjectId
#1404-0010-\u6750\u6599\u6210\u672C\u5DEE\u5F02\u660E\u7EC6\u8868
FINDG140401=SELECT a.customerId, a.yyyy, a.subMonth, a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, SUM(a.remain) AS remain, SUM(a.balance) AS balance, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, a.dataName, a.direction, a.isLeaf1, a.level1, a.hasAssItem FROM ( SELECT a.customerId, a.yyyy, a.subMonth, a.subjectId, a.subjectName, a.subjectFullName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', a.currency ) AS dataName, a.direction, a.isLeaf1, a.level1, a.hasAssItem FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' ) a GROUP BY a.customerId, a.yyyy, a.subjectId
#1405-0010-\u5E93\u5B58\u5546\u54C1\u660E\u7EC6\u8868
FINDG140501=SELECT a.customerId, a.yyyy, a.subMonth, a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, SUM(a.remain) AS remain, SUM(a.balance) AS balance, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, a.dataName, a.direction, a.isLeaf1, a.level1, a.hasAssItem FROM ( SELECT a.customerId, a.yyyy, a.subMonth, a.subjectId, a.subjectName, a.subjectFullName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', a.currency ) AS dataName, a.direction, a.isLeaf1, a.level1, a.hasAssItem FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' ) a GROUP BY a.customerId, a.yyyy, a.subjectId
#1406-0010-\u53D1\u51FA\u5546\u54C1\u660E\u7EC6\u8868
FINDG140601=SELECT a.customerId,a.subjectId,a.subjectName,a.subjectFullName,"" AS assItemId,"" AS assItemName,a.remain,a.balance,SUM(IFNULL(a.creditOccF,0)) AS creditOccF,SUM(IFNULL(a.debitOccF,0)) AS debitOccF,a.hasAssItem FROM (SELECT a.customerId,a.subjectId,a.subjectName,a.subjectFullName,SUM(a.remain) AS remain,SUM(a.balance) AS balance,"" AS creditOccF,"" AS debitOccF,MAX(a.hasAssItem) AS hasAssItem FROM (SELECT a.customerId,a.subjectId,a.subjectName AS subjectName,a.subjectFullName AS subjectFullName,CASE WHEN a.subMonth=01 THEN a.remain END AS remain,CASE WHEN a.subMonth={param5} THEN a.balance END AS balance,"" AS debitOccF,"" AS creditOccF,a.hasAssItem FROM {lockDbName}.fin_accountall a WHERE a.customerId={param1} AND a.yyyy={param2} AND a.subjectId LIKE '{param4}%' AND a.submonth<={param5}) a GROUP BY a.subjectId UNION SELECT a.customerId,a.subjectId,a.subjectName,a.subjectFullName,MAX(a.remain) AS remain,MAX(a.balance) AS balance,SUM(a.creditOccF) AS creditOccF,SUM(a.debitOccF) AS debitOccF,a.hasAssItem FROM (SELECT a.customerId,a.subjectId,a.subjectName AS subjectName,a.subjectFullName AS subjectFullName,CASE WHEN a.subMonth=01 THEN a.remain END AS remain,CASE WHEN a.subMonth={param5} THEN a.balance END AS balance,CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction< 0 THEN a.creditOcc ELSE a.debitOcc END END AS debitOccF,CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction< 0 THEN a.debitOcc ELSE a.creditOcc END END AS creditOccF,a.hasAssItem FROM {lockDbName}.fin_account a WHERE a.customerId={param1} AND a.yyyy={param2} AND a.subjectId LIKE '{param4}%' AND a.submonth<={param5}) a GROUP BY a.subjectId) a GROUP BY a.subjectId
#1407-0010-\u5546\u54C1\u8FDB\u9500\u5DEE\u4EF7\u660E\u7EC6\u8868
FINDG140701=SELECT a.customerId, a.yyyy, a.subMonth, a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, SUM(a.remain) AS remain, SUM(a.balance) AS balance, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, a.dataName, a.direction, a.isLeaf1, a.level1, a.hasAssItem FROM ( SELECT a.customerId, a.yyyy, a.subMonth, a.subjectId, a.subjectName, a.subjectFullName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', a.currency ) AS dataName, a.direction, a.isLeaf1, a.level1, a.hasAssItem FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' ) a GROUP BY a.customerId, a.yyyy, a.subjectId
#1408-0100-\u59D4\u6258\u52A0\u5DE5\u7269\u8D44\u7684\u660E\u7EC6\u8868
FINDG140801=SELECT a.customerId, a.yyyy, a.subMonth, a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, SUM(a.remain) AS remain, SUM(a.balance) AS balance, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, a.dataName, a.direction, a.isLeaf1, a.level1, a.hasAssItem FROM ( SELECT a.customerId, a.yyyy, a.subMonth, a.subjectId, a.subjectName, a.subjectFullName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', a.currency ) AS dataName, a.direction, a.isLeaf1, a.level1, a.hasAssItem FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' ) a GROUP BY a.customerId, a.yyyy, a.subjectId
#1411-0010-\u5468\u8F6C\u6750\u6599\u660E\u7EC6\u8868
FINDG141101=SELECT a.customerId,a.subjectId,a.subjectName,a.subjectFullName,"" AS assItemId,"" AS assItemName,a.remain,a.balance,SUM(IFNULL(a.creditOccF,0)) AS creditOccF,SUM(IFNULL(a.debitOccF,0)) AS debitOccF,a.hasAssItem FROM (SELECT a.customerId,a.subjectId,a.subjectName,a.subjectFullName,SUM(a.remain) AS remain,SUM(a.balance) AS balance,"" AS creditOccF,"" AS debitOccF,MAX(a.hasAssItem) AS hasAssItem FROM (SELECT a.customerId,a.subjectId,a.subjectName AS subjectName,a.subjectFullName AS subjectFullName,CASE WHEN a.subMonth=01 THEN a.remain END AS remain,CASE WHEN a.subMonth={param5} THEN a.balance END AS balance,"" AS debitOccF,"" AS creditOccF,a.hasAssItem FROM {lockDbName}.fin_accountall a WHERE a.customerId={param1} AND a.yyyy={param2} AND a.subjectId LIKE '{param4}%' AND a.submonth<={param5}) a GROUP BY a.subjectId UNION SELECT a.customerId,a.subjectId,a.subjectName,a.subjectFullName,MAX(a.remain) AS remain,MAX(a.balance) AS balance,SUM(a.creditOccF) AS creditOccF,SUM(a.debitOccF) AS debitOccF,a.hasAssItem FROM (SELECT a.customerId,a.subjectId,a.subjectName AS subjectName,a.subjectFullName AS subjectFullName,CASE WHEN a.subMonth=01 THEN a.remain END AS remain,CASE WHEN a.subMonth={param5} THEN a.balance END AS balance,CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction< 0 THEN a.creditOcc ELSE a.debitOcc END END AS debitOccF,CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction< 0 THEN a.debitOcc ELSE a.creditOcc END END AS creditOccF,a.hasAssItem FROM {lockDbName}.fin_account a WHERE a.customerId={param1} AND a.yyyy={param2} AND a.subjectId LIKE '{param4}%' AND a.submonth<={param5}) a GROUP BY a.subjectId) a GROUP BY a.subjectId
#1462-0010-\u5408\u540C\u8D44\u4EA7\u660E\u7EC6\u8868
FINDG146201=SELECT a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, a.balance FROM {lockDbName}.fin_account a WHERE	a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth = {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 GROUP BY a.customerId,	a.subjectId
#1471-0010-\u51CF\u503C\u51C6\u5907\u660E\u7EC6\u8868
FINDG147101=SELECT a.customerId,a.subjectId,a.subjectName,a.subjectFullName,"" AS assItemId,"" AS assItemName,a.remain,a.balance,SUM(IFNULL(a.creditOccF,0)) AS creditOccF,SUM(IFNULL(a.debitOccF,0)) AS debitOccF,a.hasAssItem FROM (SELECT a.customerId,a.subjectId,a.subjectName,a.subjectFullName,SUM(a.remain) AS remain,SUM(a.balance) AS balance,"" AS creditOccF,"" AS debitOccF,MAX(a.hasAssItem) AS hasAssItem FROM (SELECT a.customerId,a.subjectId,a.subjectName AS subjectName,a.subjectFullName AS subjectFullName,CASE WHEN a.subMonth=01 THEN a.remain END AS remain,CASE WHEN a.subMonth={param5} THEN a.balance END AS balance,"" AS debitOccF,"" AS creditOccF,a.hasAssItem FROM {lockDbName}.fin_accountall a WHERE a.customerId={param1} AND a.yyyy={param2} AND a.isLeaf1=1 AND a.subjectId LIKE '{param4}%' AND a.submonth<={param5}) a GROUP BY a.subjectId UNION SELECT a.customerId,a.subjectId,a.subjectName,a.subjectFullName,MAX(a.remain) AS remain,MAX(a.balance) AS balance,SUM(a.creditOccF) AS creditOccF,SUM(a.debitOccF) AS debitOccF,a.hasAssItem FROM (SELECT a.customerId,a.subjectId,a.subjectName AS subjectName,a.subjectFullName AS subjectFullName,CASE WHEN a.subMonth=01 THEN a.remain END AS remain,CASE WHEN a.subMonth={param5} THEN a.balance END AS balance,CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction< 0 THEN a.creditOcc ELSE a.debitOcc END END AS debitOccF,CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction< 0 THEN a.debitOcc ELSE a.creditOcc END END AS creditOccF,a.hasAssItem FROM {lockDbName}.fin_account a WHERE a.customerId={param1} AND a.yyyy={param2} AND a.isLeaf1=1 AND a.subjectId LIKE '{param4}%' AND a.submonth<={param5}) a GROUP BY a.subjectId) a GROUP BY a.subjectId
#1505-0100-\u6301\u6709\u5F85\u552E\u8D44\u4EA7\u660E\u7EC6\u8868
FINDG150501=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, a.dataName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
#1511-0010-\u957F\u671F\u80A1\u6743\u6295\u8D44\u660E\u7EC6\u8868
FINDG151101=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, a.dataName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
FINDG151102=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, a.dataName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
#1512-0100-\u957F\u671F\u6295\u8D44\u51CF\u503C\u51C6\u5907\u660E\u7EC6\u8868
FINDG151201=SELECT a.customerId, a.yyyy, a.subMonth, a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, SUM(a.remain) AS remain, SUM(a.balance) AS balance, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, a.dataName, a.direction, a.isLeaf1, a.level1, a.hasAssItem FROM ( SELECT a.customerId, a.yyyy, a.subMonth, a.subjectId, a.subjectName, a.subjectFullName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', a.currency ) AS dataName, a.direction, a.isLeaf1, a.level1, a.hasAssItem FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' ) a GROUP BY a.customerId, a.yyyy, a.subjectId
#1514-0100-\u4F7F\u7528\u6743\u8D44\u4EA7\u660E\u7EC6\u8868
FINDG151401=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, a.dataName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
FINDG151402=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, a.dataName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
FINDG151403=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, a.dataName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
#1515-0100-\u503A\u6743\u6295\u8D44\u660E\u7EC6\u8868
FINDG151501=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, a.dataName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
FINDG151502=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, a.dataName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
#1516-0100-\u5176\u4ED6\u503A\u6743\u6295\u8D44\u660E\u7EC6\u8868
FINDG151601=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, a.dataName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
FINDG151602=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, a.dataName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
#1517-0100-\u5176\u4ED6\u6743\u76CA\u5DE5\u5177\u6295\u8D44\u660E\u7EC6\u8868
FINDG151701=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, a.dataName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
#1518-0100-\u5176\u4ED6\u975E\u6D41\u52A8\u91D1\u878D\u8D44\u4EA7\u660E\u7EC6\u8868
FINDG151801=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, a.dataName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
#1519-0100-\u5F00\u53D1\u652F\u51FA\u660E\u7EC6\u8868
FINDG151901=SELECT a.* FROM ( SELECT a.customerId, a.subjectId, a.subjectName, "" AS assItemId, "" AS assItemName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, a.balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth = {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
#1521-0010-\u6295\u8D44\u6027\u623F\u5730\u4EA7\u660E\u7EC6\u8868
FINDG152101=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, a.dataName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
#1531-0100-\u957F\u671F\u5E94\u6536\u6B3E\u660E\u7EC6\u8868
FINDG153101=SELECT a.customerId, a.subjectId, a.subjectName, "" AS assItemId, "" AS assItemName, IF (a.direction < 0, '\u8D37', '\u501F') AS direction, a.currency, a.remain, SUM(a.remainF) AS remainF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.balance, SUM(a.balanceF) AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, MAX(a.hasAssItem) AS hasAssItem, 0 AS afterAmount FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.direction, a.currency, SUM(a.remain) AS remain, "" AS remainF, "" AS debitOccF, "" AS creditOccF, SUM(a.balance) AS balance, "" AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM ( SELECT a.customerId, a.subMonth, a.subjectId, a.subjectName, a.direction, a.currency, CASE WHEN a.subMonth = 01 THEN a.remain END AS remain, "" AS remainF, "" AS debitOccF, "" AS creditOccF, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, "" AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM {lockDbName}.fin_accountall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ORDER BY a.subjectId ) a GROUP BY a.customerId, a.subjectId UNION SELECT a.customerId, a.subjectId, a.subjectName, a.direction, a.currency, SUM(a.remain) AS remain, SUM(a.remain) AS remainF, SUM(a.debitOcc) AS debitOccF, SUM(a.creditOcc) AS creditOccF, SUM(a.balance) AS balance, SUM(a.balance) AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM ( SELECT a.customerId, a.subMonth, a.subjectId, a.subjectName, a.direction, CASE WHEN a.currency = 0 THEN '\u4EBA\u6C11\u5E01' ELSE a.currency END AS currency, CASE WHEN a.subMonth = 01 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ORDER BY a.subjectId ) a GROUP BY a.customerId, a.subjectId ) a GROUP BY a.customerId, a.subjectId
FINDG153102=SELECT a.customerId, a.subjectId, b.subjectName, a.yyyy, a.assItemId, a.assItemName, a.direction, a.remain, a.remainF, a.balance, a.balanceF, a.debitOccF, a.creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, SUM(a.remain) AS remain, SUM(a.remainF) AS remainF, SUM(a.balance) AS balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, a.remain, SUM(a.remainF) AS remainF, a.balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, SUM(a.remain) AS remain, "" AS remainF, SUM(a.balance) AS balance, "" AS balanceF, "" AS debitOccF, "" AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.subMonth, a.assItemId, a.assItemName, a.direction, CASE WHEN a.subMonth = 01 THEN a.remain END remain, "" AS remainF, CASE WHEN a.subMonth = {param5} THEN a.balance END balance, "" AS balanceF, "" AS debitOccF, "" AS creditOccF, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', CONCAT('\u5916\u5E01:', a.currency)) AS currency FROM {lockDbName}.fin_assitementryaccall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId IN ({param4}) AND a.subMonth <= {param5} ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId UNION SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, SUM(a.remain) AS remain, SUM(a.remainF) AS remainF, SUM(a.balance) AS balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOcc) AS debitOccF, SUM(a.creditOcc) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.subMonth, a.assItemId, a.assItemName, a.direction, CASE WHEN a.subMonth = 01 THEN a.remain END remain, CASE WHEN a.subMonth = 01 THEN a.remain END remainF, CASE WHEN a.subMonth = {param5} THEN a.balance END balance, CASE WHEN a.subMonth = {param5} THEN a.balance END balanceF, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', CONCAT('\u5916\u5E01:', a.currency)) AS currency FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId IN ({param4}) AND a.subMonth <= {param5} ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId ) a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.subjectId = a.subjectId
FINDG153103=SELECT a.customerId, a.yyyy, a.assItemId AS subjectId, a.assItemName AS subjectName, a.direction, SUM(a.remain) AS remain, SUM(a.remainF) AS remainF, SUM(a.balance) AS balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, SUM(a.remain) AS remain, SUM(a.remainF) AS remainF, SUM(a.balance) AS balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, a.remain, SUM(a.remainF) AS remainF, a.balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, SUM(a.remain) AS remain, "" AS remainF, SUM(a.balance) AS balance, "" AS balanceF, "" AS debitOccF, "" AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.subMonth, a.assItemId, a.assItemName, a.direction, CASE WHEN a.subMonth = 01 THEN a.remain END remain, "" AS remainF, CASE WHEN a.subMonth = {param5} THEN a.balance END balance, "" AS balanceF, "" AS debitOccF, "" AS creditOccF, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', CONCAT('\u5916\u5E01:', a.currency)) AS currency FROM {lockDbName}.fin_assitementryaccall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId IN ({param4}) AND a.subMonth <= {param5} ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId UNION SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, SUM(a.remain) AS remain, SUM(a.remainF) AS remainF, SUM(a.balance) AS balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOcc) AS debitOccF, SUM(a.creditOcc) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.subMonth, a.assItemId, a.assItemName, a.direction, CASE WHEN a.subMonth = 01 THEN a.remain END remain, CASE WHEN a.subMonth = 01 THEN a.remain END remainF, CASE WHEN a.subMonth = {param5} THEN a.balance END balance, CASE WHEN a.subMonth = {param5} THEN a.balance END balanceF, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', CONCAT('\u5916\u5E01:', a.currency)) AS currency FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId IN ({param4}) AND a.subMonth <= {param5} ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId ) a GROUP BY a.customerId, a.assItemId
#1532-0100-\u672A\u5B9E\u73B0\u878D\u8D44\u6536\u76CA\u660E\u7EC6\u8868
FINDG153201=SELECT a.customerId, a.yyyy, a.subMonth, a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, SUM(a.remain) AS remain, SUM(a.balance) AS balance, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, a.dataName, a.direction, a.isLeaf1, a.level1, a.hasAssItem FROM ( SELECT a.customerId, a.yyyy, a.subMonth, a.subjectId, a.subjectName, a.subjectFullName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', a.currency ) AS dataName, a.direction, a.isLeaf1, a.level1, a.hasAssItem FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' ) a GROUP BY a.customerId, a.yyyy, a.subjectId
#1601-0100-\u589E\u51CF\u53D8\u52A8\u8868
FINDG160101=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, a.dataName, "" AS assItemId, "" AS assItemName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
FINDG160102=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, a.dataName, "" AS assItemId, "" AS assItemName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
FINDG160103=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, a.dataName, "" AS assItemId, "" AS assItemName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
#1604-0100-\u5728\u5EFA\u5DE5\u7A0B\u660E\u7EC6\u8868
FINDG160401=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, a.dataName, "" AS assItemId, "" AS assItemName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
#1605-0100-\u5DE5\u7A0B\u7269\u8D44\u660E\u7EC6\u8868
FINDG160501=SELECT a.subjectId, a.subjectFullName, SUM(a.balance) AS balance FROM (SELECT a.subjectId, a.subjectFullName AS subjectFullName, IFNULL(a.balance, 0) AS balance FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.submonth <= {param5}) a GROUP BY a.subjectId ORDER BY a.subjectId 
#1605-0300-\u5DE5\u7A0B\u7269\u8D44\u51ED\u8BC1\u6D4B\u8BD5
FINDG160503=SELECT a.vchDate, a.oldVoucherId, a.summary, a.subjectId, a.subjectFullName, SUBSTRING_INDEX(SUBSTRING_INDEX(a.subjectFullName, "/", 2), "/", -1) AS secondName, CASE WHEN a.direction = 1 THEN a.direction * a.occurValue ELSE "" END AS debitOcc, CASE WHEN a.direction = -1 THEN a.direction * a.occurValue ELSE "" END AS creditOcc FROM {lockDbName}.fin_subjectentry a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectId LIKE '{param4}%' AND a.month <= {param5} ORDER BY a.customerId, a.yyyy, a.vchDate, a.oldVoucherId
#1606-0100-\u56FA\u5B9A\u8D44\u4EA7\u6E05\u7406
FINDG160601=SELECT a.customerId,a.subjectId,a.subjectName,a.subjectFullName,"" AS assItemId,"" AS assItemName,a.remain,a.balance,SUM(IFNULL(a.creditOccF,0)) AS creditOccF,SUM(IFNULL(a.debitOccF,0)) AS debitOccF,a.hasAssItem FROM (SELECT a.customerId,a.subjectId,a.subjectName,a.subjectFullName,SUM(a.remain) AS remain,SUM(a.balance) AS balance,"" AS creditOccF,"" AS debitOccF,MAX(a.hasAssItem) AS hasAssItem FROM (SELECT a.customerId,a.subjectId,a.subjectName AS subjectName,a.subjectFullName AS subjectFullName,CASE WHEN a.subMonth=01 THEN a.remain END AS remain,CASE WHEN a.subMonth={param5} THEN a.balance END AS balance,"" AS debitOccF,"" AS creditOccF,a.hasAssItem FROM {lockDbName}.fin_accountall a WHERE a.customerId={param1} AND a.yyyy={param2} AND a.subjectId LIKE '{param4}%' AND a.submonth<={param5} AND a.isLeaf1=1) a GROUP BY a.subjectId UNION SELECT a.customerId,a.subjectId,a.subjectName,a.subjectFullName,MAX(a.remain) AS remain,MAX(a.balance) AS balance,SUM(a.creditOccF) AS creditOccF,SUM(a.debitOccF) AS debitOccF,a.hasAssItem FROM (SELECT a.customerId,a.subjectId,a.subjectName AS subjectName,a.subjectFullName AS subjectFullName,CASE WHEN a.subMonth=01 THEN a.remain END AS remain,CASE WHEN a.subMonth={param5} THEN a.balance END AS balance,CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction< 0 THEN a.creditOcc ELSE a.debitOcc END END AS debitOccF,CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction< 0 THEN a.debitOcc ELSE a.creditOcc END END AS creditOccF,a.hasAssItem FROM {lockDbName}.fin_account a WHERE a.customerId={param1} AND a.yyyy={param2} AND a.subjectId LIKE '{param4}%' AND a.submonth<={param5} AND a.isLeaf1=1) a GROUP BY a.subjectId) a GROUP BY a.subjectId
#1607-0100-\u56FA\u5B9A\u8D44\u4EA7\u51CF\u503C\u51C6\u5907\u660E\u7EC6\u8868
FINDG160701=SELECT a.customerId, a.yyyy, a.subMonth, a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, SUM(a.remain) AS remain, SUM(a.balance) AS balance, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, a.dataName, a.direction, a.isLeaf1, a.level1, a.hasAssItem FROM ( SELECT a.customerId, a.yyyy, a.subMonth, a.subjectId, a.subjectName, a.subjectFullName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', a.currency ) AS dataName, a.direction, a.isLeaf1, a.level1, a.hasAssItem FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' ) a GROUP BY a.customerId, a.yyyy, a.subjectId
#1621-0100-\u751F\u4EA7\u6027\u751F\u7269\u8D44\u4EA7\u660E\u7EC6\u8868
FINDG162101=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, a.dataName, "" AS assItemId, "" AS assItemName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
FINDG162102=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, a.dataName, "" AS assItemId, "" AS assItemName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
FINDG162103=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, a.dataName, "" AS assItemId, "" AS assItemName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
#1631-0100-\u6CB9\u6C14\u8D44\u4EA7\u660E\u7EC6\u8868
FINDG163101=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, a.dataName, "" AS assItemId, "" AS assItemName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
FINDG163102=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, a.dataName, "" AS assItemId, "" AS assItemName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
FINDG163103=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, a.dataName, "" AS assItemId, "" AS assItemName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
#1701-0100-\u65E0\u5F62\u8D44\u4EA7\u660E\u7EC6\u8868
FINDG170101=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, a.dataName, "" AS assItemId, "" AS assItemName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
FINDG170104=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, a.dataName, "" AS assItemId, "" AS assItemName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
FINDG170105=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, a.dataName, "" AS assItemId, "" AS assItemName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
#1701-0200-\u65E0\u5F62\u8D44\u4EA7\u6743\u8BC1\u67E5\u9A8C\u8BB0\u5F55
FINDG170102=SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName AS accName, a.remainF, a.remainF + b.remainF FROM ( SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName, a.remainF FROM (( SELECT aa.customerId, aa.yyyy, aa.subjectId, aa.subjectName, MAX(aa.remainF) AS remainF FROM ( SELECT a.customerId, a.yyyy, a.subMonth, a.subjectId, a.subjectName AS subjectName, CASE WHEN a.subMonth = 01 THEN  a.remain END AS remainF FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 AND a.subMonth <= {param6} ) aa GROUP BY aa.customerId, aa.yyyy, aa.subjectId ORDER BY aa.customerId, aa.yyyy, aa.subjectId )) a WHERE a.subjectName NOT LIKE '%{param5}' ) a LEFT JOIN ( SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName, a.remainF FROM (( SELECT aa.customerId, aa.yyyy, aa.subjectId, aa.subjectName, MAX(aa.remainF) AS remainF FROM ( SELECT a.customerId, a.yyyy, a.subMonth, a.subjectId, a.subjectName AS subjectName, CASE WHEN a.subMonth = 01 THEN  a.remain END AS remainF FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 AND a.subMonth <= {param6} ) aa GROUP BY aa.customerId, aa.yyyy, aa.subjectId ORDER BY aa.customerId, aa.yyyy, aa.subjectId )) a WHERE a.subjectName LIKE '%{param5}' ) b ON a.subjectName LIKE CONCAT( LEFT ( b.subjectName, CHAR_LENGTH(b.subjectName) - CHAR_LENGTH('{param5}')), '%' )
#1701-0300-\u65E0\u5F62\u8D44\u4EA7\u589E\u51CF\u67E5\u9A8C
FINDG170103=SELECT a.vchDate, a.oldVoucherId, a.summary, a.subjectId, a.subjectFullName, SUBSTRING_INDEX( SUBSTRING_INDEX(a.subjectFullName, "/", 2), "/", -1 ) AS secondName, b.debitOccF AS debitOcc, b.creditOccF AS creditOcc FROM {lockDbName}.fin_subjectentry a LEFT JOIN ( SELECT aa.customerId, aa.yyyy, aa.subjectId, SUM(aa.debitOccF) AS debitOccF, SUM(aa.creditOccF) AS creditOccF FROM ( SELECT a.customerId, a.yyyy, a.subjectId, CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END END AS debitOccF, CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END END AS creditOccF, a.isLeaf1 AS isLeaf1, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', CONCAT('\u5916\u5E01:', a.currency)) AS currency, a.subMonth FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} ) aa WHERE aa.customerId = {param1} AND aa.yyyy = {param2} AND aa.subjectId LIKE '{param4}%' AND aa.isLeaf1 = 1 AND aa.subMonth <= {param5} GROUP BY aa.customerId, aa.yyyy, aa.subjectId, aa.currency ORDER BY aa.customerId, aa.yyyy, aa.subjectId, aa.currency ) b ON a.customerId = b.customerId AND a.subjectId = b.subjectId WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectId LIKE '{param4}%' AND a. MONTH <= {param6} ORDER BY a.vchDate DESC
#1705-0100-\u65E0\u5F62\u8D44\u4EA7\u51CF\u503C\u51C6\u5907\u660E\u7EC6\u8868
FINDG170501=SELECT a.customerId, a.yyyy, a.subMonth, a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, SUM(a.remain) AS remain, SUM(a.balance) AS balance, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, a.dataName, a.direction, a.isLeaf1, a.level1, a.hasAssItem FROM ( SELECT a.customerId, a.yyyy, a.subMonth, a.subjectId, a.subjectName, a.subjectFullName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', a.currency ) AS dataName, a.direction, a.isLeaf1, a.level1, a.hasAssItem FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' ) a GROUP BY a.customerId, a.yyyy, a.subjectId
#1711-0100-\u5546\u8A89\u589E\u51CF\u53D8\u52A8\u53CA\u4F59\u989D\u660E\u7EC6\u8868
FINDG171101=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, a.dataName, "" AS assItemId, "" AS assItemName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
FINDG171102=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, a.dataName, "" AS assItemId, "" AS assItemName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
#1801-0100-\u957F\u671F\u5F85\u644A\u8D39\u7528
FINDG180101=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, a.dataName, "" AS assItemId, "" AS assItemName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
#1801-0200-\u957F\u671F\u5F85\u644A\u8D39\u7528\u7684\u672C\u671F\u589E\u52A0\u68C0\u67E5
FINDG180102=SELECT a.vchDate, a.oldVoucherId, a.summary, a.subjectId, a.subjectFullName, SUBSTRING_INDEX(SUBSTRING_INDEX(a.subjectFullName, "/", 2), "/", -1) AS secondName, CASE WHEN a.direction = 1 THEN IFNULL(a.occurValue, 0) ELSE 0 END AS debitOcc, CASE WHEN a.direction = -1 THEN IFNULL(a.occurValue, 0) ELSE 0 END AS creditOcc FROM {lockDbName}.fin_subjectentry a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectId LIKE '{param4}%'  AND a.subjectId <> '{param4}' AND a.month <= {param5} ORDER BY a.customerId, a.yyyy, a.vchDate, a.oldVoucherId
#1811-0100-\u9012\u5EF6\u6240\u5F97\u7A0E\u8D44\u4EA7\u660E\u7EC6\u5185\u5BB9\u8C03\u6574\u8868
FINDG181101=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, a.dataName, "" AS assItemId, "" AS assItemName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
#1900-0100-\u5176\u4ED6\u975E\u6D41\u52A8\u8D44\u4EA7
FINDG190001=SELECT a.subjectId, a.subjectFullName, "" AS assItemId, "" AS assItemName, MAX(a.remain) AS remain, SUM(a.debitOcc) AS debitTotalOcc, SUM(a.creditOcc) AS creditTotalOcc FROM ( SELECT a.subjectId, IFNULL(a.subjectFullName, 0) AS subjectFullName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, IFNULL(CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END, 0) AS debitOcc, IFNULL(CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END, 0) AS creditOcc FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} AND a.isLeaf1 = 1 ) a GROUP BY a.subjectId, a.subjectFullName
#1910-0100-\u884D\u751F\u91D1\u878D\u8D44\u4EA7\u660E\u7EC6\u8868
FINDG191001=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, a.dataName, "" AS assItemId, "" AS assItemName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
#1990-0100-\u5176\u4ED6\u6D41\u52A8\u8D44\u4EA7\u660E\u7EC6\u8868
FINDG199001=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, a.dataName, "" AS assItemId, "" AS assItemName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
#1991-0100-\u4E00\u5E74\u5185\u5230\u671F\u7684\u975E\u6D41\u52A8\u8D44\u4EA7\u660E\u7EC6\u8868
FINDG199101=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, a.dataName, "" AS assItemId, "" AS assItemName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
#2001-0100-\u77ED\u671F\u501F\u6B3E\u660E\u7EC6\u8868
FINDG200101=SELECT a.customerId,a.yyyy,a.subjectId,a.subjectName,a.assItemId,a.assItemName,a.currency,IFNULL(a.remain,0) AS remain,IFNULL(SUM(a.remainF),0) AS remainF,IFNULL(a.balance,0) AS balance,IFNULL(SUM(a.balanceF),0) AS balanceF,IFNULL(SUM(a.debitOccF),0) AS debitOccF,IFNULL(SUM(a.creditOccF),0) AS creditOccF,a.direction,a.isLeaf1,a.isAcc FROM (SELECT IF (b.customerId IS NOT NULL,b.customerId,a.customerId) AS customerId,IF (b.customerId IS NOT NULL,b.yyyy,a.yyyy) AS yyyy,IF (b.customerId IS NOT NULL,b.subjectId,a.subjectId) AS subjectId,IF (b.customerId IS NOT NULL,b.subjectName,a.subjectName) AS subjectName,IF (b.customerId IS NOT NULL,b.assItemId,"") AS assItemId,IF (b.customerId IS NOT NULL,b.assItemName,"") AS assItemName,IF (b.customerId IS NOT NULL,b.currency,a.currency) AS currency,IF (b.customerId IS NOT NULL,IF (b.remain !="",b.remain,NULL),IF (a.remain !="",a.remain,NULL)) AS remain,IF (b.customerId IS NOT NULL,IF (b.remainF !="",b.remainF,NULL),IF (a.remainF !="",a.remainF,NULL)) AS remainF,IF (b.customerId IS NOT NULL,IF (b.balance !="",b.balance,NULL),IF (a.balance !="",a.balance,NULL)) AS balance,IF (b.customerId IS NOT NULL,IF (b.balanceF !="",b.balanceF,NULL),IF (a.balanceF !="",a.balanceF,NULL)) AS balanceF,IF (b.customerId IS NOT NULL,IF (b.debitOccF !="",b.debitOccF,NULL),IF (a.debitOccF !="",a.debitOccF,NULL)) AS debitOccF,IF (b.customerId IS NOT NULL,IF (b.creditOccF !="",b.creditOccF,NULL),IF (a.creditOccF !="",a.creditOccF,NULL)) AS creditOccF,IF (b.customerId IS NOT NULL,b.direction,a.direction) AS direction,IF (b.customerId IS NOT NULL,b.isLeaf1,a.isLeaf1) AS isLeaf1,IF (b.customerId IS NOT NULL,2,1) AS isAcc FROM (SELECT a.customerId,a.yyyy,a.subjectId,a.subjectName,a.fullName,a.currency,a.remain,SUM(a.remainF) AS remainF,a.balance,SUM(a.balanceF) AS balanceF,SUM(a.debitOccF) AS debitOccF,SUM(a.creditOccF) AS creditOccF,a.direction,a.isLeaf1 FROM (SELECT a.customerId,a.yyyy,a.subjectId,a.subjectName,a.fullName,a.currency,SUM(a.remain) AS remain,"" AS remainF,SUM(a.balance) AS balance,"" AS balanceF,"" AS debitOccF,"" AS creditOccF,a.direction,a.isLeaf1 FROM (SELECT a.customerId,a.yyyy,a.subMonth,a.subjectId,a.subjectName AS subjectName,a.subjectFullName AS fullName,CASE WHEN a.subMonth=01 THEN a.remain END AS remain,"" AS remainF,"" AS debitOccF,"" AS creditOccF,CASE WHEN a.subMonth={param5} THEN a.balance END AS balance,"" AS balanceF,IF (a.currency='0',"",CONCAT('\u5916\u5E01:',a.currency)) AS currency,a.direction,a.isLeaf1 FROM {lockDbName}.fin_accountall a WHERE a.customerId={param1} AND a.yyyy={param2} AND a.isLeaf1=1 AND a.subjectId LIKE '{param4}%') a GROUP BY a.customerId,a.yyyy,a.subjectId UNION SELECT a.customerId,a.yyyy,a.subjectId,a.subjectName,a.fullName,a.currency,SUM(a.remain) AS remain,SUM(a.remainF) AS remainF,SUM(a.balance) AS balance,SUM(a.balanceF) AS balanceF,SUM(a.debitOccF) AS debitOccF,SUM(a.creditOccF) AS creditOccF,a.direction,a.isLeaf1 FROM (SELECT a.customerId,a.yyyy,a.subMonth,a.subjectId,a.subjectName AS subjectName,a.subjectFullName AS fullName,CASE WHEN a.subMonth=01 THEN a.remain END AS remain,CASE WHEN a.subMonth=01 THEN a.remain END AS remainF,CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction< 0 THEN a.creditOcc ELSE a.debitOcc END END AS debitOccF,CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction< 0 THEN a.debitOcc ELSE a.creditOcc END END AS creditOccF,CASE WHEN a.subMonth={param5} THEN a.balance END AS balance,CASE WHEN a.subMonth={param5} THEN a.balance END AS balanceF,IF (a.currency='0',"",CONCAT('\u5916\u5E01:',a.currency)) AS currency,a.direction,a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId={param1} AND a.yyyy={param2} AND a.isLeaf1=1 AND a.subjectId LIKE '{param4}%') a GROUP BY a.customerId,a.yyyy,a.subjectId) a GROUP BY a.customerId,a.yyyy,a.subjectId) a LEFT JOIN (SELECT a.customerId,a.yyyy,a.subjectId,a.subjectName,a.assItemId,a.assItemName,a.fullName,a.currency,SUM(a.remain) AS remain,SUM(a.remainF) AS remainF,SUM(a.balance) AS balance,SUM(a.balanceF) AS balanceF,SUM(a.debitOccF) AS debitOccF,SUM(a.creditOccF) AS creditOccF,a.direction,a.isLeaf1 FROM (SELECT aa.customerId,aa.yyyy,aa.subjectId,aa.subjectName,aa.assItemId,aa.assItemName,aa.fullName,aa.currency,aa.remain,SUM(aa.remainF) AS remainF,aa.balance,SUM(aa.balanceF) AS balanceF,SUM(aa.debitOccF) AS debitOccF,SUM(aa.creditOccF) AS creditOccF,aa.direction,aa.isLeaf1 FROM (SELECT a.customerId,a.yyyy,a.subjectId,a.subjectName,a.assItemId,a.assItemName,a.fullName,a.currency,SUM(a.remain) AS remain,"" AS remainF,SUM(a.balance) AS balance,"" AS balanceF,"" AS debitOccF,"" AS creditOccF,a.direction,a.isLeaf1 FROM (SELECT a.customerId,a.yyyy,a.subjectId AS subjectId,a.subjectName,a.assItemId,a.assItemName,a.assTotalName AS fullName,IF (a.currency='0',"",CONCAT('\u5916\u5E01:',a.currency)) AS currency,CASE WHEN a.subMonth=01 THEN a.remain END AS remain,"" AS remainF,CASE WHEN a.subMonth={param5} THEN a.balance END AS balance,"" AS balanceF,"" AS debitOccF,"" AS creditOccF,a.direction,a.isLeaf1 FROM {lockDbName}.fin_assitementryaccall a WHERE a.customerId={param1} AND a.yyyy={param2} AND a.isLeaf1=1 AND a.subjectId LIKE '{param4}%' AND a.subMonth<={param5}) a GROUP BY a.customerId,a.yyyy,a.subjectId,a.assItemId UNION SELECT a.customerId,a.yyyy,a.subjectId,a.subjectName,a.assItemId,a.assItemName,a.fullName,a.currency,SUM(a.remain) AS remain,SUM(a.remainF) AS remainF,SUM(a.balance) AS balance,SUM(a.balanceF) AS balanceF,SUM(a.debitOccF) AS debitOccF,SUM(a.creditOccF) AS creditOccF,a.direction,a.isLeaf1 FROM (SELECT a.customerId,a.yyyy,a.subjectId AS subjectId,a.subjectName,a.assItemId,a.assItemName,a.assTotalName AS fullName,IF (a.currency='0',"",CONCAT('\u5916\u5E01:',a.currency)) AS currency,CASE WHEN a.subMonth=01 THEN a.remain END AS remain,CASE WHEN a.subMonth=01 THEN a.remain END AS remainF,CASE WHEN a.subMonth={param5} THEN a.balance END AS balance,CASE WHEN a.subMonth={param5} THEN a.balance END AS balanceF,CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction< 0 THEN a.creditOcc ELSE a.debitOcc END END AS debitOccF,CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction< 0 THEN a.debitOcc ELSE a.creditOcc END END AS creditOccF,a.direction,a.isLeaf1 FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId={param1} AND a.yyyy={param2} AND a.isLeaf1=1 AND a.subjectId LIKE '{param4}%' AND a.subMonth<={param5}) a GROUP BY a.customerId,a.yyyy,a.subjectId,a.assItemId) aa GROUP BY aa.customerId,aa.yyyy,aa.subjectId,aa.assItemId ORDER BY aa.subjectId,aa.assItemId) a GROUP BY a.customerId,a.yyyy,a.subjectId) c ON a.customerId=c.customerId AND a.yyyy=c.yyyy AND a.subjectId=c.subjectId AND a.remain=c.remain LEFT JOIN (SELECT aa.customerId,aa.yyyy,aa.subjectId,aa.subjectName,aa.assItemId,aa.assItemName,aa.fullName,aa.currency,aa.remain,SUM(aa.remainF) AS remainF,aa.balance,SUM(aa.balanceF) AS balanceF,SUM(aa.debitOccF) AS debitOccF,SUM(aa.creditOccF) AS creditOccF,aa.direction,aa.isLeaf1 FROM (SELECT a.customerId,a.yyyy,a.subjectId,a.subjectName,a.assItemId,a.assItemName,a.fullName,a.currency,SUM(a.remain) AS remain,"" AS remainF,SUM(a.balance) AS balance,"" AS balanceF,"" AS debitOccF,"" AS creditOccF,a.direction,a.isLeaf1 FROM (SELECT a.customerId,a.yyyy,a.subjectId AS subjectId,a.subjectName,a.assItemId,a.assItemName,a.assTotalName AS fullName,IF (a.currency='0',"",CONCAT('\u5916\u5E01:',a.currency)) AS currency,CASE WHEN a.subMonth=01 THEN a.remain END AS remain,"" AS remainF,CASE WHEN a.subMonth={param5} THEN a.balance END AS balance,"" AS balanceF,"" AS debitOccF,"" AS creditOccF,a.direction,a.isLeaf1 FROM {lockDbName}.fin_assitementryaccall a WHERE a.customerId={param1} AND a.yyyy={param2} AND a.isLeaf1=1 AND a.subjectId LIKE '{param4}%' AND a.subMonth<={param5}) a GROUP BY a.customerId,a.yyyy,a.subjectId,a.assItemId UNION SELECT a.customerId,a.yyyy,a.subjectId,a.subjectName,a.assItemId,a.assItemName,a.fullName,a.currency,SUM(a.remain) AS remain,SUM(a.remainF) AS remainF,SUM(a.balance) AS balance,SUM(a.balanceF) AS balanceF,SUM(a.debitOccF) AS debitOccF,SUM(a.creditOccF) AS creditOccF,a.direction,a.isLeaf1 FROM (SELECT a.customerId,a.yyyy,a.subjectId AS subjectId,a.subjectName,a.assItemId,a.assItemName,a.assTotalName AS fullName,IF (a.currency='0',"",CONCAT('\u5916\u5E01:',a.currency)) AS currency,CASE WHEN a.subMonth=01 THEN a.remain END AS remain,CASE WHEN a.subMonth=01 THEN a.remain END AS remainF,CASE WHEN a.subMonth={param5} THEN a.balance END AS balance,CASE WHEN a.subMonth={param5} THEN a.balance END AS balanceF,CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction< 0 THEN a.creditOcc ELSE a.debitOcc END END AS debitOccF,CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction< 0 THEN a.debitOcc ELSE a.creditOcc END END AS creditOccF,a.direction,a.isLeaf1 FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId={param1} AND a.yyyy={param2} AND a.isLeaf1=1 AND a.subjectId LIKE '{param4}%' AND a.subMonth<={param5}) a GROUP BY a.customerId,a.yyyy,a.subjectId,a.assItemId) aa GROUP BY aa.customerId,aa.yyyy,aa.subjectId,aa.assItemId ORDER BY aa.subjectId,aa.assItemId) b ON c.customerId=b.customerId AND c.yyyy=b.yyyy AND c.subjectId=b.subjectId WHERE a.customerId={param1} AND a.yyyy={param2}) a GROUP BY a.customerId,a.yyyy,a.subjectId
#2001-0200-\u8D37\u6B3E\u8BC1\u4FE1\u606F\u8D44\u6599\u4E0E\u4F01\u4E1A\u660E\u7EC6\u8D26\u501F\u6B3E\u4F59\u989D\u6838\u5BF9\u53CA\u8BF4\u660E
FINDG200102=SELECT SUBSTRING_INDEX(a.subjectFullName, "/", 1) AS jkType, a.customerId, a.yyyy, a.subjectId, a.subjectName, SUM( CASE WHEN a.subMonth = 1 THEN a.remain END ) AS remain, SUM(CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END) AS debitOcc, SUM(CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END) AS creditOcc, SUM( CASE WHEN a.subMonth = {param5} THEN a.balance END ) AS balance, a.direction, a.subjectFullName FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} GROUP BY a.customerId, a.yyyy, a.subjectId ORDER BY a.customerId, a.yyyy, a.subjectId
FINDG200103=SELECT SUBSTRING_INDEX(a.subjectFullName, "/", 1) AS jkType, a.customerId, a.yyyy, a.subjectId, a.subjectName, SUM( CASE WHEN a.subMonth = 1 THEN a.remain END ) AS remain, SUM(CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END) AS debitOcc, SUM(CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END) AS creditOcc, SUM( CASE WHEN a.subMonth = {param5} THEN a.balance END ) AS balance, a.direction, a.subjectFullName FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectFullName LIKE '{param6}%' AND a.subjectFullName <> '{param6}' AND a.subMonth <= {param5} GROUP BY a.customerId, a.yyyy, a.subjectId ORDER BY a.customerId, a.yyyy, a.subjectId
#2001-0300-\u77ED\u671F\u501F\u6B3E\u5229\u606F\u68C0\u67E5\u60C5\u51B5\u8868
FINDG200104=SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName AS subjectName, a.subjectFullName AS subjectFullName FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' GROUP BY a.customerId, a.yyyy, a.subjectId ORDER BY a.customerId, a.yyyy, a.subjectId
#2001-0400-\u77ED\u671F\u501F\u6B3E\u589E\u51CF\u6D4B\u8BD5
FINDG200105=SELECT IFNULL( SUM( CASE WHEN a.subMonth = 1 THEN  a.remain ELSE 0 END ), 0 ) remain, IFNULL( SUM( CASE WHEN a.subMonth = {param5} THEN  a.balance ELSE 0 END ), 0 ) balance, IFNULL( SUM( CASE WHEN a.subMonth = {param5} THEN a.debitTotalOcc ELSE 0 END ), 0 ) debitTotalOcc, IFNULL( SUM( CASE WHEN a.subMonth = {param5} THEN a.creditTotalOcc ELSE 0 END ), 0 ) creditTotalOcc FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectId = '{param4}'
FINDG200106=SELECT IFNULL( SUM( CASE WHEN a.subMonth = 1 THEN  a.remain ELSE 0 END ), 0 ) remain, IFNULL( SUM( CASE WHEN a.subMonth = {param5} THEN  a.balance ELSE 0 END ), 0 ) balance, IFNULL( SUM( CASE WHEN a.subMonth = {param5} THEN a.debitTotalOcc ELSE 0 END ), 0 ) debitTotalOcc, IFNULL( SUM( CASE WHEN a.subMonth = {param5} THEN a.creditTotalOcc ELSE 0 END ), 0 ) creditTotalOcc FROM {lockDbName}.fin_accountall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectId = '{param4}'
FINDG200107=SELECT IFNULL(a.vchDate, "") vchDate, IFNULL(a.oldVoucherId, "") oldVoucherId, IFNULL(a.summary, "") summary, IFNULL(a.subjectId, "") subjectId, IFNULL(a.subjectFullName, "") subjectFullName, SUBSTRING_INDEX( SUBSTRING_INDEX( IFNULL(a.subjectFullName, ""), '/', 2 ), '/', -1 ) AS secondName, IFNULL(a.occurValue, 0) occurValue FROM {lockDbName}.fin_subjectentry a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND direction = {param6} AND a.subjectId LIKE '{param4}%' AND a.month <= {param7} ORDER BY a.customerId, a.yyyy, a.vchDate, a.oldVoucherId
#2101-0100-\u4EA4\u6613\u6027\u91D1\u878D\u8D1F\u503A\u660E\u7EC6\u8868
FINDG210101=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, a.dataName, "" AS assItemId, "" AS assItemName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
#2105-0100-\u884D\u751F\u91D1\u878D\u8D1F\u503A\u660E\u7EC6\u8868
FINDG210501=SELECT a.* FROM ( SELECT a.customerId, a.subjectId, a.subjectName, "" AS assItemId, "" AS assItemName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, a.balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth = {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
#2106-0100-\u6301\u6709\u5F85\u552E\u8D1F\u503A\u660E\u7EC6\u8868
FINDG210601=SELECT a.* FROM ( SELECT a.customerId, a.subjectId, a.subjectName, "" AS assItemId, "" AS assItemName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, a.balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth = {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
#2107-0100\u5408\u540C\u8D1F\u503A\u660E\u7EC6\u8868
FINDG210701=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, a.dataName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
#2108-0100-\u79DF\u8D41\u8D1F\u503A\u660E\u7EC6\u8868
FINDG210801=SELECT a.* FROM ( SELECT a.customerId, a.subjectId, a.subjectName, "" AS assItemId, "" AS assItemName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, a.balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth = {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
#2201-0100-\u5E94\u4ED8\u7968\u636E\u660E\u7EC6\u8868
FINDG220101=SELECT a.subjectFullName, a.subjectId FROM {lockDbName}.fin_accpkgsubject a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%'
FINDG220102=SELECT IFNULL(a.subjectName, "") subjectName, IFNULL(b.assItemName, "") assItemName, IFNULL(c.summary, "") summary, IFNULL(c.vchDate, "") vchDate, IFNULL(c.currValue, 0) currValue FROM {lockDbName}.fin_accpkgsubject a LEFT JOIN {lockDbName}.fin_assitem b ON a.subjectId = b.subjectId AND a.customerId = b.customerId AND b.isLeaf1 = 1 AND a.yyyy = b.yyyy LEFT JOIN {lockDbName}.fin_assitementry c ON b.subjectId = c.subjectId AND b.yyyy = c.yyyy AND b.customerId = c.customerId AND b.assItemId = c.assItemId WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectId = '{param4}' AND a.subjectFullName = '{param5}' ORDER BY vchDate DESC
FINDG220107=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, a.dataName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
#2201-0200-\u5E94\u4ED8\u7968\u636E\u5907\u67E5\u7C3F\u660E\u7EC6\u8D26\u6838\u5BF9
FINDG220103=SELECT IFNULL(c.summary, "") summary, IFNULL(c.vchDate, "") vchDate FROM {lockDbName}.fin_accpkgsubject a LEFT JOIN {lockDbName}.fin_assitem b ON a.subjectId = b.subjectId LEFT JOIN {lockDbName}.fin_assitementry c ON b.subjectId = c.subjectId AND b.yyyy = c.yyyy AND b.customerId = c.customerId AND b.assItemId = c.assItemId WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.level1 = 2 AND b.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subjectFullName LIKE '{param5}%'
#2201-0300-\u5BF9\u903E\u671F\u672A\u4ED8\u7968\u636E\u7684\u67E5\u9A8C
FINDG220104=SELECT b.assItemName, c.vchDate FROM {lockDbName}.fin_accpkgsubject a LEFT JOIN {lockDbName}.fin_assitem b ON a.subjectId = b.subjectId LEFT JOIN {lockDbName}.fin_assitementry c ON b.subjectId = c.subjectId AND b.yyyy = c.yyyy AND b.customerId = c.customerId AND b.assItemId = c.assItemId WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.level1 = 2 AND b.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subjectFullName LIKE '{param5}%'
#2201-0400-\u5E94\u4ED8\u7968\u636E\u589E\u51CF\u6D4B\u8BD5
FINDG220105=SELECT a.vchDate, a.oldVoucherId, a.summary, a.subjectId, a.subjectFullName, SUBSTRING_INDEX( SUBSTRING_INDEX(a.subjectFullName, "/", 2), "/", -1 ) AS secondName, CASE WHEN a.direction = 1 THEN a.direction * a.occurValue ELSE "" END AS debitOcc, CASE WHEN a.direction = -1 THEN a.direction * a.occurValue ELSE "" END AS creditOcc FROM {lockDbName}.fin_subjectentry a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectId LIKE '{param4}%' AND a.month <= {param5} ORDER BY a.customerId, a.yyyy, a.vchDate, a.oldVoucherId
#2201-0500-\u5E94\u4ED8\u7968\u636E\u51FD\u8BC1
FINDG220106=SELECT b.assItemName, c.vchDate FROM {lockDbName}.fin_accpkgsubject a LEFT JOIN {lockDbName}.fin_assitem b ON a.subjectId = b.subjectId LEFT JOIN {lockDbName}.fin_assitementry c ON b.subjectId = c.subjectId AND b.yyyy = c.yyyy AND b.customerId = c.customerId AND b.assItemId = c.assItemId WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.level1 = 2 AND b.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subjectFullName LIKE '{param5}%'
#2202-0100-\u5E94\u4ED8\u8D26\u6B3E\u660E\u7EC6\u8868
FINDG220201=SELECT a.customerId, a.subjectId, a.subjectName, "" AS assItemId, "" AS assItemName, IF (a.direction < 0, '\u8D37', '\u501F') AS direction, a.currency, a.remain, SUM(a.remainF) AS remainF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.balance, SUM(a.balanceF) AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, MAX(a.hasAssItem) AS hasAssItem, 0 AS afterAmount FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.direction, a.currency, SUM(a.remain) AS remain, "" AS remainF, "" AS debitOccF, "" AS creditOccF, SUM(a.balance) AS balance, "" AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM ( SELECT a.customerId, a.subMonth, a.subjectId, a.subjectName, a.direction, a.currency, CASE WHEN a.subMonth = 01 THEN a.remain END AS remain, "" AS remainF, "" AS debitOccF, "" AS creditOccF, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, "" AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM {lockDbName}.fin_accountall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ORDER BY a.subjectId ) a GROUP BY a.customerId, a.subjectId UNION SELECT a.customerId, a.subjectId, a.subjectName, a.direction, a.currency, SUM(a.remain) AS remain, SUM(a.remain) AS remainF, SUM(a.debitOcc) AS debitOccF, SUM(a.creditOcc) AS creditOccF, SUM(a.balance) AS balance, SUM(a.balance) AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM ( SELECT a.customerId, a.subMonth, a.subjectId, a.subjectName, a.direction, CASE WHEN a.currency = 0 THEN '\u4EBA\u6C11\u5E01' ELSE a.currency END AS currency, CASE WHEN a.subMonth = 01 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ORDER BY a.subjectId ) a GROUP BY a.customerId, a.subjectId ) a GROUP BY a.customerId, a.subjectId
FINDG220202=SELECT a.customerId, a.subjectId, b.subjectName, a.yyyy, a.assItemId, a.assItemName, a.direction, a.remain, a.remainF, a.balance, a.balanceF, a.debitOccF, a.creditOccF, a.currency, a.afterAmount FROM ( SELECT a.*, IFNULL(b.occurValue, 0) AS afterAmount FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, SUM(a.remain) AS remain, SUM(a.remainF) AS remainF, SUM(a.balance) AS balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, a.remain, SUM(a.remainF) AS remainF, a.balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, SUM(a.remain) AS remain, "" AS remainF, SUM(a.balance) AS balance, "" AS balanceF, "" AS debitOccF, "" AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.subMonth, a.assItemId, a.assItemName, a.direction, CASE WHEN a.subMonth = 01 THEN a.remain END remain, "" AS remainF, CASE WHEN a.subMonth = {param5} THEN a.balance END balance, "" AS balanceF, "" AS debitOccF, "" AS creditOccF, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', CONCAT('\u5916\u5E01:', a.currency)) AS currency FROM {lockDbName}.fin_assitementryaccall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId IN ({param4}) AND a.subMonth <= {param5} ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId UNION SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, SUM(a.remain) AS remain, SUM(a.remainF) AS remainF, SUM(a.balance) AS balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOcc) AS debitOccF, SUM(a.creditOcc) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.subMonth, a.assItemId, a.assItemName, a.direction, CASE WHEN a.subMonth = 01 THEN a.remain END remain, CASE WHEN a.subMonth = 01 THEN a.remain END remainF, CASE WHEN a.subMonth = {param5} THEN a.balance END balance, CASE WHEN a.subMonth = {param5} THEN a.balance END balanceF, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', CONCAT('\u5916\u5E01:', a.currency)) AS currency FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId IN ({param4}) AND a.subMonth <= {param5} ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId ) a LEFT JOIN ( SELECT a.customerId, a.subjectId, a.assItemId, SUM(a.occurValue) AS occurValue FROM ( SELECT a.customerId, a.yyyy, a.subjectId, a.assItemId, b.voucherId, c.occurValue FROM ( SELECT a.customerId, a.yyyy, a.subjectId, a.assItemId FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId = {param1} AND a.isLeaf1 = 1 AND a.subjectId IN ({param4}) AND (( a.subMonth > {param5} AND a.yyyy = {param2} ) OR (a.yyyy > {param2})) GROUP BY a.customerId, a.subjectId, a.assItemId, a.yyyy ) a, ( SELECT a.* FROM {lockDbName}.fin_assitementry a WHERE a.customerId = {param1} AND (( RIGHT (LEFT(a.vchDate, 7), 2) > {param5} AND a.yyyy = {param2} ) OR (a.yyyy > {param2})) AND a.subjectId IN ({param4})) b, ( SELECT a.* FROM ( SELECT a.customerId, a.yyyy, a.subjectId, a.voucherId, a.oldVoucherId, a.vchDate, a.serail, CASE WHEN GROUP_CONCAT( DISTINCT a.oppositeAccountTop ) LIKE '%\u5E93\u5B58\u73B0\u91D1%' THEN 1 WHEN GROUP_CONCAT( DISTINCT a.oppositeAccountTop ) LIKE '%\u94F6\u884C\u5B58\u6B3E%' THEN 1 WHEN GROUP_CONCAT( DISTINCT a.oppositeAccountTop ) LIKE '%\u5176\u4ED6\u8D27\u5E01\u8D44\u91D1%' THEN 1 ELSE 0 END AS isTrue, a.occurValue FROM {lockDbName}.fin_subjectentry a WHERE a.customerId = {param1} AND (( MONTH > {param5} AND a.yyyy = {param2} ) OR (a.yyyy > {param2})) AND a.direction = -1 AND a.subjectId IN ({param4}) GROUP BY a.customerId, a.yyyy, a.subjectId, a.voucherId, a.serail ) a WHERE a.isTrue = 1 ) c WHERE a.customerId = {param1} AND a.customerId = b.customerId AND a.yyyy = b.yyyy AND a.subjectId = b.subjectId AND a.assItemId = b.assItemId AND b.customerId = c.customerId AND b.yyyy = c.yyyy AND b.subjectId = c.subjectId AND b.voucherId = c.voucherId AND b.oldvoucherId = c.oldVoucherId AND b.vchDate = c.vchDate AND b.serail = c.serail AND c.isTrue = 1 ) a GROUP BY a.customerId, a.subjectId, a.assItemId ) b ON a.customerId = b.customerId AND a.subjectId = b.subjectId AND a.assItemId = b.assItemId ) a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.subjectId = a.subjectId
FINDG220203=SELECT a.customerId, a.yyyy, a.assItemId AS subjectId, a.assItemName AS subjectName, a.direction, SUM(a.remain) AS remain, SUM(a.remainF) AS remainF, SUM(a.balance) AS balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.currency, a.afterAmount FROM ( SELECT a.*, IFNULL(b.occurValue, 0) AS afterAmount FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, SUM(a.remain) AS remain, SUM(a.remainF) AS remainF, SUM(a.balance) AS balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, a.remain, SUM(a.remainF) AS remainF, a.balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, SUM(a.remain) AS remain, "" AS remainF, SUM(a.balance) AS balance, "" AS balanceF, "" AS debitOccF, "" AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.subMonth, a.assItemId, a.assItemName, a.direction, CASE WHEN a.subMonth = 01 THEN a.remain END remain, "" AS remainF, CASE WHEN a.subMonth = {param5} THEN a.balance END balance, "" AS balanceF, "" AS debitOccF, "" AS creditOccF, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', CONCAT('\u5916\u5E01:', a.currency)) AS currency FROM {lockDbName}.fin_assitementryaccall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId IN ({param4}) AND a.subMonth <= {param5} ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId UNION SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, SUM(a.remain) AS remain, SUM(a.remainF) AS remainF, SUM(a.balance) AS balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOcc) AS debitOccF, SUM(a.creditOcc) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.subMonth, a.assItemId, a.assItemName, a.direction, CASE WHEN a.subMonth = 01 THEN a.remain END remain, CASE WHEN a.subMonth = 01 THEN a.remain END remainF, CASE WHEN a.subMonth = {param5} THEN a.balance END balance, CASE WHEN a.subMonth = {param5} THEN a.balance END balanceF, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', CONCAT('\u5916\u5E01:', a.currency)) AS currency FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId IN ({param4}) AND a.subMonth <= {param5} ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId ) a LEFT JOIN ( SELECT a.customerId, a.subjectId, a.assItemId, SUM(a.occurValue) AS occurValue FROM ( SELECT a.customerId, a.yyyy, a.subjectId, a.assItemId, b.voucherId, c.occurValue FROM ( SELECT a.customerId, a.yyyy, a.subjectId, a.assItemId FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId = {param1} AND a.isLeaf1 = 1 AND a.subjectId IN ({param4}) AND (( a.subMonth > {param5} AND a.yyyy = {param2} ) OR (a.yyyy > {param2})) GROUP BY a.customerId, a.subjectId, a.assItemId, a.yyyy ) a, ( SELECT a.* FROM {lockDbName}.fin_assitementry a WHERE a.customerId = {param1} AND (( RIGHT (LEFT(a.vchDate, 7), 2) > {param5} AND a.yyyy = {param2} ) OR (a.yyyy > {param2})) AND a.subjectId IN ({param4})) b, ( SELECT a.* FROM ( SELECT a.customerId, a.yyyy, a.subjectId, a.voucherId, a.oldVoucherId, a.vchDate, a.serail, CASE WHEN GROUP_CONCAT( DISTINCT a.oppositeAccountTop ) LIKE '%\u5E93\u5B58\u73B0\u91D1%' THEN 1 WHEN GROUP_CONCAT( DISTINCT a.oppositeAccountTop ) LIKE '%\u94F6\u884C\u5B58\u6B3E%' THEN 1 WHEN GROUP_CONCAT( DISTINCT a.oppositeAccountTop ) LIKE '%\u5176\u4ED6\u8D27\u5E01\u8D44\u91D1%' THEN 1 ELSE 0 END AS isTrue, a.occurValue FROM {lockDbName}.fin_subjectentry a WHERE a.customerId = {param1} AND (( MONTH > {param5} AND a.yyyy = {param2} ) OR (a.yyyy > {param2})) AND a.direction = -1 AND a.subjectId IN ({param4}) GROUP BY a.customerId, a.yyyy, a.subjectId, a.voucherId, a.serail ) a WHERE a.isTrue = 1 ) c WHERE a.customerId = {param1} AND a.customerId = b.customerId AND a.yyyy = b.yyyy AND a.subjectId = b.subjectId AND a.assItemId = b.assItemId AND b.customerId = c.customerId AND b.yyyy = c.yyyy AND b.subjectId = c.subjectId AND b.voucherId = c.voucherId AND b.oldvoucherId = c.oldVoucherId AND b.vchDate = c.vchDate AND b.serail = c.serail AND c.isTrue = 1 ) a GROUP BY a.customerId, a.subjectId, a.assItemId ) b ON a.customerId = b.customerId AND a.assItemId = b.assItemId AND a.subjectId = b.subjectId ) a GROUP BY a.customerId, a.assItemId
FINDG220204=SELECT a.customerId, a.subjectId, CONCAT('\u5C0F\u8BA1\uFF1A', a.subjectName) AS subjectName, "" AS assItemId, "" AS assItemName, IF (a.direction < 0, '\u8D37', '\u501F') AS direction, a.currency, a.remain, SUM(a.remainF) AS remainF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.balance, SUM(a.balanceF) AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, MAX(a.hasAssItem) AS hasAssItem, 0 AS afterAmount FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.direction, a.currency, SUM(a.remain) AS remain, "" AS remainF, "" AS debitOccF, "" AS creditOccF, SUM(a.balance) AS balance, "" AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM ( SELECT a.customerId, a.subMonth, a.subjectId, a.subjectName, a.direction, a.currency, CASE WHEN a.subMonth = 01 THEN a.remain END AS remain, "" AS remainF, "" AS debitOccF, "" AS creditOccF, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, "" AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM {lockDbName}.fin_accountall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND ( a.level1 = 2 OR (a.isLeaf1 = 1 AND a.level1 = 1)) AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ORDER BY a.subjectId ) a GROUP BY a.customerId, a.subjectId UNION SELECT a.customerId, a.subjectId, a.subjectName, a.direction, a.currency, SUM(a.remain) AS remain, SUM(a.remain) AS remainF, SUM(a.debitOcc) AS debitOccF, SUM(a.creditOcc) AS creditOccF, SUM(a.balance) AS balance, SUM(a.balance) AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM ( SELECT a.customerId, a.subMonth, a.subjectId, a.subjectName, a.direction, CASE WHEN a.currency = 0 THEN '\u4EBA\u6C11\u5E01' ELSE a.currency END AS currency, CASE WHEN a.subMonth = 01 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND ( a.level1 = 2 OR (a.isLeaf1 = 1 AND a.level1 = 1)) AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ORDER BY a.subjectId ) a GROUP BY a.customerId, a.subjectId ) a GROUP BY a.customerId, a.subjectId
#2202-0200-\u5E94\u4ED8\u8D26\u6B3E\u4F59\u989D\u53CA\u53D1\u751F\u989D\u5206\u6790
FINDG220205=SELECT a.tbSubjectId,a.tbSubjectName,a.auditAmount AS auditAmount,b.auditAmount AS auditAmount1,c.auditAmount AS auditAmount2,d.auditAmount AS auditAmount3 FROM (SELECT a.tbSubjectId,a.tbSubjectName,a.auditAmount FROM bdo_dg.dg_tbtable a LEFT JOIN bdo_dg.dg_projecttb b ON a.customerId=b.customerId AND a.projectId=b.projectId AND a.tbSubjectId=b.tbSubjectId LEFT JOIN bdo_dg.dg_tbsubjectcontract c ON a.customerId=c.customerId AND a.projectId=c.projectId AND a.tbSubjectId=c.tbSubjectCode WHERE a.customerId={param1} AND a.yyyy={param4} AND a.projectId={param2} AND a.tbSubjectName="{param3}" GROUP BY a.tbSubjectId,a.sortNo) a LEFT JOIN (SELECT a.tbSubjectId,a.tbSubjectName,a.auditAmount FROM bdo_dg.dg_tbtable a LEFT JOIN bdo_dg.dg_projecttb b ON a.customerId=b.customerId AND a.projectId=b.projectId AND a.tbSubjectId=b.tbSubjectId LEFT JOIN bdo_dg.dg_tbsubjectcontract c ON a.customerId=c.customerId AND a.projectId=c.projectId AND a.tbSubjectId=c.tbSubjectCode WHERE a.customerId={param1} AND a.yyyy={param5} AND a.projectId={param2} AND a.tbSubjectName="{param3}" GROUP BY a.tbSubjectId,a.sortNo) b ON a.tbSubjectId=b.tbSubjectId LEFT JOIN (SELECT a.tbSubjectId,a.tbSubjectName,a.auditAmount FROM bdo_dg.dg_tbtable a LEFT JOIN bdo_dg.dg_projecttb b ON a.customerId=b.customerId AND a.projectId=b.projectId AND a.tbSubjectId=b.tbSubjectId LEFT JOIN bdo_dg.dg_tbsubjectcontract c ON a.customerId=c.customerId AND a.projectId=c.projectId AND a.tbSubjectId=c.tbSubjectCode WHERE a.customerId={param1} AND a.yyyy={param6} AND a.projectId={param2} AND a.tbSubjectName="{param3}" GROUP BY a.tbSubjectId,a.sortNo) c ON a.tbSubjectId=c.tbSubjectId LEFT JOIN (SELECT a.tbSubjectId,a.tbSubjectName,a.auditAmount FROM bdo_dg.dg_tbtable a LEFT JOIN bdo_dg.dg_projecttb b ON a.customerId=b.customerId AND a.projectId=b.projectId AND a.tbSubjectId=b.tbSubjectId LEFT JOIN bdo_dg.dg_tbsubjectcontract c ON a.customerId=c.customerId AND a.projectId=c.projectId AND a.tbSubjectId=c.tbSubjectCode WHERE a.customerId={param1} AND a.yyyy={param7} AND a.projectId={param2} AND a.tbSubjectName="{param3}" GROUP BY a.tbSubjectId,a.sortNo) d ON a.tbSubjectId=d.tbSubjectId
#2203-0100-\u9884\u6536\u8D26\u6B3E\u660E\u7EC6\u8868
FINDG220301=SELECT a.customerId, a.subjectId, a.subjectName, a.debitRemain, SUM(a.debitRemainF) AS debitRemainF, a.creditRemain, SUM(a.creditRemainF) AS creditRemainF, a.balance, SUM(a.balanceF) AS balanceF, a.debitOcc, SUM(a.debitOccF) AS debitOccF, a.creditOcc, SUM(a.creditOccF) AS creditOccF, a.currency, a.direction, MAX(a.hasAssItem) AS hasAssItem FROM ( SELECT a.customerId, a.subjectId, a.subjectName, SUM(a.debitRemain) AS debitRemain, "" AS debitRemainF, SUM(a.creditRemain) AS creditRemain, "" AS creditRemainF, SUM(a.balance) AS balance, "" AS balanceF, SUM(a.debitOcc) AS debitOcc, "" AS debitOccF, SUM(a.creditOcc) AS creditOcc, "" AS creditOccF, a.currency, a.direction, a.hasAssItem FROM ( SELECT a.customerId, a.subjectId, a.subjectName, CASE WHEN subMonth = 01 THEN a.debitRemain END AS debitRemain, "" AS debitRemainF, CASE WHEN subMonth = 01 THEN a.creditRemain END AS creditRemain, "" AS creditRemainF, CASE WHEN subMonth = {param5} THEN a.balance END AS balance, "" AS balanceF, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, "" AS debitOccF, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, "" AS creditOccF, a.currency, a.direction, a.hasAssItem FROM {lockDbName}.fin_accountall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ORDER BY a.subjectId ) a GROUP BY a.customerId, a.subjectId UNION SELECT a.customerId, a.subjectId, a.subjectName, SUM(a.debitRemain) AS debitRemain, SUM(a.debitRemain) AS debitRemainF, SUM(a.creditRemain) AS creditRemain, SUM(a.creditRemain) AS creditRemainF, SUM(a.balance) AS balance, SUM(a.balance) AS balanceF, SUM(a.debitOcc) AS debitOcc, SUM(a.debitOcc) AS debitOccF, SUM(a.creditOcc) AS creditOcc, SUM(a.creditOcc) AS creditOccF, a.currency, a.direction, a.hasAssItem FROM ( SELECT a.customerId, a.subjectId, a.subjectName, CASE WHEN subMonth = 01 THEN a.debitRemain END AS debitRemain, CASE WHEN subMonth = 01 THEN a.creditRemain END AS creditRemain, CASE WHEN subMonth = {param5} THEN a.balance END AS balance, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, a.currency, a.direction, a.hasAssItem FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ORDER BY a.subjectId ) a GROUP BY a.customerId, a.subjectId ) a GROUP BY a.customerId, a.subjectId
FINDG220302=SELECT a.customerId, a.subjectId, b.subjectName, a.assItemId, a.assItemName, a.debitRemain, a.debitRemainF, a.creditRemain, a.creditRemainF, a.balance, a.balanceF, a.debitOcc, a.debitOccF, a.creditOcc, a.creditOccF, a.currency, a.direction FROM ( SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName, a.assItemId, a.assItemName, a.debitRemain, SUM(a.debitRemainF) AS debitRemainF, a.creditRemain, SUM(a.creditRemainF) AS creditRemainF, a.balance, SUM(a.balanceF) AS balanceF, a.debitOcc, SUM(a.debitOccF) AS debitOccF, a.creditOcc, SUM(a.creditOccF) AS creditOccF, a.currency, a.direction FROM ( SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName, a.assItemId, a.assItemName, SUM(a.debitRemain) AS debitRemain, "" AS debitRemainF, SUM(a.creditRemain) AS creditRemain, "" AS creditRemainF, SUM(a.balance) AS balance, "" AS balanceF, SUM(a.debitOcc) AS debitOcc, "" AS debitOccF, SUM(a.creditOcc) AS creditOcc, "" AS creditOccF, a.currency, a.direction FROM ( SELECT a.customerId, a.yyyy, a.subMonth, a.subjectId, a.subjectName, a.assItemId, a.assItemName, CASE WHEN subMonth = 01 THEN a.debitRemain END AS debitRemain, "" AS debitRemainF, CASE WHEN subMonth = 01 THEN a.creditRemain END AS creditRemain, "" AS creditRemainF, CASE WHEN subMonth = {param5} THEN a.balance END AS balance, "" AS balanceF, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, "" AS debitOccF, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, "" AS creditOccF, a.currency, a.direction FROM {lockDbName}.fin_assitementryaccall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId IN ({param4}) AND a.subMonth <= {param5} ) a GROUP BY a.customerId, a.subjectId, a.assItemId UNION SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName, a.assItemId, a.assItemName, SUM(a.debitRemain) AS debitRemain, SUM(a.debitRemain) AS debitRemainF, SUM(a.creditRemain) AS creditRemain, SUM(a.creditRemain) AS creditRemainF, SUM(a.balance) AS balance, SUM(a.balance) AS balanceF, SUM(a.debitOcc) AS debitOcc, SUM(a.debitOcc) AS debitOccF, SUM(a.creditOcc) AS creditOcc, SUM(a.creditOcc) AS creditOccF, a.currency, a.direction FROM ( SELECT a.customerId, a.yyyy, a.subMonth, a.subjectId, a.subjectName, a.assItemId, a.assItemName, CASE WHEN subMonth = 01 THEN a.debitRemain END AS debitRemain, CASE WHEN subMonth = 01 THEN a.creditRemain END AS creditRemain, CASE WHEN subMonth = {param5} THEN a.balance END AS balance, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, a.currency, a.direction FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId IN ({param4}) AND a.subMonth <= {param5} ) a GROUP BY a.customerId, a.subjectId, a.assItemId ) a GROUP BY a.customerId, a.subjectId, a.assItemId ) a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.subjectId = a.subjectId
FINDG220303=SELECT a.customerId, a.assItemId AS subjectId, a.assItemName AS subjectName, a.debitRemain, SUM(a.debitRemainF) AS debitRemainF, a.creditRemain, SUM(a.creditRemainF) AS creditRemainF, a.balance, SUM(a.balanceF) AS balanceF, a.debitOcc, SUM(a.debitOccF) AS debitOccF, a.creditOcc, SUM(a.creditOccF) AS creditOccF, a.currency, a.direction FROM ( SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName, a.assItemId, a.assItemName, SUM(a.debitRemain) AS debitRemain, "" AS debitRemainF, SUM(a.creditRemain) AS creditRemain, "" AS creditRemainF, SUM(a.balance) AS balance, "" AS balanceF, SUM(a.debitOcc) AS debitOcc, "" AS debitOccF, SUM(a.creditOcc) AS creditOcc, "" AS creditOccF, a.currency, a.direction FROM ( SELECT a.customerId, a.yyyy, a.subMonth, a.subjectId, a.subjectName, a.assItemId, a.assItemName, CASE WHEN subMonth = 01 THEN a.debitRemain END AS debitRemain, "" AS debitRemainF, CASE WHEN subMonth = 01 THEN a.creditRemain END AS creditRemain, "" AS creditRemainF, CASE WHEN subMonth = {param5} THEN a.balance END AS balance, "" AS balanceF, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, "" AS debitOccF, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, "" AS creditOccF, a.currency, a.direction FROM {lockDbName}.fin_assitementryaccall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId IN ({param4}) AND a.subMonth <= {param5} ) a GROUP BY a.customerId, a.subjectId, a.assItemId UNION SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName, a.assItemId, a.assItemName, SUM(a.debitRemain) AS debitRemain, SUM(a.debitRemain) AS debitRemainF, SUM(a.creditRemain) AS creditRemain, SUM(a.creditRemain) AS creditRemainF, SUM(a.balance) AS balance, SUM(a.balance) AS balanceF, SUM(a.debitOcc) AS debitOcc, SUM(a.debitOcc) AS debitOccF, SUM(a.creditOcc) AS creditOcc, SUM(a.creditOcc) AS creditOccF, a.currency, a.direction FROM ( SELECT a.customerId, a.yyyy, a.subMonth, a.subjectId, a.subjectName, a.assItemId, a.assItemName, CASE WHEN subMonth = 01 THEN a.debitRemain END AS debitRemain, CASE WHEN subMonth = 01 THEN a.creditRemain END AS creditRemain, CASE WHEN subMonth = {param5} THEN a.balance END AS balance, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, a.currency, a.direction FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId IN ({param4}) AND a.subMonth <= {param5} ) a GROUP BY a.customerId, a.subjectId, a.assItemId ) a GROUP BY a.customerId, a.assItemId
FINDG220304=SELECT a.customerId, a.subjectId, CONCAT('\u5C0F\u8BA1\uFF1A', a.subjectName) AS subjectName, a.debitRemain, SUM(a.debitRemainF) AS debitRemainF, a.creditRemain, SUM(a.creditRemainF) AS creditRemainF, a.balance, SUM(a.balanceF) AS balanceF, a.debitOcc, SUM(a.debitOccF) AS debitOccF, a.creditOcc, SUM(a.creditOccF) AS creditOccF, a.currency, a.direction, MAX(a.hasAssItem) AS hasAssItem FROM ( SELECT a.customerId, a.subjectId, a.subjectName, SUM(a.debitRemain) AS debitRemain, "" AS debitRemainF, SUM(a.creditRemain) AS creditRemain, "" AS creditRemainF, SUM(a.balance) AS balance, "" AS balanceF, SUM(a.debitOcc) AS debitOcc, "" AS debitOccF, SUM(a.creditOcc) AS creditOcc, "" AS creditOccF, a.currency, a.direction, a.hasAssItem FROM ( SELECT a.customerId, a.subjectId, a.subjectName, CASE WHEN subMonth = 01 THEN a.debitRemain END AS debitRemain, "" AS debitRemainF, CASE WHEN subMonth = 01 THEN a.creditRemain END AS creditRemain, "" AS creditRemainF, CASE WHEN subMonth = {param5} THEN a.balance END AS balance, "" AS balanceF, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, "" AS debitOccF, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, "" AS creditOccF, a.currency, a.direction, a.hasAssItem FROM {lockDbName}.fin_accountall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND ( a.level1 = 2 OR (a.isLeaf1 = 1 AND a.level1 = 1)) AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ORDER BY a.subjectId ) a GROUP BY a.customerId, a.subjectId UNION SELECT a.customerId, a.subjectId, a.subjectName, SUM(a.debitRemain) AS debitRemain, SUM(a.debitRemain) AS debitRemainF, SUM(a.creditRemain) AS creditRemain, SUM(a.creditRemain) AS creditRemainF, SUM(a.balance) AS balance, SUM(a.balance) AS balanceF, SUM(a.debitOcc) AS debitOcc, SUM(a.debitOcc) AS debitOccF, SUM(a.creditOcc) AS creditOcc, SUM(a.creditOcc) AS creditOccF, a.currency, a.direction, a.hasAssItem FROM ( SELECT a.customerId, a.subjectId, a.subjectName, CASE WHEN subMonth = 01 THEN a.debitRemain END AS debitRemain, CASE WHEN subMonth = 01 THEN a.creditRemain END AS creditRemain, CASE WHEN subMonth = {param5} THEN a.balance END AS balance, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, a.currency, a.direction, a.hasAssItem FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND ( a.level1 = 2 OR (a.isLeaf1 = 1 AND a.level1 = 1)) AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ORDER BY a.subjectId ) a GROUP BY a.customerId, a.subjectId ) a GROUP BY a.customerId, a.subjectId
#2203-0200-\u9884\u6536\u8D26\u6B3E\u4F59\u989D\u5206\u6790
FINDG220306=SELECT subjectId, CONCAT(subjectName, '\u4F59\u989D') AS subjectName, balance, IFNULL(( SELECT balance FROM {lockDbName}.fin_account WHERE customerId = {param1} AND yyyy = {param2} -1 AND subMonth = 12 AND subjectId = a.subjectId ), 0 ) AS lastBalance, IFNULL(( SELECT balance FROM {lockDbName}.fin_account WHERE customerId = {param1} AND yyyy = {param2} - 2 AND subMonth = 12 AND subjectId = a.subjectId ), 0 ) AS lastTwoBalance FROM {lockDbName}.fin_account a WHERE customerId = {param1} AND yyyy = {param2} AND subMonth = 12 AND subjectId IN ({param5})
#2203-0300-\u8D26\u9F841\u5E74\u4EE5\u4E0A\u7684\u9884\u6536\u8D26\u6B3E\u67E5\u9A8C
FINDG220307=SELECT a.assItemId, a.assItemName, a.balance FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth=12 AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%'
#2211-0100-\u5E94\u4ED8\u804C\u5DE5\u85AA\u916C\u660E\u7EC6\u8868
FINDG221101=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, a.dataName, "" AS assItemId, "" AS assItemName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
#2215-0100-\u957F\u671F\u5E94\u4ED8\u804C\u5DE5\u85AA\u916C\u660E\u7EC6\u8868
FINDG221501=SELECT a.* FROM ( SELECT a.customerId, a.subjectId, a.subjectName, "" AS assItemId, "" AS assItemName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, a.balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth = {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
#2221-0100-\u5E94\u4EA4\u7A0E\u8D39\u660E\u7EC6\u8868
FINDG222101=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, a.dataName, "" AS assItemId, "" AS assItemName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
#2221-0200-\u7EB3\u7A0E\u7533\u62A5\u8868\u6838\u5BF9
FINDG222102=SELECT a.subjectName AS accName, IFNULL(SUM(a.debitOcc1), 0) AS debitOcc1, IFNULL(SUM(a.debitOcc2), 0) AS debitOcc2, IFNULL(SUM(a.debitOcc3), 0) AS debitOcc3, IFNULL(SUM(a.debitOcc4), 0) AS debitOcc4, IFNULL(SUM(a.debitOcc5), 0) AS debitOcc5, IFNULL(SUM(a.debitOcc6), 0) AS debitOcc6, IFNULL(SUM(a.debitOcc7), 0) AS debitOcc7, IFNULL(SUM(a.debitOcc8), 0) AS debitOcc8, IFNULL(SUM(a.debitOcc9), 0) AS debitOcc9, IFNULL(SUM(a.debitOcc10), 0) AS debitOcc10, IFNULL(SUM(a.debitOcc11), 0) AS debitOcc11, IFNULL(SUM(a.debitOcc12), 0) AS debitOcc12, IFNULL(SUM(a.creditOcc1), 0) AS creditOcc1, IFNULL(SUM(a.creditOcc2), 0) AS creditOcc2, IFNULL(SUM(a.creditOcc3), 0) AS creditOcc3, IFNULL(SUM(a.creditOcc4), 0) AS creditOcc4, IFNULL(SUM(a.creditOcc5), 0) AS creditOcc5, IFNULL(SUM(a.creditOcc6), 0) AS creditOcc6, IFNULL(SUM(a.creditOcc7), 0) AS creditOcc7, IFNULL(SUM(a.creditOcc8), 0) AS creditOcc8, IFNULL(SUM(a.creditOcc9), 0) AS creditOcc9, IFNULL(SUM(a.creditOcc10), 0) AS creditOcc10, IFNULL(SUM(a.creditOcc11), 0) AS creditOcc11, IFNULL(SUM(a.creditOcc12), 0) AS creditOcc12 FROM ( SELECT a.subjectName, CASE WHEN a.subMonth = 1 THEN a.debitOcc END AS debitOcc1, CASE WHEN a.subMonth = 2 THEN a.debitOcc END AS debitOcc2, CASE WHEN a.subMonth = 3 THEN a.debitOcc END AS debitOcc3, CASE WHEN a.subMonth = 4 THEN a.debitOcc END AS debitOcc4, CASE WHEN a.subMonth = 5 THEN a.debitOcc END AS debitOcc5, CASE WHEN a.subMonth = 6 THEN a.debitOcc END AS debitOcc6, CASE WHEN a.subMonth = 7 THEN a.debitOcc END AS debitOcc7, CASE WHEN a.subMonth = 8 THEN a.debitOcc END AS debitOcc8, CASE WHEN a.subMonth = 9 THEN a.debitOcc END AS debitOcc9, CASE WHEN a.subMonth = 10 THEN a.debitOcc END AS debitOcc10, CASE WHEN a.subMonth = 11 THEN a.debitOcc END AS debitOcc11, CASE WHEN a.subMonth = 12 THEN a.debitOcc END AS debitOcc12, CASE WHEN a.subMonth = 1 THEN a.creditOcc END AS creditOcc1, CASE WHEN a.subMonth = 2 THEN a.creditOcc END AS creditOcc2, CASE WHEN a.subMonth = 3 THEN a.creditOcc END AS creditOcc3, CASE WHEN a.subMonth = 4 THEN a.creditOcc END AS creditOcc4, CASE WHEN a.subMonth = 5 THEN a.creditOcc END AS creditOcc5, CASE WHEN a.subMonth = 6 THEN a.creditOcc END AS creditOcc6, CASE WHEN a.subMonth = 7 THEN a.creditOcc END AS creditOcc7, CASE WHEN a.subMonth = 8 THEN a.creditOcc END AS creditOcc8, CASE WHEN a.subMonth = 9 THEN a.creditOcc END AS creditOcc9, CASE WHEN a.subMonth = 10 THEN a.creditOcc END AS creditOcc10, CASE WHEN a.subMonth = 11 THEN a.creditOcc END AS creditOcc11, CASE WHEN a.subMonth = 12 THEN a.creditOcc END AS creditOcc12 FROM {lockDbName}.fin_account a WHERE customerId = {param1} AND yyyy = {param2} AND a.subjectId = '{param4}' AND subMonth <= {param5} ) a GROUP BY a.subjectName
#2221-0300-\u589E\u503C\u7A0E\u660E\u7EC6\u8868
FINDG222103=SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName, a.direction, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.isLeaf1, a.level1, a.subjectFullName FROM ( SELECT a.customerId, a.yyyy, a.subMonth, a.subjectId, a.subjectName, a.direction, CASE WHEN a.subMonth = 1 THEN a.remain ELSE NULL END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance ELSE NULL END AS balance, a.isLeaf1, a.level1, a.subjectFullName FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ) a GROUP BY a.customerId, a.yyyy, a.subjectId
#2231-0100-\u5E94\u4ED8\u5229\u606F\u660E\u7EC6\u8868
FINDG223101=SELECT a.subjectId, a.subjectName, a.subjectFullName, a.remain, SUM(a.remainF) AS remainF, a.balance, SUM(a.balanceF) AS balanceF, SUM(a.creditOccF) AS creditOccF, SUM(a.debitOccF) AS debitOccF, a.direction, a.isLeaf1, a.level1, a.currency FROM ( SELECT a.subjectId, a.subjectName, a.subjectFullName, SUM(a.remain) AS remain, "" AS remainF, SUM(a.balance) AS balance, "" AS balanceF, "" AS creditOccF, "" AS debitOccF, a.direction, a.isLeaf1, a.level1, a.currency FROM ( SELECT a.subjectId, a.subjectName AS subjectName, a.subjectFullName AS subjectFullName, CASE WHEN subMonth = 01 THEN a.remain END AS remain, "" AS remainF, CASE WHEN subMonth = {param5} THEN a.balance END AS balance, "" AS balanceF, "" AS debitOccF, "" AS creditOccF, a.direction, a.isLeaf1, a.level1, IF ( a.currency = '0', "", a.currency ) AS currency FROM {lockDbName}.fin_accountall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.level1 = {param6} AND a.subjectId LIKE '{param4}%' AND a.submonth <= {param5} ) a GROUP BY a.subjectId UNION SELECT a.subjectId, a.subjectName, a.subjectFullName, SUM(a.remain) AS remain, SUM(a.remainF) AS remainF, SUM(a.balance) AS balance, SUM(a.balanceF) AS balanceF, SUM(a.creditOccF) AS creditOccF, SUM(a.debitOccF) AS debitOccF, a.direction, a.isLeaf1, a.level1, a.currency FROM ( SELECT a.subjectId, a.subjectName AS subjectName, a.subjectFullName AS subjectFullName, CASE WHEN subMonth = 01 THEN a.remain END AS remain, CASE WHEN subMonth = 01 THEN a.remain END AS remainF, CASE WHEN subMonth = {param5} THEN a.balance END AS balance, CASE WHEN subMonth = {param5} THEN a.balance END AS balanceF, CASE WHEN subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END END AS debitOccF, CASE WHEN subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END END AS creditOccF, a.direction, a.isLeaf1, a.level1, IF ( a.currency = '0', "", a.currency ) AS currency FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.level1 = {param6} AND a.subjectId LIKE '{param4}%' AND a.submonth <= {param5} ) a GROUP BY a.subjectId ) a GROUP BY a.subjectId
FINDG223102=SELECT a.subjectId, a.subjectName, a.subjectFullName, a.remain, SUM(a.remainF) AS remainF, a.balance, SUM(a.balanceF) AS balanceF, SUM(a.creditOccF) AS creditOccF, SUM(a.debitOccF) AS debitOccF, a.direction, a.isLeaf1, a.level1, a.currency FROM ( SELECT a.subjectId, a.subjectName, a.subjectFullName, SUM(a.remain) AS remain, "" AS remainF, SUM(a.balance) AS balance, "" AS balanceF, "" AS creditOccF, "" AS debitOccF, a.direction, a.isLeaf1, a.level1, a.currency FROM ( SELECT a.subjectId, a.subjectName AS subjectName, a.subjectFullName AS subjectFullName, CASE WHEN subMonth = 01 THEN a.remain END AS remain, "" AS remainF, CASE WHEN subMonth = {param5} THEN a.balance END AS balance, "" AS balanceF, "" AS debitOccF, "" AS creditOccF, a.direction, a.isLeaf1, a.level1, IF ( a.currency = '0', "", a.currency ) AS currency FROM {lockDbName}.fin_accountall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.submonth <= {param5} ) a GROUP BY a.subjectId UNION SELECT a.subjectId, a.subjectName, a.subjectFullName, SUM(a.remain) AS remain, SUM(a.remainF) AS remainF, SUM(a.balance) AS balance, SUM(a.balanceF) AS balanceF, SUM(a.creditOccF) AS creditOccF, SUM(a.debitOccF) AS debitOccF, a.direction, a.isLeaf1, a.level1, a.currency FROM ( SELECT a.subjectId, a.subjectName AS subjectName, a.subjectFullName AS subjectFullName, CASE WHEN subMonth = 01 THEN a.remain END AS remain, CASE WHEN subMonth = 01 THEN a.remain END AS remainF, CASE WHEN subMonth = {param5} THEN a.balance END AS balance, CASE WHEN subMonth = {param5} THEN a.balance END AS balanceF, CASE WHEN subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END END AS debitOccF, CASE WHEN subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END END AS creditOccF, a.direction, a.isLeaf1, a.level1, IF ( a.currency = '0', "", a.currency ) AS currency FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.submonth <= {param5} ) a GROUP BY a.subjectId ) a GROUP BY a.subjectId
FINDG223103=SELECT a.customerId, a.subjectId, a.assItemId, a.assItemName, a.yyyy, a.remain, SUM(a.remainF) AS remainF, a.balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.direction, a.currency FROM ( SELECT a.customerId, a.subjectId, a.assItemId, a.assItemName, a.yyyy, SUM(a.remain) AS remain, "" AS remainF, SUM(a.balance) AS balance, "" AS balanceF, "" AS debitOccF, "" AS creditOccF, a.direction, a.currency FROM ( SELECT a.customerId, a.subjectId, a.assItemId, a.assItemName, a.yyyy, CASE WHEN a.subMonth = 01 THEN a.remain END AS remain, "" AS remainF, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, "" AS balanceF, "" AS debitOccF, "" AS creditOccF, a.direction, IF ( a.currency = '0', "", a.currency ) AS currency FROM {lockDbName}.fin_assitementryaccall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ) a GROUP BY a.customerId, a.subjectId, a.assItemId UNION SELECT a.customerId, a.subjectId, a.assItemId, a.assItemName, a.yyyy, SUM(a.remain) AS remain, SUM(a.remainF) AS remainF, SUM(a.balance) AS balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, a.direction, a.currency FROM ( SELECT a.customerId, a.subjectId, a.assItemId, a.assItemName, a.yyyy, CASE WHEN a.subMonth = 01 THEN a.remain END AS remain, CASE WHEN a.subMonth = 01 THEN a.remain END AS remainF, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balanceF, CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END END AS debitOcc, CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END END AS creditOcc, a.direction, IF ( a.currency = '0', "", a.currency ) AS currency FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ) a GROUP BY a.customerId, a.subjectId, a.assItemId ) a GROUP BY a.customerId, a.subjectId, a.assItemId
#2232-0100-\u5E94\u4ED8\u80A1\u660E\u7EC6\u8868
FINDG223201=SELECT a.customerId,a.subjectId,a.subjectName,a.subjectFullName,"" AS assItemId,"" AS assItemName,a.remain,a.balance,SUM(IFNULL(a.creditOccF,0)) AS creditOccF,SUM(IFNULL(a.debitOccF,0)) AS debitOccF,SUM(IFNULL(a.creditOccFNext,0)) AS creditOccFNext,a.hasAssItem FROM (SELECT a.customerId,a.subjectId,a.subjectName,a.subjectFullName,SUM(a.remain) AS remain,SUM(a.balance) AS balance,"" AS creditOccF,"" AS debitOccF,"" AS creditOccFNext,MAX(a.hasAssItem) AS hasAssItem FROM (SELECT a.customerId,a.subjectId,a.subjectName AS subjectName,a.subjectFullName AS subjectFullName,CASE WHEN a.subMonth=01 THEN a.remain END AS remain,CASE WHEN a.subMonth={param5} THEN a.balance END AS balance,"" AS debitOccF,"" AS creditOccF,"" AS creditOccFNext,a.hasAssItem FROM {lockDbName}.fin_accountall a WHERE a.customerId={param1} AND a.yyyy={param2} AND a.isLeaf1=1 AND a.subjectId LIKE '{param4}%' AND a.submonth<={param5}) a GROUP BY a.subjectId UNION SELECT a.customerId,a.subjectId,a.subjectName,a.subjectFullName,MAX(a.remain) AS remain,MAX(a.balance) AS balance,SUM(a.creditOccF) AS creditOccF,SUM(a.debitOccF) AS debitOccF,SUM(IFNULL(a.creditOccFNext,0)) AS creditOccFNext,a.hasAssItem FROM (SELECT a.customerId,a.subjectId,a.subjectName AS subjectName,a.subjectFullName AS subjectFullName,CASE WHEN a.subMonth=01 THEN a.remain END AS remain,CASE WHEN a.subMonth={param5} THEN a.balance END AS balance,CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction< 0 THEN a.creditOcc ELSE a.debitOcc END END AS debitOccF,CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction< 0 THEN a.debitOcc ELSE a.creditOcc END END AS creditOccF,CASE WHEN b.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN b.direction< 0 THEN b.debitOcc ELSE b.creditOcc END END AS creditOccFNext,a.hasAssItem FROM {lockDbName}.fin_account a LEFT JOIN {lockDbName}.fin_account b ON a.customerId=b.customerId AND b.yyyy={param6} AND a.isLeaf1=b.isLeaf1 AND a.subjectId=b.subjectId AND a.subMonth=b.subMonth WHERE a.customerId={param1} AND a.yyyy={param2} AND a.isLeaf1=1 AND a.subjectId LIKE '{param4}%' AND a.submonth<={param5}) a GROUP BY a.subjectId) a GROUP BY a.subjectId
FINDG223202=SELECT a.customerId,a.subjectId,a.subjectName,a.subjectFullName,a.assItemId,a.assItemName,a.yyyy,a.remain,a.balance,SUM(IFNULL(a.debitOccF,0)) AS debitOccF,SUM(IFNULL(a.creditOccF,0)) AS creditOccF,SUM(IFNULL(a.creditOccFNext,0)) AS creditOccFNext FROM (SELECT a.customerId,a.subjectId,a.subjectName,a.subjectFullName,a.assItemId,a.assItemName,a.yyyy,SUM(a.remain) AS remain,SUM(a.balance) AS balance,"" AS debitOccF,"" AS creditOccF,"" AS creditOccFNext FROM (SELECT a.customerId,a.subjectId,a.subjectName,a.subjectFullName,a.assItemId,a.assItemName,a.yyyy,CASE WHEN a.subMonth=01 THEN a.remain END AS remain,CASE WHEN a.subMonth={param5} THEN a.balance END AS balance,"" AS debitOccF,"" AS creditOccF,"" AS creditOccFNext FROM {lockDbName}.fin_assitementryaccall a WHERE a.customerId={param1} AND a.yyyy={param2} AND a.isLeaf1=1 AND a.subjectId IN ({param4}) AND a.subMonth<={param5}) a GROUP BY a.customerId,a.subjectId,a.assItemId UNION SELECT a.customerId,a.subjectId,a.subjectName,a.subjectFullName,a.assItemId,a.assItemName,a.yyyy,SUM(a.remain) AS remain,SUM(a.balance) AS balance,SUM(a.debitOccF) AS debitOccF,SUM(a.creditOccF) AS creditOccF,SUM(IFNULL(a.creditOccFNext,0)) AS creditOccFNext FROM (SELECT a.customerId,a.subjectId,a.subjectName,a.subjectFullName,a.assItemId,a.assItemName,a.yyyy,CASE WHEN a.subMonth=01 THEN a.remain END AS remain,CASE WHEN a.subMonth={param5} THEN a.balance END AS balance,CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction< 0 THEN a.creditOcc ELSE a.debitOcc END END AS debitOccF,CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction< 0 THEN a.debitOcc ELSE a.creditOcc END END AS creditOccF,CASE WHEN b.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN b.direction< 0 THEN b.debitOcc ELSE b.creditOcc END END AS creditOccFNext FROM {lockDbName}.fin_assitementryacc a LEFT JOIN {lockDbName}.fin_assitementryacc b ON a.customerId=b.customerId AND b.yyyy={param6} AND a.isLeaf1=b.isLeaf1 AND a.subjectId=b.subjectId AND a.subMonth=b.subMonth AND a.assItemId = b.assItemId WHERE a.customerId={param1} AND a.yyyy={param2} AND a.isLeaf1=1 AND a.subjectId IN ({param4}) AND a.subMonth<={param5}) a GROUP BY a.customerId,a.subjectId,a.assItemId) a GROUP BY a.customerId,a.subjectId,a.assItemId
#2241-0100-\u5176\u4ED6\u5E94\u4ED8\u6B3E\u660E\u7EC6\u8868
FINDG224101=SELECT a.customerId, a.subjectId, a.subjectName, "" AS assItemId, "" AS assItemName, IF (a.direction < 0, '\u8D37', '\u501F') AS direction, a.currency, a.remain, SUM(a.remainF) AS remainF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.balance, SUM(a.balanceF) AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, MAX(a.hasAssItem) AS hasAssItem, 0 AS afterAmount FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.direction, a.currency, SUM(a.remain) AS remain, "" AS remainF, "" AS debitOccF, "" AS creditOccF, SUM(a.balance) AS balance, "" AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM ( SELECT a.customerId, a.subMonth, a.subjectId, a.subjectName, a.direction, a.currency, CASE WHEN a.subMonth = 01 THEN a.remain END AS remain, "" AS remainF, "" AS debitOccF, "" AS creditOccF, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, "" AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM {lockDbName}.fin_accountall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ORDER BY a.subjectId ) a GROUP BY a.customerId, a.subjectId UNION SELECT a.customerId, a.subjectId, a.subjectName, a.direction, a.currency, SUM(a.remain) AS remain, SUM(a.remain) AS remainF, SUM(a.debitOcc) AS debitOccF, SUM(a.creditOcc) AS creditOccF, SUM(a.balance) AS balance, SUM(a.balance) AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM ( SELECT a.customerId, a.subMonth, a.subjectId, a.subjectName, a.direction, CASE WHEN a.currency = 0 THEN '\u4EBA\u6C11\u5E01' ELSE a.currency END AS currency, CASE WHEN a.subMonth = 01 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ORDER BY a.subjectId ) a GROUP BY a.customerId, a.subjectId ) a GROUP BY a.customerId, a.subjectId
FINDG224102=SELECT a.customerId, a.subjectId, b.subjectName, a.yyyy, a.assItemId, a.assItemName, a.direction, a.remain, a.remainF, a.balance, a.balanceF, a.debitOccF, a.creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, SUM(a.remain) AS remain, SUM(a.remainF) AS remainF, SUM(a.balance) AS balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, a.remain, SUM(a.remainF) AS remainF, a.balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, SUM(a.remain) AS remain, "" AS remainF, SUM(a.balance) AS balance, "" AS balanceF, "" AS debitOccF, "" AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.subMonth, a.assItemId, a.assItemName, a.direction, CASE WHEN a.subMonth = 01 THEN a.remain END remain, "" AS remainF, CASE WHEN a.subMonth = {param5} THEN a.balance END balance, "" AS balanceF, "" AS debitOccF, "" AS creditOccF, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', CONCAT('\u5916\u5E01:', a.currency)) AS currency FROM {lockDbName}.fin_assitementryaccall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId IN ({param4}) AND a.subMonth <= {param5} ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId UNION SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, SUM(a.remain) AS remain, SUM(a.remainF) AS remainF, SUM(a.balance) AS balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOcc) AS debitOccF, SUM(a.creditOcc) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.subMonth, a.assItemId, a.assItemName, a.direction, CASE WHEN a.subMonth = 01 THEN a.remain END remain, CASE WHEN a.subMonth = 01 THEN a.remain END remainF, CASE WHEN a.subMonth = {param5} THEN a.balance END balance, CASE WHEN a.subMonth = {param5} THEN a.balance END balanceF, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', CONCAT('\u5916\u5E01:', a.currency)) AS currency FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId IN ({param4}) AND a.subMonth <= {param5} ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId ) a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.subjectId = a.subjectId
FINDG224103=SELECT a.customerId, a.yyyy, a.assItemId AS subjectId, a.assItemName AS subjectName, a.direction, SUM(a.remain) AS remain, SUM(a.remainF) AS remainF, SUM(a.balance) AS balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, SUM(a.remain) AS remain, SUM(a.remainF) AS remainF, SUM(a.balance) AS balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, a.remain, SUM(a.remainF) AS remainF, a.balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, SUM(a.remain) AS remain, "" AS remainF, SUM(a.balance) AS balance, "" AS balanceF, "" AS debitOccF, "" AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.subMonth, a.assItemId, a.assItemName, a.direction, CASE WHEN a.subMonth = 01 THEN a.remain END remain, "" AS remainF, CASE WHEN a.subMonth = {param5} THEN a.balance END balance, "" AS balanceF, "" AS debitOccF, "" AS creditOccF, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', CONCAT('\u5916\u5E01:', a.currency)) AS currency FROM {lockDbName}.fin_assitementryaccall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId IN ({param4}) AND a.subMonth <= {param5} ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId UNION SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, SUM(a.remain) AS remain, SUM(a.remainF) AS remainF, SUM(a.balance) AS balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOcc) AS debitOccF, SUM(a.creditOcc) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.subMonth, a.assItemId, a.assItemName, a.direction, CASE WHEN a.subMonth = 01 THEN a.remain END remain, CASE WHEN a.subMonth = 01 THEN a.remain END remainF, CASE WHEN a.subMonth = {param5} THEN a.balance END balance, CASE WHEN a.subMonth = {param5} THEN a.balance END balanceF, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', CONCAT('\u5916\u5E01:', a.currency)) AS currency FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId IN ({param4}) AND a.subMonth <= {param5} ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId ) a GROUP BY a.customerId, a.assItemId
FINDG224104=SELECT a.customerId, a.subjectId, CONCAT('\u5C0F\u8BA1\uFF1A', a.subjectName) AS subjectName, "" AS assItemId, "" AS assItemName, IF (a.direction < 0, '\u8D37', '\u501F') AS direction, a.currency, a.remain, SUM(a.remainF) AS remainF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.balance, SUM(a.balanceF) AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, MAX(a.hasAssItem) AS hasAssItem, 0 AS afterAmount FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.direction, a.currency, SUM(a.remain) AS remain, "" AS remainF, "" AS debitOccF, "" AS creditOccF, SUM(a.balance) AS balance, "" AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM ( SELECT a.customerId, a.subMonth, a.subjectId, a.subjectName, a.direction, a.currency, CASE WHEN a.subMonth = 01 THEN a.remain END AS remain, "" AS remainF, "" AS debitOccF, "" AS creditOccF, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, "" AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM {lockDbName}.fin_accountall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND ( a.level1 = 2 OR (a.isLeaf1 = 1 AND a.level1 = 1)) AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ORDER BY a.subjectId ) a GROUP BY a.customerId, a.subjectId UNION SELECT a.customerId, a.subjectId, a.subjectName, a.direction, a.currency, SUM(a.remain) AS remain, SUM(a.remain) AS remainF, SUM(a.debitOcc) AS debitOccF, SUM(a.creditOcc) AS creditOccF, SUM(a.balance) AS balance, SUM(a.balance) AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM ( SELECT a.customerId, a.subMonth, a.subjectId, a.subjectName, a.direction, CASE WHEN a.currency = 0 THEN '\u4EBA\u6C11\u5E01' ELSE a.currency END AS currency, CASE WHEN a.subMonth = 01 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND ( a.level1 = 2 OR (a.isLeaf1 = 1 AND a.level1 = 1)) AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ORDER BY a.subjectId ) a GROUP BY a.customerId, a.subjectId ) a GROUP BY a.customerId, a.subjectId
#2241-0200-\u671F\u540E\u4ED8\u6B3E\u67E5\u9A8C\uFF08\u91CD\u8981\u548C\u5927\u989D\uFF09
FINDG224105=SELECT a.subjectId, a.subjectName, a.assItemId, a.assItemName, a.remain, SUM(a.debitBalance) AS debitBalance, SUM(a.creditBalance) AS creditBalance FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.yyyy, a.subMonth, a.assItemId, a.assItemName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, a.debitBalance AS debitBalance, a.c reditBalance AS creditBalance FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 AND a.subMonth <= {param5} ) a GROUP BY a.subjectId, a.assItemId
#2401-0100-\u9012\u5EF6\u6536\u76CA\u660E\u7EC6\u8868
FINDG240101=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, a.dataName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
#2402-0100-\u4E00\u5E74\u5185\u5230\u671F\u7684\u975E\u6D41\u52A8\u8D1F\u503A
FINDG240201=SELECT a.subjectId, a.subjectFullName, "" AS assItemId, "" AS assItemName, MAX(a.remain) AS remain, SUM(a.debitOcc) AS debitTotalOcc, SUM(a.creditOcc) AS creditTotalOcc FROM ( SELECT a.subjectId, IFNULL(a.subjectFullName, 0) AS subjectFullName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, IFNULL(CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END, 0) AS debitOcc, IFNULL(CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END, 0) AS creditOcc FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} AND a.isLeaf1 = 1) a GROUP BY a.subjectId, a.subjectFullName
#2404-0100-\u5176\u4ED6\u6D41\u52A8\u8D1F\u503A
FINDG240401=SELECT a.customerId, a.subjectId, a.subjectName, "" AS assItemId, "" AS assItemName, a.direction, a.currency, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.isLeaf1, a.level1, a.subjectFullName, MAX(a.hasAssItem) AS hasAssItem FROM ( SELECT a.customerId, a.subMonth, a.subjectId, a.subjectName, a.direction, CASE WHEN a.currency = 0 THEN '\u4EBA\u6C11\u5E01' ELSE a.currency END AS currency, CASE WHEN a.subMonth = 01 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ORDER BY a.subjectId ) a GROUP BY a.customerId, a.subjectId
FINDG240402=SELECT a.customerId, a.subjectId, b.subjectName, a.assItemId, a.assItemName, a.currency, a.remain, a.debitOcc, a.creditOcc, a.balance FROM ( SELECT a.customerId, a.yyyy, a.subjectId, a.assItemId, a.assItemName, a.currency, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance FROM ( SELECT a.customerId, a.yyyy, a.subMonth, a.subjectId, a.assItemId, a.assItemName, CASE WHEN a.currency = 0 THEN '\u4EBA\u6C11\u5E01' ELSE a.currency END AS currency, CASE WHEN a.subMonth = 01 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ORDER BY a.subjectId ) a GROUP BY a.customerId, a.subjectId, a.assItemId ) a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.subjectId = a.subjectId
FINDG240403=SELECT a.customerId, a.subjectId, b.subjectName, a.assItemId, a.assItemName, a.currency, a.remain, a.debitOcc, a.creditOcc, a.balance FROM ( SELECT a.customerId, a.yyyy, a.subjectId, a.assItemId, a.assItemName, a.currency, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance FROM ( SELECT a.customerId, a.yyyy, a.subMonth, a.subjectId, a.assItemId, a.assItemName, CASE WHEN a.currency = 0 THEN '\u4EBA\u6C11\u5E01' ELSE a.currency END AS currency, CASE WHEN a.subMonth = 01 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ORDER BY a.subjectId ) a GROUP BY a.customerId, a.assItemId ) a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.subjectId = a.subjectId
#2499-0100-\u5176\u4ED6\u8D1F\u503A(\u62A5\u8868\u65E0\u6B64\u9879\u76EE)
FINDG249901=SELECT a.subjectId, a.subjectFullName, "" AS assItemId, "" AS assItemName, MAX(a.remain) AS remain, SUM(a.debitOcc) AS debitTotalOcc, SUM(a.creditOcc) AS creditTotalOcc FROM ( SELECT a.subjectId, IFNULL(a.subjectFullName, 0) AS subjectFullName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, IFNULL(CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END, 0) AS debitOcc, IFNULL(CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END, 0) AS creditOcc FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} AND a.isLeaf1 = 1 ) a GROUP BY a.subjectId, a.subjectFullName
#2501-0100-\u957F\u671F\u501F\u6B3E\u660E\u7EC6\u8868
FINDG250101=SELECT a.customerId, a.subjectId, a.subjectName, "" AS assItemId, "" AS assItemName, IF (a.direction < 0, '\u8D37', '\u501F') AS direction, a.currency, a.remain, SUM(a.remainF) AS remainF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.balance, SUM(a.balanceF) AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, MAX(a.hasAssItem) AS hasAssItem, 0 AS afterAmount FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.direction, a.currency, SUM(a.remain) AS remain, "" AS remainF, "" AS debitOccF, "" AS creditOccF, SUM(a.balance) AS balance, "" AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM ( SELECT a.customerId, a.subMonth, a.subjectId, a.subjectName, a.direction, a.currency, CASE WHEN a.subMonth = 01 THEN a.remain END AS remain, "" AS remainF, "" AS debitOccF, "" AS creditOccF, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, "" AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM {lockDbName}.fin_accountall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ORDER BY a.subjectId ) a GROUP BY a.customerId, a.subjectId UNION SELECT a.customerId, a.subjectId, a.subjectName, a.direction, a.currency, SUM(a.remain) AS remain, SUM(a.remain) AS remainF, SUM(a.debitOcc) AS debitOccF, SUM(a.creditOcc) AS creditOccF, SUM(a.balance) AS balance, SUM(a.balance) AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM ( SELECT a.customerId, a.subMonth, a.subjectId, a.subjectName, a.direction, CASE WHEN a.currency = 0 THEN '\u4EBA\u6C11\u5E01' ELSE a.currency END AS currency, CASE WHEN a.subMonth = 01 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ORDER BY a.subjectId ) a GROUP BY a.customerId, a.subjectId ) a GROUP BY a.customerId, a.subjectId
FINDG250102=SELECT a.customerId, a.subjectId, b.subjectName, a.yyyy, a.assItemId, a.assItemName, a.direction, a.remain, a.remainF, a.balance, a.balanceF, a.debitOccF, a.creditOccF, a.currency, a.afterAmount FROM ( SELECT a.*, IFNULL(b.occurValue, 0) AS afterAmount FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, SUM(a.remain) AS remain, SUM(a.remainF) AS remainF, SUM(a.balance) AS balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, SUM(a.remain) AS remain, SUM(a.remainF) AS remainF, SUM(a.balance) AS balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, SUM(a.remain) AS remain, "" AS remainF, SUM(a.balance) AS balance, "" AS balanceF, "" AS debitOccF, "" AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.subMonth, a.assItemId, a.assItemName, a.direction, CASE WHEN a.subMonth = 01 THEN a.remain END remain, "" AS remainF, CASE WHEN a.subMonth = {param5} THEN a.balance END balance, "" AS balanceF, "" AS debitOccF, "" AS creditOccF, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', CONCAT('\u5916\u5E01:', a.currency)) AS currency FROM {lockDbName}.fin_assitementryaccall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId IN ({param4}) AND a.subMonth <= {param5} ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId UNION SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, SUM(a.remain) AS remain, SUM(a.remainF) AS remainF, SUM(a.balance) AS balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOcc) AS debitOccF, SUM(a.creditOcc) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.subMonth, a.assItemId, a.assItemName, a.direction, CASE WHEN a.subMonth = 01 THEN a.remain END remain, CASE WHEN a.subMonth = 01 THEN a.remain END remainF, CASE WHEN a.subMonth = {param5} THEN a.balance END balance, CASE WHEN a.subMonth = {param5} THEN a.balance END balanceF, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', CONCAT('\u5916\u5E01:', a.currency)) AS currency FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId IN ({param4}) AND a.subMonth <= {param5} ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId ) a LEFT JOIN ( SELECT a.customerId, a.subjectId, a.assItemId, SUM(a.occurValue) AS occurValue FROM ( SELECT a.customerId, a.yyyy, a.subjectId, a.assItemId, b.voucherId, c.occurValue FROM ( SELECT a.customerId, a.yyyy, a.subjectId, a.assItemId FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId = {param1} AND a.isLeaf1 = 1 AND a.subjectId IN ({param4}) AND (( a.subMonth > {param5} AND a.yyyy = {param2} ) OR (a.yyyy > {param2})) GROUP BY a.customerId, a.subjectId, a.assItemId, a.yyyy ) a, ( SELECT a.* FROM {lockDbName}.fin_assitementry a WHERE a.customerId = {param1} AND (( RIGHT (LEFT(a.vchDate, 7), 2) > {param5} AND a.yyyy = {param2} ) OR (a.yyyy > {param2})) AND a.subjectId IN ({param4})) b, ( SELECT a.* FROM ( SELECT a.customerId, a.yyyy, a.subjectId, a.voucherId, a.oldVoucherId, a.vchDate, a.serail, CASE WHEN GROUP_CONCAT( DISTINCT a.oppositeAccountTop ) LIKE '%\u5E93\u5B58\u73B0\u91D1%' THEN 1 WHEN GROUP_CONCAT( DISTINCT a.oppositeAccountTop ) LIKE '%\u94F6\u884C\u5B58\u6B3E%' THEN 1 WHEN GROUP_CONCAT( DISTINCT a.oppositeAccountTop ) LIKE '%\u5176\u4ED6\u8D27\u5E01\u8D44\u91D1%' THEN 1 ELSE 0 END AS isTrue, a.occurValue FROM {lockDbName}.fin_subjectentry a WHERE a.customerId = {param1} AND (( MONTH > {param5} AND a.yyyy = {param2} ) OR (a.yyyy > {param2})) AND a.direction = -1 AND a.subjectId IN ({param4}) GROUP BY a.customerId, a.yyyy, a.subjectId, a.voucherId, a.serail ) a WHERE a.isTrue = 1 ) c WHERE a.customerId = {param1} AND a.customerId = b.customerId AND a.yyyy = b.yyyy AND a.subjectId = b.subjectId AND a.assItemId = b.assItemId AND b.customerId = c.customerId AND b.yyyy = c.yyyy AND b.subjectId = c.subjectId AND b.voucherId = c.voucherId AND b.oldvoucherId = c.oldVoucherId AND b.vchDate = c.vchDate AND b.serail = c.serail AND c.isTrue = 1 ) a GROUP BY a.customerId, a.subjectId, a.assItemId ) b ON a.customerId = b.customerId AND a.subjectId = b.subjectId AND a.assItemId = b.assItemId ) a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.subjectId = a.subjectId
#2501-0400-\u8D37\u6B3E\u8BC1\u4FE1\u606F\u8D44\u6599\u4E0E\u4F01\u4E1A\u660E\u7EC6\u8D26\u501F\u6B3E\u4F59\u989D\u6838\u5BF9\u53CA\u8BF4\u660E
FINDG250103=SELECT SUBSTRING_INDEX(a.subjectFullName, "/", 1) AS jkType, a.customerId, a.yyyy, a.subjectId, a.subjectName, SUM( CASE WHEN a.subMonth = 1 THEN a.remain END ) AS remain, SUM(CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END) AS debitOcc, SUM(CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END) AS creditOcc, SUM( CASE WHEN a.subMonth = {param5} THEN a.balance END ) AS balance, a.direction, a.subjectFullName FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} GROUP BY a.customerId, a.yyyy, a.subjectId ORDER BY a.customerId, a.yyyy, a.subjectId
FINDG250104=SELECT SUBSTRING_INDEX(a.subjectFullName, "/", 1) AS jkType, a.customerId, a.yyyy, a.subjectId, a.subjectName, SUM( CASE WHEN a.subMonth = 1 THEN a.remain END ) AS remain, SUM(CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END) AS debitOcc, SUM(CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END) AS creditOcc, SUM( CASE WHEN a.subMonth = {param5} THEN a.balance END ) AS balance, a.direction, a.subjectFullName FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectFullName LIKE '{param6}%' AND a.subjectFullName <> '{param6}' AND a.subMonth <= {param5} GROUP BY a.customerId, a.yyyy, a.subjectId ORDER BY a.customerId, a.yyyy, a.subjectId
#2501-0500-\u77ED\u671F\u501F\u6B3E\u5229\u606F\u68C0\u67E5\u60C5\u51B5\u8868
FINDG250105=SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName AS subjectName, a.subjectFullName AS subjectFullName FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' GROUP BY a.customerId, a.yyyy, a.subjectId ORDER BY a.customerId, a.yyyy, a.subjectId
#2502-0100-\u5E94\u4ED8\u503A\u5238\u660E\u7EC6\u8868
FINDG250201=SELECT a.customerId,a.yyyy,a.subjectId,a.subjectName,a.assItemId,a.assItemName,a.remainF,a.debitOccF,a.creditOccF,a.balanceF,a.currency,a.isLeaf1 FROM ((SELECT aa.customerId,aa.yyyy,aa.subjectId,aa.subjectName,aa.assItemId,aa.assItemName,aa.fullName,MAX(aa.remainF) AS remainF,SUM(aa.debitOccF) AS debitOccF,SUM(aa.creditOccF) AS creditOccF,MAX(aa.balanceF) AS balanceF,aa.direction,aa.currency,aa.isLeaf1 FROM (SELECT a.customerId,a.yyyy,a.subjectId AS subjectId,a.subjectName AS subjectName,a.assItemId,a.assItemName,a.assTotalName AS fullName,CASE WHEN a.subMonth=01 THEN a.remain END AS remainF,CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction< 0 THEN a.creditOcc ELSE a.debitOcc END END AS debitOccF,"" AS creditOcc,CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction< 0 THEN a.debitOcc ELSE a.creditOcc END END AS creditOccF,CASE WHEN a.subMonth={param5} THEN a.balance END AS balanceF,a.direction,IF (a.currency='0',"",a.currency) AS currency,a.level1 AS level1,a.isLeaf1 AS isLeaf1 FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId={param1} AND a.yyyy={param2}) aa GROUP BY aa.customerId,aa.yyyy,aa.subjectId,aa.currency,aa.assitemId ORDER BY aa.customerId,aa.yyyy,aa.subjectId)) a WHERE a.customerId={param1} AND a.yyyy={param2} AND a.isLeaf1=1 AND a.subjectId LIKE '{param4}%'
#2701-0100-\u957F\u671F\u5E94\u4ED8\u6B3E\u660E\u7EC6\u8868
FINDG270101=SELECT a.customerId, a.subjectId, a.subjectName, "" AS assItemId, "" AS assItemName, IF (a.direction < 0, '\u8D37', '\u501F') AS direction, a.currency, a.remain, SUM(a.remainF) AS remainF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.balance, SUM(a.balanceF) AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, MAX(a.hasAssItem) AS hasAssItem, 0 AS afterAmount FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.direction, a.currency, SUM(a.remain) AS remain, "" AS remainF, "" AS debitOccF, "" AS creditOccF, SUM(a.balance) AS balance, "" AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM ( SELECT a.customerId, a.subMonth, a.subjectId, a.subjectName, a.direction, a.currency, CASE WHEN a.subMonth = 01 THEN a.remain END AS remain, "" AS remainF, "" AS debitOccF, "" AS creditOccF, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, "" AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM {lockDbName}.fin_accountall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ORDER BY a.subjectId ) a GROUP BY a.customerId, a.subjectId UNION SELECT a.customerId, a.subjectId, a.subjectName, a.direction, a.currency, SUM(a.remain) AS remain, SUM(a.remain) AS remainF, SUM(a.debitOcc) AS debitOccF, SUM(a.creditOcc) AS creditOccF, SUM(a.balance) AS balance, SUM(a.balance) AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM ( SELECT a.customerId, a.subMonth, a.subjectId, a.subjectName, a.direction, CASE WHEN a.currency = 0 THEN '\u4EBA\u6C11\u5E01' ELSE a.currency END AS currency, CASE WHEN a.subMonth = 01 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ORDER BY a.subjectId ) a GROUP BY a.customerId, a.subjectId ) a GROUP BY a.customerId, a.subjectId
FINDG270102=SELECT a.customerId, a.yyyy, a.assItemId AS subjectId, a.assItemName AS subjectName, a.direction, SUM(a.remain) AS remain, SUM(a.remainF) AS remainF, SUM(a.balance) AS balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, SUM(a.remain) AS remain, SUM(a.remainF) AS remainF, SUM(a.balance) AS balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, a.remain, SUM(a.remainF) AS remainF, a.balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, SUM(a.remain) AS remain, "" AS remainF, SUM(a.balance) AS balance, "" AS balanceF, "" AS debitOccF, "" AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.subMonth, a.assItemId, a.assItemName, a.direction, CASE WHEN a.subMonth = 01 THEN a.remain END remain, "" AS remainF, CASE WHEN a.subMonth = {param5} THEN a.balance END balance, "" AS balanceF, "" AS debitOccF, "" AS creditOccF, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', CONCAT('\u5916\u5E01:', a.currency)) AS currency FROM {lockDbName}.fin_assitementryaccall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId IN ({param4}) AND a.subMonth <= {param5} ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId UNION SELECT a.customerId, a.subjectId, a.yyyy, a.assItemId, a.assItemName, a.direction, SUM(a.remain) AS remain, SUM(a.remainF) AS remainF, SUM(a.balance) AS balance, SUM(a.balanceF) AS balanceF, SUM(a.debitOcc) AS debitOccF, SUM(a.creditOcc) AS creditOccF, a.currency FROM ( SELECT a.customerId, a.subjectId, a.yyyy, a.subMonth, a.assItemId, a.assItemName, a.direction, CASE WHEN a.subMonth = 01 THEN a.remain END remain, CASE WHEN a.subMonth = 01 THEN a.remain END remainF, CASE WHEN a.subMonth = {param5} THEN a.balance END balance, CASE WHEN a.subMonth = {param5} THEN a.balance END balanceF, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', CONCAT('\u5916\u5E01:', a.currency)) AS currency FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId IN ({param4}) AND a.subMonth <= {param5} ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId ) a GROUP BY a.customerId, a.subjectId, a.yyyy, a.assItemId ) a GROUP BY a.customerId, a.assItemId
#2711-0100-\u4E13\u9879\u5E94\u4ED8\u6B3E\u660E\u7EC6\u8868
FINDG271101=SELECT a.subjectId, a.subjectName, "" AS assItemId, "" AS assItemName, a.remainF, a.debitOccF, a.creditOccF, a.balanceF, a.level1 FROM (( SELECT aa.subjectName, aa.customerId, aa.yyyy, aa.subjectId, aa.level1, MAX(aa.remainF) AS remainF, SUM(aa.debitOccF) AS debitOccF, SUM(aa.creditOccF) AS creditOccF, MAX(aa.balanceF) AS balanceF FROM ( SELECT a.customerId, a.yyyy, a.subMonth, a.subjectId, a.subjectName AS subjectName, CASE WHEN a.subMonth = 01 THEN a.remain END AS remainF, CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END END AS debitOccF, CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END END AS creditOccF, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balanceF, IF ( a.currency = '0', "", CONCAT('\u5916\u5E01:', a.currency)) AS currency, a.level1 AS level1, a.isLeaf1 AS isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} ) aa GROUP BY aa.customerId, aa.yyyy, aa.subjectId, aa.currency )) a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectId LIKE '{param4}%' AND a.level1 = 2
#2801-0100-\u9884\u8BA1\u8D1F\u503A\u660E\u7EC6\u8868
FINDG280101=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, a.dataName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
#2901-0100-\u9012\u5EF6\u6240\u5F97\u7A0E\u8D1F\u503A\u660E\u7EC6\u5185\u5BB9\u8C03\u6574\u8868
FINDG290101=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, a.dataName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
#2902-0100-\u5176\u4ED6\u975E\u6D41\u52A8\u8D1F\u503A\u660E\u7EC6\u8868
FINDG290201=SELECT a.subjectId, a.subjectFullName, "" AS assItemId, "" AS assItemName, MAX(a.remain) AS remain, SUM(a.debitOcc) AS debitTotalOcc, SUM(a.creditOcc) AS creditTotalOcc FROM ( SELECT a.subjectId, IFNULL(a.subjectFullName, 0) AS subjectFullName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, IFNULL(CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END, 0) AS debitOcc, IFNULL(CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END, 0) AS creditOcc FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} AND a.isLeaf1 = 1) a GROUP BY a.subjectId, a.subjectFullName
#4001-0100-\u5B9E\u6536\u8D44\u672C\u660E\u7EC6\u8868
FINDG400101=SELECT a.customerId, a.subjectId, a.subjectName, "" AS assItemId, "" AS assItemName, IF (a.direction < 0, '\u8D37', '\u501F') AS direction, a.currency, a.remain, SUM(a.remainF) AS remainF, SUM(a.debitOccF) AS debitOccF, SUM(a.creditOccF) AS creditOccF, a.balance, SUM(a.balanceF) AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, MAX(a.hasAssItem) AS hasAssItem, 0 AS afterAmount FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.direction, a.currency, SUM(a.remain) AS remain, "" AS remainF, "" AS debitOccF, "" AS creditOccF, SUM(a.balance) AS balance, "" AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM ( SELECT a.customerId, a.subMonth, a.subjectId, a.subjectName, a.direction, a.currency, CASE WHEN a.subMonth = 01 THEN a.remain END AS remain, "" AS remainF, "" AS debitOccF, "" AS creditOccF, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, "" AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM {lockDbName}.fin_accountall a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ORDER BY a.subjectId ) a GROUP BY a.customerId, a.subjectId UNION SELECT a.customerId, a.subjectId, a.subjectName, a.direction, a.currency, SUM(a.remain) AS remain, SUM(a.remain) AS remainF, SUM(a.debitOcc) AS debitOccF, SUM(a.creditOcc) AS creditOccF, SUM(a.balance) AS balance, SUM(a.balance) AS balanceF, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM ( SELECT a.customerId, a.subMonth, a.subjectId, a.subjectName, a.direction, CASE WHEN a.currency = 0 THEN '\u4EBA\u6C11\u5E01' ELSE a.currency END AS currency, CASE WHEN a.subMonth = 01 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.isLeaf1, a.level1, a.subjectFullName, a.hasAssItem FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ORDER BY a.subjectId ) a GROUP BY a.customerId, a.subjectId ) a GROUP BY a.customerId, a.subjectId
#4002-0100-\u8D44\u672C\u516C\u79EF\u660E\u7EC6\u8868
FINDG400201=SELECT a.customerId, a.yyyy, a.subjectId, "" AS assItemId, "" AS assItemName, SUM( CASE WHEN a.subMonth = 1 THEN  a.remain END ) AS remain, CASE WHEN a.direction <> -1 THEN SUM(a.debitOcc) ELSE SUM(a.creditOcc) END AS debitOcc, CASE WHEN a.direction <> -1 THEN SUM(a.creditOcc) ELSE SUM(a.debitOcc) END AS creditOcc, SUM( CASE WHEN a.subMonth = {param5} THEN  a.balance END ) AS balance, a.subjectFullName AS subjectFullName FROM {lockDbName}.fin_account a WHERE a.isLeaf1 = 1 AND a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} GROUP BY a.customerId, a.yyyy, a.subjectId ORDER BY a.customerId, a.yyyy, a.subjectId
#4101-0100-\u76C8\u4F59\u516C\u79EF\u660E\u7EC6\u8868
FINDG410101=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, a.dataName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
#4104-0100-\u672A\u5206\u914D\u5229\u6DA6
FINDG410401=SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName, a.direction, a.remainF AS remain, IFNULL(b.remainF, 0) AS oldRemain FROM ( SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName, a.direction, a.remainF FROM (( SELECT aa.customerId, aa.yyyy, aa.subjectId, aa.subjectName, IF (aa.direction < 0, '\u8D37', '\u501F') AS direction, MAX(aa.remainF) AS remainF FROM ( SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName AS subjectName, CASE WHEN a.subMonth = 01 THEN  a.remain END AS remainF, a.direction FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param6} ) aa GROUP BY aa.customerId, aa.yyyy, aa.subjectId ORDER BY aa.customerId, aa.yyyy, aa.subjectId )) a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectName = '{param5} ' AND a.subjectId LIKE '{param4}%' ORDER BY a.customerId, a.yyyy, a.subjectId ) a LEFT JOIN ( SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName, a.direction, a.remainF FROM (( SELECT aa.customerId, aa.yyyy, aa.subjectId, aa.subjectName, IF (aa.direction < 0, '\u8D37', '\u501F') AS direction, MAX(aa.remainF) AS remainF FROM ( SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName AS subjectName, CASE WHEN a.subMonth = 01 THEN  a.remain END AS remainF, a.direction FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} -1 AND a.subMonth <= {param7} ) aa GROUP BY aa.customerId, aa.yyyy, aa.subjectId ORDER BY aa.customerId, aa.yyyy, aa.subjectId )) a WHERE a.customerId = {param1} AND a.yyyy = {param2} -1 AND a.subjectName = '{param5}' AND a.subjectId LIKE '{param4}%' ORDER BY a.customerId, a.yyyy, a.subjectId ) b ON a.customerId = b.customerId AND a.subjectId = b.subjectId AND a.subjectName = b.subjectName WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectName = '{param5}' AND a.subjectId LIKE '{param4}%'
#4105-0100-\u4E13\u9879\u50A8\u5907\u660E\u7EC6\u8868
FINDG410501=SELECT a.subjectId, a.subjectName, "" AS assItemId, "" AS assItemName, a.remainF, a.debitOccF, a.creditOccF, a.balanceF, a.level1, a.isLeaf1 FROM (( SELECT aa.subjectName, aa.customerId, aa.yyyy, aa.subjectId, aa.level1, MAX(aa.remainF) AS remainF, SUM(aa.debitOccF) AS debitOccF, SUM(aa.creditOccF) AS creditOccF, MAX(aa.balanceF) AS balanceF, aa.isLeaf1 FROM ( SELECT a.customerId, a.yyyy, a.subMonth, a.subjectId, a.subjectName AS subjectName, CASE WHEN a.subMonth = 01 THEN a.remain END AS remainF, CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END END AS debitOccF, CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END END AS creditOccF, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balanceF, IF ( a.currency = '0', "", CONCAT('\u5916\u5E01:', a.currency)) AS currency, a.level1 AS level1, a.isLeaf1 AS isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} ) aa GROUP BY aa.customerId, aa.yyyy, aa.subjectId, aa.currency )) a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1
#4106-0100-\u5176\u4ED6\u7EFC\u5408\u6536\u76CA\u660E\u7EC6\u8868
FINDG410601=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, a.dataName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
#4201-0100-\u5E93\u5B58\u80A1\u660E\u7EC6\u8868
FINDG420101=SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName, a.assItemId, a.assItemName, a.remainF, a.debitOccF, a.creditOccF, a.balanceF, a.currency, a.isLeaf1 FROM (( SELECT aa.customerId, aa.yyyy, aa.subjectId, aa.subjectName, aa.assItemId, aa.assItemName, aa.fullName, MAX(aa.remainF) AS remainF, SUM(aa.debitOccF) AS debitOccF, SUM(aa.creditOccF) AS creditOccF, MAX(aa.balanceF) AS balanceF, aa.direction, aa.currency, aa.isLeaf1 FROM ( SELECT a.customerId, a.yyyy, a.subjectId AS subjectId, a.subjectName AS subjectName, a.assItemId, a.assItemName, a.assTotalName AS fullName, CASE WHEN a.subMonth = 01 THEN a.remain END AS remainF, CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END END AS debitOccF, "" AS creditOcc, CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END END AS creditOccF, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balanceF, a.direction, IF ( a.currency = '0', "", a.currency ) AS currency, a.level1 AS level1, a.isLeaf1 AS isLeaf1 FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId = {param1} AND a.yyyy = {param2} ) aa GROUP BY aa.customerId, aa.yyyy, aa.subjectId, aa.currency, aa.assitemId ORDER BY aa.customerId, aa.yyyy, aa.subjectId )) a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%'
#4202-0100-\u4F18\u5148\u80A1\u589E\u51CF\u53D8\u52A8\u660E\u7EC6\u8868
FINDG420201=SELECT a.customerId, a.yyyy, a.subMonth, a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, SUM(a.remain) AS remain, SUM(a.balance) AS balance, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, a.dataName, a.direction, a.isLeaf1, a.level1, a.hasAssItem FROM ( SELECT a.customerId, a.yyyy, a.subMonth, a.subjectId, a.subjectName, a.subjectFullName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', a.currency ) AS dataName, a.direction, a.isLeaf1, a.level1, a.hasAssItem FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' ) a GROUP BY a.customerId, a.yyyy, a.subjectId
#4300-0100-\u5176\u4ED6\u6743\u76CA\u5DE5\u5177\u660E\u7EC6\u8868
FINDG430001=SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName, a.assItemId, a.assItemName, a.remainF, a.debitOccF, a.creditOccF, a.balanceF, a.currency, a.isLeaf1 FROM (( SELECT aa.customerId, aa.yyyy, aa.subjectId, aa.subjectName, aa.assItemId, aa.assItemName, aa.fullName, MAX(aa.remainF) AS remainF, SUM(aa.debitOccF) AS debitOccF, SUM(aa.creditOccF) AS creditOccF, MAX(aa.balanceF) AS balanceF, aa.direction, aa.currency, aa.isLeaf1 FROM ( SELECT a.customerId, a.yyyy, a.subjectId AS subjectId, a.subjectName AS subjectName, a.assItemId, a.assItemName, a.assTotalName AS fullName, CASE WHEN a.subMonth = 01 THEN a.remain END AS remainF, CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END END AS debitOccF, "" AS creditOcc, CASE WHEN a.subMonth BETWEEN 01 AND {param5} THEN CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END END AS creditOccF, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balanceF, a.direction, IF ( a.currency = '0', "", a.currency ) AS currency, a.level1 AS level1, a.isLeaf1 AS isLeaf1 FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId = {param1} AND a.yyyy = {param2} ) aa GROUP BY aa.customerId, aa.yyyy, aa.subjectId, aa.currency, aa.assitemId ORDER BY aa.customerId, aa.yyyy, aa.subjectId )) a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%'
#5001-0100-\u751F\u4EA7\u6210\u672C\u4F59\u989D\u8868
FINDG500101=SELECT a.* FROM ( SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName, a.subjectFullName, SUM( CASE WHEN a.subMonth = 12 THEN a.balance ELSE NULL END ) AS balance, a.hasAssItem FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} GROUP BY a.customerId, a.yyyy, a.subjectId ) a WHERE a.balance != 0 ORDER BY a.customerId, a.yyyy, a.subjectId
FINDG500102=SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName, a.subjectFullName, a.assItemId, a.assItemName, a.assTotalName, SUM( CASE WHEN a.subMonth = 12 THEN a.balance ELSE NULL END ) AS balance FROM {lockDbName}.fin_assitementryacc a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId IN ({param4}) AND a.subMonth <= {param5} GROUP BY a.customerId, a.yyyy, a.subjectId, a.assItemId ORDER BY a.customerId, a.yyyy, a.subjectId
#5001-0200-\u751F\u4EA7\u6210\u672C\u53D1\u751F\u989D\u5206\u6790
FINDG500103=SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName, a.subjectFullName, SUM( CASE WHEN a.subMonth = 1 THEN a.remain ELSE NULL END ) AS remain, SUM( CASE WHEN a.subMonth = 1 THEN CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END ELSE NULL END ) AS debitOcc1, SUM( CASE WHEN a.subMonth = 2 THEN CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END ELSE NULL END ) AS debitOcc2, SUM( CASE WHEN a.subMonth = 3 THEN CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END ELSE NULL END ) AS debitOcc3, SUM( CASE WHEN a.subMonth = 4 THEN CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END ELSE NULL END ) AS debitOcc4, SUM( CASE WHEN a.subMonth = 5 THEN CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END ELSE NULL END ) AS debitOcc5, SUM( CASE WHEN a.subMonth = 6 THEN CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END ELSE NULL END ) AS debitOcc6, SUM( CASE WHEN a.subMonth = 7 THEN CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END ELSE NULL END ) AS debitOcc7, SUM( CASE WHEN a.subMonth = 8 THEN CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END ELSE NULL END ) AS debitOcc8, SUM( CASE WHEN a.subMonth = 9 THEN CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END ELSE NULL END ) AS debitOcc9, SUM( CASE WHEN a.subMonth = 10 THEN CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END ELSE NULL END ) AS debitOcc10, SUM( CASE WHEN a.subMonth = 11 THEN CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END ELSE NULL END ) AS debitOcc11, SUM( CASE WHEN a.subMonth = 12 THEN CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END ELSE NULL END ) AS debitOcc12, SUM( CASE WHEN a.subMonth = 1 THEN CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END ELSE NULL END ) AS creditOcc1, SUM( CASE WHEN a.subMonth = 2 THEN CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END ELSE NULL END ) AS creditOcc2, SUM( CASE WHEN a.subMonth = 3 THEN CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END ELSE NULL END ) AS creditOcc3, SUM( CASE WHEN a.subMonth = 4 THEN CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END ELSE NULL END ) AS creditOcc4, SUM( CASE WHEN a.subMonth = 5 THEN CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END ELSE NULL END ) AS creditOcc5, SUM( CASE WHEN a.subMonth = 6 THEN CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END ELSE NULL END ) AS creditOcc6, SUM( CASE WHEN a.subMonth = 7 THEN CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END ELSE NULL END ) AS creditOcc7, SUM( CASE WHEN a.subMonth = 8 THEN CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END ELSE NULL END ) AS creditOcc8, SUM( CASE WHEN a.subMonth = 9 THEN CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END ELSE NULL END ) AS creditOcc9, SUM( CASE WHEN a.subMonth = 10 THEN CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END ELSE NULL END ) AS creditOcc10, SUM( CASE WHEN a.subMonth = 11 THEN CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END ELSE NULL END ) AS creditOcc11, SUM( CASE WHEN a.subMonth = 12 THEN CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END ELSE NULL END ) AS creditOcc12, SUM( CASE WHEN a.subMonth = 1 THEN a.balance * a.direction ELSE NULL END ) AS balance1, SUM( CASE WHEN a.subMonth = 2 THEN a.balance * a.direction ELSE NULL END ) AS balance2, SUM( CASE WHEN a.subMonth = 3 THEN a.balance * a.direction ELSE NULL END ) AS balance3, SUM( CASE WHEN a.subMonth = 4 THEN a.balance * a.direction ELSE NULL END ) AS balance4, SUM( CASE WHEN a.subMonth = 5 THEN a.balance * a.direction ELSE NULL END ) AS balance5, SUM( CASE WHEN a.subMonth = 6 THEN a.balance * a.direction ELSE NULL END ) AS balance6, SUM( CASE WHEN a.subMonth = 7 THEN a.balance * a.direction ELSE NULL END ) AS balance7, SUM( CASE WHEN a.subMonth = 8 THEN a.balance * a.direction ELSE NULL END ) AS balance8, SUM( CASE WHEN a.subMonth = 9 THEN a.balance * a.direction ELSE NULL END ) AS balance9, SUM( CASE WHEN a.subMonth = 10 THEN a.balance * a.direction ELSE NULL END ) AS balance10, SUM( CASE WHEN a.subMonth = 11 THEN a.balance * a.direction ELSE NULL END ) AS balance11, SUM( CASE WHEN a.subMonth = 12 THEN a.balance * a.direction ELSE NULL END ) AS balance12 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.level1 = 2 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} GROUP BY a.customerId, a.yyyy, a.subjectId ORDER BY a.customerId, a.yyyy, a.subjectId
FINDG500104=SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName, a.subjectFullName, SUM( CASE WHEN a.subMonth = 1 THEN a.remain ELSE NULL END ) AS remain, SUM( CASE WHEN a.subMonth = 1 THEN CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END ELSE NULL END ) AS debitOcc1, SUM( CASE WHEN a.subMonth = 2 THEN CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END ELSE NULL END ) AS debitOcc2, SUM( CASE WHEN a.subMonth = 3 THEN CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END ELSE NULL END ) AS debitOcc3, SUM( CASE WHEN a.subMonth = 4 THEN CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END ELSE NULL END ) AS debitOcc4, SUM( CASE WHEN a.subMonth = 5 THEN CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END ELSE NULL END ) AS debitOcc5, SUM( CASE WHEN a.subMonth = 6 THEN CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END ELSE NULL END ) AS debitOcc6, SUM( CASE WHEN a.subMonth = 7 THEN CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END ELSE NULL END ) AS debitOcc7, SUM( CASE WHEN a.subMonth = 8 THEN CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END ELSE NULL END ) AS debitOcc8, SUM( CASE WHEN a.subMonth = 9 THEN CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END ELSE NULL END ) AS debitOcc9, SUM( CASE WHEN a.subMonth = 10 THEN CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END ELSE NULL END ) AS debitOcc10, SUM( CASE WHEN a.subMonth = 11 THEN CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END ELSE NULL END ) AS debitOcc11, SUM( CASE WHEN a.subMonth = 12 THEN CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END ELSE NULL END ) AS debitOcc12, SUM( CASE WHEN a.subMonth = 1 THEN CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END ELSE NULL END ) AS creditOcc1, SUM( CASE WHEN a.subMonth = 2 THEN CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END ELSE NULL END ) AS creditOcc2, SUM( CASE WHEN a.subMonth = 3 THEN CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END ELSE NULL END ) AS creditOcc3, SUM( CASE WHEN a.subMonth = 4 THEN CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END ELSE NULL END ) AS creditOcc4, SUM( CASE WHEN a.subMonth = 5 THEN CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END ELSE NULL END ) AS creditOcc5, SUM( CASE WHEN a.subMonth = 6 THEN CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END ELSE NULL END ) AS creditOcc6, SUM( CASE WHEN a.subMonth = 7 THEN CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END ELSE NULL END ) AS creditOcc7, SUM( CASE WHEN a.subMonth = 8 THEN CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END ELSE NULL END ) AS creditOcc8, SUM( CASE WHEN a.subMonth = 9 THEN CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END ELSE NULL END ) AS creditOcc9, SUM( CASE WHEN a.subMonth = 10 THEN CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END ELSE NULL END ) AS creditOcc10, SUM( CASE WHEN a.subMonth = 11 THEN CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END ELSE NULL END ) AS creditOcc11, SUM( CASE WHEN a.subMonth = 12 THEN CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END ELSE NULL END ) AS creditOcc12, SUM( CASE WHEN a.subMonth = 1 THEN a.balance * a.direction ELSE NULL END ) AS balance1, SUM( CASE WHEN a.subMonth = 2 THEN a.balance * a.direction ELSE NULL END ) AS balance2, SUM( CASE WHEN a.subMonth = 3 THEN a.balance * a.direction ELSE NULL END ) AS balance3, SUM( CASE WHEN a.subMonth = 4 THEN a.balance * a.direction ELSE NULL END ) AS balance4, SUM( CASE WHEN a.subMonth = 5 THEN a.balance * a.direction ELSE NULL END ) AS balance5, SUM( CASE WHEN a.subMonth = 6 THEN a.balance * a.direction ELSE NULL END ) AS balance6, SUM( CASE WHEN a.subMonth = 7 THEN a.balance * a.direction ELSE NULL END ) AS balance7, SUM( CASE WHEN a.subMonth = 8 THEN a.balance * a.direction ELSE NULL END ) AS balance8, SUM( CASE WHEN a.subMonth = 9 THEN a.balance * a.direction ELSE NULL END ) AS balance9, SUM( CASE WHEN a.subMonth = 10 THEN a.balance * a.direction ELSE NULL END ) AS balance10, SUM( CASE WHEN a.subMonth = 11 THEN a.balance * a.direction ELSE NULL END ) AS balance11, SUM( CASE WHEN a.subMonth = 12 THEN a.balance * a.direction ELSE NULL END ) AS balance12 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.level1 = 3 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} GROUP BY a.customerId, a.yyyy, a.subjectId ORDER BY a.customerId, a.yyyy, a.subjectId
#5101-0100-\u5236\u9020\u8D39\u7528\u660E\u7EC6\u8868
FINDG510101=SELECT a.customerId, a.yyyy, a.subjectId, a.subjectName, a.subjectFullName, SUM( CASE WHEN a.subMonth = 1 THEN a.debitOcc ELSE NULL END ) AS debitOcc1, SUM( CASE WHEN a.subMonth = 2 THEN a.debitOcc ELSE NULL END ) AS debitOcc2, SUM( CASE WHEN a.subMonth = 3 THEN a.debitOcc ELSE NULL END ) AS debitOcc3, SUM( CASE WHEN a.subMonth = 4 THEN a.debitOcc ELSE NULL END ) AS debitOcc4, SUM( CASE WHEN a.subMonth = 5 THEN a.debitOcc ELSE NULL END ) AS debitOcc5, SUM( CASE WHEN a.subMonth = 6 THEN a.debitOcc ELSE NULL END ) AS debitOcc6, SUM( CASE WHEN a.subMonth = 7 THEN a.debitOcc ELSE NULL END ) AS debitOcc7, SUM( CASE WHEN a.subMonth = 8 THEN a.debitOcc ELSE NULL END ) AS debitOcc8, SUM( CASE WHEN a.subMonth = 9 THEN a.debitOcc ELSE NULL END ) AS debitOcc9, SUM( CASE WHEN a.subMonth = 10 THEN a.debitOcc ELSE NULL END ) AS debitOcc10, SUM( CASE WHEN a.subMonth = 11 THEN a.debitOcc ELSE NULL END ) AS debitOcc11, SUM( CASE WHEN a.subMonth = 12 THEN a.debitOcc ELSE NULL END ) AS debitOcc12 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy ={param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} GROUP BY a.customerId, a.yyyy, a.subjectId ORDER BY a.customerId, a.yyyy, a.subjectId
FINDG510102=SELECT a.customerId, a.yyyy, a.subjectId, a.parentSubjectId, a.subjectFullId, a.subjectName, a.direction, a.currency, a.isLeaf1, a.level1, a.subjectFullName FROM {lockDbName}.fin_accpkgsubject a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectId LIKE '{param4}%' AND a.subjectName = '{param6}'
#5201-0100-\u52B3\u52A1\u6210\u672C\u660E\u7EC6\u8868
FINDG520101=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, a.dataName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
#5301-0100-\u7814\u53D1\u652F\u51FA\u660E\u7EC6\u8868
FINDG530101=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, a.dataName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, CASE WHEN a.direction < 0 THEN a.creditOcc ELSE a.debitOcc END AS debitOcc, CASE WHEN a.direction < 0 THEN a.debitOcc ELSE a.creditOcc END AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
#5301-0200-\u7814\u53D1\u652F\u51FA\u589E\u51CF\u67E5\u9A8C
FINDG530102=SELECT a.vchDate, a.oldVoucherId, a.summary, a.subjectId, a.subjectFullName, SUBSTRING_INDEX( SUBSTRING_INDEX(a.subjectFullName, "/", 2), "/", -1 ) AS secondName, CASE WHEN a.direction = 1 THEN a.direction * a.occurValue ELSE "" END AS debitOcc, CASE WHEN a.direction = -1 THEN a.direction * a.occurValue ELSE "" END AS creditOcc FROM {lockDbName}.fin_subjectentry a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectId LIKE '{param4}%' AND a.month <= {param5} ORDER BY a.customerId, a.yyyy, a.vchDate, a.oldVoucherId
#6001-0100-\u4E3B\u8425\u4E1A\u52A1\u6536\u5165\u3001\u6210\u672C\u660E\u7EC6\u8868
FINDG600101=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, a.dataName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction AS debitOcc, ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
FINDG600102=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, a.dataName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction AS debitOcc, ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
#6001-0300-\u5206\u6708\u6536\u5165\u3001\u6210\u672C\u660E\u7EC6\u8868
FINDG600103=SELECT a.*, IFNULL(b.remain, 0) AS remainF, IFNULL(b.balance, 0) AS balanceF FROM ( SELECT a.customerId, a.yyyy, a.subMonth, IFNULL(b.remain, 0) AS remain, SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS balance FROM {lockDbName}.fin_account a LEFT JOIN ( SELECT a.subjectId, a.subMonth, SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS remain FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} -1 AND a.subjectId = '{param4}' AND a.subMonth <= {param6} GROUP BY a.customerId, a.yyyy, a.subjectId, a.subMonth ) b ON b.subjectId = a.subjectId AND b.subMonth = a.subMonth WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectId = '{param4}' AND a.subMonth <= {param5} GROUP BY a.customerId, a.yyyy, a.subjectId, a.subMonth ORDER BY a.customerId, a.yyyy, a.subjectId, a.subMonth ) a LEFT JOIN ( SELECT a.customerId, a.yyyy, a.subMonth, IFNULL(b.remain, 0) AS remain, SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS balance FROM {lockDbName}.fin_account a LEFT JOIN ( SELECT a.subjectId, a.subMonth, SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS remain FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} -1 AND a.subjectId = '{param7}' AND a.subMonth <= {param6} GROUP BY a.customerId, a.yyyy, a.subjectId, a.subMonth ) b ON b.subjectId = a.subjectId AND b.subMonth = a.subMonth WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectId = '{param7}' AND a.subMonth <= {param5} GROUP BY a.customerId, a.yyyy, a.subjectId, a.subMonth ORDER BY a.customerId, a.yyyy, a.subjectId, a.subMonth ) b ON a.customerId = b.customerId AND a.yyyy = b.yyyy AND a.subMonth = b.subMonth
#6001-0400-\u6536\u5165\u540C\u671F\u6BD4\u8F83\u8868
FINDG600104=SELECT a.customerId, a.yyyy, a.subjectId, IFNULL(b.remain, 0) AS remain, SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS balance, a.subjectFullName AS subjectFullName FROM {lockDbName}.fin_account a LEFT JOIN ( SELECT a.subjectId, SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS remain FROM {lockDbName}.fin_account a WHERE a.isLeaf1 = 1 AND a.customerId = {param1} AND a.yyyy = {param2} -1 AND a.subjectId = '{param4}' AND a.subjectId <> '{param4}' AND a.subMonth <= {param6} GROUP BY a.customerId, a.yyyy, a.subjectId ) b ON b.subjectId = a.subjectId WHERE a.isLeaf1 = 1 AND a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectId = '{param4}' AND a.subjectId <> '{param4}' AND a.subMonth <= {param5} GROUP BY a.customerId, a.yyyy, a.subjectId ORDER BY a.customerId, a.yyyy, a.subjectId
#6001-0700-\u9500\u552E\u9000\u56DE\u67E5\u9A8C
FINDG600107=SELECT a.customerId, a.yyyy, a.subjectId, IFNULL(b.remain, 0) AS remain, SUM( IF ( a.direction < 0, a.creditOccNoTran - a.debitOccNoTran, a.debitOccNoTran - a.creditOccNoTran )) AS balance, a.subjectFullName AS subjectFullName FROM {lockDbName}.fin_account a LEFT JOIN ( SELECT a.subjectId, SUM( IF ( a.direction < 0, a.creditOccNoTran - a.debitOccNoTran, a.debitOccNoTran - a.creditOccNoTran )) AS remain FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} -1 AND a.subjectId = '{param4}' AND a.subMonth <= {param6} GROUP BY a.customerId, a.yyyy, a.subjectId ) b ON b.subjectId = a.subjectId WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectId = '{param4}' AND a.subMonth <= {param5} GROUP BY a.customerId, a.yyyy, a.subjectId ORDER BY a.customerId, a.yyyy, a.subjectId
#6051-0100-\u5176\u4ED6\u4E1A\u52A1\u6536\u5165\u3001\u6210\u672C\u660E\u7EC6\u8868
FINDG605101=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, a.dataName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction AS debitOcc, ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
FINDG605102=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, a.dataName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction AS debitOcc, ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
FINDG605103=SELECT a.customerId,a.yyyy,a.subjectId,a.subjectFullName,a.income,a.cost FROM (SELECT a.customerId, a.yyyy, a.subjectId, a.subjectFullName, IFNULL(a.income, 0) AS income, IFNULL(b.cost, 0) AS cost FROM ( SELECT a.customerId, a.yyyy, a.subjectId, SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS income, a.subjectName, REPLACE( SUBSTRING( a.subjectName, LOCATE('-', a.subjectName) + 1 ), '\u6536\u5165', "" ) AS subjectFullName FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} GROUP BY a.customerId, a.yyyy, a.subjectId ORDER BY a.customerId, a.yyyy, a.subjectId ) a LEFT JOIN ( SELECT a.customerId, a.yyyy, a.subjectId, SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS cost, a.subjectName, REPLACE( SUBSTRING( a.subjectName, LOCATE('-', a.subjectName) + 1 ), '\u6210\u672C', "" ) AS subjectFullName FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param6}%' AND a.subjectId <> '{param6}' AND a.subMonth <= {param5} GROUP BY a.customerId, a.yyyy, a.subjectId ORDER BY a.customerId, a.yyyy, a.subjectId ) b ON a.customerId = b.customerId AND a.subjectFullName = b.subjectFullName AND a.yyyy = b.yyyy UNION SELECT a.customerId, a.yyyy, a.subjectId, a.subjectFullName, IFNULL(b.income, 0) AS income, IFNULL(a.cost, 0) AS cost FROM ( SELECT a.customerId, a.yyyy, a.subjectId, SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS cost, a.subjectName, REPLACE( SUBSTRING( a.subjectName, LOCATE('-', a.subjectName) + 1 ), '\u6210\u672C', "" ) AS subjectFullName FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param6}%' AND a.subjectId <> '{param6}' AND a.subMonth <= {param5} GROUP BY a.customerId, a.yyyy, a.subjectId ORDER BY a.customerId, a.yyyy, a.subjectId ) a LEFT JOIN ( SELECT a.customerId, a.yyyy, a.subjectId, SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS income, a.subjectName, REPLACE( SUBSTRING( a.subjectName, LOCATE('-', a.subjectName) + 1 ), '\u6536\u5165', "" ) AS subjectFullName FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} GROUP BY a.customerId, a.yyyy, a.subjectId ORDER BY a.customerId, a.yyyy, a.subjectId ) b ON a.customerId = b.customerId AND a.subjectFullName = b.subjectFullName AND a.yyyy = b.yyyy) a GROUP BY subjectFullName ORDER BY a.customerId,a.yyyy,a.subjectId
#6101-0100-\u516C\u5141\u4EF7\u503C\u53D8\u52A8\u635F\u76CA\u660E\u7EC6\u8868
FINDG610101=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, SUM(a.debitOcc) AS debitTotalOcc, SUM(a.creditOcc) AS creditTotalOcc, SUM(a.balance) AS balance, '' AS auditedRemain FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction AS debitOcc, ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction AS creditOcc, CASE WHEN a.subMonth = {param3} THEN a.balance END AS balance FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param3} AND a.subjectId IN ({param4}) AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
#6101-0200-\u516C\u5141\u4EF7\u503C\u53D8\u52A8\u635F\u76CA\u6838\u5BF9\u8868
FINDG610102=SELECT a.customerId, a.yyyy, a.subjectId, IFNULL(b.remain, 0) AS remain, SUM( (a.debitOccNoTran - a.creditOccNoTran) * a.direction ) AS balance, a.subjectFullName AS subjectFullName FROM {lockDbName}.fin_account a LEFT JOIN ( SELECT a.subjectId, SUM( (a.debitOccNoTran - a.creditOccNoTran) * a.direction ) AS remain FROM {lockDbName}.fin_account a WHERE a.isLeaf1 = 1 AND a.customerId = {param1} AND a.yyyy = {param2} -1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param6} GROUP BY a.customerId, a.yyyy, a.subjectId ) b ON b.subjectId = a.subjectId WHERE a.isLeaf1 = 1 AND a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectId '{param4}%' AND a.subjectId <> '{param4}' AND a.subMonth <= {param5} GROUP BY a.customerId, a.yyyy, a.subjectId ORDER BY a.customerId, a.yyyy, a.subjectId
#6111-0100-\u6295\u8D44\u6536\u76CA\u660E\u7EC6\u8868
FINDG611101=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, SUM(a.debitOcc) AS debitTotalOcc, SUM(a.creditOcc) AS creditTotalOcc, SUM(a.balance) AS balance, '' AS auditedRemain FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction AS debitOcc, ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction AS creditOcc, CASE WHEN a.subMonth = {param3} THEN a.balance END AS balance FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param3} AND a.subjectId IN ({param4}) AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
#6111-0200-\u6210\u672C\u6CD5\u68C0\u67E5\u8868
FINDG611102=SELECT a.customerId, a.yyyy, a.subjectId, IFNULL(b.remain, 0) AS remain, SUM( (a.debitOccNoTran - a.creditOccNoTran) * a.direction ) AS balance, a.subjectFullName AS subjectFullName FROM {lockDbName}.fin_account a LEFT JOIN ( SELECT a.subjectId, SUM( (a.debitOccNoTran - a.creditOccNoTran) * a.direction ) AS remain FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} -1 AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param6} GROUP BY a.customerId, a.yyyy, a.subjectId ) b ON b.subjectId = a.subjectId WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} GROUP BY a.customerId, a.yyyy, a.subjectId ORDER BY a.customerId, a.yyyy, a.subjectId
FINDG611103=SELECT a.customerId, a.yyyy, a.subjectId, IFNULL(b.remain, 0) AS remain, SUM( (a.debitOccNoTran - a.creditOccNoTran) * a.direction ) AS balance, a.subjectFullName AS subjectFullName FROM {lockDbName}.fin_account a LEFT JOIN ( SELECT a.subjectId, SUM( (a.debitOccNoTran - a.creditOccNoTran) * a.direction ) AS remain FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} -1 AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param6} GROUP BY a.customerId, a.yyyy, a.subjectId ) b ON b.subjectId = a.subjectId WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} GROUP BY a.customerId, a.yyyy, a.subjectId ORDER BY a.customerId, a.yyyy, a.subjectId
#6121-0100-\u5176\u4ED6\u6536\u76CA\u660E\u7EC6\u8868
FINDG612101=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, SUM(a.debitOcc) AS debitTotalOcc, SUM(a.creditOcc) AS creditTotalOcc, SUM(a.balance) AS balance, '' AS auditedRemain FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction AS debitOcc, ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction AS creditOcc, CASE WHEN a.subMonth = {param3} THEN a.balance END AS balance FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param3} AND a.subjectId IN ({param4}) AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
#6131-0100-\u8D44\u4EA7\u5904\u7F6E\u635F\u76CA\u660E\u7EC6\u8868
FINDG613101=SELECT a.customerId, a.yyyy, a.subjectId, IFNULL(b.remain, 0) AS remain, SUM( (a.debitOccNoTran - a.creditOccNoTran) * a.direction ) AS balance, a.subjectFullName AS subjectFullName, "" AS assItemId, "" AS assItemName FROM {lockDbName}.fin_account a LEFT JOIN ( SELECT a.subjectId, SUM( (a.debitOccNoTran - a.creditOccNoTran) * a.direction ) AS remain FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} -1 AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param6} GROUP BY a.customerId, a.yyyy, a.subjectId ) b ON b.subjectId = a.subjectId WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} GROUP BY a.customerId, a.yyyy, a.subjectId ORDER BY a.customerId, a.yyyy, a.subjectId
#6301-0100-\u8425\u4E1A\u5916\u6536\u5165\u660E\u7EC6\u8868
FINDG630101=( SELECT a.customerId, a.subjectId, IFNULL(b.remain, 0) AS getOldTotal, SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS getTotal, a.subjectFullName AS subjectFullName, "" AS assItemId, "" AS assItemName FROM {lockDbName}.fin_account a LEFT JOIN ( SELECT a.subjectId, SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS remain FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} -1 AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param6} GROUP BY a.customerId, a.yyyy, a.subjectId ) b ON b.subjectId = a.subjectId WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} GROUP BY a.customerId, a.subjectId ORDER BY a.customerId, a.subjectId ) UNION ( SELECT a.customerId, a.subjectId, SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS getOldTotal, IFNULL(b.remain, 0) AS getTotal, a.subjectFullName AS subjectFullName, "" AS assItemId, "" AS assItemName FROM {lockDbName}.fin_account a LEFT JOIN ( SELECT a.subjectId, SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS remain FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} GROUP BY a.customerId, a.yyyy, a.subjectId ) b ON b.subjectId = a.subjectId WHERE a.customerId = {param1} AND a.yyyy = {param2} -1 AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param6} GROUP BY a.customerId, a.subjectId ORDER BY a.customerId, a.subjectId )
#6301-0400-\u8425\u4E1A\u5916\u6536\u5165\u68C0\u67E5\u653F\u5E9C\u8865\u52A9
FINDG630104=SELECT a.subjectId, a.subjectFullName, IFNULL(( SUM(a.debitOccNoTran) - SUM(a.creditOccNoTran)), 0 ) AS currentMoney FROM ( SELECT a.subjectId, IFNULL(a.subjectFullName, 0) AS subjectFullName, IFNULL( CASE WHEN a.direction < 0 THEN a.creditOccNoTran ELSE a.debitOccNoTran END, 0 ) AS debitOccNoTran, IFNULL( CASE WHEN a.direction < 0 THEN a.debitOccNoTran ELSE a.creditOccNoTran END, 0 ) AS creditOccNoTran FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ) a GROUP BY a.subjectId, a.subjectFullName
#6401-0100-\u4E3B\u8425\u4E1A\u52A1\u6210\u672C\u660E\u7EC6\u8868
FINDG640101=SELECT CONCAT(a.subMonth, "\u6708") AS month, IFNULL(( a.debitOccNoTran - a.creditOccNoTran ) * direction, 0 ) AS total FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectId = '{param4}' AND a.level1 = 1 AND a.subMonth <= {param5} 
FINDG640102=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, a.dataName, SUM(a.remain) AS remain, SUM(a.debitOcc) AS debitOcc, SUM(a.creditOcc) AS creditOcc, SUM(a.balance) AS balance, a.level1, a.isLeaf1 FROM ( SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, IF ( a.currency = '0', '\u4EBA\u6C11\u5E01', currency ) AS dataName, CASE WHEN a.subMonth = 1 THEN a.remain END AS remain, ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction AS debitOcc, ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction AS creditOcc, CASE WHEN a.subMonth = {param5} THEN a.balance END AS balance, a.level1, a.isLeaf1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth <= {param5} AND a.subjectId LIKE '{param4}%' AND a.isLeaf1 = 1 ) a GROUP BY a.customerId, a.subjectId
#6402-0100-\u5176\u4ED6\u4E1A\u52A1\u6210\u672C\u660E\u7EC6\u8868
FINDG640201=SELECT CONCAT(a.subMonth, "\u6708") AS month, IFNULL(( a.debitOccNoTran - a.creditOccNoTran ) * direction, 0 ) AS total FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectId = '{param4}' AND a.subMonth <= {param5} 
#6403-0100-\u8425\u4E1A\u7A0E\u8D39\uFF08\u7A0E\u91D1\u53CA\u9644\u52A0\uFF09\u660E\u7EC6\u4F59\u989D\u8868
FINDG640301=( SELECT a.customerId, a.subjectId, IFNULL(b.remain, 0) AS remain, SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS balance, a.subjectFullName AS subjectFullName1, "" AS assItemId, "" AS assItemName FROM {lockDbName}.fin_account a LEFT JOIN ( SELECT a.subjectId, SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS remain FROM {lockDbName}.fin_account a WHERE a.isLeaf1 = 1 AND a.customerId = {param1} AND a.yyyy = {param2} -1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param6} GROUP BY a.customerId, a.yyyy, a.subjectId ) b ON b.subjectId = a.subjectId WHERE a.isLeaf1 = 1 AND a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} GROUP BY a.customerId, a.subjectId ORDER BY a.customerId, a.subjectId ) UNION ( SELECT a.customerId, a.subjectId, SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS remain, IFNULL(b.remain, 0) AS balance, a.subjectFullName AS subjectFullName1, "" AS assItemId, "" AS assItemName FROM {lockDbName}.fin_account a LEFT JOIN ( SELECT a.subjectId, SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS remain FROM {lockDbName}.fin_account a WHERE a.isLeaf1 = 1 AND a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} GROUP BY a.customerId, a.yyyy, a.subjectId ) b ON b.subjectId = a.subjectId WHERE a.isLeaf1 = 1 AND a.customerId = {param1} AND a.yyyy = {param2} -1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param6} GROUP BY a.customerId, a.subjectId ORDER BY a.customerId, a.subjectId )
#6403-0400-\u590D\u6838\u5176\u52FE\u7A3D\u5173\u7CFB
FINDG640304=SELECT a.subjectId, a.subjectName, REPLACE( a.subjectName, '\u7A0E\u91D1\u53CA\u9644\u52A0-', "" ) AS subjectFullName1, SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS debitOccNoTran FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} AND a.isLeaf1 = 1 GROUP BY a.subjectId
#6601-0100-\u9500\u552E\u8D39\u7528\u660E\u7EC6\u4F59\u989D\u8868
FINDG660101=SELECT a.customerId, a.subjectId, a.remain, a.balance, a.subjectFullName AS subjectFullName1, "" AS assItemId, "" AS assItemName, a.isLeaf1, a.level1 FROM ( SELECT a.customerId, a.subjectId, SUM(a.remain) AS remain, SUM(a.balance) AS balance, a.subjectFullName, a.isLeaf1, a.level1 FROM (( SELECT a.customerId, SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS remain, IFNULL(b.remain, 0) AS balance, a.subjectFullName AS subjectFullName, a.subjectId, a.isLeaf1, a.level1 FROM {lockDbName}.fin_account a LEFT JOIN ( SELECT a.subjectId, SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS remain, a.isLeaf1, a.level1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} /*START #param7# AND a.isLeaf1 = 1 #param7# END*/ /*START #param8# AND ( (a.level1 = 3 ) OR ( a.isLeaf1 = 1 AND a.level1 = 2) ) #param8# END*/ /*START #param9# AND a.level1 = 2 #param9# END*/ /*START #param10# AND a.level1 = 1 #param10# END*/ AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} GROUP BY a.customerId, a.yyyy, a.subjectId ) b ON b.subjectId = a.subjectId WHERE a.customerId = {param1} AND a.yyyy = {param2} -1 /*START #param7# AND a.isLeaf1 = 1 #param7# END*/ /*START #param8# AND ( (a.level1 = 3 ) OR ( a.isLeaf1 = 1 AND a.level1 = 2) ) #param8# END*/ /*START #param9# AND a.level1 = 2 #param9# END*/ /*START #param10# AND a.level1 = 1 #param10# END*/ AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param6} GROUP BY a.customerId, a.subjectId ORDER BY a.customerId, a.subjectId ) UNION ( SELECT a.customerId, IFNULL(b.remain, 0) AS remain, SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS balance, a.subjectFullName AS subjectFullName, a.subjectId, a.isLeaf1, a.level1 FROM {lockDbName}.fin_account a LEFT JOIN ( SELECT a.subjectId, SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS remain, a.isLeaf1, a.level1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} -1 /*START #param7# AND a.isLeaf1 = 1 #param7# END*/ /*START #param8# AND ( (a.level1 = 3 ) OR ( a.isLeaf1 = 1 AND a.level1 = 2) ) #param8# END*/ /*START #param9# AND a.level1 = 2 #param9# END*/ /*START #param10# AND a.level1 = 1 #param10# END*/ AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param6} GROUP BY a.customerId, a.yyyy, a.subjectId ) b ON b.subjectId = a.subjectId WHERE a.customerId = {param1} AND a.yyyy = {param2} /*START #param7# AND a.isLeaf1 = 1 #param7# END*/ /*START #param8# AND ( (a.level1 = 3 ) OR ( a.isLeaf1 = 1 AND a.level1 = 2) ) #param8# END*/ /*START #param9# AND a.level1 = 2 #param9# END*/ /*START #param10# AND a.level1 = 1 #param10# END*/ AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} GROUP BY a.customerId, a.subjectId ORDER BY a.customerId, a.subjectId )) a GROUP BY a.customerId, a.subjectId ) a GROUP BY a.customerId, a.subjectId ORDER BY a.subjectId
#6601-0300-\u9500\u552E\u8D39\u7528\u5206\u6790\u6027\u590D\u6838\u4E0E\u8425\u4E1A\u6536\u5165\u95F4\u53D8\u52A8\u8D8B\u52BF\u6BD4\u8F83
FINDG660103=(SELECT a.yyyy AS subYearMonth, SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS sellBalance, a.subjectFullName AS subjectFullName, ( SELECT SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS sellBalance FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND ( a.subjectId = '{param5}' OR a.subjectId = '{param6}' ) AND a.subMonth <= {param7} GROUP BY a.customerId, a.yyyy ORDER BY a.customerId, a.yyyy, a.subjectId ) AS mainBalance FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectId = '{param4}' AND a.subMonth <= {param7} GROUP BY a.customerId, a.yyyy, a.subjectId ORDER BY a.customerId, a.yyyy, a.subjectId) UNION (SELECT a.yyyy AS subYearMonth, SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS sellBalance, a.subjectFullName AS subjectFullName, ( SELECT SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS sellBalance FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} -1 AND ( a.subjectId = '{param5}' OR a.subjectId = '{param6}' ) AND a.subMonth <= {param7} GROUP BY a.customerId, a.yyyy ORDER BY a.customerId, a.yyyy, a.subjectId ) AS mainBalance FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} -1 AND a.subjectId = '{param4}' AND a.subMonth <= {param7} GROUP BY a.customerId, a.yyyy, a.subjectId ORDER BY a.customerId, a.yyyy, a.subjectId)
#6601-0400-\u9500\u552E\u8D39\u7528\u5206\u6790\u6027\u590D\u6838\u6708\u4EFD\u95F4\u53CA\u4E0E\u4E0A\u671F\u6BD4\u8F83
FINDG660104=SELECT CONCAT(a1.subMonth, '\u6708') AS subMonth, ( a1.debitOccNoTran - a1.creditOccNoTran ) * a1.direction AS sellBalance, IFNULL(( SELECT ( a2.debitOccNoTran - a2.creditOccNoTran ) * a2.direction AS balance FROM {lockDbName}.fin_account a2 WHERE a2.customerId = {param1} AND a2.yyyy = {param2} AND a2.subjectId = '{param5}' AND a2.subMonth = a1.subMonth ), 0 ) AS mainBalance, IFNULL(( SELECT ( a3.debitOccNoTran - a3.creditOccNoTran ) * a3.direction AS balance FROM {lockDbName}.fin_account a3 WHERE a3.customerId = {param1} AND a3.yyyy = {param3} AND a3.subjectId = '{param4}' AND a3.subMonth = a1.subMonth ), 0 ) AS lastSellBalance, IFNULL(( SELECT ( a4.debitOccNoTran - a4.creditOccNoTran ) * a4.direction AS balance FROM {lockDbName}.fin_account a4 WHERE a4.customerId = {param1} AND a4.yyyy = {param3} AND a4.subjectId = '{param5}' AND a4.subMonth = a1.subMonth ), 0 ) AS lastMainBalance FROM {lockDbName}.fin_account a1 WHERE a1.customerId = {param1} AND a1.yyyy = {param2} AND a1.subjectId = '{param4}' AND a1.subMonth <= {param6} GROUP BY a1.subMonth
FINDG660105=SELECT IFNULL(SUM(a.balance), 0) AS balance, IFNULL(SUM(b.lastBalance), 0) AS lastBalance FROM ( SELECT subMonth, subjectName, ( debitOccNoTran - creditOccNoTran ) * direction AS balance FROM {lockDbName}.fin_account WHERE customerId = {param1} AND yyyy = {param2} AND subjectId = '{param4}' AND subMonth <= {param5} ) a LEFT JOIN ( SELECT subMonth, subjectName, ( debitOccNoTran - creditOccNoTran ) * direction AS lastBalance FROM {lockDbName}.fin_account WHERE customerId = {param1} AND yyyy = {param2} -1 AND subjectId = '{param4}' AND subMonth <= {param6} ) b ON a.subMonth = b.subMonth AND a.subjectName = b.subjectName
FINDG660106=SELECT a.subjectId, a.subjectName AS accName, a.balance, a.lastBalance FROM ( SELECT IFNULL(a.subjectId, b.subjectId) AS subjectId, IFNULL(a.subjectName, b.subjectName) AS subjectName, IFNULL(a.balance, 0) AS balance, IFNULL(b.balance, 0) AS lastBalance FROM ( SELECT subjectId, subjectName, SUM(( debitOccNoTran - creditOccNoTran ) * direction ) AS balance FROM {lockDbName}.fin_account WHERE customerId = {param1} AND yyyy = {param2} AND isLeaf1 = 1 AND subjectId LIKE '{param4}%' AND subjectId <> '{param4}' AND subMonth <= {param5} GROUP BY subjectName ) a LEFT JOIN ( SELECT subjectId, subjectName, SUM(( debitOccNoTran - creditOccNoTran ) * direction ) AS balance FROM {lockDbName}.fin_account WHERE customerId = {param1} AND yyyy = {param2} -1 AND isLeaf1 = 1 AND subjectId LIKE '{param4}%' AND subjectId <> '{param4}' AND subMonth <= {param6} GROUP BY subjectName ) b ON a.subjectName = b.subjectName UNION SELECT IFNULL(a.subjectId, b.subjectId) AS subjectId, IFNULL(a.subjectName, b.subjectName) AS subjectName, IFNULL(a.balance, 0) AS balance, IFNULL(b.balance, 0) AS lastBalance FROM ( SELECT subjectId, subjectName, SUM(( debitOccNoTran - creditOccNoTran ) * direction ) AS balance FROM {lockDbName}.fin_account WHERE customerId = {param1} AND yyyy = {param2} AND isLeaf1 = 1 AND subjectId LIKE '{param4}%' AND subjectId <> '{param4}' AND subMonth <= {param5} GROUP BY subjectName ) a RIGHT JOIN ( SELECT subjectId, subjectName, SUM(( debitOccNoTran - creditOccNoTran ) * direction ) AS balance FROM {lockDbName}.fin_account WHERE customerId = {param1} AND yyyy = {param2} -1 AND isLeaf1 = 1 AND subjectId LIKE '{param4}%' AND subjectId <> '{param4}' AND subMonth <= {param6} GROUP BY subjectName ) b ON a.subjectName = b.subjectName ) a ORDER BY a.subjectId
FINDG660107=SELECT a.subjectId, a.subjectName, IFNULL(MAX(a.balance1), 0) AS balance1, IFNULL(MAX(a.balance2), 0) AS balance2, IFNULL(MAX(a.balance3), 0) AS balance3, IFNULL(MAX(a.balance4), 0) AS balance4, IFNULL(MAX(a.balance5), 0) AS balance5, IFNULL(MAX(a.balance6), 0) AS balance6, IFNULL(MAX(a.balance7), 0) AS balance7, IFNULL(MAX(a.balance8), 0) AS balance8, IFNULL(MAX(a.balance9), 0) AS balance9, IFNULL(MAX(a.balance10), 0) AS balance10, IFNULL(MAX(a.balance11), 0) AS balance11, IFNULL(MAX(a.balance12), 0) AS balance12 FROM ( SELECT a.subjectId, a.subjectName, CASE WHEN a.subMonth = 1 THEN ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction END AS balance1, CASE WHEN a.subMonth = 2 THEN ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction END AS balance2, CASE WHEN a.subMonth = 3 THEN ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction END AS balance3, CASE WHEN a.subMonth = 4 THEN ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction END AS balance4, CASE WHEN a.subMonth = 5 THEN ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction END AS balance5, CASE WHEN a.subMonth = 6 THEN ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction END AS balance6, CASE WHEN a.subMonth = 7 THEN ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction END AS balance7, CASE WHEN a.subMonth = 8 THEN ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction END AS balance8, CASE WHEN a.subMonth = 9 THEN ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction END AS balance9, CASE WHEN a.subMonth = 10 THEN ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction END AS balance10, CASE WHEN a.subMonth = 11 THEN ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction END AS balance11, CASE WHEN a.subMonth = 12 THEN ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction END AS balance12 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ) a GROUP BY a.subjectId, a.subjectName
#6601-0500-\u9500\u552E\u8D39\u7528\u5206\u6790\u6027\u590D\u6838\u540C\u671F\u6BD4\u8F83
FINDG660108=( SELECT a.subjectId, a.subjectName, IFNULL((( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ), 0 ) AS balance, IFNULL((( b.debitOccNoTran - b.creditOccNoTran ) * a.direction ), 0 ) AS lastbalance FROM {lockDbName}.fin_account a LEFT JOIN {lockDbName}.fin_account b ON a.customerId = b.customerId AND a.subjectId = b.subjectId AND b.yyyy = {param2} - 1 AND b.subMonth <= {param6} WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} GROUP BY a.subjectId ) UNION ( SELECT a.subjectId, a.subjectName, IFNULL((( b.debitOccNoTran - b.creditOccNoTran ) * a.direction ), 0 ) AS balance, IFNULL((( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ), 0 ) AS lastbalance FROM {lockDbName}.fin_account a LEFT JOIN {lockDbName}.fin_account b ON a.customerId = b.customerId AND a.subjectId = b.subjectId AND b.yyyy = {param2} AND b.subMonth <= {param5} WHERE a.customerId = {param1} AND a.yyyy = {param2} - 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param6} GROUP BY a.subjectId )
#6602-0100-\u7BA1\u7406\u8D39\u7528\u660E\u7EC6\u4F59\u989D\u8868
FINDG660201=SELECT a.customerId, a.subjectId, a.subjectFullName, "" AS assItemId, "" AS assItemName, SUM(a.remain) AS remain, SUM(a.balance) AS balance, a.isLeaf1, a.level1 FROM (( SELECT a.customerId, a.subjectId, a.subjectFullName AS subjectFullName, SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS remain, 0.0000 AS balance, a.isLeaf1, a.level1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} -1 /*START #param7# AND a.isLeaf1 = 1 #param7# END*/ /*START #param8# AND ( (a.level1 = 3 ) OR ( a.isLeaf1 = 1 AND a.level1 = 2) ) #param8# END*/ /*START #param9# AND a.level1 = 2 #param9# END*/ /*START #param10# AND a.level1 = 1 #param10# END*/ AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param6} GROUP BY a.customerId, a.subjectId ORDER BY a.customerId, a.subjectId ) UNION ALL ( SELECT a.customerId, a.subjectId, a.subjectFullName AS subjectFullName, 0.0000 AS remain, SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS balance, a.isLeaf1, a.level1 FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} /*START #param7# AND a.isLeaf1 = 1 #param7# END*/ /*START #param8# AND ( (a.level1 = 3 ) OR ( a.isLeaf1 = 1 AND a.level1 = 2) ) #param8# END*/ /*START #param9# AND a.level1 = 2 #param9# END*/ /*START #param10# AND a.level1 = 1 #param10# END*/ AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} GROUP BY a.customerId, a.subjectId ORDER BY a.customerId, a.subjectId )) a GROUP BY a.customerId, a.subjectId
#6602-0200-\u5206\u6790\u6027\u590D\u6838\u4E0E\u4E0A\u671F\u6BD4\u8F83
FINDG660202=SELECT a.customerId, a.subjectId, a.subjectFullName, SUM(a.remain) AS remain, SUM(a.balance) AS balance FROM (( SELECT a.customerId, a.subjectId, a.subjectFullName, 0.0000 AS remain, SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS balance FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} GROUP BY a.customerId, a.subjectId ORDER BY a.customerId, a.subjectId ) UNION ALL ( SELECT a.customerId, a.subjectId, a.subjectFullName, SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS remain, 0.0000 AS balance FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} - 1 AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param6} GROUP BY a.customerId, a.subjectId ORDER BY a.customerId, a.subjectId )) a GROUP BY a.customerId, a.subjectId, a.subjectFullName
#6602-0300-\u5206\u6790\u6027\u590D\u6838\u6708\u4EFD\u95F4\u6BD4\u8F83
FINDG660203=SELECT a.customerId, a.yyyy, a.subjectId, SUM( CASE WHEN a.subMonth = 1 THEN ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ELSE 0 END ) AS balance1, SUM( CASE WHEN a.subMonth = 2 THEN ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ELSE 0 END ) AS balance2, SUM( CASE WHEN a.subMonth = 3 THEN ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ELSE 0 END ) AS balance3, SUM( CASE WHEN a.subMonth = 4 THEN ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ELSE 0 END ) AS balance4, SUM( CASE WHEN a.subMonth = 5 THEN ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ELSE 0 END ) AS balance5, SUM( CASE WHEN a.subMonth = 6 THEN ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ELSE 0 END ) AS balance6, SUM( CASE WHEN a.subMonth = 7 THEN ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ELSE 0 END ) AS balance7, SUM( CASE WHEN a.subMonth = 8 THEN ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ELSE 0 END ) AS balance8, SUM( CASE WHEN a.subMonth = 9 THEN ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ELSE 0 END ) AS balance9, SUM( CASE WHEN a.subMonth = 10 THEN ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ELSE 0 END ) AS balance10, SUM( CASE WHEN a.subMonth = 11 THEN ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ELSE 0 END ) AS balance11, SUM( CASE WHEN a.subMonth = 12 THEN ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ELSE 0 END ) AS balance12, a.subjectFullName FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} GROUP BY a.customerId, a.yyyy, a.subjectId ORDER BY a.customerId, a.yyyy, a.subjectId
#6602-0400-\u7814\u53D1\u8D39\u7528\u5206\u9879\u76EE\u5206\u6790\u6027\u590D\u6838
FINDG660204=SELECT DISTINCT a.customerId, a.yyyy, a.subjectId, a.subjectFullName AS subjectFullName FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ORDER BY a.customerId, a.yyyy, a.subjectId
#6602-0500-\u7814\u53D1\u8D39\u7528\u5206\u9879\u76EE\u8FFD\u67E5
FINDG660205=SELECT a.vchDate, a.oldVoucherId, a.summary, a.subjectId, a.subjectFullName AS subjectFullName1, SUBSTRING_INDEX( SUBSTRING_INDEX(a.subjectFullName, "/", 2), "/", -1 ) AS secondName, CASE WHEN a.direction = 1 THEN a.direction * a.occurValue ELSE "" END AS debitOcc, CASE WHEN a.direction = -1 THEN a.direction * a.occurValue ELSE "" END AS creditOcc FROM {lockDbName}.fin_subjectentry a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectId LIKE '{param4}%' AND a.month <= {param5} ORDER BY a.customerId, a.yyyy, a.vchDate, a.oldVoucherId
#6602-1400-\u7BA1\u7406\u8D39\u7528\u51ED\u8BC1\u6D4B\u8BD5
FINDG660214=SELECT a.vchDate, a.oldVoucherId, a.summary, a.subjectId, a.subjectFullName AS subjectFullName1, SUBSTRING_INDEX( SUBSTRING_INDEX(a.subjectFullName, "/", 2), "/", -1 ) AS secondName, CASE WHEN a.direction = 1 THEN a.direction * a.occurValue ELSE "" END AS debitOcc, CASE WHEN a.direction = -1 THEN a.direction * a.occurValue ELSE "" END AS creditOcc FROM {lockDbName}.fin_subjectentry a WHERE a.customerId = {param1} AND a.vchDate >= '{param5}' AND a.vchDate <= '{param6}' AND a.subjectId LIKE '{param4}%' AND a.month <= {param7} ORDER BY a.customerId, a.yyyy, a.vchDate, a.oldVoucherId
#6602-1500-\u7BA1\u7406\u8D39\u7528\u622A\u6B62\u6027\u6D4B\u8BD5
FINDG660215=SELECT a.yyyy, a.vchDate, a.oldVoucherId, a.summary, a.subjectId, a.subjectFullName AS subjectFullName1, a.direction * a.occurValue AS occurValue FROM {lockDbName}.fin_subjectentry a WHERE a.customerId = {param1} AND a.vchDate >= '{param5}' AND a.vchDate <= '{param6}' AND a.subjectId LIKE '{param4}%' AND a.month <= {param7} ORDER BY a.customerId, a.yyyy, a.vchDate, a.oldVoucherId
#6602-1600-\u7BA1\u7406\u8D39\u7528\u622A\u6B62\u6027\u6D4B\u8BD5
FINDG660216=SELECT DATE_FORMAT(a.vchDate, '%Y-%m') AS yyyy, a.vchDate, a.oldVoucherId, a.summary, a.subjectId, a.subjectFullName, a.direction * a.occurValue AS occurValue FROM {lockDbName}.fin_subjectentry a WHERE a.customerId = {param1} AND a.vchDate >= '{param5}' AND a.vchDate <= '{param6}' AND a.subjectId LIKE '{param4}%' AND a.month <= {param7} ORDER BY a.customerId, a.yyyy, a.vchDate, a.oldVoucherId
#6603-0100-\u8D22\u52A1\u8D39\u7528\u660E\u7EC6\u8868
FINDG660301=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, "" AS assItemId, "" AS assItemName, CASE WHEN a.level1 = 1 THEN a.subjectName WHEN a.level1 = 2 THEN a.subjectName ELSE SUBSTRING(a.subjectFullName, 6) END AS name1, CASE WHEN a.level1 = 1 THEN a.subjectName WHEN a.level1 = 2 THEN a.subjectFullName ELSE SUBSTRING_INDEX(a.subjectFullName, '/', 2) END AS name2, a.thisyear, a.lastyear, a.isLeaf1, a.level1, a.direction FROM ( SELECT a.customerId, a.subjectName, a.subjectId, IFNULL(a.thisyear, 0) AS thisyear, IFNULL(b.thisyear, 0) AS lastyear, a.subjectFullName, a.isLeaf1, a.level1, a.direction FROM ( SELECT a.customerId, a.subjectName AS subjectName, a.subjectId AS subjectId, SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS thisyear, a.subjectFullName, a.isLeaf1, a.level1, a.direction FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} GROUP BY a.customerId, a.subjectId, a.yyyy ) a LEFT JOIN ( SELECT a.customerId, a.subjectName AS subjectName, a.subjectId AS subjectId, SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS thisyear, a.isLeaf1, a.level1, a.direction FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} - 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param6} GROUP BY a.customerId, a.subjectId, a.yyyy ) b ON a.customerId = b.customerId AND a.subjectId = b.subjectId AND a.isleaf1 = b.isleaf1 UNION SELECT a.customerId, a.subjectName, a.subjectId, IFNULL(b.thisyear, 0) AS thisyear, IFNULL(a.thisyear, 0) AS lastyear, a.subjectFullName, a.isLeaf1, a.level1, a.direction FROM ( SELECT a.customerId, a.subjectName AS subjectName, a.subjectId AS subjectId, SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS thisyear, a.subjectFullName, a.isLeaf1, a.level1, a.direction FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} - 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param6} GROUP BY a.customerId, a.subjectId, a.yyyy ) a LEFT JOIN ( SELECT a.customerId, a.subjectName AS subjectName, a.subjectId AS subjectId, SUM(( a.debitOccNoTran - a.creditOccNoTran )) * a.direction AS thisyear, a.isLeaf1, a.level1, a.direction FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} GROUP BY a.customerId, a.subjectId, a.yyyy ) b ON a.customerId = b.customerId AND a.subjectId = b.subjectId AND a.isleaf1 = b.isleaf1 ) a WHERE 1 = 1 /*START #param7# AND a.isLeaf1 = 1 #param7# END*/ /*START #param8# AND ( (a.level1 = 3 ) OR ( a.isLeaf1 = 1 AND a.level1 = 2) ) #param8# END*/ /*START #param9# AND a.level1 = 2 #param9# END*/ /*START #param10# AND a.level1 = 1 #param10# END*/ GROUP BY a.subjectId ORDER BY a.subjectId
#6603-0200-\u8D22\u52A1\u8D39\u7528\u4E0E\u4E0A\u671F\u6BD4\u8F83
FINDG660303=SELECT a.customerId, a.subjectId, a.subjectName, a.subjectFullName, CASE WHEN a.level1 = 1 THEN a.subjectName WHEN a.level1 = 2 THEN a.subjectName ELSE SUBSTRING(a.subjectFullName, 6) END AS name1, CASE WHEN a.level1 = 1 THEN a.subjectName WHEN a.level1 = 2 THEN a.subjectFullName ELSE SUBSTRING_INDEX(a.subjectFullName, '/', 2) END AS name2, a.thisyear, a.lastyear, a.isLeaf1, a.level1, a.direction FROM ( SELECT a.customerId, a.subjectName, a.subjectId, IFNULL(a.thisyear, 0) AS thisyear, IFNULL(b.thisyear, 0) AS lastyear, a.subjectFullName, a.isLeaf1, a.level1, a.direction FROM ( SELECT a.customerId, a.subjectName AS subjectName, a.subjectId AS subjectId, SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS thisyear, a.subjectFullName, a.isLeaf1, a.level1, a.direction FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} GROUP BY a.customerId, a.subjectId, a.yyyy ) a LEFT JOIN ( SELECT a.customerId, a.subjectName AS subjectName, a.subjectId AS subjectId, SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS thisyear, a.isLeaf1, a.level1, a.direction FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} - 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param6} GROUP BY a.customerId, a.subjectId, a.yyyy ) b ON a.customerId = b.customerId AND a.subjectId = b.subjectId AND a.isleaf1 = b.isleaf1 UNION SELECT a.customerId, a.subjectName, a.subjectId, IFNULL(b.thisyear, 0) AS thisyear, IFNULL(a.thisyear, 0) AS lastyear, a.subjectFullName, a.isLeaf1, a.level1, a.direction FROM ( SELECT a.customerId, a.subjectName AS subjectName, a.subjectId AS subjectId, SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS thisyear, a.subjectFullName, a.isLeaf1, a.level1, a.direction FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} - 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param6} GROUP BY a.customerId, a.subjectId, a.yyyy ) a LEFT JOIN ( SELECT a.customerId, a.subjectName AS subjectName, a.subjectId AS subjectId, SUM(( a.debitOccNoTran - a.creditOccNoTran )) * a.direction AS thisyear, a.isLeaf1, a.level1, a.direction FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} GROUP BY a.customerId, a.subjectId, a.yyyy ) b ON a.customerId = b.customerId AND a.subjectId = b.subjectId AND a.isleaf1 = b.isleaf1 ) a WHERE 1 = 1 /*START #param7# AND a.isLeaf1 = 1 #param7# END*/ /*START #param8# AND ( (a.level1 = 3 ) OR ( a.isLeaf1 = 1 AND a.level1 = 2) OR ( a.isLeaf1 = 1 AND a.level1 = 1) ) #param8# END*/ /*START #param9# AND a.level1 = 2 #param9# END*/ /*START #param10# AND a.level1 = 1 #param10# END*/ GROUP BY a.subjectId ORDER BY a.subjectId
#6603-0700-\u8D22\u52A1\u8D39\u7528\u622A\u6B62\u6027\u6D4B\u8BD5
FINDG660307=SELECT a.yyyy, a.voucherId, a.typeId, a.occurValue, a.vchDate, a.summary, a.subjectName as subjectname1 FROM {lockDbName}.fin_subjectentry a WHERE a.customerId = {param1} AND a.subjectId LIKE '{param4}%' AND a.vchDate >= '{param5}' AND a.vchDate <= '{param6}' AND a.month <= {param7}
#6604-0100-\u7814\u53D1\u8D39\u7528\u660E\u7EC6\u8868
FINDG660401=SELECT a.subjectId, a.subjectName, "" AS assItemId, "" AS assItemName, IFNULL(a.amount, 0) AS amountC, IFNULL(b.amount, 0) AS amountP FROM ( SELECT a.subjectId, a.subjectName, SUM(amount) AS amount, IF (a.direction = - 1, '\u8D37', '\u501F') AS direction FROM ( SELECT a.subjectId, a.subjectName, ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction AS amount, a.direction FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ) a GROUP BY a.subjectId ) a LEFT JOIN ( SELECT a.subjectId, a.subjectName, SUM(amount) AS amount, IF (a.direction = - 1, '\u8D37', '\u501F') AS direction FROM ( SELECT a.subjectId, a.subjectName, ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction AS amount, a.direction FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param6} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ) a GROUP BY a.subjectId ) b ON a.subjectId = b.subjectId UNION SELECT a.subjectId, a.subjectName, "" AS assItemId, "" AS assItemName, IFNULL(b.amount, 0) AS amountC, IFNULL(a.amount, 0) AS amountP FROM ( SELECT a.subjectId, a.subjectName, SUM(amount) AS amount, IF (a.direction = - 1, '\u8D37', '\u501F') AS direction FROM ( SELECT a.subjectId, a.subjectName, ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction AS amount, a.direction FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param6} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ) a GROUP BY a.subjectId ) a LEFT JOIN ( SELECT a.subjectId, a.subjectName, SUM(amount) AS amount, IF (a.direction = - 1, '\u8D37', '\u501F') AS direction FROM ( SELECT a.subjectId, a.subjectName, ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction AS amount, a.direction FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ) a GROUP BY a.subjectId ) b ON a.subjectId = b.subjectId
#6701-0100-\u8D44\u4EA7\u51CF\u503C\u635F\u5931\u660E\u7EC6\u8868
FINDG670101=( SELECT a.customerId, a.subjectId, IFNULL(b.remain, 0) AS remain, SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS balance, a.subjectFullName AS subjectFullName, "" AS assItemId, "" AS assItemName FROM {lockDbName}.fin_account a LEFT JOIN ( SELECT a.subjectId, SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS remain FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} -1 AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param6} GROUP BY a.customerId, a.yyyy, a.subjectId ) b ON b.subjectId = a.subjectId WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} GROUP BY a.customerId, a.subjectId ORDER BY a.customerId, a.subjectId ) UNION ( SELECT a.customerId, a.subjectId, SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS remain, IFNULL(b.remain, 0) AS balance, a.subjectFullName AS subjectFullName, "" AS assItemId, "" AS assItemName FROM {lockDbName}.fin_account a LEFT JOIN ( SELECT a.subjectId, SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS remain FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} GROUP BY a.customerId, a.yyyy, a.subjectId ) b ON b.subjectId = a.subjectId WHERE a.customerId = {param1} AND a.yyyy = {param2} -1 AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param6} GROUP BY a.customerId, a.subjectId ORDER BY a.customerId, a.subjectId )
#6701-0200-\u8D44\u4EA7\u51CF\u503C\u635F\u5931\u6838\u5BF9\u8868
FINDG670102=SELECT a.customerId, a.yyyy, a.subjectId, IFNULL(b.remain, 0) AS remain, SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS balance, a.subjectFullName AS subjectFullName FROM {lockDbName}.fin_account a LEFT JOIN ( SELECT a.subjectId, SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS remain FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} -1 AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param6} GROUP BY a.customerId, a.yyyy, a.subjectId ) b ON b.subjectId = a.subjectId WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} GROUP BY a.customerId, a.yyyy, a.subjectId ORDER BY a.customerId, a.yyyy, a.subjectId
#6705-0100-\u4FE1\u7528\u51CF\u503C\u635F\u5931\u660E\u7EC6\u8868
FINDG670501=SELECT a.subjectId, a.subjectName, "" AS assItemId, "" AS assItemName, IFNULL(a.amount, 0) AS amountC, IFNULL(b.amount, 0) AS amountP FROM ( SELECT a.subjectId, a.subjectName, SUM(amount) AS amount, IF (a.direction = - 1, '\u8D37', '\u501F') AS direction FROM ( SELECT a.subjectId, a.subjectName, ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction AS amount, a.direction FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ) a GROUP BY a.subjectId ) a LEFT JOIN ( SELECT a.subjectId, a.subjectName, SUM(amount) AS amount, IF (a.direction = - 1, '\u8D37', '\u501F') AS direction FROM ( SELECT a.subjectId, a.subjectName, ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction AS amount, a.direction FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param6} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ) a GROUP BY a.subjectId ) b ON a.subjectId = b.subjectId UNION SELECT a.subjectId, a.subjectName, "" AS assItemId, "" AS assItemName, IFNULL(b.amount, 0) AS amountC, IFNULL(a.amount, 0) AS amountP FROM ( SELECT a.subjectId, a.subjectName, SUM(amount) AS amount, IF (a.direction = - 1, '\u8D37', '\u501F') AS direction FROM ( SELECT a.subjectId, a.subjectName, ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction AS amount, a.direction FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param6} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ) a GROUP BY a.subjectId ) a LEFT JOIN ( SELECT a.subjectId, a.subjectName, SUM(amount) AS amount, IF (a.direction = - 1, '\u8D37', '\u501F') AS direction FROM ( SELECT a.subjectId, a.subjectName, ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction AS amount, a.direction FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ) a GROUP BY a.subjectId ) b ON a.subjectId = b.subjectId
#6709-0100-\u51C0\u655E\u53E3\u5957\u671F\u6536\u76CA\u660E\u7EC6\u8868
FINDG670901=SELECT a.subjectId, a.subjectName, "" AS assItemId, "" AS assItemName, IFNULL(a.amount, 0) AS amountC, IFNULL(b.amount, 0) AS amountP FROM ( SELECT a.subjectId, a.subjectName, SUM(amount) AS amount, IF (a.direction = - 1, '\u8D37', '\u501F') AS direction FROM ( SELECT a.subjectId, a.subjectName, ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction AS amount, a.direction FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ) a GROUP BY a.subjectId ) a LEFT JOIN ( SELECT a.subjectId, a.subjectName, SUM(amount) AS amount, IF (a.direction = - 1, '\u8D37', '\u501F') AS direction FROM ( SELECT a.subjectId, a.subjectName, ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction AS amount, a.direction FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param6} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ) a GROUP BY a.subjectId ) b ON a.subjectId = b.subjectId UNION SELECT a.subjectId, a.subjectName, "" AS assItemId, "" AS assItemName, IFNULL(b.amount, 0) AS amountC, IFNULL(a.amount, 0) AS amountP FROM ( SELECT a.subjectId, a.subjectName, SUM(amount) AS amount, IF (a.direction = - 1, '\u8D37', '\u501F') AS direction FROM ( SELECT a.subjectId, a.subjectName, ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction AS amount, a.direction FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param6} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ) a GROUP BY a.subjectId ) a LEFT JOIN ( SELECT a.subjectId, a.subjectName, SUM(amount) AS amount, IF (a.direction = - 1, '\u8D37', '\u501F') AS direction FROM ( SELECT a.subjectId, a.subjectName, ( a.debitOccNoTran - a.creditOccNoTran ) * a.direction AS amount, a.direction FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} ) a GROUP BY a.subjectId ) b ON a.subjectId = b.subjectId
#6711-0100-\u8425\u4E1A\u5916\u652F\u51FA\u660E\u7EC6\u4F59\u989D\u8868
FINDG671101=SELECT a.customerId, a.yyyy, a.subjectId, IFNULL(b.remain, 0) AS remain, SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS balance, a.subjectFullName AS subjectFullName1, "" AS assItemId, "" AS assItemName FROM {lockDbName}.fin_account a LEFT JOIN ( SELECT a.subjectId, SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS remain FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} -1 AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param6} GROUP BY a.customerId, a.yyyy, a.subjectId ) b ON b.subjectId = a.subjectId WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} GROUP BY a.customerId, a.yyyy, a.subjectId ORDER BY a.customerId, a.yyyy, a.subjectId
#6801-0100-\u6240\u5F97\u7A0E\u8D39\u7528\u660E\u7EC6\u8868
FINDG680101=SELECT a.customerId, a.yyyy, a.subjectId, IFNULL(b.remain, 0) AS remain, SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS balance, a.subjectFullName, "" AS assItemId, "" AS assItemName FROM {lockDbName}.fin_account a LEFT JOIN ( SELECT a.subjectId, SUM(( a.debitOccNoTran - a.creditOccNoTran ) * a.direction ) AS remain FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} -1 AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param6} GROUP BY a.customerId, a.yyyy, a.subjectId ) b ON b.subjectId = a.subjectId WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.isLeaf1 = 1 AND a.subjectId LIKE '{param4}%' AND a.subMonth <= {param5} GROUP BY a.customerId, a.yyyy, a.subjectId ORDER BY a.customerId, a.yyyy, a.subjectId
####################\u5E95\u7A3F\u53D6\u6570####################
####################\u62BD\u51ED\u6A21\u5757####################
#\u67E5\u8BE2\u62BD\u51ED\u8303\u56F4
FINCP100001=select distinct a.autoId,a.customerId,a.voucherId,a.vchDate,a.typeId,a.oldVoucherId,a.serail,a.summary,a.subjectId,a.subjectFullName,IF (a.direction = 1,a.occurValue,0.00) AS debitValue,IF (a.direction = -1,a.occurValue,0.00) AS crebitValue FROM {lockDbName}.fin_subjectentry a /*START #param11# inner join (SELECT t2.subjectId FROM {lockDbName}.fin_accpkgsubject t1 ,{lockDbName}.fin_accpkgsubject t2 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ={param2} AND t1.subjectId in ({param11}) AND t1.customerId = t2.customerId AND t1.yyyy = t2.yyyy AND t2.subjectFullId LIKE CONCAT(t1.subjectFullId,'/%') UNION SELECT t1.subjectId FROM {lockDbName}.fin_accpkgsubject t1 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ={param2} AND t1.subjectId in ({param11})) c on a.subjectId = c.subjectId #param11# END*/ /*START #param21# inner join (select subjectEntryId from {lockDbName}.fin_assitementry b where b.customerId = {lockCustomerId} and b.yyyy >= {param1} and b.yyyy <= {param2} and b.assItemId in ({param21})) b on a.autoId = b.subjectEntryId #param21# END*/ left join (select DISTINCT autoId from (select distinct a.autoId /*START #param14# ,b.cullSubjectId #param14# END*/ FROM {lockDbName}.fin_subjectentry a /*START #param11# inner join (SELECT t2.subjectId FROM {lockDbName}.fin_accpkgsubject t1 ,{lockDbName}.fin_accpkgsubject t2 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ={param2} AND t1.subjectId in ({param11}) AND t1.customerId = t2.customerId AND t1.yyyy = t2.yyyy AND t2.subjectFullId LIKE CONCAT(t1.subjectFullId,'/%') UNION SELECT t1.subjectId FROM {lockDbName}.fin_accpkgsubject t1 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ={param2} AND t1.subjectId in ({param11})) c on a.subjectId =c.subjectId #param11# END*/ /*START #param14# left join (select a.customerId,a.yyyy,a.voucherId,a.direction,CONCAT(',',GROUP_CONCAT(subjectId),',') as cullSubjectId FROM {lockDbName}.fin_subjectentry a where a.customerId = {lockCustomerId} AND a.yyyy >= {param1} AND a.yyyy <= {param2} group by a.customerId,a.yyyy,a.voucherId,a.direction) b on a.customerId = b.customerId and a.yyyy = b.yyyy and a.voucherId = b.voucherId and a.direction * -1 = b.direction #param14# END*/ /*START #param25# inner join (select subjectEntryId from {lockDbName}.fin_assitementry b where b.customerId = {lockCustomerId} and b.yyyy >= {param1} and b.yyyy <= {param2} and b.assItemId in ({param25})) f on a.autoId = f.subjectEntryId #param25# END*/ WHERE a.customerId = {lockCustomerId} and a.yyyy >= {param1} and a.yyyy <= {param2} /*START #param16# AND a.occurValue >='{param16}' #param16# END*/ /*START #param17# AND a.occurValue <='{param17}' #param17# END*/ /*START #param22# AND a.direction ='{param22}' #param22# END*/) d /*START #param14# where d.cullSubjectId REGEXP (select GROUP_CONCAT(CONCAT(',',subjectId,',') SEPARATOR '|') from (SELECT t2.subjectId FROM {lockDbName}.fin_accpkgsubject t1 ,{lockDbName}.fin_accpkgsubject t2 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ={param2} AND t1.subjectId in ({param14}) AND t1.customerId = t2.customerId AND t1.yyyy = t2.yyyy AND t2.subjectFullId LIKE CONCAT(t1.subjectFullId,'/%') UNION SELECT t1.subjectId FROM {lockDbName}.fin_accpkgsubject t1 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ={param2} AND t1.subjectId in ({param14})) c ) #param14# END*/) e on a.autoId = e.autoId WHERE a.customerId = {lockCustomerId} and a.yyyy >= {param1} and a.yyyy <= {param2} /*START #param12# AND a.month >='{param12}' #param12# END*/ /*START #param13# AND a.month <='{param13}' #param13# END*/ /*START #param3# AND a.vchDate >='{param3}' #param3# END*/ /*START #param4# AND a.vchDate <='{param4}' #param4# END*/ /*START #param5# AND a.typeId like '%{param5}%' #param5# END*/ /*START #param6# AND a.oldVoucherId = '{param6}' #param6# END*/ /*START #param7# AND a.summary like '%{param7}%' #param7# END*/ /*START #param8# AND a.occurValue >='{param8}' #param8# END*/ /*START #param9# AND a.occurValue <='{param9}' #param9# END*/ /*START #param10# AND a.direction ='{param10}' #param10# END*/ /*START #param20# AND CONCAT(a.yyyy,'-',a.voucherId) in ({param20}) #param20# END*/ /*START #param23# and e.autoId is null #param23# END*/ /*START #param24# and a.serail = {param24} #param24# END*/ order by a.vchDate,a.oldVoucherId,a.serail,a.subjectId
#\u67E5\u8BE2\u62BD\u51ED\u8303\u56F4\u603B\u91D1\u989D
FINCP100002=select count(distinct IF(t.entrySerail not in ({param18}),t.autoId,null)) as samplingCount,IFNULL(sum(abs(t.occurValue)),0) as totalAmount, IFNULL(sum(IF(t.entrySerail not in ({param18}),abs(t.occurValue),0.00)),0) AS amount,IFNULL(sum(IF(t.entrySerail in ({param18}),abs(t.occurValue),0.00)),0) AS cullAmount FROM (select a.autoId,a.customerId,a.yyyy,a.voucherId,a.occurValue,CONCAT(a.vchDate,'|',a.oldVoucherId,'|',a.serail,'|',a.typeId) as entrySerail FROM {lockDbName}.fin_subjectentry a /*START #param11# inner join (SELECT t2.subjectId FROM {lockDbName}.fin_accpkgsubject t1 ,{lockDbName}.fin_accpkgsubject t2 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ={param2} AND t1.subjectId in ({param11}) AND t1.customerId = t2.customerId AND t1.yyyy = t2.yyyy AND t2.subjectFullId LIKE CONCAT(t1.subjectFullId,'/%') UNION SELECT t1.subjectId FROM {lockDbName}.fin_accpkgsubject t1 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ={param2} AND t1.subjectId in ({param11})) c on a.subjectId = c.subjectId #param11# END*/ /*START #param21# inner join (select subjectEntryId from {lockDbName}.fin_assitementry b where b.customerId = {lockCustomerId} and b.yyyy >= {param1} and b.yyyy <= {param2} and b.assItemId in ({param21})) b on a.autoId = b.subjectEntryId #param21# END*/ /*START #assitemId# inner join (select subjectEntryId from {lockDbName}.fin_assitementry b where b.customerId = {lockCustomerId} and b.yyyy >= {param1} and b.yyyy <= {param2} and b.assItemId in ({assitemId})) b on a.autoId = b.subjectEntryId #assitemId# END*/ WHERE a.customerId = {lockCustomerId} and a.yyyy >= {param1} and a.yyyy <= {param2} /*START #param12# AND a.month >='{param12}' #param12# END*/ /*START #param13# AND a.month <='{param13}' #param13# END*/ /*START #param3# AND a.vchDate >='{param3}' #param3# END*/ /*START #param4# AND a.vchDate <='{param4}' #param4# END*/ /*START #param5# AND a.typeId like '%{param5}%' #param5# END*/ /*START #param6# AND a.oldVoucherId = '{param6}' #param6# END*/ /*START #param7# AND a.summary like '%{param7}%' #param7# END*/ /*START #param8# AND a.occurValue >='{param8}' #param8# END*/ /*START #param9# AND a.occurValue <='{param9}' #param9# END*/ /*START #param10# AND a.direction ='{param10}' #param10# END*/) t WHERE t.customerId = {lockCustomerId} and t.yyyy >= {param1} and t.yyyy <= {param2} /*START #param16# AND a.occurValue >='{param16}' #param16# END*/ /*START #param17# AND a.occurValue <'{param17}' #param17# END*/
#\u67E5\u8BE2\u62BD\u51ED\u603B\u6837\u672C
FINCP100003=select t.autoId,t.yyyy,t.voucherId,t.balanceF,t.entrySerail from (select a.autoId,a.customerId,a.yyyy,a.voucherId,a.occurValue AS balanceF,a.vchDate,CONCAT(a.vchDate,'|',a.oldVoucherId,'|',a.serail,'|',a.typeId) as entrySerail FROM {lockDbName}.fin_subjectentry a /*START #param11# inner join (SELECT t2.subjectId FROM {lockDbName}.fin_accpkgsubject t1 ,{lockDbName}.fin_accpkgsubject t2 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ={param1} AND t1.subjectId in ({param11}) AND t1.customerId = t2.customerId AND t1.yyyy = t2.yyyy AND t2.subjectFullId LIKE CONCAT(t1.subjectFullId,'/%') UNION SELECT t1.subjectId FROM {lockDbName}.fin_accpkgsubject t1 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ={param1} AND t1.subjectId in ({param11})) c on a.subjectId = c.subjectId #param11# END*/ /*START #param21# inner join (select subjectEntryId from {lockDbName}.fin_assitementry b where b.customerId = {lockCustomerId} and b.yyyy >= {param1} and b.yyyy <= {param2} and b.assItemId in ({param21})) b on a.autoId = b.subjectEntryId #param21# END*/ /*START #assitemId# inner join (select subjectEntryId from {lockDbName}.fin_assitementry b where b.customerId = {lockCustomerId} and b.yyyy >= {param1} and b.yyyy <= {param2} and b.assItemId in ({assitemId})) b on a.autoId = b.subjectEntryId #assitemId# END*/ WHERE a.customerId = {lockCustomerId} and a.yyyy >= {param1} and a.yyyy <= {param2} /*START #param12# AND a.month >='{param12}' #param12# END*/ /*START #param13# AND a.month <='{param13}' #param13# END*/ /*START #param3# AND a.vchDate >='{param3}' #param3# END*/ /*START #param4# AND a.vchDate <='{param4}' #param4# END*/ /*START #param5# AND a.typeId like '%{param5}%' #param5# END*/ /*START #param6# AND a.oldVoucherId = '{param6}' #param6# END*/ /*START #param7# AND a.summary like '%{param7}%' #param7# END*/ /*START #param8# AND a.occurValue >={param8} #param8# END*/ /*START #param9# AND a.occurValue <={param9} #param9# END*/ /*START #param10# AND a.direction ='{param10}' #param10# END*/ /*START #param19# AND a.vchDate >'{param19}' #param19# END*/ /*START #serail# AND a.serail = {serail} #serail# END*/ /*START #isTransferVoucher# and a.voucherId not in (select distinct voucherId FROM {lockDbName}.fin_subjectentry a WHERE a.customerId = {lockCustomerId} AND a.yyyy >= {param1} AND a.yyyy <= {param2} and (a.isTransferVoucher = 1 or a.subjectFullName like '\u672C\u5E74\u5229\u6DA6%')) #isTransferVoucher# END*/) t where 1=1 /*START #param16# AND t.balanceF >={param16} #param16# END*/ /*START #param17# AND t.balanceF <{param17} #param17# END*/ /*START #param18# AND t.entrySerail not in ({param18}) #param18# END*/ /*START #param4# order by t.vchDate desc #param4# END*/ /*START #param19# order by t.vchDate asc #param19# END*/
#\u67E5\u8BE2\u79D1\u76EE\u51ED\u8BC1\u6570\u7EDF\u8BA1
FINCP100004=select t.subjectId,t.subjectFullName,t.totalCount,t.samplingCount as voucherNum,concat(ROUND(t.samplingCount/t.totalCount*100,2),'%') as rate1,t.debitOcc,t.creditOcc,t.debitOccCount,t.creditOccCount,concat(ROUND(t.debitOcc/t.debitOccCount*100,2),'%') as rate2,concat(ROUND(t.creditOcc/t.creditOccCount*100,2),'%') as rate3 from (select b.firstSubject as subjectId,b.firstSubjectName as subjectFullName,/*START #param3# count(distinct autoId) totalCount,count(distinct if(CONCAT(a.vchDate,'|',a.oldVoucherId,'|',a.serail,'|',a.typeId) in ({param3}),autoId,null)) samplingCount,IFNULL(sum(IF (CONCAT(a.vchDate,'|',a.oldVoucherId,'|',a.serail,'|',a.typeId) in ({param3}) and a.direction = 1,a.occurValue,0.00)), 0) AS debitOcc,IFNULL(sum(IF (CONCAT(a.vchDate,'|',a.oldVoucherId,'|',a.serail,'|',a.typeId) in ({param3}) and a.direction = -1,a.occurValue,0.00)), 0) AS creditOcc,IFNULL(sum(IF (a.direction = 1,a.occurValue,0.00)), 0) AS debitOccCount,IFNULL(sum(IF (a.direction = -1,a.occurValue,0.00)), 0) AS creditOccCount #param3# END*/ /*START #param4# count(distinct a.autoId) totalCount,count(distinct if(CONCAT(a.vchDate,'|',a.oldVoucherId,'|',a.serail,'|',a.typeId) in ({param4}),a.autoId,null)) samplingCount,IFNULL(sum(IF (CONCAT(a.vchDate,'|',a.oldVoucherId,'|',a.serail,'|',a.typeId) in ({param4}) and a.direction = 1,a.occurValue,0.00)), 0) AS debitOcc,IFNULL(sum(IF (CONCAT(a.vchDate,'|',a.oldVoucherId,'|',a.serail,'|',a.typeId) in ({param4}) and a.direction = -1,a.occurValue,0.00)), 0) AS creditOcc,IFNULL(sum(IF (a.direction = 1,a.occurValue,0.00)), 0) AS debitOccCount,IFNULL(sum(IF (a.direction = -1,a.occurValue,0.00)), 0) AS creditOccCount #param4# END*/ from {lockDbName}.fin_subjectentry a inner join (select distinct t.subjectId,t.subjectFullId,SUBSTRING_INDEX(t.subjectFullId,'/',1) as firstSubject,SUBSTRING_INDEX(t.subjectFullName,'/',1) as firstSubjectName from {lockDbName}.fin_accpkgsubject t WHERE customerId={lockCustomerId} and yyyy={lockYyyy}) b on a.subjectId = b.subjectId where a.customerId={lockCustomerId} and a.yyyy>={lockYyyy} and a.yyyy<={param2} and b.firstSubject = '{param5}' group by b.firstSubject,b.firstSubjectName) t where t.samplingCount > 0
#\u6839\u636E\u62BD\u51ED\u7ED3\u679C\u67E5\u8BE2\u51ED\u8BC1
FINCP100005=select a.customerId,a.yyyy,a.month,a.voucherId,a.oldVoucherId,a.typeId,a.vchDate,a.serail,a.summary,a.subjectId,a.direction,a.occurValue,a.currRate,a.currValue,a.currency,a.subjectname,a.subjectFullName,a.oppositeAccountTop,a.oppositeAccountLast,a.oppositeSubjectValue,a.oppositeTopSubjectValue,b.assItemId,b.assItemName,b.assTotalName,c.subjectFullId from {lockDbName}.fin_subjectentry a left join (select b.subjectEntryId,GROUP_CONCAT(distinct b.assItemId) as assItemId,GROUP_CONCAT(distinct b.assItemName) as assItemName,GROUP_CONCAT(distinct b.assTotalName) as assTotalName from {lockDbName}.fin_assitementry b where b.customerId = {lockCustomerId} and b.yyyy >= {lockYyyy} and b.yyyy <= {param2} /*START #param5# and b.assItemId in ({param5}) #param5# END*/ group by subjectEntryId) b on a.autoId = b.subjectEntryId left join (select distinct subjectId,subjectFullId from {lockDbName}.fin_accpkgsubject where customerId = {lockCustomerId} and yyyy >= {lockYyyy} and yyyy <= {param2}) c on a.subjectId = c.subjectId where CONCAT(a.yyyy,'-',a.voucherId) in (select CONCAT(a.yyyy,'-',a.voucherId) from {lockDbName}.fin_subjectentry a  where a.customerId = {lockCustomerId} and a.yyyy >= {lockYyyy} and a.yyyy <= {param2} /*START #param3# and a.voucherId in ({param3}) #param3# END*/ /*START #param4# AND CONCAT(a.vchDate,'|',a.oldVoucherId,'|',a.serail,'|',a.typeId) in ({param4}) #param4# END*/)
#\u67E5\u8BE2\u5254\u9664\u51ED\u8BC1
FINCP100006=select distinct a.autoId,a.voucherId,a.yyyy,CONCAT(a.vchDate,'|',a.oldVoucherId,'|',a.serail,'|',a.typeId) as entrySerail FROM {lockDbName}.fin_subjectentry a /*START #param11# inner join (SELECT t2.subjectId FROM {lockDbName}.fin_accpkgsubject t1 ,{lockDbName}.fin_accpkgsubject t2 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ={param2} AND t1.subjectId in ({param11}) AND t1.customerId = t2.customerId AND t1.yyyy = t2.yyyy AND t2.subjectFullId LIKE CONCAT(t1.subjectFullId,'/%') UNION SELECT t1.subjectId FROM {lockDbName}.fin_accpkgsubject t1 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ={param2} AND t1.subjectId in ({param11})) c on a.subjectId =c.subjectId #param11# END*/ /*START #param21# inner join (select subjectEntryId from {lockDbName}.fin_assitementry b where b.customerId = {lockCustomerId} and b.yyyy >= {param1} and b.yyyy <= {param2} and b.assItemId in ({param21})) b on a.autoId = b.subjectEntryId #param21# END*/ inner join (select DISTINCT autoId from (select distinct a.autoId /*START #param14# ,b.cullSubjectId #param14# END*/ FROM {lockDbName}.fin_subjectentry a /*START #param11# inner join (SELECT t2.subjectId FROM {lockDbName}.fin_accpkgsubject t1 ,{lockDbName}.fin_accpkgsubject t2 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ={param2} AND t1.subjectId in ({param11}) AND t1.customerId = t2.customerId AND t1.yyyy = t2.yyyy AND t2.subjectFullId LIKE CONCAT(t1.subjectFullId,'/%') UNION SELECT t1.subjectId FROM {lockDbName}.fin_accpkgsubject t1 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ={param2} AND t1.subjectId in ({param11})) c on a.subjectId =c.subjectId #param11# END*/ /*START #param14# left join (select a.customerId,a.yyyy,a.voucherId,a.direction,CONCAT(',',GROUP_CONCAT(subjectId),',') as cullSubjectId FROM {lockDbName}.fin_subjectentry a where a.customerId = {lockCustomerId} AND a.yyyy >= {param1} AND a.yyyy <= {param2} group by a.customerId,a.yyyy,a.voucherId,a.direction) b on a.customerId = b.customerId and a.yyyy = b.yyyy and a.voucherId = b.voucherId and a.direction * -1 = b.direction #param14# END*/ /*START #param25# inner join (select subjectEntryId from {lockDbName}.fin_assitementry b where b.customerId = {lockCustomerId} and b.yyyy >= {param1} and b.yyyy <= {param2} and b.assItemId in ({param25})) f on a.autoId = f.subjectEntryId #param25# END*/ WHERE a.customerId = {lockCustomerId} and a.yyyy >= {param1} and a.yyyy <= {param2} /*START #param16# AND a.occurValue >='{param16}' #param16# END*/ /*START #param17# AND a.occurValue <='{param17}' #param17# END*/ /*START #param22# AND a.direction ='{param22}' #param22# END*/) d /*START #param14# where d.cullSubjectId REGEXP (select GROUP_CONCAT(CONCAT(',',subjectId,',') SEPARATOR '|') from (SELECT t2.subjectId FROM {lockDbName}.fin_accpkgsubject t1 ,{lockDbName}.fin_accpkgsubject t2 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ={param2} AND t1.subjectId in ({param14}) AND t1.customerId = t2.customerId AND t1.yyyy = t2.yyyy AND t2.subjectFullId LIKE CONCAT(t1.subjectFullId,'/%') UNION SELECT t1.subjectId FROM {lockDbName}.fin_accpkgsubject t1 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ={param2} AND t1.subjectId in ({param14})) c ) #param14# END*/) e on a.autoId = e.autoId WHERE a.customerId = {lockCustomerId} and a.yyyy >= {param1} and a.yyyy <= {param2} /*START #param12# AND a.month >='{param12}' #param12# END*/ /*START #param13# AND a.month <='{param13}' #param13# END*/ /*START #param3# AND a.vchDate >='{param3}' #param3# END*/ /*START #param4# AND a.vchDate <='{param4}' #param4# END*/ /*START #param5# AND a.typeId ='{param5}' #param5# END*/ /*START #param6# AND a.oldVoucherId = '{param6}' #param6# END*/ /*START #param7# AND a.summary like '%{param7}%' #param7# END*/ /*START #param8# AND a.occurValue >='{param8}' #param8# END*/ /*START #param9# AND a.occurValue <='{param9}' #param9# END*/ /*START #param10# AND a.direction ='{param10}' #param10# END*/ /*START #param19# AND a.voucherId in ({param19}) #param19# END*/ /*START #param20# AND CONCAT(a.yyyy,'-',a.voucherId) in ({param20}) #param20# END*/ order by a.vchDate,a.oldVoucherId,a.serail,a.subjectId
#\u67E5\u8BE2\u62BD\u51ED\u7ED3\u679C
FINCP100007=select a.autoId,a.customerId,a.yyyy,a.voucherId,a.vchDate,a.typeId,a.oldVoucherId,a.serail,a.summary,a.subjectId,a.subjectFullName,IF (a.direction = 1,a.occurValue,0.00) AS debitValue,IF (a.direction = -1,a.occurValue,0.00) AS crebitValue,a.oppositeAccountLast,a.oppositeSubjectValue,a.oppositeTopSubjectValue,'' as assTotalName FROM {lockDbName}.fin_subjectentry a WHERE a.customerId = {lockCustomerId} and a.yyyy >= {param1} and a.yyyy <= {param2} /*START #param20# AND CONCAT(a.vchDate,'|',a.oldVoucherId,'|',a.serail,'|',a.typeId) in ({param20}) #param20# END*/ /*START #param22# AND CONCAT(a.vchDate,'|',a.oldVoucherId,'|',a.serail,'|',a.typeId) in ({param22}) #param22# END*/ /*START #param23# AND CONCAT(a.vchDate,'|',a.oldVoucherId,'|',a.serail,'|',a.typeId) not in ({param23}) #param23# END*/ order by a.vchDate,a.oldVoucherId,a.serail,a.subjectId
#\u67E5\u8BE2\u7528\u6237\u79D1\u76EE\u51ED\u8BC1\u7EDF\u8BA1\u603B\u6570
FINCP100008=select a.yyyy,b.firstSubject as subjectId,b.firstSubjectName as subjectFullName,count(distinct a.autoId) voucherNum,sum(case when a.direction = 1 then a.occurValue else 0 end) as debitOcc,sum(case when a.direction = -1 then a.occurValue else 0 end) as creditOcc from {lockDbName}.fin_subjectentry a inner join (select distinct t.subjectId,t.subjectFullId,SUBSTRING_INDEX(t.subjectFullId,'/',1) as firstSubject,SUBSTRING_INDEX(t.subjectFullName,'/',1) as firstSubjectName from {lockDbName}.fin_accpkgsubject t WHERE customerId={lockCustomerId}) b on a.subjectId = b.subjectId where a.customerId={lockCustomerId} and a.yyyy = {lockYyyy} group by b.firstSubject,b.firstSubjectName union all select {lockYyyy} as yyyy,'' as subjectId,'' as subjectFullName,count(distinct a.autoId) voucherNum,IFNULL(sum(case when a.direction = 1 then a.occurValue else 0 end),0) as debitOcc,IFNULL(sum(case when a.direction = -1 then a.occurValue else 0 end),0) as creditOcc from {lockDbName}.fin_subjectentry a where a.customerId={lockCustomerId} and a.yyyy = {lockYyyy} 
#\u67E5\u8BE2\u53D1\u751F\u989D\u6392\u540D
FINCP100009=select b.assItemId,b.debitTotalOcc,b.creditTotalOcc from (select a.assItemName,a.assItemId,sum(a.balance) as balance,sum(a.debitTotalOcc) as debitTotalOcc,sum(a.creditTotalOcc) creditTotalOcc  from {lockDbName}.fin_assitementryacc a inner join (SELECT t2.subjectId FROM {lockDbName}.fin_accpkgsubject t1 ,{lockDbName}.fin_accpkgsubject t2 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ='{lockYyyy}' AND t1.subjectId = '{param1}' AND t1.customerId = t2.customerId AND t1.yyyy = t2.yyyy AND t2.subjectFullId LIKE CONCAT(t1.subjectFullId,'/%') UNION SELECT t1.subjectId FROM {lockDbName}.fin_accpkgsubject t1 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ='{lockYyyy}' AND t1.subjectId = '{param1}') c on a.subjectId = c.subjectId WHERE a.customerId = '{lockCustomerId}' AND a.yyyy ='{lockYyyy}' AND a.subMonth={param2} and a.isLeaf1 = 1 GROUP BY a.assItemId) b where 1=1 /*START #param3# and b.balance >= {param3} #param3# END*/ order by /*START #param6# b.debitTotalOcc #param6# END*/ /*START #param7# b.creditTotalOcc #param7# END*/ /*START #param5# desc #param5# END*/  /*START #param4# limit {param4} #param4# END*/
#\u67E5\u8BE2\u62BD\u51ED\u8303\u56F4\u603B\u91D1\u989D(\u4F9B\u5E94\u5546\u7EF4\u5EA6)
FINCP100010=select count(distinct IF(t.entrySerail not in ({param18}),t.autoId,null)) as samplingCount,IFNULL(sum(abs(t.occurValue)),0) as totalAmount, IFNULL(sum(IF(t.entrySerail not in ({param18}),abs(t.occurValue),0.00)),0) AS amount,IFNULL(sum(IF(t.entrySerail in ({param18}),abs(t.occurValue),0.00)),0) AS cullAmount FROM (select a.autoId,a.customerId,a.yyyy,a.voucherId,a.occurValue,CONCAT(a.vchDate,'|',a.oldVoucherId,'|',a.serail,'|',a.typeId) as entrySerail FROM {lockDbName}.fin_subjectentry a /*START #param11# inner join (SELECT t2.subjectId FROM {lockDbName}.fin_accpkgsubject t1 ,{lockDbName}.fin_accpkgsubject t2 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ={param2} AND t1.subjectId = '{param11}' AND t1.customerId = t2.customerId AND t1.yyyy = t2.yyyy AND t2.subjectFullId LIKE CONCAT(t1.subjectFullId,'/%') UNION SELECT t1.subjectId FROM {lockDbName}.fin_accpkgsubject t1 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ={param2} AND t1.subjectId = '{param11}') c on a.subjectId = c.subjectId #param11# END*/ /*START #assitemId# inner join (select subjectEntryId from {lockDbName}.fin_assitementry b where b.customerId = {lockCustomerId} and b.yyyy >= {param1} and b.yyyy <= {param2} and b.assItemId in ({assitemId})) b on a.autoId = b.subjectEntryId #assitemId# END*/ WHERE a.customerId = {lockCustomerId} and a.yyyy >= {param1} and a.yyyy <= {param2} /*START #param12# AND a.month >='{param12}' #param12# END*/ /*START #param13# AND a.month <='{param13}' #param13# END*/ /*START #param3# AND a.vchDate >='{param3}' #param3# END*/ /*START #param4# AND a.vchDate <='{param4}' #param4# END*/ ) t WHERE t.customerId = {lockCustomerId} and t.yyyy >= {param1} and t.yyyy <= {param2} /*START #param16# AND a.occurValue >='{param16}' #param16# END*/ /*START #param17# AND a.occurValue <'{param17}' #param17# END*/
#\u67E5\u8BE2\u62BD\u51ED\u603B\u6837\u672C(\u4F9B\u5E94\u5546\u7EF4\u5EA6)
FINCP100011=select t.autoId,t.yyyy,t.voucherId,t.balanceF,t.entrySerail from (select a.autoId,a.customerId,a.yyyy,a.voucherId,a.occurValue AS balanceF,a.vchDate,CONCAT(a.vchDate,'|',a.oldVoucherId,'|',a.serail,'|',a.typeId) as entrySerail FROM {lockDbName}.fin_subjectentry a /*START #param11# inner join (SELECT t2.subjectId FROM {lockDbName}.fin_accpkgsubject t1 ,{lockDbName}.fin_accpkgsubject t2 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ={param1} AND t1.subjectId = '{param11}' AND t1.customerId = t2.customerId AND t1.yyyy = t2.yyyy AND t2.subjectFullId LIKE CONCAT(t1.subjectFullId,'/%') UNION SELECT t1.subjectId FROM {lockDbName}.fin_accpkgsubject t1 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ={param1} AND t1.subjectId = '{param11}') c on a.subjectId = c.subjectId #param11# END*/ /*START #assitemId# inner join (select subjectEntryId from {lockDbName}.fin_assitementry b where b.customerId = {lockCustomerId} and b.yyyy >= {param1} and b.yyyy <= {param2} and b.assItemId in ({assitemId})) b on a.autoId = b.subjectEntryId #assitemId# END*/ WHERE a.customerId = {lockCustomerId} and a.yyyy >= {param1} and a.yyyy <= {param2} /*START #param12# AND a.month >='{param12}' #param12# END*/ /*START #param13# AND a.month <='{param13}' #param13# END*/ /*START #param3# AND a.vchDate >='{param3}' #param3# END*/ /*START #param4# AND a.vchDate <='{param4}' #param4# END*/ /*START #param19# AND a.vchDate >'{param19}' #param19# END*/ /*START #isTransferVoucher# and a.voucherId not in (select distinct voucherId FROM {lockDbName}.fin_subjectentry a WHERE a.customerId = {lockCustomerId} AND a.yyyy >= {param1} AND a.yyyy <= {param2} and (a.isTransferVoucher = 1 or a.subjectFullName like '\u672C\u5E74\u5229\u6DA6%')) #isTransferVoucher# END*/) t where 1=1 /*START #param16# AND t.balanceF >={param16} #param16# END*/ /*START #param17# AND t.balanceF <{param17} #param17# END*/ /*START #param18# AND t.entrySerail not in ({param18}) #param18# END*/

####################\u62BD\u51ED\u6A21\u5757####################
####################\u5F80\u6765\u6A21\u5757####################
#\u67E5\u8BE2\u79D1\u76EE\u4E0B\u6240\u6709\u672B\u7EA7\u79D1\u76EE
FINWL000001=SELECT DISTINCT t1.customerId,t1.yyyy,t1.subjectId,t1.subjectFullId,t1.isLeaf1,t1.subjectName,t1.subjectFullName,t2.remain,t2.debitOcc,t2.creditOcc,t2.balance,t2.preRemain,t2.preDebitOcc,t2.preCreditOcc,t2.preBalance,t1.direction FROM {lockDbName}.fin_accpkgsubject t1 inner join (select a.customerId,a.subjectId,sum(case when a.yyyy = {lockYyyy} and a.subMonth={startMonth} then a.remain else 0 end) as remain,sum(case when a.yyyy = {lockYyyy} and a.subMonth BETWEEN {startMonth} AND {endMonth} then a.debitOcc else 0 end) as debitOcc,sum(case when a.yyyy = {lockYyyy} and a.subMonth BETWEEN {startMonth} AND {endMonth} then a.creditOcc else 0 end) as creditOcc,sum(case when a.yyyy = {lockYyyy} and a.subMonth={endMonth} then a.balance else 0 end) as balance,sum(case when a.yyyy = {preYyyy} and a.subMonth=1 then a.remain else 0 end) as preRemain,sum(case when a.yyyy = {preYyyy} and a.subMonth BETWEEN 1 AND 12 then a.debitOcc else 0 end) as preDebitOcc,sum(case when a.yyyy = {preYyyy} and a.subMonth BETWEEN 1 AND 12 then a.creditOcc else 0 end) as preCreditOcc,sum(case when a.yyyy = {preYyyy} and a.subMonth=12 then a.balance else 0 end) as preBalance from {lockDbName}.fin_account a where a.customerId = {lockCustomerId} and a.yyyy >= {preYyyy} and a.yyyy <= {lockYyyy} group by a.customerId,a.subjectId) t2 on t1.customerId = t2.customerId and t1.subjectId = t2.subjectId /*START #subjectId# inner join (SELECT t2.subjectId FROM {lockDbName}.fin_accpkgsubject t1 ,{lockDbName}.fin_accpkgsubject t2 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ={lockYyyy} AND t1.subjectId in ({subjectId}) AND t1.customerId = t2.customerId AND t1.yyyy = t2.yyyy AND t2.subjectFullId LIKE CONCAT(t1.subjectFullId,'/%') UNION SELECT t1.subjectId FROM {lockDbName}.fin_accpkgsubject t1 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ={lockYyyy} AND t1.subjectId in ({subjectId})) c on t1.subjectId = c.subjectId #subjectId# END*/ WHERE t1.customerId={lockCustomerId} AND t1.yyyy={lockYyyy} and t1.isLeaf1 = 1 group by t1.customerId,t1.subjectId order by subjectId
#\u67E5\u8BE2\u8F85\u52A9\u6838\u7B97\u4E0B\u6240\u6709\u672B\u7EA7\u6838\u7B97\u79D1\u76EE
FINWL000002=SELECT DISTINCT t1.customerId,t1.yyyy,t1.assItemId,t1.assItemFullId,t1.isLeaf1,t1.assItemName,t1.assTotalName,t1.subjectId,t1.subjectFullId,t1.subjectName,t1.subjectFullName,sum(t2.remain) as remain,sum(t2.debitOcc) as debitOcc,sum(t2.creditOcc) as creditOcc,sum(t2.balance) as balance,sum(t2.preRemain) preRemain,sum(t2.preDebitOcc) preDebitOcc,sum(t2.preCreditOcc) preCreditOcc,sum(t2.preBalance) preBalance FROM {lockDbName}.fin_assitem t1 left join (select a.customerId,a.assItemId,a.subjectId,sum(case when a.yyyy = {lockYyyy} and a.subMonth={startMonth} then a.remain else 0 end) as remain,sum(case when a.yyyy = {lockYyyy} and a.subMonth BETWEEN {startMonth} AND {endMonth} then a.debitOcc else 0 end) as debitOcc,sum(case when a.yyyy = {lockYyyy} and a.subMonth BETWEEN {startMonth} AND {endMonth} then a.creditOcc else 0 end) as creditOcc,sum(case when a.yyyy = {lockYyyy} and a.subMonth={endMonth} then a.balance else 0 end) as balance,sum(case when a.yyyy = {preYyyy} and a.subMonth=1 then a.remain else 0 end) as preRemain,sum(case when a.yyyy = {preYyyy} and a.subMonth BETWEEN 1 AND 12 then a.debitOcc else 0 end) as preDebitOcc,sum(case when a.yyyy = {preYyyy} and a.subMonth BETWEEN 1 AND 12 then a.creditOcc else 0 end) as preCreditOcc,sum(case when a.yyyy = {preYyyy} and a.subMonth=12 then a.balance else 0 end) as preBalance from {lockDbName}.fin_assitementryacc a where a.customerId = {lockCustomerId} and a.yyyy >= {preYyyy} and a.yyyy <= {lockYyyy} group by a.customerId,a.assItemId,a.subjectId) t2 on t1.customerId = t2.customerId and t1.assItemId = t2.assItemId and t1.subjectId = t2.subjectId WHERE t1.customerId={lockCustomerId} AND t1.yyyy={lockYyyy} AND (subjectFullId like '{subjectId}/%' OR t1.subjectFullId='{subjectId}') AND (t1.assItemFullId LIKE '{assItemId}|%' OR t1.assItemFullId='{assItemId}') and t1.isLeaf1 = 1 group by t1.customerId,t1.assItemId order by assitemId
#\u67E5\u8BE2\u79D1\u76EE\u6811
FINWL000003=SELECT aa.subjectId, aa.subjectFullId, aa.subjectName, aa.subjectFullName, aa.title, IF(LENGTH(aa.parentId) = 1, '', aa.parentId) as parentId, aa.leaf, aa.level, '0' as subjectIsMerchant, '0' as assitemIsMerchant FROM( SELECT a.subjectId, CONCAT(a.subjectId, '-', a.subjectFullName) AS title, a.subjectName, IF( LENGTH(a.parentSubjectId) = 0, SUBSTR(a.subjectId, 1, 1), a.parentSubjectId) AS parentId, IF(a.isLeaf1 = 0, 'false', 'true') AS leaf, a.level1 AS level, a.subjectFullName, a.subjectFullId FROM {lockDbName}.fin_accpkgsubject a WHERE  a.customerId = {lockCustomerId} AND a.yyyy={lockYyyy} ) aa WHERE  1 = 1 /*START #param2# AND aa.parentId like '{param2}%' #param2# END*/ /*START #param19# AND aa.subjectName LIKE '%{param19}%' #param19# END*/ /*START #param20# AND (aa.subjectId in ({param20}) or aa.parentId in ({param20})) #param20# END*/ ORDER BY aa.level desc,aa.parentId, aa.subjectId
#\u67E5\u8BE2\u6838\u7B97\u6811
FINWL000004=SELECT DISTINCT a.assItemId as id, a.assItemId, a.assItemName, IF(b.num IS NULL,CONCAT(a.assItemId, ' : ', a.assTotalName),CONCAT(a.assItemId, ' : ', a.assTotalName, ' (', b.num, ')')) AS  title, IF(a.isLeaf1 = 0, false, true) AS isLeaf, a.parentAssItemId AS parentId,a.level1,SUBSTRING_INDEX(a.subjectFullId,'/',1) as oneSubjectId /*START #param23# ,GROUP_CONCAT(distinct a.assItemId) as assItemIdAll,GROUP_CONCAT(distinct a.assItemName) as assItemNameAll #param23# END*/ FROM {lockDbName}.fin_assitem a left join (select parentAssItemId,count(distinct assItemId) as num from {lockDbName}.fin_assitem WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} /*START #param11# AND subjectId LIKE '{param11}%' #param11# END*/ /*START #param19# AND (assItemId LIKE '%{param19}%' or assItemName LIKE '%{param19}%') #param19# END*/ group by parentAssItemId) b on a.assItemId = b.parentAssItemId WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} /*START #param11# AND a.subjectId LIKE '{param11}%' #param11# END*/ /*START #param19# AND (a.assItemId LIKE '%{param19}%' or a.assItemName LIKE '%{param19}%') #param19# END*/ /*START #param20# AND a.level1 = '1' #param20# END*/ /*START #param21# AND a.parentAssItemId = '{param21}' and a.assItemId <> a.parentAssItemId #param21# END*/ /*START #param22# and SUBSTRING_INDEX(a.subjectFullId,'/',1) in ({param22}) #param22# END*/ /*START #param23# group by SUBSTRING_INDEX(a.subjectFullId, '/', 1) #param23# END*/ ORDER BY a.customerId, a.yyyy, a.assItemId limit 20 
#\u67E5\u8BE2\u79D1\u76EE\u671F\u521D\u671F\u672B
FINWL000005=select a.subjectId,a.subjectName,sum(case when a.subMonth=1 then a.remain else 0 end) as remain,sum(case when a.subMonth={param2} then a.debitTotalOcc else 0 end) as debitOcc,sum(case when a.subMonth={param2} then a.creditTotalOcc else 0 end) as creditOcc,sum(case when a.subMonth={param2} then a.balance else 0 end) as balance from {lockDbName}.fin_account a WHERE a.customerId = '{lockCustomerId}' AND a.yyyy ='{lockYyyy}' and a.subjectId = '{param3}'
#\u67E5\u8BE2\u6838\u7B97\u671F\u521D\u671F\u672B
FINWL000006=select a.subjectId,a.subjectName,sum(case when a.subMonth=1 then a.remain else 0 end) as remain,sum(case when a.subMonth={param2} then a.debitTotalOcc else 0 end) as debitOcc,sum(case when a.subMonth={param2} then a.creditTotalOcc else 0 end) as creditOcc,sum(case when a.subMonth={param2} then a.balance else 0 end) as balance from {lockDbName}.fin_assitementryacc a WHERE a.customerId = '{lockCustomerId}' AND a.yyyy ='{lockYyyy}' and a.assItemId = '{param3}' group by a.subjectId
#\u67E5\u8BE2\u8F85\u52A9\u6838\u7B97\u4E0B\u6240\u6709\u672B\u7EA7\u6838\u7B97\u79D1\u76EE(\u660E\u7EC6)
FINWL000007=SELECT DISTINCT t1.customerId,t1.yyyy,t1.assItemId,t1.assItemFullId,t1.isLeaf1,t1.assItemName,t1.assTotalName,/*START #isDetail# t1.subjectId,t1.subjectFullId,t1.subjectName,t1.subjectFullName, #isDetail# END*/SUBSTRING_INDEX(t1.subjectFullId, '/', 1) as oneSubjectId,SUBSTRING_INDEX(t1.subjectFullName, '/', 1) as oneSubjectName,t2.remain,t2.debitOcc,t2.creditOcc,t2.balance,t2.preRemain,t2.preDebitOcc,t2.preCreditOcc,t2.preBalance,c.direction FROM {lockDbName}.fin_assitem t1 inner join (SELECT t2.subjectId,t1.direction FROM {lockDbName}.fin_accpkgsubject t1 ,{lockDbName}.fin_accpkgsubject t2 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ={lockYyyy} AND t1.subjectId in ({subjectId}) AND t1.customerId = t2.customerId AND t1.yyyy = t2.yyyy AND t2.subjectFullId LIKE CONCAT(t1.subjectFullId,'/%') UNION SELECT t1.subjectId,t1.direction FROM {lockDbName}.fin_accpkgsubject t1 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ={lockYyyy} AND t1.subjectId in ({subjectId})) c on t1.subjectId = c.subjectId inner join (select a.customerId,a.assItemId,a.subjectId,SUBSTRING_INDEX(b.subjectFullId, '/', 1) as oneSubjectId,SUBSTRING_INDEX(b.subjectFullName, '/', 1) as oneSubjectName,sum(case when a.yyyy = {lockYyyy} and a.subMonth={startMonth} then a.remain else 0 end) as remain,sum(case when a.yyyy = {lockYyyy} and a.subMonth BETWEEN {startMonth} AND {endMonth} then a.debitOcc else 0 end) as debitOcc,sum(case when a.yyyy = {lockYyyy} and a.subMonth BETWEEN {startMonth} AND {endMonth} then a.creditOcc else 0 end) as creditOcc,sum(case when a.yyyy = {lockYyyy} and a.subMonth={endMonth} then a.balance else 0 end) as balance,sum(case when a.yyyy = {preYyyy} and a.subMonth=1 then a.remain else 0 end) as preRemain,sum(case when a.yyyy = {preYyyy} and a.subMonth BETWEEN 1 AND 12 then a.debitOcc else 0 end) as preDebitOcc,sum(case when a.yyyy = {preYyyy} and a.subMonth BETWEEN 1 AND 12 then a.creditOcc else 0 end) as preCreditOcc,sum(case when a.yyyy = {preYyyy} and a.subMonth=12 then a.balance else 0 end) as preBalance from {lockDbName}.fin_assitementryacc a inner join {lockDbName}.fin_accpkgsubject b on a.subjectId = b.subjectId and b.customerId = {lockCustomerId} and b.yyyy = {lockYyyy} where a.customerId = {lockCustomerId} and a.yyyy >= {preYyyy} and a.yyyy <= {lockYyyy} group by a.customerId,a.assItemId,SUBSTRING_INDEX(b.subjectFullId, '/', 1)/*START #isDetail# ,a.subjectId #isDetail# END*/) t2 on t1.customerId = t2.customerId and t1.assItemId = t2.assItemId AND SUBSTRING_INDEX(t1.subjectFullId, '/', 1) = t2.oneSubjectId /*START #isDetail# and t1.subjectId = t2.subjectId #isDetail# END*/ WHERE t1.customerId={lockCustomerId} AND t1.yyyy={lockYyyy} AND (t1.assItemId regexp '{assItemId}') and t1.isLeaf1 = 1 order by assitemId
#\u67E5\u8BE2\u5173\u8054\u65B9\u4EA4\u6613\u660E\u7EC6
FINWL000008=select a.yyyy,a.month,a.subjectId,c.subjectFullId,a.oldVoucherId,a.vchDate,a.vchTime,a.typeId,a.serail,a.summary,a.direction,a.occurValue,a.subjectName,a.subjectFullName,a.debitsubjects,a.creditsubjects,a.oppositeAccountTop,a.oppositeAccountLast,CONCAT(a.customerId,'|',a.vchDate,'|',a.oldVoucherId,'|',a.serail,'|',a.typeId) as entrySerail /*START #param3# ,b.assItemId,b.assItemName,b.assTotalName #param3# END*/ from {lockDbName}.fin_subjectentry a /*START #param5# inner join (SELECT t2.subjectId,t2.subjectFullId FROM {lockDbName}.fin_accpkgsubject t1 ,{lockDbName}.fin_accpkgsubject t2 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ={lockYyyy} AND t1.subjectId = '{param5}' AND t1.customerId = t2.customerId AND t1.yyyy = t2.yyyy AND t2.subjectFullId LIKE CONCAT(t1.subjectFullId,'/%') UNION SELECT t1.subjectId,t1.subjectFullId FROM {lockDbName}.fin_accpkgsubject t1 WHERE t1.customerId = '{lockCustomerId}' AND t1.yyyy ={lockYyyy} AND t1.subjectId = '{param5}') c on a.subjectId = c.subjectId #param5# END*/ /*START #param3# inner join {lockDbName}.fin_assitementry b on a.autoId = b.subjectEntryId and b.customerId = '{lockCustomerId}' and b.yyyy = '{lockYyyy}' and b.assItemId = '{param3}' #param3# END*/ where a.customerId = '{lockCustomerId}' and a.yyyy = '{lockYyyy}' and a.month <= '{endMonth}' /*START #param4# and a.subjectId = '{param4}' #param4# END*/ 
#\u51ED\u8BC1\u8BE6\u7EC6
FINWL000009=SELECT * FROM (SELECT '0' AS type,a.customerId,a.yyyy,a.month,a.subjectId,a.subjectFullName,a.vchDate,a.vchTime,a.typeId,a.voucherId,a.serail,a.summary,a.direction,a.oldVoucherId,IF(a.direction=1,a.occurValue,0) AS debitOcc,IF(a.direction=-1,a.occurValue,0) AS creditOcc,a.currrate,a.currValue,a.currency,IF(a.isTransferVoucher=1,'\u662F','\u5426') AS isTransferVoucher,a.oppositeAccountTop AS dfkm,a.occurValue FROM {lockDbName}.fin_subjectentry a WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.vchDate='{param1}' AND a.oldVoucherId='{param2}' AND a.typeId='{param3}' UNION SELECT '1' AS type,a.customerId,a.yyyy,a.month,a.assItemId AS subjectId,a.assTotalName AS subjectFullName,a.vchDate,a.vchTime,a.typeId,a.voucherId,CONCAT(a.serail,'-\u6838\u7B97')  AS serail,a.summary,a.direction,a.oldVoucherId,IF(a.direction=1,a.occurValue,0) AS debitOcc,IF(a.direction=-1,a.occurValue,0) AS creditOcc,a.currrate,a.currValue,a.currency,'' AS isTransferVoucher,'' AS dfkm,a.occurValue FROM {lockDbName}.fin_assitementry a WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND a.vchDate='{param1}' AND a.oldVoucherId='{param2}' AND a.typeId='{param3}') a ORDER BY a.vchDate,a.voucherId,a.serail
#\u6309\u51ED\u8BC1\u53F7\u67E5\u8BE2\uFF08\u81EA\u5B9A\u4E49\u5185\u90E8\u4EA4\u6613\uFF09
FINWL000010=SELECT a.autoId,a.customerId,a.yyyy,a.month,a.subjectId,a.subjectFullName,a.vchDate,a.vchTime,a.typeId,a.voucherId,a.oldVoucherId,a.serail,a.summary,a.direction,IF(a.direction=1,a.occurValue,0) AS debitOcc,IF(a.direction=-1,a.occurValue,0) AS crebitOcc,a.currrate,a.currency,IF(a.direction=1,a.currValue,0) AS debitOccF,IF(a.direction=-1,a.currValue,0) AS crebitOccF,a.oppositeAccountTop AS dfkm,a.occurValue,b.assItemId,b.assItemName,b.assTotalName FROM {lockDbName}.fin_subjectentry a left join {lockDbName}.fin_assitementry b on a.autoId = b.subjectEntryId WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} /*START #param3# AND STR_TO_DATE(a.vchDate,'%Y-%m-%d') >= STR_TO_DATE('{param3}','%Y-%m-%d') #param3# END*/ /*START #param4# AND STR_TO_DATE(a.vchDate,'%Y-%m-%d') <= STR_TO_DATE('{param4}','%Y-%m-%d') #param4# END*/ /*START #param5# AND a.subjectId LIKE '{param5}%' #param5# END*/ /*START #param6# AND a.subjectId NOT LIKE '{param6}%' #param6# END*/ /*START #param7# AND a.typeId='{param7}' #param7# END*/ /*START #param8# AND a.oldVoucherId='{param8}' #param8# END*/ /*START #param9# {param9} #param9# END*/ /*START #param10# AND b.assItemId LIKE '{param10}%' #param10# END*/ /*START #param11# and a.direction = {param11} #param11# END*/ ORDER BY a.vchDate,a.voucherId,a.serail
#\u6309\u51ED\u8BC1\u53F7\u67E5\u8BE2\uFF08\u81EA\u5B9A\u4E49\u5185\u90E8\u4EA4\u6613\uFF09
FINWL000011=SELECT a.autoId,a.customerId,a.yyyy,a.month,a.subjectId,a.subjectFullName,a.vchDate,a.vchTime,a.typeId,a.voucherId,a.oldVoucherId,a.serail,a.summary,a.direction,IF(a.direction=1,a.occurValue,0) AS debitOcc,IF(a.direction=-1,a.occurValue,0) AS crebitOcc,a.currrate,a.currency,IF(a.direction=1,a.currValue,0) AS debitOccF,IF(a.direction=-1,a.currValue,0) AS crebitOccF,a.oppositeAccountTop AS dfkm,a.occurValue,'1' as isAdd,b.assItemId,b.assItemName,b.assTotalName FROM {lockDbName}.fin_subjectentry a left join {lockDbName}.fin_assitementry b on a.autoId = b.subjectEntryId WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} /*START #param3# AND STR_TO_DATE(a.vchDate,'%Y-%m-%d') >= STR_TO_DATE('{param3}','%Y-%m-%d') #param3# END*/ /*START #param4# AND STR_TO_DATE(a.vchDate,'%Y-%m-%d') <= STR_TO_DATE('{param4}','%Y-%m-%d') #param4# END*/ /*START #param5# AND a.subjectId LIKE '{param5}%' #param5# END*/ /*START #param6# AND a.subjectId NOT LIKE '{param6}%' #param6# END*/ /*START #param7# AND a.typeId='{param7}' #param7# END*/ /*START #param8# AND a.oldVoucherId='{param8}' #param8# END*/ /*START #param9# {param9} #param9# END*/ /*START #param10# AND b.assItemId LIKE '{param10}%' #param10# END*/ AND CONCAT(a.vchDate,'|',a.oldVoucherId,'|',a.serail,'|',a.typeId) IN ({param11}) ORDER BY a.vchDate,a.voucherId,a.serail
#\u83B7\u53D6\u79D1\u76EE\u53CA\u5176\u5B50\u79D1\u76EE
FINWL000012=SELECT subjectId FROM {lockDbName}.fin_accpkgsubject WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND subjectFullId REGEXP '{subjectId}' /*START #subjectLevel# AND level1 = {subjectLevel} #subjectLevel# END*/ /*START #isLeaf# AND isLeaf1 = {isLeaf} #isLeaf# END*/
#\u6839\u636E\u79D1\u76EE\u83B7\u53D6\u6838\u7B97
FINWL000013=SELECT customerId,yyyy,subjectId,subjectName,assItemId,assItemName,direction,assItemFullId,assTotalName,subjectFullId,subjectFullName,isLeaf1,level1 FROM {lockDbName}.fin_assitem WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND subjectId in ({subjectId}) and isLeaf1 = '1'
#\u6309\u51ED\u8BC1\u53F7\u67E5\u8BE2\u5408\u8BA1\uFF08\u81EA\u5B9A\u4E49\u5185\u90E8\u4EA4\u6613\uFF09
FINWL000014=SELECT a.customerId,a.yyyy,'\u5408\u8BA1' as subjectFullName,sum(IF(a.direction=1,a.occurValue,0)) AS debitOcc,sum(IF(a.direction=-1,a.occurValue,0)) AS crebitOcc,sum(IF(a.direction=1,a.currValue,0)) AS debitOccF,sum(IF(a.direction=-1,a.currValue,0)) AS crebitOccF,sum(a.occurValue) as occurValue FROM (SELECT a.customerId,a.yyyy,a.direction,a.currValue,a.occurValue FROM {lockDbName}.fin_subjectentry a left join {lockDbName}.fin_assitementry b on a.autoId = b.subjectEntryId WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} /*START #param3# AND STR_TO_DATE(a.vchDate,'%Y-%m-%d') >= STR_TO_DATE('{param3}','%Y-%m-%d') #param3# END*/ /*START #param4# AND STR_TO_DATE(a.vchDate,'%Y-%m-%d') <= STR_TO_DATE('{param4}','%Y-%m-%d') #param4# END*/ /*START #param5# AND a.subjectId LIKE '{param5}%' #param5# END*/ /*START #param6# AND a.subjectId NOT LIKE '{param6}%' #param6# END*/ /*START #param7# AND a.typeId='{param7}' #param7# END*/ /*START #param8# AND a.oldVoucherId='{param8}' #param8# END*/ /*START #param9# {param9} #param9# END*/ /*START #param10# AND b.assItemId LIKE '{param10}%' #param10# END*/ /*START #param11# and a.direction = {param11} #param11# END*/ group by a.autoId) a
#\u6309\u51ED\u8BC1\u53F7\u67E5\u8BE2\u5408\u8BA1\uFF08\u81EA\u5B9A\u4E49\u5185\u90E8\u4EA4\u6613\uFF09
FINWL000015=SELECT a.customerId,a.yyyy,'\u5408\u8BA1' as subjectFullName,sum(IF(a.direction=1,a.occurValue,0)) AS debitOcc,sum(IF(a.direction=-1,a.occurValue,0)) AS crebitOcc,sum(IF(a.direction=1,a.currValue,0)) AS debitOccF,sum(IF(a.direction=-1,a.currValue,0)) AS crebitOccF,sum(a.occurValue) as occurValue FROM (SELECT a.customerId,a.yyyy,a.direction,a.currValue,a.occurValue FROM {lockDbName}.fin_subjectentry a left join {lockDbName}.fin_assitementry b on a.autoId = b.subjectEntryId WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} /*START #param3# AND STR_TO_DATE(a.vchDate,'%Y-%m-%d') >= STR_TO_DATE('{param3}','%Y-%m-%d') #param3# END*/ /*START #param4# AND STR_TO_DATE(a.vchDate,'%Y-%m-%d') <= STR_TO_DATE('{param4}','%Y-%m-%d') #param4# END*/ /*START #param5# AND a.subjectId LIKE '{param5}%' #param5# END*/ /*START #param6# AND a.subjectId NOT LIKE '{param6}%' #param6# END*/ /*START #param7# AND a.typeId='{param7}' #param7# END*/ /*START #param8# AND a.oldVoucherId='{param8}' #param8# END*/ /*START #param9# {param9} #param9# END*/ /*START #param10# AND b.assItemId LIKE '{param10}%' #param10# END*/ AND CONCAT(a.vchDate,'|',a.oldVoucherId,'|',a.serail,'|',a.typeId) IN ({param11}) group by a.autoId) a
#\u83B7\u53D6\u5F80\u6765\u79D1\u76EE
FINWL000016=select GROUP_CONCAT(a.subjectId) as subjectIds from {lockDbName}.fin_accpkgsubject a WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND a.level1 = 1 and a.subjectName REGEXP '{subjectName}'
#\u67E5\u8BE2\u6240\u6709\u5305\u542B\u5F80\u6765\u79D1\u76EE\u7684\u51ED\u8BC1
FINWL000017=SELECT GROUP_CONCAT(DISTINCT voucherId) AS voucherId FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND month = {month} AND subjectId IN ({subjectId}) AND ((drCount = 1 AND crCount >= 1) OR (drCount >= 1 AND crCount = 1))
#\u51ED\u8BC1\u8BE6\u7EC6
FINWL000018=SELECT * FROM (SELECT '0' AS type,a.customerId,a.yyyy,a.month,a.subjectId,a.subjectFullName,a.vchDate,a.vchTime,a.typeId,a.voucherId,a.serail,a.summary,a.direction,a.oldVoucherId,IF(a.direction=1,a.occurValue,0) AS debitOcc,IF(a.direction=-1,a.occurValue,0) AS creditOcc,a.currrate,a.currValue,a.currency,IF(a.isTransferVoucher=1,'\u662F','\u5426') AS isTransferVoucher,a.oppositeAccountTop AS dfkm,a.occurValue FROM {lockDbName}.fin_subjectentry a WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND CONCAT(a.vchDate,{finSplit1},a.oldVoucherId,{finSplit1},a.typeId) IN ({relatedVoucher}) UNION SELECT '1' AS type,a.customerId,a.yyyy,a.month,a.assItemId AS subjectId,a.assTotalName AS subjectFullName,a.vchDate,a.vchTime,a.typeId,a.voucherId,CONCAT(a.serail,'-\u6838\u7B97')  AS serail,a.summary,a.direction,a.oldVoucherId,IF(a.direction=1,a.occurValue,0) AS debitOcc,IF(a.direction=-1,a.occurValue,0) AS creditOcc,a.currrate,a.currValue,a.currency,'' AS isTransferVoucher,'' AS dfkm,a.occurValue FROM {lockDbName}.fin_assitementry a WHERE a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} AND CONCAT(a.vchDate,{finSplit1},a.oldVoucherId,{finSplit1},a.typeId) IN ({relatedVoucher})) a ORDER BY a.vchDate,a.voucherId,a.serail
####################\u5F80\u6765\u6A21\u5757####################
####################\u5BA1\u8BA1\u5E73\u53F0 \u67E5\u8BE2####################
#\u8D1F\u503C\u91CD\u5206\u7C7B\u67E5 \u4F59\u989D\u8868\u67E5\u8BE2
FINQ00001=SELECT aa.customerId,aa.yyyy,aa.subjectId,aa.subjectName,aa.direction,SUM(aa.balanceF) AS balanceF,aa.directionStr,aa.fullName,aa.level1,aa.isLeaf1,aa.hasAssItem FROM (SELECT a.customerId,a.yyyy, a.subMonth, a.subjectId, a.subjectName, IF(a.subMonth = {param3}, a.balance, 0) AS balanceF, IF(a.direction = 1, '\u501F', '\u8D37')           AS directionStr, a.direction, a.subjectFullName                       AS fullName, a.level1, a.isLeaf1, a.hasAssItem FROM {lockDbName}.fin_account a WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.subMonth >= 01 AND a.subMonth <= {param3} AND a.isLeaf1 = 1 ) aa where balanceF < 0 GROUP BY aa.customerId, aa.yyyy, aa.subjectId ORDER BY balanceF;
FINQ00002=select summary,assItemId,assItemName,assTotalName,subjectId,subjectFullName,subjectName,direction,subjectDirection,occurValue,balance,voucherId,vchDate,typeId,serail,oldVoucherId,subjectFullId,subjectDirectionStr from (SELECT IFNULL(b.occurValue, a.occurValue)  * c.direction * a.direction as 'balance',a.summary,b.assItemId,b.assItemName,b.assTotalName,a.subjectId,a.subjectFullName,a.subjectName,a.direction,c.direction as subjectDirection,IFNULL(b.occurValue, a.occurValue)                          as occurValue,IF(a.direction = 1, IFNULL(b.occurValue, a.occurValue), 0)  AS debitOcc,IF(a.direction = -1, IFNULL(b.occurValue, a.occurValue), 0) AS creditOcc,a.voucherId,a.vchDate,a.typeId,a.serail,a.oldVoucherId,c.subjectFullId,IF(c.direction = 1, '\u501F', '\u8D37') as subjectDirectionStr FROM {lockDbName}.fin_subjectentry a LEFT JOIN {lockDbName}.fin_assitementry b ON b.subjectEntryId = a.autoId left join {lockDbName}.fin_accpkgsubject c on c.customerId = a.customerId and c.yyyy = a.yyyy and c.subjectId = a.subjectId WHERE a.customerId = {param1} AND a.yyyy = {param2} AND a.occurValue < 0 and a.month = {param3} /*START #param4# AND c.subjectFullId like '{param4}/%' #param4# END*/ /*START #param5# and b.assItemId = '{param5}' #param5# END*/ ORDER BY a.voucherId ) t where t.balance < 0;
####################\u5BA1\u8BA1\u5E73\u53F0 \u67E5\u8BE2####################
####################\u5BA1\u8BA1\u5E73\u53F0 \u63D2\u5165####################
FINC00001=CREATE DATABASE IF NOT EXISTS {lockDbName} CHARACTER SET 'utf8' COLLATE 'utf8_general_ci';
FINC00002=CREATE TABLE IF NOT EXISTS {lockDbName}.fin_account (autoId int(10) NOT NULL AUTO_INCREMENT COMMENT '\u81EA\u589EID',customerId int(10) NOT NULL DEFAULT '0' COMMENT '\u5BA2\u6237ID',yyyy int(10) NOT NULL DEFAULT '0' COMMENT '\u5E74',subMonth int(10) NOT NULL DEFAULT '0' COMMENT '\u6708',subjectId varchar(50) NOT NULL DEFAULT '0' COMMENT '\u79D1\u76EE\u7F16\u53F7',subjectName varchar(500) DEFAULT NULL COMMENT '\u79D1\u76EE\u540D\u79F0',direction int(2) DEFAULT '0' COMMENT '\u501F\u8D37\u65B9\u5411',currency varchar(30) DEFAULT NULL COMMENT '\u5E01\u79CD',debitRemain decimal(30,4) DEFAULT '0.0000' COMMENT '\u501F\u65B9\u671F\u521D',creditRemain decimal(30,4) DEFAULT '0.0000' COMMENT '\u8D37\u65B9\u671F\u521D',remain decimal(30,4) DEFAULT '0.0000' COMMENT '\u671F\u521D\u6570',debitOcc decimal(30,4) DEFAULT '0.0000' COMMENT '\u501F\u65B9\u53D1\u751F\u989D',creditOcc decimal(30,4) DEFAULT '0.0000' COMMENT '\u8D37\u65B9\u53D1\u751F\u989D',tranDebitOcc decimal(30,4) DEFAULT '0.0000' COMMENT '\u501F\u65B9\u635F\u76CA\u7ED3\u8F6C\u6570',tranCreditOcc decimal(30,4) DEFAULT '0.0000' COMMENT '\u8D37\u65B9\u635F\u76CA\u7ED3\u8F6C\u6570',debitOccNoTran decimal(30,4) DEFAULT '0.0000' COMMENT '\u501F\u65B9\u5254\u9664\u7ED3\u8F6C\u53D1\u751F\u989D',creditOccNoTran decimal(30,4) DEFAULT '0.0000' COMMENT '\u8D37\u65B9\u5254\u9664\u7ED3\u8F6C\u53D1\u751F\u989D',debitTotalOcc decimal(30,4) DEFAULT '0.0000' COMMENT '\u501F\u65B9\u53D1\u751F\u989D\u7D2F\u8BA1\u6570',creditTotalOcc decimal(30,4) DEFAULT '0.0000' COMMENT '\u8D37\u65B9\u53D1\u751F\u989D\u7D2F\u8BA1\u6570',debitBalance decimal(30,4) DEFAULT '0.0000' COMMENT '\u501F\u65B9\u671F\u672B',creditBalance decimal(30,4) DEFAULT '0.0000' COMMENT '\u8D37\u65B9\u671F\u672B',balance decimal(30,4) DEFAULT '0.0000' COMMENT '\u671F\u672B\u6570',isLeaf1 int(1) DEFAULT '0' COMMENT '\u662F\u5426\u672B\u7EA7\u79D1\u76EE',level1 int(1) DEFAULT '0' COMMENT '\u79D1\u76EE\u7EA7\u522B',subjectFullName varchar(800) DEFAULT NULL COMMENT '\u79D1\u76EE\u5168\u8DEF\u5F84',hasAssItem int(1) DEFAULT '0' COMMENT '\u662F\u5426\u542B\u8F85\u52A9\u6838\u7B97',s1 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s2 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s3 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s4 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s5 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s6 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s7 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s8 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s9 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s10 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s11 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s12 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s13 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s14 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s15 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s16 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s17 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s18 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s19 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s20 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s21 text COMMENT '\u5907\u7528\u5B57\u6BB5',s22 text COMMENT '\u5907\u7528\u5B57\u6BB5',s23 text COMMENT '\u5907\u7528\u5B57\u6BB5',s24 text COMMENT '\u5907\u7528\u5B57\u6BB5',s25 text COMMENT '\u5907\u7528\u5B57\u6BB5',CREATION_DATE datetime DEFAULT NULL COMMENT '\u521B\u5EFA\u65E5',CREATED_BY varchar(20) DEFAULT NULL COMMENT '\u521B\u5EFA\u4EBAID',LAST_UPDATE_DATE datetime DEFAULT NULL COMMENT '\u6700\u540E\u66F4\u65B0\u65E5',LAST_UPDATED_BY varchar(20) DEFAULT NULL COMMENT '\u6700\u540E\u66F4\u65B0\u4EBAID',ABOLITION_DATE datetime DEFAULT NULL COMMENT '\u5220\u9664\u65E5',ABOLISHED_BY varchar(20) DEFAULT NULL COMMENT '\u5220\u9664\u4EBAID',PROGRAM_APPLICATION_ID varchar(20) DEFAULT NULL COMMENT '\u4ECE\u54EA\u4E2A\u7CFB\u7EDF\u64CD\u4F5C\u7684\u6570\u636E',PROGRAM_ID varchar(20) DEFAULT NULL COMMENT '\u54EA\u4E2A\u7A0B\u5E8F\u64CD\u4F5C\u7684\u6570\u636E',ACTIVE_FLAG varchar(1) DEFAULT '1' COMMENT '0:\u65E0\u6548\u6570\u636E\uFF1B1\uFF1A\u6709\u6548\u6570\u636E',PRIMARY KEY (autoId) USING BTREE,UNIQUE KEY UniqueKey (customerId,yyyy,subMonth,subjectId) USING BTREE COMMENT '\u552F\u4E00key') ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='\u79D1\u76EE\u4F59\u989D\u8868';
FINC00003=CREATE TABLE IF NOT EXISTS {lockDbName}.fin_accountall (autoId int(10) NOT NULL AUTO_INCREMENT COMMENT '\u81EA\u589EID',customerId int(10) NOT NULL DEFAULT '0' COMMENT '\u5BA2\u6237ID',yyyy int(10) NOT NULL DEFAULT '0' COMMENT '\u5E74',subMonth int(10) NOT NULL DEFAULT '0' COMMENT '\u6708',subjectId varchar(50) NOT NULL DEFAULT '0' COMMENT '\u79D1\u76EE\u7F16\u53F7',subjectName varchar(500) DEFAULT NULL COMMENT '\u79D1\u76EE\u540D\u79F0',direction int(2) DEFAULT '0' COMMENT '\u501F\u8D37\u65B9\u5411',currency varchar(30) NOT NULL DEFAULT '0' COMMENT '\u5E01\u79CD',debitRemain decimal(30,4) DEFAULT '0.0000' COMMENT '\u501F\u65B9\u671F\u521D',creditRemain decimal(30,4) DEFAULT '0.0000' COMMENT '\u8D37\u65B9\u671F\u521D',remain decimal(30,4) DEFAULT '0.0000' COMMENT '\u671F\u521D\u6570',debitOcc decimal(30,4) DEFAULT '0.0000' COMMENT '\u501F\u65B9\u53D1\u751F\u989D',creditOcc decimal(30,4) DEFAULT '0.0000' COMMENT '\u8D37\u65B9\u53D1\u751F\u989D',tranDebitOcc decimal(30,4) DEFAULT '0.0000' COMMENT '\u501F\u65B9\u635F\u76CA\u7ED3\u8F6C\u6570',tranCreditOcc decimal(30,4) DEFAULT '0.0000' COMMENT '\u8D37\u65B9\u635F\u76CA\u7ED3\u8F6C\u6570',debitOccNoTran decimal(30,4) DEFAULT '0.0000' COMMENT '\u501F\u65B9\u5254\u9664\u7ED3\u8F6C\u53D1\u751F\u989D',creditOccNoTran decimal(30,4) DEFAULT '0.0000' COMMENT '\u8D37\u65B9\u5254\u9664\u7ED3\u8F6C\u53D1\u751F\u989D',debitTotalOcc decimal(30,4) DEFAULT '0.0000' COMMENT '\u501F\u65B9\u53D1\u751F\u989D\u7D2F\u8BA1\u6570',creditTotalOcc decimal(30,4) DEFAULT '0.0000' COMMENT '\u8D37\u65B9\u53D1\u751F\u989D\u7D2F\u8BA1\u6570',debitBalance decimal(30,4) DEFAULT '0.0000' COMMENT '\u501F\u65B9\u671F\u672B',creditBalance decimal(30,4) DEFAULT '0.0000' COMMENT '\u8D37\u65B9\u671F\u672B',balance decimal(30,4) DEFAULT '0.0000' COMMENT '\u671F\u672B\u6570',debitRemainF decimal(30,4) DEFAULT '0.0000' COMMENT '\u501F\u65B9\u671F\u521D(\u5916\u5E01)',creditRemainF decimal(30,4) DEFAULT '0.0000' COMMENT '\u8D37\u65B9\u671F\u521D(\u5916\u5E01)',remainF decimal(30,4) DEFAULT '0.0000' COMMENT '\u671F\u521D\u6570(\u5916\u5E01)',debitOccF decimal(30,4) DEFAULT '0.0000' COMMENT '\u501F\u65B9\u53D1\u751F\u989D(\u5916\u5E01)',creditOccF decimal(30,4) DEFAULT '0.0000' COMMENT '\u8D37\u65B9\u53D1\u751F\u989D(\u5916\u5E01)',tranDebitOccF decimal(30,4) DEFAULT '0.0000' COMMENT '\u501F\u65B9\u635F\u76CA\u7ED3\u8F6C\u6570(\u5916\u5E01)',tranCreditOccF decimal(30,4) DEFAULT '0.0000' COMMENT '\u8D37\u65B9\u635F\u76CA\u7ED3\u8F6C\u6570(\u5916\u5E01)',debitOccNoTranF decimal(30,4) DEFAULT '0.0000' COMMENT '\u501F\u65B9\u5254\u9664\u7ED3\u8F6C\u53D1\u751F\u989D(\u5916\u5E01)',creditOccNoTranF decimal(30,4) DEFAULT '0.0000' COMMENT '\u8D37\u65B9\u5254\u9664\u7ED3\u8F6C\u53D1\u751F\u989D(\u5916\u5E01)',debitTotalOccF decimal(30,4) DEFAULT '0.0000' COMMENT '\u501F\u65B9\u53D1\u751F\u989D\u7D2F\u8BA1\u6570(\u5916\u5E01)',creditTotalOccF decimal(30,4) DEFAULT '0.0000' COMMENT '\u8D37\u65B9\u53D1\u751F\u989D\u7D2F\u8BA1\u6570(\u5916\u5E01)',debitBalanceF decimal(30,4) DEFAULT '0.0000' COMMENT '\u501F\u65B9\u671F\u672B(\u5916\u5E01)',creditBalanceF decimal(30,4) DEFAULT '0.0000' COMMENT '\u8D37\u65B9\u671F\u672B(\u5916\u5E01)',balanceF decimal(30,4) DEFAULT '0.0000' COMMENT '\u671F\u672B\u6570(\u5916\u5E01)',isLeaf1 int(1) DEFAULT '0' COMMENT '\u662F\u5426\u672B\u7EA7\u79D1\u76EE',level1 int(1) DEFAULT '0' COMMENT '\u79D1\u76EE\u7EA7\u522B',subjectFullName varchar(800) DEFAULT NULL COMMENT '\u79D1\u76EE\u5168\u8DEF\u5F84',hasAssItem int(1) DEFAULT '0' COMMENT '\u662F\u5426\u542B\u8F85\u52A9\u6838\u7B97',s1 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s2 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s3 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s4 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s5 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s6 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s7 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s8 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s9 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s10 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s11 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s12 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s13 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s14 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s15 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s16 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s17 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s18 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s19 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s20 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s21 text COMMENT '\u5907\u7528\u5B57\u6BB5',s22 text COMMENT '\u5907\u7528\u5B57\u6BB5',s23 text COMMENT '\u5907\u7528\u5B57\u6BB5',s24 text COMMENT '\u5907\u7528\u5B57\u6BB5',s25 text COMMENT '\u5907\u7528\u5B57\u6BB5',CREATION_DATE datetime DEFAULT NULL COMMENT '\u521B\u5EFA\u65E5',CREATED_BY varchar(20) DEFAULT NULL COMMENT '\u521B\u5EFA\u4EBAID',LAST_UPDATE_DATE datetime DEFAULT NULL COMMENT '\u6700\u540E\u66F4\u65B0\u65E5',LAST_UPDATED_BY varchar(20) DEFAULT NULL COMMENT '\u6700\u540E\u66F4\u65B0\u4EBAID',ABOLITION_DATE datetime DEFAULT NULL COMMENT '\u5220\u9664\u65E5',ABOLISHED_BY varchar(20) DEFAULT NULL COMMENT '\u5220\u9664\u4EBAID',PROGRAM_APPLICATION_ID varchar(20) DEFAULT NULL COMMENT '\u4ECE\u54EA\u4E2A\u7CFB\u7EDF\u64CD\u4F5C\u7684\u6570\u636E',PROGRAM_ID varchar(20) DEFAULT NULL COMMENT '\u54EA\u4E2A\u7A0B\u5E8F\u64CD\u4F5C\u7684\u6570\u636E',ACTIVE_FLAG varchar(1) DEFAULT '1' COMMENT '0:\u65E0\u6548\u6570\u636E\uFF1B1\uFF1A\u6709\u6548\u6570\u636E',PRIMARY KEY (autoId) USING BTREE,UNIQUE KEY UniqueKey (customerId,yyyy,subMonth,subjectId,currency) USING BTREE COMMENT '\u552F\u4E00key') ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='\u5916\u5E01\u79D1\u76EE\u4F59\u989D\u8868';
FINC00004=CREATE TABLE IF NOT EXISTS {lockDbName}.fin_accpkgsubject (autoId int(10) NOT NULL AUTO_INCREMENT COMMENT '\u81EA\u589EID',customerId int(10) NOT NULL DEFAULT '0' COMMENT '\u5BA2\u6237ID',yyyy int(10) NOT NULL DEFAULT '0' COMMENT '\u5E74',subjectId varchar(50) NOT NULL COMMENT '\u79D1\u76EE\u7F16\u53F7',parentSubjectId varchar(50) DEFAULT NULL COMMENT '\u79D1\u76EE\u7F16\u53F7',subjectFullId varchar(200) DEFAULT '' COMMENT '\u79D1\u76EE\u7F16\u53F7\u5168\u8DEF\u5F84',subjectName varchar(500) DEFAULT '' COMMENT '\u79D1\u76EE\u540D\u79F0',direction int(2) DEFAULT '0' COMMENT '\u501F\u8D37\u65B9\u5411',currency varchar(30) DEFAULT '' COMMENT '\u5E01\u79CD',isLeaf1 int(1) DEFAULT NULL COMMENT '\u662F\u5426\u672B\u7EA7\u79D1\u76EE',level1 int(1) DEFAULT '1' COMMENT '\u79D1\u76EE\u7EA7\u522B',subjectFullName varchar(800) DEFAULT NULL COMMENT '\u79D1\u76EE\u540D\u79F0\u5168\u8DEF\u5F84',s1 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s2 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s3 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s4 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s5 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s6 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s7 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s8 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s9 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s10 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s11 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s12 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s13 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s14 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s15 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s16 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s17 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s18 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s19 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s20 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s21 text COMMENT '\u5907\u7528\u5B57\u6BB5',s22 text COMMENT '\u5907\u7528\u5B57\u6BB5',s23 text COMMENT '\u5907\u7528\u5B57\u6BB5',s24 text COMMENT '\u5907\u7528\u5B57\u6BB5',s25 text COMMENT '\u5907\u7528\u5B57\u6BB5',CREATION_DATE datetime DEFAULT NULL COMMENT '\u521B\u5EFA\u65E5',CREATED_BY varchar(20) DEFAULT NULL COMMENT '\u521B\u5EFA\u4EBAID',LAST_UPDATE_DATE datetime DEFAULT NULL COMMENT '\u6700\u540E\u66F4\u65B0\u65E5',LAST_UPDATED_BY varchar(20) DEFAULT NULL COMMENT '\u6700\u540E\u66F4\u65B0\u4EBAID',ABOLITION_DATE datetime DEFAULT NULL COMMENT '\u5220\u9664\u65E5',ABOLISHED_BY varchar(20) DEFAULT NULL COMMENT '\u5220\u9664\u4EBAID',PROGRAM_APPLICATION_ID varchar(20) DEFAULT NULL COMMENT '\u4ECE\u54EA\u4E2A\u7CFB\u7EDF\u64CD\u4F5C\u7684\u6570\u636E',PROGRAM_ID varchar(20) DEFAULT NULL COMMENT '\u54EA\u4E2A\u7A0B\u5E8F\u64CD\u4F5C\u7684\u6570\u636E',ACTIVE_FLAG varchar(1) DEFAULT '1' COMMENT '0:\u65E0\u6548\u6570\u636E\uFF1B1\uFF1A\u6709\u6548\u6570\u636E',PRIMARY KEY (autoId) USING BTREE,UNIQUE KEY UniqueKey (customerId,yyyy,subjectId) USING BTREE COMMENT '\u552F\u4E00key') ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='\u79D1\u76EE\u8868'; 
FINC00005=CREATE TABLE IF NOT EXISTS {lockDbName}.fin_assitem (autoId int(10) NOT NULL AUTO_INCREMENT COMMENT '\u81EA\u589EID',customerId int(10) NOT NULL DEFAULT '0' COMMENT '\u5BA2\u6237ID',yyyy int(10) NOT NULL DEFAULT '0' COMMENT '\u5E74',subjectId varchar(50) NOT NULL DEFAULT '0' COMMENT '\u79D1\u76EE\u7F16\u53F7',subjectName varchar(500) DEFAULT NULL COMMENT '\u79D1\u76EE\u540D\u79F0',assItemId varchar(100) NOT NULL DEFAULT '0' COMMENT '\u6838\u7B97\u540D\u7F16\u53F7',assItemName varchar(500) DEFAULT NULL COMMENT '\u6838\u7B97\u9879\u540D',direction int(2) DEFAULT '0' COMMENT '\u501F\u8D37\u65B9\u5411',currency varchar(30) DEFAULT NULL COMMENT '\u5E01\u79CD',parentAssItemId varchar(100) DEFAULT NULL COMMENT '\u4E0A\u7EA7\u6838\u7B97\u9879\u7F16\u53F7',assItemFullId varchar(200) DEFAULT NULL COMMENT '\u6838\u7B97\u7F16\u53F7\u5168\u8DEF\u5F84',assTotalName varchar(800) DEFAULT NULL COMMENT '\u6838\u7B97\u9879\u5168\u79F0',subjectFullId varchar(200) DEFAULT NULL COMMENT '\u79D1\u76EE\u7F16\u53F7\u5168\u8DEF\u5F84',subjectFullName varchar(800) DEFAULT NULL COMMENT '\u79D1\u76EE\u5168\u8DEF\u5F84',isLeaf1 int(1) DEFAULT '0' COMMENT '\u662F\u5426\u672B\u7EA7\u6838\u7B97',level1 int(1) DEFAULT '0' COMMENT '\u6838\u7B97\u7EA7\u522B',s1 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s2 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s3 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s4 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s5 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s6 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s7 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s8 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s9 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s10 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s11 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s12 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s13 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s14 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s15 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s16 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s17 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s18 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s19 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s20 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s21 text COMMENT '\u5907\u7528\u5B57\u6BB5',s22 text COMMENT '\u5907\u7528\u5B57\u6BB5',s23 text COMMENT '\u5907\u7528\u5B57\u6BB5',s24 text COMMENT '\u5907\u7528\u5B57\u6BB5',s25 text COMMENT '\u5907\u7528\u5B57\u6BB5',CREATION_DATE datetime DEFAULT NULL COMMENT '\u521B\u5EFA\u65E5',CREATED_BY varchar(20) DEFAULT NULL COMMENT '\u521B\u5EFA\u4EBAID',LAST_UPDATE_DATE datetime DEFAULT NULL COMMENT '\u6700\u540E\u66F4\u65B0\u65E5',LAST_UPDATED_BY varchar(20) DEFAULT NULL COMMENT '\u6700\u540E\u66F4\u65B0\u4EBAID',ABOLITION_DATE datetime DEFAULT NULL COMMENT '\u5220\u9664\u65E5',ABOLISHED_BY varchar(20) DEFAULT NULL COMMENT '\u5220\u9664\u4EBAID',PROGRAM_APPLICATION_ID varchar(20) DEFAULT NULL COMMENT '\u4ECE\u54EA\u4E2A\u7CFB\u7EDF\u64CD\u4F5C\u7684\u6570\u636E',PROGRAM_ID varchar(20) DEFAULT NULL COMMENT '\u54EA\u4E2A\u7A0B\u5E8F\u64CD\u4F5C\u7684\u6570\u636E',ACTIVE_FLAG varchar(1) DEFAULT '1' COMMENT '0:\u65E0\u6548\u6570\u636E\uFF1B1\uFF1A\u6709\u6548\u6570\u636E',PRIMARY KEY (autoId),UNIQUE KEY UniqueKey (customerId,yyyy,subjectId,assItemId) USING BTREE COMMENT '\u552F\u4E00key') ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='\u6838\u7B97\u79D1\u76EE\u8868'; 
FINC00006=CREATE TABLE IF NOT EXISTS {lockDbName}.fin_assitementry (autoId int(10) NOT NULL AUTO_INCREMENT COMMENT '\u81EA\u589EID',customerId int(10) NOT NULL DEFAULT '0' COMMENT '\u5BA2\u6237ID',yyyy int(10) NOT NULL DEFAULT '0' COMMENT '\u5E74',month int(2) DEFAULT '0' COMMENT '\u6708',subjectId varchar(50) NOT NULL DEFAULT '0' COMMENT '\u79D1\u76EE\u7F16\u53F7',assItemId varchar(100) NOT NULL DEFAULT '0' COMMENT '\u6838\u7B97\u9879\u7F16\u53F7',oldVoucherId varchar(50) DEFAULT NULL COMMENT '\u539F\u59CB\u6570\u636E\u51ED\u8BC1ID',voucherId varchar(50) DEFAULT NULL COMMENT '\u7CFB\u7EDF\u751F\u6210\u51ED\u8BC1ID',vchDate varchar(10) DEFAULT NULL COMMENT '\u51ED\u8BC1\u65E5\u671F',vchTime varchar(15) DEFAULT NULL COMMENT '\u51ED\u8BC1\u65F6\u95F4',typeId varchar(200) DEFAULT NULL COMMENT '\u51ED\u8BC1\u7C7B\u578B',serail int(10) DEFAULT '0' COMMENT '\u5206\u5F55\u53F7',summary longtext DEFAULT NULL COMMENT '\u6458\u8981',direction int(2) DEFAULT '0' COMMENT '\u501F\u8D37\u65B9\u5411',currency varchar(30) DEFAULT NULL COMMENT '\u5E01\u79CD',occurValue decimal(30,4) DEFAULT '0.0000' COMMENT '\u53D1\u751F\u989D(\u672C\u4F4D\u5E01)',currRate decimal(30,4) DEFAULT '0.0000' COMMENT '\u6C47\u7387',currValue decimal(30,4) DEFAULT '0.0000' COMMENT '\u53D1\u751F\u989D(\u539F\u5E01)',voucherFillUser varchar(50) DEFAULT NULL COMMENT '\u5236\u5355\u4EBA',voucherKeepUser varchar(50) DEFAULT NULL COMMENT '\u8BB0\u8D26\u4EBA',voucherAuditUser varchar(50) DEFAULT NULL COMMENT '\u5BA1\u6838\u4EBA',quantity decimal(30,4) DEFAULT '0.0000' COMMENT '\u6570\u91CF',unitPrice decimal(30,4) DEFAULT '0.0000' COMMENT '\u5355\u4EF7',unitName varchar(20) DEFAULT NULL COMMENT '\u5355\u4F4D',subjectName varchar(500) DEFAULT '' COMMENT '\u79D1\u76EE\u540D\u79F0',subjectFullName varchar(800) DEFAULT NULL COMMENT '\u79D1\u76EE\u5168\u8DEF\u5F84',assItemName varchar(500) DEFAULT NULL COMMENT '\u6838\u7B97\u9879\u540D',assTotalName varchar(800) DEFAULT NULL COMMENT '\u6838\u7B97\u9879\u5168\u79F0',isTransferVoucher int(1) DEFAULT '0' COMMENT '\u662F\u5426\u7ED3\u8F6C\u51ED\u8BC1 0:\u5426; 1:\u662F',subjectEntryId int(10) DEFAULT '0' COMMENT '\u6307\u5411fin_sunjectentry\u4E3B\u952E',s1 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s2 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s3 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s4 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s5 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s6 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s7 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s8 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s9 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s10 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s11 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s12 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s13 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s14 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s15 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s16 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s17 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s18 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s19 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s20 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s21 text COMMENT '\u5907\u7528\u5B57\u6BB5',s22 text COMMENT '\u5907\u7528\u5B57\u6BB5',s23 text COMMENT '\u5907\u7528\u5B57\u6BB5',s24 text COMMENT '\u5907\u7528\u5B57\u6BB5',s25 text COMMENT '\u5907\u7528\u5B57\u6BB5',CREATION_DATE datetime DEFAULT NULL COMMENT '\u521B\u5EFA\u65E5',CREATED_BY varchar(20) DEFAULT NULL COMMENT '\u521B\u5EFA\u4EBAID',LAST_UPDATE_DATE datetime DEFAULT NULL COMMENT '\u6700\u540E\u66F4\u65B0\u65E5',LAST_UPDATED_BY varchar(20) DEFAULT NULL COMMENT '\u6700\u540E\u66F4\u65B0\u4EBAID',ABOLITION_DATE datetime DEFAULT NULL COMMENT '\u5220\u9664\u65E5',ABOLISHED_BY varchar(20) DEFAULT NULL COMMENT '\u5220\u9664\u4EBAID',PROGRAM_APPLICATION_ID varchar(20) DEFAULT NULL COMMENT '\u4ECE\u54EA\u4E2A\u7CFB\u7EDF\u64CD\u4F5C\u7684\u6570\u636E',PROGRAM_ID varchar(20) DEFAULT NULL COMMENT '\u54EA\u4E2A\u7A0B\u5E8F\u64CD\u4F5C\u7684\u6570\u636E',ACTIVE_FLAG varchar(1) DEFAULT '1' COMMENT '0:\u65E0\u6548\u6570\u636E\uFF1B1\uFF1A\u6709\u6548\u6570\u636E',PRIMARY KEY (autoId),KEY SearchKey (customerId,yyyy,month,subjectId,assItemId,oldVoucherId,voucherId,vchDate),KEY SubjectEntryKey (customerId,yyyy,vchDate,voucherId,serail),KEY SubjectEntryKey2 (subjectEntryId)) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='\u6838\u7B97\u5206\u5F55\u8868'; 
FINC00007=CREATE TABLE IF NOT EXISTS {lockDbName}.fin_assitementryacc (autoId int(10) NOT NULL AUTO_INCREMENT COMMENT '\u81EA\u589EID',customerId int(10) NOT NULL DEFAULT '0' COMMENT '\u5BA2\u6237ID',yyyy int(10) NOT NULL DEFAULT '0' COMMENT '\u5E74',subMonth int(10) NOT NULL DEFAULT '0' COMMENT '\u6708',subjectId varchar(50) NOT NULL DEFAULT '0' COMMENT '\u79D1\u76EE\u7F16\u53F7',subjectName varchar(500) DEFAULT NULL COMMENT '\u79D1\u76EE\u540D\u79F0',assItemId varchar(100) NOT NULL DEFAULT '0' COMMENT '\u6838\u7B97\u9879\u7F16\u53F7',assItemName varchar(500) DEFAULT NULL COMMENT '\u6838\u7B97\u9879\u540D\u79F0',direction int(2) DEFAULT '0' COMMENT '\u501F\u8D37\u65B9\u5411',currency varchar(30) DEFAULT NULL COMMENT '\u5E01\u79CD',debitRemain decimal(30,4) DEFAULT '0.0000' COMMENT '\u501F\u65B9\u671F\u521D',creditRemain decimal(30,4) DEFAULT '0.0000' COMMENT '\u8D37\u65B9\u671F\u521D',remain decimal(30,4) DEFAULT '0.0000' COMMENT '\u671F\u521D\u6570',debitOcc decimal(30,4) DEFAULT '0.0000' COMMENT '\u501F\u65B9\u53D1\u751F\u989D',creditOcc decimal(30,4) DEFAULT '0.0000' COMMENT '\u8D37\u65B9\u53D1\u751F\u989D',tranDebitOcc decimal(30,4) DEFAULT '0.0000' COMMENT '\u501F\u65B9\u635F\u76CA\u7ED3\u8F6C\u6570',tranCreditOcc decimal(30,4) DEFAULT '0.0000' COMMENT '\u8D37\u65B9\u635F\u76CA\u7ED3\u8F6C\u6570',debitOccNoTran decimal(30,4) DEFAULT '0.0000' COMMENT '\u501F\u65B9\u5254\u9664\u7ED3\u8F6C\u53D1\u751F\u989D',creditOccNoTran decimal(30,4) DEFAULT '0.0000' COMMENT '\u8D37\u65B9\u5254\u9664\u7ED3\u8F6C\u53D1\u751F\u989D',debitTotalOcc decimal(30,4) DEFAULT '0.0000' COMMENT '\u501F\u65B9\u53D1\u751F\u989D\u7D2F\u8BA1\u6570',creditTotalOcc decimal(30,4) DEFAULT '0.0000' COMMENT '\u8D37\u65B9\u53D1\u751F\u989D\u7D2F\u8BA1\u6570',debitBalance decimal(30,4) DEFAULT '0.0000' COMMENT '\u501F\u65B9\u671F\u672B',creditBalance decimal(30,4) DEFAULT '0.0000' COMMENT '\u8D37\u65B9\u671F\u672B',balance decimal(30,4) DEFAULT '0.0000' COMMENT '\u671F\u672B\u6570',isLeaf1 int(1) DEFAULT '0' COMMENT '\u662F\u5426\u672B\u7EA7\u6838\u7B97',level1 int(1) DEFAULT '0' COMMENT '\u6838\u7B97\u7EA7\u522B',subjectFullName varchar(800) DEFAULT NULL COMMENT '\u79D1\u76EE\u5168\u8DEF\u5F84',assTotalName varchar(800) DEFAULT NULL COMMENT '\u6838\u7B97\u9879\u5168\u79F0',s1 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s2 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s3 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s4 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s5 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s6 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s7 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s8 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s9 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s10 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s11 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s12 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s13 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s14 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s15 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s16 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s17 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s18 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s19 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s20 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s21 text COMMENT '\u5907\u7528\u5B57\u6BB5',s22 text COMMENT '\u5907\u7528\u5B57\u6BB5',s23 text COMMENT '\u5907\u7528\u5B57\u6BB5',s24 text COMMENT '\u5907\u7528\u5B57\u6BB5',s25 text COMMENT '\u5907\u7528\u5B57\u6BB5',CREATION_DATE datetime DEFAULT NULL COMMENT '\u521B\u5EFA\u65E5',CREATED_BY varchar(20) DEFAULT NULL COMMENT '\u521B\u5EFA\u4EBAID',LAST_UPDATE_DATE datetime DEFAULT NULL COMMENT '\u6700\u540E\u66F4\u65B0\u65E5',LAST_UPDATED_BY varchar(20) DEFAULT NULL COMMENT '\u6700\u540E\u66F4\u65B0\u4EBAID',ABOLITION_DATE datetime DEFAULT NULL COMMENT '\u5220\u9664\u65E5',ABOLISHED_BY varchar(20) DEFAULT NULL COMMENT '\u5220\u9664\u4EBAID',PROGRAM_APPLICATION_ID varchar(20) DEFAULT NULL COMMENT '\u4ECE\u54EA\u4E2A\u7CFB\u7EDF\u64CD\u4F5C\u7684\u6570\u636E',PROGRAM_ID varchar(20) DEFAULT NULL COMMENT '\u54EA\u4E2A\u7A0B\u5E8F\u64CD\u4F5C\u7684\u6570\u636E',ACTIVE_FLAG varchar(1) DEFAULT '1' COMMENT '0:\u65E0\u6548\u6570\u636E\uFF1B1\uFF1A\u6709\u6548\u6570\u636E',PRIMARY KEY (autoId) USING BTREE,UNIQUE KEY UniqueKey (customerId,yyyy,subMonth,subjectId,assItemId) USING BTREE COMMENT '\u552F\u4E00key') ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='\u79D1\u76EE\u6838\u7B97\u4F59\u989D\u8868'; 
FINC00008=CREATE TABLE IF NOT EXISTS {lockDbName}.fin_assitementryaccall (autoId int(10) NOT NULL AUTO_INCREMENT COMMENT '\u81EA\u589EID',customerId int(10) NOT NULL DEFAULT '0' COMMENT '\u5BA2\u6237ID',yyyy int(10) NOT NULL DEFAULT '0' COMMENT '\u5E74',subMonth int(10) NOT NULL DEFAULT '0' COMMENT '\u6708',subjectId varchar(50) NOT NULL DEFAULT '0' COMMENT '\u79D1\u76EE\u7F16\u53F7',subjectName varchar(500) DEFAULT NULL COMMENT '\u79D1\u76EE\u540D\u79F0',assItemId varchar(100) NOT NULL DEFAULT '0' COMMENT '\u6838\u7B97\u9879\u7F16\u53F7',assItemName varchar(500) DEFAULT NULL COMMENT '\u6838\u7B97\u9879\u540D\u79F0',direction int(2) DEFAULT '0' COMMENT '\u501F\u8D37\u65B9\u5411',currency varchar(30) DEFAULT NULL COMMENT '\u5E01\u79CD',debitRemain decimal(30,4) DEFAULT '0.0000' COMMENT '\u501F\u65B9\u671F\u521D',creditRemain decimal(30,4) DEFAULT '0.0000' COMMENT '\u8D37\u65B9\u671F\u521D',remain decimal(30,4) DEFAULT '0.0000' COMMENT '\u671F\u521D\u6570',debitOcc decimal(30,4) DEFAULT '0.0000' COMMENT '\u501F\u65B9\u53D1\u751F\u989D',creditOcc decimal(30,4) DEFAULT '0.0000' COMMENT '\u8D37\u65B9\u53D1\u751F\u989D',tranDebitOcc decimal(30,4) DEFAULT '0.0000' COMMENT '\u501F\u65B9\u635F\u76CA\u7ED3\u8F6C\u6570',tranCreditOcc decimal(30,4) DEFAULT '0.0000' COMMENT '\u8D37\u65B9\u635F\u76CA\u7ED3\u8F6C\u6570',debitOccNoTran decimal(30,4) DEFAULT '0.0000' COMMENT '\u501F\u65B9\u5254\u9664\u7ED3\u8F6C\u53D1\u751F\u989D',creditOccNoTran decimal(30,4) DEFAULT '0.0000' COMMENT '\u8D37\u65B9\u5254\u9664\u7ED3\u8F6C\u53D1\u751F\u989D',debitTotalOcc decimal(30,4) DEFAULT '0.0000' COMMENT '\u501F\u65B9\u53D1\u751F\u989D\u7D2F\u8BA1\u6570',creditTotalOcc decimal(30,4) DEFAULT '0.0000' COMMENT '\u8D37\u65B9\u53D1\u751F\u989D\u7D2F\u8BA1\u6570',debitBalance decimal(30,4) DEFAULT '0.0000' COMMENT '\u501F\u65B9\u671F\u672B',creditBalance decimal(30,4) DEFAULT '0.0000' COMMENT '\u8D37\u65B9\u671F\u672B',balance decimal(30,4) DEFAULT '0.0000' COMMENT '\u671F\u672B\u6570',debitRemainF decimal(30,4) DEFAULT '0.0000' COMMENT '\u501F\u65B9\u671F\u521D(\u5916\u5E01)',creditRemainF decimal(30,4) DEFAULT '0.0000' COMMENT '\u8D37\u65B9\u671F\u521D(\u5916\u5E01)',remainF decimal(30,4) DEFAULT '0.0000' COMMENT '\u671F\u521D\u6570(\u5916\u5E01)',debitOccF decimal(30,4) DEFAULT '0.0000' COMMENT '\u501F\u65B9\u53D1\u751F\u989D(\u5916\u5E01)',creditOccF decimal(30,4) DEFAULT '0.0000' COMMENT '\u8D37\u65B9\u53D1\u751F\u989D(\u5916\u5E01)',tranDebitOccF decimal(30,4) DEFAULT '0.0000' COMMENT '\u501F\u65B9\u635F\u76CA\u7ED3\u8F6C\u6570(\u5916\u5E01)',tranCreditOccF decimal(30,4) DEFAULT '0.0000' COMMENT '\u8D37\u65B9\u635F\u76CA\u7ED3\u8F6C\u6570(\u5916\u5E01)',debitOccNoTranF decimal(30,4) DEFAULT '0.0000' COMMENT '\u501F\u65B9\u5254\u9664\u7ED3\u8F6C\u53D1\u751F\u989D(\u5916\u5E01)',creditOccNoTranF decimal(30,4) DEFAULT '0.0000' COMMENT '\u8D37\u65B9\u5254\u9664\u7ED3\u8F6C\u53D1\u751F\u989D(\u5916\u5E01)',debitTotalOccF decimal(30,4) DEFAULT '0.0000' COMMENT '\u501F\u65B9\u53D1\u751F\u989D\u7D2F\u8BA1\u6570(\u5916\u5E01)',creditTotalOccF decimal(30,4) DEFAULT '0.0000' COMMENT '\u8D37\u65B9\u53D1\u751F\u989D\u7D2F\u8BA1\u6570(\u5916\u5E01)',debitBalanceF decimal(30,4) DEFAULT '0.0000' COMMENT '\u501F\u65B9\u671F\u672B(\u5916\u5E01)',creditBalanceF decimal(30,4) DEFAULT '0.0000' COMMENT '\u8D37\u65B9\u671F\u672B(\u5916\u5E01)',balanceF decimal(30,4) DEFAULT '0.0000' COMMENT '\u671F\u672B\u6570(\u5916\u5E01)',isLeaf1 int(1) DEFAULT '0' COMMENT '\u662F\u5426\u672B\u7EA7\u6838\u7B97',level1 int(1) DEFAULT '0' COMMENT '\u6838\u7B97\u7EA7\u522B',subjectFullName varchar(800) DEFAULT NULL COMMENT '\u79D1\u76EE\u5168\u8DEF\u5F84',assTotalName varchar(800) DEFAULT NULL COMMENT '\u6838\u7B97\u9879\u5168\u79F0',s1 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s2 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s3 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s4 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s5 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s6 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s7 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s8 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s9 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s10 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s11 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s12 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s13 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s14 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s15 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s16 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s17 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s18 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s19 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s20 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s21 text COMMENT '\u5907\u7528\u5B57\u6BB5',s22 text COMMENT '\u5907\u7528\u5B57\u6BB5',s23 text COMMENT '\u5907\u7528\u5B57\u6BB5',s24 text COMMENT '\u5907\u7528\u5B57\u6BB5',s25 text COMMENT '\u5907\u7528\u5B57\u6BB5',CREATION_DATE datetime DEFAULT NULL COMMENT '\u521B\u5EFA\u65E5',CREATED_BY varchar(20) DEFAULT NULL COMMENT '\u521B\u5EFA\u4EBAID',LAST_UPDATE_DATE datetime DEFAULT NULL COMMENT '\u6700\u540E\u66F4\u65B0\u65E5',LAST_UPDATED_BY varchar(20) DEFAULT NULL COMMENT '\u6700\u540E\u66F4\u65B0\u4EBAID',ABOLITION_DATE datetime DEFAULT NULL COMMENT '\u5220\u9664\u65E5',ABOLISHED_BY varchar(20) DEFAULT NULL COMMENT '\u5220\u9664\u4EBAID',PROGRAM_APPLICATION_ID varchar(20) DEFAULT NULL COMMENT '\u4ECE\u54EA\u4E2A\u7CFB\u7EDF\u64CD\u4F5C\u7684\u6570\u636E',PROGRAM_ID varchar(20) DEFAULT NULL COMMENT '\u54EA\u4E2A\u7A0B\u5E8F\u64CD\u4F5C\u7684\u6570\u636E',ACTIVE_FLAG varchar(1) DEFAULT '1' COMMENT '0:\u65E0\u6548\u6570\u636E\uFF1B1\uFF1A\u6709\u6548\u6570\u636E',PRIMARY KEY (autoId) USING BTREE,UNIQUE KEY UniqueKey (customerId,yyyy,subMonth,subjectId,assItemId,currency) USING BTREE COMMENT '\u552F\u4E00key') ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='\u5916\u5E01\u79D1\u76EE\u6838\u7B97\u4F59\u989D\u8868'; 
FINC00009=CREATE TABLE IF NOT EXISTS {lockDbName}.fin_subjectassitem (autoId int(10) NOT NULL AUTO_INCREMENT COMMENT '\u81EA\u589EID',customerId int(10) NOT NULL DEFAULT '0' COMMENT '\u5BA2\u6237ID',yyyy int(10) NOT NULL DEFAULT '0' COMMENT '\u5E74',subjectId varchar(50) NOT NULL DEFAULT '0' COMMENT '\u79D1\u76EE\u7F16\u53F7',subjectName varchar(500) DEFAULT NULL COMMENT '\u79D1\u76EE\u540D\u79F0',assItemId varchar(100) NOT NULL DEFAULT '0' COMMENT '\u6838\u7B97\u540D\u7F16\u53F7',assItemName varchar(500) DEFAULT NULL COMMENT '\u6838\u7B97\u9879\u540D',subjectFullId varchar(200) DEFAULT NULL COMMENT '\u79D1\u76EE\u7F16\u53F7\u5168\u8DEF\u5F84',subjectFullName varchar(800) DEFAULT NULL COMMENT '\u79D1\u76EE\u5168\u8DEF\u5F84',assItemFullId varchar(200) DEFAULT NULL COMMENT '\u6838\u7B97\u7F16\u53F7\u5168\u8DEF\u5F84',assTotalName varchar(800) DEFAULT NULL COMMENT '\u6838\u7B97\u9879\u5168\u79F0',s1 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s2 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s3 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s4 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s5 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s6 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s7 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s8 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s9 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s10 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s11 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s12 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s13 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s14 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s15 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s16 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s17 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s18 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s19 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s20 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s21 text COMMENT '\u5907\u7528\u5B57\u6BB5',s22 text COMMENT '\u5907\u7528\u5B57\u6BB5',s23 text COMMENT '\u5907\u7528\u5B57\u6BB5',s24 text COMMENT '\u5907\u7528\u5B57\u6BB5',s25 text COMMENT '\u5907\u7528\u5B57\u6BB5',CREATION_DATE datetime DEFAULT NULL COMMENT '\u521B\u5EFA\u65E5',CREATED_BY varchar(20) DEFAULT NULL COMMENT '\u521B\u5EFA\u4EBAID',LAST_UPDATE_DATE datetime DEFAULT NULL COMMENT '\u6700\u540E\u66F4\u65B0\u65E5',LAST_UPDATED_BY varchar(20) DEFAULT NULL COMMENT '\u6700\u540E\u66F4\u65B0\u4EBAID',ABOLITION_DATE datetime DEFAULT NULL COMMENT '\u5220\u9664\u65E5',ABOLISHED_BY varchar(20) DEFAULT NULL COMMENT '\u5220\u9664\u4EBAID',PROGRAM_APPLICATION_ID varchar(20) DEFAULT NULL COMMENT '\u4ECE\u54EA\u4E2A\u7CFB\u7EDF\u64CD\u4F5C\u7684\u6570\u636E',PROGRAM_ID varchar(20) DEFAULT NULL COMMENT '\u54EA\u4E2A\u7A0B\u5E8F\u64CD\u4F5C\u7684\u6570\u636E',ACTIVE_FLAG varchar(1) DEFAULT '1' COMMENT '0:\u65E0\u6548\u6570\u636E\uFF1B1\uFF1A\u6709\u6548\u6570\u636E',PRIMARY KEY (autoId),KEY AccKey (customerId,yyyy,subjectId,assItemId) USING BTREE) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='\u6838\u7B97\u79D1\u76EE\u8868(\u6682\u4E0D\u6E05\u695A)'; 
FINC00010=CREATE TABLE IF NOT EXISTS {lockDbName}.fin_subjectentry (autoId int(10) NOT NULL AUTO_INCREMENT COMMENT '\u81EA\u589EID',customerId int(10) NOT NULL DEFAULT '0' COMMENT '\u5BA2\u6237ID',yyyy int(10) NOT NULL DEFAULT '0' COMMENT '\u5E74',month int(2) DEFAULT '0' COMMENT '\u6708',subjectId varchar(50) NOT NULL DEFAULT '0' COMMENT '\u79D1\u76EE\u7F16\u53F7',oldVoucherId varchar(50) DEFAULT NULL COMMENT '\u539F\u59CB\u6570\u636E\u51ED\u8BC1ID',voucherId varchar(50) DEFAULT NULL COMMENT '\u7CFB\u7EDF\u751F\u6210\u51ED\u8BC1ID',vchDate varchar(10) DEFAULT NULL COMMENT '\u51ED\u8BC1\u65E5\u671F',vchTime varchar(15) DEFAULT NULL COMMENT '\u51ED\u8BC1\u65F6\u95F4',typeId varchar(200) DEFAULT NULL COMMENT '\u51ED\u8BC1\u7C7B\u578B',serail int(10) DEFAULT '0' COMMENT '\u5206\u5F55\u53F7',summary longtext DEFAULT NULL COMMENT '\u6458\u8981',direction int(2) DEFAULT '0' COMMENT '\u501F\u8D37\u65B9\u5411',currency varchar(30) DEFAULT NULL COMMENT '\u5E01\u79CD',occurValue decimal(30,4) DEFAULT '0.0000' COMMENT '\u53D1\u751F\u989D(\u672C\u4F4D\u5E01)',currRate decimal(30,4) DEFAULT '0.0000' COMMENT '\u6C47\u7387',currValue decimal(30,4) DEFAULT '0.0000' COMMENT '\u53D1\u751F\u989D(\u539F\u5E01)',voucherFillUser varchar(50) DEFAULT NULL COMMENT '\u5236\u5355\u4EBA',voucherKeepUser varchar(50) DEFAULT NULL COMMENT '\u8BB0\u8D26\u4EBA',voucherAuditUser varchar(50) DEFAULT NULL COMMENT '\u5BA1\u6838\u4EBA',quantity decimal(30,4) DEFAULT '0.0000' COMMENT '\u6570\u91CF',unitPrice decimal(30,4) DEFAULT '0.0000' COMMENT '\u5355\u4EF7',unitName varchar(20) DEFAULT NULL COMMENT '\u5355\u4F4D',subjectName varchar(500) DEFAULT NULL COMMENT '\u79D1\u76EE\u540D\u79F0',subjectFullName varchar(800) DEFAULT NULL COMMENT '\u79D1\u76EE\u5168\u8DEF\u5F84',debitsubjects text COMMENT '\u501F\u65B9\u79D1\u76EE',creditsubjects text COMMENT '\u8D37\u65B9\u79D1\u76EE',drCount int(11) DEFAULT '0' COMMENT '\u51ED\u8BC1\u501F\u65B9\u79D1\u76EE\u6570',crCount int(11) DEFAULT '0' COMMENT '\u51ED\u8BC1\u8D37\u65B9\u79D1\u76EE\u6570',voucherDebitOcc decimal(30,4) DEFAULT NULL COMMENT '\u51ED\u8BC1\u501F\u65B9\u53D1\u751F\u989D\u5408\u8BA1',voucherCreditOcc decimal(30,4) DEFAULT NULL COMMENT '\u51ED\u8BC1\u8D37\u65B9\u53D1\u751F\u989D\u5408\u8BA1',oppositeAccountTop text COMMENT '\u5BF9\u65B9\u79D1\u76EE\u4E00\u7EA7',oppositeAccountLast text COMMENT '\u5BF9\u65B9\u79D1\u76EE\u672B\u7EA7',oppositeTopSubjectValue text COMMENT '\u5BF9\u65B9\u79D1\u76EE\u91D1\u989D(\u4E00\u7EA7\u79D1\u76EE)',oppositeSubjectValue text COMMENT '\u5BF9\u65B9\u79D1\u76EE\u91D1\u989D(\u672B\u7EA7\u79D1\u76EE)',correspondOccurValue decimal(30,4) DEFAULT '0.0000' COMMENT '\u5BF9\u5E94\u53D1\u751F\u989D',voucherAffixCount int(10) DEFAULT '0' COMMENT '\u9644\u4EF6\u5F20\u6570',voucherDirector varchar(20) DEFAULT NULL COMMENT '\u8D22\u52A1\u4E3B\u7BA1',isTransferVoucher int(1) DEFAULT '0' COMMENT '\u662F\u5426\u7ED3\u8F6C\u51ED\u8BC1 0:\u5426; 1:\u662F',s1 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s2 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s3 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s4 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s5 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s6 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s7 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s8 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s9 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s10 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s11 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s12 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s13 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s14 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s15 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s16 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s17 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s18 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s19 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s20 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s21 text COMMENT '\u5907\u7528\u5B57\u6BB5',s22 text COMMENT '\u5907\u7528\u5B57\u6BB5',s23 text COMMENT '\u5907\u7528\u5B57\u6BB5',s24 text COMMENT '\u5907\u7528\u5B57\u6BB5',s25 text COMMENT '\u5907\u7528\u5B57\u6BB5',CREATION_DATE datetime DEFAULT NULL COMMENT '\u521B\u5EFA\u65E5',CREATED_BY varchar(20) DEFAULT NULL COMMENT '\u521B\u5EFA\u4EBAID',LAST_UPDATE_DATE datetime DEFAULT NULL COMMENT '\u6700\u540E\u66F4\u65B0\u65E5',LAST_UPDATED_BY varchar(20) DEFAULT NULL COMMENT '\u6700\u540E\u66F4\u65B0\u4EBAID',ABOLITION_DATE datetime DEFAULT NULL COMMENT '\u5220\u9664\u65E5',ABOLISHED_BY varchar(20) DEFAULT NULL COMMENT '\u5220\u9664\u4EBAID',PROGRAM_APPLICATION_ID varchar(20) DEFAULT NULL COMMENT '\u4ECE\u54EA\u4E2A\u7CFB\u7EDF\u64CD\u4F5C\u7684\u6570\u636E',PROGRAM_ID varchar(20) DEFAULT NULL COMMENT '\u54EA\u4E2A\u7A0B\u5E8F\u64CD\u4F5C\u7684\u6570\u636E',ACTIVE_FLAG varchar(1) DEFAULT '1' COMMENT '0:\u65E0\u6548\u6570\u636E\uFF1B1\uFF1A\u6709\u6548\u6570\u636E',PRIMARY KEY (autoId),KEY SearchKey (customerId,yyyy,month,subjectId,oldVoucherId,voucherId,vchDate) USING BTREE,KEY SubjectEntryKey (customerId,yyyy,vchDate,voucherId,serail)) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='\u51ED\u8BC1\u5206\u5F55\u8868'; 
FINC00011=CREATE TABLE IF NOT EXISTS {lockDbName}.fin_subjectvoucher (autoId int(10) NOT NULL AUTO_INCREMENT COMMENT '\u81EA\u589EID',customerId int(10) NOT NULL DEFAULT '0' COMMENT '\u5BA2\u6237ID',yyyy int(10) NOT NULL DEFAULT '0' COMMENT '\u5E74',month int(2) DEFAULT '0' COMMENT '\u6708',oldVoucherId varchar(50) DEFAULT NULL COMMENT '\u539F\u59CB\u6570\u636E\u51ED\u8BC1ID',voucherId varchar(50) DEFAULT NULL COMMENT '\u7CFB\u7EDF\u751F\u6210\u51ED\u8BC1ID',vchDate varchar(10) DEFAULT NULL COMMENT '\u51ED\u8BC1\u65E5\u671F',vchTime varchar(15) DEFAULT NULL COMMENT '\u51ED\u8BC1\u65F6\u95F4',typeId varchar(200) DEFAULT NULL COMMENT '\u51ED\u8BC1\u7C7B\u578B',voucherFillUser varchar(50) DEFAULT NULL COMMENT '\u5236\u5355\u4EBA',voucherKeepUser varchar(50) DEFAULT NULL COMMENT '\u8BB0\u8D26\u4EBA',voucherAuditUser varchar(50) DEFAULT NULL COMMENT '\u5BA1\u6838\u4EBA',voucherAffixCount int(10) DEFAULT '0' COMMENT '\u9644\u4EF6\u5F20\u6570',voucherDirector varchar(20) DEFAULT NULL COMMENT '\u8D22\u52A1\u4E3B\u7BA1',debitocc decimal(30,4) DEFAULT NULL COMMENT '\u501F\u65B9\u53D1\u751F\u6570',creditocc decimal(30,4) DEFAULT NULL COMMENT '\u8D37\u65B9\u53D1\u751F\u6570',s1 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s2 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s3 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s4 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s5 varchar(500) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s6 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s7 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s8 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s9 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s10 int(10) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s11 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s12 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s13 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s14 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s15 decimal(30,4) DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s16 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s17 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s18 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s19 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s20 datetime DEFAULT NULL COMMENT '\u5907\u7528\u5B57\u6BB5',s21 text COMMENT '\u5907\u7528\u5B57\u6BB5',s22 text COMMENT '\u5907\u7528\u5B57\u6BB5',s23 text COMMENT '\u5907\u7528\u5B57\u6BB5',s24 text COMMENT '\u5907\u7528\u5B57\u6BB5',s25 text COMMENT '\u5907\u7528\u5B57\u6BB5',CREATION_DATE datetime DEFAULT NULL COMMENT '\u521B\u5EFA\u65E5',CREATED_BY varchar(20) DEFAULT NULL COMMENT '\u521B\u5EFA\u4EBAID',LAST_UPDATE_DATE datetime DEFAULT NULL COMMENT '\u6700\u540E\u66F4\u65B0\u65E5',LAST_UPDATED_BY varchar(20) DEFAULT NULL COMMENT '\u6700\u540E\u66F4\u65B0\u4EBAID',ABOLITION_DATE datetime DEFAULT NULL COMMENT '\u5220\u9664\u65E5',ABOLISHED_BY varchar(20) DEFAULT NULL COMMENT '\u5220\u9664\u4EBAID',PROGRAM_APPLICATION_ID varchar(20) DEFAULT NULL COMMENT '\u4ECE\u54EA\u4E2A\u7CFB\u7EDF\u64CD\u4F5C\u7684\u6570\u636E',PROGRAM_ID varchar(20) DEFAULT NULL COMMENT '\u54EA\u4E2A\u7A0B\u5E8F\u64CD\u4F5C\u7684\u6570\u636E',ACTIVE_FLAG varchar(1) DEFAULT '1' COMMENT '0:\u65E0\u6548\u6570\u636E\uFF1B1\uFF1A\u6709\u6548\u6570\u636E',PRIMARY KEY (autoId),KEY SearchKey (customerId,yyyy,month,oldVoucherId,voucherId,vchDate) USING BTREE) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='\u51ED\u8BC1\u8868'; 
FINC00012=CREATE TABLE IF NOT EXISTS {lockDbName}.fin_subjectvouchercorr (customerId INT (10) NOT NULL DEFAULT '0' COMMENT '\u5BA2\u6237ID',yyyy INT (10) NOT NULL DEFAULT '0' COMMENT '\u5E74',month INT (2) DEFAULT NULL COMMENT '\u6708',voucherId VARCHAR (50) NOT NULL COMMENT '\u7CFB\u7EDF\u751F\u6210\u51ED\u8BC1ID',oldVoucherId VARCHAR (200) DEFAULT NULL COMMENT '\u539F\u59CB\u6570\u636E\u51ED\u8BC1ID',vchDate VARCHAR (20) DEFAULT NULL COMMENT '\u51ED\u8BC1\u65E5\u671F',serail INT (10) NOT NULL COMMENT '\u5206\u5F55\u7F16\u53F7',typeId VARCHAR (200) DEFAULT NULL COMMENT '\u51ED\u8BC1\u7C7B\u578B',subjectId VARCHAR (50) DEFAULT '0' COMMENT '\u79D1\u76EE\u7F16\u53F7',direction INT (2) DEFAULT NULL COMMENT '\u501F\u8D37\u65B9\u5411',corrSubjectId VARCHAR (50) NOT NULL COMMENT '\u5BF9\u5E94\u51ED\u8BC1\u79D1\u76EE\u7F16\u53F7',corrDirection INT (2) NOT NULL COMMENT '\u5BF9\u5E94\u79D1\u76EE\u65B9\u5411',corrValue DECIMAL (30,4) DEFAULT '0.0000' COMMENT '\u5BF9\u5E94\u53D1\u751F\u989D(\u672C\u4F4D\u5E01)',voucherType VARCHAR (1) DEFAULT NULL COMMENT '\u5BF9\u5E94\u51ED\u8BC1\u7C7B\u578B M:\u591A\u501F\u591A\u8D37 S:\u540C\u501F\u540C\u8D37',CREATION_DATE datetime DEFAULT NULL COMMENT '\u521B\u5EFA\u65E5',CREATED_BY VARCHAR (20) DEFAULT NULL COMMENT '\u521B\u5EFA\u4EBAID',LAST_UPDATE_DATE datetime DEFAULT NULL COMMENT '\u6700\u540E\u66F4\u65B0\u65E5',LAST_UPDATED_BY VARCHAR (20) DEFAULT NULL COMMENT '\u6700\u540E\u66F4\u65B0\u4EBAID',ABOLITION_DATE datetime DEFAULT NULL COMMENT '\u5220\u9664\u65E5',ABOLISHED_BY VARCHAR (20) DEFAULT NULL COMMENT '\u5220\u9664\u4EBAID',PROGRAM_APPLICATION_ID VARCHAR (20) DEFAULT NULL COMMENT '\u4ECE\u54EA\u4E2A\u7CFB\u7EDF\u64CD\u4F5C\u7684\u6570\u636E',PROGRAM_ID VARCHAR (20) DEFAULT NULL COMMENT '\u54EA\u4E2A\u7A0B\u5E8F\u64CD\u4F5C\u7684\u6570\u636E',ACTIVE_FLAG VARCHAR (1) DEFAULT '1' COMMENT '0:\u65E0\u6548\u6570\u636E\uFF1B1\uFF1A\u6709\u6548\u6570\u636E',PRIMARY KEY (customerId,yyyy,voucherId,serail,corrSubjectId,corrDirection) USING BTREE,KEY inx_voucher (customerId,yyyy,voucherId) USING BTREE COMMENT '\u51ED\u8BC1\u7D22\u5F15',KEY inx_voucherType(voucherType) USING BTREE) ENGINE=INNODB DEFAULT CHARSET=utf8 COMMENT='\u5BF9\u5E94\u51ED\u8BC1\u5206\u6790\u8868';
FINC00013=CREATE TABLE IF NOT EXISTS {lockDbName}.fin_subjectvoucherAuth (autoId int(10) NOT NULL AUTO_INCREMENT COMMENT '\u81EA\u589EID',customerId INT (10) NOT NULL DEFAULT '0' COMMENT '\u5BA2\u6237ID',yyyy INT (10) NOT NULL DEFAULT '0' COMMENT '\u5E74',userName VARCHAR (50) DEFAULT '' COMMENT '\u59D3\u540D',roleName VARCHAR (50) DEFAULT '' COMMENT '\u89D2\u8272\u540D',subjectId VARCHAR (800) DEFAULT '' COMMENT '\u79D1\u76EE\u7F16\u53F7',subjectName VARCHAR (800) DEFAULT '' COMMENT '\u79D1\u76EE\u540D\u79F0',CREATION_DATE datetime DEFAULT NULL COMMENT '\u521B\u5EFA\u65E5',CREATED_BY VARCHAR (20) DEFAULT NULL COMMENT '\u521B\u5EFA\u4EBAID',LAST_UPDATE_DATE datetime DEFAULT NULL COMMENT '\u6700\u540E\u66F4\u65B0\u65E5',LAST_UPDATED_BY VARCHAR (20) DEFAULT NULL COMMENT '\u6700\u540E\u66F4\u65B0\u4EBAID',ABOLITION_DATE datetime DEFAULT NULL COMMENT '\u5220\u9664\u65E5',ABOLISHED_BY VARCHAR (20) DEFAULT NULL COMMENT '\u5220\u9664\u4EBAID',PROGRAM_APPLICATION_ID VARCHAR (20) DEFAULT NULL COMMENT '\u4ECE\u54EA\u4E2A\u7CFB\u7EDF\u64CD\u4F5C\u7684\u6570\u636E',PROGRAM_ID VARCHAR (20) DEFAULT NULL COMMENT '\u54EA\u4E2A\u7A0B\u5E8F\u64CD\u4F5C\u7684\u6570\u636E',ACTIVE_FLAG VARCHAR (1) DEFAULT '1' COMMENT '0:\u65E0\u6548\u6570\u636E\uFF1B1\uFF1A\u6709\u6548\u6570\u636E',PRIMARY KEY (autoId) USING BTREE,KEY SearchKey (customerId,yyyy,userName,subjectId) USING BTREE) ENGINE=INNODB DEFAULT CHARSET=utf8 COMMENT='\u5236\u5355\u4EBA\u548C\u5BA1\u6838\u4EBA\u6743\u9650\u8868';
FINC00014=CREATE TABLE IF NOT EXISTS {lockDbName}.fin_subjectvouchergroup(customerId int(10) NOT NULL COMMENT '\u5BA2\u6237ID',  yyyy int(10) NOT NULL COMMENT '\u5E74',  groupType varchar(1) NOT NULL COMMENT '\u5206\u7EC4\u7C7B\u578B 1:\u79D1\u76EE\u76F8\u540C,\u91D1\u989D\u76F8\u540C 2:\u79D1\u76EE\u76F8\u540C,\u91D1\u989D\u76F8\u53CD 3\u79D1\u76EE\u4E0D\u540C,\u91D1\u989D\u76F8\u540C',  groupId int(10) NOT NULL COMMENT '\u5206\u7EC4\u7F16\u53F7',  voucherId text COMMENT '\u7CFB\u7EDF\u51ED\u8BC1\u53F7',  debitSubjects text COMMENT '\u501F\u65B9\u79D1\u76EE',  creditSubjects text COMMENT '\u8D37\u65B9\u79D1\u76EE',  debitOcc decimal(30,4) DEFAULT NULL COMMENT '\u501F\u65B9\u53D1\u751F\u989D',  creditOcc decimal(30,4) DEFAULT NULL COMMENT '\u8D37\u65B9\u53D1\u751F\u989D',  voucherNum int(11) DEFAULT NULL COMMENT '\u51ED\u8BC1\u6570\u91CF',  vchDateNum int(11) DEFAULT NULL COMMENT '\u6D89\u53CA\u5929\u6570',  vchMonthNum varchar(200) DEFAULT NULL COMMENT '\u6BCF\u6708\u51ED\u8BC1\u6570',  CREATION_DATE datetime DEFAULT NULL COMMENT '\u521B\u5EFA\u65E5',  CREATED_BY varchar(20) DEFAULT NULL COMMENT '\u521B\u5EFA\u4EBAID',  LAST_UPDATE_DATE datetime DEFAULT NULL COMMENT '\u6700\u540E\u66F4\u65B0\u65E5',  LAST_UPDATED_BY varchar(20) DEFAULT NULL COMMENT '\u6700\u540E\u66F4\u65B0\u4EBAID',  ABOLITION_DATE datetime DEFAULT NULL COMMENT '\u5220\u9664\u65E5',  ABOLISHED_BY varchar(20) DEFAULT NULL COMMENT '\u5220\u9664\u4EBAID',  PROGRAM_APPLICATION_ID varchar(20) DEFAULT NULL COMMENT '\u4ECE\u54EA\u4E2A\u7CFB\u7EDF\u64CD\u4F5C\u7684\u6570\u636E',  PROGRAM_ID varchar(20) DEFAULT NULL COMMENT '\u54EA\u4E2A\u7A0B\u5E8F\u64CD\u4F5C\u7684\u6570\u636E',  ACTIVE_FLAG varchar(1) DEFAULT '1' COMMENT '0:\u65E0\u6548\u6570\u636E\uFF1B1\uFF1A\u6709\u6548\u6570\u636E',  PRIMARY KEY (customerId,yyyy,groupType,groupId) USING BTREE) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='\u51ED\u8BC1\u5206\u7EC4'

####################\u5BA1\u8BA1\u5E73\u53F0 \u63D2\u5165####################
####################\u5BA1\u8BA1\u5E73\u53F0 \u66F4\u65B0####################
#\u6570\u636E\u4FEE\u6B63
#\u66F4\u65B0\u5916\u5E01\u4F59\u989D\u8868\u7236\u79D1\u76EE\u671F\u521D\u671F\u672B
FINU00001=UPDATE {lockDbName}.fin_accountall t1 INNER JOIN (SELECT customerId,yyyy,subMonth,currency,SUM(debitRemain) AS debitRemain,SUM(creditRemain) AS creditRemain,SUM(remain) AS remain,SUM(debitBalance) AS debitBalance,SUM(creditBalance) AS creditBalance,SUM(balance) AS balance,SUM(debitRemainF) AS debitRemainF,SUM(creditRemainF) AS creditRemainF,SUM(remainF) AS remainF,SUM(debitBalanceF) AS debitBalanceF,SUM(creditBalanceF) AS creditBalanceF,SUM(balanceF) AS balanceF FROM {lockDbName}.fin_accountall WHERE isLeaf1 = 1 AND customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND subjectId IN (SELECT a1.subjectId FROM {lockDbName}.fin_accpkgsubject a1 WHERE a1.customerId = {lockCustomerId} AND a1.yyyy = {lockYyyy} AND a1.isLeaf1 = 1 AND a1.subjectFullId LIKE '{subjectId}/%') GROUP BY customerId,yyyy,subMonth,currency) t2 ON t1.customerId = t2.customerId AND t1.yyyy = t2.yyyy AND t1.subMonth = t2.subMonth AND t1.currency = t2.currency SET t1.debitRemain = t2.debitRemain,t1.creditRemain = t2.creditRemain,t1.remain = t2.remain,t1.debitBalance = t2.debitBalance,t1.creditBalance = t2.creditBalance,t1.balance = t2.balance,t1.debitRemainF = t2.debitRemainF,t1.creditRemainF = t2.creditRemainF,t1.remainF = t2.remainF,t1.debitBalanceF = t2.debitBalanceF,t1.creditBalanceF = t2.creditBalanceF,t1.balanceF = t2.balanceF WHERE t1.customerId = {lockCustomerId} AND t1.yyyy = {lockYyyy} AND t1.subjectId = '{subjectId}'
#\u66F4\u65B0\u4F59\u989D\u8868\u7236\u79D1\u76EE\u671F\u521D\u671F\u672B
FINU00002=UPDATE {lockDbName}.fin_account t1 INNER JOIN (SELECT customerId,yyyy,subMonth,SUM(debitRemain) AS debitRemain,SUM(creditRemain) AS creditRemain,SUM(remain) AS remain,SUM(debitBalance) AS debitBalance,SUM(creditBalance) AS creditBalance,SUM(balance) AS balance FROM {lockDbName}.fin_account WHERE isLeaf1 = 1 AND customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND subjectId IN (SELECT a1.subjectId FROM {lockDbName}.fin_accpkgsubject a1 WHERE a1.customerId = {lockCustomerId} AND a1.yyyy = {lockYyyy} AND a1.isLeaf1 = 1 AND a1.subjectFullId LIKE '{subjectId}/%') GROUP BY customerId,yyyy,subMonth) t2 ON t1.customerId = t2.customerId AND t1.yyyy = t2.yyyy AND t1.subMonth = t2.subMonth SET t1.debitRemain = t2.debitRemain,t1.creditRemain = t2.creditRemain,t1.remain = t2.remain,t1.debitBalance = t2.debitBalance,t1.creditBalance = t2.creditBalance,t1.balance = t2.balance WHERE t1.customerId = {lockCustomerId} AND t1.yyyy = {lockYyyy} AND t1.subjectId = '{subjectId}'
#\u66F4\u65B0\u5916\u5E01\u4F59\u989D\u8868\u7236\u79D1\u76EE\u671F\u521D\u671F\u672B
FINU00003=UPDATE {lockDbName}.fin_assitementryaccall t1 INNER JOIN (SELECT customerId,yyyy,subMonth,subjectId,currency,SUM(debitRemain) AS debitRemain,SUM(creditRemain) AS creditRemain,SUM(remain) AS remain,SUM(debitBalance) AS debitBalance,SUM(creditBalance) AS creditBalance,SUM(balance) AS balance,SUM(debitRemainF) AS debitRemainF,SUM(creditRemainF) AS creditRemainF,SUM(remainF) AS remainF,SUM(debitBalanceF) AS debitBalanceF,SUM(creditBalanceF) AS creditBalanceF,SUM(balanceF) AS balanceF FROM {lockDbName}.fin_assitementryaccall WHERE isLeaf1 = 1 AND customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND subjectId = '{subjectId}' AND assItemId IN (SELECT a2.assItemId FROM {lockDbName}.fin_assitem a1,{lockDbName}.fin_assitem a2 WHERE a1.customerId = {lockCustomerId} AND a1.yyyy = {lockYyyy} AND a1.subjectId = '{subjectId}' AND a1.assItemId = '{assItemId}' AND a1.customerId = a2.customerId AND a1.yyyy = a2.yyyy AND a1.subjectId = a2.subjectId AND a2.assItemFullId LIKE CONCAT(a1.assItemFullId,'|%')) GROUP BY customerId,yyyy,subMonth,subjectId,currency) t2 ON t1.customerId = t2.customerId AND t1.yyyy = t2.yyyy AND t1.subMonth = t2.subMonth AND t1.subjectId = t2.subjectId AND t1.currency = t2.currency SET t1.debitRemain = t2.debitRemain,t1.creditRemain = t2.creditRemain,t1.remain = t2.remain,t1.debitBalance = t2.debitBalance,t1.creditBalance = t2.creditBalance,t1.balance = t2.balance,t1.debitRemainF = t2.debitRemainF,t1.creditRemainF = t2.creditRemainF,t1.remainF = t2.remainF,t1.debitBalanceF = t2.debitBalanceF,t1.creditBalanceF = t2.creditBalanceF,t1.balanceF = t2.balanceF WHERE t1.customerId = {lockCustomerId} AND t1.yyyy = {lockYyyy} AND t1.subjectId = '{subjectId}' AND t1.assItemId = '{assItemId}'
#\u66F4\u65B0\u6838\u7B97\u4F59\u989D\u8868\u7236\u79D1\u76EE\u671F\u521D\u671F\u672B
FINU00004=UPDATE {lockDbName}.fin_assitementryacc t1 INNER JOIN (SELECT customerId,yyyy,subMonth,subjectId,currency,SUM(debitRemain) AS debitRemain,SUM(creditRemain) AS creditRemain,SUM(remain) AS remain,SUM(debitBalance) AS debitBalance,SUM(creditBalance) AS creditBalance,SUM(balance) AS balance FROM {lockDbName}.fin_assitementryacc WHERE isLeaf1 = 1 AND customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND subjectId = '{subjectId}' AND assItemId IN (SELECT a2.assItemId FROM {lockDbName}.fin_assitem a1,{lockDbName}.fin_assitem a2 WHERE a1.customerId = {lockCustomerId} AND a1.yyyy = {lockYyyy} AND a1.subjectId = '{subjectId}' AND a1.assItemId = '{assItemId}' AND a1.customerId = a2.customerId AND a1.yyyy = a2.yyyy AND a1.subjectId = a2.subjectId AND a2.assItemFullId LIKE CONCAT(a1.assItemFullId,'|%')) GROUP BY customerId,yyyy,subMonth,subjectId,currency) t2 ON t1.customerId = t2.customerId AND t1.yyyy = t2.yyyy AND t1.subMonth = t2.subMonth AND t1.subjectId = t2.subjectId AND t1.currency = t2.currency SET t1.debitRemain = t2.debitRemain,t1.creditRemain = t2.creditRemain,t1.remain = t2.remain,t1.debitBalance = t2.debitBalance,t1.creditBalance = t2.creditBalance,t1.balance = t2.balance WHERE t1.customerId = {lockCustomerId} AND t1.yyyy = {lockYyyy} AND t1.subjectId = '{subjectId}' AND t1.assItemId = '{assItemId}'
#\u66F4\u65B0fin_accpkgsubject\u65B9\u5411
FINU00005=UPDATE {lockDbName}.fin_accpkgsubject SET direction = {direction} WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND subjectId IN ({subjectId})
#\u66F4\u65B0fin_account\u65B9\u5411
FINU00006=UPDATE {lockDbName}.fin_account SET direction = {direction} WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND subjectId IN ({subjectId})
#\u66F4\u65B0fin_accountall\u65B9\u5411
FINU00007=UPDATE {lockDbName}.fin_accountall SET direction = {direction} WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND subjectId IN ({subjectId})
#\u66F4\u65B0fin_assitem\u65B9\u5411
FINU00008=UPDATE {lockDbName}.fin_assitem SET direction = {direction} WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND subjectId IN ({subjectId})
#\u66F4\u65B0fin_assitementryacc\u65B9\u5411
FINU00009=UPDATE {lockDbName}.fin_assitementryacc SET direction = {direction} WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND subjectId IN ({subjectId})
#\u66F4\u65B0fin_assitementryaccall\u65B9\u5411
FINU00010=UPDATE {lockDbName}.fin_assitementryaccall SET direction = {direction} WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND subjectId IN ({subjectId})
#\u6570\u636E\u8C03\u6574
#\u66F4\u65B0\u79D1\u76EE\u8868\u65B9\u5411
FINU00011=UPDATE {lockDbName}.fin_accpkgsubject SET direction = {direction} WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND subjectId LIKE '{subjectId}%'
#\u66F4\u65B0\u4F59\u989D\u8868\u65B9\u5411,\u671F\u521D\u671F\u672B
FINU00012=UPDATE {lockDbName}.fin_account SET direction = {direction},remain = (debitRemain-creditRemain) * {direction},balance = (debitBalance-creditBalance) * {direction} WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND subjectId LIKE '{subjectId}%'
#\u66F4\u65B0\u5916\u5E01\u4F59\u989D\u8868\u65B9\u5411,\u671F\u521D\u671F\u672B
FINU00013=UPDATE {lockDbName}.fin_accountall SET direction = {direction},remain = (debitRemain-creditRemain) * {direction},balance = (debitBalance-creditBalance) * {direction},remainF = (debitRemainF-creditRemainF) * {direction},balanceF = (debitBalanceF-creditBalanceF) * {direction} WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND subjectId LIKE '{subjectId}%'
#\u66F4\u65B0\u6838\u7B97\u79D1\u76EE\u8868\u65B9\u5411
FINU00014=UPDATE {lockDbName}.fin_assitem SET direction = {direction} WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND subjectId LIKE '{subjectId}%'
#\u66F4\u65B0\u6838\u7B97\u4F59\u989D\u8868\u65B9\u5411,\u671F\u521D\u671F\u672B
FINU00015=UPDATE {lockDbName}.fin_assitementryacc SET direction = {direction},remain = (debitRemain-creditRemain) * {direction},balance = (debitBalance-creditBalance) * {direction} WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND subjectId LIKE '{subjectId}%'
#\u66F4\u65B0\u5916\u5E01\u6838\u7B97\u4F59\u989D\u8868\u65B9\u5411,\u671F\u521D\u671F\u672B
FINU00016=UPDATE {lockDbName}.fin_assitementryaccall SET direction = {direction},remain = (debitRemain-creditRemain) * {direction},balance = (debitBalance-creditBalance) * {direction},remainF = (debitRemainF-creditRemainF) * {direction},balanceF = (debitBalanceF-creditBalanceF) * {direction} WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND subjectId LIKE '{subjectId}%'
#\u66F4\u65B0\u542B\u672C\u5E74\u5229\u6DA6\u51ED\u8BC1\u7684\u5BF9\u65B9\u79D1\u76EE
FINU00017=UPDATE {lockDbName}.fin_subjectentry t1 inner join (select autoId,case when a.subjectId NOT IN ({subjectId}) then a3 else a1 end as oppositeAccountLast,case when a.subjectId NOT IN ({subjectId}) then a4 else a2 end as oppositeAccountTop from {lockDbName}.fin_subjectentry a inner join (select a.customerId,a.yyyy,a.voucherId,GROUP_CONCAT(distinct case when a.subjectId NOT IN ({subjectId}) then a.subjectFullName else null end) as a1,GROUP_CONCAT(distinct case when a.subjectId NOT IN ({subjectId}) then substring_index(a.subjectFullName,'/',1) else null end) as a2,GROUP_CONCAT(distinct case when a.subjectId IN ({subjectId}) then a.subjectFullName else null end) as a3,GROUP_CONCAT(distinct case when a.subjectId IN ({subjectId}) then substring_index(a.subjectFullName,'/',1) else null end) as a4 from {lockDbName}.fin_subjectentry a where a.customerId={lockCustomerId} AND a.yyyy={lockYyyy} and a.voucherId in ({voucherId}) group by a.voucherId) b ON a.customerId = b.customerId AND a.yyyy = b.yyyy and a.voucherId = b.voucherId where a.customerId={lockCustomerId} AND a.yyyy={lockYyyy}) t2 on t1.autoId = t2.autoId set t1.oppositeAccountTop = t2.oppositeAccountTop, t1.oppositeAccountLast = t2.oppositeAccountLast where t1.customerId={lockCustomerId} AND t1.yyyy={lockYyyy}
#\u6E05\u7A7A\u7ED3\u8F6C\u989D
FINU00018=UPDATE {lockDbName}.fin_account SET tranDebitOcc = 0,tranCreditOcc = 0,debitOccNoTran = debitOcc,creditOccNoTran = creditOcc WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND subjectId IN ({subjectId})
#\u8BBE\u7F6E\u7ED3\u8F6C\u51ED\u8BC1
FINU00019=UPDATE {lockDbName}.fin_subjectentry SET isTransferVoucher = 1 WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND voucherId IN ({voucherId})
#\u8BBE\u7F6E\u672B\u7EA7\u79D1\u76EE\u7ED3\u8F6C\u989D
FINU00020=UPDATE {lockDbName}.fin_account a LEFT JOIN (SELECT subjectId,month AS subMonth,SUM(CASE direction WHEN 1 THEN occurValue ELSE 0 END) AS tranDebitOcc,SUM(CASE direction WHEN -1 THEN occurValue ELSE 0 END) AS tranCreditOcc FROM {lockDbName}.fin_subjectentry WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy} AND isTransferVoucher = 1 GROUP BY subjectId,month) b ON b.subjectId = a.subjectId AND b.subMonth = a.subMonth SET a.tranDebitOcc = IFNULL(b.tranDebitOcc,0),a.debitOccNoTran = a.debitOcc - a.tranDebitOcc,a.tranCreditOcc = IFNULL(b.tranCreditOcc,0),a.creditOccNoTran = a.creditOcc - a.tranCreditOcc WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.isLeaf1 = 1
#\u8BBE\u7F6E\u7236\u7EA7\u79D1\u76EE\u7ED3\u8F6C\u989D
FINU00021=UPDATE {lockDbName}.fin_account a LEFT JOIN (SELECT a.subjectId,a.subMonth,SUM(IFNULL(c.tranDebitOcc,0)) AS tranDebitOcc,SUM(IFNULL(c.debitOccNoTran,0)) AS debitOccNoTran,SUM(IFNULL(c.tranCreditOcc,0)) AS tranCreditOcc,SUM(IFNULL(c.creditOccNoTran,0)) AS creditOccNoTran FROM {lockDbName}.fin_account a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.subjectId = a.subjectId LEFT JOIN (SELECT a.subjectId,b.subjectFullId,a.subMonth,a.tranDebitOcc,a.debitOccNoTran,a.tranCreditOcc,a.creditOccNoTran FROM {lockDbName}.fin_account a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.subjectId = a.subjectId WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.isLeaf1 = 1) c ON c.subMonth = a.subMonth AND c.subjectFullId LIKE CONCAT(b.subjectFullId,'/%') WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.isLeaf1 = 0 GROUP BY a.subjectId,a.subMonth) c ON c.subMonth = a.subMonth AND c.subjectId = a.subjectId SET a.tranDebitOcc = c.tranDebitOcc,a.debitOccNoTran = c.debitOccNoTran,a.tranCreditOcc = c.tranCreditOcc,a.creditOccNoTran = c.creditOccNoTran WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.isLeaf1 = 0
#\u53D6\u6D88\u6240\u6709\u7ED3\u8F6C\u51ED\u8BC1
FINU00022=UPDATE {lockDbName}.fin_subjectentry SET isTransferVoucher = 0 WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy}
#\u6E05\u7A7A\u6240\u6709\u7ED3\u8F6C\u989D
FINU00023=UPDATE {lockDbName}.fin_account SET tranDebitOcc = 0,tranCreditOcc = 0,debitOccNoTran = debitOcc,creditOccNoTran = creditOcc WHERE customerId = {lockCustomerId} AND yyyy = {lockYyyy}
#\u6309\u51ED\u8BC1\u53F7\u66F4\u65B0\u5BF9\u65B9\u79D1\u76EE
FINU00024=UPDATE {lockDbName}.fin_subjectentry a INNER JOIN (SELECT a.customerId,a.yyyy,a.vchDate,a.voucherId,a.serail,GROUP_CONCAT(DISTINCT b.subjectFullName ORDER BY b.subjectId) AS oppositeAccountLast,GROUP_CONCAT(DISTINCT c.subjectFullName ORDER BY b.subjectId) AS oppositeAccountTop,GROUP_CONCAT(DISTINCT CONCAT(b.subjectFullName,':',round(a.corrValue,2)) ORDER BY b.subjectId) AS oppositeSubjectValue FROM (select a.customerId,a.yyyy,a.vchDate,a.voucherId,a.serail,a.corrSubjectId,sum(a.corrValue) as corrValue from {lockDbName}.fin_subjectvouchercorr a WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.voucherId IN ({voucherId}) GROUP BY a.voucherId,a.serail,a.corrSubjectId) a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.subjectId = a.corrSubjectId LEFT JOIN {lockDbName}.fin_accpkgsubject c ON c.customerId = b.customerId AND c.yyyy = b.yyyy AND c.subjectId = SUBSTRING_INDEX(b.subjectFullId,'/',1) WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.voucherId IN ({voucherId}) GROUP BY a.voucherId,a.serail) b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.vchDate = a.vchDate AND b.voucherId = a.voucherId AND b.serail = a.serail SET a.oppositeAccountTop = b.oppositeAccountTop, a.oppositeAccountLast = b.oppositeAccountLast, a.oppositeSubjectValue = b.oppositeSubjectValue WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.voucherId IN ({voucherId})
#\u6309\u51ED\u8BC1\u53F7\u66F4\u65B0\u5BF9\u65B9\u79D1\u76EE
FINU00025=UPDATE {lockDbName}.fin_subjectentry a INNER JOIN (SELECT a.customerId,a.yyyy,a.vchDate,a.voucherId,a.serail,GROUP_CONCAT(DISTINCT b.subjectFullName ORDER BY b.subjectId) AS oppositeAccountLast,GROUP_CONCAT(DISTINCT c.subjectFullName ORDER BY b.subjectId) AS oppositeAccountTop,GROUP_CONCAT(DISTINCT CONCAT(b.subjectFullName,':',round(a.corrValue,2)) ORDER BY b.subjectId) AS oppositeTopSubjectValue FROM (select a.customerId,a.yyyy,a.vchDate,a.voucherId,a.serail,SUBSTRING_INDEX(b.subjectFullId, '/', 1) as corrSubjectId,sum(a.corrValue) as corrValue from {lockDbName}.fin_subjectvouchercorr a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.subjectId = a.corrSubjectId WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.voucherId IN ({voucherId}) GROUP BY a.voucherId,a.serail,SUBSTRING_INDEX(b.subjectFullId, '/', 1)) a LEFT JOIN {lockDbName}.fin_accpkgsubject b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.subjectId = a.corrSubjectId LEFT JOIN {lockDbName}.fin_accpkgsubject c ON c.customerId = b.customerId AND c.yyyy = b.yyyy AND c.subjectId = SUBSTRING_INDEX(b.subjectFullId,'/',1) WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.voucherId IN ({voucherId}) GROUP BY a.voucherId,a.serail) b ON b.customerId = a.customerId AND b.yyyy = a.yyyy AND b.vchDate = a.vchDate AND b.voucherId = a.voucherId AND b.serail = a.serail SET a.oppositeTopSubjectValue = b.oppositeTopSubjectValue WHERE a.customerId = {lockCustomerId} AND a.yyyy = {lockYyyy} AND a.voucherId IN ({voucherId})
####################\u5BA1\u8BA1\u5E73\u53F0 \u66F4\u65B0####################
####################\u5BA1\u8BA1\u5E73\u53F0 \u5220\u9664####################
#\u6570\u636E\u5BFC\u5165 \u6570\u636E\u6E05\u9664
#\u6E05\u9664\u8D22\u52A1\u6570\u636E(\u6240\u6709\u5E74\u4EFD)
FIND00001=TRUNCATE TABLE {lockDbName}.fin_account
FIND00002=TRUNCATE TABLE {lockDbName}.fin_accountall
FIND00003=TRUNCATE TABLE {lockDbName}.fin_accpkgsubject
FIND00004=TRUNCATE TABLE {lockDbName}.fin_assitem
FIND00005=TRUNCATE TABLE {lockDbName}.fin_assitementry
FIND00006=TRUNCATE TABLE {lockDbName}.fin_assitementryacc
FIND00007=TRUNCATE TABLE {lockDbName}.fin_assitementryaccall
FIND00008=TRUNCATE TABLE {lockDbName}.fin_subjectassitem
FIND00009=TRUNCATE TABLE {lockDbName}.fin_subjectentry
FIND00010=TRUNCATE TABLE {lockDbName}.fin_subjectvoucher
#\u5220\u9664\u8D22\u52A1\u6570\u636E(\u6307\u5B9A\u5E74\u4EFD)
FIND00011=DELETE FROM {lockDbName}.fin_account WHERE customerId={lockCustomerId} AND yyyy={lockYyyy}
FIND00012=DELETE FROM {lockDbName}.fin_accountall WHERE customerId={lockCustomerId} AND yyyy={lockYyyy}
FIND00013=DELETE FROM {lockDbName}.fin_accpkgsubject WHERE customerId={lockCustomerId} AND yyyy={lockYyyy}
FIND00014=DELETE FROM {lockDbName}.fin_assitem WHERE customerId={lockCustomerId} AND yyyy={lockYyyy}
FIND00015=DELETE FROM {lockDbName}.fin_assitementry WHERE customerId={lockCustomerId} AND yyyy={lockYyyy}
FIND00016=DELETE FROM {lockDbName}.fin_assitementryacc WHERE customerId={lockCustomerId} AND yyyy={lockYyyy}
FIND00017=DELETE FROM {lockDbName}.fin_assitementryaccall WHERE customerId={lockCustomerId} AND yyyy={lockYyyy}
FIND00018=DELETE FROM {lockDbName}.fin_subjectassitem WHERE customerId={lockCustomerId} AND yyyy={lockYyyy}
FIND00019=DELETE FROM {lockDbName}.fin_subjectentry WHERE customerId={lockCustomerId} AND yyyy={lockYyyy}
FIND00020=DELETE FROM {lockDbName}.fin_subjectvoucher WHERE customerId={lockCustomerId} AND yyyy={lockYyyy}
#\u5220\u9664\u8D22\u52A1\u5E93
FIND00021=DROP DATABASE IF EXISTS {dbName}
#\u5220\u9664\u6307\u5B9A\u5BA2\u6237fin_customer\u8BB0\u5F55
FIND00022=DELETE FROM bdo_fin.fin_customer WHERE projectId = {projectId} AND systemId = '{systemId}'
#\u5220\u9664\u6307\u5B9A\u5BA2\u6237fin_assitemsame\u8BB0\u5F55
FIND00023=DELETE FROM bdo_fin.fin_assitemsame WHERE projectId = {projectId} AND systemId = '{systemId}'
#\u5220\u9664\u6307\u5B9A\u5BA2\u6237fin_control\u8BB0\u5F55
FIND00024=DELETE FROM bdo_fin.fin_control_new WHERE projectId = {projectId} AND systemId = '{systemId}'
#\u5220\u9664\u6307\u5B9A\u5BA2\u6237wind_benford\u8BB0\u5F55
FIND00025=DELETE FROM bdo_wind.wind_benford WHERE projectId = {projectId} AND systemId = '{systemId}'

FIND00026=TRUNCATE TABLE {lockDbName}.fin_subjectvouchercorr
#\u5220\u9664\u5BF9\u5E94\u51ED\u8BC1\u5206\u6790\u6570\u636E
FIND00027=DELETE FROM {lockDbName}.fin_subjectvouchercorr WHERE customerId={lockCustomerId} AND yyyy={lockYyyy}
#\u5220\u9664\u6307\u5B9A\u6708\u4EFD\u5BF9\u5E94\u51ED\u8BC1\u5206\u6790\u6570\u636E
FIND00028=DELETE FROM {lockDbName}.fin_subjectvouchercorr WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND month = {month}
#\u5220\u9664\u6307\u5B9A\u51ED\u8BC1\u5BF9\u5E94\u51ED\u8BC1\u5206\u6790\u6570\u636E
FIND00029=DELETE FROM {lockDbName}.fin_subjectvouchercorr WHERE customerId={lockCustomerId} AND yyyy={lockYyyy} AND voucherId IN ({voucherId})
####################\u5BA1\u8BA1\u5E73\u53F0 \u5220\u9664####################
