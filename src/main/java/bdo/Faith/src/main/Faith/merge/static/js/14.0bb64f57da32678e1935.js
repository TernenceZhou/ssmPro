webpackJsonp([14],{"/ZTP":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("woOf"),r=i.n(s),a=i("mvHQ"),n=i.n(a),l=i("ABj6"),o=i("ZHXk"),u=i.n(o),c=i("w/PL"),d=i("tNup"),m=i("de+t"),h=i("VzA3"),p=i("qcqk"),f={subjectName:"singleTrialBalance",props:{customerId:String,projectId:String,type:String},components:{BdoTable:l.a,AuditAjustment:d.default,SingleTB:m.default,Postill:h.a,counter:p.a},watch:{refreshPagesCollection:{handler:function(t){if(t&&t.refreshIndexes&&window.location.hash.indexOf("/checkTb")>-1){var e={key:this.setNum+=1,refreshIndexes:t.refreshIndexes};localStorage.setItem("refreshIndexes",n()(e)),this.refreshIndexes(t.refreshIndexes)}},immediate:!0,deep:!0}},data:function(){return{isOpenDrawer:!1,activeName:"tb",validItemList:[{prop:"checkCal",label:"校验项",filterOptions:{disabled:!0}},{prop:"unAuditAmount",label:"本年未审数",filterOptions:{disabled:!0}},{prop:"adjustAmount",label:"本年审计调整数",filterOptions:{disabled:!0}},{prop:"auditAmount",label:"本年审定数",filterOptions:{disabled:!0}},{prop:"preUnAuditAmount",label:"上年未审数",filterOptions:{disabled:!0}},{prop:"preAdjustAmount",label:"上年审计调整数",filterOptions:{disabled:!0}},{prop:"preAuditAmount",label:"上年审定数",filterOptions:{disabled:!0}}],validData:[],validDataModel:new c.a,curYear:this.$route.query.curYear,errorText:"校验不平",isErrorText:!1,setAlign:"center",setBorder:!0,tabsList:[{label:"试算平衡表",name:"tb",isMark:!1,menuID:"HB002-MC004-0001"},{label:"审计调整列表",name:"auditAjustment",isMark:!1,menuID:"HB002-MC004-0002"}],tbList:[],customerName:"",projectName:"",singleCustomerName:"",singleProjectName:"",_strArr:[],curProjectId:"",curCustomerId:"",setType:"QUERY_TB",validFail:!0,mainCustomerId:"",mainProjectId:"",limitArr:[],menuID:"",userId:"",activeLabel:"",refreshPagesCollection:{},setNum:0,number:0}},methods:{openDrawer:function(){this.isOpenDrawer=!0},closePostill:function(t){this.isOpenDrawer=t},isPostil:function(t){this.isPostilLink=!0},handleClick:function(t,e){var i=this;switch(this.activeLabel=t.label,this.activeName=t.name,t.name){case"tb":this.menuId="HB002-MC004-0001",this.tabsList[0].isMark=!1,this.refreshValidData(!0);break;case"auditAjustment":this.menuId="HB002-MC004-0002",this.tabsList[1].isMark=!1,this.$nextTick(function(){i.$refs.auditAjustment.offsetEntryInit()}),this.isResetValid(!0)}this.$store.commit("setSingleTBIndex",this.menuId),this.closePostill(!1),this.$router.push({name:"checkTb",query:{curYear:this.curYear,menuID:this.menuId}})},getPermission:function(){var t=this,e={menuId:"",sqlId:"DG00061",param1:this.projectName.split("-")[0],param2:this.customerName.split("-")[0]};this.$sacpApis.postillCheck(e).then(function(e){if(e.success){var i=e.data[0],s=[];if(i.manager==t.userId){s.push({status:"manager",limit:1})}if(i.signAccountant2==t.userId||i.signAccountant3==t.userId){s.push({status:"signAccountant2",limit:1})}if(i.audit1==t.userId){s.push({status:"audit1",limit:1})}if(i.audit2==t.userId){s.push({status:"audit2",limit:1})}if(i.reaReviewer==t.userId){s.push({status:"reaReviewer",limit:1})}if(i.signUser==t.userId){s.push({status:"signUser",limit:1})}if(i.reviewPartner==t.userId){s.push({status:"reviewPartner",limit:1})}if(i.issuedPeople==t.userId){s.push({status:"issuedPeople",limit:1})}t.limitArr=s}})},refreshValidData:function(t){t&&(this.handleValidItemData(),this.tbInit())},tbInit:function(){var t=this,e={customerId:this.curCustomerId,projectId:this.curProjectId,type:this.setType};this.$sacpApis.trialBalanceOrReportData(e).then(function(e){e.data&&(t.validItemList[1].label=t.curYear+"未审数",t.validItemList[2].label=t.curYear+"审计调整数",t.validItemList[3].label=t.curYear+"审定数",t.validItemList[4].label=t.curYear-1+"未审数",t.validItemList[5].label=t.curYear-1+"审计调整数",t.validItemList[6].label=t.curYear-1+"审定数",t.tbList=e.data)}).catch(function(e){t.$message.error(e)}).finally(function(){t.getPermission()})},queryURLParameter:function(t){var e={};return t.replace(/([^?&=]+)=([^?&=]+)/g,function(){e[arguments[1]]=arguments[2]}),e},handleValidItemData:function(){var t=this;this.validData=[];var e={projectId:this.curProjectId};this.$sacpApis.mergeScopeTbValidList(e).then(function(e){if(e.success){if(e.data){var i=e.data[e.data.length-1].checkFlag;t.validFail=i,t.isErrorText=!t.validFail}var s=e.data.slice(0,-1);for(var a in s){var n={};for(var l in r()(n,t.validDataModel,s[a]),n)if(0===n[l]){for(var o in t.validItemList)t.validItemList[o].prop==l&&(t.validItemList[o].align="center");n[l]="平"}else null===n[l]?n[l]=null:"checkCal"!=l&&(n[l]=u.a.commafy(n[l],{digits:2}));t.validData.push(n)}}else t.$message.error(e.resultInfo.statusText)}).catch(function(e){t.$message.error(e)}).finally(function(){})},commafy:function(t,e){return u.a.commafy(e,{digits:2})},handleCustomerInformation:function(){var t=JSON.parse(sessionStorage.getItem("curCustomerData"));this.customerName=t.curCustomerName,this.projectName=t.curProjectName,this.mainCustomerId=t.curCustomerId,this.mainProjectId=t.curProjectId,this.userId=t.userId,this.curYear=t.curYear;var e=JSON.parse(sessionStorage.getItem("projectItem"));-1!=e.mergeCustomerName.indexOf("-")?this.singleCustomerName=e.mergeCustomerName:this.singleCustomerName=e.mergeCustomerId+"-"+e.mergeCustomerName,this.singleProjectName=e.projectId,this._strArr=e.projectId.split("-"),this.curProjectId=this._strArr[0],this.curCustomerId=e.customerId,this.menuID=sessionStorage.getItem("menuID"),window.addEventListener("storage",this.storageEvent,!1)},initAgain:function(t){this.tbInit(),this.handleValidItemData()},isResetValid:function(t){t&&this.handleValidItemData()},refreshIndexes:function(t){if(t){this.tabsList.map(function(e){t.indexOf(e.menuID)>-1&&(e.isMark=!0)});var e=window.location.hash.split("="),i=this.tabsList.filter(function(t){return t.menuID===e[e.length-1]})[0]||{};i&&i.isMark&&this.handleClick(i)}},handlePostillLink:function(){var t=void 0,e=window.location.hash.split("/"),i=(e=e.pop()).split("&")[1].split("=")[1];"HB002-MC004-0001"==i?t={name:"tb",label:"试算平衡表"}:"HB002-MC004-0002"==i&&(t={name:"auditAjustment",label:"审计调整列表"}),this.handleClick(t)},storageEvent:function(){this.refreshPagesCollection=JSON.parse(localStorage.getItem("refreshIndexes"))},clear:function(t){this.number=t}},created:function(){this.handleCustomerInformation(),this.handlePostillLink()}},v={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-container",{staticClass:"container"},[i("el-header",[i("el-row",[i("el-col",{attrs:{span:1}},[i("div",{staticClass:"logo"})]),t._v(" "),i("el-col",{attrs:{span:7}},[i("div",{staticClass:"customerInformation"},[i("p",[t._v("客户:"+t._s(this.customerName))]),t._v(" "),i("p",[t._v("项目:"+t._s(this.projectName))])])]),t._v(" "),i("el-col",{attrs:{span:7}},[i("div",{staticClass:"singleCustomerInformation"},[i("p",[t._v("子客户:"+t._s(this.singleCustomerName))]),t._v(" "),i("p",[t._v("子项目:"+t._s(this.singleProjectName))])])]),t._v(" "),i("el-col",{attrs:{span:1}},[i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"批注",placement:"top-start"}},[i("el-button",{staticClass:"postillBtn singlePostillBtn",attrs:{circle:"",size:"small",icon:"el-icon-edit-outline"},on:{click:t.openDrawer}})],1)],1)],1)],1),t._v(" "),i("el-main",[i("div",{staticClass:"checkReportTable"},[i("div",{staticClass:"validErrorInfo"},[i("span",{style:t.validFail?"color:#000":"color:red"},[t._v(t._s(t.validFail?"校验项":t.errorText))]),t._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"刷新校验列表",placement:"top-start"}},[i("i",{staticClass:"el-icon-refresh",staticStyle:{color:"#409eff"},on:{click:function(e){return t.refreshValidData(!0)}}})]),t._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:t.isErrorText?"关闭校验项列表":"打开校验项列表",placement:"right"}},[t.isErrorText?i("i",{staticClass:"el-icon-caret-top",on:{click:function(e){t.isErrorText=!1}}}):i("i",{staticClass:"el-icon-caret-bottom",on:{click:function(e){t.isErrorText=!0}}})])],1),t._v(" "),t.isErrorText?i("div",{staticClass:"validTable"},[i("bdo-table",{ref:"validItems",staticStyle:{width:"100%"},attrs:{"max-height":330,"align-center":"","show-overflow-tooltip":"","enable-filter":!1,"enable-view-type":!1,columns:t.validItemList,data:t.validData,"enable-toolbox":!1,showIndexColumn:!0,showCheckBox:!1,heightLight:!1,headerListConfig:!1,headerCellStyleSelf:{"text-align":"center"},setBorder:t.setBorder},scopedSlots:t._u([{key:"col-unAuditAmount",fn:function(e){return[i("span",{style:{textAlign:"平"==e.row.unAuditAmount?"center":"right",color:"平"==e.row.unAuditAmount?"":"red",display:"block"}},[t._v("\n                            "+t._s(e.row.unAuditAmount))])]}},{key:"col-adjustAmount",fn:function(e){return[i("span",{style:{textAlign:"平"==e.row.adjustAmount?"center":"right",color:"平"==e.row.adjustAmount?"":"red",display:"block"}},[t._v("\n                            "+t._s(e.row.adjustAmount))])]}},{key:"col-auditAmount",fn:function(e){return[i("span",{style:{textAlign:"平"==e.row.auditAmount?"center":"right",color:"平"==e.row.auditAmount?"":"red",display:"block"}},[t._v("\n                            "+t._s(e.row.auditAmount))])]}},{key:"col-preUnAuditAmount",fn:function(e){return[i("span",{style:{textAlign:"平"==e.row.preUnAuditAmount?"center":"right",color:"平"==e.row.preUnAuditAmount?"":"red",display:"block"}},[t._v("\n                            "+t._s(e.row.preUnAuditAmount))])]}},{key:"col-preAdjustAmount",fn:function(e){return[i("span",{style:{textAlign:"平"==e.row.preAdjustAmount?"center":"right",color:"平"==e.row.preAdjustAmount?"":"red",display:"block"}},[t._v("\n                            "+t._s(e.row.preAdjustAmount))])]}},{key:"col-preAuditAmount",fn:function(e){return[i("span",{style:{textAlign:"平"==e.row.preAuditAmount?"center":"right",color:"平"==e.row.preAuditAmount?"":"red",display:"block"}},[t._v("\n                            "+t._s(e.row.preAuditAmount))])]}}],null,!1,2190302729)})],1):t._e(),t._v(" "),i("el-tabs",{staticClass:"indexTabs",on:{"tab-click":t.handleClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},t._l(t.tabsList,function(e){return i("el-tab-pane",{key:e.index,attrs:{label:e.label,name:e.name}},[i("span",{attrs:{slot:"label"},slot:"label"},[e.isMark?i("el-badge",{staticClass:"item",attrs:{"is-dot":""}}):t._e(),t._v("\n                        "+t._s(e.label)+"\n                    ")],1)])}),1),t._v(" "),"tb"==t.activeName?i("SingleTB",{ref:"singleTB",attrs:{tbList:t.tbList},on:{isInit:t.initAgain,refreshIndexes:t.refreshIndexes}}):i("AuditAjustment",{ref:"auditAjustment",attrs:{singleProjectId:t.curProjectId},on:{isResetValid:t.isResetValid,refreshIndexes:t.refreshIndexes}})],1)]),t._v(" "),t.isOpenDrawer?i("Postill",{ref:"postill",attrs:{menuID:t.menuID,activeLabel:t.activeLabel,limitArr:t.limitArr},on:{closePostill:t.closePostill,isPostil:t.isPostil}}):t._e(),t._v(" "),i("counter",{ref:"counter",attrs:{count:t.number},on:{clear:t.clear}})],1)},staticRenderFns:[]};var I=i("VU/8")(f,v,!1,function(t){i("fhrh")},null,null);e.default=I.exports},fhrh:function(t,e){}});