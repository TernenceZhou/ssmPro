webpackJsonp([8],{"/XV9":function(e,t){},"2WPG":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i("woOf"),l=i.n(a),n=i("mvHQ"),s=i.n(n),o=i("bOdI"),r=i.n(o),c=i("pFYg"),u=i.n(c),h=i("ABj6"),m=i("ZHXk"),d=i.n(m),f=i("K/T8"),p={data:[{prop:"shortName",label:"项目简称",filterOptions:{disabled:!0}},{prop:"auditAmount",label:"货币资金",filterOptions:{disabled:!0},align:"right",formatter:{type:"function",value:f.b.commafy}},{prop:"percentage",label:"比例",filterOptions:{disabled:!0}}],preData:[{prop:"shortName",label:"项目简称",filterOptions:{disabled:!0}},{prop:"preAuditAmount",label:"货币资金",filterOptions:{disabled:!0},align:"right",formatter:{type:"function",value:f.b.commafy}},{prop:"percentage",label:"比例",filterOptions:{disabled:!0}}],cashFlowData:[{prop:"shortName",label:"项目简称",filterOptions:{disabled:!0}},{prop:"curAmount",label:"货币资金",filterOptions:{disabled:!0},align:"right",formatter:{type:"function",value:f.b.commafy}},{prop:"percentage",label:"比例",filterOptions:{disabled:!0}}],preCashFlowData:[{prop:"shortName",label:"项目简称",filterOptions:{disabled:!0}},{prop:"preAmount",label:"货币资金",filterOptions:{disabled:!0},align:"right",formatter:{type:"function",value:f.b.commafy}},{prop:"percentage",label:"比例",filterOptions:{disabled:!0}}]},g=(i("oGZU"),i("3EDo")),C=i("UGJx"),b=i("0Nqy"),v={name:"mergeTbCur",components:{throughTable:g.a,tableHeadTitle:b.a},props:{column:Array,curData:Array},mixins:[C.a],watch:{column:{handler:function(e){e&&(this.curTbcolumn=e,this.columnCache=JSON.parse(s()(e)))},immediate:!0,deep:!0},curData:{handler:function(e){var t=this;e&&(this.curTbData=e.filter(function(e){return 0!=e.numberMerger}),this.$nextTick(function(){t.allColumnsList=t.$refs.xTable.collectColumn}))},immediate:!0,deep:!0}},data:function(){return{flag:"HB003-MTB001",selectCell:{},throughData:[],debCreDialog:!1,allAlign:"right",_init:!1,fullscreenLoading:!1,singleSubjectDimensionDialog:!1,singleSubjectDimensionData:[],curTbcolumn:this.column,curTbData:this.curData,columns:[],handleColumnsDialogTableVisible:!1,handleColumnsData:[],handleColumnsDataByTag:[],setBorder:!0,setHeight:"40%",debCreDialogTitle:"",dialogTitle:"",isTag:!1,tagList:[],multipleLimit:5,defaultFirstOption:!1,queryTag:"",mergeCurFlag:!1,filterTbColumn:[],filterTbData:[],columnsList:[],allColumnsList:[],columnCache:[],fixedColumns:["colCode","colDisp","totalNumber","debtor","credit"],keyTime:0,row:{}}},methods:{hideCurData:function(e){e&&1===e&&(this.mergeCurFlag=!1);var t=this.curData.filter(function(e){return 0!=e.numberMerger});this.curTbData=t},showCurData:function(){this.curTbData=this.curData,this.mergeCurFlag=!0},iconDownload:function(){var e=this.row,t=JSON.parse(sessionStorage.getItem("curCustomerData")).curYear,i={subjectName:e.colDisp,subjectId:e.colCode,summaryType:"0",year:t};this.$sacpApis.exportSubsidiaryData(i)},handleBackspace:function(){this.keyTime?(this.tagList&&(this.tagList.length?this.queryTbDataByTag():this.getConfigColumns("tag")),this.keyTime=0):this.keyTime++},handleInputConfirm:function(){var e=this;return this.queryTag.trim()?this.tagList.some(function(t){return t===e.queryTag})?this.$message.error("当前标签已经存在!"):void(this.queryTag.trim()&&this.tagList.length<5?(this.tagList.push(this.queryTag),this.queryTbDataByTag()):(this.$message.error("标签限制数量为5个!"),this.queryTag="")):this.$message.error("请输入标签内容!")},remoteMethod:function(e){if(e&&e.length>10)return this.$message.warning("标签限制长度为10 !按下回车键将自动截取当前编辑标签的前10位 !");this.queryTag=e},removeTag:function(e){this.tagList=this.tagList.filter(function(t){return t!=e}),this.tagList.length?this.queryTbDataByTag():this.getConfigColumns("tag")},queryTbDataByTag:function(){var e=this;this.fullscreenLoading=!0;var t="";d.a.arrayEach(this.tagList,function(i,a){return t+=a<e.tagList.length-1?i+"|":""+i}),this.$sacpApis.findMergeTbByMergeProject(t).then(function(t){e.handleColumnsData=t&&t.tbColumn?t.tbColumn.filter(function(e){return"colCode"!=e.prop&&"colDisp"!=e.prop&&"totalNumber"!=e.prop&&"debtor"!=e.prop&&"credit"!=e.prop&&"numberMerger"!=e.prop}):[],e.filterTbColumn=t&&t.tbColumn?t.tbColumn:[],e.filterTbData=t&&t.curData?t.curData:[]}).catch(function(t){return e.$message.error(t)}).finally(function(){var t=[];e.handleColumnsData.map(function(e){t.push(e.prop)});for(var i=function(i){d.a.includes(e.fixedColumns,e.columnCache[i].prop)||d.a.includes(t,e.columnCache[i].prop)?d.a.includes(t,e.columnCache[i].prop)&&e.handleColumnsData.forEach(function(t){return t.visible=t.prop===e.columnCache[i].prop?e.columnCache[i].visible:t.visible}):(e.columnCache[i].visible=!0,e.onHeadConfigChange(e.columnCache[i]))},a=0;a<e.columnCache.length;a++)i(a);e.curTbcolumn=e.columnCache,e.curTbData=e.filterTbData,e.fullscreenLoading=!1})},refresh:function(e){this.refreshTable()},refreshTable:function(){this.tagList&&this.tagList.length&&(this.tagList=[],this.getConfigColumns("tag")),this.$emit("isInit",!0)},commafyFn:function(e){var t=e.cellValue;e.row,e.column;return d.a.commafy(t,{digits:2})},initMergeTb:function(){var e=this;this.fullscreenLoading=!0,this.$sacpApis.initTbAndCaseSheet({}).then(function(t){t.success?(e._init=!0,e.$message.success("初始化成功!"),e.$emit("refreshIndexes",t.resultInfo.refreshIndexes)):e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)}).finally(function(){e.fullscreenLoading=!1})},cellStyle:function(e){e.row,e.rowIndex;var t=e.column;e.columnIndex;if("colDisp"==t.property)return{textDecoration:"underline",cursor:"pointer"}},handleCellClick:function(e){var t=e.row,i=(e.rowIndex,e.$rowIndex,e.column);e.columnIndex,e.$columnIndex,e.cell;if("colDisp"==i.property){this.columns.forEach(function(e){"auditAmount"==e.prop&&(e.label=t.colDisp)}),this.row=t,this.singleSubjectDimensionData=[];for(var a=t.totalNumber,l=(a+="").split("."),n=l[0],s=l.length>1?"."+l[1]:"",o=/(\d+)(\d{3})/;o.test(n);)n=n.replace(o,"$1,$2");this.handleSubsidiaryData(t),this.dialogTitle="单科目维度:"+t.colDisp+"(汇总数:"+(n+s)+")"}},handleCellDblclick:function(e){var t=this,i=e.row,a=(e.rowIndex,e.$rowIndex,e.column);e.columnIndex,e.$columnIndex,e.cell;if("debtor"==a.property||"credit"==a.property){if(!i.relatedCode)return void this.$message.warning("合计项无法查看详细!");"debtor"==a.property?this.debCreDialogTitle="借方抵销:"+i.colCode+"-"+i.colDisp:"credit"==a.property&&(this.debCreDialogTitle="贷方抵销:"+i.colCode+"-"+i.colDisp);var l=JSON.parse(sessionStorage.getItem("curCustomerData")).curProjectId;this.selectCell={subjectId:i.colCode,projectId:l,year:JSON.parse(sessionStorage.getItem("curCustomerData")).curYear,activeFlag:null,subjectName:i.colDisp,adjustType:2},this.$store.commit("setCell",this.selectCell),this.$sacpApis.offsetThrough(this.selectCell).then(function(e){e.success&&(t.throughData=e.data)}).catch(function(e){return t.$message.error(e)}).finally(function(){t.debCreDialog=!0})}},exportMergeTrialBalance:function(){this.$sacpApis.exportMergeTrialBalance("合并试算平衡表.xlsx")},selectVisiableColumns:function(e){this.getConfigColumns(e),this.handleColumnsDialogTableVisible=!0},hiddenAll:function(){var e=this;this.columnsList=this.$refs.xTable.getColumns(),this.handleColumnsData.forEach(function(t){t.visible=!0;var i=e.columnsList.filter(function(e){return e.property===t.prop});i&&i.length&&e.$refs.xTable.hideColumn(i[0]),e.columnCache.map(function(e){e.prop===t.prop&&(e.visible=!0)}),e.curTbcolumn=e.columnCache})},showAll:function(){var e=this;this.handleColumnsData.forEach(function(t){t.visible=!1;var i=e.allColumnsList.filter(function(e){return e.property===t.prop});i&&i.length&&e.$refs.xTable.showColumn(i[0]),e.columnCache.map(function(e){e.prop===t.prop&&(e.visible=!1)}),e.curTbcolumn=e.columnCache})},onHeadConfigChange:function(e){var t=this.allColumnsList.filter(function(t){return t.property===e.prop});t&&t.length&&(e.visible?this.$refs.xTable.hideColumn(t[0]):this.$refs.xTable.showColumn(t[0]))},recoverHeadConfig:function(){this.isTag=!1,this.handleColumnsDialogTableVisible=!1},getConfigColumns:function(e){var t=this;"last"!=e&&(this.isTag=!0),"last"===e?this.handleColumnsData=this.columnCache&&this.columnCache.length?this.columnCache.filter(function(e){return d.a.includes(t.fixedColumns,e.prop)&&"colDisp"!=e.prop&&"colCode"!=e.prop}):[]:"all"===e?this.tagList&&this.tagList.length?this.handleColumnsData=this.filterTbColumn&&this.filterTbColumn.length?this.filterTbColumn.filter(function(e){return!d.a.includes(t.fixedColumns,e.prop)}):[]:this.handleColumnsData=this.columnCache:"tag"===e&&(this.handleColumnsData=this.columnCache&&this.columnCache.length?this.columnCache.filter(function(e){return!d.a.includes(t.fixedColumns,e.prop)}):[],this.curTbData=this.curData,this.showAll())},handleSubsidiaryData:function(e){var t=this,i=JSON.parse(sessionStorage.getItem("curCustomerData")).curYear,a={subjectId:e.colCode,summaryType:"0",year:i};this.$sacpApis.mergeTBSubsidiary(a).then(function(e){e.success?t.singleSubjectDimensionData=e.data:t.$message.error(e.resultInfo.statusText)}).catch(function(e){return t.$message.error(e)}).finally(function(){t.singleSubjectDimensionDialog=!0})},addNbsp:function(e){var t=e.cellValue;e.row,e.column;if(t.match(new RegExp(/\s/g)))for(var i=t.match(new RegExp(/\s/g)).length,a=0;a<=i-1;a++)t=" "+t;return t},exportFile:function(){this.exportMergeTrialBalance()}},created:function(){p&&(this.columns=p.data)},mounted:function(){this.hideCurData()}},D={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"mergeTbCur"},[i("div",{staticClass:"columnsVisiable",staticStyle:{float:"right","margin-bottom":"8px"}},[0==e.mergeCurFlag?i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"展示全部数据",placement:"top-start"}},[i("el-button",{staticClass:"initBtn",attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-sort-down"},on:{click:e.showCurData}})],1):e._e(),e._v(" "),1==e.mergeCurFlag?i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"隐藏合并数为0",placement:"top-start"}},[i("el-button",{staticClass:"initBtn",attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-sort-up"},on:{click:function(t){return e.hideCurData(1)}}})],1):e._e(),e._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"初始化合并试算平衡表",placement:"top-start"}},[i("el-button",{staticClass:"setBtn",attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-switch-button"},on:{click:e.initMergeTb}})],1),e._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"列设置",placement:"top-start"}},[i("el-button",{attrs:{circle:"",icon:"el-icon-s-grid",type:"primary",size:"small"},on:{click:function(t){return e.selectVisiableColumns("all")}}})],1),e._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"隐藏最后四列",placement:"top-start"}},[i("el-button",{attrs:{circle:"",icon:"el-icon-video-play",type:"primary",size:"small"},on:{click:function(t){return e.selectVisiableColumns("last")}}})],1)],1),e._v(" "),i("div",{staticClass:"tableDiv"},[i("table-head-title",{attrs:{columns:e.curTbcolumn,pageTotal:e.curTbData.length,refreshTable:e.refreshTable,exportReport:!0},on:{exportFile:e.exportFile}}),e._v(" "),i("vxe-table",{ref:"xTable",attrs:{border:"",resizable:"","highlight-hover-row":"","highlight-current-row":"","show-overflow":"","show-header-overflow":"","keep-source":"",height:"auto","auto-resize":!0,data:e.curTbData,"scroll-y":{vSize:1e4},"cell-style":e.cellStyle,"tooltip-config":{enterable:!0}},on:{"cell-click":e.handleCellClick,"cell-dblclick":e.handleCellDblclick}},e._l(e.curTbcolumn,function(t,a){return i("vxe-table-column",{key:a,attrs:{field:t.prop,title:t.label,fixed:t.fixed?t.fixed:"","header-align":"center",align:t.isMoney?e.allAlign:"",formatter:t.isMoney?e.commafyFn:"colDisp"==t.prop?e.addNbsp:"","min-width":t.width?t.width:100,visiable:t.visiable}})}),1)],1),e._v(" "),i("el-dialog",{staticClass:"singleSubjectTable",attrs:{title:e.dialogTitle,visible:e.singleSubjectDimensionDialog,width:"70%"},on:{"update:visible":function(t){e.singleSubjectDimensionDialog=t}}},[i("i",{staticClass:"el-icon-download",on:{click:e.iconDownload}}),e._v(" "),i("bdo-table",{ref:"table",attrs:{columns:e.columns,"enable-filter":!1,"enable-toolbox":!1,"enable-view-type":!1,data:e.singleSubjectDimensionData,"show-overflow-tooltip":"","page-total":e.singleSubjectDimensionData?e.singleSubjectDimensionData.length:0,showIndexColumn:!1,showCheckBox:!1,headerListConfig:!1,headerCellStyleSelf:{"text-align":"left"},setBorder:e.setBorder}})],1),e._v(" "),i("el-dialog",{staticClass:"changeFilterTableMethodsDialog",attrs:{visible:e.handleColumnsDialogTableVisible,"before-close":e.recoverHeadConfig,width:"60%"},on:{"update:visible":function(t){e.handleColumnsDialogTableVisible=t}}},[i("template",{slot:"title"},[i("div",{staticClass:"headerTitle"},[i("span",{staticClass:"el-dialog__title"},[e._v("表头编辑")]),e._v(" "),e.isTag?i("el-select",{staticClass:"tagInput mergeTbTagInput",attrs:{multiple:"","multiple-limit":e.multipleLimit,filterable:"","allow-create":"","default-first-option":e.defaultFirstOption,placeholder:"输入标签内容，用回车添加","filter-method":e.remoteMethod},on:{"remove-tag":e.removeTag},nativeOn:{keyup:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"backspace",void 0,t.key,void 0)?null:e.handleBackspace(t)},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleInputConfirm(t)}]},model:{value:e.tagList,callback:function(t){e.tagList=t},expression:"tagList"}}):e._e()],1)]),e._v(" "),i("el-table",{ref:"elTable",attrs:{data:e.handleColumnsData,size:"small","max-height":"300px"}},[i("el-table-column",{attrs:{type:"index"}}),e._v(" "),i("el-table-column",{attrs:{prop:"label",label:"表头字段"}}),e._v(" "),i("el-table-column",{attrs:{label:"是否隐藏"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#C0C4CC"},on:{change:function(i){return e.onHeadConfigChange(t.row)}},model:{value:t.row.visible,callback:function(i){e.$set(t.row,"visible",i)},expression:"scope.row.visible"}})]}}])})],1),e._v(" "),i("div",{staticStyle:{"text-align":"center"},attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{round:"",size:"small",type:"primary"},on:{click:e.hiddenAll}},[e._v("全 部 隐 藏\n            ")]),e._v(" "),i("el-button",{attrs:{round:"",size:"small",type:"primary"},on:{click:e.showAll}},[e._v("全 部 开 启\n            ")]),e._v(" "),i("el-button",{attrs:{round:"",size:"small",type:"warning"},on:{click:e.showAll}},[e._v("重 置")])],1)],2),e._v(" "),i("el-dialog",{staticClass:"debCreDialog",attrs:{title:e.debCreDialogTitle,visible:e.debCreDialog,width:"90%"},on:{"update:visible":function(t){e.debCreDialog=t}}},[i("throughTable",{attrs:{throughData:e.throughData,selectCell:e.selectCell}})],1)],1)},staticRenderFns:[]};var y=i("VU/8")(v,D,!1,function(e){i("oGeI")},"data-v-965ec1b4",null).exports,T={name:"mergeTbLast",props:{column:Array,curData:Array},components:{throughTable:g.a,tableHeadTitle:b.a},mixins:[C.a],watch:{column:{handler:function(e){e&&(this.tbColumns=e,this.columnCache=JSON.parse(s()(e)))},immediate:!0,deep:!0},curData:{handler:function(e){var t=this;e&&(this.tbData=e.filter(function(e){return 0!=e.numberMerger}),this.$nextTick(function(){return t.allColumnsList=t.$refs.xTable.collectColumn}))},immediate:!0,deep:!0}},data:function(){return{flag:"HB003-MTB002",selectCell:{},debCreDialog:!1,throughData:[],tbColumns:JSON.parse(s()(this.column)),tbData:this.curData,allAlign:"right",_init:!1,fullscreenLoading:!1,singleSubjectDimensionDialog:!1,columns:[],singleSubjectDimensionData:[],handleColumnsDataDialogTableVisible:!1,handleColumnsData:[],setBorder:!0,debCreDialogTitle:"",dialogTitle:"",isTag:!1,tagList:[],multipleLimit:5,loading:!1,defaultFirstOption:!1,queryTag:"",mergeLastFlag:!1,filterTbColumn:[],filterTbData:[],columnsList:[],allColumnsList:[],columnCache:[],fixedColumns:["colCode","colDisp","totalNumber","debtor","credit","numberMerger"],keyTime:0,row:{}}},methods:{hideLastData:function(e){e&&1===e&&(this.mergeLastFlag=!1);var t=this.curData.filter(function(e){return 0!=e.numberMerger});this.tbData=t},showLastData:function(){this.tbData=this.curData,this.mergeLastFlag=!0},iconDownload:function(){var e=this.row,t=JSON.parse(sessionStorage.getItem("curCustomerData")).curYear,i={subjectName:e.colDisp,subjectId:e.colCode,summaryType:"0",year:+t-1};this.$sacpApis.exportSubsidiaryData(i)},exportMergeTrialBalance:function(){this.$sacpApis.exportMergeTrialBalance("合并试算平衡表.xlsx")},handleBackspace:function(){this.keyTime?(this.tagList&&(this.tagList.length?this.queryTbDataByTag():this.getConfigColumns("tag")),this.keyTime=0):this.keyTime++},handleInputConfirm:function(){var e=this;return this.queryTag.trim()?this.tagList.some(function(t){return t===e.queryTag})?this.$message.error("当前标签已经存在!"):void(this.queryTag.trim()&&this.tagList.length<5?(this.tagList.push(this.queryTag),this.queryTbDataByTag()):(this.$message.error("标签限制数量为5个!"),this.queryTag="")):this.$message.error("请输入标签内容!")},remoteMethod:function(e){if(e&&e.length>10)return this.$message.warning("标签限制长度为10 !按下回车键将自动截取当前编辑标签的前10位 !");this.queryTag=e},removeTag:function(e){this.tagList=this.tagList.filter(function(t){return t!=e}),this.tagList.length?this.queryTbDataByTag():this.getConfigColumns("tag")},queryTbDataByTag:function(){var e=this;this.fullscreenLoading=!0;var t="";d.a.arrayEach(this.tagList,function(i,a){return t+=a<e.tagList.length-1?i+"|":""+i}),this.$sacpApis.findMergeTbByMergeProject(t).then(function(t){e.handleColumnsData=t&&t.tbColumn?t.tbColumn.filter(function(e){return"colCode"!=e.prop&&"colDisp"!=e.prop&&"totalNumber"!=e.prop&&"debtor"!=e.prop&&"credit"!=e.prop&&"numberMerger"!=e.prop}):[],e.filterTbColumn=t&&t.tbColumn?t.tbColumn:[],e.filterTbData=t&&t.preData?t.preData:[]}).catch(function(t){return e.$message.error(t)}).finally(function(){var t=[];e.handleColumnsData.map(function(e){t.push(e.prop)});for(var i=function(i){d.a.includes(e.fixedColumns,e.columnCache[i].prop)||d.a.includes(t,e.columnCache[i].prop)?d.a.includes(t,e.columnCache[i].prop)&&e.handleColumnsData.forEach(function(t){return t.visible=t.prop===e.columnCache[i].prop?e.columnCache[i].visible:t.visible}):(e.columnCache[i].visible=!0,e.onHeadConfigChange(e.columnCache[i]))},a=0;a<e.columnCache.length;a++)i(a);e.tbColumns=e.columnCache,e.tbData=e.filterTbData,e.fullscreenLoading=!1})},refresh:function(e){this.refreshTable()},refreshTable:function(){this.tagList&&this.tagList.length&&(this.tagList=[],this.getConfigColumns("tag")),this.$emit("isInit",!0)},showTooltipMethod:function(e){e.type,e.column,e.row,e.items,e._columnIndex},commafyFn:function(e){var t=e.cellValue;e.row,e.column;return d.a.commafy(t,{digits:2})},initMergeTb:function(){var e=this;this.fullscreenLoading=!0,this.$sacpApis.initTbAndCaseSheet({}).then(function(t){t.success?(e._init=!0,e.$message.success("初始化成功!"),e.$emit("refreshIndexes",t.resultInfo.refreshIndexes)):e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)}).finally(function(){e.fullscreenLoading=!1})},cellStyle:function(e){e.row,e.rowIndex;var t=e.column;e.columnIndex;if("colDisp"==t.property)return{textDecoration:"underline",cursor:"pointer"}},handleCellClick:function(e){var t=e.row,i=(e.rowIndex,e.$rowIndex,e.column);e.columnIndex,e.$columnIndex,e.cell;if("colDisp"==i.property){this.columns.forEach(function(e){"preAuditAmount"==e.prop&&(e.label=t.colDisp)}),this.row=t,this.singleSubjectDimensionData=[];for(var a=t.totalNumber,l=(a+="").split("."),n=l[0],s=l.length>1?"."+l[1]:"",o=/(\d+)(\d{3})/;o.test(n);)n=n.replace(o,"$1,$2");this.singleSubjectDimensionData=[],this.handleSubsidiaryData(t),this.dialogTitle="单科目维度:"+t.colDisp+"(汇总数:"+(n+s)+")"}},handleCellDblclick:function(e){var t=this,i=e.row,a=(e.rowIndex,e.$rowIndex,e.column);e.columnIndex,e.$columnIndex,e.cell;if("debtor"==a.property||"credit"==a.property){if(!i.relatedCode)return void this.$message.warning("合计项无法查看详细!");"debtor"==a.property?this.debCreDialogTitle="借方抵销:"+i.colCode+"-"+i.colDisp:"credit"==a.property&&(this.debCreDialogTitle="贷方抵销:"+i.colCode+"-"+i.colDisp);var l=JSON.parse(sessionStorage.getItem("curCustomerData")).curProjectId;this.selectCell={subjectId:i.colCode,projectId:l,year:JSON.parse(sessionStorage.getItem("curCustomerData")).curYear-1,activeFlag:null,subjectName:i.colDisp,isLast:!0,adjustType:2},this.$store.commit("setCell",this.selectCell),this.$sacpApis.offsetThrough(this.selectCell).then(function(e){e.success&&(t.throughData=e.data)}).catch(function(e){return t.$message.error(e)}).finally(function(){t.debCreDialog=!0})}},selectVisiableColumns:function(e){this.getConfigColumns(e),this.handleColumnsDataDialogTableVisible=!0},hiddenAll:function(){var e=this;this.columnsList=this.$refs.xTable.getColumns(),this.handleColumnsData.forEach(function(t){t.visible=!0;var i=e.columnsList.filter(function(e){return e.property===t.prop});i&&i.length&&e.$refs.xTable.hideColumn(i[0]),e.columnCache.map(function(e){e.prop===t.prop&&(e.visible=!0)}),e.tbColumns=e.columnCache})},showAll:function(){var e=this;this.handleColumnsData.forEach(function(t){t.visible=!1;var i=e.allColumnsList.filter(function(e){return e.property===t.prop});i&&i.length&&e.$refs.xTable.showColumn(i[0]),e.columnCache.map(function(e){e.prop===t.prop&&(e.visible=!1)}),e.tbColumns=e.columnCache})},onHeadConfigChange:function(e){var t=this.allColumnsList.filter(function(t){return t.property===e.prop});t&&t.length&&(e.visible?this.$refs.xTable.hideColumn(t[0]):this.$refs.xTable.showColumn(t[0]))},recoverHeadConfig:function(){this.isTag=!1,this.handleColumnsDataDialogTableVisible=!1},getConfigColumns:function(e){var t=this;"last"!=e&&(this.isTag=!0),"last"===e?this.handleColumnsData=this.columnCache&&this.columnCache.length?this.columnCache.filter(function(e){return d.a.includes(t.fixedColumns,e.prop)&&"colDisp"!=e.prop&&"colCode"!=e.prop}):[]:"all"===e?this.tagList&&this.tagList.length?this.handleColumnsData=this.filterTbColumn&&this.filterTbColumn.length?this.filterTbColumn.filter(function(e){return!d.a.includes(t.fixedColumns,e.prop)}):[]:this.handleColumnsData=this.columnCache&&this.columnCache.length?this.columnCache.filter(function(e){return!d.a.includes(t.fixedColumns,e.prop)}):[]:"tag"===e&&(this.handleColumnsData=this.columnCache&&this.columnCache.length?this.columnCache.filter(function(e){return!d.a.includes(t.fixedColumns,e.prop)}):[],this.tbData=this.curData,this.showAll())},handleSubsidiaryData:function(e){var t=this,i=JSON.parse(sessionStorage.getItem("curCustomerData")).curYear,a={subjectId:e.colCode,summaryType:"0",year:Number(i)-1};this.$sacpApis.mergeTBSubsidiary(a).then(function(e){e.success?t.singleSubjectDimensionData=e.data:t.$message.error(e.resultInfo.statusText)}).catch(function(e){return t.$message.error(e)}).finally(function(){t.singleSubjectDimensionDialog=!0})},addNbsp:function(e){var t=e.cellValue;e.row,e.column;if(t.match(new RegExp(/\s/g)))for(var i=t.match(new RegExp(/\s/g)).length,a=0;a<=i-1;a++)t=" "+t;return t}},created:function(){p&&(this.columns=p.preData)},mounted:function(){this.hideLastData()}},x={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"mergeTbLast"},[i("div",{staticClass:"columnsVisiable",staticStyle:{float:"right","margin-bottom":"8px"}},[0==e.mergeLastFlag?i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"展示全部数据",placement:"top-start"}},[i("el-button",{staticClass:"initBtn",attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-sort-down"},on:{click:e.showLastData}})],1):e._e(),e._v(" "),1==e.mergeLastFlag?i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"隐藏合并数为0",placement:"top-start"}},[i("el-button",{staticClass:"initBtn",attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-sort-up"},on:{click:function(t){return e.hideLastData(1)}}})],1):e._e(),e._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"初始化合并试算平衡表",placement:"top-start"}},[i("el-button",{staticClass:"setBtn",attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-switch-button"},on:{click:e.initMergeTb}})],1),e._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"列设置",placement:"top-start"}},[i("el-button",{attrs:{circle:"",icon:"el-icon-s-grid",type:"primary",size:"small"},on:{click:function(t){return e.selectVisiableColumns("all")}}})],1),e._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"隐藏最后四列",placement:"top-start"}},[i("el-button",{attrs:{circle:"",icon:"el-icon-video-play",type:"primary",size:"small"},on:{click:function(t){return e.selectVisiableColumns("last")}}})],1),e._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"导出",placement:"top-start"}},[i("el-button",{attrs:{circle:"",icon:"el-icon-download",type:"primary",size:"small"},on:{click:function(t){return e.exportMergeTrialBalance()}}})],1)],1),e._v(" "),i("div",{staticClass:"tableDiv"},[i("table-head-title",{attrs:{columns:e.columns,pageTotal:e.tbData.length,refreshTable:e.refreshTable}}),e._v(" "),i("vxe-table",{ref:"xTable",attrs:{border:"",resizable:"","highlight-hover-row":"","highlight-current-row":"","show-overflow":"","show-header-overflow":"","export-config":"",height:"auto","auto-resize":!0,data:e.tbData,"scroll-y":{vSize:1e4},"sort-config":{trigger:"cell"},"tooltip-config":{contentMethod:e.showTooltipMethod,enterable:!0},"cell-style":e.cellStyle},on:{"cell-click":e.handleCellClick,"cell-dblclick":e.handleCellDblclick}},e._l(e.tbColumns,function(t,a){return i("vxe-table-column",{key:a,attrs:{"header-align":"center",field:t.prop,title:t.label,fixed:t.fixed?t.fixed:"",align:t.isMoney?e.allAlign:"",formatter:t.isMoney?e.commafyFn:t.prop?e.addNbsp:"","min-width":t.width?t.width:100,visiable:t.visiable}})}),1)],1),e._v(" "),i("el-dialog",{staticClass:"singleSubjectTable",attrs:{title:e.dialogTitle,visible:e.singleSubjectDimensionDialog,width:"70%"},on:{"update:visible":function(t){e.singleSubjectDimensionDialog=t}}},[i("i",{staticClass:"el-icon-download",on:{click:e.iconDownload}}),e._v(" "),i("bdo-table",{ref:"table",attrs:{columns:e.columns,"enable-filter":!1,"enable-toolbox":!1,"enable-view-type":!1,data:e.singleSubjectDimensionData,"show-overflow-tooltip":"","page-total":e.singleSubjectDimensionData?e.singleSubjectDimensionData.length:0,showIndexColumn:!1,showCheckBox:!1,headerListConfig:!1,headerCellStyleSelf:{"text-align":"left"},setBorder:e.setBorder}})],1),e._v(" "),i("el-dialog",{staticClass:"changeFilterTableMethodsDialog",attrs:{visible:e.handleColumnsDataDialogTableVisible,width:"60%","before-close":e.recoverHeadConfig},on:{"update:visible":function(t){e.handleColumnsDataDialogTableVisible=t}}},[i("template",{slot:"title"},[i("div",{staticClass:"headerTitle"},[i("span",{staticClass:"el-dialog__title"},[e._v("标签编辑")]),e._v(" "),e.isTag?i("el-select",{staticClass:"tagInput mergeTbTagInput",attrs:{multiple:"","multiple-limit":e.multipleLimit,filterable:"","allow-create":"","default-first-option":e.defaultFirstOption,placeholder:"输入标签内容，用回车添加","filter-method":e.remoteMethod},on:{"remove-tag":e.removeTag},nativeOn:{keyup:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"backspace",void 0,t.key,void 0)?null:e.handleBackspace(t)},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleInputConfirm(t)}]},model:{value:e.tagList,callback:function(t){e.tagList=t},expression:"tagList"}}):e._e()],1)]),e._v(" "),i("el-table",{attrs:{data:e.handleColumnsData,size:"small","max-height":"300px"}},[i("el-table-column",{attrs:{type:"index"}}),e._v(" "),i("el-table-column",{attrs:{prop:"label",label:"表头字段"}}),e._v(" "),i("el-table-column",{attrs:{label:"是否隐藏"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#C0C4CC"},on:{change:function(i){return e.onHeadConfigChange(t.row)}},model:{value:t.row.visible,callback:function(i){e.$set(t.row,"visible",i)},expression:"scope.row.visible"}})]}}])})],1),e._v(" "),i("div",{staticStyle:{"text-align":"center"},attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{round:"",size:"small",type:"primary"},on:{click:e.hiddenAll}},[e._v("全 部 隐 藏\n            ")]),e._v(" "),i("el-button",{attrs:{round:"",size:"small",type:"primary"},on:{click:e.showAll}},[e._v("全 部 开 启\n            ")]),e._v(" "),i("el-button",{attrs:{round:"",size:"small",type:"warning"},on:{click:e.showAll}},[e._v("重 置")])],1)],2),e._v(" "),i("el-dialog",{staticClass:"debCreDialog",attrs:{title:e.debCreDialogTitle,visible:e.debCreDialog,width:"70%"},on:{"update:visible":function(t){e.debCreDialog=t}}},[i("throughTable",{attrs:{throughData:e.throughData,selectCell:e.selectCell}})],1)],1)},staticRenderFns:[]};var w=i("VU/8")(T,x,!1,function(e){i("oROU")},"data-v-1c1d50fa",null).exports,k={name:"statementOfCashFlowCur",props:{column:Array,curData:Array},components:{throughTable:g.a,tableHeadTitle:b.a},mixins:[C.a],watch:{column:{handler:function(e){e&&(this.curCashColumns=e,this.columnsCache=JSON.parse(s()(e)))},immediate:!0,deep:!0},curData:{handler:function(e){var t=this;e&&(this.curCashList=e.filter(function(e){return 0!=e.numberMerger}),this.$nextTick(function(){return t.allColumnsList=t.$refs.xTable.collectColumn}))},immediate:!0,deep:!0}},data:function(){return{flag:"HB003-MTB003",selectCell:{},throughData:[],debCreDialog:!1,curCashColumns:this.column,curCashList:this.curData,allAlign:"right",_init:!1,fullscreenLoading:!1,singleSubjectDimensionData:[],columns:[],singleSubjectDimensionDialog:!1,handleColumnsDialogTableVisible:!1,handleColumnsData:[],setBorder:!0,debCreDialogTitle:"",dialogTitle:"",isTag:!1,tagList:[],multipleLimit:5,loading:!1,defaultFirstOption:!1,queryTag:"",stateFlag:!1,filterCashColumn:[],filterCashData:[],columnsList:[],columnsCache:[],allColumnsList:[],fixedColumns:["colCode","colDisp","totalNumber","debtor","credit","numberMerger"],keyTime:0}},methods:{hideStateData:function(e){e&&1===e&&(this.stateFlag=!1);var t=this.curData.filter(function(e){return 0!=e.numberMerger});this.curCashList=t},showStateData:function(){this.curCashList=this.curData,this.stateFlag=!0},iconDownload:function(){var e=this.row,t=JSON.parse(sessionStorage.getItem("curCustomerData")).curYear,i={subjectName:e.colDisp,subjectId:e.colCode,summaryType:"1",year:t};this.$sacpApis.exportSubsidiaryData(i)},exportMergeTrialBalance:function(){this.$sacpApis.exportMergeTrialBalance("合并试算平衡表.xlsx")},handleBackspace:function(){this.keyTime?(this.tagList&&(this.tagList.length?this.queryCashDataByTag():this.getConfigColumns("tag")),this.keyTime=0):this.keyTime++},handleInputConfirm:function(){var e=this;return this.queryTag.trim()?this.tagList.some(function(t){return t===e.queryTag})?this.$message.error("当前标签已经存在!"):void(this.queryTag.trim()&&this.tagList.length<5?(this.tagList.push(this.queryTag),this.queryCashDataByTag()):(this.$message.error("标签限制数量为5个!"),this.queryTag="")):this.$message.error("请输入标签内容!")},remoteMethod:function(e){if(e&&e.length>10)return this.$message.warning("标签限制长度为10 !按下回车键将自动截取当前编辑标签的前10位 !");this.queryTag=e},removeTag:function(e){this.tagList=this.tagList.filter(function(t){return t!=e}),this.tagList.length?this.queryCashDataByTag():this.getConfigColumns("tag")},queryCashDataByTag:function(){var e=this;this.fullscreenLoading=!0;var t="";d.a.arrayEach(this.tagList,function(i,a){return t+=a<e.tagList.length-1?i+"|":""+i}),this.$sacpApis.queryMergeCashByMergeProject(t).then(function(t){e.handleColumnsData=t&&t.cashColumn?t.cashColumn.filter(function(e){return"colCode"!=e.prop&&"colDisp"!=e.prop&&"totalNumber"!=e.prop&&"debtor"!=e.prop&&"credit"!=e.prop&&"numberMerger"!=e.prop}):[],e.filterCashColumn=t&&t.cashColumn?t.cashColumn:[],e.filterCashData=t&&t.curCash?t.curCash:[]}).catch(function(t){return e.$message.error(t)}).finally(function(){var t=[];e.handleColumnsData.map(function(e){t.push(e.prop)});for(var i=function(i){d.a.includes(e.fixedColumns,e.columnsCache[i].prop)||d.a.includes(t,e.columnsCache[i].prop)?d.a.includes(t,e.columnsCache[i].prop)&&e.handleColumnsData.forEach(function(t){return t.visible=t.prop===e.columnsCache[i].prop?e.columnsCache[i].visible:t.visible}):(e.columnsCache[i].visible=!0,e.onHeadConfigChange(e.columnsCache[i]))},a=0;a<e.columnsCache.length;a++)i(a);e.curCashColumns=e.columnsCache,e.curCashList=e.filterCashData,e.fullscreenLoading=!1})},refresh:function(e){this.refreshTable()},refreshTable:function(){this.tagList&&this.tagList.length&&(this.tagList=[],this.getConfigColumns("tag")),this.$emit("isInit",!0)},showTooltipMethod:function(e){e.type,e.column,e.row,e.items,e._columnIndex},commafyFn:function(e){var t=e.cellValue;e.row,e.column;return d.a.commafy(t,{digits:2})},initMergeTb:function(){var e=this;this.fullscreenLoading=!0,this.$sacpApis.initTbAndCaseSheet({}).then(function(t){t.success?(e._init=!0,e.$message.success("初始化成功!"),e.$emit("refreshIndexes",t.resultInfo.refreshIndexes)):e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)}).finally(function(){e.fullscreenLoading=!1})},cellStyle:function(e){e.row,e.rowIndex;var t=e.column;e.columnIndex;if("colDisp"==t.property)return{textDecoration:"underline",cursor:"pointer"}},handleCellClick:function(e){var t=e.row,i=(e.rowIndex,e.$rowIndex,e.column);e.columnIndex,e.$columnIndex,e.cell;if("colDisp"==i.property){this.columns.forEach(function(e){"curAmount"==e.prop&&(e.label=t.colDisp)}),this.row=t,this.singleSubjectDimensionData=[];for(var a=t.totalNumber,l=(a+="").split("."),n=l[0],s=l.length>1?"."+l[1]:"",o=/(\d+)(\d{3})/;o.test(n);)n=n.replace(o,"$1,$2");this.singleSubjectDimensionData=[],this.handleSubsidiaryData(t),this.dialogTitle="单科目维度:"+t.colDisp+"(汇总数:"+(n+s)+")"}},handleCellDblclick:function(e){var t=this,i=e.row,a=(e.rowIndex,e.$rowIndex,e.column);e.columnIndex,e.$columnIndex,e.cell;if("debtor"==a.property||"credit"==a.property){if(!i.relatedCode)return void this.$message.warning("合计项无法查看详细!");"debtor"==a.property?this.debCreDialogTitle="借方抵销:"+i.colCode+"-"+i.colDisp:"credit"==a.property&&(this.debCreDialogTitle="贷方抵销:"+i.colCode+"-"+i.colDisp);var l=JSON.parse(sessionStorage.getItem("curCustomerData")).curProjectId;this.selectCell={subjectId:i.colCode,projectId:l,year:JSON.parse(sessionStorage.getItem("curCustomerData")).curYear,activeFlag:null,subjectName:i.colDisp,adjustType:3},this.$store.commit("setCell",this.selectCell),this.$sacpApis.offsetThrough(this.selectCell).then(function(e){e.success&&(t.throughData=e.data)}).catch(function(e){return t.$message.error(e)}).finally(function(){t.debCreDialog=!0})}},selectVisiableColumns:function(e){this.getConfigColumns(e),this.handleColumnsDialogTableVisible=!0},hiddenAll:function(){var e=this;this.columnsList=this.$refs.xTable.getColumns(),this.handleColumnsData.forEach(function(t){t.visible=!0;var i=e.columnsList.filter(function(e){return e.property===t.prop});i&&i.length&&e.$refs.xTable.hideColumn(i[0]),e.columnsCache.map(function(e){return e.visible=e.prop===t.prop||e.visible}),e.curCashColumns=e.columnsCache})},showAll:function(){var e=this;this.handleColumnsData.forEach(function(t){t.visible=!1;var i=e.allColumnsList.filter(function(e){return e.property===t.prop});i&&i.length&&e.$refs.xTable.showColumn(i[0]),e.columnsCache.map(function(e){return e.visible=e.prop!==t.prop&&e.visible}),e.curCashColumns=e.columnsCache})},onHeadConfigChange:function(e){var t=this.allColumnsList.filter(function(t){return t.property===e.prop});t&&t.length&&(e.visible?this.$refs.xTable.hideColumn(t[0]):this.$refs.xTable.showColumn(t[0]))},recoverHeadConfig:function(){this.isTag=!1,this.handleColumnsDialogTableVisible=!1},getConfigColumns:function(e){var t=this;"last"!=e&&(this.isTag=!0),"last"===e?this.handleColumnsData=this.columnsCache&&this.columnsCache.length?this.columnsCache.filter(function(e){return d.a.includes(t.fixedColumns,e.prop)&&"colDisp"!=e.prop&&"colCode"!=e.prop}):[]:"all"===e?this.tagList&&this.tagList.length?this.handleColumnsData=this.filterCashColumn&&this.filterCashColumn.length?this.filterCashColumn.filter(function(e){return!d.a.includes(t.fixedColumns,e.prop)}):[]:this.handleColumnsData=this.columnsCache&&this.columnsCache.length?this.columnsCache.filter(function(e){return!d.a.includes(t.fixedColumns,e.prop)}):[]:"tag"===e&&(this.handleColumnsData=this.columnsCache&&this.columnsCache.length?this.columnsCache.filter(function(e){return!d.a.includes(t.fixedColumns,e.prop)}):[],this.curCashList=this.curData,this.showAll())},reloadData:function(e){var t=this;this.handleColumnsData.forEach(function(e){e.visible?t.$refs.xTable.hideColumn(t.$refs.xTable.getColumnByField(e.prop)):t.$refs.xTable.showColumn(t.$refs.xTable.getColumnByField(e.prop))}),this.$refs.xTable.loadData(e)},handleSubsidiaryData:function(e){var t=this,i=JSON.parse(sessionStorage.getItem("curCustomerData")).curYear,a={subjectId:e.colCode,summaryType:"1",year:i};this.$sacpApis.mergeTBSubsidiary(a).then(function(e){e.success?t.singleSubjectDimensionData=e.data:t.$message.error(e.resultInfo.statusText)}).catch(function(e){return t.$message.error(e)}).finally(this.singleSubjectDimensionDialog=!0)},addNbsp:function(e){var t=e.cellValue;e.row,e.column;if(t.match(new RegExp(/\s/g)))for(var i=t.match(new RegExp(/\s/g)).length,a=0;a<=i-1;a++)t=" "+t;return t}},created:function(){p&&(this.columns=p.cashFlowData)},mounted:function(){this.hideStateData()}},L={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"statementOfCashFlowCur"},[i("div",{staticClass:"columnsVisiable",staticStyle:{float:"right","margin-bottom":"8px"}},[0==e.stateFlag?i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"展示全部数据",placement:"top-start"}},[i("el-button",{staticClass:"initBtn",attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-sort-down"},on:{click:e.showStateData}})],1):e._e(),e._v(" "),1==e.stateFlag?i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"隐藏合并数为0",placement:"top-start"}},[i("el-button",{staticClass:"initBtn",attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-sort-up"},on:{click:function(t){return e.hideStateData(1)}}})],1):e._e(),e._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"初始化现金流量表",placement:"top-start"}},[i("el-button",{staticClass:"setBtn",attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-switch-button"},on:{click:e.initMergeTb}})],1),e._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"列设置",placement:"top-start"}},[i("el-button",{attrs:{circle:"",icon:"el-icon-s-grid",type:"primary",size:"small"},on:{click:function(t){return e.selectVisiableColumns("all")}}})],1),e._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"隐藏最后四列",placement:"top-start"}},[i("el-button",{attrs:{circle:"",icon:"el-icon-video-play",type:"primary",size:"small"},on:{click:function(t){return e.selectVisiableColumns("last")}}})],1),e._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"导出",placement:"top-start"}},[i("el-button",{attrs:{circle:"",icon:"el-icon-download",type:"primary",size:"small"},on:{click:function(t){return e.exportMergeTrialBalance()}}})],1)],1),e._v(" "),i("div",{staticClass:"tableDiv"},[i("table-head-title",{attrs:{columns:e.curCashColumns,pageTotal:e.curCashList.length,refreshTable:e.refreshTable}}),e._v(" "),i("vxe-table",{ref:"xTable",attrs:{border:"",resizable:"","highlight-hover-row":"","highlight-current-row":"","show-overflow":"","show-header-overflow":"","export-config":"",height:"auto","scroll-y":{vSize:1e4},"auto-resize":!0,data:e.curCashList,"sort-config":{trigger:"cell"},"tooltip-config":{contentMethod:e.showTooltipMethod,enterable:!0},"cell-style":e.cellStyle},on:{"cell-click":e.handleCellClick,"cell-dblclick":e.handleCellDblclick}},e._l(e.curCashColumns,function(t,a){return i("vxe-table-column",{key:a,attrs:{"header-align":"center",field:t.prop,title:t.label,visiable:t.visiable,fixed:t.fixed?t.fixed:"",align:t.isMoney?e.allAlign:"",formatter:t.isMoney?e.commafyFn:"colDisp"==t.prop?e.addNbsp:"","min-width":t.width?t.width:100}})}),1)],1),e._v(" "),i("el-dialog",{staticClass:"singleSubjectTable",attrs:{title:e.dialogTitle,visible:e.singleSubjectDimensionDialog,width:"70%"},on:{"update:visible":function(t){e.singleSubjectDimensionDialog=t}}},[i("i",{staticClass:"el-icon-download",on:{click:e.iconDownload}}),e._v(" "),i("bdo-table",{ref:"table",attrs:{columns:e.columns,"enable-filter":!1,"enable-toolbox":!1,"enable-view-type":!1,data:e.singleSubjectDimensionData,"show-overflow-tooltip":"",headerCellStyleSelf:{"text-align":"left"},showIndexColumn:!1,showCheckBox:!1,headerListConfig:!1,setBorder:e.setBorder}})],1),e._v(" "),i("el-dialog",{staticClass:"changeFilterTableMethodsDialog",attrs:{visible:e.handleColumnsDialogTableVisible,width:"60%","before-close":e.recoverHeadConfig},on:{"update:visible":function(t){e.handleColumnsDialogTableVisible=t}}},[i("template",{slot:"title"},[i("div",{staticClass:"headerTitle"},[i("span",{staticClass:"el-dialog__title"},[e._v("表头编辑")]),e._v(" "),e.isTag?i("el-select",{staticClass:"tagInput mergeTbTagInput",attrs:{multiple:"","multiple-limit":e.multipleLimit,filterable:"","allow-create":"","default-first-option":e.defaultFirstOption,placeholder:"输入标签内容，用回车添加","filter-method":e.remoteMethod},on:{"remove-tag":e.removeTag},nativeOn:{keyup:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"backspace",void 0,t.key,void 0)?null:e.handleBackspace(t)},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleInputConfirm(t)}]},model:{value:e.tagList,callback:function(t){e.tagList=t},expression:"tagList"}}):e._e()],1)]),e._v(" "),i("el-table",{attrs:{data:e.handleColumnsData,size:"small","max-height":"300px"}},[i("el-table-column",{attrs:{type:"index"}}),e._v(" "),i("el-table-column",{attrs:{prop:"label",label:"表头字段"}}),e._v(" "),i("el-table-column",{attrs:{label:"是否隐藏"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#C0C4CC"},on:{change:function(i){return e.onHeadConfigChange(t.row)}},model:{value:t.row.visible,callback:function(i){e.$set(t.row,"visible",i)},expression:"scope.row.visible"}})]}}])})],1),e._v(" "),i("div",{staticStyle:{"text-align":"center"},attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{round:"",size:"small",type:"primary"},on:{click:e.hiddenAll}},[e._v("全 部 隐 藏\n            ")]),e._v(" "),i("el-button",{attrs:{round:"",size:"small",type:"primary"},on:{click:e.showAll}},[e._v("全 部 开 启\n            ")]),e._v(" "),i("el-button",{attrs:{round:"",size:"small",type:"warning"},on:{click:e.showAll}},[e._v("重 置")])],1)],2),e._v(" "),i("el-dialog",{staticClass:"debCreDialog",attrs:{title:e.debCreDialogTitle,visible:e.debCreDialog,width:"70%"},on:{"update:visible":function(t){e.debCreDialog=t}}},[i("throughTable",{attrs:{throughData:e.throughData,selectCell:e.selectCell}})],1)],1)},staticRenderFns:[]};var I=i("VU/8")(k,L,!1,function(e){i("4M5k")},"data-v-738dcb59",null).exports,_=(i("30bX"),{name:"statementOfCashFlowLast",props:{column:Array,curData:Array},components:{throughTable:g.a,tableHeadTitle:b.a},mixins:[C.a],watch:{column:{handler:function(e){e&&(this.preCashColumns=e,this.columnsCache=JSON.parse(s()(e)))},immediate:!0,deep:!0},curData:{handler:function(e){var t=this;e&&(this.preCashList=e.filter(function(e){return 0!=e.numberMerger}),this.$nextTick(function(){return t.allColumnsList=t.$refs.xTable.collectColumn}))},immediate:!0,deep:!0}},data:function(){return{flag:"HB003-MTB004",selectCell:{},throughData:[],debCreDialog:!1,preCashColumns:this.column,preCashList:this.curData,allAlign:"right",_init:!1,fullscreenLoading:!1,singleSubjectDimensionDialog:!1,singleSubjectDimensionData:[],columns:[],handleColumnsDialogTableVisible:!1,handleColumnsData:[],debCreDialogTitle:"",dialogTitle:"",isTag:!1,tagList:[],multipleLimit:5,loading:!1,defaultFirstOption:!1,queryTag:"",cashFlag:!1,filterCashColumn:[],filterCashData:[],columnsList:[],columnsCache:[],allColumnsList:[],fixedColumns:["colCode","colDisp","totalNumber","debtor","credit","numberMerger"],keyTime:0,row:{}}},methods:{hideCashData:function(e){e&&1===e&&(this.cashFlag=!1);var t=this.curData.filter(function(e){return 0!=e.numberMerger});this.preCashList=t},showCashData:function(){this.preCashList=this.curData,this.cashFlag=!0},iconDownload:function(){var e=this.row,t=JSON.parse(sessionStorage.getItem("curCustomerData")).curYear,i={subjectName:e.colDisp,subjectId:e.colCode,summaryType:"1",year:+t-1};this.$sacpApis.exportSubsidiaryData(i)},exportMergeTrialBalance:function(){this.$sacpApis.exportMergeTrialBalance("合并试算平衡表.xlsx")},handleBackspace:function(){this.keyTime?(this.tagList&&(this.tagList.length?this.queryCashDataByTag():this.getConfigColumns("tag")),this.keyTime=0):this.keyTime++},handleInputConfirm:function(){var e=this;return this.queryTag.trim()?this.tagList.some(function(t){return t===e.queryTag})?this.$message.error("当前标签已经存在!"):void(this.queryTag.trim()&&this.tagList.length<5?(this.tagList.push(this.queryTag),this.queryCashDataByTag()):(this.$message.error("标签限制数量为5个!"),this.queryTag="")):this.$message.error("请输入标签内容!")},remoteMethod:function(e){if(e&&e.length>10)return this.$message.warning("标签限制长度为10 !按下回车键将自动截取当前编辑标签的前10位 !");this.queryTag=e},removeTag:function(e){this.tagList=this.tagList.filter(function(t){return t!=e}),this.tagList.length?this.queryCashDataByTag():this.getConfigColumns("tag")},queryCashDataByTag:function(){var e=this;this.fullscreenLoading=!0;var t="";d.a.arrayEach(this.tagList,function(i,a){return t+=a<e.tagList.length-1?i+"|":""+i}),this.$sacpApis.queryMergeCashByMergeProject(t).then(function(t){e.handleColumnsData=t&&t.cashColumn?t.cashColumn.filter(function(e){return"colCode"!=e.prop&&"colDisp"!=e.prop&&"totalNumber"!=e.prop&&"debtor"!=e.prop&&"credit"!=e.prop&&"numberMerger"!=e.prop}):[],e.filterCashColumn=t&&t.cashColumn?t.cashColumn:[],e.filterCashData=t&&t.preCash?t.preCash:[]}).catch(function(t){return e.$message.error(t)}).finally(function(){var t=[];e.handleColumnsData.map(function(e){t.push(e.prop)});for(var i=function(i){d.a.includes(e.fixedColumns,e.columnsCache[i].prop)||d.a.includes(t,e.columnsCache[i].prop)?d.a.includes(t,e.columnsCache[i].prop)&&e.handleColumnsData.forEach(function(t){return t.visible=t.prop===e.columnsCache[i].prop?e.columnsCache[i].visible:t.visible}):(e.columnsCache[i].visible=!0,e.onHeadConfigChange(e.columnsCache[i]))},a=0;a<e.columnsCache.length;a++)i(a);e.preCashColumns=e.columnsCache,e.preCashList=e.filterCashData,e.fullscreenLoading=!1})},refresh:function(e){this.refreshTable()},refreshTable:function(){this.tagList&&this.tagList.length&&(this.tagList=[],this.getConfigColumns("tag")),this.$emit("isInit",!0)},showTooltipMethod:function(e){e.type,e.column,e.row,e.items,e._columnIndex},commafyFn:function(e){var t=e.cellValue;e.row,e.column;return d.a.commafy(t,{digits:2})},commafy:function(e,t){d.a.commafy(t,{digits:2})},initMergeTb:function(){var e=this;this.fullscreenLoading=!0,this.$sacpApis.initTbAndCaseSheet({}).then(function(t){t.success?(e._init=!0,e.$message.success("初始化成功!"),e.$emit("refreshIndexes",t.resultInfo.refreshIndexes)):e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)}).finally(function(){e.fullscreenLoading=!1})},cellStyle:function(e){e.row,e.rowIndex;var t=e.column;e.columnIndex;if("colDisp"==t.property)return{textDecoration:"underline",cursor:"pointer"}},handleCellClick:function(e){var t=e.row,i=(e.rowIndex,e.$rowIndex,e.column);e.columnIndex,e.$columnIndex,e.cell;if("colDisp"==i.property){this.columns.forEach(function(e){"preAmount"==e.prop&&(e.label=t.colDisp)}),this.row=t,this.singleSubjectDimensionData=[];for(var a=t.totalNumber,l=(a+="").split("."),n=l[0],s=l.length>1?"."+l[1]:"",o=/(\d+)(\d{3})/;o.test(n);)n=n.replace(o,"$1,$2");this.handleSubsidiaryData(t),this.dialogTitle="单科目维度:"+t.colDisp+"(汇总数:"+(n+s)+")"}},handleCellDblclick:function(e){var t=this,i=e.row,a=(e.rowIndex,e.$rowIndex,e.column);e.columnIndex,e.$columnIndex,e.cell;if("debtor"==a.property||"credit"==a.property){if(!i.relatedCode)return void this.$message.warning("合计项无法查看详细!");"debtor"==a.property?this.debCreDialogTitle="借方抵销:"+i.colCode+"-"+i.colDisp:"credit"==a.property&&(this.debCreDialogTitle="贷方抵销:"+i.colCode+"-"+i.colDisp);var l=JSON.parse(sessionStorage.getItem("curCustomerData")).curProjectId;this.selectCell={subjectId:i.colCode,projectId:l,year:JSON.parse(sessionStorage.getItem("curCustomerData")).curYear-1,activeFlag:null,subjectName:i.colDisp,isLast:!0,adjustType:3},this.$store.commit("setCell",this.selectCell),this.$sacpApis.offsetThrough(this.selectCell).then(function(e){e.success&&(t.throughData=e.data)}).catch(function(e){return t.$message.error(e)}).finally(function(){t.debCreDialog=!0})}},selectVisiableColumns:function(e){this.getConfigColumns(e),this.handleColumnsDialogTableVisible=!0},hiddenAll:function(){var e=this;this.columnsList=this.$refs.xTable.getColumns(),this.handleColumnsData.forEach(function(t){t.visible=!0;var i=e.columnsList.filter(function(e){return e.property===t.prop});i&&i.length&&e.$refs.xTable.hideColumn(i[0]),e.columnsCache.map(function(e){return e.visible=e.prop===t.prop||e.visible}),e.preCashColumns=e.columnsCache})},showAll:function(){var e=this;this.handleColumnsData.forEach(function(t){t.visible=!1;var i=e.allColumnsList.filter(function(e){return e.property===t.prop});i&&i.length&&e.$refs.xTable.showColumn(i[0]),e.columnsCache.map(function(e){return e.visible=e.prop!==t.prop&&e.visible}),e.preCashColumns=e.columnsCache})},onHeadConfigChange:function(e){var t=this.allColumnsList.filter(function(t){return t.property===e.prop});t&&t.length&&(e.visible?this.$refs.xTable.hideColumn(t[0]):this.$refs.xTable.showColumn(t[0]))},recoverHeadConfig:function(){this.isTag=!1,this.handleColumnsDialogTableVisible=!1},getConfigColumns:function(e){var t=this;"last"!=e&&(this.isTag=!0),"last"===e?this.handleColumnsData=this.columnsCache&&this.columnsCache.length?this.columnsCache.filter(function(e){return d.a.includes(t.fixedColumns,e.prop)&&"colDisp"!=e.prop&&"colCode"!=e.prop}):[]:"all"===e?this.tagList&&this.tagList.length?this.handleColumnsData=this.filterCashColumn&&this.filterCashColumn.length?this.filterCashColumn.filter(function(e){return!d.a.includes(t.fixedColumns,e.prop)}):[]:this.handleColumnsData=this.columnsCache&&this.columnsCache.length?this.columnsCache.filter(function(e){return!d.a.includes(t.fixedColumns,e.prop)}):[]:"tag"===e&&(this.handleColumnsData=this.columnsCache&&this.columnsCache.length?this.columnsCache.filter(function(e){return!d.a.includes(t.fixedColumns,e.prop)}):[],this.preCashList=this.curData,this.showAll())},reloadData:function(e){var t=this;this.handleColumnsData.forEach(function(e){e.visible?t.$refs.xTable.hideColumn(t.$refs.xTable.getColumnByField(e.prop)):t.$refs.xTable.showColumn(t.$refs.xTable.getColumnByField(e.prop))}),this.$refs.xTable.loadData(e)},handleSubsidiaryData:function(e){var t=this,i=JSON.parse(sessionStorage.getItem("curCustomerData")).curYear,a={subjectId:e.colCode,summaryType:"1",year:Number(i)-1};this.$sacpApis.mergeTBSubsidiary(a).then(function(e){e.success?t.singleSubjectDimensionData=e.data:t.$message.error(e.resultInfo.statusText)}).catch(function(e){return t.$message.error(e)}).finally(function(){return t.singleSubjectDimensionDialog=!0})},addNbsp:function(e){var t=e.cellValue;e.row,e.column;if(t.match(new RegExp(/\s/g)))for(var i=t.match(new RegExp(/\s/g)).length,a=0;a<=i-1;a++)t=" "+t;return t}},created:function(){p&&(this.columns=p.preCashFlowData)},mounted:function(){this.hideCashData()}}),$={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"statementOfCashFlowLast"},[i("div",{staticClass:"columnsVisiable",staticStyle:{float:"right","margin-bottom":"8px"}},[0==e.cashFlag?i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"展示全部数据",placement:"top-start"}},[i("el-button",{staticClass:"initBtn",attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-sort-down"},on:{click:e.showCashData}})],1):e._e(),e._v(" "),1==e.cashFlag?i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"隐藏合并数为0",placement:"top-start"}},[i("el-button",{staticClass:"initBtn",attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-sort-up"},on:{click:function(t){return e.hideCashData(1)}}})],1):e._e(),e._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"初始化现金流量表",placement:"top-start"}},[i("el-button",{staticClass:"setBtn",attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-switch-button"},on:{click:e.initMergeTb}})],1),e._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"列设置",placement:"top-start"}},[i("el-button",{attrs:{circle:"",icon:"el-icon-s-grid",type:"primary",size:"small"},on:{click:function(t){return e.selectVisiableColumns("all")}}})],1),e._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"隐藏最后四列",placement:"top-start"}},[i("el-button",{attrs:{circle:"",icon:"el-icon-video-play",type:"primary",size:"small"},on:{click:function(t){return e.selectVisiableColumns("last")}}})],1),e._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"导出",placement:"top-start"}},[i("el-button",{attrs:{circle:"",icon:"el-icon-download",type:"primary",size:"small"},on:{click:function(t){return e.exportMergeTrialBalance()}}})],1)],1),e._v(" "),i("div",{staticClass:"tableDiv"},[i("table-head-title",{attrs:{columns:e.columns,pageTotal:e.preCashList.length,refreshTable:e.refreshTable}}),e._v(" "),i("vxe-table",{ref:"xTable",attrs:{border:"",resizable:"","highlight-hover-row":"","highlight-current-row":"","show-overflow":"","show-header-overflow":"","export-config":"",height:"auto","auto-resize":!0,data:e.preCashList,"scroll-y":{vSize:1e4},"sort-config":{trigger:"cell"},"tooltip-config":{contentMethod:e.showTooltipMethod,enterable:!0},"cell-style":e.cellStyle},on:{"cell-click":e.handleCellClick,"cell-dblclick":e.handleCellDblclick}},e._l(e.preCashColumns,function(t,a){return i("vxe-table-column",{key:a,attrs:{"header-align":"center",field:t.prop,title:t.label,fixed:t.fixed?t.fixed:"",align:t.isMoney?e.allAlign:"",visiable:t.visiable,formatter:t.isMoney?e.commafyFn:"colDisp"==t.prop?e.addNbsp:"","min-width":t.width?t.width:100}})}),1)],1),e._v(" "),i("el-dialog",{staticClass:"singleSubjectTable",attrs:{title:e.dialogTitle,visible:e.singleSubjectDimensionDialog,width:"70%"},on:{"update:visible":function(t){e.singleSubjectDimensionDialog=t}}},[i("i",{staticClass:"el-icon-download",on:{click:e.iconDownload}}),e._v(" "),i("bdo-table",{ref:"table",attrs:{columns:e.columns,"enable-filter":!1,"enable-toolbox":!1,"enable-view-type":!1,data:e.singleSubjectDimensionData,"page-total":e.singleSubjectDimensionData?e.singleSubjectDimensionData.length:0,headerCellStyleSelf:{"text-align":"left"},"show-overflow-tooltip":"",showIndexColumn:!1,showCheckBox:!1,headerListConfig:!1,setBorder:!0}})],1),e._v(" "),i("el-dialog",{staticClass:"changeFilterTableMethodsDialog",attrs:{title:"表头编辑",visible:e.handleColumnsDialogTableVisible,width:"60%","before-close":e.recoverHeadConfig},on:{"update:visible":function(t){e.handleColumnsDialogTableVisible=t}}},[i("template",{slot:"title"},[i("div",{staticClass:"headerTitle"},[i("span",{staticClass:"el-dialog__title"},[e._v("表头编辑")]),e._v(" "),e.isTag?i("el-select",{staticClass:"tagInput mergeTbTagInput",attrs:{multiple:"","multiple-limit":e.multipleLimit,filterable:"","allow-create":"","default-first-option":e.defaultFirstOption,placeholder:"输入标签内容，用回车添加","filter-method":e.remoteMethod},on:{"remove-tag":e.removeTag},nativeOn:{keyup:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"backspace",void 0,t.key,void 0)?null:e.handleBackspace(t)},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleInputConfirm(t)}]},model:{value:e.tagList,callback:function(t){e.tagList=t},expression:"tagList"}}):e._e()],1)]),e._v(" "),i("el-table",{ref:"setHeadRowTable",attrs:{data:e.handleColumnsData,size:"small","max-height":"300px"}},[i("el-table-column",{attrs:{type:"index"}}),e._v(" "),i("el-table-column",{attrs:{prop:"label",label:"表头字段"}}),e._v(" "),i("el-table-column",{attrs:{label:"是否隐藏"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#C0C4CC"},on:{change:function(i){return e.onHeadConfigChange(t.row)}},model:{value:t.row.visible,callback:function(i){e.$set(t.row,"visible",i)},expression:"scope.row.visible"}})]}}])})],1),e._v(" "),i("div",{staticStyle:{"text-align":"center"},attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{round:"",size:"small",type:"primary"},on:{click:e.hiddenAll}},[e._v("全 部 隐 藏\n            ")]),e._v(" "),i("el-button",{attrs:{round:"",size:"small",type:"primary"},on:{click:e.showAll}},[e._v("全 部 开 启\n            ")]),e._v(" "),i("el-button",{attrs:{round:"",size:"small",type:"warning"},on:{click:e.showAll}},[e._v("重 置")])],1)],2),e._v(" "),i("el-dialog",{staticClass:"debCreDialog",attrs:{title:e.debCreDialogTitle,visible:e.debCreDialog,width:"70%"},on:{"update:visible":function(t){e.debCreDialog=t}}},[i("throughTable",{attrs:{throughData:e.throughData,selectCell:e.selectCell}})],1)],1)},staticRenderFns:[]};var S=i("VU/8")(_,$,!1,function(e){i("/XV9")},"data-v-1bd699f6",null).exports,A=i("XNiZ"),B={name:"mergeTrialBalance",components:{mergeTbCur:y,mergeTbLast:w,statementOfCashFlowCur:I,statementOfCashFlowLast:S,BdoTable:h.a},props:{customerData:Array},computed:{getRefreshPagesId:function(){return this.$store.state.addBadgeTb}},watch:{getRefreshPagesId:{handler:function(e){e&&(this.paneList.forEach(function(t){t.isMark="string"==typeof e&&e.indexOf(t.indexId)>-1||"object"===(void 0===e?"undefined":u()(e))&&e.refreshIndexes.indexOf(t.indexId)>-1}),this.refreshIndexesCache=e,"object"===(void 0===e?"undefined":u()(e))&&window.location.hash.indexOf("/MergeTrialBalance")>-1&&this.handleCurstomerId())},immediate:!0,deep:!0}},data:function(){var e;return e={refreshIndexesCache:null,activeName:"mergeTbCur",paneList:[{label:"合并试算平衡表-本期",name:"mergeTbCur",id:0,indexId:"HB003-MTB001",isMark:!1},{label:"合并试算平衡表-上期",name:"mergeTbLast",id:1,indexId:"HB003-MTB002",isMark:!1},{label:"合并现金流量表-本期",name:"statementOfCashFlowCur",id:2,indexId:"HB003-MTB003",isMark:!1},{label:"合并现金流量表-上期",name:"statementOfCashFlowLast",id:3,indexId:"HB003-MTB004",isMark:!1}],currentTabComponent:"mergeTbCur",validColumns:[{prop:"colDisp",label:"校验项",filterOptions:{disabled:!0}},{prop:"unAuditAmount",label:"本年未审数",filterOptions:{disabled:!0}},{prop:"adjustAmount",label:"本年抵销数",filterOptions:{disabled:!0}},{prop:"auditAmount",label:"本年审定数",filterOptions:{disabled:!0}},{prop:"preUnAuditAmount",label:"上年未审数",filterOptions:{disabled:!0}},{prop:"preAdjustAmount",label:"上年抵销数",filterOptions:{disabled:!0}},{prop:"preAuditAmount",label:"上年审定数",filterOptions:{disabled:!0}}],validData:[],tbColumn:[],curTbData:[],preTbData:[],cashColumn:[],curCashData:[],preCashData:[],tableLoding:!1,fullscreenLoading:!1,fullScreen:!1,column:[],curData:[],errorText:"",isErrorText:!1,validDataModel:new A.a,curCustomerId:"",curProjectId:"",curAccYear:"",menuId:"",activeLabel:""},r()(e,"preTbData",[]),r()(e,"curCashData",[]),r()(e,"preCashData",[]),e},methods:{fullScreenChange:function(){this.fullScreen=!this.fullScreen},refreshIndexes:function(e){var t=this;if(e){window.location.hash.split("=");var i=e.split(",");i=i.filter(function(e){return e!=t.menuId}).join(),this.paneList.forEach(function(i){i.isMark=e.indexOf(i.indexId)>-1,i.isMark&&t.currentTabComponent===i.name&&(t.handleCurstomerId(),i.isMark=!1)}),this.$eventBus.$emit("page-refresh",i)}},handleClick:function(e){var t=this,i=this.paneList.filter(function(t){return e.name&&t.name==e.name});switch(this.menuId=i.length?i[0].indexId:"",this.currentTabComponent=i[0].name,this.activeLabel=e.label,e.name){case"mergeTbCur":this.column=this.tbColumn,this.curData=this.curTbData,this.menuId="HB003-MTB001";break;case"mergeTbLast":this.column=this.tbColumn,this.curData=this.preTbData,this.menuId="HB003-MTB002";break;case"statementOfCashFlowCur":this.column=this.cashColumn,this.curData=this.curCashData,this.menuId="HB003-MTB003";break;case"statementOfCashFlowLast":this.column=this.cashColumn,this.curData=this.preCashData,this.menuId="HB003-MTB004"}if(this.$store.commit("setClosePostill",!1),this.$store.commit("setMergeTBActiveTab",this.activeLabel),this.$store.commit("setMergeTBIndexID",this.menuId),this.$store.commit("setMergeTBActiveName",this.activeName),this.$router.push({name:"MergeTrialBalance",query:{tab:this.activeName}}),this.refreshIndexesCache="string"==typeof this.refreshIndexesCache&&this.refreshIndexesCache.split(","),this.paneList.forEach(function(e){e.isMark&&t.currentTabComponent===e.name&&(e.isMark=!1)}),this.paneList.every(function(e){return 0==e.isMark})){this.$store.commit("setRemoveBagdeScope","MergeTrialBalance");var a=JSON.parse(localStorage.getItem("refreshIndexes"));if(a&&a.refreshIndexes&&a.refreshIndexes.length){var l=a.refreshIndexes.split(",");l=l.filter(function(e){return-1===e.indexOf("HB003")});var n={key:a.key+=1,refreshIndexes:l.join()};localStorage.setItem("refreshIndexes",s()(n))}}},initAgain:function(e){e&&this.handleCurstomerId()},mergeTrialBalanceInit:function(){var e=this;this.fullscreenLoading=!0,this.curCustomerId&&this.curProjectId&&this.$sacpApis.mergeTrialBalanceAndCashFlowStatement({customerId:this.curCustomerId,projectId:this.curProjectId,refreshFlg:1}).then(function(t){if(t)for(var i=0;i<t.length;i++){var a=t[i];a&&a.hasOwnProperty("curData")?(e.column=a.tbColumn,e.curData=a.curData,Array.isArray(a.tbColumn)?(a.tbColumn.shift(),e.tbColumn=a.tbColumn):e.tbColumn=a.tbColumn,e.curTbData=a.curData,e.preTbData=a.preData):a&&a.hasOwnProperty("curCash")&&(e.cashColumn=a.cashColumn,e.curCashData=a.curCash,e.preCashData=a.preCash)}else e.validData.length=0}).finally(function(){e.fullscreenLoading=!1,e.handleUrl()})},handleUrl:function(){var e="",t=window.location.hash.split("/");if(-1!=(t=t.pop()).indexOf("?")){var i=t.split("?")[1];t=t.split("?")[0],e=i.split("=")[1]}var a={name:e};this.activeName=e,this.handleClick(a)},getTbValidList:function(){var e=this;this.validData=[],this.$sacpApis.mergeTBValidList({customerId:this.curCustomerId,projectId:this.curProjectId,refreshFlg:1}).then(function(t){if(t.success){if(t.data){0==t.data[t.data.length-1].checkFlag?(e.errorText="校验不平",e.isErrorText=!0):(e.errorText="",e.isErrorText=!1);var i=t.data.slice(0,-1);for(var a in i){var n={};for(var s in l()(n,e.validDataModel,i[a]),n)0===n[s]?n[s]="平":null===n[s]?n[s]=null:"colDisp"!=s&&(n[s]=d.a.commafy(n[s],{digits:2}));e.validData.push(n)}}}else e.$message.error(t.resultInfo.statusText)}).catch(function(t){e.$message.error(t)})},handleYear:function(){var e=this.curAccYear;this.validColumns[1].label=e+"未审数",this.validColumns[2].label=e+"抵销数",this.validColumns[3].label=e+"审定数",this.validColumns[4].label=e-1+"未审数",this.validColumns[5].label=e-1+"抵销数",this.validColumns[6].label=e-1+"审定数"},commafy:function(e,t){d.a.commafy(t,{digits:2})},handleCurstomerId:function(){var e=JSON.parse(sessionStorage.getItem("curCustomerData"));this.curCustomerId=e.curCustomerId,this.curProjectId=e.curProjectId,this.curAccYear=e.curYear,this.handleYear(),this.mergeTrialBalanceInit(),this.getTbValidList()},removeClickedMenuId:function(e,t){if(e&&"string"==typeof e){var i=e.split(",").filter(function(e){return e!=t}).join();this.$store.commit("setAddBagdeTb",i)}}},activated:function(){var e=window.location.hash.split("=").pop();this.paneList.some(function(e){return e.isMark})&&this.handleCurstomerId();var t=this.paneList.filter(function(t){return t.name===e})[0];t&&t.isMark&&this.removeClickedMenuId(this.getRefreshPagesId,t.indexId)},created:function(){this.handleCurstomerId()}},M={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"mergeTrialBalance"},[a("div",{staticClass:"validErrorInfo"},[a("span",{style:e.errorText?"color:red":"color:#000"},[e._v(e._s(e.errorText?e.errorText:"校验项"))]),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"刷新校验列表",placement:"top"}},[a("i",{staticClass:"el-icon-refresh",staticStyle:{color:"#409eff"},on:{click:e.getTbValidList}})]),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.isErrorText?"关闭校验项列表":"打开校验项列表",placement:"right"}},[e.isErrorText?a("i",{staticClass:"el-icon-caret-top",on:{click:function(t){e.isErrorText=!1}}}):a("i",{staticClass:"el-icon-caret-bottom",on:{click:function(t){e.isErrorText=!0}}})])],1),e._v(" "),e.isErrorText?a("div",{staticClass:"validTable"},[a("bdo-table",{staticStyle:{width:"100%"},attrs:{columns:e.validColumns,data:e.validData,"max-height":330,"enable-filter":!1,"enable-toolbox":!1,"enable-view-type":!1,showIndexColumn:!1,showCheckBox:!1,enableHeadConfig:!1,headerListConfig:!1,setBorder:!0,tableLoding:e.tableLoding,"show-overflow-tooltip":"",headerCellStyleSelf:{"text-align":"center"}},scopedSlots:e._u([{key:"col-unAuditAmount",fn:function(t){return[a("span",{style:{textAlign:"平"===t.row.unAuditAmount?"center":"right",color:"平"===t.row.unAuditAmount?"":"red",display:"block"}},[e._v("\n                    "+e._s(t.row.unAuditAmount))])]}},{key:"col-adjustAmount",fn:function(t){return[a("span",{style:{textAlign:"平"===t.row.adjustAmount?"center":"right",color:"平"===t.row.adjustAmount?"":"red",display:"block"}},[e._v("\n                    "+e._s(t.row.adjustAmount))])]}},{key:"col-auditAmount",fn:function(t){return[a("span",{style:{textAlign:"平"===t.row.auditAmount?"center":"right",color:"平"===t.row.auditAmount?"":"red",display:"block"}},[e._v("\n                    "+e._s(t.row.auditAmount))])]}},{key:"col-preUnAuditAmount",fn:function(t){return[a("span",{style:{textAlign:"平"===t.row.preUnAuditAmount?"center":"right",color:"平"===t.row.preUnAuditAmount?"":"red",display:"block"}},[e._v("\n                    "+e._s(t.row.preUnAuditAmount))])]}},{key:"col-preAdjustAmount",fn:function(t){return[a("span",{style:{textAlign:"平"===t.row.preAdjustAmount?"center":"right",color:"平"===t.row.preAdjustAmount?"":"red",display:"block"}},[e._v("\n                    "+e._s(t.row.preAdjustAmount))])]}},{key:"col-preAuditAmount",fn:function(t){return[a("span",{style:{textAlign:"平"===t.row.preAuditAmount?"center":"right",color:"平"===t.row.preAuditAmount?"":"red",display:"block"}},[e._v("\n                    "+e._s(t.row.preAuditAmount))])]}}],null,!1,1845018825)})],1):e._e(),e._v(" "),a("div",{class:{fullScreen:e.fullScreen?"fullScreen":"",fullScreenBox:!0}},[a("el-tooltip",{attrs:{effect:"dark",content:e.fullScreen?"取消全屏":"全屏",placement:"top-start"}},[a("el-button",{class:{fullScreenBtn:!0},attrs:{type:"primary",circle:"",size:"small"},on:{click:e.fullScreenChange}},[e.fullScreen?e._e():a("img",{attrs:{src:i("/Dxn"),alt:""}}),e._v(" "),e.fullScreen?a("img",{attrs:{src:i("W+0t"),alt:""}}):e._e()])],1),e._v(" "),a("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(this.paneList,function(t){return a("el-tab-pane",{key:t.id,attrs:{label:t.label,name:t.name}},[a("span",{attrs:{slot:"label",id:"extendEl"},slot:"label"},[t.isMark?a("el-badge",{staticClass:"item",attrs:{"is-dot":""}}):e._e(),e._v("\n                    "+e._s(t.label)+"\n                ")],1)])}),1),e._v(" "),a("keep-alive",[a(e.currentTabComponent,{ref:"tbContent",tag:"component",attrs:{column:e.column,curData:e.curData},on:{isInit:e.initAgain,refreshIndexes:e.refreshIndexes}})],1)],1)])},staticRenderFns:[]};var j=i("VU/8")(B,M,!1,function(e){i("uK8n")},null,null);t.default=j.exports},"4M5k":function(e,t){},oGeI:function(e,t){},oROU:function(e,t){},uK8n:function(e,t){}});