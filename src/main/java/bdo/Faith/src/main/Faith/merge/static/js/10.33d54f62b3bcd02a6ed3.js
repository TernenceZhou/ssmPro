webpackJsonp([10],{"4ftR":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i("mvHQ"),o=i.n(s),r=i("ABj6"),n=i("ZHXk"),a=i.n(n),l=i("VzA3"),c=i("qcqk"),u=i("0Nqy"),d={components:{BdoTable:r.a,Postill:l.a,counter:c.a,tableHeadTitle:u.a},prop:"mergeNoteInfo",props:{customerData:Array},data:function(){return{flag:"HB002-MC006",isOpenDrawer:!1,noteInfo:[],editDialogVisible:!1,modifyNoteName:"",uploadDialogVisible:!1,excelName:"",excelFile:"",currentRow:Object,fullscreenLoading:!1,rowMergeProjectId:null,curAutoId:null,tableHeight:100,customerId:"",curProjectId:"",projectId:"",customerName:"",projectName:"",singleCustomerName:"",singleProjectName:"",buttonTitle:"初始化合并附注",allAlign:"right",isShort:!1,isPreCheckSort:!1,isNoteNoSort:!1,menuID:"HB002-MC006",activeLabel:"单体附注",limitArr:[],userId:"",number:0,columns:[{label:"操作",prop:"action",width:"300"},{label:"附注名称",prop:"noteName",width:"100"},{label:"报表科目",prop:"colName",width:"150"},{label:"审定数",prop:"auditedAmount",width:"150"},{label:"年初数",prop:"preAuditAmount",width:"200"},{label:"本期校验",prop:"curCheck",width:"200"},{label:"上期校验",prop:"preCheck",width:"200"},{label:"状态",prop:"isCompleteNow",width:"80"},{label:"更新人",prop:"__ulastUpdatedUserName",width:"80"},{label:"更新时间",prop:"lastUpdateDate",width:"160"}],requestParam:{}}},methods:{openDrawer:function(){this.isOpenDrawer=!0},closePostill:function(e){this.isOpenDrawer=e},isPostil:function(e){this.isPostilLink=!0},getPermission:function(){var e=this,t={menuId:"",sqlId:"DG00061",param1:this.projectName.split("-")[0],param2:this.customerName.split("-")[0]};this.$sacpApis.postillCheck(t).then(function(t){if(t.success){var i=t.data[0],s=[];if(i.manager==e.userId){s.push({status:"manager",limit:1})}if(i.signAccountant2==e.userId||i.signAccountant3==e.userId){s.push({status:"signAccountant2",limit:1})}if(i.audit1==e.userId){s.push({status:"audit1",limit:1})}if(i.audit2==e.userId){s.push({status:"audit2",limit:1})}if(i.reaReviewer==e.userId){s.push({status:"reaReviewer",limit:1})}if(i.signUser==e.userId){s.push({status:"signUser",limit:1})}if(i.reviewPartner==e.userId){s.push({status:"reviewPartner",limit:1})}if(i.issuedPeople==e.userId){s.push({status:"issuedPeople",limit:1})}e.limitArr=s}})},noteNoSort:function(e){var t=[];t=this.isNoteNoSort?this.noteInfo.sort(function(e,t){return Number(e.sortNo)-Number(t.sortNo)}):this.noteInfo.sort(function(e,t){return Number(e.sortNo)-Number(t.sortNo)}).reverse(),this.isNoteNoSort=!this.isNoteNoSort,this.noteInfo=t},preCheckSort:function(e){"curCheck"==e?this.isShort=!this.isShort:this.isPreCheckSort=!this.isPreCheckSort,this.handleSortData(this.noteInfo,e)},editNoteInfo:function(e){this.currentRow=e,this.modifyNoteName=e.noteName,this.editDialogVisible=!0},submitEditInfo:function(){this.editDialogVisible=!1,this.currentRow.noteName=this.modifyNoteName},uploadNoteInfo:function(e){this.curAutoId=e.autoId,this.uploadDialogVisible=!0},importExcel:function(){this.$refs.uploadExcel.click()},readExcel:function(e){var t=e.target.files;this.excelName=t[0].name,this.excelFile=this.$refs.uploadExcel.files[0]},confirUpload:function(){var e=this;this.uploadDialog=!1;var t=this.excelName.split(".");if("xlsx"!=t[t.length-1])return this.$message.error("仅支持.xlsx类型文件!");var i=new FormData;i.append("file",this.excelFile),this.$sacpApis.uploadExcel(i).then(function(t){if(t.success){e.$message.success("上传成功");e.$refs.uploadExcel;var i={fileId:t.data[0].fileId};e.uploadSuccessCB(i)}else{var s=t.resultInfo.statusText;e.$message.error(s)}})},uploadSuccessCB:function(e){var t=this,i={fileId:e.fileId,autoId:this.curAutoId};this.$sacpApis.mergeNoteInfoUploadCB(i).then(function(e){e.success?t.uploadDialogVisible=!1:t.$message.error(e.resultInfo.statusText)}).catch(function(e){t.$message.error(e)}).finally(function(){t.currentPageInit(),t.cancelUpload()})},cancelUpload:function(){this.fullscreenLoading=!1,this.uploadDialogVisible=!1,this.excelFile="",this.excelName="",this.typeValue=""},downloadNoteInfo:function(e){var t={autoId:e.autoId};this.$sacpApis.mergeNoteInfoDownLoad(t,e.fileName)},editFile:function(e){var t={extraOptions:e,currentNode:{extraOptions:e}};t.autoId=t.extraOptions.autoId,sessionStorage.setItem("mergeNoteInfoNode",o()(t)),window.open("/Faith/dgcenter.do?m=openMergeNoteInfo&noteNo="+t.extraOptions.noteNo)},isDisabledAndFinished:function(e,t,i){var s=this,o="",r="";switch(i){case"forbid":"0"===e.isForbid?e.isForbid="1":e.isForbid="0",o=e.isForbid,r="禁用状态更新成功!";break;case"finish":"0"===e.isFinished?e.isFinished="1":e.isFinished="0",o=e.isFinished,r="已完成状态更新成功!"}var n={customerId:this.customerId,projectId:this.projectId,mergeProjectId:e.mergeProjectId,noteId:e.autoId,type:i,value:o};this.$sacpApis.mergeNoteInfoDisabledFinished(n).then(function(e){e.success?s.$message.success(r):s.$message.error(e.resultInfo.statusText)}).catch(function(e){return s.$message.error(e)})},initMergeNoteInfo:function(){var e=this,t={customerId:this.customerId,projectId:this.projectId};this.$sacpApis.mergeNoteInfoInitBtn(t).then(function(t){t.success?(e.currentPageInit(),e.$message.success("初始化合并附注成功!")):e.$message.error(t.resultInfo.statusText)}).catch(function(t){return function(t){return e.$message.error(t)}})},refreshTable:function(){this.currentPageInit()},currentPageInit:function(){var e=this;this.requestParam={customerId:this.customerId,mergeProjectId:this.curProjectId,projectId:this.projectId},this.fullscreenLoading=!0,this.$sacpApis.mergeNoteInfoInit(this.requestParam).then(function(t){t&&t.success?t.data&&(e.noteInfo=t.data):e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)}).finally(function(){e.fullscreenLoading=!1,e.getPermission()})},handleSortData:function(e,t){var i=[],s=[],o=[],r=[];e.forEach(function(e){e[t]>0?i.push(e):e[t]<0&&Math.abs(e[t])>0?s.push(e):0==e[t]?o.push(e):e[t]||r.push(e)});var n=[];if(this.isPreCheckSort||this.isShort)n="curCheck"==t?i.sort(this.sortCurCheck).reverse().concat(s.sort(this.sortCurCheck).reverse()).concat(o).concat(r):i.sort(this.sortNumber).reverse().concat(s.sort(this.sortNumber).reverse()).concat(o).concat(r),this.noteInfo.forEach(function(e){"1"===e.isForbid?e.isHidden=!0:e.isHidden=!1}),this.noteInfo=n.reverse();else{if("curCheck"==t){var a=i.sort(this.sortCurCheck).reverse(),l=s.sort(this.sortCurCheck).reverse();n=a.concat(l).concat(o).concat(r)}else{var c=i.sort(this.sortNumber).reverse(),u=s.sort(this.sortNumber).reverse();n=c.concat(u).concat(o).concat(r)}this.noteInfo=n}},sortNumber:function(e,t){return e.preCheck-t.preCheck},sortCurCheck:function(e,t){return e.curCheck-t.curCheck},commafyFn:function(e){var t=e.cellValue;e.row,e.column;return a.a.commafy(t,{digits:2})},handleCustomerInformation:function(){var e=JSON.parse(sessionStorage.getItem("curCustomerData"));this.customerId=e.curCustomerId,this.projectId=e.curProjectId,this.customerName=e.curCustomerName,this.projectName=e.curProjectName;var t=JSON.parse(sessionStorage.getItem("projectItem"));-1!=t.mergeCustomerName.indexOf("-")?this.singleCustomerName=t.mergeCustomerName:this.singleCustomerName=t.mergeCustomerId+"-"+t.mergeCustomerName,this.singleProjectName=t.projectId,this.userId=e.userId,this._strArr=t.projectId.split("-"),this.curProjectId=this._strArr[0],this.curCustomerId=t.customerId,this.currentPageInit()},cellClassName:function(e){var t=e.row,i=(e.rowIndex,e.column);e.columnIndex;return"curCheck"===i.property&&t.curCheck&&0!=t.curCheck?"col-red":"preCheck"===i.property&&t.preCheck&&0!=t.preCheck?"col-red":void 0},storageEvent:function(){var e=JSON.parse(localStorage.getItem("refreshIndexes"));e&&e.refreshIndexes&&e.refreshIndexes.length&&e.refreshIndexes.indexOf(this.flag)>-1&&this.handleCustomerInformation()},clear:function(e){this.number=e},exportFile:function(){var e={columns:this.columns,params:{},jsonData:this.requestParam,url:"dgCenter/HbMergeProjectNoteInfo.queryMergeNoteInfo.json",fileName:"合并附注报表"};this.exportExcel(e)}},created:function(){this.handleCustomerInformation()}},m={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"singleNoteInfo"},[i("el-container",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"container"},[i("el-header",[i("el-row",[i("el-col",{attrs:{span:1}},[i("div",{staticClass:"logo"})]),e._v(" "),i("el-col",{attrs:{span:7}},[i("div",{staticClass:"customerInformation"},[i("p",[e._v("客户:"+e._s(this.customerName))]),e._v(" "),i("p",[e._v("项目:"+e._s(this.projectName))])])]),e._v(" "),i("el-col",{attrs:{span:7}},[i("div",{staticClass:"singleCustomerInformation"},[i("p",[e._v("子客户:"+e._s(this.singleCustomerName))]),e._v(" "),i("p",[e._v("子项目:"+e._s(this.singleProjectName))])])]),e._v(" "),i("el-col",{attrs:{span:1}},[i("div",{staticClass:"columnsVisiable",staticStyle:{position:"absolute",right:"5px",margin:"14px"}},[i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"批注",placement:"top-start"}},[i("el-button",{staticClass:"singlePostillBtn",attrs:{circle:"",size:"small",icon:"el-icon-edit-outline"},on:{click:e.openDrawer}})],1)],1)])],1)],1),e._v(" "),i("el-main",[i("div",{staticStyle:{"padding-top":"10px"}},[i("table-head-title",{attrs:{pageTotal:e.noteInfo.length,refreshTable:e.refreshTable},on:{exportFile:e.exportFile}})],1),e._v(" "),i("div",{staticClass:"singleNoteTable"},[i("vxe-table",{ref:"multipleTable",attrs:{resizable:"",border:"",height:"auto","highlight-hover-row":"","show-overflow":"","show-header-overflow":"","highlight-current-row":"","header-align":"center",data:e.noteInfo,"keep-source":"","auto-resize":!0,"cell-class-name":e.cellClassName,"scroll-y":{vSize:1e4}}},[i("vxe-table-column",{attrs:{title:"操作",width:"160",fixed:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return t.rowIndex,[i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"上传",placement:"top-start"}},[i("el-button",{staticClass:"uploadBtnCol",attrs:{size:"small",type:"text",icon:"el-icon-upload"},on:{click:function(t){return e.uploadNoteInfo(s)}}})],1),e._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"下载",placement:"top-start"}},[i("el-button",{staticClass:"downloadBtnCol",attrs:{size:"small",type:"text",icon:"el-icon-download"},on:{click:function(t){return e.downloadNoteInfo(s)}}})],1),e._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"编辑文件",placement:"top-start"}},[i("el-button",{staticClass:"editFileBtnCol",attrs:{size:"small",type:"text",icon:"el-icon-document-copy",disabled:"0"===s.isCompleteNow},on:{click:function(t){return e.editFile(s)}}})],1)]}}])}),e._v(" "),i("vxe-table-column",{attrs:{field:"noteNo",title:"附注编号","min-width":"150","edit-render":{name:"input"},fixed:"left"},scopedSlots:e._u([{key:"header",fn:function(t){var s=t.column;return[i("span",[e._v(e._s(s.title))]),e._v(" "),i("span",{staticClass:"custom-sort",class:{"is-order":e.isNoteNoSort}},[i("i",{class:[e.isNoteNoSort?"vxe-icon--caret-bottom":"vxe-icon--caret-top"],on:{click:function(t){return e.noteNoSort("noteNo")}}})])]}}])}),e._v(" "),i("vxe-table-column",{attrs:{field:"noteName",title:"附注名称","min-width":"100","edit-render":{name:"input"},fixed:"left"}}),e._v(" "),i("vxe-table-column",{attrs:{field:"colName",title:"报表科目","min-width":"150","edit-render":{name:"input"},fixed:"left"}}),e._v(" "),i("vxe-table-column",{attrs:{field:"auditedAmount",title:"审定数","min-width":"200","edit-render":{name:"input"},formatter:e.commafyFn,align:e.allAlign,"header-align":"center"}}),e._v(" "),i("vxe-table-column",{attrs:{field:"preAuditAmount",title:"年初数","min-width":"200","edit-render":{name:"input"},formatter:e.commafyFn,align:e.allAlign,"header-align":"center"}}),e._v(" "),i("vxe-table-column",{attrs:{field:"curCheck",title:"本期校验","min-width":"200","edit-render":{name:"input"},formatter:e.commafyFn,align:e.allAlign,"header-align":"center"},scopedSlots:e._u([{key:"header",fn:function(t){var s=t.column;return[i("span",[e._v(e._s(s.title))]),e._v(" "),i("span",{staticClass:"custom-sort"},[i("i",{class:[e.isShort?"vxe-icon--caret-bottom":"vxe-icon--caret-top"],on:{click:function(t){return e.preCheckSort("curCheck")}}})])]}}])}),e._v(" "),i("vxe-table-column",{attrs:{field:"preCheck",title:"上期校验","min-width":"200","edit-render":{name:"input"},formatter:e.commafyFn,align:e.allAlign,"header-align":"center"},scopedSlots:e._u([{key:"header",fn:function(t){var s=t.column;return[i("span",[e._v(e._s(s.title))]),e._v(" "),i("span",{staticClass:"custom-sort",class:{"is-order":e.isPreCheckSort}},[i("i",{class:[e.isPreCheckSort?"vxe-icon--caret-bottom":"vxe-icon--caret-top"],on:{click:function(t){return e.preCheckSort("preCheck")}}})])]}}])}),e._v(" "),i("vxe-table-column",{attrs:{field:"isCompleteNow",title:"状态","min-width":"80"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return t.rowIndex,["1"===s.isCompleteNow?i("span",[e._v("加载完成")]):"0"===s.isCompleteNow?i("span",[e._v("加载中")]):e._e()]}}])}),e._v(" "),i("vxe-table-column",{attrs:{field:"isForbid",title:"禁用","min-width":"80"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row,o=t.rowIndex;return[i("el-checkbox",{attrs:{checked:"1"===s.isForbid},on:{change:function(t){return e.isDisabledAndFinished(s,o,"forbid")}}})]}}])}),e._v(" "),i("vxe-table-column",{attrs:{field:"isEdited",title:"已编辑","min-width":"80"},scopedSlots:e._u([{key:"default",fn:function(e){var t=e.row;return e.rowIndex,[i("el-checkbox",{attrs:{checked:"1"===t.isEdited,disabled:""}})]}}])}),e._v(" "),i("vxe-table-column",{attrs:{field:"isFinished",title:"已完成","min-width":"80"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row,o=t.rowIndex;return[i("el-checkbox",{attrs:{checked:"1"===s.isFinished},on:{change:function(t){return e.isDisabledAndFinished(s,o,"finish")}}})]}}])}),e._v(" "),i("vxe-table-column",{attrs:{field:"__ulastUpdatedUserName",title:"更新人","min-width":"80"}}),e._v(" "),i("vxe-table-column",{attrs:{field:"lastUpdateDate",title:"更新时间","min-width":"160"}})],1)],1)]),e._v(" "),e.isOpenDrawer?i("Postill",{ref:"postill",attrs:{menuID:e.menuID,activeLabel:e.activeLabel,limitArr:e.limitArr},on:{closePostill:e.closePostill,isPostil:e.isPostil}}):e._e()],1),e._v(" "),i("el-dialog",{attrs:{title:"编辑",visible:e.editDialogVisible,width:"30%"},on:{"update:visible":function(t){e.editDialogVisible=t}}},[i("div",{staticClass:"editDialogContent"},[e._v("\n            附注名称:\n            "),i("el-input",{staticStyle:{width:"80%"},attrs:{type:"text"},model:{value:e.modifyNoteName,callback:function(t){e.modifyNoteName=t},expression:"modifyNoteName"}})],1),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"info",size:"small"},on:{click:function(t){e.editDialogVisible=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.submitEditInfo}},[e._v("确 定")])],1)]),e._v(" "),i("el-dialog",{attrs:{title:"上传页面",visible:e.uploadDialogVisible,"destroy-on-close":!0,width:"35%"},on:{"update:visible":function(t){e.uploadDialogVisible=t},close:e.cancelUpload}},[i("div",{staticClass:"updateBox"},[i("el-input",{staticStyle:{width:"300px",marginright:"20px"},attrs:{type:"text"},model:{value:e.excelName,callback:function(t){e.excelName=t},expression:"excelName"}}),e._v(" "),i("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"uploadExcel",attrs:{type:"file",id:"uploadExcel",accept:".xlsx"},on:{change:e.readExcel}}),e._v(" "),i("el-button",{staticClass:"btnText uploadBtn",attrs:{type:"primary"},on:{click:e.importExcel}},[i("i",{staticClass:"el-icon-folder-opened"}),e._v("浏览\n            ")])],1),e._v(" "),i("div",{staticClass:"buttonList"},[i("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.confirUpload}},[e._v("确定")]),e._v(" "),i("el-button",{attrs:{type:"info",size:"small"},on:{click:e.cancelUpload}},[e._v("取消")])],1)]),e._v(" "),i("counter",{ref:"counter",attrs:{count:e.number},on:{clear:e.clear}})],1)},staticRenderFns:[]};var h=i("VU/8")(d,m,!1,function(e){i("PlF3"),i("J0Up")},"data-v-c0e592f0",null);t.default=h.exports},J0Up:function(e,t){},PlF3:function(e,t){}});