import{i as B}from"./index.9441d5d2.js";import{d as _,U as R,h as I,L as T,j as L,s as O,u as M,r as u,o as w,b as S,i as s,D as V,l as U,N as W,M as z,E as H,x as C,y,t as J}from"./vendor.7005e464.js";var F=_({components:{UploadOutlined:R},props:{chartsCode:String,onChangeChartData:Function},setup(e,{attrs:n,slots:m,emit:h}){const{ctx:p,proxy:a}=L(),l=I(!1),t=I(""),{onChangeChartData:c}=a,r=I([]),k=I(""),f=(o,i,d)=>{k.value="/Faith/cusReport/CusReportRiskJ.uploadRemarkFile.json",t.value=o,l.value=!0,r.value=i?[{name:d,status:"done",uid:Date.now(),response:{data:{path:i,name:d}}}]:[]},$=o=>{if(t.value==""||t.value==null)return a.$toast.warning("\u60A8\u672A\u586B\u5199\u5907\u6CE8\u5185\u5BB9"),!1;{const i=r.value[0];a.$faithApi.saveQuotaRemark({param1:o,param2:t.value,param3:i?i.response.data[0].path:"",param4:i?i.response.data[0].name:""}).then(d=>{if(d.success){a.$toast.success("\u7F16\u8F91\u6210\u529F");const E=(d.data||[]).find(N=>N.chartCode===o);c(E)}else a.$toast.error(d.resultInfo.statusText)}).catch(d=>{console.log(d)})}l.value=!1},A=o=>{if(!(o.type==="image/jpeg"||o.type==="image/png"||o.type==="image/jpg"||o.type==="application/pdf"||o.type==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"))return a.$toast.error("\u4EC5\u652F\u6301jpeg\u3001png\u3001jpg\u3001xlsx\u3001pdf\u683C\u5F0F"),!1;if(!(o.size/1024/1024<30))return a.$toast.error("\u5927\u5C0F\u4E0D\u80FD\u8D85\u8FC730MB!"),!1};let v=sessionStorage.getItem("customerId"),b=sessionStorage.getItem("projectId"),g=sessionStorage.getItem("projectYear");return{onRmove:()=>{r.value=[]},uploadData:{lockCustomerId:v,lockProjectId:b,lockYyyy:g,menuId:"40000077"},anomalyVisible:l,showAnomaly:f,anomalyOk:$,remarksVal:t,anomaFileList:r,anomaChange:o=>{o.file.status==="uploading"&&(r.value=o.fileList),o.file.status==="done"&&(r.value=[o.fileList.slice().filter(i=>i.status==="done").pop()],T.success(`${o.file.name} \u4E0A\u4F20\u6210\u529F`))},beforeUploadPort:A,uploadUrl:k}}});const D=V();O("data-v-dbe95abc");const Y=U(" \u4E0A\u4F20\u9644\u4EF6 ");M();const q=D((e,n)=>{const m=u("bdo-a-textarea"),h=u("upload-outlined"),p=u("bdo-a-button"),a=u("bdo-a-upload"),l=u("bdo-a-modal");return w(),S("div",null,[s(l,{visible:e.anomalyVisible,"onUpdate:visible":n[2]||(n[2]=t=>e.anomalyVisible=t),title:"\u7F16\u8F91\u5907\u6CE8",onOk:n[3]||(n[3]=t=>e.anomalyOk(e.chartsCode))},{default:D(()=>[s(m,{value:e.remarksVal,"onUpdate:value":n[1]||(n[1]=t=>e.remarksVal=t),placeholder:"\u8BF7\u586B\u5199\u5907\u6CE8\u5185\u5BB9",rows:3},null,8,["value"]),s(a,{"file-list":e.anomaFileList,name:"file","before-upload":e.beforeUploadPort,action:e.uploadUrl,data:e.uploadData,onChange:e.anomaChange,remove:e.onRmove},{default:D(()=>[s(p,{class:"anomaStyle"},{default:D(()=>[s(h),Y]),_:1})]),_:1},8,["file-list","before-upload","action","data","onChange","remove"])]),_:1},8,["visible"])])});F.render=q;F.__scopeId="data-v-dbe95abc";var j=_({props:{chartsCode:String,remarks:String,remarksId:String,onChangeChartData:Function},setup(e,{attrs:n,slots:m,emit:h}){const{ctx:p,proxy:a}=L(),{onChangeChartData:l}=a,{remarksId:t}=W(e);return{deleteMaly:()=>{z.confirm({title:"\u786E\u8BA4",icon:s(H),content:`\u786E\u8BA4\u5220\u9664${e.remarks}`,okText:"\u786E\u8BA4",cancelText:"\u53D6\u6D88",onOk(){a.$faithApi.delRemark({param1:t.value}).then(r=>{if(r.success){a.$toast.success("\u5220\u9664\u6210\u529F");const k=(r.data||[]).find(f=>f.chartCode===e.chartsCode);l(k)}else a.$toast.error(r.resultInfo.statusText)}).catch(r=>{console.log(r)})}})}}}});function Q(e,n){return w(),S("div")}j.render=Q;var P=_({components:{anomalyModal:F,deleanoMaly:j},props:["id","data","updateChartData"],data(){return{height:300,width:200,tooltip:"",flagShow:!1,chartsCode:"",remarks:"",visible:!1,remarksId:"",remarksName:"",remarksPath:""}},watch:{data:{handler(e){e&&this.randerChart(e.data,e.footer,null,e.width,e.height,e.title,e.chartDisp,e.flagIndex,e.chartCode,e.quotaDisp,e.deleteAutoId,e.remarkName,e.remarkPath)},immediate:!0}},methods:{randerChart(e,n,m,h,p,a,l,t,c,r,k,f,$){t&&t=="anomaly"&&(this.flagShow=!0),this.tooltip=l,this.width=h,this.height=p,this.chartsCode=c,this.remarks=r,this.remarksId=k,this.remarksName=f,this.remarksPath=$,this.$nextTick(()=>{B(document.getElementById(this.id+"chart")).setOption({title:{text:a,textStyle:{fontSize:14}},tooltip:{trigger:"axis",formatter(v){var b=`${v[0].name} <br/>`;for(let g of v)g.value&&(b+=`<span style="background: ${g.color}; height:10px; width: 10px; border-radius: 50%;display: inline-block;margin-right:10px;"></span> ${g.seriesName} \uFF1A${g.value}%<br/>`);return b}},legend:{data:m,top:20},grid:{left:"5%",right:"10%",bottom:"10%",containLabel:!0},toolbox:{feature:{saveAsImage:{title:"\u4FDD\u5B58"}}},xAxis:{type:"category",data:n,nameTextStyle:{fontSize:14,lineHeight:20,fontWeight:"bold",verticalAlign:"top",width:50,align:"middle"},name:"",nameLocation:"middle",axisLabel:{interVal:0,rotate:-40}},yAxis:{type:"value",axisLabel:{formatter:"{value} %"}},series:e})})},anomalyWay(){this.$refs.anomalysModal.showAnomaly(this.remarks,this.remarksPath,this.remarksName)},onChangeChartData(e){!e||(e.remarkVo==null?(this.remarks="",this.remarksName="",this.remarksPath="",this.remarksId="",this.$emit("updateChartData",null)):(this.remarks=e.remarkVo.remark||"",this.remarksName=e.remarkVo.name||"",this.remarksPath=e.remarkVo.path||"",this.remarksId=e.remarkVo.autoId||"",this.$emit("updateChartData",e)))},deleteConfirm(){this.$refs.delesano.deleteMaly()},downLink(){this.$faithApi.previewFile({param1:this.remarksPath,param2:this.remarksName})}},created(){},mounted(){}});const x=V();O("data-v-3050b98e");const G={class:"broken"},K={class:"main1"};M();const X=x((e,n,m,h,p,a)=>{const l=u("bdo-icon"),t=u("anomaly-modal"),c=u("deleano-maly");return w(),S("div",G,[s("div",K,[s("div",null,[s("div",{id:e.id+"chart",style:{height:e.height+"px",width:e.width+"px"}},null,12,["id"]),s("p",{class:"tool",innerHTML:e.tooltip},null,8,["innerHTML"]),C(s("a",{onClick:n[1]||(n[1]=(...r)=>e.anomalyWay&&e.anomalyWay(...r)),class:"anomalyStyle"},J(e.remarks),513),[[y,e.flagShow&&e.remarks!=""]]),C(s(l,{class:"editOut",style:{"margin-left":"2px"},onClick:e.anomalyWay,src:"EditOutlined",title:"\u7F16\u8F91\u5907\u6CE8"},null,8,["onClick"]),[[y,e.flagShow&&e.remarks!=""]]),C(s(l,{class:"editOut",style:{"margin-left":"5px"},onClick:e.anomalyWay,src:"EditOutlined",title:"\u7F16\u8F91\u5907\u6CE8"},null,8,["onClick"]),[[y,e.flagShow&&e.remarks==""]]),C(s(l,{onClick:e.downLink,class:"editOut",src:"LinkOutlined",title:"\u9644\u4EF6"},null,8,["onClick"]),[[y,e.flagShow&&e.remarks!=""&&e.remarksName!=""&&e.remarksPath!=""]]),C(s(l,{onClick:e.deleteConfirm,class:"deleteOut",src:"DeleteOutlined",title:"\u5220\u9664\u5907\u6CE8"},null,8,["onClick"]),[[y,e.flagShow&&e.remarks!=""]])])]),s(t,{chartsCode:e.chartsCode,ref:"anomalysModal",onChangeChartData:e.onChangeChartData},null,8,["chartsCode","onChangeChartData"]),s(c,{ref:"delesano",chartsCode:e.chartsCode,remarks:e.remarks,remarksId:e.remarksId,onChangeChartData:e.onChangeChartData},null,8,["chartsCode","remarks","remarksId","onChangeChartData"])])});P.render=X;P.__scopeId="data-v-3050b98e";export{P as _};
