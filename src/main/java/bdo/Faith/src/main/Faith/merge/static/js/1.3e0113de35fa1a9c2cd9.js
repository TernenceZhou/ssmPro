webpackJsonp([1,5,6,8,11,12,14,15,17],{"+dOl":function(e,t){},"/829":function(e,t){},"/XV9":function(e,t){},"/ZTP":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("woOf"),r=a.n(i),s=a("mvHQ"),o=a.n(s),n=a("ABj6"),l=a("ZHXk"),c=a.n(l),u=a("w/PL"),d=a("tNup"),m=a("de+t"),p=a("VzA3"),f=a("qcqk"),h={subjectName:"singleTrialBalance",props:{customerId:String,projectId:String,type:String},components:{BdoTable:n.a,AuditAjustment:d.default,SingleTB:m.default,Postill:p.a,counter:f.a},watch:{refreshPagesCollection:{handler:function(e){if(e&&e.refreshIndexes&&window.location.hash.indexOf("/checkTb")>-1){var t={key:this.setNum+=1,refreshIndexes:e.refreshIndexes};localStorage.setItem("refreshIndexes",o()(t)),this.refreshIndexes(e.refreshIndexes)}},immediate:!0,deep:!0}},data:function(){return{isOpenDrawer:!1,activeName:"tb",validItemList:[{prop:"checkCal",label:"校验项",filterOptions:{disabled:!0}},{prop:"unAuditAmount",label:"本年未审数",filterOptions:{disabled:!0}},{prop:"adjustAmount",label:"本年审计调整数",filterOptions:{disabled:!0}},{prop:"auditAmount",label:"本年审定数",filterOptions:{disabled:!0}},{prop:"preUnAuditAmount",label:"上年未审数",filterOptions:{disabled:!0}},{prop:"preAdjustAmount",label:"上年审计调整数",filterOptions:{disabled:!0}},{prop:"preAuditAmount",label:"上年审定数",filterOptions:{disabled:!0}}],validData:[],validDataModel:new u.a,curYear:this.$route.query.curYear,errorText:"校验不平",isErrorText:!1,setAlign:"center",setBorder:!0,tabsList:[{label:"试算平衡表",name:"tb",isMark:!1,menuID:"HB002-MC004-0001"},{label:"审计调整列表",name:"auditAjustment",isMark:!1,menuID:"HB002-MC004-0002"}],tbList:[],customerName:"",projectName:"",singleCustomerName:"",singleProjectName:"",_strArr:[],curProjectId:"",curCustomerId:"",setType:"QUERY_TB",validFail:!0,mainCustomerId:"",mainProjectId:"",limitArr:[],menuID:"",userId:"",activeLabel:"",refreshPagesCollection:{},setNum:0,number:0}},methods:{openDrawer:function(){this.isOpenDrawer=!0},closePostill:function(e){this.isOpenDrawer=e},isPostil:function(e){this.isPostilLink=!0},handleClick:function(e,t){var a=this;switch(this.activeLabel=e.label,this.activeName=e.name,e.name){case"tb":this.menuId="HB002-MC004-0001",this.tabsList[0].isMark=!1,this.refreshValidData(!0);break;case"auditAjustment":this.menuId="HB002-MC004-0002",this.tabsList[1].isMark=!1,this.$nextTick(function(){a.$refs.auditAjustment.offsetEntryInit()}),this.isResetValid(!0)}this.$store.commit("setSingleTBIndex",this.menuId),this.closePostill(!1),this.$router.push({name:"checkTb",query:{curYear:this.curYear,menuID:this.menuId}})},getPermission:function(){var e=this,t={menuId:"",sqlId:"DG00061",param1:this.projectName.split("-")[0],param2:this.customerName.split("-")[0]};this.$sacpApis.postillCheck(t).then(function(t){if(t.success){var a=t.data[0],i=[];if(a.manager==e.userId){i.push({status:"manager",limit:1})}if(a.signAccountant2==e.userId||a.signAccountant3==e.userId){i.push({status:"signAccountant2",limit:1})}if(a.audit1==e.userId){i.push({status:"audit1",limit:1})}if(a.audit2==e.userId){i.push({status:"audit2",limit:1})}if(a.reaReviewer==e.userId){i.push({status:"reaReviewer",limit:1})}if(a.signUser==e.userId){i.push({status:"signUser",limit:1})}if(a.reviewPartner==e.userId){i.push({status:"reviewPartner",limit:1})}if(a.issuedPeople==e.userId){i.push({status:"issuedPeople",limit:1})}e.limitArr=i}})},refreshValidData:function(e){e&&(this.handleValidItemData(),this.tbInit())},tbInit:function(){var e=this,t={customerId:this.curCustomerId,projectId:this.curProjectId,type:this.setType};this.$sacpApis.trialBalanceOrReportData(t).then(function(t){t.data&&(e.validItemList[1].label=e.curYear+"未审数",e.validItemList[2].label=e.curYear+"审计调整数",e.validItemList[3].label=e.curYear+"审定数",e.validItemList[4].label=e.curYear-1+"未审数",e.validItemList[5].label=e.curYear-1+"审计调整数",e.validItemList[6].label=e.curYear-1+"审定数",e.tbList=t.data)}).catch(function(t){e.$message.error(t)}).finally(function(){e.getPermission()})},queryURLParameter:function(e){var t={};return e.replace(/([^?&=]+)=([^?&=]+)/g,function(){t[arguments[1]]=arguments[2]}),t},handleValidItemData:function(){var e=this;this.validData=[];var t={projectId:this.curProjectId};this.$sacpApis.mergeScopeTbValidList(t).then(function(t){if(t.success){if(t.data){var a=t.data[t.data.length-1].checkFlag;e.validFail=a,e.isErrorText=!e.validFail}var i=t.data.slice(0,-1);for(var s in i){var o={};for(var n in r()(o,e.validDataModel,i[s]),o)if(0===o[n]){for(var l in e.validItemList)e.validItemList[l].prop==n&&(e.validItemList[l].align="center");o[n]="平"}else null===o[n]?o[n]=null:"checkCal"!=n&&(o[n]=c.a.commafy(o[n],{digits:2}));e.validData.push(o)}}else e.$message.error(t.resultInfo.statusText)}).catch(function(t){e.$message.error(t)}).finally(function(){})},commafy:function(e,t){return c.a.commafy(t,{digits:2})},handleCustomerInformation:function(){var e=JSON.parse(sessionStorage.getItem("curCustomerData"));this.customerName=e.curCustomerName,this.projectName=e.curProjectName,this.mainCustomerId=e.curCustomerId,this.mainProjectId=e.curProjectId,this.userId=e.userId,this.curYear=e.curYear;var t=JSON.parse(sessionStorage.getItem("projectItem"));-1!=t.mergeCustomerName.indexOf("-")?this.singleCustomerName=t.mergeCustomerName:this.singleCustomerName=t.mergeCustomerId+"-"+t.mergeCustomerName,this.singleProjectName=t.projectId,this._strArr=t.projectId.split("-"),this.curProjectId=this._strArr[0],this.curCustomerId=t.customerId,this.menuID=sessionStorage.getItem("menuID"),window.addEventListener("storage",this.storageEvent,!1)},initAgain:function(e){this.tbInit(),this.handleValidItemData()},isResetValid:function(e){e&&this.handleValidItemData()},refreshIndexes:function(e){if(e){this.tabsList.map(function(t){e.indexOf(t.menuID)>-1&&(t.isMark=!0)});var t=window.location.hash.split("="),a=this.tabsList.filter(function(e){return e.menuID===t[t.length-1]})[0]||{};a&&a.isMark&&this.handleClick(a)}},handlePostillLink:function(){var e=void 0,t=window.location.hash.split("/"),a=(t=t.pop()).split("&")[1].split("=")[1];"HB002-MC004-0001"==a?e={name:"tb",label:"试算平衡表"}:"HB002-MC004-0002"==a&&(e={name:"auditAjustment",label:"审计调整列表"}),this.handleClick(e)},storageEvent:function(){this.refreshPagesCollection=JSON.parse(localStorage.getItem("refreshIndexes"))},clear:function(e){this.number=e}},created:function(){this.handleCustomerInformation(),this.handlePostillLink()}},g={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-container",{staticClass:"container"},[a("el-header",[a("el-row",[a("el-col",{attrs:{span:1}},[a("div",{staticClass:"logo"})]),e._v(" "),a("el-col",{attrs:{span:7}},[a("div",{staticClass:"customerInformation"},[a("p",[e._v("客户:"+e._s(this.customerName))]),e._v(" "),a("p",[e._v("项目:"+e._s(this.projectName))])])]),e._v(" "),a("el-col",{attrs:{span:7}},[a("div",{staticClass:"singleCustomerInformation"},[a("p",[e._v("子客户:"+e._s(this.singleCustomerName))]),e._v(" "),a("p",[e._v("子项目:"+e._s(this.singleProjectName))])])]),e._v(" "),a("el-col",{attrs:{span:1}},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"批注",placement:"top-start"}},[a("el-button",{staticClass:"postillBtn singlePostillBtn",attrs:{circle:"",size:"small",icon:"el-icon-edit-outline"},on:{click:e.openDrawer}})],1)],1)],1)],1),e._v(" "),a("el-main",[a("div",{staticClass:"checkReportTable"},[a("div",{staticClass:"validErrorInfo"},[a("span",{style:e.validFail?"color:#000":"color:red"},[e._v(e._s(e.validFail?"校验项":e.errorText))]),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"刷新校验列表",placement:"top-start"}},[a("i",{staticClass:"el-icon-refresh",staticStyle:{color:"#409eff"},on:{click:function(t){return e.refreshValidData(!0)}}})]),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.isErrorText?"关闭校验项列表":"打开校验项列表",placement:"right"}},[e.isErrorText?a("i",{staticClass:"el-icon-caret-top",on:{click:function(t){e.isErrorText=!1}}}):a("i",{staticClass:"el-icon-caret-bottom",on:{click:function(t){e.isErrorText=!0}}})])],1),e._v(" "),e.isErrorText?a("div",{staticClass:"validTable"},[a("bdo-table",{ref:"validItems",staticStyle:{width:"100%"},attrs:{"max-height":330,"align-center":"","show-overflow-tooltip":"","enable-filter":!1,"enable-view-type":!1,columns:e.validItemList,data:e.validData,"enable-toolbox":!1,showIndexColumn:!0,showCheckBox:!1,heightLight:!1,headerListConfig:!1,headerCellStyleSelf:{"text-align":"center"},setBorder:e.setBorder},scopedSlots:e._u([{key:"col-unAuditAmount",fn:function(t){return[a("span",{style:{textAlign:"平"==t.row.unAuditAmount?"center":"right",color:"平"==t.row.unAuditAmount?"":"red",display:"block"}},[e._v("\n                            "+e._s(t.row.unAuditAmount))])]}},{key:"col-adjustAmount",fn:function(t){return[a("span",{style:{textAlign:"平"==t.row.adjustAmount?"center":"right",color:"平"==t.row.adjustAmount?"":"red",display:"block"}},[e._v("\n                            "+e._s(t.row.adjustAmount))])]}},{key:"col-auditAmount",fn:function(t){return[a("span",{style:{textAlign:"平"==t.row.auditAmount?"center":"right",color:"平"==t.row.auditAmount?"":"red",display:"block"}},[e._v("\n                            "+e._s(t.row.auditAmount))])]}},{key:"col-preUnAuditAmount",fn:function(t){return[a("span",{style:{textAlign:"平"==t.row.preUnAuditAmount?"center":"right",color:"平"==t.row.preUnAuditAmount?"":"red",display:"block"}},[e._v("\n                            "+e._s(t.row.preUnAuditAmount))])]}},{key:"col-preAdjustAmount",fn:function(t){return[a("span",{style:{textAlign:"平"==t.row.preAdjustAmount?"center":"right",color:"平"==t.row.preAdjustAmount?"":"red",display:"block"}},[e._v("\n                            "+e._s(t.row.preAdjustAmount))])]}},{key:"col-preAuditAmount",fn:function(t){return[a("span",{style:{textAlign:"平"==t.row.preAuditAmount?"center":"right",color:"平"==t.row.preAuditAmount?"":"red",display:"block"}},[e._v("\n                            "+e._s(t.row.preAuditAmount))])]}}],null,!1,2190302729)})],1):e._e(),e._v(" "),a("el-tabs",{staticClass:"indexTabs",on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(e.tabsList,function(t){return a("el-tab-pane",{key:t.index,attrs:{label:t.label,name:t.name}},[a("span",{attrs:{slot:"label"},slot:"label"},[t.isMark?a("el-badge",{staticClass:"item",attrs:{"is-dot":""}}):e._e(),e._v("\n                        "+e._s(t.label)+"\n                    ")],1)])}),1),e._v(" "),"tb"==e.activeName?a("SingleTB",{ref:"singleTB",attrs:{tbList:e.tbList},on:{isInit:e.initAgain,refreshIndexes:e.refreshIndexes}}):a("AuditAjustment",{ref:"auditAjustment",attrs:{singleProjectId:e.curProjectId},on:{isResetValid:e.isResetValid,refreshIndexes:e.refreshIndexes}})],1)]),e._v(" "),e.isOpenDrawer?a("Postill",{ref:"postill",attrs:{menuID:e.menuID,activeLabel:e.activeLabel,limitArr:e.limitArr},on:{closePostill:e.closePostill,isPostil:e.isPostil}}):e._e(),e._v(" "),a("counter",{ref:"counter",attrs:{count:e.number},on:{clear:e.clear}})],1)},staticRenderFns:[]};var b=a("VU/8")(h,g,!1,function(e){a("fhrh")},null,null);t.default=b.exports},"0+Rn":function(e,t){},"0CTG":function(e,t){},"2NXm":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("mvHQ"),r=a.n(i),s=a("pFYg"),o=a.n(s),n=a("Dd8w"),l=a.n(n),c=a("ABj6"),u=a("2WPG"),d={name:"trialBalanceAndAuditReport",components:{BdoTable:c.a},props:{customerId:String,projectId:String,showTb:{type:Boolean,default:!0},showReport:{type:Boolean,default:!0}},data:function(){return{activeName:"A",oqColumns:[],rpColumns:[{prop:"subjectId",label:"科目编号",width:"150px",fixed:"left",filterOptions:{disabled:!0}},{prop:"subjectName",label:"科目名称",fixed:"left",width:"300px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.replaceSpaces}},{prop:"auditAmount",label:"本年审定数",filterOptions:{disabled:!0}},{prop:"preAuditAmount",label:"上年审定数",filterOptions:{disabled:!0}}],cashColumns:[{prop:"subjectId",label:"科目编号",width:"150px",fixed:"left",filterOptions:{disabled:!0}},{prop:"subjectName",label:"科目名称",fixed:"left",width:"300px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.replaceSpaces}},{prop:"curAmount",label:"本年审定数",filterOptions:{disabled:!0}},{prop:"preAmount",label:"上年审定数",filterOptions:{disabled:!0}}],A:[],S:[],F:[],G:[],LG:[],TB:[]}},methods:{replaceSpaces:function(e){return e},selectTab:function(e,t){this.activeName=e.name}},created:function(){var e=this;this.$sacpApis.auditReport({customerId:this.customerId,projectId:this.projectId,type:this.$constantVar.MERGE_FUNCTION_TYPE.QUERY_ALL_SUMMARY}).then(function(t){for(var a=0;a<t.length;a++){var i=t[a];i.hasOwnProperty("titleColumn")&&(e.oqColumns=i.titleColumn,e.G=i.G,e.LG=i.LG),i.hasOwnProperty("tb")&&(e.A=i.A,e.S=i.S,e.F=i.F,e.TB=i.tb,e.TB.sort(function(e,t){return e.sortNo-t.sortNo}))}}).catch(function(t){return e.$message.error(t)})}},m={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-tabs",{attrs:{"default-active":"A",tabPosition:"top"},on:{"tab-click":e.selectTab},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[e.showTb?a("el-tab-pane",{attrs:{label:"试算平衡表",name:"TB"}},[a("bdo-table",{staticStyle:{width:"100%"},attrs:{columns:e.rpColumns,data:e.TB,"enable-filter":!1,"enable-toolbox":!1,"enable-view-type":!1,"page-total":e.TB.length,"responsive-height-gap":350,showIndexColumn:!1,"show-overflow-tooltip":""},scopedSlots:e._u([{key:"col-auditAmount",fn:function(t){return null==t.row.auditAmount||void 0===t.row.auditAmount?[e._v("\n                0\n            ")]:void 0}},{key:"col-preAuditAmount",fn:function(t){return null==t.row.preAuditAmount||void 0===t.row.preAuditAmount?[e._v("\n                0\n            ")]:void 0}}],null,!0)})],1):e._e(),e._v(" "),a("el-tab-pane",{attrs:{label:"资产负债表",name:"A"}},[a("bdo-table",{staticStyle:{width:"100%"},attrs:{columns:e.rpColumns,data:e.A,"enable-filter":!1,"enable-toolbox":!1,"enable-view-type":!1,"page-total":e.A.length,"responsive-height-gap":350,showIndexColumn:!1,"show-overflow-tooltip":""},scopedSlots:e._u([{key:"col-auditAmount",fn:function(t){return null==t.row.auditAmount||void 0===t.row.auditAmount?[e._v("\n                0\n            ")]:void 0}},{key:"col-preAuditAmount",fn:function(t){return null==t.row.preAuditAmount||void 0===t.row.preAuditAmount?[e._v("\n                0\n            ")]:void 0}}],null,!0)})],1),e._v(" "),a("el-tab-pane",{attrs:{label:"利润表",name:"S"}},[a("bdo-table",{staticStyle:{width:"100%"},attrs:{columns:e.rpColumns,data:e.S,"enable-filter":!1,"enable-toolbox":!1,"enable-view-type":!1,"page-total":e.S.length,"responsive-height-gap":350,showIndexColumn:!1,"show-overflow-tooltip":""},scopedSlots:e._u([{key:"col-subjectName",fn:function(t){return[a("pre",[e._v(e._s(t.row.subjectName))])]}},{key:"col-auditAmount",fn:function(t){return null==t.row.auditAmount||void 0===t.row.auditAmount?[e._v("\n                0\n            ")]:void 0}},{key:"col-preAuditAmount",fn:function(t){return null==t.row.preAuditAmount||void 0===t.row.preAuditAmount?[e._v("\n                0\n            ")]:void 0}}],null,!0)})],1),e._v(" "),a("el-tab-pane",{attrs:{label:"现金流量表",name:"F"}},[a("bdo-table",{staticStyle:{width:"100%"},attrs:{columns:e.cashColumns,data:e.F,"enable-filter":!1,"enable-toolbox":!1,"enable-view-type":!1,"page-total":e.F.length,"responsive-height-gap":350,showIndexColumn:!1,"show-overflow-tooltip":""},scopedSlots:e._u([{key:"col-subjectName",fn:function(t){return[a("pre",[e._v(e._s(t.row.subjectName))])]}},{key:"col-curAmount",fn:function(t){return null==t.row.curAmount||void 0===t.row.curAmount?[e._v("\n                0\n            ")]:void 0}},{key:"col-preAmount",fn:function(t){return null==t.row.preAmount||void 0===t.row.preAmount?[e._v("\n                0\n            ")]:void 0}}],null,!0)})],1),e._v(" "),a("el-tab-pane",{attrs:{label:"所有者权益变动表（本期）",name:"G"}},[a("bdo-table",{staticStyle:{width:"100%"},attrs:{columns:e.oqColumns,data:e.G,"enable-filter":!1,"enable-toolbox":!1,"enable-view-type":!1,"page-total":e.G.length,"responsive-height-gap":350,showIndexColumn:!1,"show-overflow-tooltip":""},scopedSlots:e._u([{key:"col-colDisp",fn:function(t){return[a("pre",[e._v(e._s(t.row.colDisp))])]}}])})],1),e._v(" "),a("el-tab-pane",{attrs:{label:"所有者权益变动表（上期）",name:"LG"}},[a("bdo-table",{staticStyle:{width:"100%"},attrs:{columns:e.oqColumns,data:e.LG,"enable-filter":!1,"enable-toolbox":!1,"enable-view-type":!1,"page-total":e.LG.length,"responsive-height-gap":350,showIndexColumn:!1,"show-overflow-tooltip":""},scopedSlots:e._u([{key:"col-colDisp",fn:function(t){return[a("pre",[e._v(e._s(t.row.colDisp))])]}}])})],1)],1)},staticRenderFns:[]};var p=a("VU/8")(d,m,!1,function(e){a("qN8/")},"data-v-439fb212",null).exports,f=a("/ZTP"),h=a("ySjk"),g=a("sImP"),b=(a("I/JX"),a("w/PL")),v=a("ECGi"),C=a("j5fz"),y=a("UHag"),I=a("fH//"),x=a("e6WU"),w={name:"mergeReport",components:{balanceSheet:v.default,profitStatement:C.default,statementOfCashFlow:y.default,statementOfChangeInEquityCur:I.default,statementOfChangeInEquityLast:x.default,BdoTable:c.a},props:{customerId:String,projectId:String,customerData:Array},data:function(){return{currentTabComponent:"balanceSheet",activeName:"balanceSheet",tabPaneList:[{label:"合并资产负债表",name:"balanceSheet"},{label:"合并利润表",name:"profitStatement"},{label:"合并现金流量表",name:"statementOfCashFlow"},{label:"合并所有者权益变动表（本期）",name:"statementOfChangeInEquityCur"},{label:"合并所有者权益变动表（上期）",name:"statementOfChangeInEquityLast"}],validColumns:[{prop:"validItem",label:"校验项",filterOptions:{disabled:!0}},{prop:"auditAmount",label:"本年审定数",filterOptions:{disabled:!0},formatter:{type:"function",value:this.commafy}},{prop:"preAuditAmount",label:"上年审定数",filterOptions:{disabled:!0},formatter:{type:"function",value:this.commafy}}],validData:[],fullscreenLoading:!1,errorText:"校验错误信息",isErrorText:!1,oqColumns:[],A:[],S:[],F:[],G:[],LG:[],TB:[],validDataModel:new b.a}},methods:{handleClick:function(e){var t=this.tabPaneList.filter(function(t){return t.name==e.name});this.currentTabComponent=t[0].name},replaceSpaces:function(e){return e},selectTab:function(e,t){this.activeName=e.name},mergeReportInit:function(){var e=this;this.fullscreenLoading=!0,this.$sacpApis.auditReport({customerId:this.customerData[0].curCustomerId,projectId:this.customerData[0].curProjectId,type:this.$constantVar.MERGE_FUNCTION_TYPE.QUERY_ALL_SUMMARY}).then(function(t){for(var a=0;a<t.length;a++){var i=t[a];i.hasOwnProperty("titleColumn")&&(e.oqColumns=i.titleColumn,e.G=i.G,e.LG=i.LG),i.hasOwnProperty("tb")&&(e.A=i.A,e.S=i.S,e.F=i.F,e.TB=i.tb,e.TB.sort(function(e,t){return e.sortNo-t.sortNo}))}}).catch(function(){return e.$message.error(err)}).finally(function(){e.fullscreenLoading=!1})},commafy:function(e){XEUtils.commafy(e,{digits:2})}},created:function(){this.mergeReportInit()}},D={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"mergeReport"},[a("div",{staticClass:"validErrorInfo"},[a("span",{style:e.errorText?"color:red":"color:#000"},[e._v(e._s(e.errorText?e.errorText:"校验项"))]),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.isErrorText?"关闭校验项列表":"打开校验项列表",placement:"right"}},[e.isErrorText?a("i",{staticClass:"el-icon-caret-top",on:{click:function(t){e.isErrorText=!1}}}):a("i",{staticClass:"el-icon-caret-bottom",on:{click:function(t){e.isErrorText=!0}}})])],1),e._v(" "),e.isErrorText?a("div",{staticClass:"validTable"},[a("bdo-table",{staticStyle:{width:"100%"},attrs:{columns:e.validColumns,data:e.validData,"max-height":330,"enable-filter":!1,"enable-toolbox":!1,"enable-view-type":!1,"responsive-height-gap":450,showIndexColumn:!1,showCheckBox:!1,enableHeadConfig:!1,headerListConfig:!1,"show-overflow-tooltip":"",headerCellStyleSelf:{"text-align":"center"}}})],1):e._e(),e._v(" "),a("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(this.tabPaneList,function(t){return a("el-tab-pane",{key:t.index,attrs:{label:t.label,name:t.name}},[a("keep-alive",[a(e.currentTabComponent,{ref:"mergeReportContent",refInFor:!0,tag:"component"})],1)],1)}),1)],1)},staticRenderFns:[]};var S=a("VU/8")(w,D,!1,function(e){a("UF/e")},"data-v-56c5a7f2",null).exports,T=a("UVLa"),k=a("hgw/"),j=a("YA3s"),_=a("VzA3"),F=(a("7+uW"),a("ZHXk")),$=a.n(F),N=a("AOE1"),L=(a("30bX"),a("NYxO")),A=a("0RKR"),P=(a("STzw"),a("qcqk")),M={name:"MergeRangeModal",props:{tableData:{type:Array,default:[]},subjectData:{type:Array,default:[]}},components:{},watch:{index:{handler:function(e,t){this.$emit("send",e)},immediate:!0,deep:!0},fixedAssetsText:function(e){this.$refs.fixedAssetsTree.filter(e)},intangibleAssetsText:function(e){this.$refs.intangibleAssetsTree.filter(e)},prepaidExpensesText:function(e){this.$refs.prepaidExpensesTree.filter(e)}},data:function(){var e=function(e,t,a){""==t||isNaN(t)?a(new Error("请输入正确的数值")):!isNaN(t)&&(parseFloat(t).toFixed(2)<0||parseFloat(t).toFixed(2)>100)?a(new Error("请输入正确的数值")):a()};return{fullscreenLoading:!1,mergeRangeDialog:!1,mergeActiveName:"ageRange",agingRange:!0,fixedAssets:!1,tangibleAssets:!1,prepaidExpenses:!1,formLabelWidth:"150px",index:0,param:"",autoId:"",updatefixedAssetsDialog:!1,updateIntangibleDialog:!1,updatePrepaidDialog:!1,fixedAssetsText:"",intangibleAssetsText:"",prepaidExpensesText:"",depreciationMethodList:[],depreciationOptions:[],toYearlyDepreciation:"",toRatioRemainingValue:"",toDepreciationMethod:"",dataType:"",subData:[],subjectId:"",subjectProps:{label:"subjectName",children:"children"},mergeTabList:[{label:"账龄区间确认",name:"ageRange"},{label:"固定资产折旧年限",name:"depreciatAssets"},{label:"无形资产摊销",name:"amortizatAssets"},{label:"长期待摊费用",name:"prepaidExpenses"}],subjectName:"",fixedAssetsForm:{subjectName:"",depreciationMethod:"",depreciableLife:"",ratioRemainingValue:"",yearlyDepreciation:""},intangibleAssetsForm:{subjectName:"",depreciationMethod:"",depreciableLife:"",ratioRemainingValue:"",according:""},prepaidExpensesForm:{subjectName:"",depreciationMethod:"",depreciableLife:"",according:""},mergeScopedEditFormRule:{depreciationMethod:[{required:!0,message:"折旧(摊销)方法不能为空",trigger:"blur"}],depreciableLife:[{required:!0,message:"折旧年限(使用寿命)不能为空",trigger:"blur"},{validator:e,trigger:"change"}],ratioRemainingValue:[{required:!0,message:"残值率不能为空",trigger:"blur"},{validator:e,trigger:"change"}],yearlyDepreciation:[{required:!0,message:"年折旧率不能为空",trigger:"blur"},{validator:e,trigger:"change"}],according:[{required:!0,message:"依据不能为空",trigger:"blur"}],subjectName:[{required:!0,message:"项目不能为空",trigger:"blur"}]}}},methods:{openDialog:function(){this.mergeRangeDialog=!0},handleClick:function(e,t){0==e.index&&(this.agingRange=!0,this.fixedAssets=!1,this.tangibleAssets=!1,this.prepaidExpenses=!1,this.index=e.index),1==e.index&&(this.agingRange=!1,this.fixedAssets=!0,this.tangibleAssets=!1,this.prepaidExpenses=!1,this.index=e.index),2==e.index&&(this.agingRange=!1,this.fixedAssets=!1,this.tangibleAssets=!0,this.prepaidExpenses=!1,this.index=e.index),3==e.index&&(this.agingRange=!1,this.fixedAssets=!1,this.tangibleAssets=!1,this.prepaidExpenses=!0,this.index=e.index)},editRow:function(e,t){console.log(this.subData,"SUBDATA"),this.depreciationMethodList=this.$DIC("固定资产折旧方法"),this.depreciationOptions=this.$DIC("固定资产折旧方法"),1==e&&(this.updatefixedAssetsDialog=!0,this.fixedAssetsForm.subjectName=t.subjectName,this.fixedAssetsForm.depreciableLife=t.depreciableLife,this.fixedAssetsForm.depreciationMethod=t.depreciationMethod,this.fixedAssetsForm.ratioRemainingValue=t.ratioRemainingValue.replace("%",""),this.fixedAssetsForm.according=t.according,this.fixedAssetsForm.yearlyDepreciation=t.yearlyDepreciation.replace("%",""),this.autoId=t.autoId),2==e&&(this.updateIntangibleDialog=!0,this.intangibleAssetsForm.subjectName=t.subjectName,this.intangibleAssetsForm.depreciableLife=t.depreciableLife,this.intangibleAssetsForm.depreciationMethod=t.depreciationMethod,this.intangibleAssetsForm.ratioRemainingValue=t.ratioRemainingValue.replace("%",""),this.intangibleAssetsForm.yearlyDepreciation=t.yearlyDepreciation.replace("%",""),this.intangibleAssetsForm.according=t.according,this.autoId=t.autoId),3==e&&(this.updatePrepaidDialog=!0,this.prepaidExpensesForm.subjectName=t.subjectName,this.prepaidExpensesForm.depreciableLife=t.depreciableLife,this.prepaidExpensesForm.depreciationMethod=t.depreciationMethod,this.autoId=t.autoId)},saveEditBtn:function(e,t){var a=this,i=sessionStorage.getItem("curCustomerData"),r=JSON.parse(i),s=r.curCustomerId,o=r.curProjectId;this.$refs[t].validate(function(t){if(!t)return!1;if(1==e){var i=a.depreciationMethodList.find(function(e){return isNaN(a.fixedAssetsForm.depreciationMethod-0)?e.label==a.fixedAssetsForm.depreciationMethod:e.value==a.fixedAssetsForm.depreciationMethod});a.toDepreciationMethod=i.value,a.toRatioRemainingValue=Math.round(100*a.fixedAssetsForm.ratioRemainingValue)/1e4||"",a.toYearlyDepreciation=Math.round(100*a.fixedAssetsForm.yearlyDepreciation)/1e4||"";var r={autoId:a.autoId,subjectId:a.subjectId,subjectName:a.fixedAssetsForm.subjectName,depreciationMethod:a.toDepreciationMethod,depreciableLife:a.fixedAssetsForm.depreciableLife,ratioRemainingValue:a.toRatioRemainingValue,yearlyDepreciation:a.toYearlyDepreciation,dataType:0,projectId:o,customerId:s};a.param=r}if(2==e){var n=a.depreciationMethodList.find(function(e){return isNaN(a.intangibleAssetsForm.depreciationMethod-0)?e.label==a.intangibleAssetsForm.depreciationMethod:e.value==a.intangibleAssetsForm.depreciationMethod});a.toDepreciationMethod=n.value,a.toRatioRemainingValue=Math.round(100*a.intangibleAssetsForm.ratioRemainingValue)/1e4||"",a.toYearlyDepreciation=Math.round(100*a.intangibleAssetsForm.yearlyDepreciation)/1e4||"";var l={autoId:a.autoId,subjectId:a.subjectId,subjectName:a.intangibleAssetsForm.subjectName,depreciationMethod:a.toDepreciationMethod,depreciableLife:a.intangibleAssetsForm.depreciableLife,ratioRemainingValue:a.toRatioRemainingValue,according:a.intangibleAssetsForm.according,dataType:1,projectId:o,customerId:s};a.param=l}if(3==e){var c=a.depreciationMethodList.find(function(e){return isNaN(a.prepaidExpensesForm.depreciationMethod-0)?e.label==a.prepaidExpensesForm.depreciationMethod:e.value==a.prepaidExpensesForm.depreciationMethod});a.toDepreciationMethod=c.value,a.toRatioRemainingValue=Math.round(100*a.prepaidExpensesForm.ratioRemainingValue)/1e4||"",a.toYearlyDepreciation=Math.round(100*a.prepaidExpensesForm.yearlyDepreciation)/1e4||"";var u={autoId:a.autoId,subjectId:a.autoId,subjectName:a.prepaidExpensesForm.subjectName,depreciationMethod:a.toDepreciationMethod,depreciableLife:a.prepaidExpensesForm.depreciableLife,dataType:2,projectId:o,customerId:s};a.param=u}a.$sacpApis.updateSubjectRange(a.param).then(function(t){t.success?t&&(a.$message.success("保存成功"),1==e&&(a.updatefixedAssetsDialog=!1),2==e&&(a.updateIntangibleDialog=!1),3==e&&(a.updatePrepaidDialog=!1),a.$emit("changeTableData",e)):a.$message.error(t.resultInfo.statusText)}).catch(function(e){return a.$message.error(e)}).finally(function(){})})},deleteRow:function(e){var t=this;this.dataType=e.dataType,this.autoId=e.autoId,this.$XModal.confirm("您确定要删除吗?").then(function(e){"confirm"==e&&t.$sacpApis.deleteSubjectRange(t.autoId).then(function(e){e.success?e&&(t.$message.success("删除成功"),t.$emit("deleteTableData",t.dataType)):t.$message.error(e.resultInfo.statusText)}).catch(function(e){return t.$message.error(e)}).finally(function(){})})},handleCheckChange:function(e,t,a){console.log(e,t,a,"11")},handleNodeClick:function(e,t,a,i){console.log(i,e),1==i&&(this.fixedAssetsForm.subjectName=e.subjectName),2==i&&(this.intangibleAssetsForm.subjectName=e.subjectName),3==i&&(this.prepaidExpensesForm.subjectName=e.subjectName),this.subjectId=e.subjectId},filterNode:function(e,t){return console.log(e,t),!e||-1!==t.subjectName.indexOf(e)}},created:function(){},mounted:function(){this.subData=this.subjectData}},E={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"MergeRangeModal"},[a("el-tabs",{attrs:{type:"card"},on:{"tab-click":e.handleClick},model:{value:e.mergeActiveName,callback:function(t){e.mergeActiveName=t},expression:"mergeActiveName"}},e._l(e.mergeTabList,function(t,i){return a("el-tab-pane",{key:i,attrs:{label:t.label,name:t.name,height:"calc(100vh - 250px)"}},[a("el-table",{directives:[{name:"show",rawName:"v-show",value:e.agingRange,expression:"agingRange"}],ref:"ellTable",refInFor:!0,staticStyle:{width:"100%"},attrs:{"row-style":{height:"42px"},data:e.tableData,"cell-style":{padding:0},"header-cell-style":{background:"#fff"},border:"",height:"calc(100vh - 250px)","max-height":"500px"}},[a("el-table-column",{attrs:{prop:"name",label:"期末余额",align:"center",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{label:"账龄",align:"center"}},[a("el-table-column",{attrs:{prop:"name",label:"一个月以内",align:"center",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:"1个月-3个月",align:"center",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:"3个月-1年",align:"center",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:"1年-2年",align:"center",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:"2年以上",align:"center",width:"120"}})],1),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:"坏账准备","min-width":"120",align:"center"}})],1),e._v(" "),a("el-table",{directives:[{name:"show",rawName:"v-show",value:e.fixedAssets,expression:"fixedAssets"}],ref:"ellTable",refInFor:!0,staticStyle:{width:"100%"},attrs:{data:e.tableData,"row-style":{height:"42px"},"cell-style":{padding:0},border:"",height:"calc(100vh - 250px)","max-height":"500px"}},[a("el-table-column",{attrs:{prop:"subjectName",label:"操作",align:"center",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"编辑",placement:"top-start"}},[a("el-button",{attrs:{size:"mini",type:"success",icon:"el-icon-edit-outline normalWeight"},on:{click:function(a){return e.editRow(e.index,t.row)}}})],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"删除",placement:"top-start"}},[a("el-button",{attrs:{size:"mini",type:"danger",icon:"el-icon-close normalWeight"},on:{click:function(a){return e.deleteRow(t.row)}}})],1)]}}],null,!0)}),e._v(" "),a("el-table-column",{attrs:{prop:"subjectName",label:"类别",align:"center",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:"depreciationMethod",label:"折旧方法","min-width":"120",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"depreciableLife",label:"折旧年限(年)","min-width":"120",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"ratioRemainingValue",label:"残值率(%)","min-width":"120",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"yearlyDepreciation",label:"年折旧率(%)","min-width":"120",align:"center"}})],1),e._v(" "),a("el-table",{directives:[{name:"show",rawName:"v-show",value:e.tangibleAssets,expression:"tangibleAssets"}],ref:"ellTable",refInFor:!0,staticStyle:{width:"100%"},attrs:{data:e.tableData,"row-style":{height:"42px"},"cell-style":{padding:0},border:"",height:"calc(100vh - 250px)","max-height":"500px"}},[a("el-table-column",{attrs:{prop:"subjectName",label:"操作",align:"center",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"编辑",placement:"top-start"}},[a("el-button",{attrs:{size:"mini",type:"success",icon:"el-icon-edit-outline normalWeight"},on:{click:function(a){return e.editRow(e.index,t.row)}}})],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"删除",placement:"top-start"}},[a("el-button",{attrs:{size:"mini",type:"danger",icon:"el-icon-close normalWeight"},on:{click:function(a){return e.deleteRow(t.row)}}})],1)]}}],null,!0)}),e._v(" "),a("el-table-column",{attrs:{prop:"subjectName",label:"项目",align:"center",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:"depreciationMethod",label:"摊销方法","min-width":"120",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"depreciableLife",label:"预计使用寿命","min-width":"120",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"ratioRemainingValue",label:"残值率(%)","min-width":"120",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"according",label:"依据","min-width":"120",align:"center"}})],1),e._v(" "),a("el-table",{directives:[{name:"show",rawName:"v-show",value:e.prepaidExpenses,expression:"prepaidExpenses"}],ref:"ellTable",refInFor:!0,staticStyle:{width:"100%"},attrs:{data:e.tableData,"row-style":{height:"42px"},"cell-style":{padding:0},border:"",height:"calc(100vh - 250px)","max-height":"500px"}},[a("el-table-column",{attrs:{prop:"subjectName",label:"操作",align:"center",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"编辑",placement:"top-start"}},[a("el-button",{attrs:{size:"mini",type:"success",icon:"el-icon-edit-outline normalWeight"},on:{click:function(a){return e.editRow(e.index,t.row)}}})],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"删除",placement:"top-start"}},[a("el-button",{attrs:{size:"mini",type:"danger",icon:"el-icon-close normalWeight"},on:{click:function(a){return e.deleteRow(t.row)}}})],1)]}}],null,!0)}),e._v(" "),a("el-table-column",{attrs:{prop:"subjectName",label:"项目","min-width":"120",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"depreciationMethod",label:"摊销方法","min-width":"120",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"depreciableLife",label:"摊销年限","min-width":"120",align:"center"}})],1)],1)}),1),e._v(" "),a("el-dialog",{attrs:{title:"编辑固定资产摊销",visible:e.updatefixedAssetsDialog,"destroy-on-close":!0,"append-to-body":"",width:"40%"},on:{"update:visible":function(t){e.updatefixedAssetsDialog=t}}},[a("el-form",{ref:"fixedAssetsForm",attrs:{model:e.fixedAssetsForm,rules:e.mergeScopedEditFormRule}},[a("el-form-item",{attrs:{prop:"subjectName",label:"类别","label-width":"9vw"}},[a("el-popover",{staticStyle:{"max-width":"300px",width:"100%"},attrs:{placement:"bottom",trigger:"click"}},[a("el-scrollbar",{staticStyle:{height:"300px","min-width":"300px","max-width":"300px",width:"100%"}},[a("el-input",{staticStyle:{position:"fixed","z-index":"1111","max-width":"300px"},attrs:{placeholder:"输入关键字搜索"},model:{value:e.fixedAssetsText,callback:function(t){e.fixedAssetsText=t},expression:"fixedAssetsText"}}),e._v(" "),a("el-tree",{ref:"fixedAssetsTree",staticStyle:{"padding-top":"50px"},attrs:{data:e.subData,props:e.subjectProps,"filter-node-method":e.filterNode},on:{"check-change":e.handleCheckChange,"node-click":function(t,a,i){return e.handleNodeClick(t,a,i,1)}}})],1),e._v(" "),a("el-button",{staticStyle:{"max-width":"394px",width:"100%",display:"flex","padding-left":"14px"},attrs:{slot:"reference",placeholder:"请选择类别"},slot:"reference",model:{value:e.fixedAssetsForm.subjectName,callback:function(t){e.$set(e.fixedAssetsForm,"subjectName","string"==typeof t?t.trim():t)},expression:"fixedAssetsForm.subjectName"}},[e._v("\n                        "+e._s(e.fixedAssetsForm.subjectName)+"\n                    ")])],1)],1),e._v(" "),a("el-form-item",{attrs:{prop:"depreciationMethod",label:"折旧方法","label-width":"9vw"}},[a("el-select",{staticClass:"addInput",attrs:{placeholder:"请选择折旧方法"},model:{value:e.fixedAssetsForm.depreciationMethod,callback:function(t){e.$set(e.fixedAssetsForm,"depreciationMethod","string"==typeof t?t.trim():t)},expression:"fixedAssetsForm.depreciationMethod"}},e._l(e.depreciationOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{prop:"depreciableLife",label:"折旧年限(年)","label-width":"9vw"}},[a("el-input",{staticClass:"addInput",attrs:{size:"large",placeholder:"请输入折扣年限"},model:{value:e.fixedAssetsForm.depreciableLife,callback:function(t){e.$set(e.fixedAssetsForm,"depreciableLife","string"==typeof t?t.trim():t)},expression:"fixedAssetsForm.depreciableLife"}},[a("i",{staticClass:"percent",staticStyle:{"font-style":"normal"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("年")])])],1),e._v(" "),a("el-form-item",{attrs:{prop:"ratioRemainingValue",label:"残值率(%)","label-width":"9vw"}},[a("el-input",{staticClass:"addInput",attrs:{size:"large",placeholder:"请输入残值率"},model:{value:e.fixedAssetsForm.ratioRemainingValue,callback:function(t){e.$set(e.fixedAssetsForm,"ratioRemainingValue","string"==typeof t?t.trim():t)},expression:"fixedAssetsForm.ratioRemainingValue"}},[a("i",{staticClass:"percent",staticStyle:{"font-style":"normal"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("%")])])],1),e._v(" "),a("el-form-item",{attrs:{prop:"yearlyDepreciation",label:"年折旧率(%)","label-width":"9vw"}},[a("el-input",{staticClass:"addInput",attrs:{size:"large",placeholder:"请输入年折旧率"},model:{value:e.fixedAssetsForm.yearlyDepreciation,callback:function(t){e.$set(e.fixedAssetsForm,"yearlyDepreciation","string"==typeof t?t.trim():t)},expression:"fixedAssetsForm.yearlyDepreciation"}},[a("i",{staticClass:"percent",staticStyle:{"font-style":"normal"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("%")])])],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"info",size:"small"},on:{click:function(t){e.updatefixedAssetsDialog=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.saveEditBtn(e.index,"fixedAssetsForm")}}},[e._v("确 定")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"编辑无形资产摊销",visible:e.updateIntangibleDialog,"destroy-on-close":!0,"append-to-body":"",width:"40%"},on:{"update:visible":function(t){e.updateIntangibleDialog=t}}},[a("el-form",{ref:"intangibleAssetsForm",attrs:{model:e.intangibleAssetsForm,rules:e.mergeScopedEditFormRule}},[a("el-form-item",{attrs:{prop:"subjectName",label:"项目","label-width":"9vw"}},[a("el-popover",{staticStyle:{"max-width":"300px",width:"100%"},attrs:{placement:"bottom",trigger:"click"}},[a("el-scrollbar",{staticStyle:{height:"300px","min-width":"300px","max-width":"300px",width:"100%"}},[a("el-input",{staticStyle:{position:"fixed","z-index":"1111","max-width":"300px",width:"100%"},attrs:{placeholder:"输入关键字搜索"},model:{value:e.intangibleAssetsText,callback:function(t){e.intangibleAssetsText=t},expression:"intangibleAssetsText"}}),e._v(" "),a("el-tree",{ref:"intangibleAssetsTree",staticStyle:{"padding-top":"50px"},attrs:{data:e.subData,props:e.subjectProps,"filter-node-method":e.filterNode},on:{"check-change":e.handleCheckChange,"node-click":function(t,a,i){return e.handleNodeClick(t,a,i,2)}}})],1),e._v(" "),a("el-button",{staticStyle:{"max-width":"394px",width:"100%",display:"flex","padding-left":"14px"},attrs:{slot:"reference",placeholder:"请选择类别"},slot:"reference",model:{value:e.intangibleAssetsForm.subjectName,callback:function(t){e.$set(e.intangibleAssetsForm,"subjectName","string"==typeof t?t.trim():t)},expression:"intangibleAssetsForm.subjectName"}},[e._v("\n                        "+e._s(e.intangibleAssetsForm.subjectName)+"\n                    ")])],1)],1),e._v(" "),a("el-form-item",{attrs:{prop:"depreciableLife",label:"预计使用寿命","label-width":"9vw"}},[a("el-input",{staticClass:"addInput",attrs:{size:"large",placeholder:"请输入预计使用寿命"},model:{value:e.intangibleAssetsForm.depreciableLife,callback:function(t){e.$set(e.intangibleAssetsForm,"depreciableLife","string"==typeof t?t.trim():t)},expression:"intangibleAssetsForm.depreciableLife"}},[a("i",{staticClass:"percent",staticStyle:{"font-style":"normal"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("年")])])],1),e._v(" "),a("el-form-item",{attrs:{prop:"depreciationMethod",label:"摊销方法","label-width":"9vw"}},[a("el-select",{staticClass:"addInput",attrs:{placeholder:"请选择摊销方法"},model:{value:e.intangibleAssetsForm.depreciationMethod,callback:function(t){e.$set(e.intangibleAssetsForm,"depreciationMethod","string"==typeof t?t.trim():t)},expression:"intangibleAssetsForm.depreciationMethod"}},e._l(e.depreciationOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{prop:"ratioRemainingValue",label:"残值率(%)","label-width":"9vw"}},[a("el-input",{staticClass:"addInput",attrs:{size:"large",placeholder:"请输入残值率"},model:{value:e.intangibleAssetsForm.ratioRemainingValue,callback:function(t){e.$set(e.intangibleAssetsForm,"ratioRemainingValue","string"==typeof t?t.trim():t)},expression:"intangibleAssetsForm.ratioRemainingValue"}},[a("i",{staticClass:"percent",staticStyle:{"font-style":"normal"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("%")])])],1),e._v(" "),a("el-form-item",{attrs:{prop:"according",label:"依据","label-width":"9vw"}},[a("el-input",{staticClass:"addInput",attrs:{size:"large",placeholder:"请输入依据"},model:{value:e.intangibleAssetsForm.according,callback:function(t){e.$set(e.intangibleAssetsForm,"according","string"==typeof t?t.trim():t)},expression:"intangibleAssetsForm.according"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"info",size:"small"},on:{click:function(t){e.updateIntangibleDialog=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.saveEditBtn(e.index,"intangibleAssetsForm")}}},[e._v("确 定")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"编辑长期待摊费用",visible:e.updatePrepaidDialog,"destroy-on-close":!0,"append-to-body":"",width:"40%"},on:{"update:visible":function(t){e.updatePrepaidDialog=t}}},[a("el-form",{ref:"prepaidExpensesForm",attrs:{model:e.prepaidExpensesForm,rules:e.mergeScopedEditFormRule}},[a("el-form-item",{attrs:{prop:"subjectName",label:"项目","label-width":"9vw"}},[a("el-popover",{staticStyle:{"max-width":"300px",width:"100%"},attrs:{placement:"bottom",trigger:"click"}},[a("el-scrollbar",{staticStyle:{height:"300px","min-width":"300px","max-width":"300px",width:"100%"}},[a("el-input",{staticStyle:{position:"fixed","z-index":"1111","max-width":"300px",width:"100%"},attrs:{placeholder:"输入关键字搜索"},model:{value:e.prepaidExpensesText,callback:function(t){e.prepaidExpensesText=t},expression:"prepaidExpensesText"}}),e._v(" "),a("el-tree",{ref:"prepaidExpensesTree",staticStyle:{"padding-top":"50px"},attrs:{data:e.subData,props:e.subjectProps,"filter-node-method":e.filterNode},on:{"check-change":e.handleCheckChange,"node-click":function(t,a,i){return e.handleNodeClick(t,a,i,3)}}})],1),e._v(" "),a("el-button",{staticStyle:{"max-width":"394px",width:"100%",display:"flex","padding-left":"14px"},attrs:{slot:"reference",placeholder:"请选择类别"},slot:"reference",model:{value:e.prepaidExpensesForm.subjectName,callback:function(t){e.$set(e.prepaidExpensesForm,"subjectName","string"==typeof t?t.trim():t)},expression:"prepaidExpensesForm.subjectName"}},[e._v("\n                        "+e._s(e.prepaidExpensesForm.subjectName)+"\n                    ")])],1)],1),e._v(" "),a("el-form-item",{attrs:{prop:"depreciationMethod",label:"摊销方法","label-width":"9vw"}},[a("el-select",{staticClass:"addInput",attrs:{placeholder:"请输入摊销方法"},model:{value:e.prepaidExpensesForm.depreciationMethod,callback:function(t){e.$set(e.prepaidExpensesForm,"depreciationMethod","string"==typeof t?t.trim():t)},expression:"prepaidExpensesForm.depreciationMethod"}},e._l(e.depreciationOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{prop:"depreciableLife",label:"摊销年限","label-width":"9vw"}},[a("el-input",{staticClass:"addInput",attrs:{size:"large",placeholder:"请输入摊销年限"},model:{value:e.prepaidExpensesForm.depreciableLife,callback:function(t){e.$set(e.prepaidExpensesForm,"depreciableLife","string"==typeof t?t.trim():t)},expression:"prepaidExpensesForm.depreciableLife"}},[a("i",{staticClass:"percent",staticStyle:{"font-style":"normal"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("年")])])],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"info",size:"small"},on:{click:function(t){e.updatePrepaidDialog=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.saveEditBtn(e.index,"prepaidExpensesForm")}}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var R=a("VU/8")(M,E,!1,function(e){a("rO8z")},"data-v-110822b8",null).exports,O={components:{MergeNoteInfo:T.default,MergeReport:S,OffsetEntry:g.default,MergeScope:h.default,SingleTrialBalance:f.default,TrialBalanceAndAuditReport:p,MergeTrialBalance:u.default,ImportRelatedPart:k.default,BdoTable:c.a,MergeForm:j.default,Postill:_.a,ProjectPanorama:N.default,counter:P.a,MergeRangeModal:R},computed:l()({},Object(L.b)(["isResetProject"]),{isResetProject:function(){return this.$store.state.resetProject},removeBagde:function(){return this.$store.state.removeBagde}}),watch:{isResetProject:{handler:function(e){e&&(this.indexInit(),this.tabList.length=0,this.showTable(this.match[0],this.match[0].id),this.$store.commit("destoryCache",!0))},immediate:!0},removeBagde:{handler:function(e){var t=this;this.refreshPagesMenuId&&"string"==typeof this.refreshPagesMenuId&&(this.refreshPagesMenuId=this.refreshPagesMenuId.split(",")),this.tabList.forEach(function(a){if(e&&e===a.content){a.isMark=!1;var i=a.menuID.split("-")[0];t.refreshPagesMenuId=t.refreshPagesMenuId?t.refreshPagesMenuId.filter(function(e){return-1==e.indexOf(i)}).join(","):"",t.$store.commit("setAddBagdeScope",t.refreshPagesMenuId)}}),this.$store.commit("setRemoveBagdeScope","")},immediate:!0},refreshPagesCollection:{handler:function(e,t){if(e&&e.refreshIndexes){if(t&&e.key===t.key)return;this.handleAddBadge(e)}},immediate:!0,deep:!0},$route:{handler:function(e,t,a){"/index"===e.path&&localStorage.clear()}},fixedAssetsText:function(e){this.$refs.fixedAssetsTree.filter(e)},intangibleAssetsText:function(e){this.$refs.intangibleAssetsTree.filter(e)},prepaidExpensesText:function(e){this.$refs.prepaidExpensesTree.filter(e)}},data:function(){var e=function(e,t,a){""==t||isNaN(t)?a(new Error("请输入正确的数值")):!isNaN(t)&&(parseFloat(t).toFixed(2)<0||parseFloat(t).toFixed(2)>100)?a(new Error("请输入正确的数值")):a()};return{isRouterAlive:!0,flag:"index",active:0,curCustomerId:parent.CUR_CUSTOMERID,curProjectId:parent.CUR_PROJECTID,showReport:!1,showSingleTrialBalance:!1,showTbInAuditReport:!1,showIndividualAuditReport:!1,showOffsetEntry:!1,urlParams:{},tabsParams:Boolean,isShowProjectPanorama:!0,tabList:[],includeRoute:["ImportRelatedPart","MergeScope","MergeTrialBalance","OffsetEntry","MergeNoteInfo"],match:[{name:"ImportRelatedPart",component:k.default,id:0,label:"关联方导入",menuID:"HB001-RPI001",description:""},{name:"MergeScope",component:h.default,id:1,label:"合并范围",menuID:"HB002-MC001",description:""},{name:"MergeTrialBalance",component:u.default,id:2,label:"合并试算平衡表",menuID:"HB003-MTB001",description:""},{name:"OffsetEntry",component:g.default,id:3,label:"抵销分录",menuID:"HB004-OE001",description:""},{name:"MergeForm",component:j.default,id:4,label:"合并报表",menuID:"HB005-ME001",description:""},{name:"MergeNoteInfo",component:T.default,id:5,label:"合并附注",menuID:"HB006-MNI001",description:""}],editableTabsValue:"1",index:0,isDel:Boolean,isZoom:!0,isLastActive:!0,customerData:[],currentTabComponent:"",customerName:"",projectName:"",timeOut:!1,testArr:[],isOpenDrawer:!1,menuID:"",label:"",limitArr:[],curActive:0,activeLabel:"",checkFlagMap:this.$DIC("mergeCheckType"),isShowTableContent:!1,isPostilLink:!1,activeTab:"",menuIDList:[],curPageFinished:!1,fullscreenLoading:!1,commentedUser:"",routeOption:[],refreshPagesMenuId:"",refreshPagesCollection:{},dialogVisible:!1,number:0,param:"",descriptionText:"",fixedAssetsText:"",intangibleAssetsText:"",prepaidExpensesText:"",subjectProps:{label:"subjectName",children:"children"},text:"请选择科目类别",mergeRangeDialog:!1,mergeTabsIndex:"",addFixedDialog:!1,addIntangibleDialog:!1,addPrepaidExpensesDialog:!1,formLabelWidth:"150px",mergeRangeData:[],fixedAssetsForm:{subjectName:"",depreciationMethod:"",depreciableLife:"",ratioRemainingValue:"",yearlyDepreciation:""},intangibleAssetsForm:{subjectName:"",depreciationMethod:"",depreciableLife:"",ratioRemainingValue:"",according:""},prepaidExpensesForm:{subjectName:"",depreciationMethod:"",depreciableLife:"",according:""},toYearlyDepreciation:"",toRatioRemainingValue:"",toDepreciationMethod:"",dataType:"",subjectData:"",depreciationMethodList:[],depreciationOptions:[],mergeScopedEditFormRule:{depreciationMethod:[{required:!0,message:"折旧(摊销)方法不能为空",trigger:"blur"}],depreciableLife:[{required:!0,message:"折旧年限(使用寿命)不能为空",trigger:"blur"},{validator:e,trigger:"change"}],ratioRemainingValue:[{required:!0,message:"残值率不能为空",trigger:"blur"},{validator:e,trigger:"change"}],yearlyDepreciation:[{required:!0,message:"年折旧率不能为空",trigger:"blur"},{validator:e,trigger:"change"}],according:[{required:!0,message:"依据不能为空",trigger:"blur"}],subjectName:[{required:!0,message:"项目不能为空",trigger:"blur"}]}}},methods:{setMergeInterval:function(){this.depreciationMethodList=this.$DIC("固定资产折旧方法"),this.depreciationOptions=this.$DIC("固定资产折旧方法"),this.mergeRangeDialog=!0;this.getTableData(3)},sendIndex:function(e){this.mergeTabsIndex=e,0==e&&(this.dataType=3,this.getTableData(this.dataType)),1==e&&(this.dataType=0,this.getTableData(this.dataType)),2==e&&(this.dataType=1,this.getTableData(this.dataType)),3==e&&(this.dataType=2,this.getTableData(this.dataType))},addMergeClick:function(e){var t=this;this.text="请选择科目类别",1==e&&(this.addFixedDialog=!0,this.$nextTick(function(){t.$refs.fixedAssetsForm.resetFields(),t.fixedAssetsForm.subjectName="",t.fixedAssetsForm.depreciationMethod="",t.fixedAssetsForm.depreciableLife="",t.fixedAssetsForm.ratioRemainingValue="",t.fixedAssetsForm.yearlyDepreciation=""})),2==e&&(this.addIntangibleDialog=!0,this.$nextTick(function(){t.$refs.intangibleAssetsForm.resetFields(),t.intangibleAssetsForm.subjectName="",t.intangibleAssetsForm.depreciableLife="",t.intangibleAssetsForm.depreciationMethod="",t.intangibleAssetsForm.ratioRemainingValue="",t.intangibleAssetsForm.according=""})),3==e&&(this.addPrepaidExpensesDialog=!0,this.$nextTick(function(){t.$refs.prepaidExpensesForm.resetFields(),t.prepaidExpensesForm.subjectName="",t.prepaidExpensesForm.depreciableLife="",t.prepaidExpensesForm.depreciationMethod="",t.prepaidExpensesForm.ratioRemainingValue=""}))},addBtn:function(e,t){var a=this;this.text="";var i=sessionStorage.getItem("curCustomerData"),r=JSON.parse(i),s=r.curCustomerId,o=r.curProjectId;this.$refs[t].validate(function(t){if(!t)return!1;if(1==e){var i=a.depreciationMethodList.find(function(e){return e.value==a.fixedAssetsForm.depreciationMethod});a.toDepreciationMethod=i.value,a.toRatioRemainingValue=Math.round(100*a.fixedAssetsForm.ratioRemainingValue)/1e4,a.toYearlyDepreciation=Math.round(100*a.fixedAssetsForm.yearlyDepreciation)/1e4;var r={subjectId:a.subjectId,subjectName:a.fixedAssetsForm.subjectName,depreciationMethod:a.toDepreciationMethod,depreciableLife:a.fixedAssetsForm.depreciableLife-0,ratioRemainingValue:a.toRatioRemainingValue,yearlyDepreciation:a.toYearlyDepreciation,dataType:0,projectId:o,customerId:s};a.param=r}if(2==e){var n=a.depreciationMethodList.find(function(e){return e.value==a.intangibleAssetsForm.depreciationMethod});a.toDepreciationMethod=n.value,a.toRatioRemainingValue=Math.round(100*a.intangibleAssetsForm.ratioRemainingValue)/1e4||"",a.toYearlyDepreciation=Math.round(100*a.intangibleAssetsForm.yearlyDepreciation)/1e4||"";var l={subjectId:a.subjectId,subjectName:a.intangibleAssetsForm.subjectName,depreciationMethod:a.toDepreciationMethod,depreciableLife:a.intangibleAssetsForm.depreciableLife-0,ratioRemainingValue:a.toRatioRemainingValue,according:a.intangibleAssetsForm.according,dataType:1,projectId:o,customerId:s};a.param=l}if(3==e){var c=a.depreciationMethodList.find(function(e){return e.value==a.prepaidExpensesForm.depreciationMethod});a.toDepreciationMethod=c.value,a.toRatioRemainingValue=Math.round(100*a.prepaidExpensesForm.ratioRemainingValue)/1e4||"",a.toYearlyDepreciation=Math.round(100*a.prepaidExpensesForm.yearlyDepreciation)/1e4||"";var u={subjectId:a.subjectId,subjectName:a.prepaidExpensesForm.subjectName,depreciationMethod:a.toDepreciationMethod,depreciableLife:a.prepaidExpensesForm.depreciableLife-0,dataType:2,projectId:o,customerId:s};a.param=u}a.$sacpApis.addSubjectRange(a.param).then(function(t){t.success?t&&(a.$message.success("新增成功"),1==e&&(a.addFixedDialog=!1,a.dataType=0),2==e&&(a.addIntangibleDialog=!1,a.dataType=1),3==e&&(a.addPrepaidExpensesDialog=!1,a.dataType=2),a.getTableData(a.dataType)):a.$message.error(t.resultInfo.statusText)}).catch(function(e){return a.$message.error(e)}).finally(function(){})})},changeTableData:function(e){1==e&&(this.dataType=0,this.getTableData(this.dataType)),2==e&&(this.dataType=1,this.getTableData(this.dataType)),3==e&&(this.dataType=2,this.getTableData(this.dataType))},deleteTableData:function(e){this.getTableData(e)},getTableData:function(e){var t=this;this.fullscreenLoading=!0,this.$sacpApis.querySubjectRange(e).then(function(e){e.success?e.data&&(t.mergeRangeData=e.data,t.mergeRangeData.forEach(function(e){e.ratioRemainingValue=Math.round(1e4*e.ratioRemainingValue)/100+"%",e.yearlyDepreciation=Math.round(1e4*e.yearlyDepreciation)/100+"%";var a=t.depreciationMethodList.find(function(t){return t.value==e.depreciationMethod});e.depreciationMethod=a.label}),t.fullscreenLoading=!1):t.$message.error(e.resultInfo.statusText)}).catch(function(e){return t.$message.error(e)}).finally(function(){})},handleNodeClick:function(e,t,a,i){console.log(i,e),this.text="",1==i&&(this.fixedAssetsForm.subjectName=e.subjectName),2==i&&(this.intangibleAssetsForm.subjectName=e.subjectName),3==i&&(this.prepaidExpensesForm.subjectName=e.subjectName),this.subjectId=e.subjectId},filterNode:function(e,t){return console.log(e,t),!e||-1!==t.subjectName.indexOf(e)},handleCheckChange:function(e,t,a){console.log(e,t,a,"11")},reValidSonCompanyNote:function(){var e=this;this.fullscreenLoading=!0,this.$sacpApis.childNoteCheck().then(function(t){t.success?(e.$eventBus.$emit("page-refresh",t.resultInfo.refreshIndexes),e.$message.success("重新校验子公司附注成功")):e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)}).finally(function(){e.fullscreenLoading=!1})},initSonCompanyData:function(){this.$store.commit("setInitMergeScope",!0)},rejustDebCre:function(){var e={flage:!0,active:this.active};this.$store.commit("setOpenAdjust",e)},showProjectPanorama:function(){this.dialogVisible=!0,this.isShowTableContent=!0,this.isShowProjectPanorama=!0},opened:function(){this.$refs.panorama&&this.$refs.panorama.projectPanoramaInit(0)},closeProjectPanorama:function(){this.dialogVisible=!1,this.isShowTableContent=!1,this.isShowProjectPanorama=!1,this.$refs.panorama.tableData=[],this.$router.push({name:"index"})},openDrawer:function(){if(!this.tabList.length)return this.$message.error("索引号为空！");switch(this.$store.commit("setClosePostill",!0),this.menuID){case"HB002-MC001":this.activeLabel="合并范围内";break;case"HB003-MTB001":this.activeLabel="合并试算平衡表-本期";break;default:this.activeLabel=this.label}this.isOpenDrawer=!0},finished:function(){var e=this;if(!this.menuID)return this.$message.error("索引号为空！");var t={indexId:this.menuID};this.$sacpApis.updateProjectStatus(t).then(function(t){t.success?(e.$message.success("更新项目状态成功!"),e.indexInit(),e.curPageFinished=!0):e.$message.error(t.resultInfo.statusText)})},add:function(e){if(!this.customerData.length)return this.$message.error("请重新登录!");this.tabsParams=!0,this.isLastActive=!0;var t;this.currentTabComponent=e.name,t=e.label,this.label=e.label;var a=++this.curActive+"";this.$store.commit("removeTabKey",this.currentTabComponent),this.tabList.some(function(e){return e.name==a})||(this.tabList.push({title:t,name:a,content:this.currentTabComponent,menuID:e.menuID,isMark:!1}),this.removeBagdeForInnerPage(e.menuID),this.menuIDList.push(e.menuID),this.closePostill(!1)),this.handleRouteLink(),this.routeOption.push(this.currentTabComponent),this.$store.commit("setRouteOptions",this.routeOption),this.editableTabsValue=a,this.isShowTableContent=!0;var i=[];return this.tabList.map(function(e){return i.push(e.menuID)}),A.a.saveMenuIdList(i),this.tabList},handleRouteLink:function(){this.activeTab?(this.$router.push({name:this.currentTabComponent,query:{tab:this.activeTab}}),this.activeTab=0):"MergeScope"==this.currentTabComponent?this.handleLink("1"):"MergeTrialBalance"==this.currentTabComponent?this.handleLink("mergeTbCur"):"MergeForm"==this.currentTabComponent?this.handleLink("balanceSheet"):this.$router.push({name:this.currentTabComponent})},handleLink:function(e){this.$router.push({name:this.currentTabComponent,query:{tab:e}})},closePostill:function(e){this.isOpenDrawer=e},isPostil:function(e){this.isPostilLink=!0},editTab:function(e){var t=this;if(e.name==this.editableTabsValue){this.tabList.filter(function(e){return e.menuID==t.menuID});this.tabList.forEach(function(a,i){e.label==a.title&&(t.curActive=Number(e.name),t.currentTabComponent=a.content,t.tabsParams=!1,t.menuID=a.menuID,"HB001-RPI001"!=a.menuID&&"HB004-OE001"!=a.menuID&&"HB006-MNI001"!=a.menuID||!a.isMark||(a.isMark=!1,t.$store.commit("setRefreshPagesMenuId",a.menuID)),sessionStorage.setItem("menuID",t.menuID),t.handleChangeTabURL())})}this.$store.commit("removeTab",!1),this.editableTabsValue=e.name,this.closePostill(!1)},handleChangeTabURL:function(){var e=this.currentTabComponent,t=void 0;switch(e){case"MergeScope":t={tab:this.$store.state.mergeScopeTab};break;case"MergeTrialBalance":t={tab:this.$store.state.mergeTBActiveName};break;case"MergeForm":t={tab:this.$store.state.mergeFormActiveName};break;default:t={}}this.$router.push({name:e,query:t})},removeTab:function(e){var t=this;this.tabsParams=!1;var a=this.tabList,i=this.editableTabsValue;i===e&&(a.forEach(function(r,s){if(r.name===e){var o=a[s+1]||a[s-1];o&&(i=o.name,t.currentTabComponent=o.content,t.handleChangeTabURL(),t.menuID=o.menuID),s,o||(t.curActive=0,t.currentTabComponent={},t.isShowTableContent=!1,t.$router.push({name:"index"}))}}),this.$store.commit("removeTab",!0)),this.editableTabsValue=i,a.map(function(a){a.name===e&&t.handleRemoveTabs(a.menuID)}),this.tabList=a.filter(function(t){return t.name!==e});var r=[];this.tabList.map(function(e){return r.push(e.menuID)}),A.a.saveMenuIdList(r);this.closePostill(!1)},handleRemoveTabs:function(e){switch(e){case"HB002-MC001":this.$store.commit("setMergeScopeActiveTab",""),this.removeBagdeForInnerPage(e);break;case"HB003-MTB001":this.$store.commit("setMergeTBIndexID",""),this.$store.commit("setMergeTBActiveTab",""),this.$store.commit("setMergeTBActiveName",""),this.removeBagdeForInnerPage(e),this.$store.commit("setAddBagdeTb","");break;case"HB005-ME001":this.$store.commit("setMergeFormIndex",""),this.$store.commit("setMergeFormActiveName",""),this.$store.commit("setMergeFormActiveTab",""),this.removeBagdeForInnerPage(e),this.$store.commit("setAddBagdeForm","")}var t=this.tabList.filter(function(t){return t.menuID!=e}),a=$.a.map(t,function(e){return e.menuID}).join();this.deleLocalStorageData(a)},removeBagdeForInnerPage:function(e){"object"===o()(this.refreshPagesMenuId)?(this.refreshPagesMenuId=this.refreshPagesMenuId.filter(function(t){t.indexOf(e.split("-")[0])}).join(),this.$store.commit("setAddBagdeScope",this.refreshPagesMenuId)):(this.refreshPagesMenuId=this.refreshPagesMenuId.split(","),this.removeBagdeForInnerPage(e))},zoomOut:function(){this.isZoom=!1},zoomIn:function(){this.isZoom=!0},showTable:function(e,t){if(t<5&&t>this.active)return this.$message.error("前期进度未完成!");this.curActive=t,this.showSingleTrialBalance=!1,this.showReport=!1,this.isZoom=!0,this.menuID=e.menuID,this.isShowProjectPanorama=!1,this.add(e),sessionStorage.setItem("menuID",this.menuID)},indexInit:function(){var e=this;this.$sacpApis.indexPageInit().then(function(t){if(t.success){e.customerData=t.data,-1!=e.customerData[0].curCustomerName.indexOf("-")?e.customerName=e.customerData[0].curCustomerName:e.customerName=e.customerData[0].curCustomerId+"-"+e.customerData[0].curCustomerName,-1!=e.customerData[0].curProjectName.indexOf("-")?e.projectName=e.customerData[0].curProjectName:e.projectName=e.customerData[0].curProjectId+"-"+e.customerData[0].curProjectName,e.timeOut=!1;var a={curCustomerName:e.customerName,curProjectName:e.projectName,curYear:e.customerData[0].curAccYear,curCustomerId:e.customerData[0].curCustomerId,curProjectId:e.customerData[0].curProjectId,departmentIdr:e.customerData[0].departmentIdr,userId:e.customerData[0].userId};sessionStorage.setItem("curCustomerData",r()(a)),e.getPermission(),e.handleActive(),e.handleNewOpen()}else e.timeOut=!0,e.$message.error(t.resultInfo.statusText)}).catch(function(t){e.$message.error(t)}).finally(function(){return e.$store.commit("setResetProject",!1)}),window.addEventListener("storage",this.storageEvent,!1)},handleActive:function(){switch(this.customerData[0].mergeProjectStatus){case 10:this.active=1;break;case 20:this.active=2;break;case 30:this.active=3;break;case 40:this.active=4;break;case 50:this.active=5;break;case 60:this.active=6;break;default:this.active=0}},getPermission:function(){var e=this,t={menuId:"",sqlId:"DG00061",param1:this.customerData[0].curProjectId,param2:this.customerData[0].curCustomerId};this.$sacpApis.postillCheck(t).then(function(t){if(t.success){var a=t.data[0],i=e.customerData[0],r=[];if(a.manager==i.userId){r.push({status:"manager",limit:1})}if(a.signAccountant2==i.userId||a.signAccountant3==i.userId){r.push({status:"signAccountant2",limit:1})}if(a.audit1==i.userId){r.push({status:"audit1",limit:1})}if(a.audit2==i.userId){r.push({status:"audit2",limit:1})}if(a.reaReviewer==i.userId){r.push({status:"reaReviewer",limit:1})}if(a.signUser==i.userId){r.push({status:"signUser",limit:1})}if(a.reviewPartner==i.userId){r.push({status:"reviewPartner",limit:1})}if(a.issuedPeople==i.userId){r.push({status:"issuedPeople",limit:1})}e.limitArr=r}})},handleNewOpen:function(){var e=[];if(this.curPageFinished){for(var t=0;t<this.match.length-1;t++)this.match[t].name==this.currentTabComponent&&e.push(this.match[t+1]);this.curPageFinished=!1}else{var a=window.location.hash.split("/");if(-1!=(a=a.pop()).indexOf("?")){var i=a.split("?")[1];a=a.split("?")[0],this.activeTab=i.split("=")[1]}"index"!=a&&(this.isShowTableContent=!0),e=this.match.filter(function(e){return e.name==a})}e.length>0&&this.showTable(e[0],e[0].id)},addBadgeEvent:function(){var e=this;this.$eventBus.$off("add-badge-menuId").$on("add-badge-menuId",function(t){e.$store.commit("setAddBagdeTb",""),e.$store.commit("setAddBagdeForm",""),e.$store.commit("setAddBagdeScope",""),e.handleAddBadge(t)})},handleAddBadge:function(e){var t=this,a=void 0;a="object"===(void 0===e?"undefined":o()(e))?e.refreshIndexes:e,this.tabList.map(function(i){(a.indexOf(i.menuID)>-1||a.indexOf(i.menuID.split("-")[0])>-1)&&(i.isMark=!0,"HB003-MTB001"===i.menuID&&t.$store.commit("setAddBagdeTb",e),"HB005-ME001"===i.menuID&&t.$store.commit("setAddBagdeForm",e),"HB002-MC001"===i.menuID&&t.$store.commit("setAddBagdeScope",e),"object"===(void 0===e?"undefined":o()(e))&&"HB003-MTB001"!=i.menuID&&"HB005-ME001"!=i.menuID&&"HB002-MC001"!=i.menuID&&t.freshSinglePage({menuID:i.menuID,key:e.key}))}),this.refreshPagesMenuId=a},freshSinglePage:function(e){this.$store.commit("setRefreshPagesMenuId",e)},storageEvent:function(){var e=$.a.map(this.tabList,function(e){return e.menuID}).join();this.deleLocalStorageData(e)},deleLocalStorageData:function(e){var t=JSON.parse(localStorage.getItem("refreshIndexes"));if(t&&t.refreshIndexes&&t.refreshIndexes){var a="string"==typeof t.refreshIndexes?t.refreshIndexes.split(","):t.refreshIndexes;if(a&&a.length){a=a.filter(function(t){return e.indexOf(t.split("-")[0])>-1});var i={key:t.key,refreshIndexes:a.join()};this.refreshPagesCollection=i,localStorage.setItem("refreshIndexes",r()(i))}}},handleClose:function(e){this.dialogVisible=!1},saveEdit:function(){this.dialogVisible=!1,this.$refs.panorama.save()},cancel:function(){this.dialogVisible=!1,this.$refs.panorama.tableData=[]},clear:function(e){this.number=e},handleCommand:function(e){switch(e){case"investment":this.$sacpApis.investmentOffset().then(function(e){});break;case"reciprocal":this.$sacpApis.reciprocalOffset().then(function(e){});break;case"tsrade":this.$sacpApis.tradeOffsets().then(function(e){});break;case"statement":this.$sacpApis.statementOffset().then(function(e){});break;case"reCreateCostOffset":this.$sacpApis.regeneratingCostOffset().then(function(e){});break;default:console.log("unknow command",e)}},queryProject:function(){var e=this;this.$sacpApis.queryProjectState().then(function(t){if(t.success){if(t.data){var a=t.data[0],i=a.mergeScopeCheckFlag,r=a.tbCheckFlag,s=a.reportCheckFlag,o="（"+e.checkFlagMap[r].label+"）",n="（"+e.checkFlagMap[i].label+"）";e.$set(e.match[1],"description",n),e.$set(e.match[2],"description",o);var l=!0===s?"（校验通过）":"（校验错误）";e.$set(e.match[4],"description",l)}}else e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)}).finally(function(){})},findAccSubjectType:function(){var e=this,t=sessionStorage.getItem("curCustomerData"),a=JSON.parse(t),i=a.curCustomerId,r=(a.curProjectId,{lockCustomerId:i,lockYyyy:a.curYear,customerId:i});this.$sacpApis.findAccSubjectType(r).then(function(t){t.success?t.data&&(e.subjectData=t.data):e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)}).finally(function(){})}},created:function(){this.indexInit(),this.addBadgeEvent(),this.queryProject()},mounted:function(){this.findAccSubjectType()}},B={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-container",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"container"},[e.isZoom?a("el-header",[a("el-row",[a("el-col",{attrs:{span:1}},[a("div",{staticClass:"logo"})]),e._v(" "),a("el-col",{attrs:{span:5}},[a("div",{staticClass:"customerInformation"},[a("p",{attrs:{title:this.customerName}},[e._v("客户:"+e._s(this.customerName))]),e._v(" "),a("p",{attrs:{title:this.projectName}},[e._v("项目:"+e._s(this.projectName))])])]),e._v(" "),a("el-col",{attrs:{span:16}},[a("div",{staticClass:"steps"},[a("el-steps",{ref:"steps",attrs:{active:e.active,"align-center":"","finish-status":"success"}},e._l(e.match,function(t){return a("el-step",{key:t.id,attrs:{title:t.label},nativeOn:{click:function(a){return e.showTable(t,t.id)}}},[a("span",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(t.label)+"\n                                "),a("span",{style:{color:"（校验错误）"==t.description?"#c24f4a":"#8baa4a"}},[e._v("\n                                    "+e._s(t.description)+"\n                                ")])])])}),1)],1)]),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"项目全景图",placement:"top-start"}},[a("el-button",{staticStyle:{"margin-top":"15px"},attrs:{size:"mini",type:"primary",circle:"",icon:"el-icon-pie-chart"},on:{click:function(t){return e.showProjectPanorama()}}})],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"批注",placement:"top-start"}},[a("el-button",{staticClass:"postillBtn",attrs:{circle:"",size:"mini",icon:"el-icon-edit-outline"},on:{click:e.openDrawer}})],1)],1)],1)],1):e._e(),e._v(" "),e.isShowTableContent?a("el-main",{style:e.isZoom?"":"margin-top:10px"},[e.isLastActive?a("div",{staticClass:"zoomInOrOut"},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"设置合并区间",placement:"top-start"}},[a("el-button",{staticClass:"confirmFinished initBtn",attrs:{circle:"",type:"primary",size:"mini",icon:"el-icon-setting"},on:{click:function(t){return e.setMergeInterval()}}})],1),e._v(" "),a("el-dropdown",{staticStyle:{"margin-left":"5px"},attrs:{placement:"top",trigger:"click"},on:{command:e.handleCommand}},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"抵消分录",placement:"top-start"}},[a("el-button",{staticClass:"restBtn",attrs:{circle:"",type:"primary",size:"mini",icon:"el-icon-refresh-right"}})],1),e._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{command:"investment"}},[e._v("\n                        重新生成投资抵消\n                    ")]),e._v(" "),a("el-dropdown-item",{attrs:{command:"reciprocal"}},[e._v("\n                        重新生成往来抵消\n                    ")]),e._v(" "),a("el-dropdown-item",{attrs:{command:"tsrade"}},[e._v("\n                        重新生成内部交易抵消\n                    ")]),e._v(" "),a("el-dropdown-item",{attrs:{command:"reCreateCostOffset"}},[e._v("\n                    重新生成成本法抵消\n                  ")]),e._v(" "),a("el-dropdown-item",{attrs:{command:"statement"}},[e._v("\n                        重新生成现金流量表抵消\n                    ")])],1)],1),e._v(" "),e.isShowProjectPanorama||"2"!=e.editableTabsValue?e._e():a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:" 附注校验",placement:"top-start"}},[e.isShowProjectPanorama||"2"!=e.editableTabsValue?e._e():a("el-button",{staticClass:"confirmFinished initBtn",attrs:{circle:"",type:"primary",size:"mini",icon:"el-icon-folder-checked"},on:{click:function(t){return e.reValidSonCompanyNote()}}})],1),e._v(" "),e.isShowProjectPanorama||"2"!=e.editableTabsValue?e._e():a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"初始化子公司数据",placement:"top-start"}},[e.isShowProjectPanorama||"2"!=e.editableTabsValue?e._e():a("el-button",{staticClass:"restBtn",attrs:{circle:"",type:"primary",size:"mini",icon:"el-icon-switch-button"},on:{click:function(t){return e.initSonCompanyData()}}})],1),e._v(" "),e.isShowProjectPanorama||"2"!=e.editableTabsValue?e._e():a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"设置TB借贷方向",placement:"top-start"}},[e.isShowProjectPanorama||"2"!=e.editableTabsValue?e._e():a("el-button",{staticClass:"confirmFinished initBtn",attrs:{circle:"",type:"primary",size:"mini",icon:"el-icon-coin"},on:{click:function(t){return e.rejustDebCre()}}})],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"确认完成",placement:"top-start"}},[e.isShowProjectPanorama?e._e():a("el-button",{staticClass:"confirmFinished",attrs:{circle:"",type:"success",size:"mini",icon:"el-icon-check"},on:{click:function(t){return e.finished()}}})],1),e._v(" "),e.isZoom?a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"全屏显示",placement:"top-start"}},[e.isZoom?a("i",{staticClass:"el-icon-caret-top",on:{click:function(t){return t.preventDefault(),e.zoomOut()}}}):e._e()]):e._e(),e._v(" "),e.isZoom?e._e():a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"缩小",placement:"top-start"}},[e.isZoom?e._e():a("i",{staticClass:"el-icon-caret-bottom",on:{click:function(t){return t.preventDefault(),e.zoomIn()}}})])],1):e._e(),e._v(" "),e.isShowProjectPanorama?e._e():a("el-tabs",{staticClass:"indexTabs",attrs:{type:"card",closable:""},on:{"tab-remove":e.removeTab,"tab-click":e.editTab},model:{value:e.editableTabsValue,callback:function(t){e.editableTabsValue=t},expression:"editableTabsValue"}},e._l(e.tabList,function(t){return a("el-tab-pane",{key:t.name,attrs:{label:t.title,name:t.name}},[a("span",{attrs:{slot:"label"},slot:"label"},[t.isMark?a("el-badge",{staticClass:"item",attrs:{"is-dot":""}}):e._e(),e._v("\n                    "+e._s(t.title)+"\n                ")],1)])}),1),e._v(" "),a("keep-alive",[e.isRouterAlive?a("router-view",{key:e.$route.path,ref:"curAssembly"}):e._e()],1)],1):e._e(),e._v(" "),e.isOpenDrawer?a("Postill",{ref:"postill",attrs:{menuID:e.menuID,activeLabel:e.activeLabel,limitArr:e.limitArr},on:{closePostill:e.closePostill,isPostil:e.isPostil}}):e._e(),e._v(" "),a("el-dialog",{attrs:{visible:e.dialogVisible,title:"项目全景图","lock-scroll":!0,"close-on-press-escape":!0,width:"90%","before-close":e.closeProjectPanorama},on:{"update:visible":function(t){e.dialogVisible=t},opened:e.opened}},[a("project-panorama",{ref:"panorama"}),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeProjectPanorama}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.saveEdit}},[e._v("保存")])],1)],1),e._v(" "),a("el-dialog",{attrs:{visible:e.mergeRangeDialog,"destroy-on-close":!0,width:"50%","append-to-body":""},on:{"update:visible":function(t){e.mergeRangeDialog=t}}},[a("div",{staticClass:"identi",staticStyle:{display:"flex","justify-content":"space-between","line-height":"50%",width:"100%",color:"white"},attrs:{slot:"title"},slot:"title"},[a("span",[e._v("设置合并区间")]),e._v(" "),a("div",{staticStyle:{"margin-right":"20px"}},[a("span",{staticClass:"titleBtn",on:{click:function(t){return e.addMergeClick(e.mergeTabsIndex)}}},[e._v("\n                        新增\n                    ")])])]),e._v(" "),a("merge-range-modal",{ref:"mergeRange",attrs:{tableData:e.mergeRangeData,subjectData:e.subjectData},on:{send:e.sendIndex,changeTableData:e.changeTableData,deleteTableData:e.deleteTableData}})],1),e._v(" "),a("el-dialog",{attrs:{title:"新增固定资产折旧年限",visible:e.addFixedDialog,"destroy-on-close":!0,width:"40%"},on:{"update:visible":function(t){e.addFixedDialog=t}}},[a("el-form",{ref:"fixedAssetsForm",attrs:{model:e.fixedAssetsForm,rules:e.mergeScopedEditFormRule}},[a("el-form-item",{attrs:{prop:"subjectName",label:"类别","label-width":"9vw"}},[a("el-popover",{staticStyle:{"max-width":"300px",width:"100%"},attrs:{placement:"bottom",trigger:"click"}},[a("el-scrollbar",{staticStyle:{height:"300px","min-width":"300px","max-width":"300px",width:"100%"}},[a("el-input",{staticStyle:{position:"fixed","z-index":"1111","max-width":"300px"},attrs:{placeholder:"输入关键字搜索"},model:{value:e.fixedAssetsText,callback:function(t){e.fixedAssetsText=t},expression:"fixedAssetsText"}}),e._v(" "),a("el-tree",{ref:"fixedAssetsTree",staticStyle:{"padding-top":"50px"},attrs:{data:e.subjectData,props:e.subjectProps,"filter-node-method":e.filterNode},on:{"check-change":e.handleCheckChange,"node-click":function(t,a,i){return e.handleNodeClick(t,a,i,1)}}})],1),e._v(" "),a("el-button",{staticStyle:{"max-width":"394px",height:"40px",width:"100%",display:"flex","padding-left":"14px"},attrs:{slot:"reference",placeholder:"请选择类别"},slot:"reference",model:{value:e.fixedAssetsForm.subjectName,callback:function(t){e.$set(e.fixedAssetsForm,"subjectName","string"==typeof t?t.trim():t)},expression:"fixedAssetsForm.subjectName"}},[e._v("\n                        "+e._s(e.fixedAssetsForm.subjectName)+"\n                        "),a("span",{staticStyle:{color:"#d9d9d9","font-size":"12px"}},[e._v(e._s(e.text))])])],1)],1),e._v(" "),a("el-form-item",{attrs:{prop:"depreciationMethod",label:"折旧方法","label-width":"9vw"}},[a("el-select",{staticClass:"addInput",attrs:{placeholder:"请选择折旧方法"},model:{value:e.fixedAssetsForm.depreciationMethod,callback:function(t){e.$set(e.fixedAssetsForm,"depreciationMethod","string"==typeof t?t.trim():t)},expression:"fixedAssetsForm.depreciationMethod"}},e._l(e.depreciationOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{prop:"depreciableLife",label:"折旧年限(年)","label-width":"9vw"}},[a("el-input",{staticClass:"addInput",attrs:{size:"large",placeholder:"请输入折扣年限"},model:{value:e.fixedAssetsForm.depreciableLife,callback:function(t){e.$set(e.fixedAssetsForm,"depreciableLife","string"==typeof t?t.trim():t)},expression:"fixedAssetsForm.depreciableLife"}},[a("i",{staticClass:"percent",staticStyle:{"font-style":"normal"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("年")])])],1),e._v(" "),a("el-form-item",{attrs:{prop:"ratioRemainingValue",label:"残值率(%)","label-width":"9vw"}},[a("el-input",{staticClass:"addInput",attrs:{size:"large",placeholder:"请输入残值率"},model:{value:e.fixedAssetsForm.ratioRemainingValue,callback:function(t){e.$set(e.fixedAssetsForm,"ratioRemainingValue","string"==typeof t?t.trim():t)},expression:"fixedAssetsForm.ratioRemainingValue"}},[a("i",{staticClass:"percent",staticStyle:{"font-style":"normal"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("%")])])],1),e._v(" "),a("el-form-item",{attrs:{prop:"yearlyDepreciation",label:"年折旧率(%)","label-width":"9vw"}},[a("el-input",{staticClass:"addInput",attrs:{size:"large",placeholder:"请输入年折旧率"},model:{value:e.fixedAssetsForm.yearlyDepreciation,callback:function(t){e.$set(e.fixedAssetsForm,"yearlyDepreciation","string"==typeof t?t.trim():t)},expression:"fixedAssetsForm.yearlyDepreciation"}},[a("i",{staticClass:"percent",staticStyle:{"font-style":"normal"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("%")])])],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"info",size:"small"},on:{click:function(t){e.addFixedDialog=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.addBtn(e.mergeTabsIndex,"fixedAssetsForm")}}},[e._v("确 定")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"新增无形资产摊销",visible:e.addIntangibleDialog,"destroy-on-close":!0,width:"40%"},on:{"update:visible":function(t){e.addIntangibleDialog=t}}},[a("el-form",{ref:"intangibleAssetsForm",attrs:{model:e.intangibleAssetsForm,rules:e.mergeScopedEditFormRule}},[a("el-form-item",{attrs:{prop:"subjectName",label:"项目","label-width":"9vw"}},[a("el-popover",{staticStyle:{"max-width":"300px",width:"100%"},attrs:{placement:"bottom",trigger:"click"}},[a("el-scrollbar",{staticStyle:{height:"300px","min-width":"300px","max-width":"300px",width:"100%"}},[a("el-input",{staticStyle:{position:"fixed","z-index":"1111","max-width":"300px"},attrs:{placeholder:"输入关键字搜索"},model:{value:e.intangibleAssetsText,callback:function(t){e.intangibleAssetsText=t},expression:"intangibleAssetsText"}}),e._v(" "),a("el-tree",{ref:"intangibleAssetsTree",staticStyle:{"padding-top":"50px"},attrs:{data:e.subjectData,props:e.subjectProps,"filter-node-method":e.filterNode},on:{"check-change":e.handleCheckChange,"node-click":function(t,a,i){return e.handleNodeClick(t,a,i,2)}}})],1),e._v(" "),a("el-button",{staticStyle:{"max-width":"394px",height:"40px",width:"100%",display:"flex","padding-left":"14px"},attrs:{slot:"reference"},slot:"reference",model:{value:e.intangibleAssetsForm.subjectName,callback:function(t){e.$set(e.intangibleAssetsForm,"subjectName","string"==typeof t?t.trim():t)},expression:"intangibleAssetsForm.subjectName"}},[e._v("\n                        "+e._s(e.intangibleAssetsForm.subjectName)+"\n                        "),a("span",{staticStyle:{color:"#d9d9d9","font-size":"12px"}},[e._v(e._s(e.text))])])],1)],1),e._v(" "),a("el-form-item",{attrs:{prop:"depreciableLife",label:"预计使用寿命","label-width":"9vw"}},[a("el-input",{staticClass:"addInput",attrs:{size:"large",placeholder:"请输入预计使用寿命"},model:{value:e.intangibleAssetsForm.depreciableLife,callback:function(t){e.$set(e.intangibleAssetsForm,"depreciableLife","string"==typeof t?t.trim():t)},expression:"intangibleAssetsForm.depreciableLife"}},[a("i",{staticClass:"percent",staticStyle:{"font-style":"normal"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("年")])])],1),e._v(" "),a("el-form-item",{attrs:{prop:"depreciationMethod",label:"摊销方法","label-width":"9vw"}},[a("el-select",{staticClass:"addInput",attrs:{placeholder:"请输入摊销方法"},model:{value:e.intangibleAssetsForm.depreciationMethod,callback:function(t){e.$set(e.intangibleAssetsForm,"depreciationMethod","string"==typeof t?t.trim():t)},expression:"intangibleAssetsForm.depreciationMethod"}},e._l(e.depreciationOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{prop:"ratioRemainingValue",label:"残值率(%)","label-width":"9vw"}},[a("el-input",{staticClass:"addInput",attrs:{size:"large",placeholder:"请输入残值率"},model:{value:e.intangibleAssetsForm.ratioRemainingValue,callback:function(t){e.$set(e.intangibleAssetsForm,"ratioRemainingValue","string"==typeof t?t.trim():t)},expression:"intangibleAssetsForm.ratioRemainingValue"}},[a("i",{staticClass:"percent",staticStyle:{"font-style":"normal"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("%")])])],1),e._v(" "),a("el-form-item",{attrs:{prop:"according",label:"依据","label-width":"9vw"}},[a("el-input",{staticClass:"addInput",attrs:{size:"large",placeholder:"请输入依据"},model:{value:e.intangibleAssetsForm.according,callback:function(t){e.$set(e.intangibleAssetsForm,"according","string"==typeof t?t.trim():t)},expression:"intangibleAssetsForm.according"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"info",size:"small"},on:{click:function(t){e.addIntangibleDialog=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.addBtn(e.mergeTabsIndex,"intangibleAssetsForm")}}},[e._v("确 定")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"新增长期待摊费用",visible:e.addPrepaidExpensesDialog,"destroy-on-close":!0,width:"40%"},on:{"update:visible":function(t){e.addPrepaidExpensesDialog=t}}},[a("el-form",{ref:"prepaidExpensesForm",attrs:{model:e.prepaidExpensesForm,rules:e.mergeScopedEditFormRule}},[a("el-form-item",{attrs:{prop:"subjectName",label:"项目","label-width":"9vw"}},[a("el-popover",{staticStyle:{"max-width":"300px",width:"100%"},attrs:{placement:"bottom",trigger:"click"}},[a("el-scrollbar",{staticStyle:{height:"300px","min-width":"300px","max-width":"300px",width:"100%"}},[a("el-input",{staticStyle:{position:"fixed","z-index":"1111","max-width":"300px"},attrs:{placeholder:"输入关键字搜索"},model:{value:e.prepaidExpensesText,callback:function(t){e.prepaidExpensesText=t},expression:"prepaidExpensesText"}}),e._v(" "),a("el-tree",{ref:"prepaidExpensesTree",staticStyle:{"padding-top":"50px"},attrs:{data:e.subjectData,props:e.subjectProps,"filter-node-method":e.filterNode},on:{"check-change":e.handleCheckChange,"node-click":function(t,a,i){return e.handleNodeClick(t,a,i,3)}}})],1),e._v(" "),a("el-button",{staticStyle:{"max-width":"394px",height:"40px",width:"100%",display:"flex","padding-left":"14px"},attrs:{slot:"reference"},slot:"reference"},[e._v("\n                        "+e._s(e.prepaidExpensesForm.subjectName)+"\n                        "),a("span",{staticStyle:{color:"#d9d9d9","font-size":"12px"}},[e._v(e._s(e.text))])])],1)],1),e._v(" "),a("el-form-item",{attrs:{prop:"depreciationMethod",label:"摊销方法","label-width":"9vw"}},[a("el-select",{staticClass:"addInput",attrs:{placeholder:"请输入摊销方法"},model:{value:e.prepaidExpensesForm.depreciationMethod,callback:function(t){e.$set(e.prepaidExpensesForm,"depreciationMethod","string"==typeof t?t.trim():t)},expression:"prepaidExpensesForm.depreciationMethod"}},e._l(e.depreciationOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{prop:"depreciableLife",label:"摊销年限","label-width":"9vw"}},[a("el-input",{staticClass:"addInput",attrs:{size:"large",placeholder:"请输入残值率"},model:{value:e.prepaidExpensesForm.depreciableLife,callback:function(t){e.$set(e.prepaidExpensesForm,"depreciableLife","string"==typeof t?t.trim():t)},expression:"prepaidExpensesForm.depreciableLife"}},[a("i",{staticClass:"percent",staticStyle:{"font-style":"normal"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("年")])])],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"info",size:"small"},on:{click:function(t){e.addPrepaidExpensesDialog=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.addBtn(e.mergeTabsIndex,"prepaidExpensesForm")}}},[e._v("确 定")])],1)],1),e._v(" "),a("counter",{ref:"counter",attrs:{count:e.number},on:{clear:e.clear}})],1)},staticRenderFns:[]};var V=a("VU/8")(O,B,!1,function(e){a("5Y/l")},"data-v-0e6d2f3f",null);t.default=V.exports},"2WPG":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("woOf"),r=a.n(i),s=a("mvHQ"),o=a.n(s),n=a("bOdI"),l=a.n(n),c=a("pFYg"),u=a.n(c),d=a("ABj6"),m=a("ZHXk"),p=a.n(m),f=a("K/T8"),h={data:[{prop:"shortName",label:"项目简称",filterOptions:{disabled:!0}},{prop:"auditAmount",label:"货币资金",filterOptions:{disabled:!0},align:"right",formatter:{type:"function",value:f.b.commafy}},{prop:"percentage",label:"比例",filterOptions:{disabled:!0}}],preData:[{prop:"shortName",label:"项目简称",filterOptions:{disabled:!0}},{prop:"preAuditAmount",label:"货币资金",filterOptions:{disabled:!0},align:"right",formatter:{type:"function",value:f.b.commafy}},{prop:"percentage",label:"比例",filterOptions:{disabled:!0}}],cashFlowData:[{prop:"shortName",label:"项目简称",filterOptions:{disabled:!0}},{prop:"curAmount",label:"货币资金",filterOptions:{disabled:!0},align:"right",formatter:{type:"function",value:f.b.commafy}},{prop:"percentage",label:"比例",filterOptions:{disabled:!0}}],preCashFlowData:[{prop:"shortName",label:"项目简称",filterOptions:{disabled:!0}},{prop:"preAmount",label:"货币资金",filterOptions:{disabled:!0},align:"right",formatter:{type:"function",value:f.b.commafy}},{prop:"percentage",label:"比例",filterOptions:{disabled:!0}}]},g=(a("oGZU"),a("3EDo")),b=a("UGJx"),v=a("0Nqy"),C={name:"mergeTbCur",components:{throughTable:g.a,tableHeadTitle:v.a},props:{column:Array,curData:Array},mixins:[b.a],watch:{column:{handler:function(e){e&&(this.curTbcolumn=e,this.columnCache=JSON.parse(o()(e)))},immediate:!0,deep:!0},curData:{handler:function(e){var t=this;e&&(this.curTbData=e.filter(function(e){return 0!=e.numberMerger}),this.$nextTick(function(){t.allColumnsList=t.$refs.xTable.collectColumn}))},immediate:!0,deep:!0}},data:function(){return{flag:"HB003-MTB001",selectCell:{},throughData:[],debCreDialog:!1,allAlign:"right",_init:!1,fullscreenLoading:!1,singleSubjectDimensionDialog:!1,singleSubjectDimensionData:[],curTbcolumn:this.column,curTbData:this.curData,columns:[],handleColumnsDialogTableVisible:!1,handleColumnsData:[],handleColumnsDataByTag:[],setBorder:!0,setHeight:"40%",debCreDialogTitle:"",dialogTitle:"",isTag:!1,tagList:[],multipleLimit:5,defaultFirstOption:!1,queryTag:"",mergeCurFlag:!1,filterTbColumn:[],filterTbData:[],columnsList:[],allColumnsList:[],columnCache:[],fixedColumns:["colCode","colDisp","totalNumber","debtor","credit"],keyTime:0,row:{}}},methods:{hideCurData:function(e){e&&1===e&&(this.mergeCurFlag=!1);var t=this.curData.filter(function(e){return 0!=e.numberMerger});this.curTbData=t},showCurData:function(){this.curTbData=this.curData,this.mergeCurFlag=!0},iconDownload:function(){var e=this.row,t=JSON.parse(sessionStorage.getItem("curCustomerData")).curYear,a={subjectName:e.colDisp,subjectId:e.colCode,summaryType:"0",year:t};this.$sacpApis.exportSubsidiaryData(a)},handleBackspace:function(){this.keyTime?(this.tagList&&(this.tagList.length?this.queryTbDataByTag():this.getConfigColumns("tag")),this.keyTime=0):this.keyTime++},handleInputConfirm:function(){var e=this;return this.queryTag.trim()?this.tagList.some(function(t){return t===e.queryTag})?this.$message.error("当前标签已经存在!"):void(this.queryTag.trim()&&this.tagList.length<5?(this.tagList.push(this.queryTag),this.queryTbDataByTag()):(this.$message.error("标签限制数量为5个!"),this.queryTag="")):this.$message.error("请输入标签内容!")},remoteMethod:function(e){if(e&&e.length>10)return this.$message.warning("标签限制长度为10 !按下回车键将自动截取当前编辑标签的前10位 !");this.queryTag=e},removeTag:function(e){this.tagList=this.tagList.filter(function(t){return t!=e}),this.tagList.length?this.queryTbDataByTag():this.getConfigColumns("tag")},queryTbDataByTag:function(){var e=this;this.fullscreenLoading=!0;var t="";p.a.arrayEach(this.tagList,function(a,i){return t+=i<e.tagList.length-1?a+"|":""+a}),this.$sacpApis.findMergeTbByMergeProject(t).then(function(t){e.handleColumnsData=t&&t.tbColumn?t.tbColumn.filter(function(e){return"colCode"!=e.prop&&"colDisp"!=e.prop&&"totalNumber"!=e.prop&&"debtor"!=e.prop&&"credit"!=e.prop&&"numberMerger"!=e.prop}):[],e.filterTbColumn=t&&t.tbColumn?t.tbColumn:[],e.filterTbData=t&&t.curData?t.curData:[]}).catch(function(t){return e.$message.error(t)}).finally(function(){var t=[];e.handleColumnsData.map(function(e){t.push(e.prop)});for(var a=function(a){p.a.includes(e.fixedColumns,e.columnCache[a].prop)||p.a.includes(t,e.columnCache[a].prop)?p.a.includes(t,e.columnCache[a].prop)&&e.handleColumnsData.forEach(function(t){return t.visible=t.prop===e.columnCache[a].prop?e.columnCache[a].visible:t.visible}):(e.columnCache[a].visible=!0,e.onHeadConfigChange(e.columnCache[a]))},i=0;i<e.columnCache.length;i++)a(i);e.curTbcolumn=e.columnCache,e.curTbData=e.filterTbData,e.fullscreenLoading=!1})},refresh:function(e){this.refreshTable()},refreshTable:function(){this.tagList&&this.tagList.length&&(this.tagList=[],this.getConfigColumns("tag")),this.$emit("isInit",!0)},commafyFn:function(e){var t=e.cellValue;e.row,e.column;return p.a.commafy(t,{digits:2})},initMergeTb:function(){var e=this;this.fullscreenLoading=!0,this.$sacpApis.initTbAndCaseSheet({}).then(function(t){t.success?(e._init=!0,e.$message.success("初始化成功!"),e.$emit("refreshIndexes",t.resultInfo.refreshIndexes)):e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)}).finally(function(){e.fullscreenLoading=!1})},cellStyle:function(e){e.row,e.rowIndex;var t=e.column;e.columnIndex;if("colDisp"==t.property)return{textDecoration:"underline",cursor:"pointer"}},handleCellClick:function(e){var t=e.row,a=(e.rowIndex,e.$rowIndex,e.column);e.columnIndex,e.$columnIndex,e.cell;if("colDisp"==a.property){this.columns.forEach(function(e){"auditAmount"==e.prop&&(e.label=t.colDisp)}),this.row=t,this.singleSubjectDimensionData=[];for(var i=t.totalNumber,r=(i+="").split("."),s=r[0],o=r.length>1?"."+r[1]:"",n=/(\d+)(\d{3})/;n.test(s);)s=s.replace(n,"$1,$2");this.handleSubsidiaryData(t),this.dialogTitle="单科目维度:"+t.colDisp+"(汇总数:"+(s+o)+")"}},handleCellDblclick:function(e){var t=this,a=e.row,i=(e.rowIndex,e.$rowIndex,e.column);e.columnIndex,e.$columnIndex,e.cell;if("debtor"==i.property||"credit"==i.property){if(!a.relatedCode)return void this.$message.warning("合计项无法查看详细!");"debtor"==i.property?this.debCreDialogTitle="借方抵销:"+a.colCode+"-"+a.colDisp:"credit"==i.property&&(this.debCreDialogTitle="贷方抵销:"+a.colCode+"-"+a.colDisp);var r=JSON.parse(sessionStorage.getItem("curCustomerData")).curProjectId;this.selectCell={subjectId:a.colCode,projectId:r,year:JSON.parse(sessionStorage.getItem("curCustomerData")).curYear,activeFlag:null,subjectName:a.colDisp,adjustType:2},this.$store.commit("setCell",this.selectCell),this.$sacpApis.offsetThrough(this.selectCell).then(function(e){e.success&&(t.throughData=e.data)}).catch(function(e){return t.$message.error(e)}).finally(function(){t.debCreDialog=!0})}},exportMergeTrialBalance:function(){this.$sacpApis.exportMergeTrialBalance("合并试算平衡表.xlsx")},selectVisiableColumns:function(e){this.getConfigColumns(e),this.handleColumnsDialogTableVisible=!0},hiddenAll:function(){var e=this;this.columnsList=this.$refs.xTable.getColumns(),this.handleColumnsData.forEach(function(t){t.visible=!0;var a=e.columnsList.filter(function(e){return e.property===t.prop});a&&a.length&&e.$refs.xTable.hideColumn(a[0]),e.columnCache.map(function(e){e.prop===t.prop&&(e.visible=!0)}),e.curTbcolumn=e.columnCache})},showAll:function(){var e=this;this.handleColumnsData.forEach(function(t){t.visible=!1;var a=e.allColumnsList.filter(function(e){return e.property===t.prop});a&&a.length&&e.$refs.xTable.showColumn(a[0]),e.columnCache.map(function(e){e.prop===t.prop&&(e.visible=!1)}),e.curTbcolumn=e.columnCache})},onHeadConfigChange:function(e){var t=this.allColumnsList.filter(function(t){return t.property===e.prop});t&&t.length&&(e.visible?this.$refs.xTable.hideColumn(t[0]):this.$refs.xTable.showColumn(t[0]))},recoverHeadConfig:function(){this.isTag=!1,this.handleColumnsDialogTableVisible=!1},getConfigColumns:function(e){var t=this;"last"!=e&&(this.isTag=!0),"last"===e?this.handleColumnsData=this.columnCache&&this.columnCache.length?this.columnCache.filter(function(e){return p.a.includes(t.fixedColumns,e.prop)&&"colDisp"!=e.prop&&"colCode"!=e.prop}):[]:"all"===e?this.tagList&&this.tagList.length?this.handleColumnsData=this.filterTbColumn&&this.filterTbColumn.length?this.filterTbColumn.filter(function(e){return!p.a.includes(t.fixedColumns,e.prop)}):[]:this.handleColumnsData=this.columnCache:"tag"===e&&(this.handleColumnsData=this.columnCache&&this.columnCache.length?this.columnCache.filter(function(e){return!p.a.includes(t.fixedColumns,e.prop)}):[],this.curTbData=this.curData,this.showAll())},handleSubsidiaryData:function(e){var t=this,a=JSON.parse(sessionStorage.getItem("curCustomerData")).curYear,i={subjectId:e.colCode,summaryType:"0",year:a};this.$sacpApis.mergeTBSubsidiary(i).then(function(e){e.success?t.singleSubjectDimensionData=e.data:t.$message.error(e.resultInfo.statusText)}).catch(function(e){return t.$message.error(e)}).finally(function(){t.singleSubjectDimensionDialog=!0})},addNbsp:function(e){var t=e.cellValue;e.row,e.column;if(t.match(new RegExp(/\s/g)))for(var a=t.match(new RegExp(/\s/g)).length,i=0;i<=a-1;i++)t=" "+t;return t},exportFile:function(){this.exportMergeTrialBalance()}},created:function(){h&&(this.columns=h.data)},mounted:function(){this.hideCurData()}},y={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"mergeTbCur"},[a("div",{staticClass:"columnsVisiable",staticStyle:{float:"right","margin-bottom":"8px"}},[0==e.mergeCurFlag?a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"展示全部数据",placement:"top-start"}},[a("el-button",{staticClass:"initBtn",attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-sort-down"},on:{click:e.showCurData}})],1):e._e(),e._v(" "),1==e.mergeCurFlag?a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"隐藏合并数为0",placement:"top-start"}},[a("el-button",{staticClass:"initBtn",attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-sort-up"},on:{click:function(t){return e.hideCurData(1)}}})],1):e._e(),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"初始化合并试算平衡表",placement:"top-start"}},[a("el-button",{staticClass:"setBtn",attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-switch-button"},on:{click:e.initMergeTb}})],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"列设置",placement:"top-start"}},[a("el-button",{attrs:{circle:"",icon:"el-icon-s-grid",type:"primary",size:"small"},on:{click:function(t){return e.selectVisiableColumns("all")}}})],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"隐藏最后四列",placement:"top-start"}},[a("el-button",{attrs:{circle:"",icon:"el-icon-video-play",type:"primary",size:"small"},on:{click:function(t){return e.selectVisiableColumns("last")}}})],1)],1),e._v(" "),a("div",{staticClass:"tableDiv"},[a("table-head-title",{attrs:{columns:e.curTbcolumn,pageTotal:e.curTbData.length,refreshTable:e.refreshTable,exportReport:!0},on:{exportFile:e.exportFile}}),e._v(" "),a("vxe-table",{ref:"xTable",attrs:{border:"",resizable:"","highlight-hover-row":"","highlight-current-row":"","show-overflow":"","show-header-overflow":"","keep-source":"",height:"auto","auto-resize":!0,data:e.curTbData,"scroll-y":{vSize:1e4},"cell-style":e.cellStyle,"tooltip-config":{enterable:!0}},on:{"cell-click":e.handleCellClick,"cell-dblclick":e.handleCellDblclick}},e._l(e.curTbcolumn,function(t,i){return a("vxe-table-column",{key:i,attrs:{field:t.prop,title:t.label,fixed:t.fixed?t.fixed:"","header-align":"center",align:t.isMoney?e.allAlign:"",formatter:t.isMoney?e.commafyFn:"colDisp"==t.prop?e.addNbsp:"","min-width":t.width?t.width:100,visiable:t.visiable}})}),1)],1),e._v(" "),a("el-dialog",{staticClass:"singleSubjectTable",attrs:{title:e.dialogTitle,visible:e.singleSubjectDimensionDialog,width:"70%"},on:{"update:visible":function(t){e.singleSubjectDimensionDialog=t}}},[a("i",{staticClass:"el-icon-download",on:{click:e.iconDownload}}),e._v(" "),a("bdo-table",{ref:"table",attrs:{columns:e.columns,"enable-filter":!1,"enable-toolbox":!1,"enable-view-type":!1,data:e.singleSubjectDimensionData,"show-overflow-tooltip":"","page-total":e.singleSubjectDimensionData?e.singleSubjectDimensionData.length:0,showIndexColumn:!1,showCheckBox:!1,headerListConfig:!1,headerCellStyleSelf:{"text-align":"left"},setBorder:e.setBorder}})],1),e._v(" "),a("el-dialog",{staticClass:"changeFilterTableMethodsDialog",attrs:{visible:e.handleColumnsDialogTableVisible,"before-close":e.recoverHeadConfig,width:"60%"},on:{"update:visible":function(t){e.handleColumnsDialogTableVisible=t}}},[a("template",{slot:"title"},[a("div",{staticClass:"headerTitle"},[a("span",{staticClass:"el-dialog__title"},[e._v("表头编辑")]),e._v(" "),e.isTag?a("el-select",{staticClass:"tagInput mergeTbTagInput",attrs:{multiple:"","multiple-limit":e.multipleLimit,filterable:"","allow-create":"","default-first-option":e.defaultFirstOption,placeholder:"输入标签内容，用回车添加","filter-method":e.remoteMethod},on:{"remove-tag":e.removeTag},nativeOn:{keyup:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"backspace",void 0,t.key,void 0)?null:e.handleBackspace(t)},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleInputConfirm(t)}]},model:{value:e.tagList,callback:function(t){e.tagList=t},expression:"tagList"}}):e._e()],1)]),e._v(" "),a("el-table",{ref:"elTable",attrs:{data:e.handleColumnsData,size:"small","max-height":"300px"}},[a("el-table-column",{attrs:{type:"index"}}),e._v(" "),a("el-table-column",{attrs:{prop:"label",label:"表头字段"}}),e._v(" "),a("el-table-column",{attrs:{label:"是否隐藏"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#C0C4CC"},on:{change:function(a){return e.onHeadConfigChange(t.row)}},model:{value:t.row.visible,callback:function(a){e.$set(t.row,"visible",a)},expression:"scope.row.visible"}})]}}])})],1),e._v(" "),a("div",{staticStyle:{"text-align":"center"},attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{round:"",size:"small",type:"primary"},on:{click:e.hiddenAll}},[e._v("全 部 隐 藏\n            ")]),e._v(" "),a("el-button",{attrs:{round:"",size:"small",type:"primary"},on:{click:e.showAll}},[e._v("全 部 开 启\n            ")]),e._v(" "),a("el-button",{attrs:{round:"",size:"small",type:"warning"},on:{click:e.showAll}},[e._v("重 置")])],1)],2),e._v(" "),a("el-dialog",{staticClass:"debCreDialog",attrs:{title:e.debCreDialogTitle,visible:e.debCreDialog,width:"90%"},on:{"update:visible":function(t){e.debCreDialog=t}}},[a("throughTable",{attrs:{throughData:e.throughData,selectCell:e.selectCell}})],1)],1)},staticRenderFns:[]};var I=a("VU/8")(C,y,!1,function(e){a("oGeI")},"data-v-965ec1b4",null).exports,x={name:"mergeTbLast",props:{column:Array,curData:Array},components:{throughTable:g.a,tableHeadTitle:v.a},mixins:[b.a],watch:{column:{handler:function(e){e&&(this.tbColumns=e,this.columnCache=JSON.parse(o()(e)))},immediate:!0,deep:!0},curData:{handler:function(e){var t=this;e&&(this.tbData=e.filter(function(e){return 0!=e.numberMerger}),this.$nextTick(function(){return t.allColumnsList=t.$refs.xTable.collectColumn}))},immediate:!0,deep:!0}},data:function(){return{flag:"HB003-MTB002",selectCell:{},debCreDialog:!1,throughData:[],tbColumns:JSON.parse(o()(this.column)),tbData:this.curData,allAlign:"right",_init:!1,fullscreenLoading:!1,singleSubjectDimensionDialog:!1,columns:[],singleSubjectDimensionData:[],handleColumnsDataDialogTableVisible:!1,handleColumnsData:[],setBorder:!0,debCreDialogTitle:"",dialogTitle:"",isTag:!1,tagList:[],multipleLimit:5,loading:!1,defaultFirstOption:!1,queryTag:"",mergeLastFlag:!1,filterTbColumn:[],filterTbData:[],columnsList:[],allColumnsList:[],columnCache:[],fixedColumns:["colCode","colDisp","totalNumber","debtor","credit","numberMerger"],keyTime:0,row:{}}},methods:{hideLastData:function(e){e&&1===e&&(this.mergeLastFlag=!1);var t=this.curData.filter(function(e){return 0!=e.numberMerger});this.tbData=t},showLastData:function(){this.tbData=this.curData,this.mergeLastFlag=!0},iconDownload:function(){var e=this.row,t=JSON.parse(sessionStorage.getItem("curCustomerData")).curYear,a={subjectName:e.colDisp,subjectId:e.colCode,summaryType:"0",year:+t-1};this.$sacpApis.exportSubsidiaryData(a)},exportMergeTrialBalance:function(){this.$sacpApis.exportMergeTrialBalance("合并试算平衡表.xlsx")},handleBackspace:function(){this.keyTime?(this.tagList&&(this.tagList.length?this.queryTbDataByTag():this.getConfigColumns("tag")),this.keyTime=0):this.keyTime++},handleInputConfirm:function(){var e=this;return this.queryTag.trim()?this.tagList.some(function(t){return t===e.queryTag})?this.$message.error("当前标签已经存在!"):void(this.queryTag.trim()&&this.tagList.length<5?(this.tagList.push(this.queryTag),this.queryTbDataByTag()):(this.$message.error("标签限制数量为5个!"),this.queryTag="")):this.$message.error("请输入标签内容!")},remoteMethod:function(e){if(e&&e.length>10)return this.$message.warning("标签限制长度为10 !按下回车键将自动截取当前编辑标签的前10位 !");this.queryTag=e},removeTag:function(e){this.tagList=this.tagList.filter(function(t){return t!=e}),this.tagList.length?this.queryTbDataByTag():this.getConfigColumns("tag")},queryTbDataByTag:function(){var e=this;this.fullscreenLoading=!0;var t="";p.a.arrayEach(this.tagList,function(a,i){return t+=i<e.tagList.length-1?a+"|":""+a}),this.$sacpApis.findMergeTbByMergeProject(t).then(function(t){e.handleColumnsData=t&&t.tbColumn?t.tbColumn.filter(function(e){return"colCode"!=e.prop&&"colDisp"!=e.prop&&"totalNumber"!=e.prop&&"debtor"!=e.prop&&"credit"!=e.prop&&"numberMerger"!=e.prop}):[],e.filterTbColumn=t&&t.tbColumn?t.tbColumn:[],e.filterTbData=t&&t.preData?t.preData:[]}).catch(function(t){return e.$message.error(t)}).finally(function(){var t=[];e.handleColumnsData.map(function(e){t.push(e.prop)});for(var a=function(a){p.a.includes(e.fixedColumns,e.columnCache[a].prop)||p.a.includes(t,e.columnCache[a].prop)?p.a.includes(t,e.columnCache[a].prop)&&e.handleColumnsData.forEach(function(t){return t.visible=t.prop===e.columnCache[a].prop?e.columnCache[a].visible:t.visible}):(e.columnCache[a].visible=!0,e.onHeadConfigChange(e.columnCache[a]))},i=0;i<e.columnCache.length;i++)a(i);e.tbColumns=e.columnCache,e.tbData=e.filterTbData,e.fullscreenLoading=!1})},refresh:function(e){this.refreshTable()},refreshTable:function(){this.tagList&&this.tagList.length&&(this.tagList=[],this.getConfigColumns("tag")),this.$emit("isInit",!0)},showTooltipMethod:function(e){e.type,e.column,e.row,e.items,e._columnIndex},commafyFn:function(e){var t=e.cellValue;e.row,e.column;return p.a.commafy(t,{digits:2})},initMergeTb:function(){var e=this;this.fullscreenLoading=!0,this.$sacpApis.initTbAndCaseSheet({}).then(function(t){t.success?(e._init=!0,e.$message.success("初始化成功!"),e.$emit("refreshIndexes",t.resultInfo.refreshIndexes)):e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)}).finally(function(){e.fullscreenLoading=!1})},cellStyle:function(e){e.row,e.rowIndex;var t=e.column;e.columnIndex;if("colDisp"==t.property)return{textDecoration:"underline",cursor:"pointer"}},handleCellClick:function(e){var t=e.row,a=(e.rowIndex,e.$rowIndex,e.column);e.columnIndex,e.$columnIndex,e.cell;if("colDisp"==a.property){this.columns.forEach(function(e){"preAuditAmount"==e.prop&&(e.label=t.colDisp)}),this.row=t,this.singleSubjectDimensionData=[];for(var i=t.totalNumber,r=(i+="").split("."),s=r[0],o=r.length>1?"."+r[1]:"",n=/(\d+)(\d{3})/;n.test(s);)s=s.replace(n,"$1,$2");this.singleSubjectDimensionData=[],this.handleSubsidiaryData(t),this.dialogTitle="单科目维度:"+t.colDisp+"(汇总数:"+(s+o)+")"}},handleCellDblclick:function(e){var t=this,a=e.row,i=(e.rowIndex,e.$rowIndex,e.column);e.columnIndex,e.$columnIndex,e.cell;if("debtor"==i.property||"credit"==i.property){if(!a.relatedCode)return void this.$message.warning("合计项无法查看详细!");"debtor"==i.property?this.debCreDialogTitle="借方抵销:"+a.colCode+"-"+a.colDisp:"credit"==i.property&&(this.debCreDialogTitle="贷方抵销:"+a.colCode+"-"+a.colDisp);var r=JSON.parse(sessionStorage.getItem("curCustomerData")).curProjectId;this.selectCell={subjectId:a.colCode,projectId:r,year:JSON.parse(sessionStorage.getItem("curCustomerData")).curYear-1,activeFlag:null,subjectName:a.colDisp,isLast:!0,adjustType:2},this.$store.commit("setCell",this.selectCell),this.$sacpApis.offsetThrough(this.selectCell).then(function(e){e.success&&(t.throughData=e.data)}).catch(function(e){return t.$message.error(e)}).finally(function(){t.debCreDialog=!0})}},selectVisiableColumns:function(e){this.getConfigColumns(e),this.handleColumnsDataDialogTableVisible=!0},hiddenAll:function(){var e=this;this.columnsList=this.$refs.xTable.getColumns(),this.handleColumnsData.forEach(function(t){t.visible=!0;var a=e.columnsList.filter(function(e){return e.property===t.prop});a&&a.length&&e.$refs.xTable.hideColumn(a[0]),e.columnCache.map(function(e){e.prop===t.prop&&(e.visible=!0)}),e.tbColumns=e.columnCache})},showAll:function(){var e=this;this.handleColumnsData.forEach(function(t){t.visible=!1;var a=e.allColumnsList.filter(function(e){return e.property===t.prop});a&&a.length&&e.$refs.xTable.showColumn(a[0]),e.columnCache.map(function(e){e.prop===t.prop&&(e.visible=!1)}),e.tbColumns=e.columnCache})},onHeadConfigChange:function(e){var t=this.allColumnsList.filter(function(t){return t.property===e.prop});t&&t.length&&(e.visible?this.$refs.xTable.hideColumn(t[0]):this.$refs.xTable.showColumn(t[0]))},recoverHeadConfig:function(){this.isTag=!1,this.handleColumnsDataDialogTableVisible=!1},getConfigColumns:function(e){var t=this;"last"!=e&&(this.isTag=!0),"last"===e?this.handleColumnsData=this.columnCache&&this.columnCache.length?this.columnCache.filter(function(e){return p.a.includes(t.fixedColumns,e.prop)&&"colDisp"!=e.prop&&"colCode"!=e.prop}):[]:"all"===e?this.tagList&&this.tagList.length?this.handleColumnsData=this.filterTbColumn&&this.filterTbColumn.length?this.filterTbColumn.filter(function(e){return!p.a.includes(t.fixedColumns,e.prop)}):[]:this.handleColumnsData=this.columnCache&&this.columnCache.length?this.columnCache.filter(function(e){return!p.a.includes(t.fixedColumns,e.prop)}):[]:"tag"===e&&(this.handleColumnsData=this.columnCache&&this.columnCache.length?this.columnCache.filter(function(e){return!p.a.includes(t.fixedColumns,e.prop)}):[],this.tbData=this.curData,this.showAll())},handleSubsidiaryData:function(e){var t=this,a=JSON.parse(sessionStorage.getItem("curCustomerData")).curYear,i={subjectId:e.colCode,summaryType:"0",year:Number(a)-1};this.$sacpApis.mergeTBSubsidiary(i).then(function(e){e.success?t.singleSubjectDimensionData=e.data:t.$message.error(e.resultInfo.statusText)}).catch(function(e){return t.$message.error(e)}).finally(function(){t.singleSubjectDimensionDialog=!0})},addNbsp:function(e){var t=e.cellValue;e.row,e.column;if(t.match(new RegExp(/\s/g)))for(var a=t.match(new RegExp(/\s/g)).length,i=0;i<=a-1;i++)t=" "+t;return t}},created:function(){h&&(this.columns=h.preData)},mounted:function(){this.hideLastData()}},w={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"mergeTbLast"},[a("div",{staticClass:"columnsVisiable",staticStyle:{float:"right","margin-bottom":"8px"}},[0==e.mergeLastFlag?a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"展示全部数据",placement:"top-start"}},[a("el-button",{staticClass:"initBtn",attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-sort-down"},on:{click:e.showLastData}})],1):e._e(),e._v(" "),1==e.mergeLastFlag?a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"隐藏合并数为0",placement:"top-start"}},[a("el-button",{staticClass:"initBtn",attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-sort-up"},on:{click:function(t){return e.hideLastData(1)}}})],1):e._e(),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"初始化合并试算平衡表",placement:"top-start"}},[a("el-button",{staticClass:"setBtn",attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-switch-button"},on:{click:e.initMergeTb}})],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"列设置",placement:"top-start"}},[a("el-button",{attrs:{circle:"",icon:"el-icon-s-grid",type:"primary",size:"small"},on:{click:function(t){return e.selectVisiableColumns("all")}}})],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"隐藏最后四列",placement:"top-start"}},[a("el-button",{attrs:{circle:"",icon:"el-icon-video-play",type:"primary",size:"small"},on:{click:function(t){return e.selectVisiableColumns("last")}}})],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"导出",placement:"top-start"}},[a("el-button",{attrs:{circle:"",icon:"el-icon-download",type:"primary",size:"small"},on:{click:function(t){return e.exportMergeTrialBalance()}}})],1)],1),e._v(" "),a("div",{staticClass:"tableDiv"},[a("table-head-title",{attrs:{columns:e.columns,pageTotal:e.tbData.length,refreshTable:e.refreshTable}}),e._v(" "),a("vxe-table",{ref:"xTable",attrs:{border:"",resizable:"","highlight-hover-row":"","highlight-current-row":"","show-overflow":"","show-header-overflow":"","export-config":"",height:"auto","auto-resize":!0,data:e.tbData,"scroll-y":{vSize:1e4},"sort-config":{trigger:"cell"},"tooltip-config":{contentMethod:e.showTooltipMethod,enterable:!0},"cell-style":e.cellStyle},on:{"cell-click":e.handleCellClick,"cell-dblclick":e.handleCellDblclick}},e._l(e.tbColumns,function(t,i){return a("vxe-table-column",{key:i,attrs:{"header-align":"center",field:t.prop,title:t.label,fixed:t.fixed?t.fixed:"",align:t.isMoney?e.allAlign:"",formatter:t.isMoney?e.commafyFn:t.prop?e.addNbsp:"","min-width":t.width?t.width:100,visiable:t.visiable}})}),1)],1),e._v(" "),a("el-dialog",{staticClass:"singleSubjectTable",attrs:{title:e.dialogTitle,visible:e.singleSubjectDimensionDialog,width:"70%"},on:{"update:visible":function(t){e.singleSubjectDimensionDialog=t}}},[a("i",{staticClass:"el-icon-download",on:{click:e.iconDownload}}),e._v(" "),a("bdo-table",{ref:"table",attrs:{columns:e.columns,"enable-filter":!1,"enable-toolbox":!1,"enable-view-type":!1,data:e.singleSubjectDimensionData,"show-overflow-tooltip":"","page-total":e.singleSubjectDimensionData?e.singleSubjectDimensionData.length:0,showIndexColumn:!1,showCheckBox:!1,headerListConfig:!1,headerCellStyleSelf:{"text-align":"left"},setBorder:e.setBorder}})],1),e._v(" "),a("el-dialog",{staticClass:"changeFilterTableMethodsDialog",attrs:{visible:e.handleColumnsDataDialogTableVisible,width:"60%","before-close":e.recoverHeadConfig},on:{"update:visible":function(t){e.handleColumnsDataDialogTableVisible=t}}},[a("template",{slot:"title"},[a("div",{staticClass:"headerTitle"},[a("span",{staticClass:"el-dialog__title"},[e._v("标签编辑")]),e._v(" "),e.isTag?a("el-select",{staticClass:"tagInput mergeTbTagInput",attrs:{multiple:"","multiple-limit":e.multipleLimit,filterable:"","allow-create":"","default-first-option":e.defaultFirstOption,placeholder:"输入标签内容，用回车添加","filter-method":e.remoteMethod},on:{"remove-tag":e.removeTag},nativeOn:{keyup:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"backspace",void 0,t.key,void 0)?null:e.handleBackspace(t)},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleInputConfirm(t)}]},model:{value:e.tagList,callback:function(t){e.tagList=t},expression:"tagList"}}):e._e()],1)]),e._v(" "),a("el-table",{attrs:{data:e.handleColumnsData,size:"small","max-height":"300px"}},[a("el-table-column",{attrs:{type:"index"}}),e._v(" "),a("el-table-column",{attrs:{prop:"label",label:"表头字段"}}),e._v(" "),a("el-table-column",{attrs:{label:"是否隐藏"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#C0C4CC"},on:{change:function(a){return e.onHeadConfigChange(t.row)}},model:{value:t.row.visible,callback:function(a){e.$set(t.row,"visible",a)},expression:"scope.row.visible"}})]}}])})],1),e._v(" "),a("div",{staticStyle:{"text-align":"center"},attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{round:"",size:"small",type:"primary"},on:{click:e.hiddenAll}},[e._v("全 部 隐 藏\n            ")]),e._v(" "),a("el-button",{attrs:{round:"",size:"small",type:"primary"},on:{click:e.showAll}},[e._v("全 部 开 启\n            ")]),e._v(" "),a("el-button",{attrs:{round:"",size:"small",type:"warning"},on:{click:e.showAll}},[e._v("重 置")])],1)],2),e._v(" "),a("el-dialog",{staticClass:"debCreDialog",attrs:{title:e.debCreDialogTitle,visible:e.debCreDialog,width:"70%"},on:{"update:visible":function(t){e.debCreDialog=t}}},[a("throughTable",{attrs:{throughData:e.throughData,selectCell:e.selectCell}})],1)],1)},staticRenderFns:[]};var D=a("VU/8")(x,w,!1,function(e){a("oROU")},"data-v-1c1d50fa",null).exports,S={name:"statementOfCashFlowCur",props:{column:Array,curData:Array},components:{throughTable:g.a,tableHeadTitle:v.a},mixins:[b.a],watch:{column:{handler:function(e){e&&(this.curCashColumns=e,this.columnsCache=JSON.parse(o()(e)))},immediate:!0,deep:!0},curData:{handler:function(e){var t=this;e&&(this.curCashList=e.filter(function(e){return 0!=e.numberMerger}),this.$nextTick(function(){return t.allColumnsList=t.$refs.xTable.collectColumn}))},immediate:!0,deep:!0}},data:function(){return{flag:"HB003-MTB003",selectCell:{},throughData:[],debCreDialog:!1,curCashColumns:this.column,curCashList:this.curData,allAlign:"right",_init:!1,fullscreenLoading:!1,singleSubjectDimensionData:[],columns:[],singleSubjectDimensionDialog:!1,handleColumnsDialogTableVisible:!1,handleColumnsData:[],setBorder:!0,debCreDialogTitle:"",dialogTitle:"",isTag:!1,tagList:[],multipleLimit:5,loading:!1,defaultFirstOption:!1,queryTag:"",stateFlag:!1,filterCashColumn:[],filterCashData:[],columnsList:[],columnsCache:[],allColumnsList:[],fixedColumns:["colCode","colDisp","totalNumber","debtor","credit","numberMerger"],keyTime:0}},methods:{hideStateData:function(e){e&&1===e&&(this.stateFlag=!1);var t=this.curData.filter(function(e){return 0!=e.numberMerger});this.curCashList=t},showStateData:function(){this.curCashList=this.curData,this.stateFlag=!0},iconDownload:function(){var e=this.row,t=JSON.parse(sessionStorage.getItem("curCustomerData")).curYear,a={subjectName:e.colDisp,subjectId:e.colCode,summaryType:"1",year:t};this.$sacpApis.exportSubsidiaryData(a)},exportMergeTrialBalance:function(){this.$sacpApis.exportMergeTrialBalance("合并试算平衡表.xlsx")},handleBackspace:function(){this.keyTime?(this.tagList&&(this.tagList.length?this.queryCashDataByTag():this.getConfigColumns("tag")),this.keyTime=0):this.keyTime++},handleInputConfirm:function(){var e=this;return this.queryTag.trim()?this.tagList.some(function(t){return t===e.queryTag})?this.$message.error("当前标签已经存在!"):void(this.queryTag.trim()&&this.tagList.length<5?(this.tagList.push(this.queryTag),this.queryCashDataByTag()):(this.$message.error("标签限制数量为5个!"),this.queryTag="")):this.$message.error("请输入标签内容!")},remoteMethod:function(e){if(e&&e.length>10)return this.$message.warning("标签限制长度为10 !按下回车键将自动截取当前编辑标签的前10位 !");this.queryTag=e},removeTag:function(e){this.tagList=this.tagList.filter(function(t){return t!=e}),this.tagList.length?this.queryCashDataByTag():this.getConfigColumns("tag")},queryCashDataByTag:function(){var e=this;this.fullscreenLoading=!0;var t="";p.a.arrayEach(this.tagList,function(a,i){return t+=i<e.tagList.length-1?a+"|":""+a}),this.$sacpApis.queryMergeCashByMergeProject(t).then(function(t){e.handleColumnsData=t&&t.cashColumn?t.cashColumn.filter(function(e){return"colCode"!=e.prop&&"colDisp"!=e.prop&&"totalNumber"!=e.prop&&"debtor"!=e.prop&&"credit"!=e.prop&&"numberMerger"!=e.prop}):[],e.filterCashColumn=t&&t.cashColumn?t.cashColumn:[],e.filterCashData=t&&t.curCash?t.curCash:[]}).catch(function(t){return e.$message.error(t)}).finally(function(){var t=[];e.handleColumnsData.map(function(e){t.push(e.prop)});for(var a=function(a){p.a.includes(e.fixedColumns,e.columnsCache[a].prop)||p.a.includes(t,e.columnsCache[a].prop)?p.a.includes(t,e.columnsCache[a].prop)&&e.handleColumnsData.forEach(function(t){return t.visible=t.prop===e.columnsCache[a].prop?e.columnsCache[a].visible:t.visible}):(e.columnsCache[a].visible=!0,e.onHeadConfigChange(e.columnsCache[a]))},i=0;i<e.columnsCache.length;i++)a(i);e.curCashColumns=e.columnsCache,e.curCashList=e.filterCashData,e.fullscreenLoading=!1})},refresh:function(e){this.refreshTable()},refreshTable:function(){this.tagList&&this.tagList.length&&(this.tagList=[],this.getConfigColumns("tag")),this.$emit("isInit",!0)},showTooltipMethod:function(e){e.type,e.column,e.row,e.items,e._columnIndex},commafyFn:function(e){var t=e.cellValue;e.row,e.column;return p.a.commafy(t,{digits:2})},initMergeTb:function(){var e=this;this.fullscreenLoading=!0,this.$sacpApis.initTbAndCaseSheet({}).then(function(t){t.success?(e._init=!0,e.$message.success("初始化成功!"),e.$emit("refreshIndexes",t.resultInfo.refreshIndexes)):e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)}).finally(function(){e.fullscreenLoading=!1})},cellStyle:function(e){e.row,e.rowIndex;var t=e.column;e.columnIndex;if("colDisp"==t.property)return{textDecoration:"underline",cursor:"pointer"}},handleCellClick:function(e){var t=e.row,a=(e.rowIndex,e.$rowIndex,e.column);e.columnIndex,e.$columnIndex,e.cell;if("colDisp"==a.property){this.columns.forEach(function(e){"curAmount"==e.prop&&(e.label=t.colDisp)}),this.row=t,this.singleSubjectDimensionData=[];for(var i=t.totalNumber,r=(i+="").split("."),s=r[0],o=r.length>1?"."+r[1]:"",n=/(\d+)(\d{3})/;n.test(s);)s=s.replace(n,"$1,$2");this.singleSubjectDimensionData=[],this.handleSubsidiaryData(t),this.dialogTitle="单科目维度:"+t.colDisp+"(汇总数:"+(s+o)+")"}},handleCellDblclick:function(e){var t=this,a=e.row,i=(e.rowIndex,e.$rowIndex,e.column);e.columnIndex,e.$columnIndex,e.cell;if("debtor"==i.property||"credit"==i.property){if(!a.relatedCode)return void this.$message.warning("合计项无法查看详细!");"debtor"==i.property?this.debCreDialogTitle="借方抵销:"+a.colCode+"-"+a.colDisp:"credit"==i.property&&(this.debCreDialogTitle="贷方抵销:"+a.colCode+"-"+a.colDisp);var r=JSON.parse(sessionStorage.getItem("curCustomerData")).curProjectId;this.selectCell={subjectId:a.colCode,projectId:r,year:JSON.parse(sessionStorage.getItem("curCustomerData")).curYear,activeFlag:null,subjectName:a.colDisp,adjustType:3},this.$store.commit("setCell",this.selectCell),this.$sacpApis.offsetThrough(this.selectCell).then(function(e){e.success&&(t.throughData=e.data)}).catch(function(e){return t.$message.error(e)}).finally(function(){t.debCreDialog=!0})}},selectVisiableColumns:function(e){this.getConfigColumns(e),this.handleColumnsDialogTableVisible=!0},hiddenAll:function(){var e=this;this.columnsList=this.$refs.xTable.getColumns(),this.handleColumnsData.forEach(function(t){t.visible=!0;var a=e.columnsList.filter(function(e){return e.property===t.prop});a&&a.length&&e.$refs.xTable.hideColumn(a[0]),e.columnsCache.map(function(e){return e.visible=e.prop===t.prop||e.visible}),e.curCashColumns=e.columnsCache})},showAll:function(){var e=this;this.handleColumnsData.forEach(function(t){t.visible=!1;var a=e.allColumnsList.filter(function(e){return e.property===t.prop});a&&a.length&&e.$refs.xTable.showColumn(a[0]),e.columnsCache.map(function(e){return e.visible=e.prop!==t.prop&&e.visible}),e.curCashColumns=e.columnsCache})},onHeadConfigChange:function(e){var t=this.allColumnsList.filter(function(t){return t.property===e.prop});t&&t.length&&(e.visible?this.$refs.xTable.hideColumn(t[0]):this.$refs.xTable.showColumn(t[0]))},recoverHeadConfig:function(){this.isTag=!1,this.handleColumnsDialogTableVisible=!1},getConfigColumns:function(e){var t=this;"last"!=e&&(this.isTag=!0),"last"===e?this.handleColumnsData=this.columnsCache&&this.columnsCache.length?this.columnsCache.filter(function(e){return p.a.includes(t.fixedColumns,e.prop)&&"colDisp"!=e.prop&&"colCode"!=e.prop}):[]:"all"===e?this.tagList&&this.tagList.length?this.handleColumnsData=this.filterCashColumn&&this.filterCashColumn.length?this.filterCashColumn.filter(function(e){return!p.a.includes(t.fixedColumns,e.prop)}):[]:this.handleColumnsData=this.columnsCache&&this.columnsCache.length?this.columnsCache.filter(function(e){return!p.a.includes(t.fixedColumns,e.prop)}):[]:"tag"===e&&(this.handleColumnsData=this.columnsCache&&this.columnsCache.length?this.columnsCache.filter(function(e){return!p.a.includes(t.fixedColumns,e.prop)}):[],this.curCashList=this.curData,this.showAll())},reloadData:function(e){var t=this;this.handleColumnsData.forEach(function(e){e.visible?t.$refs.xTable.hideColumn(t.$refs.xTable.getColumnByField(e.prop)):t.$refs.xTable.showColumn(t.$refs.xTable.getColumnByField(e.prop))}),this.$refs.xTable.loadData(e)},handleSubsidiaryData:function(e){var t=this,a=JSON.parse(sessionStorage.getItem("curCustomerData")).curYear,i={subjectId:e.colCode,summaryType:"1",year:a};this.$sacpApis.mergeTBSubsidiary(i).then(function(e){e.success?t.singleSubjectDimensionData=e.data:t.$message.error(e.resultInfo.statusText)}).catch(function(e){return t.$message.error(e)}).finally(this.singleSubjectDimensionDialog=!0)},addNbsp:function(e){var t=e.cellValue;e.row,e.column;if(t.match(new RegExp(/\s/g)))for(var a=t.match(new RegExp(/\s/g)).length,i=0;i<=a-1;i++)t=" "+t;return t}},created:function(){h&&(this.columns=h.cashFlowData)},mounted:function(){this.hideStateData()}},T={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"statementOfCashFlowCur"},[a("div",{staticClass:"columnsVisiable",staticStyle:{float:"right","margin-bottom":"8px"}},[0==e.stateFlag?a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"展示全部数据",placement:"top-start"}},[a("el-button",{staticClass:"initBtn",attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-sort-down"},on:{click:e.showStateData}})],1):e._e(),e._v(" "),1==e.stateFlag?a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"隐藏合并数为0",placement:"top-start"}},[a("el-button",{staticClass:"initBtn",attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-sort-up"},on:{click:function(t){return e.hideStateData(1)}}})],1):e._e(),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"初始化现金流量表",placement:"top-start"}},[a("el-button",{staticClass:"setBtn",attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-switch-button"},on:{click:e.initMergeTb}})],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"列设置",placement:"top-start"}},[a("el-button",{attrs:{circle:"",icon:"el-icon-s-grid",type:"primary",size:"small"},on:{click:function(t){return e.selectVisiableColumns("all")}}})],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"隐藏最后四列",placement:"top-start"}},[a("el-button",{attrs:{circle:"",icon:"el-icon-video-play",type:"primary",size:"small"},on:{click:function(t){return e.selectVisiableColumns("last")}}})],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"导出",placement:"top-start"}},[a("el-button",{attrs:{circle:"",icon:"el-icon-download",type:"primary",size:"small"},on:{click:function(t){return e.exportMergeTrialBalance()}}})],1)],1),e._v(" "),a("div",{staticClass:"tableDiv"},[a("table-head-title",{attrs:{columns:e.curCashColumns,pageTotal:e.curCashList.length,refreshTable:e.refreshTable}}),e._v(" "),a("vxe-table",{ref:"xTable",attrs:{border:"",resizable:"","highlight-hover-row":"","highlight-current-row":"","show-overflow":"","show-header-overflow":"","export-config":"",height:"auto","scroll-y":{vSize:1e4},"auto-resize":!0,data:e.curCashList,"sort-config":{trigger:"cell"},"tooltip-config":{contentMethod:e.showTooltipMethod,enterable:!0},"cell-style":e.cellStyle},on:{"cell-click":e.handleCellClick,"cell-dblclick":e.handleCellDblclick}},e._l(e.curCashColumns,function(t,i){return a("vxe-table-column",{key:i,attrs:{"header-align":"center",field:t.prop,title:t.label,visiable:t.visiable,fixed:t.fixed?t.fixed:"",align:t.isMoney?e.allAlign:"",formatter:t.isMoney?e.commafyFn:"colDisp"==t.prop?e.addNbsp:"","min-width":t.width?t.width:100}})}),1)],1),e._v(" "),a("el-dialog",{staticClass:"singleSubjectTable",attrs:{title:e.dialogTitle,visible:e.singleSubjectDimensionDialog,width:"70%"},on:{"update:visible":function(t){e.singleSubjectDimensionDialog=t}}},[a("i",{staticClass:"el-icon-download",on:{click:e.iconDownload}}),e._v(" "),a("bdo-table",{ref:"table",attrs:{columns:e.columns,"enable-filter":!1,"enable-toolbox":!1,"enable-view-type":!1,data:e.singleSubjectDimensionData,"show-overflow-tooltip":"",headerCellStyleSelf:{"text-align":"left"},showIndexColumn:!1,showCheckBox:!1,headerListConfig:!1,setBorder:e.setBorder}})],1),e._v(" "),a("el-dialog",{staticClass:"changeFilterTableMethodsDialog",attrs:{visible:e.handleColumnsDialogTableVisible,width:"60%","before-close":e.recoverHeadConfig},on:{"update:visible":function(t){e.handleColumnsDialogTableVisible=t}}},[a("template",{slot:"title"},[a("div",{staticClass:"headerTitle"},[a("span",{staticClass:"el-dialog__title"},[e._v("表头编辑")]),e._v(" "),e.isTag?a("el-select",{staticClass:"tagInput mergeTbTagInput",attrs:{multiple:"","multiple-limit":e.multipleLimit,filterable:"","allow-create":"","default-first-option":e.defaultFirstOption,placeholder:"输入标签内容，用回车添加","filter-method":e.remoteMethod},on:{"remove-tag":e.removeTag},nativeOn:{keyup:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"backspace",void 0,t.key,void 0)?null:e.handleBackspace(t)},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleInputConfirm(t)}]},model:{value:e.tagList,callback:function(t){e.tagList=t},expression:"tagList"}}):e._e()],1)]),e._v(" "),a("el-table",{attrs:{data:e.handleColumnsData,size:"small","max-height":"300px"}},[a("el-table-column",{attrs:{type:"index"}}),e._v(" "),a("el-table-column",{attrs:{prop:"label",label:"表头字段"}}),e._v(" "),a("el-table-column",{attrs:{label:"是否隐藏"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#C0C4CC"},on:{change:function(a){return e.onHeadConfigChange(t.row)}},model:{value:t.row.visible,callback:function(a){e.$set(t.row,"visible",a)},expression:"scope.row.visible"}})]}}])})],1),e._v(" "),a("div",{staticStyle:{"text-align":"center"},attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{round:"",size:"small",type:"primary"},on:{click:e.hiddenAll}},[e._v("全 部 隐 藏\n            ")]),e._v(" "),a("el-button",{attrs:{round:"",size:"small",type:"primary"},on:{click:e.showAll}},[e._v("全 部 开 启\n            ")]),e._v(" "),a("el-button",{attrs:{round:"",size:"small",type:"warning"},on:{click:e.showAll}},[e._v("重 置")])],1)],2),e._v(" "),a("el-dialog",{staticClass:"debCreDialog",attrs:{title:e.debCreDialogTitle,visible:e.debCreDialog,width:"70%"},on:{"update:visible":function(t){e.debCreDialog=t}}},[a("throughTable",{attrs:{throughData:e.throughData,selectCell:e.selectCell}})],1)],1)},staticRenderFns:[]};var k=a("VU/8")(S,T,!1,function(e){a("4M5k")},"data-v-738dcb59",null).exports,j=(a("30bX"),{name:"statementOfCashFlowLast",props:{column:Array,curData:Array},components:{throughTable:g.a,tableHeadTitle:v.a},mixins:[b.a],watch:{column:{handler:function(e){e&&(this.preCashColumns=e,this.columnsCache=JSON.parse(o()(e)))},immediate:!0,deep:!0},curData:{handler:function(e){var t=this;e&&(this.preCashList=e.filter(function(e){return 0!=e.numberMerger}),this.$nextTick(function(){return t.allColumnsList=t.$refs.xTable.collectColumn}))},immediate:!0,deep:!0}},data:function(){return{flag:"HB003-MTB004",selectCell:{},throughData:[],debCreDialog:!1,preCashColumns:this.column,preCashList:this.curData,allAlign:"right",_init:!1,fullscreenLoading:!1,singleSubjectDimensionDialog:!1,singleSubjectDimensionData:[],columns:[],handleColumnsDialogTableVisible:!1,handleColumnsData:[],debCreDialogTitle:"",dialogTitle:"",isTag:!1,tagList:[],multipleLimit:5,loading:!1,defaultFirstOption:!1,queryTag:"",cashFlag:!1,filterCashColumn:[],filterCashData:[],columnsList:[],columnsCache:[],allColumnsList:[],fixedColumns:["colCode","colDisp","totalNumber","debtor","credit","numberMerger"],keyTime:0,row:{}}},methods:{hideCashData:function(e){e&&1===e&&(this.cashFlag=!1);var t=this.curData.filter(function(e){return 0!=e.numberMerger});this.preCashList=t},showCashData:function(){this.preCashList=this.curData,this.cashFlag=!0},iconDownload:function(){var e=this.row,t=JSON.parse(sessionStorage.getItem("curCustomerData")).curYear,a={subjectName:e.colDisp,subjectId:e.colCode,summaryType:"1",year:+t-1};this.$sacpApis.exportSubsidiaryData(a)},exportMergeTrialBalance:function(){this.$sacpApis.exportMergeTrialBalance("合并试算平衡表.xlsx")},handleBackspace:function(){this.keyTime?(this.tagList&&(this.tagList.length?this.queryCashDataByTag():this.getConfigColumns("tag")),this.keyTime=0):this.keyTime++},handleInputConfirm:function(){var e=this;return this.queryTag.trim()?this.tagList.some(function(t){return t===e.queryTag})?this.$message.error("当前标签已经存在!"):void(this.queryTag.trim()&&this.tagList.length<5?(this.tagList.push(this.queryTag),this.queryCashDataByTag()):(this.$message.error("标签限制数量为5个!"),this.queryTag="")):this.$message.error("请输入标签内容!")},remoteMethod:function(e){if(e&&e.length>10)return this.$message.warning("标签限制长度为10 !按下回车键将自动截取当前编辑标签的前10位 !");this.queryTag=e},removeTag:function(e){this.tagList=this.tagList.filter(function(t){return t!=e}),this.tagList.length?this.queryCashDataByTag():this.getConfigColumns("tag")},queryCashDataByTag:function(){var e=this;this.fullscreenLoading=!0;var t="";p.a.arrayEach(this.tagList,function(a,i){return t+=i<e.tagList.length-1?a+"|":""+a}),this.$sacpApis.queryMergeCashByMergeProject(t).then(function(t){e.handleColumnsData=t&&t.cashColumn?t.cashColumn.filter(function(e){return"colCode"!=e.prop&&"colDisp"!=e.prop&&"totalNumber"!=e.prop&&"debtor"!=e.prop&&"credit"!=e.prop&&"numberMerger"!=e.prop}):[],e.filterCashColumn=t&&t.cashColumn?t.cashColumn:[],e.filterCashData=t&&t.preCash?t.preCash:[]}).catch(function(t){return e.$message.error(t)}).finally(function(){var t=[];e.handleColumnsData.map(function(e){t.push(e.prop)});for(var a=function(a){p.a.includes(e.fixedColumns,e.columnsCache[a].prop)||p.a.includes(t,e.columnsCache[a].prop)?p.a.includes(t,e.columnsCache[a].prop)&&e.handleColumnsData.forEach(function(t){return t.visible=t.prop===e.columnsCache[a].prop?e.columnsCache[a].visible:t.visible}):(e.columnsCache[a].visible=!0,e.onHeadConfigChange(e.columnsCache[a]))},i=0;i<e.columnsCache.length;i++)a(i);e.preCashColumns=e.columnsCache,e.preCashList=e.filterCashData,e.fullscreenLoading=!1})},refresh:function(e){this.refreshTable()},refreshTable:function(){this.tagList&&this.tagList.length&&(this.tagList=[],this.getConfigColumns("tag")),this.$emit("isInit",!0)},showTooltipMethod:function(e){e.type,e.column,e.row,e.items,e._columnIndex},commafyFn:function(e){var t=e.cellValue;e.row,e.column;return p.a.commafy(t,{digits:2})},commafy:function(e,t){p.a.commafy(t,{digits:2})},initMergeTb:function(){var e=this;this.fullscreenLoading=!0,this.$sacpApis.initTbAndCaseSheet({}).then(function(t){t.success?(e._init=!0,e.$message.success("初始化成功!"),e.$emit("refreshIndexes",t.resultInfo.refreshIndexes)):e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)}).finally(function(){e.fullscreenLoading=!1})},cellStyle:function(e){e.row,e.rowIndex;var t=e.column;e.columnIndex;if("colDisp"==t.property)return{textDecoration:"underline",cursor:"pointer"}},handleCellClick:function(e){var t=e.row,a=(e.rowIndex,e.$rowIndex,e.column);e.columnIndex,e.$columnIndex,e.cell;if("colDisp"==a.property){this.columns.forEach(function(e){"preAmount"==e.prop&&(e.label=t.colDisp)}),this.row=t,this.singleSubjectDimensionData=[];for(var i=t.totalNumber,r=(i+="").split("."),s=r[0],o=r.length>1?"."+r[1]:"",n=/(\d+)(\d{3})/;n.test(s);)s=s.replace(n,"$1,$2");this.handleSubsidiaryData(t),this.dialogTitle="单科目维度:"+t.colDisp+"(汇总数:"+(s+o)+")"}},handleCellDblclick:function(e){var t=this,a=e.row,i=(e.rowIndex,e.$rowIndex,e.column);e.columnIndex,e.$columnIndex,e.cell;if("debtor"==i.property||"credit"==i.property){if(!a.relatedCode)return void this.$message.warning("合计项无法查看详细!");"debtor"==i.property?this.debCreDialogTitle="借方抵销:"+a.colCode+"-"+a.colDisp:"credit"==i.property&&(this.debCreDialogTitle="贷方抵销:"+a.colCode+"-"+a.colDisp);var r=JSON.parse(sessionStorage.getItem("curCustomerData")).curProjectId;this.selectCell={subjectId:a.colCode,projectId:r,year:JSON.parse(sessionStorage.getItem("curCustomerData")).curYear-1,activeFlag:null,subjectName:a.colDisp,isLast:!0,adjustType:3},this.$store.commit("setCell",this.selectCell),this.$sacpApis.offsetThrough(this.selectCell).then(function(e){e.success&&(t.throughData=e.data)}).catch(function(e){return t.$message.error(e)}).finally(function(){t.debCreDialog=!0})}},selectVisiableColumns:function(e){this.getConfigColumns(e),this.handleColumnsDialogTableVisible=!0},hiddenAll:function(){var e=this;this.columnsList=this.$refs.xTable.getColumns(),this.handleColumnsData.forEach(function(t){t.visible=!0;var a=e.columnsList.filter(function(e){return e.property===t.prop});a&&a.length&&e.$refs.xTable.hideColumn(a[0]),e.columnsCache.map(function(e){return e.visible=e.prop===t.prop||e.visible}),e.preCashColumns=e.columnsCache})},showAll:function(){var e=this;this.handleColumnsData.forEach(function(t){t.visible=!1;var a=e.allColumnsList.filter(function(e){return e.property===t.prop});a&&a.length&&e.$refs.xTable.showColumn(a[0]),e.columnsCache.map(function(e){return e.visible=e.prop!==t.prop&&e.visible}),e.preCashColumns=e.columnsCache})},onHeadConfigChange:function(e){var t=this.allColumnsList.filter(function(t){return t.property===e.prop});t&&t.length&&(e.visible?this.$refs.xTable.hideColumn(t[0]):this.$refs.xTable.showColumn(t[0]))},recoverHeadConfig:function(){this.isTag=!1,this.handleColumnsDialogTableVisible=!1},getConfigColumns:function(e){var t=this;"last"!=e&&(this.isTag=!0),"last"===e?this.handleColumnsData=this.columnsCache&&this.columnsCache.length?this.columnsCache.filter(function(e){return p.a.includes(t.fixedColumns,e.prop)&&"colDisp"!=e.prop&&"colCode"!=e.prop}):[]:"all"===e?this.tagList&&this.tagList.length?this.handleColumnsData=this.filterCashColumn&&this.filterCashColumn.length?this.filterCashColumn.filter(function(e){return!p.a.includes(t.fixedColumns,e.prop)}):[]:this.handleColumnsData=this.columnsCache&&this.columnsCache.length?this.columnsCache.filter(function(e){return!p.a.includes(t.fixedColumns,e.prop)}):[]:"tag"===e&&(this.handleColumnsData=this.columnsCache&&this.columnsCache.length?this.columnsCache.filter(function(e){return!p.a.includes(t.fixedColumns,e.prop)}):[],this.preCashList=this.curData,this.showAll())},reloadData:function(e){var t=this;this.handleColumnsData.forEach(function(e){e.visible?t.$refs.xTable.hideColumn(t.$refs.xTable.getColumnByField(e.prop)):t.$refs.xTable.showColumn(t.$refs.xTable.getColumnByField(e.prop))}),this.$refs.xTable.loadData(e)},handleSubsidiaryData:function(e){var t=this,a=JSON.parse(sessionStorage.getItem("curCustomerData")).curYear,i={subjectId:e.colCode,summaryType:"1",year:Number(a)-1};this.$sacpApis.mergeTBSubsidiary(i).then(function(e){e.success?t.singleSubjectDimensionData=e.data:t.$message.error(e.resultInfo.statusText)}).catch(function(e){return t.$message.error(e)}).finally(function(){return t.singleSubjectDimensionDialog=!0})},addNbsp:function(e){var t=e.cellValue;e.row,e.column;if(t.match(new RegExp(/\s/g)))for(var a=t.match(new RegExp(/\s/g)).length,i=0;i<=a-1;i++)t=" "+t;return t}},created:function(){h&&(this.columns=h.preCashFlowData)},mounted:function(){this.hideCashData()}}),_={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"statementOfCashFlowLast"},[a("div",{staticClass:"columnsVisiable",staticStyle:{float:"right","margin-bottom":"8px"}},[0==e.cashFlag?a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"展示全部数据",placement:"top-start"}},[a("el-button",{staticClass:"initBtn",attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-sort-down"},on:{click:e.showCashData}})],1):e._e(),e._v(" "),1==e.cashFlag?a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"隐藏合并数为0",placement:"top-start"}},[a("el-button",{staticClass:"initBtn",attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-sort-up"},on:{click:function(t){return e.hideCashData(1)}}})],1):e._e(),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"初始化现金流量表",placement:"top-start"}},[a("el-button",{staticClass:"setBtn",attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-switch-button"},on:{click:e.initMergeTb}})],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"列设置",placement:"top-start"}},[a("el-button",{attrs:{circle:"",icon:"el-icon-s-grid",type:"primary",size:"small"},on:{click:function(t){return e.selectVisiableColumns("all")}}})],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"隐藏最后四列",placement:"top-start"}},[a("el-button",{attrs:{circle:"",icon:"el-icon-video-play",type:"primary",size:"small"},on:{click:function(t){return e.selectVisiableColumns("last")}}})],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"导出",placement:"top-start"}},[a("el-button",{attrs:{circle:"",icon:"el-icon-download",type:"primary",size:"small"},on:{click:function(t){return e.exportMergeTrialBalance()}}})],1)],1),e._v(" "),a("div",{staticClass:"tableDiv"},[a("table-head-title",{attrs:{columns:e.columns,pageTotal:e.preCashList.length,refreshTable:e.refreshTable}}),e._v(" "),a("vxe-table",{ref:"xTable",attrs:{border:"",resizable:"","highlight-hover-row":"","highlight-current-row":"","show-overflow":"","show-header-overflow":"","export-config":"",height:"auto","auto-resize":!0,data:e.preCashList,"scroll-y":{vSize:1e4},"sort-config":{trigger:"cell"},"tooltip-config":{contentMethod:e.showTooltipMethod,enterable:!0},"cell-style":e.cellStyle},on:{"cell-click":e.handleCellClick,"cell-dblclick":e.handleCellDblclick}},e._l(e.preCashColumns,function(t,i){return a("vxe-table-column",{key:i,attrs:{"header-align":"center",field:t.prop,title:t.label,fixed:t.fixed?t.fixed:"",align:t.isMoney?e.allAlign:"",visiable:t.visiable,formatter:t.isMoney?e.commafyFn:"colDisp"==t.prop?e.addNbsp:"","min-width":t.width?t.width:100}})}),1)],1),e._v(" "),a("el-dialog",{staticClass:"singleSubjectTable",attrs:{title:e.dialogTitle,visible:e.singleSubjectDimensionDialog,width:"70%"},on:{"update:visible":function(t){e.singleSubjectDimensionDialog=t}}},[a("i",{staticClass:"el-icon-download",on:{click:e.iconDownload}}),e._v(" "),a("bdo-table",{ref:"table",attrs:{columns:e.columns,"enable-filter":!1,"enable-toolbox":!1,"enable-view-type":!1,data:e.singleSubjectDimensionData,"page-total":e.singleSubjectDimensionData?e.singleSubjectDimensionData.length:0,headerCellStyleSelf:{"text-align":"left"},"show-overflow-tooltip":"",showIndexColumn:!1,showCheckBox:!1,headerListConfig:!1,setBorder:!0}})],1),e._v(" "),a("el-dialog",{staticClass:"changeFilterTableMethodsDialog",attrs:{title:"表头编辑",visible:e.handleColumnsDialogTableVisible,width:"60%","before-close":e.recoverHeadConfig},on:{"update:visible":function(t){e.handleColumnsDialogTableVisible=t}}},[a("template",{slot:"title"},[a("div",{staticClass:"headerTitle"},[a("span",{staticClass:"el-dialog__title"},[e._v("表头编辑")]),e._v(" "),e.isTag?a("el-select",{staticClass:"tagInput mergeTbTagInput",attrs:{multiple:"","multiple-limit":e.multipleLimit,filterable:"","allow-create":"","default-first-option":e.defaultFirstOption,placeholder:"输入标签内容，用回车添加","filter-method":e.remoteMethod},on:{"remove-tag":e.removeTag},nativeOn:{keyup:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"backspace",void 0,t.key,void 0)?null:e.handleBackspace(t)},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleInputConfirm(t)}]},model:{value:e.tagList,callback:function(t){e.tagList=t},expression:"tagList"}}):e._e()],1)]),e._v(" "),a("el-table",{ref:"setHeadRowTable",attrs:{data:e.handleColumnsData,size:"small","max-height":"300px"}},[a("el-table-column",{attrs:{type:"index"}}),e._v(" "),a("el-table-column",{attrs:{prop:"label",label:"表头字段"}}),e._v(" "),a("el-table-column",{attrs:{label:"是否隐藏"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#C0C4CC"},on:{change:function(a){return e.onHeadConfigChange(t.row)}},model:{value:t.row.visible,callback:function(a){e.$set(t.row,"visible",a)},expression:"scope.row.visible"}})]}}])})],1),e._v(" "),a("div",{staticStyle:{"text-align":"center"},attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{round:"",size:"small",type:"primary"},on:{click:e.hiddenAll}},[e._v("全 部 隐 藏\n            ")]),e._v(" "),a("el-button",{attrs:{round:"",size:"small",type:"primary"},on:{click:e.showAll}},[e._v("全 部 开 启\n            ")]),e._v(" "),a("el-button",{attrs:{round:"",size:"small",type:"warning"},on:{click:e.showAll}},[e._v("重 置")])],1)],2),e._v(" "),a("el-dialog",{staticClass:"debCreDialog",attrs:{title:e.debCreDialogTitle,visible:e.debCreDialog,width:"70%"},on:{"update:visible":function(t){e.debCreDialog=t}}},[a("throughTable",{attrs:{throughData:e.throughData,selectCell:e.selectCell}})],1)],1)},staticRenderFns:[]};var F=a("VU/8")(j,_,!1,function(e){a("/XV9")},"data-v-1bd699f6",null).exports,$=a("XNiZ"),N={name:"mergeTrialBalance",components:{mergeTbCur:I,mergeTbLast:D,statementOfCashFlowCur:k,statementOfCashFlowLast:F,BdoTable:d.a},props:{customerData:Array},computed:{getRefreshPagesId:function(){return this.$store.state.addBadgeTb}},watch:{getRefreshPagesId:{handler:function(e){e&&(this.paneList.forEach(function(t){t.isMark="string"==typeof e&&e.indexOf(t.indexId)>-1||"object"===(void 0===e?"undefined":u()(e))&&e.refreshIndexes.indexOf(t.indexId)>-1}),this.refreshIndexesCache=e,"object"===(void 0===e?"undefined":u()(e))&&window.location.hash.indexOf("/MergeTrialBalance")>-1&&this.handleCurstomerId())},immediate:!0,deep:!0}},data:function(){var e;return e={refreshIndexesCache:null,activeName:"mergeTbCur",paneList:[{label:"合并试算平衡表-本期",name:"mergeTbCur",id:0,indexId:"HB003-MTB001",isMark:!1},{label:"合并试算平衡表-上期",name:"mergeTbLast",id:1,indexId:"HB003-MTB002",isMark:!1},{label:"合并现金流量表-本期",name:"statementOfCashFlowCur",id:2,indexId:"HB003-MTB003",isMark:!1},{label:"合并现金流量表-上期",name:"statementOfCashFlowLast",id:3,indexId:"HB003-MTB004",isMark:!1}],currentTabComponent:"mergeTbCur",validColumns:[{prop:"colDisp",label:"校验项",filterOptions:{disabled:!0}},{prop:"unAuditAmount",label:"本年未审数",filterOptions:{disabled:!0}},{prop:"adjustAmount",label:"本年抵销数",filterOptions:{disabled:!0}},{prop:"auditAmount",label:"本年审定数",filterOptions:{disabled:!0}},{prop:"preUnAuditAmount",label:"上年未审数",filterOptions:{disabled:!0}},{prop:"preAdjustAmount",label:"上年抵销数",filterOptions:{disabled:!0}},{prop:"preAuditAmount",label:"上年审定数",filterOptions:{disabled:!0}}],validData:[],tbColumn:[],curTbData:[],preTbData:[],cashColumn:[],curCashData:[],preCashData:[],tableLoding:!1,fullscreenLoading:!1,fullScreen:!1,column:[],curData:[],errorText:"",isErrorText:!1,validDataModel:new $.a,curCustomerId:"",curProjectId:"",curAccYear:"",menuId:"",activeLabel:""},l()(e,"preTbData",[]),l()(e,"curCashData",[]),l()(e,"preCashData",[]),e},methods:{fullScreenChange:function(){this.fullScreen=!this.fullScreen},refreshIndexes:function(e){var t=this;if(e){window.location.hash.split("=");var a=e.split(",");a=a.filter(function(e){return e!=t.menuId}).join(),this.paneList.forEach(function(a){a.isMark=e.indexOf(a.indexId)>-1,a.isMark&&t.currentTabComponent===a.name&&(t.handleCurstomerId(),a.isMark=!1)}),this.$eventBus.$emit("page-refresh",a)}},handleClick:function(e){var t=this,a=this.paneList.filter(function(t){return e.name&&t.name==e.name});switch(this.menuId=a.length?a[0].indexId:"",this.currentTabComponent=a[0].name,this.activeLabel=e.label,e.name){case"mergeTbCur":this.column=this.tbColumn,this.curData=this.curTbData,this.menuId="HB003-MTB001";break;case"mergeTbLast":this.column=this.tbColumn,this.curData=this.preTbData,this.menuId="HB003-MTB002";break;case"statementOfCashFlowCur":this.column=this.cashColumn,this.curData=this.curCashData,this.menuId="HB003-MTB003";break;case"statementOfCashFlowLast":this.column=this.cashColumn,this.curData=this.preCashData,this.menuId="HB003-MTB004"}if(this.$store.commit("setClosePostill",!1),this.$store.commit("setMergeTBActiveTab",this.activeLabel),this.$store.commit("setMergeTBIndexID",this.menuId),this.$store.commit("setMergeTBActiveName",this.activeName),this.$router.push({name:"MergeTrialBalance",query:{tab:this.activeName}}),this.refreshIndexesCache="string"==typeof this.refreshIndexesCache&&this.refreshIndexesCache.split(","),this.paneList.forEach(function(e){e.isMark&&t.currentTabComponent===e.name&&(e.isMark=!1)}),this.paneList.every(function(e){return 0==e.isMark})){this.$store.commit("setRemoveBagdeScope","MergeTrialBalance");var i=JSON.parse(localStorage.getItem("refreshIndexes"));if(i&&i.refreshIndexes&&i.refreshIndexes.length){var r=i.refreshIndexes.split(",");r=r.filter(function(e){return-1===e.indexOf("HB003")});var s={key:i.key+=1,refreshIndexes:r.join()};localStorage.setItem("refreshIndexes",o()(s))}}},initAgain:function(e){e&&this.handleCurstomerId()},mergeTrialBalanceInit:function(){var e=this;this.fullscreenLoading=!0,this.curCustomerId&&this.curProjectId&&this.$sacpApis.mergeTrialBalanceAndCashFlowStatement({customerId:this.curCustomerId,projectId:this.curProjectId,refreshFlg:1}).then(function(t){if(t)for(var a=0;a<t.length;a++){var i=t[a];i&&i.hasOwnProperty("curData")?(e.column=i.tbColumn,e.curData=i.curData,Array.isArray(i.tbColumn)?(i.tbColumn.shift(),e.tbColumn=i.tbColumn):e.tbColumn=i.tbColumn,e.curTbData=i.curData,e.preTbData=i.preData):i&&i.hasOwnProperty("curCash")&&(e.cashColumn=i.cashColumn,e.curCashData=i.curCash,e.preCashData=i.preCash)}else e.validData.length=0}).finally(function(){e.fullscreenLoading=!1,e.handleUrl()})},handleUrl:function(){var e="",t=window.location.hash.split("/");if(-1!=(t=t.pop()).indexOf("?")){var a=t.split("?")[1];t=t.split("?")[0],e=a.split("=")[1]}var i={name:e};this.activeName=e,this.handleClick(i)},getTbValidList:function(){var e=this;this.validData=[],this.$sacpApis.mergeTBValidList({customerId:this.curCustomerId,projectId:this.curProjectId,refreshFlg:1}).then(function(t){if(t.success){if(t.data){0==t.data[t.data.length-1].checkFlag?(e.errorText="校验不平",e.isErrorText=!0):(e.errorText="",e.isErrorText=!1);var a=t.data.slice(0,-1);for(var i in a){var s={};for(var o in r()(s,e.validDataModel,a[i]),s)0===s[o]?s[o]="平":null===s[o]?s[o]=null:"colDisp"!=o&&(s[o]=p.a.commafy(s[o],{digits:2}));e.validData.push(s)}}}else e.$message.error(t.resultInfo.statusText)}).catch(function(t){e.$message.error(t)})},handleYear:function(){var e=this.curAccYear;this.validColumns[1].label=e+"未审数",this.validColumns[2].label=e+"抵销数",this.validColumns[3].label=e+"审定数",this.validColumns[4].label=e-1+"未审数",this.validColumns[5].label=e-1+"抵销数",this.validColumns[6].label=e-1+"审定数"},commafy:function(e,t){p.a.commafy(t,{digits:2})},handleCurstomerId:function(){var e=JSON.parse(sessionStorage.getItem("curCustomerData"));this.curCustomerId=e.curCustomerId,this.curProjectId=e.curProjectId,this.curAccYear=e.curYear,this.handleYear(),this.mergeTrialBalanceInit(),this.getTbValidList()},removeClickedMenuId:function(e,t){if(e&&"string"==typeof e){var a=e.split(",").filter(function(e){return e!=t}).join();this.$store.commit("setAddBagdeTb",a)}}},activated:function(){var e=window.location.hash.split("=").pop();this.paneList.some(function(e){return e.isMark})&&this.handleCurstomerId();var t=this.paneList.filter(function(t){return t.name===e})[0];t&&t.isMark&&this.removeClickedMenuId(this.getRefreshPagesId,t.indexId)},created:function(){this.handleCurstomerId()}},L={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"mergeTrialBalance"},[i("div",{staticClass:"validErrorInfo"},[i("span",{style:e.errorText?"color:red":"color:#000"},[e._v(e._s(e.errorText?e.errorText:"校验项"))]),e._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"刷新校验列表",placement:"top"}},[i("i",{staticClass:"el-icon-refresh",staticStyle:{color:"#409eff"},on:{click:e.getTbValidList}})]),e._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.isErrorText?"关闭校验项列表":"打开校验项列表",placement:"right"}},[e.isErrorText?i("i",{staticClass:"el-icon-caret-top",on:{click:function(t){e.isErrorText=!1}}}):i("i",{staticClass:"el-icon-caret-bottom",on:{click:function(t){e.isErrorText=!0}}})])],1),e._v(" "),e.isErrorText?i("div",{staticClass:"validTable"},[i("bdo-table",{staticStyle:{width:"100%"},attrs:{columns:e.validColumns,data:e.validData,"max-height":330,"enable-filter":!1,"enable-toolbox":!1,"enable-view-type":!1,showIndexColumn:!1,showCheckBox:!1,enableHeadConfig:!1,headerListConfig:!1,setBorder:!0,tableLoding:e.tableLoding,"show-overflow-tooltip":"",headerCellStyleSelf:{"text-align":"center"}},scopedSlots:e._u([{key:"col-unAuditAmount",fn:function(t){return[i("span",{style:{textAlign:"平"===t.row.unAuditAmount?"center":"right",color:"平"===t.row.unAuditAmount?"":"red",display:"block"}},[e._v("\n                    "+e._s(t.row.unAuditAmount))])]}},{key:"col-adjustAmount",fn:function(t){return[i("span",{style:{textAlign:"平"===t.row.adjustAmount?"center":"right",color:"平"===t.row.adjustAmount?"":"red",display:"block"}},[e._v("\n                    "+e._s(t.row.adjustAmount))])]}},{key:"col-auditAmount",fn:function(t){return[i("span",{style:{textAlign:"平"===t.row.auditAmount?"center":"right",color:"平"===t.row.auditAmount?"":"red",display:"block"}},[e._v("\n                    "+e._s(t.row.auditAmount))])]}},{key:"col-preUnAuditAmount",fn:function(t){return[i("span",{style:{textAlign:"平"===t.row.preUnAuditAmount?"center":"right",color:"平"===t.row.preUnAuditAmount?"":"red",display:"block"}},[e._v("\n                    "+e._s(t.row.preUnAuditAmount))])]}},{key:"col-preAdjustAmount",fn:function(t){return[i("span",{style:{textAlign:"平"===t.row.preAdjustAmount?"center":"right",color:"平"===t.row.preAdjustAmount?"":"red",display:"block"}},[e._v("\n                    "+e._s(t.row.preAdjustAmount))])]}},{key:"col-preAuditAmount",fn:function(t){return[i("span",{style:{textAlign:"平"===t.row.preAuditAmount?"center":"right",color:"平"===t.row.preAuditAmount?"":"red",display:"block"}},[e._v("\n                    "+e._s(t.row.preAuditAmount))])]}}],null,!1,1845018825)})],1):e._e(),e._v(" "),i("div",{class:{fullScreen:e.fullScreen?"fullScreen":"",fullScreenBox:!0}},[i("el-tooltip",{attrs:{effect:"dark",content:e.fullScreen?"取消全屏":"全屏",placement:"top-start"}},[i("el-button",{class:{fullScreenBtn:!0},attrs:{type:"primary",circle:"",size:"small"},on:{click:e.fullScreenChange}},[e.fullScreen?e._e():i("img",{attrs:{src:a("/Dxn"),alt:""}}),e._v(" "),e.fullScreen?i("img",{attrs:{src:a("W+0t"),alt:""}}):e._e()])],1),e._v(" "),i("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(this.paneList,function(t){return i("el-tab-pane",{key:t.id,attrs:{label:t.label,name:t.name}},[i("span",{attrs:{slot:"label",id:"extendEl"},slot:"label"},[t.isMark?i("el-badge",{staticClass:"item",attrs:{"is-dot":""}}):e._e(),e._v("\n                    "+e._s(t.label)+"\n                ")],1)])}),1),e._v(" "),i("keep-alive",[i(e.currentTabComponent,{ref:"tbContent",tag:"component",attrs:{column:e.column,curData:e.curData},on:{isInit:e.initAgain,refreshIndexes:e.refreshIndexes}})],1)],1)])},staticRenderFns:[]};var A=a("VU/8")(N,L,!1,function(e){a("uK8n")},null,null);t.default=A.exports},"3+Il":function(e,t){},"3BhD":function(e,t){},"4M5k":function(e,t){},"5Y/l":function(e,t){},"5kUB":function(e,t){},"9Idm":function(e,t){},"9VHK":function(e,t){},AOE1:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("mvHQ"),r=a.n(i),s=a("Gu7T"),o=a.n(s),n=a("K/T8"),l={columns:[{prop:"projectSouce",label:"项目来源",fixed:"left",width:"170px",filterOptions:{disabled:!0}},{prop:"projectName",label:"项目名称",fixed:"left",width:"250px",filterOptions:{disabled:!0}},{prop:"s21",label:"报告性质",fixed:"left",filterOptions:{disabled:!0},width:"100px"},{prop:"managerIdName",label:"项目负责人",fixed:"left",filterOptions:{disabled:!0},width:"100px"},{prop:"signUserName",label:" 签字合伙人",fixed:"left",filterOptions:{disabled:!0},width:"100px"},{prop:"issueReportDate2",label:"报告出具时间",width:"180px",filterOptions:{disabled:!0}},{prop:"auditState",label:"质控状态",width:"180px",filterOptions:{disabled:!0}},{prop:"fileState",label:"文印状态",width:"180px",filterOptions:{disabled:!0}},{prop:"arcState",label:"档案状态",width:"180px",filterOptions:{disabled:!0}},{prop:"isFinancialData",label:"是否导入财务数据",width:"120px",filterOptions:{disabled:!0},formatter:{type:"function",value:n.b.fmtFinancia}},{prop:"projectState",label:"项目进度",width:"105px",filterOptions:{disabled:!0},formatter:{type:"function",value:n.b.panoramaFmtEquity}},{prop:"materialityState",label:"重要性水平设置",width:"105px",filterOptions:{disabled:!0},formatter:{type:"function",value:n.b.panoramaFmtEquity}},{prop:"trialBalanceState",label:"试算平衡表",width:"115px",filterOptions:{disabled:!0},formatter:{type:"function",value:n.b.panoramaFmtEquity}},{prop:"unauditedState",label:"未审报表",width:"70px",filterOptions:{disabled:!0},formatter:{type:"function",value:n.b.panoramaFmtEquity}},{prop:"analysisReviewState",label:"初步分析性复核",width:"105px",filterOptions:{disabled:!0},formatter:{type:"function",value:n.b.panoramaFmtEquity}},{prop:"identifiedState",label:"计划控制表-科目认定表",width:"145px",filterOptions:{disabled:!0},formatter:{type:"function",value:n.b.panoramaFmtEquity}},{prop:"programPlanState",label:" 计划控制表-计划程序",width:"135px",filterOptions:{disabled:!0},formatter:{type:"function",value:n.b.panoramaFmtEquity}},{prop:"programState",label:"获取审计证据-实施程序",width:"145px",filterOptions:{disabled:!0},formatter:{type:"function",value:n.b.panoramaFmtEquity}},{prop:"clearQuestionState",label:"批注",width:"60px",filterOptions:{disabled:!0},formatter:{type:"function",value:n.b.panoramaFmtEquity}},{prop:"auditedState",label:"审定报表",width:"70px",filterOptions:{disabled:!0},formatter:{type:"function",value:n.b.panoramaFmtEquity}},{prop:"finalAnalysisReviewState",label:" 最终分析性复核",width:"110px",filterOptions:{disabled:!0},formatter:{type:"function",value:n.b.panoramaFmtEquity}},{prop:"noteinfoState",label:" 附注",width:"60px",filterOptions:{disabled:!0},formatter:{type:"function",value:n.b.panoramaFmtEquity}},{prop:"reportState",label:"报告",width:"60px",filterOptions:{disabled:!0},formatter:{type:"function",value:n.b.panoramaFmtEquity}},{prop:"bbReportState",label:"报备",width:"70px",filterOptions:{disabled:!0},formatter:{type:"function",value:function(e,t){n.b.panoramaFmtEquity(e,t)}}},{prop:"customerName",label:"客户名称",width:"170px",filterOptions:{disabled:!0}},{prop:"lastInitializationTimeDeal",label:"是否导入内部交易数据",width:"160px",flag:"a",disableToolbox:!0,filterOptions:{disabled:!0}},{prop:"lastInitializationTimeContacts",label:"是否导入内部往来数据",width:"160px"},{prop:"tbCheckFlag",label:"",show:!1}]},c=a("ABj6"),u=a("r9ye"),d=a("lCTB"),m=a("ZHXk"),p=a.n(m),f={name:"projectPanorama",components:{BdoTable:c.a,columns:l,tableType:u.a,AutoGenerationOffset:d.a},data:function(){return{percentage:0,columns:l.columns,tableData:[],bodyHeight:150,setBorder:!0,fullscreenLoading:!1,projectSouce:this.$DIC("合并报表项目来源"),editSlot:["managerIdName","signUserName","auditState","fileState","arcState","projectState","s21"],mergeProjectName:"",transactionDialogVisible:!1}},computed:{},methods:{projectPanoramaInit:function(e){var t=this;this.fullscreenLoading=!0,this.$sacpApis.getProjectPanoramaData({param1:e}).then(function(e){e.success?(e.data.forEach(function(e,t){if(e.projectProgress){var a=e.projectProgress.split("|").map(function(e,t){return"null"==e?"":e}),i=[].concat(o()(a));e.s21=i[0],e.managerIdName=i[1],e.signUserName=i[2],e.issueReportDate2=i[3],e.auditState=i[4],e.fileState=i[5],e.arcState=i[6],e.projectState=i[7]}e.isFinancialData||(e.bbReportState="",e.reportState="",e.noteinfoState="",e.finalAnalysisReviewState="",e.auditedState="",e.clearQuestionState="",e.programState="",e.programPlanState="",e.identifiedState="",e.analysisReviewState="",e.unauditedState="",e.unauditedState="",e.trialBalanceState="",e.materialityState="",e.projectState="")}),e.data.forEach(function(e){e.identifiedState&&(Number(e.identifiedState)%1==0?e.identifiedState=Number(e.identifiedState)+"%":e.identifiedState=Number(e.identifiedState).toFixed(2)+"%"),e.programPlanState&&(Number(e.programPlanState)%1==0?e.programPlanState=Number(e.programPlanState)+"%":e.programPlanState=Number(e.programPlanState).toFixed(2)+"%"),e.programState&&(Number(e.programState)%1==0?e.programState=Number(e.programState)+"%":e.programState=Number(e.programState).toFixed(2)+"%")}),t.tableData=e.data):t.$message.error(e.resultInfo.statusText)}).finally(function(){t.fullscreenLoading=!1})},save:function(){var e=this;this.$sacpApis.saveMergeProjectProgress(this.tableData).then(function(t){t.success?(e.$message.success("保存成功!"),e.projectPanoramaInit(0)):e.$message.error(t.resultInfo.statusText)})},tableColumns:function(){var e=JSON.parse(r()(this.projectSouce));e.forEach(function(e){e.text=e.label}),this.columns[0].filters=e},formatterDate:function(e,t){return t&&"0"!=t?p.a.toDateString(t,"yyyy-MM-dd HH:mm:ss"):""},handleClose:function(e){this.transactionDialogVisible=!1},queryMerchantInsideClassify:function(e){var t=this;this.transactionDialogVisible=!0,this.mergeProjectId=e.mergeProjectId,this.mergeProjectName=e.mergeProjectName,this.$sacpApis.queryMerchantInsideClassify().then(function(a){a.success?(t.tableColumns=a.data,t.$nextTick(function(){t.$refs.tableType.tabItemList(a.data,e.mergeProjectId)})):t.$message.error(a.resultInfo.statusText)}).catch(function(e){t.$message.error(e)}).finally(function(){t.fullscreenLoading=!1})},queryContactSummary:function(e){var t=this;this.$nextTick(function(){t.$refs.autoGenerationOffsetTable.queryContactSummary(e.mergeProjectId,e.shortName)})}},created:function(){this.tableColumns()}},h={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"projectPanorama"},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"更新项目全景图",placement:"top-start"}},[a("el-button",{staticClass:"refresh",attrs:{size:"mini",type:"primary",circle:"",icon:"el-icon-refresh"},on:{click:function(t){return e.projectPanoramaInit(1)}}})],1),e._v(" "),a("bdo-table",{ref:"table",attrs:{columns:e.columns,"enable-filter":!1,"enable-toolbox":!1,"enable-view-type":!1,data:e.tableData,"responsive-height-gap":e.bodyHeight,showIndexColumn:!0,showCheckBox:!1,setBorder:e.setBorder,setHeaderCellStyle:!0},scopedSlots:e._u([{key:"col-projectSouce",fn:function(t){return[a("el-select",{attrs:{disabled:!0,placeholder:"请选择项目来源"},model:{value:t.row.projectSource,callback:function(a){e.$set(t.row,"projectSource",a)},expression:"scope.row.projectSource"}},e._l(e.projectSouce,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)]}},{key:"col-issueReportDate2",fn:function(t){return[1==t.row.isTempProject?a("el-date-picker",{staticStyle:{width:"150px"},attrs:{"value-format":"yyyy-MM-dd",type:"date",placeholder:"选择日期"},model:{value:t.row.issueReportDate2,callback:function(a){e.$set(t.row,"issueReportDate2",a)},expression:"scope.row.issueReportDate2"}}):e._e()]}},{key:"col-trialBalanceState",fn:function(t){var i=t.row;return[i.tbCheckFlag?e._e():a("p",{staticStyle:{color:"red"},model:{value:i.trialBalanceState,callback:function(t){e.$set(i,"trialBalanceState",t)},expression:"row.trialBalanceState"}},[e._v("\n                与SACP存在差异！\n            ")]),e._v(" "),i.tbCheckFlag&&!i.isFinancialData?a("p",{model:{value:i.trialBalanceState,callback:function(t){e.$set(i,"trialBalanceState",t)},expression:"row.trialBalanceState"}},[e._v("\n                "+e._s(i.trialBalanceState?i.trialBalanceState+"%":"___")+"\n            ")]):e._e(),e._v(" "),i.tbCheckFlag&&i.isFinancialData?a("p",{model:{value:i.trialBalanceState,callback:function(t){e.$set(i,"trialBalanceState",t)},expression:"row.trialBalanceState"}},[e._v("\n                "+e._s(i.trialBalanceState+"%")+"\n            ")]):e._e()]}},e._l(e.editSlot,function(t,i){return{key:"col-"+t,fn:function(r){return[1==r.row.isTempProject?a("el-input",{key:i,attrs:{placeholder:"请输入",clearable:"",size:"large"},model:{value:r.row[t],callback:function(a){e.$set(r.row,t,a)},expression:"scope.row[item]"}}):e._e()]}}}),{key:"col-lastInitializationTimeDeal",fn:function(t){var i=t.row;return[a("div",{staticClass:"time"},[e._v("\n                "+e._s(i.lastInitializationTimeDeal&&"0"!=i.lastInitializationTimeDeal?i.lastInitializationTimeDeal:"")+"\n            ")])]}},{key:"col-lastInitializationTimeContacts",fn:function(t){var i=t.row;return[a("div",{staticClass:"time"},[e._v("\n                "+e._s(i.lastInitializationTimeContacts&&"0"!=i.lastInitializationTimeContacts?i.lastInitializationTimeContacts:"")+"\n            ")])]}}],null,!0)}),e._v(" "),a("el-dialog",{staticClass:"internalTransaction",attrs:{width:"80%",title:"内部交易 : "+this.mergeProjectName,visible:e.transactionDialogVisible,"before-close":e.handleClose},on:{"update:visible":function(t){e.transactionDialogVisible=t}}},[a("table-type",{ref:"tableType"})],1),e._v(" "),a("auto-generation-offset",{ref:"autoGenerationOffsetTable"})],1)},staticRenderFns:[]};var g=a("VU/8")(f,h,!1,function(e){a("Ye0A")},"data-v-00ae00bc",null);t.default=g.exports},Fn4e:function(e,t){},I7wC:function(e,t){},K4R9:function(e,t,a){a("NA/8"),e.exports=a("FeBl").Number.isNaN},MICi:function(e,t,a){e.exports={default:a("K4R9"),__esModule:!0}},"NA/8":function(e,t,a){var i=a("kM2E");i(i.S,"Number",{isNaN:function(e){return e!=e}})},NqmM:function(e,t){},"UF/e":function(e,t){},UVLa:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("mvHQ"),r=a.n(i),s=a("pFYg"),o=a.n(s),n=a("ABj6"),l=a("ZHXk"),c=a.n(l),u=(a("0RKR"),{components:{BdoTable:n.a},prop:"mergeNoteInfo",props:{customerData:Array},computed:{refreshImportRelate:function(){return this.$store.state.refreshPagesMenuId}},watch:{refreshImportRelate:{handler:function(e){("object"===(void 0===e?"undefined":o()(e))&&e.menuID===this.flag&&window.location.hash.indexOf("/MergeNoteInfo")>-1||e===this.flag)&&this.handleCustomerInformation()},immediate:!0,deep:!0}},data:function(){return{dataNum:0,flag:"HB006-MNI001",columnTitle:"",colName:"",curYear:"",noteInfo:[],mergeInfo:[],editDialogVisible:!1,modifyNoteName:"",uploadDialogVisible:!1,excelName:"",excelFile:"",currentRow:{},fullscreenLoading:!1,rowMergeProjectId:null,curAutoId:null,tableHeight:430,customerId:"",curProjectId:"",projectId:"",isSingle:!1,customerName:"",projectName:"",buttonTitle:"初始化合并附注",allAlign:"right",isShort:!1,isPreCheckSort:!1,isNoteNoSort:!1,fullScreen:!1,batchUploadDialogVisible:!1,mergeTableVisible:!1,uploadFileList:[],filedata:[],columns:[{label:"操作",prop:"action"},{label:"项目简称",prop:"shortName",width:"100"},{label:"审定数",prop:"auditedAmount",width:"200"},{label:"年初数",prop:"preAuditAmount",width:"200"},{label:"本期校验",prop:"curCheck",width:"200"},{label:"上期校验",prop:"preCheck",width:"200"},{label:"状态",prop:"isCompleteNow",width:"80"},{label:"更新人",prop:"__ulastUpdatedUserName",width:"80"},{label:"更新时间",prop:"lastUpdateDate",width:"160"}],requestParam:{}}},methods:{cellClickEvent:function(e){var t=e.row,a=e.column;this.columnTitle="","审定数"!=a.title&&"年初数"!=a.title||(this.mergeTableVisible=!0,this.colName=t.colName,this.viewAllSubNoteInfo(),this.columnTitle=t.colName)},footerMethod:function(e){var t=this,a=e.columns,i=e.data;return[a.map(function(e,a){return 0===a?"合计":["preAuditAmount","auditedAmount","curCheck","preCheck"].includes(e.property)?t.countAmount(c.a.sum(i,e.property,{digits:2})):["preAuditAmountRate","auditedAmountRate"].includes(e.property)?100*t.countAmount(c.a.sum(i,e.property,{digits:2}))+"%":null})]},viewAllSubNoteInfo:function(){var e=this,t=JSON.parse(sessionStorage.getItem("curCustomerData")),a=(t.curProjectId,t.curCustomerId,t.curYear,{customerId:this.customerId,projectId:this.projectId,yyyy:this.curYear,noteName:this.colName});this.$sacpApis.viewAllSubNoteInfo(a).then(function(t){e.mergeInfo=t.data[0].list}).catch(function(e){}).finally(function(){})},fullScreenChange:function(){this.fullScreen=!this.fullScreen},refreshTable:function(){this.currentPageInit()},noteNoSort:function(e){var t=[];t=this.isNoteNoSort?this.noteInfo.sort(function(e,t){return Number(e.sortNo)-Number(t.sortNo)}):this.noteInfo.sort(function(e,t){return Number(e.sortNo)-Number(t.sortNo)}).reverse(),this.isNoteNoSort=!this.isNoteNoSort,this.noteInfo=t},preCheckSort:function(e){"curCheck"==e&&(this.isShort?this.isShort=!1:this.isShort=!0),this.isPreCheckSort?this.isPreCheckSort=!1:this.isPreCheckSort=!0,this.handleSortData(this.noteInfo,e)},editNoteInfo:function(e){this.currentRow=e,this.modifyNoteName=e.noteName,this.editDialogVisible=!0},submitEditInfo:function(){this.editDialogVisible=!1,this.currentRow.noteName=this.modifyNoteName},uploadNoteInfo:function(e){this.curAutoId=e.autoId,this.uploadDialogVisible=!0},batchUploadNoteInfo:function(e){this.curAutoId=e.autoId,this.batchUploadDialogVisible=!0},importExcel:function(){this.$refs.uploadExcel.click()},readExcel:function(e){var t=e.target.files;this.excelName=t[0].name,this.excelFile=this.$refs.uploadExcel.files[0]},confirUpload:function(){var e=this;this.uploadDialog=!1;var t=this.excelName.split(".");if("xlsx"!=t[t.length-1])return this.$message.error("仅支持.xlsx类型文件!");var a=new FormData;a.append("file",this.excelFile),this.$sacpApis.uploadExcel(a).then(function(t){if(t.success){e.$message.success("上传成功");e.$refs.uploadExcel;var a={fileId:t.data[0].fileId};e.uploadSuccessCB(a),e.$eventBus.$emit("page-refresh",t.resultInfo.refreshIndexes)}else{var i=t.resultInfo.statusText;e.$message.error(i)}})},batchUploadBut:function(){this.batchUploadDialogVisible=!0},batchUpload:function(){var e=this;return this.uploadFileList.some(function(e){return"xlsx"!==e.name.split(".")[e.name.split(".").length-1]})?this.$message.error("仅支持.xlsx类型文件!"):this.uploadFileList&&this.uploadFileList.length?(this.filedata=new FormData,this.uploadFileList.map(function(t,a){e.filedata.append("file"+a,t)}),void this.$sacpApis.bulkUpload(this.filedata).then(function(t){if(t.success)e.uploadFileList=[],e.filedata=[],e.uploadAllNoteInfo(t.data),e.$eventBus.$emit("page-refresh",t.resultInfo.refreshIndexes);else{var a=t.resultInfo.statusText;e.$message.error(a)}})):this.$message.error("请上传文件!")},uploadAllNoteInfo:function(e){var t=this,a=JSON.parse(sessionStorage.getItem("curCustomerData")),i=(a.curProjectId,a.curCustomerId,a.curYear),r={customerId:this.customerId,mergeProjectId:this.curProjectId,projectId:this.projectId,yyyy:i,fileId:e};this.$sacpApis.uploadAllNoteInfo(r).then(function(e){e.success?(t.batchUploadDialogVisible=!1,t.$message.success("上传成功"),t.currentPageInit()):t.$message.error(e.resultInfo.statusText)}).catch(function(e){t.$message.error(e)}).finally(function(){t.fullscreenLoading=!1,t.batchUploadDialogVisible=!1})},cancelUpload:function(){this.batchUploadDialogVisible=!1,this.uploadFileList=[],this.filedata=[]},uploadChange:function(e,t){if(this.uploadFileList.some(function(t){return t.name==e.name}))return this.$message.warning("不可以重复上传相同文件名文件,请删除!");this.uploadFileList.push(e.raw)},beforeRemove:function(e,t){this.uploadFileList=this.uploadFileList.filter(function(t){return t.name!=e.name})},downloadAllNoteInfo:function(){var e=this,t=JSON.parse(sessionStorage.getItem("curCustomerData")),a=t.curProjectId,i=(t.curCustomerId,t.curYear),r=(t.curProjectName,{customerId:this.customerId,mergeProjectId:this.curProjectId,projectId:this.projectId,yyyy:i}),s=a+"-合并附注-"+(new Date).getTime();this.$sacpApis.downloadAllNoteInfo(r,s).then(function(e){e.success}).catch(function(t){e.$message.error(t)})},uploadSuccessCB:function(e){var t=this,a={fileId:e.fileId,autoId:this.curAutoId};this.$sacpApis.mergeNoteInfoUploadCB(a).then(function(e){e.success?t.uploadDialogVisible=!1:t.$message.error(e.resultInfo.statusText)}).catch(function(e){t.$message.error(e)}).finally(function(){t.fullscreenLoading=!1,t.uploadDialogVisible=!1,t.excelFile="",t.excelName="",t.typeValue=""})},downloadNoteInfo:function(e){var t={autoId:e.autoId};this.$sacpApis.mergeNoteInfoDownLoad(t,e.fileName)},editFile:function(e){var t={extraOptions:e,currentNode:{extraOptions:e}};t.autoId=t.extraOptions.autoId,sessionStorage.setItem("mergeNoteInfoNode",r()(t)),window.open("/Faith/dgcenter.do?m=openMergeNoteInfo&noteNo="+t.extraOptions.noteNo)},resetFile:function(e){var t=this;this.fullscreenLoading=!0;var a={customerId:this.customerId,projectId:this.projectId,autoId:e.autoId};this.$sacpApis.singleNoteInfoReset(a).then(function(e){e.success?(t.$message.success("重置文件成功"),t.currentPageInit(),e.resultInfo.refreshIndexes&&t.$eventBus.$emit("page-refresh",e.resultInfo.refreshIndexes)):t.$message.error(e.resultInfo.statusText)}).catch(function(e){return t.$message.error(e)}).finally(function(){return t.fullscreenLoading=!1})},isDisabledAndFinished:function(e,t,a,i){var r=this,s={customerId:this.customerId,projectId:this.projectId,mergeProjectId:t.mergeProjectId,noteId:t.autoId,type:i,value:""};switch(i){case"forbid":this.$confirm("确定要禁用这条数据吗？","确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){s.value=e?"1":"0",r.mergeNoteInfoDisabledFinished(s,i,t)}).catch(function(a){t.isForbid=!e});break;case"finish":s.value=e?"1":"0",this.mergeNoteInfoDisabledFinished(s,i,t)}},mergeNoteInfoDisabledFinished:function(e,t,a){var i=this;this.fullscreenLoading=!0,this.$sacpApis.mergeNoteInfoDisabledFinished(e).then(function(e){if(e.success){i.fullscreenLoading=!1;var r="";switch(t){case"forbid":r="禁用状态更新成功!";break;case"finish":r="已完成状态更新成功!"}i.$message.success(r)}else"finish"===t&&(a.isFinished=!1),i.$message.error(e.resultInfo.statusText)}).catch(function(e){return i.$message.error(e)}).finally(function(){i.fullscreenLoading=!1})},initMergeNoteInfo:function(){var e=this;this.fullscreenLoading=!0;var t={customerId:this.customerId,projectId:this.projectId};this.$sacpApis.mergeNoteInfoInitBtn(t).then(function(t){t.success?(e.currentPageInit(!0),e.$message.success("初始化合并附注成功!")):e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)})},currentPageInit:function(e){var t=this;this.fullscreenLoading=!0,this.requestParam={customerId:this.customerId,mergeProjectId:this.curProjectId,projectId:this.projectId},this.$sacpApis.mergeNoteInfoInit(this.requestParam).then(function(a){a&&a.success?a.data&&(a.data.forEach(function(t){"0"===t.isForbid?(t.isForbid=!1,"0"===t.isFinished?t.isFinished=!1:t.isFinished=!0):t.isForbid=!0,t.curCheck&&void 0===t.preCheck&&(t.isForbid=!1),e&&0===t.preAuditAmount&&0===t.auditedAmount&&(t.isForbid=!0)}),t.noteInfo=a.data,t.dataNum=a.data.length):t.$message.error(a.resultInfo.statusText)}).catch(function(e){return t.$message.error(e)}).finally(function(){t.fullscreenLoading=!1,t.$store.commit("setRemoveBagdeScope","MergeNoteInfo")})},handleSortData:function(e,t){var a=[],i=[],r=[],s=[];e.forEach(function(e){e[t]>0?a.push(e):e[t]<0&&Math.abs(e[t])>0?i.push(e):0==e[t]?r.push(e):e[t]||s.push(e)});var o=[];if(this.isPreCheckSort||this.isShort)o="curCheck"==t?a.sort(this.sortCurCheck).reverse().concat(i.sort(this.sortCurCheck).reverse()).concat(r).concat(s):a.sort(this.sortNumber).reverse().concat(i.sort(this.sortNumber).reverse()).concat(r).concat(s),this.noteInfo.forEach(function(e){"1"===e.isForbid?e.isHidden=!0:e.isHidden=!1}),this.noteInfo=o.sort(function(e,t){return Number(e.sortNo)-Number(t.sortNo)});else{if("curCheck"==t){var n=a.sort(this.sortCurCheck).reverse(),l=i.sort(this.sortCurCheck).reverse();o=n.concat(l).concat(r).concat(s)}else{var c=a.sort(this.sortNumber).reverse(),u=i.sort(this.sortNumber).reverse();o=c.concat(u).concat(r).concat(s)}this.noteInfo=o.sort(function(e,t){return Number(e.sortNo)-Number(t.sortNo)}).reverse()}},commafyFn:function(e){var t=e.cellValue;e.row,e.column;return c.a.commafy(t,{digits:2})},fmtEquity:function(e){var t=e.cellValue;e.row,e.column;return(100*Number(t)).toFixed(2)+"%"},sortNumber:function(e,t){return e.preCheck-t.preCheck},sortCurCheck:function(e,t){return e.curCheck-t.curCheck},countAmount:function(e){var t;return t=e,c.a.commafy(t,{digits:2})},handleCustomerInformation:function(){var e=JSON.parse(sessionStorage.getItem("curCustomerData"));this.customerId=e.curCustomerId,this.projectId=e.curProjectId,this.customerName=e.curCustomerName,this.projectName=e.curProjectName,this.curProjectId=this.projectId,this.curYear=e.curYear,this.currentPageInit()},cellClassName:function(e){var t=e.row,a=(e.rowIndex,e.column);e.columnIndex;return"curCheck"===a.property&&t.curCheck&&0!=t.curCheck?"col-red":"preCheck"===a.property&&t.preCheck&&0!=t.preCheck?"col-red":void 0},refresh:function(){this.handleCustomerInformation()},isFinishedState:function(e){return!!e.isForbid||!(!e.curCheck&&!e.preCheck)&&(e.preCheck||e.curCheck,!0)},exportFile:function(){var e={columns:this.columns,params:{},jsonData:this.requestParam,url:"dgCenter/HbMergeProjectNoteInfo.queryMergeNoteInfo.json",fileName:"合并附注"};this.exportExcel(e)}},created:function(){this.handleCustomerInformation()}}),d={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"mergeNoteInfo"},[i("div",{class:{fullScreen:e.fullScreen?"fullScreen":"",fullScreenBox:!0}},[i("el-container",{staticClass:"container"},[i("el-main",[i("div",{staticClass:"columnsVisiable",staticStyle:{float:"right"}},[i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"批量上传",placement:"top-start"}},[i("el-button",{staticStyle:{"margin-bottom":"8px"},attrs:{type:"primary",size:"small",circle:"",icon:"el-icon-upload2"},on:{click:e.batchUploadBut}})],1),e._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"批量下载",placement:"top-start"}},[i("el-button",{staticStyle:{"margin-bottom":"8px"},attrs:{type:"primary",size:"small",circle:"",icon:"el-icon-download"},on:{click:e.downloadAllNoteInfo}})],1),e._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.buttonTitle,placement:"top-start"}},[i("el-button",{staticClass:"setBtn",staticStyle:{"margin-bottom":"8px"},attrs:{type:"primary",size:"small",circle:"",icon:"el-icon-switch-button"},on:{click:e.initMergeNoteInfo}})],1),e._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"刷新",placement:"top-start"}},[i("el-button",{attrs:{type:"primary",circle:"",icon:"el-icon-refresh",size:"small"},on:{click:e.refreshTable}})],1),e._v(" "),i("el-tooltip",{attrs:{effect:"dark",content:e.fullScreen?"取消全屏":"全屏",placement:"top-start"}},[i("el-button",{class:{fullScreenBtn:!0},attrs:{type:"primary",circle:"",size:"small"},on:{click:e.fullScreenChange}},[e.fullScreen?e._e():i("img",{attrs:{src:a("/Dxn"),alt:""}}),e._v(" "),e.fullScreen?i("img",{attrs:{src:a("W+0t"),alt:""}}):e._e()])],1)],1),e._v(" "),i("div",{staticClass:"showDataLength"},[i("i",{staticClass:"el-icon-s-flag"}),i("span",[e._v("共查询到数据"+e._s(e.dataNum)+"条")]),e._v(" "),i("el-button",{attrs:{size:"mini",icon:"el-icon-refresh",type:"text"},on:{click:e.refresh}},[e._v("刷新")]),e._v(" "),[i("el-divider",{attrs:{direction:"vertical"}}),e._v(" "),i("el-button",{attrs:{size:"mini",icon:"el-icon-download",type:"text"},on:{click:e.exportFile}},[e._v("导出")])]],2),e._v(" "),i("div",{staticClass:"tableDiv"},[i("vxe-table",{ref:"multipleTable",attrs:{resizable:"",border:"",height:"auto","highlight-hover-row":"","show-overflow":"","show-header-overflow":"","highlight-current-row":"","header-align":"center",data:e.noteInfo,"keep-source":"","auto-resize":!0,"cell-class-name":e.cellClassName,"scroll-y":{vSize:1e4}},on:{"cell-dblclick":e.cellClickEvent}},[i("vxe-table-column",{attrs:{title:"操作",width:"160",fixed:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return t.rowIndex,[i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"上传",placement:"top-start"}},[i("el-button",{staticClass:"uploadBtnCol",attrs:{size:"small",type:"text",icon:"el-icon-upload normalWeight"},on:{click:function(t){return e.uploadNoteInfo(a)}}})],1),e._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"下载",placement:"top-start"}},[i("el-button",{staticClass:"downloadBtnCol",attrs:{size:"small",type:"text",icon:"el-icon-download normalWeight"},on:{click:function(t){return e.downloadNoteInfo(a)}}})],1),e._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"编辑文件",placement:"top-start"}},[i("el-button",{staticClass:"editFileBtnCol",attrs:{size:"small",type:"text",icon:"el-icon-document-copy normalWeight",disabled:"0"===a.isCompleteNow},on:{click:function(t){return e.editFile(a)}}})],1),e._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"重置文件",placement:"top-start"}},[i("el-button",{staticClass:"resetBtnCol",attrs:{size:"small",type:"text",icon:"el-icon-switch-button"},on:{click:function(t){return e.resetFile(a)}}})],1)]}},{key:"header",fn:function(t){var a=t.column;return[i("span",[e._v(e._s(a.title))]),e._v(" "),i("span",{staticClass:"custom-sort",class:{"is-order":e.isNoteNoSort}},[i("i",{class:[e.isNoteNoSort?"vxe-icon--caret-bottom":"vxe-icon--caret-top"],on:{click:function(t){return e.noteNoSort("noteNo")}}})])]}}])}),e._v(" "),i("vxe-table-column",{attrs:{field:"noteName",title:"附注名称","min-width":"100","edit-render":{name:"input"},fixed:"left"}}),e._v(" "),i("vxe-table-column",{attrs:{field:"colName",title:"报表科目","min-width":"150","edit-render":{name:"input"},fixed:"left"}}),e._v(" "),i("vxe-table-column",{attrs:{field:"auditedAmount",title:"审定数","min-width":"200","edit-render":{name:"input"},formatter:e.commafyFn,align:e.allAlign,"header-align":"center"}}),e._v(" "),i("vxe-table-column",{attrs:{field:"preAuditAmount",title:"年初数","min-width":"200","edit-render":{name:"input"},formatter:e.commafyFn,align:e.allAlign,"header-align":"center"}}),e._v(" "),i("vxe-table-column",{attrs:{field:"curCheck",title:"本期校验","min-width":"200","edit-render":{name:"input"},formatter:e.commafyFn,align:e.allAlign,"header-align":"center",sortable:""},scopedSlots:e._u([{key:"header",fn:function(t){var a=t.column;return[i("span",[e._v(e._s(a.title))]),e._v(" "),i("span",{staticClass:"custom-sort",class:{"is-order":e.isShort}})]}}])}),e._v(" "),i("vxe-table-column",{attrs:{field:"preCheck",title:"上期校验","min-width":"200","edit-render":{name:"input"},formatter:e.commafyFn,align:e.allAlign,"header-align":"center",sortable:""},scopedSlots:e._u([{key:"header",fn:function(t){var a=t.column;return[i("span",[e._v(e._s(a.title))]),e._v(" "),i("span",{staticClass:"custom-sort",class:{"is-order":e.isPreCheckSort}})]}}])}),e._v(" "),i("vxe-table-column",{attrs:{field:"isCompleteNow",title:"状态","min-width":"80"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return t.rowIndex,["1"===a.isCompleteNow?i("span",[e._v("加载完成")]):"0"===a.isCompleteNow?i("span",[e._v("加载中")]):e._e()]}}])}),e._v(" "),i("vxe-table-column",{attrs:{field:"isForbid",title:"禁用","min-width":"80"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row,r=t.rowIndex;return[i("el-checkbox",{on:{change:function(t){e.isDisabledAndFinished(t,a,r,"forbid")}},model:{value:a.isForbid,callback:function(t){e.$set(a,"isForbid",t)},expression:"row.isForbid"}})]}}])}),e._v(" "),i("vxe-table-column",{attrs:{field:"isEdited",title:"已编辑","min-width":"80"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return t.rowIndex,[i("el-checkbox",{attrs:{disabled:""},model:{value:a.isEdited,callback:function(t){e.$set(a,"isEdited",t)},expression:"row.isEdited"}})]}}])}),e._v(" "),i("vxe-table-column",{attrs:{field:"isFinished",title:"已完成","min-width":"80"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row,r=t.rowIndex;return[i("el-checkbox",{attrs:{disabled:e.isFinishedState(a)},on:{change:function(t){e.isDisabledAndFinished(t,a,r,"finish")}},model:{value:a.isFinished,callback:function(t){e.$set(a,"isFinished",t)},expression:"row.isFinished"}})]}}])}),e._v(" "),i("vxe-table-column",{attrs:{field:"__ulastUpdatedUserName",title:"更新人","min-width":"80"}}),e._v(" "),i("vxe-table-column",{attrs:{field:"lastUpdateDate",title:"更新时间","min-width":"160"}})],1)],1)])],1),e._v(" "),i("el-dialog",{attrs:{title:"编辑",visible:e.editDialogVisible,width:"30%"},on:{"update:visible":function(t){e.editDialogVisible=t}}},[i("div",{staticClass:"editDialogContent"},[e._v("\n                附注名称:\n                "),i("el-input",{staticStyle:{width:"80%"},attrs:{type:"text"},model:{value:e.modifyNoteName,callback:function(t){e.modifyNoteName=t},expression:"modifyNoteName"}})],1),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"info",size:"small"},on:{click:function(t){e.editDialogVisible=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.submitEditInfo}},[e._v("确 定")])],1)]),e._v(" "),i("el-dialog",{attrs:{title:"上传页面",visible:e.uploadDialogVisible,"destroy-on-close":!0,width:"35%"},on:{"update:visible":function(t){e.uploadDialogVisible=t}}},[i("div",{staticClass:"updateBox"},[i("el-input",{staticStyle:{width:"300px",marginright:"20px"},attrs:{type:"text"},model:{value:e.excelName,callback:function(t){e.excelName=t},expression:"excelName"}}),e._v(" "),i("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"uploadExcel",attrs:{type:"file",id:"uploadExcel",accept:".xlsx"},on:{change:e.readExcel}}),e._v(" "),i("el-button",{staticClass:"btnText uploadBtn",attrs:{type:"primary",size:"small"},on:{click:e.importExcel}},[i("i",{staticClass:"el-icon-folder-opened"}),e._v("浏览\n                ")])],1),e._v(" "),i("div",{staticClass:"buttonList"},[i("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.confirUpload}},[e._v("确定")]),e._v(" "),i("el-button",{attrs:{type:"info",size:"small"},on:{click:function(t){e.uploadDialogVisible=!1}}},[e._v("取消")])],1)]),e._v(" "),i("el-dialog",{staticStyle:{top:"-80px","overflow-y":"hidden"},attrs:{title:"批量上传",visible:e.batchUploadDialogVisible,"destroy-on-close":!0,"before-close":e.cancelUpload,width:"40%"},on:{"update:visible":function(t){e.batchUploadDialogVisible=t}}},[i("div",[i("el-row",{attrs:{gutter:10}},[i("el-col",{staticClass:"reasonUpload",attrs:{span:24}},[i("el-upload",{ref:"uploadFile",staticClass:"uploadTool",attrs:{drag:"",action:"",multiple:"","file-list":e.uploadFileList,accept:".xlsx","auto-upload":!1,"on-change":e.uploadChange,"on-remove":e.beforeRemove}},[i("i",{staticClass:"el-icon-upload"}),e._v(" "),i("div",{staticClass:"el-upload__text"},[e._v("\n                                将文件拖到此处，或"),i("em",[e._v("点击上传")])])])],1)],1)],1),e._v(" "),i("div",{staticClass:"buttonList"},[i("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.batchUpload}},[e._v("确定")]),e._v(" "),i("el-button",{attrs:{type:"info",size:"small"},on:{click:e.cancelUpload}},[e._v("取消")])],1)]),e._v(" "),i("el-dialog",{attrs:{title:e.columnTitle,visible:e.mergeTableVisible,width:"80%"},on:{"update:visible":function(t){e.mergeTableVisible=t}}},[i("vxe-table",{ref:"multipleTable",attrs:{resizable:"",border:"",height:"95%","highlight-hover-row":"","show-overflow":"","show-header-overflow":"","highlight-current-row":"","show-footer":"","footer-method":e.footerMethod,"header-align":"center",data:e.mergeInfo,"keep-source":"","auto-resize":!0,"cell-class-name":e.cellClassName,"scroll-y":{vSize:1e4}}},[i("vxe-table-column",{attrs:{title:"操作",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return t.rowIndex,[i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"编辑文件",placement:"top-start"}},[i("el-button",{staticClass:"editFileBtnCol",staticStyle:{"margin-left":"40%"},attrs:{size:"small",type:"text",icon:"el-icon-document-copy",disabled:"0"===a.isCompleteNow},on:{click:function(t){return e.editFile(a)}}})],1)]}}])}),e._v(" "),i("vxe-table-column",{attrs:{field:"shortName",title:"项目简称","min-width":"100","edit-render":{name:"input"},align:"center","header-align":"center"}}),e._v(" "),i("vxe-table-column",{attrs:{field:"auditedAmount",title:"审定数","min-width":"200","edit-render":{name:"input"},formatter:e.commafyFn,align:e.allAlign,"header-align":"center"}}),e._v(" "),i("vxe-table-column",{attrs:{field:"auditedAmountRate",title:"本期占比","min-width":"200","edit-render":{name:"input"},formatter:e.fmtEquity,align:e.allAlign,"header-align":"center"}}),e._v(" "),i("vxe-table-column",{attrs:{field:"preAuditAmount",title:"年初数","min-width":"200","edit-render":{name:"input"},formatter:e.commafyFn,align:e.allAlign,"header-align":"center"}}),e._v(" "),i("vxe-table-column",{attrs:{field:"preAuditAmountRate",title:"上期占比","min-width":"200","edit-render":{name:"input"},formatter:e.fmtEquity,align:e.allAlign,"header-align":"center"}}),e._v(" "),i("vxe-table-column",{attrs:{field:"curCheck",title:"本期校验","min-width":"200","edit-render":{name:"input"},formatter:e.commafyFn,align:e.allAlign,"header-align":"center",sortable:""},scopedSlots:e._u([{key:"header",fn:function(t){var a=t.column;return[i("span",[e._v(e._s(a.title))]),e._v(" "),i("span",{staticClass:"custom-sort",class:{"is-order":e.isShort}})]}}])}),e._v(" "),i("vxe-table-column",{attrs:{field:"preCheck",title:"上期校验","min-width":"200","edit-render":{name:"input"},formatter:e.commafyFn,align:e.allAlign,"header-align":"center",sortable:""},scopedSlots:e._u([{key:"header",fn:function(t){var a=t.column;return[i("span",[e._v(e._s(a.title))]),e._v(" "),i("span",{staticClass:"custom-sort",class:{"is-order":e.isPreCheckSort}})]}}])})],1)],1)],1)])},staticRenderFns:[]};var m=a("VU/8")(u,d,!1,function(e){a("3BhD"),a("qER7")},"data-v-3269f72a",null);t.default=m.exports},XKgs:function(e,t){},Xt8x:function(e,t){},YA3s:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("woOf"),r=a.n(i),s=a("mvHQ"),o=a.n(s),n=a("pFYg"),l=a.n(n),c=a("ABj6"),u=a("TjpK"),d=a("ZHXk"),m=a.n(d),p=a("ECGi"),f=a("j5fz"),h=a("UHag"),g=a("fH//"),b=a("e6WU"),v=a("XNiZ"),C=a("0RKR"),y={name:"mergeReport",components:{balanceSheet:p.default,profitStatement:f.default,statementOfCashFlow:h.default,statementOfChangeInEquityCur:g.default,statementOfChangeInEquityLast:b.default,BdoTable:c.a},props:{customerData:Array},computed:{getRefreshPagesId:function(){return this.$store.state.addBagdeForm}},watch:{getRefreshPagesId:{handler:function(e){e&&(this.tabPaneList.forEach(function(t){t.isMark="string"==typeof e&&e.indexOf(t.indexId)>-1||"object"===(void 0===e?"undefined":l()(e))&&e.refreshIndexes.indexOf(t.indexId)>-1}),"object"===(void 0===e?"undefined":l()(e))&&window.location.hash.indexOf("/MergeForm")>-1&&(this.singlePageRefresh=!0,this.handleUrl()))},immediate:!0,deep:!0}},data:function(){return{currentTabComponent:"balanceSheet",currentDataList:[],currentColmList:[],activeName:"balanceSheet",tabPaneList:[{label:"合并资产负债表",name:"balanceSheet",isMark:!1,indexId:"HB005-ME001"},{label:"合并利润表",name:"profitStatement",isMark:!1,indexId:"HB005-ME002"},{label:"合并现金流量表",name:"statementOfCashFlow",isMark:!1,indexId:"HB005-ME003"},{label:"合并所有者权益变动表（本期）",name:"statementOfChangeInEquityCur",isMark:!1,indexId:"HB005-ME004"},{label:"合并所有者权益变动表（上期）",name:"statementOfChangeInEquityLast",isMark:!1,indexId:"HB005-ME005"}],validColumns:[{prop:"colDisp",label:"校验项",filterOptions:{disabled:!0}},{prop:"auditAmount",label:"本年审定数",filterOptions:{disabled:!0}},{prop:"preAuditAmount",label:"上年审定数",filterOptions:{disabled:!0}}],validData:[],fullscreenLoading:!1,errorText:"校验不平",isErrorText:!1,validFail:!0,statementOfCashFlowData:[],statementOfCashColumns:[],profitStatementData:[],statementOfChangeInEquityCurData:[],statementOfChangeInEquityLastData:[],statementOfChangeInEquityHeadTitle:[],statementOfChangeInEquityHeadTitlePre:[],balanceSheetData:[],isShowBtn:!0,validDataModel:new v.a,menuId:"",eqCount:[],oldTarget:null,eqCheckList:[],validList:[],singlePageRefresh:!1,fullScreen:!1}},methods:{fullScreenChange:function(){this.fullScreen=!this.fullScreen},refreshIndexes:function(e){var t=window.location.hash.split("="),a=[],i=e.split(",");this.tabPaneList.forEach(function(i){i.isMark=e.indexOf(i.indexId)>-1&&i.name!=t[t.length-1]||i.isMark,a.push(i.indexId)}),i=i.filter(function(e){return-1===a.join().indexOf(e)&&e.split("-").length>2});var r={key:JSON.parse(localStorage.getItem("refreshIndexes"))?JSON.parse(localStorage.getItem("refreshIndexes")).key+=1:0,refreshIndexes:i};localStorage.setItem("refreshIndexes",o()(r)),e.indexOf("HB002")>-1&&this.$eventBus.$emit("page-refresh",e),this.mergeFormInit()},handleClick:function(e){var t=this,a=this.tabPaneList.filter(function(t){return t.name==e.name});switch(this.currentTabComponent=a[0].name,e.name){case"balanceSheet":this.menuId="HB005-ME001",this.validData=this.validList;break;case"profitStatement":this.menuId="HB005-ME002",this.validData=this.validList;break;case"statementOfCashFlow":this.menuId="HB005-ME003",this.validData=this.validList;break;case"statementOfChangeInEquityCur":this.menuId="HB005-ME004",this.validData=this.eqCheckList;break;case"statementOfChangeInEquityLast":this.menuId="HB005-ME005",this.validData=this.eqCheckList}if(this.$store.commit("setClosePostill",!1),this.$store.commit("setMergeFormIndex",this.menuId),this.$store.commit("setMergeFormActiveName",e.name),this.$store.commit("setMergeFormActiveTab",e.label),this.$router.push({name:"MergeForm",query:{tab:e.name}}),this.tabPaneList.forEach(function(e){e.isMark&&t.currentTabComponent===e.name&&(e.isMark=!1,t.singlePageRefresh&&t.mergeFormInit())}),this.tabPaneList.every(function(e){return 0==e.isMark})){this.$store.commit("setRemoveBagdeScope","MergeForm"),this.$store.commit("setAddBagdeForm","");var i=JSON.parse(localStorage.getItem("refreshIndexes"));if(i&&i.refreshIndexes&&i.refreshIndexes.length){var r=i.refreshIndexes.split(",");r=r.filter(function(e){return-1===e.indexOf("HB005")});var s={key:i.key+=1,refreshIndexes:r.join()};localStorage.setItem("refreshIndexes",o()(s))}}},initAgain:function(e){1==e&&this.mergeFormInit()},mergeFormInit:function(){var e=this;this.fullscreenLoading=!0,this.validData=[],this.$sacpApis.mergeFormGetData({refreshFlg:1}).then(function(t){if(t.success){for(var a=t.data,i={data:[],success:!0},s={data:[],success:!0},o=0;o<a.length;o++){if(a[o].qy&&(i.data=a[o].qy),a[o].lqy&&(s.data=a[o].lqy),a[o].zc&&(e.balanceSheetData=a[o].zc),a[o].xj&&(e.statementOfCashFlowData=a[o].xj),a[o].lr&&(e.profitStatementData=a[o].lr),a[o].txj&&(e.statementOfCashColumns=a[o].txj),a[o].eqCount&&(e.eqCount=a[o].eqCount,C.a.saveEqCount(e.eqCount)),a[o].checkList)for(var n in e.validList=[],a[o].checkList){var l={};for(var c in r()(l,e.validDataModel,a[o].checkList[n]),l)0===l[c]?l[c]="平":null===l[c]?l[c]=null:"colDisp"!=c&&(l[c]=m.a.commafy(l[c],{digits:2}));e.validList.push(l)}if(a[o].eqCheckList)for(var d in e.eqCheckList=[],a[o].eqCheckList){var p={};for(var f in r()(p,e.validDataModel,a[o].eqCheckList[d]),p)0===p[f]?p[f]="平":null===p[f]?p[f]=null:"colDisp"!=f&&(p[f]=m.a.commafy(p[f],{digits:2}));e.eqCheckList.push(p)}e.validFail=a[o].checkFlag,e.isErrorText=!e.validFail}var h=u.a.convertReportData(i),g=u.a.convertReportData(s);e.statementOfChangeInEquityHeadTitle=h.titleColumn,e.statementOfChangeInEquityCurData=h.G,e.statementOfChangeInEquityHeadTitlePre=g.titleColumn,e.statementOfChangeInEquityLastData=g.LG}else e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)}).finally(function(){e.fullscreenLoading=!1,e.singlePageRefresh=!1,e.handleUrl()})},handleUrl:function(){var e="",t=window.location.hash.split("/");if(-1!=(t=t.pop()).indexOf("?")){var a=t.split("?")[1];t=t.split("?")[0],e=a.split("=")[1]}var i={name:e};this.activeName=e,this.handleClick(i)},commafy:function(e){m.a.commafy(e,{digits:2})},removeClickedMenuId:function(e,t){if(e&&"string"==typeof e){var a=e.split(",").filter(function(e){return e!=t}).join();this.$store.commit("setAddBagdeForm",a)}}},activated:function(){var e=window.location.hash.split("=").pop(),t=this.tabPaneList.filter(function(t){return t.name===e})[0];this.tabPaneList.some(function(e){return e.isMark})&&this.mergeFormInit(),t&&t.isMark&&this.removeClickedMenuId(this.getRefreshPagesId,t.indexId)},created:function(){sessionStorage.setItem("projectItem",o()({projectId:JSON.parse(sessionStorage.getItem("curCustomerData")).curProjectId})),this.mergeFormInit()}},I={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"mergeForm"},[i("div",{staticClass:"validErrorInfo"},[i("span",{style:e.validFail?"color:#000":"color:red"},[e._v(e._s(e.validFail?"校验项":e.errorText))]),e._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"刷新校验列表",placement:"top-start"}},[i("i",{staticClass:"el-icon-refresh",staticStyle:{color:"#409eff"},on:{click:function(t){return e.initAgain(!0)}}})]),e._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.isErrorText?"关闭校验项列表":"打开校验项列表",placement:"right"}},[e.isErrorText?i("i",{staticClass:"el-icon-caret-top",on:{click:function(t){e.isErrorText=!1}}}):i("i",{staticClass:"el-icon-caret-bottom",on:{click:function(t){e.isErrorText=!0}}})])],1),e._v(" "),e.isErrorText?i("div",{staticClass:"validTable"},[i("bdo-table",{staticStyle:{width:"100%"},attrs:{columns:e.validColumns,data:e.validData,"max-height":330,"enable-filter":!1,"enable-toolbox":!1,"enable-view-type":!1,showIndexColumn:!1,showCheckBox:!1,enableHeadConfig:!1,headerListConfig:!1,"show-overflow-tooltip":"",setBorder:!0,headerCellStyleSelf:{"text-align":"center"}},scopedSlots:e._u([{key:"col-auditAmount",fn:function(t){return[i("span",{style:{textAlign:"平"===t.row.auditAmount?"center":"right",color:"平"===t.row.auditAmount?"":"red",display:"block"}},[e._v("\n                    "+e._s(t.row.auditAmount))])]}},{key:"col-preAuditAmount",fn:function(t){return[i("span",{style:{textAlign:"平"===t.row.preAuditAmount?"center":"right",color:"平"===t.row.preAuditAmount?"":"red",display:"block"}},[e._v("\n                    "+e._s(t.row.preAuditAmount))])]}}],null,!1,1073739491)})],1):e._e(),e._v(" "),i("div",{class:{fullScreen:e.fullScreen?"fullScreen":"",fullScreenBox:!0}},[i("el-tooltip",{attrs:{effect:"dark",content:e.fullScreen?"取消全屏":"全屏",placement:"top-start"}},[i("el-button",{class:{fullScreenBtn:!0},attrs:{type:"primary",circle:"",size:"small"},on:{click:e.fullScreenChange}},[e.fullScreen?e._e():i("img",{attrs:{src:a("/Dxn"),alt:""}}),e._v(" "),e.fullScreen?i("img",{attrs:{src:a("W+0t"),alt:""}}):e._e()])],1),e._v(" "),i("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(this.tabPaneList,function(t){return i("el-tab-pane",{key:t.index,attrs:{label:t.label,name:t.name}},[i("span",{attrs:{slot:"label",id:"extendEl"},slot:"label"},[t.isMark?i("el-badge",{staticClass:"item",attrs:{"is-dot":""}}):e._e(),e._v("\n                    "+e._s(t.label)+"\n                ")],1)])}),1),e._v(" "),i("keep-alive",[i(e.currentTabComponent,{ref:"tbContent",tag:"component",attrs:{balanceSheetData:e.balanceSheetData,isShowBtn:e.isShowBtn,statementOfChangeInEquityCurData:e.statementOfChangeInEquityCurData,statementOfCashFlowData:e.statementOfCashFlowData,profitStatementData:e.profitStatementData,statementOfCashColumns:e.statementOfCashColumns,statementOfChangeInEquityHeadTitle:e.statementOfChangeInEquityHeadTitle,statementOfChangeInEquityLastData:e.statementOfChangeInEquityLastData},on:{isInit:e.initAgain,refreshIndexes:e.refreshIndexes}})],1)],1)])},staticRenderFns:[]};var x=a("VU/8")(y,I,!1,function(e){a("Fn4e")},null,null);t.default=x.exports},Ye0A:function(e,t){},cC5m:function(e,t){},fhrh:function(e,t){},"hgw/":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("mvHQ"),r=a.n(i),s=a("fZjL"),o=a.n(s),n=a("Xxa5"),l=a.n(n),c=a("//Fk"),u=a.n(c),d=a("exGp"),m=a.n(d),p=a("pFYg"),f=a.n(p),h=(a("I/JX"),a("ABj6"),a("ZHXk")),g=a.n(h),b=a("UGJx"),v=(a("0RKR"),{name:"importRelatedPart",props:{customerData:Array},mixins:[b.a],computed:{activeData:function(){return this.$store.state.refreshUnImportRelate},refreshImportRelate:function(){return this.$store.state.refreshPagesMenuId}},watch:{activeData:{handler:function(e,t){!e&&t&&e!=t&&this.importRelatedInit()},immediate:!0},refreshImportRelate:{handler:function(e){e&&("object"===(void 0===e?"undefined":f()(e))&&e.menuID&&e.menuID===this.flag&&window.location.hash.indexOf("/ImportRelatedPart")>-1||e===this.flag)&&this.importRelatedInit()}},textLabelArr:function(e,t){this.$emit("on-change",this.textLabelArr)},isEditOrAdd:function(e,t){this.importRelatedEditFormRule.parentCustomerName.required=!e}},data:function(){var e,t=this,a=function(e,t,a){""==t||isNaN(t)?a(new Error("请输入正确的数值")):!isNaN(t)&&(parseFloat(t).toFixed(2)<0||parseFloat(t).toFixed(2)>100)?a(new Error("请输入正确的数值")):a()};return{titleData:[],flag:"HB001-RPI001",tableLoding:!1,fullscreenLoading:!1,tableData:[],setRowList:[],stockTypeList:this.$DIC("关联方持股类型"),activeList:[],bulkDeleteList:[],excelName:"",excelFile:"",dialogVisible:!1,fileID:"",editDialogTableVisible:!1,form:{isUnitChildProject:"",parentId:"",mergeCustomerName:"",stockType:"",stockCapi:"",stockBreakRate:null,shortName:"",mergeProjectName:"",autoId:"",mergeProjectId:"",customerId:"",isMerge:"",mergeCustomerId:"",mergeScope:"",equityRatio:"",investmentRatio:"",preMergeProportion:"",curMergeProportion:"",uscc:"",incomeTaxRate:"",extractionRatio:""},parentId:"",projectList:[],formLabelWidth:"130px",customerId:{},editTitle:"编辑",importRelatedEditFormRule:{mergeCustomerName:[{required:!0,message:"母公司不能为空",trigger:"change"}],stockBreakRate:[{required:!0,message:"认缴比例不能为空",trigger:"blur"},{validator:a,trigger:"change"}],mergeCustomer:[{required:!0,message:"客户不能为空",trigger:"blur"}],stockCapi:[{validator:function(e,t,a){var i=/^[1-9]\d*$/,r=/^((0{1}\.\d{1,2})|([1-9]\d*\.{1}\d{1,2})|([1-9]+\d*))$/;t&&(i.test(t)&&t.length>8||r.test(t)&&t.length>11||!i.test(t)&&!r.test(t))?a(new Error("认缴金额限制长度为10(包括小数点后两位)")):a()},trigger:"change"}],equityRatio:[{required:!0,message:"权益比例不能为空",trigger:"blur"},{validator:a,trigger:"change"}],investmentRatio:[{required:!0,message:"母公司投资比例%不能为空",trigger:"blur"},{validator:a,trigger:"change"}],mergeProjectName:[{required:!0,message:"项目名称不能为空",trigger:"blur"}],shortName:[{required:!0,message:"项目简称不能为空",trigger:"blur"}],uscc:[{required:!0,message:"统一社会信用代码不能为空",trigger:"blur"}],preMergeProportion:[{required:!0,message:"合并比例（上期)不能为空",trigger:"blur"},{validator:a,trigger:"change"}],curMergeProportion:[{required:!0,message:"合并比例（本期)不能为空",trigger:"blur"},{validator:a,trigger:"change"}],parentId:[{required:!0,message:"母公司不能为空",trigger:"change"}],parentCustomerName:[{required:!1,message:"母公司不能为空",trigger:"change"}],incomeTaxRate:[{validator:a,trigger:"change"}],extractionRatio:[{validator:a,trigger:"change"}]},delReasonDialogVisible:!1,delReason:"",autoIdList:[],heightLightCurrentRow:!1,columns:[{prop:"autoId",label:"操作",fixed:!0,filterOptions:{disabled:!0}},{prop:"mergeCustomerName",label:"公司名称",width:"200px",fixed:!0,filterOptions:{disabled:!0}},{prop:"stockBreakRate",label:"认缴比例",fixed:!0,filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtEquity}},{prop:"equityRatio",label:"权益比例",fixed:!0,filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtEquity}},{prop:"investmentRatio",label:"母公司投资比例",fixed:!0,filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtEquity}},{prop:"curMergeProportion",label:"合并比例(本期)",fixed:!0,filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtEquity}},{prop:"preMergeProportion",label:"合并比例(上期)",fixed:!0,filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtEquity}},{prop:"shortName",label:"项目简称",filterOptions:{disabled:!0}},{prop:"uscc",label:"统一社会信用代码",filterOptions:{disabled:!0}},{prop:"incomeTaxRate",label:"所得税税率",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtEquity}},{prop:"extractionRatio",label:"提取比例",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtEquity}},{prop:"stockType",label:"持股方式",filterOptions:{disabled:!0}},{prop:"stockCapi",label:"注册资本（万）",align:"right",width:"200px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.commafyFn}},{prop:"mergeProjectName",label:"项目名称",width:"200px",filterOptions:{disabled:!0}}],bodyHeight:0,dataLength:0,curRow:{},parentCompanyName:[],options:[],initCompyDialogVisible:!1,selectInitStyle:"PM",selectInitStyleRadio:[{label:"CP",name:"客户管理系统"},{label:"PM",name:"项目管理系统"}],queryConfig:(e=m()(l.a.mark(function e(a,i,r){var s;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$sacpApis.relatedPageInit({customerId:t.curCustomerId,type:t.$constantVar.API_SACP_QUERY_SUBSIDIARIES});case 3:return(s=e.sent).data.map(function(e){e.extractionRatio=Math.round(1e3*e.extractionRatio)/10}),e.abrupt("return",u.a.resolve(s));case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",u.a.reject(e.t0));case 11:case"end":return e.stop()}},e,t,[[0,8]])})),function(t,a,i){return e.apply(this,arguments)}),uploadFileList:[],setBorder:!0,isEditOrAdd:!1,inParentName:"",inParentId:"",curCustomerId:"",selectedProjectName:"",curCompanyidList:[],mergeCustomerNameList:[],mergeCustomer:"",addTempProjectDialogVisible:!1,addTempProjectForm:{parentId:"",stockCapi:"",stockType:"",stockBreakRate:"",shortName:"",mergeProjectName:"",isTempProject:!0,preMergeProportion:null,curMergeProportion:null,uscc:"",incomeTaxRate:null,extractionRatio:null,investmentRatio:null},showLabel:"",invalid:0,count:0,outsideRange:0,merge:0,isTempProject:!1,mergeCustomerId:"",parentName:"",tagList:[],backspaceNum:0,multipleLimit:5,defaultFirstOption:!1,queryTag:"",curUscc:"",notRequired:!1,fullScreen:!1}},methods:{fullScreenChange:function(){this.fullScreen=!this.fullScreen},radioChange:function(){"1"==this.form.isUnitChildProject?(this.notRequired=!1,this.form.stockBreakRate=0,this.form.equityRatio=0,this.form.curMergeProportion=0,this.form.preMergeProportion=0):this.notRequired=!1},removeTag:function(e){this.tagList=this.tagList.filter(function(t){return t!=e})},handleInputConfirm:function(){var e=this;return this.queryTag.trim()?this.tagList.some(function(t){return t===e.queryTag})?this.$message.error("当前标签已经存在!"):void(this.queryTag.trim()&&this.tagList.length<5?this.tagList.push(this.queryTag):(this.$message.error("标签限制数量为5个!"),this.queryTag="")):this.$message.error("请输入标签内容!")},remoteMethod:function(e){if(e&&e.length>10)return this.$message.warning("标签限制长度为10 !按下回车键将自动截取当前编辑标签的前10位 !");this.queryTag=e},resetProjectList:function(){var e=this;this.fullscreenLoading=!0,this.projectList.length=0,this.$sacpApis.synProjectInfo({customerId:this.mergeCustomerId}).then(function(t){t.success?t.data.length&&t.data[0].find(function(t){var a={projectid:t.projectId,projectname:t.ProjectName};e.projectList.push(a)}):e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)}).finally(function(){return e.fullscreenLoading=!1})},handleCommand:function(e){"addSubCompany"==e?this.addSubCompany():"addTemporaryProject"==e&&this.addTemporaryProject()},addTemporaryProject:function(){this.inParentName="",this.addTempProjectDialogVisible=!0},handleCancelAddTempoProject:function(e){var t=this;this.addTempProjectDialogVisible=!1,this.$refs[e].resetFields(),o()(this.addTempProjectForm).forEach(function(e){return t.addTempProjectForm[e]=""})},handleAddTempProject:function(e){var t=this;this.curCompanyidList&&(this.curCompanyidList.length>1?this.addTempProjectForm.parentId=this.curCompanyidList.pop():this.addTempProjectForm.parentId=this.curCompanyidList[0]),this.addTempProjectForm.extractionRatio=Math.round(parseFloat(100*this.addTempProjectForm.extractionRatio))/1e4,this.addTempProjectForm.isTempProject=!0,this.$refs[e].validate(function(e){e&&t.$sacpApis.relatedPageEditSave(t.addTempProjectForm).then(function(e){e.success?(t.$message.success("新增临时项目成功!"),t.$eventBus.$emit("page-refresh",e.resultInfo.refreshIndexes),t.addTempProjectDialogVisible=!1,o()(t.addTempProjectForm).forEach(function(e){return t.addTempProjectForm[e]=""}),t.getParentCompList(),t.importRelatedInit()):t.$message.error(e.resultInfo.statusText)}).catch(function(e){return t.$message.error(e)})})},fmtProject:function(e,t){return e.mergeProjectId+"-"+e.mergeProjectName},fmtEquity:function(e,t){return t+"%"},resetProject:function(){var e=this;this.$confirm("项目重置会删除合并项目的所有数据（包含子公司数据）,确认重置吗？","确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.fullscreenLoading=!0,e.$sacpApis.resetProject().then(function(t){t.success?(e.$message.success("项目重置成功!"),e.importRelatedInit(),e.$store.commit("setResetProject",!0)):e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)}).finally(function(){e.fullscreenLoading=!1})}).catch(function(e){})},importRelatedForm:function(){this.dialogVisible=!0,this.title="模板导入(仅限excel)"},exportRelatedForm:function(){this.dialogFormVisible=!0,this.title="模板导出(仅限excel)",this.downloadImportTemplateData()},downloadImportTemplateData:function(){this.$sacpApis.downloadImportTemplateData({}).then(function(e){}).catch(function(e){console.log("失败",e)}).finally(function(){})},addSubCompany:function(){this.editTitle="添加子公司（选择项目管理系统已存在的客户）",this.selectedProjectName="",this.inParentName="",this.editDialogTableVisible=!0,this.isEditOrAdd=!1},initSubCompanyList:function(){this.initCompyDialogVisible=!0,this.selectInitStyle="PM"},confirmedSelectdInitStyle:function(){var e=this;this.fullscreenLoading=!0;var t={customerId:this.curCustomerId,type:this.selectInitStyle};this.$sacpApis.relatedPageListInit(t).then(function(t){t.success?(e.$message.success("初始化子公司列表成功"),e.$eventBus.$emit("page-refresh",t.resultInfo.refreshIndexes),e.importRelatedInit()):e.$message.error(t.resultInfo.statusText)}).catch(function(t){e.$message.error(t)}).finally(function(){e.initCompyDialogVisible=!1,e.fullscreenLoading=!1})},handleCheckedSelect:function(e){this.bulkDeleteList=e},bulkDelete:function(){var e=this;this.autoIdList=[],this.bulkDeleteList.forEach(function(t){var a={autoId:t.autoId,userDefine:t.userDefine};e.autoIdList.push(a)});var t=void 0;this.bulkDeleteList.length?this.$confirm("确定要删除这些数据吗？","确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.bulkDeleteList.some(function(e){return!e.userDefine})?(e.delReasonDialogVisible=!0,t="false"):(t="true",e.handleDelete(e.autoIdList,t))}).catch(function(e){}):this.$message.error("请选择需要删除的数据")},handleEdit:function(e,t){var a=this;(this.isEditOrAdd=!0,this.editTitle="编辑",this.editDialogTableVisible=!0,this.projectList=[],this.form.autoId=t.autoId,this.form.stockCapi=t.stockCapi,this.form.stockType=t.stockType,this.form.mergeScope=t.mergeScope,this.form.equityRatio=t.equityRatio,this.form.mergeProjectId=t.mergeProjectId,this.form.stockBreakRate=t.stockBreakRate,this.form.isMerge=t.isMerge,this.form.shortName=t.shortName,this.form.customerId=t.customerId,this.form.parentId=t.parentId,this.form.parentCustomerId=t.parentCustomerId,this.form.mergeProjectName=t.mergeProjectName,this.form.curMergeProportion=t.curMergeProportion,this.form.preMergeProportion=t.preMergeProportion,this.selectedProjectName=t.mergeProjectName,this.mergeCustomerId=t.mergeCustomerId,this.form.isUnitChildProject=t.isUnitChildProject,this.form.incomeTaxRate=t.incomeTaxRate,this.form.extractionRatio=t.extractionRatio,this.form.uscc=t.uscc,this.form.investmentRatio=t.investmentRatio,this.tagList=[],t.labels.trim()&&(this.tagList=t.labels.split("|")),this.isEditOrAdd&&(this.showLabel=""+t.mergeCustomerName),this.radioChange(),t.mergeProjectId)&&(1==t.mergeProjectId.split("")[0]?this.isTempProject=!0:this.isTempProject=!1);this.form.mergeCustomer=t.mergeCustomerId||t.mergeCustomer,this.$nextTick(function(){a.$refs.form.clearValidate()}),this.getProjectList(t.mergeCustomerId),g.a.eachTree(this.options,function(e){if(e.value==t.parentId)return a.form.parentCustomerName=e.label})},getProjectList:function(e){var t=this,a={customerId:e};this.projectList.length=0,this.$sacpApis.reachProjectInfo(a).then(function(e){e.success?e.data&&(t.projectList=[],e.data.forEach(function(e){var a={projectid:e.projectId,projectname:e.ProjectName};t.projectList.push(a)})):t.$message.error(e.resultInfo.statusText)}).catch(function(e){t.$message.error(e)})},handleSelectedCustomer:function(e){this.mergeCustomerId=e;var t=this.mergeCustomerNameList.filter(function(t){return t.customerId===e})[0];this.tagList=t?t.labels.split("|"):{},this.getProjectList(e),this.queryUsccByCustomerId(e)},handleSelectedProject:function(e){if(e){var t=this.projectList.filter(function(t){return t.projectid==e});this.$set(this.form,"mergeProjectName",t[0].projectid+"-"+t[0].projectname),this.$set(this.form,"mergeProjectId",t[0].projectid)}else this.$set(this.form,"mergeProjectName",""),this.$set(this.form,"mergeProjectId","")},clearMergeStockType:function(){this.$set(this.form,"stockType","")},getParentCompList:function(){var e=this,t={};this.curCustomerId&&(t={customerId:this.curCustomerId}),this.$sacpApis.addNewCompany(t).then(function(t){t.success?t.data&&(e.options=t.data):e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)})},handleNewData:function(e){var t=this,a=this.mergeCustomerNameList.filter(function(e){return e.customerId==t.form.mergeCustomer});this.isEditOrAdd?this.form.parentId=this.form.parentId||this.addTempProjectForm.parentId:(a.length>0?(this.form.mergeCustomerName=a[0].customerId+"-"+a[0].customerName,this.form.mergeCustomerId=a[0].customerId):this.form.mergeCustomerId=this.form.mergeCustomer,this.curCompanyidList&&(this.curCompanyidList.length>1?this.form.parentId=this.curCompanyidList.pop():this.form.parentId=this.curCompanyidList[0]),delete this.form.isUnitChildProject);var i="";this.tagList&&this.tagList.length&&g.a.arrayEach(this.tagList,function(e,a){return i+=a<t.tagList.length-1?e+"|":""+e}),g.a.set(this.form,"labels",i),this.$refs[e].validate(function(e){var a="";if(e){var i=JSON.parse(r()(t.form));i.extractionRatio=Math.round(parseFloat(100*t.form.extractionRatio))/1e4,t.$sacpApis.relatedPageEditSave(i).then(function(e){e.success?(a=t.form.autoId?"编辑数据成功":"新增数据成功",t.$eventBus.$emit("page-refresh",e.resultInfo.refreshIndexes),t.$message.success(a),t.editDialogTableVisible=!1,o()(t.form).forEach(function(e){return t.form[e]=""}),t.getParentCompList(),t.importRelatedInit(),t.$message.success("保存成功!")):t.$message.error(e.resultInfo.statusText),t.notRequired=!1}).catch(function(e){return t.$message.error(e)})}})},handleChange:function(e){this.curCompanyidList=e},handleCancelEdit:function(e){var t=this;this.editDialogTableVisible=!1,this.notRequired=!1,this.tagList=[],this.$refs[e].resetFields(),o()(this.form).forEach(function(e){return t.form[e]=""})},handleClose:function(e){var t=this;this.tagList=[],o()(this.form).forEach(function(e){return t.form[e]=""})},handleUserDefineDel:function(e,t){var a=this;this.autoIdList=[];var i={autoId:e,userDefine:t.row.userDefine};if(t&&!t.row.userDefine)this.delReasonDialogVisible=!0,this.autoIdList.push(i);else{this.autoIdList.push(i),this.$confirm("确定要删除这条数据吗？","确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){a.handleDelete(a.autoIdList,"true")}).catch(function(e){})}},confirmedDel:function(){if(!this.delReason)return this.$message.warning("请填写理由");this.handleDelete(this.autoIdList,"false"),this.delReasonDialogVisible=!1},handleDelReasonClose:function(e){this.delReason=""},handleDelete:function(e,t){var a=this,i={autoIds:e,isDel:t,remark:this.delReason};this.$sacpApis.deleteDate(i).then(function(e){e.success?(t&&a.$store.commit("setRefreshUnImportRelate",!0),a.$eventBus.$emit("page-refresh",e.resultInfo.refreshIndexes),a.bulkDeleteList=[],a.delReason="",a.getReletedPartStatus(),a.getParentCompList(),a.importRelatedInit()):a.$message.error(e.resultInfo.statusText)}).catch(function(e){return a.$message.error(e)}).finally(function(){a.delReason=""})},handleActive:function(e){var t=this,a={autoId:e};this.$sacpApis.deleteActive(a).then(function(e){e.success?(t.$store.commit("setRefreshUnImportRelate",!0),t.importRelatedInit()):t.$message.error(e.resultInfo.statusText)}).catch(function(e){return t.$message.error(e)})},importExcel:function(){this.$refs.uploadExcel.click()},readExcel:function(e){var t=e.target.files;this.excelName=t[0].name,this.excelFile=this.$refs.uploadExcel.files[0],e.path[0].value=""},confirUpload:function(){var e=this,t=new FormData;t.append("file",this.excelFile),document.getElementById("uploadExcel").innerHTML="",this.$sacpApis.uploadExcel(t).then(function(t){if(t.success){e.$refs.uploadExcel;var a={fileId:t.data[0].fileId};e.uploadSuccessCB(a)}else{var i=t.resultInfo.statusText;e.$message.error(i)}}).catch(function(t){return e.$message.error(t)})},uploadSuccessCB:function(e){var t=this;this.fullscreenLoading=!0,this.$sacpApis.uploadedCB(e).then(function(e){e.success?(t.importRelatedInit(),t.$eventBus.$emit("page-refresh",e.resultInfo.refreshIndexes),t.dialogVisible=!1,t.$message({dangerouslyUseHTMLString:!0,message:e.resultInfo.statusText}),t.excelName="",t.excelFile=""):t.$message.error(e.resultInfo.statusText)}).catch(function(e){t.$message.error(e)}).finally(function(){return t.fullscreenLoading=!1})},confirDownload:function(){this.$sacpApis.downLoad({fileId:11},"关联方导入模板.xlsx")},importRelatedInit:function(){var e=this;this.fullscreenLoading=!0,this.customerId={customerId:this.curCustomerId},this.$sacpApis.relatedPageInit(this.customerId).then(function(t){if(t.success)if(t.data){e.tableData=t.data;var a=[];g.a.eachTree(e.tableData,function(e){return a.push(e)}),e.dataLength=a.length}else e.dataLength=0;else e.$message.error(t.resultInfo.statusText)}).catch(function(t){e.$message.error(t)}).finally(function(){e.getParentCompList(),e.fullscreenLoading=!1,e.$store.commit("setRefreshPagesMenuId",null),e.$store.commit("setRemoveBagdeScope","ImportRelatedPart")})},commafyFn:function(e,t){return g.a.commafy(t,{digits:2})},isRefreshDataLength:function(e){this.dataLength=e,this.getReletedPartStatus()},handleCurstomerId:function(){var e=JSON.parse(sessionStorage.getItem("curCustomerData"));this.curCustomerId=e.curCustomerId,this.getParentCompList(),this.getCustormIdList()},getCustormIdList:function(){var e=this;this.$sacpApis.findCustomerSelect().then(function(t){t.success?(e.mergeCustomerNameList=t.data[0],e.mergeCustomerNameList&&e.mergeCustomerNameList.map(function(e){e.showLabel=e.customerId+" - "+e.customerName})):e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)})},getReletedPartStatus:function(){var e=this;this.$sacpApis.relatedPartStatus().then(function(t){if(t.success){var a=t.data[0];e.invalid=a.invalid,e.count=a.count,e.outsideRange=a.outsideRange,e.merge=a.merge}else e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error})},queryUsccByCustomerId:function(e){var t=this,a={param1:e};this.$sacpApis.queryUsccByCustomerId(a).then(function(e){e.success?t.form.uscc=e.data[0].uscc:t.$message.error(e.resultInfo.statusText)}).catch(function(e){t.$message.error(e)}).finally(function(){})},exportFile:function(){this.exportExcel()},exportExcel:function(){var e=this,t={customerId:this.curCustomerId,queryUrl:"dgCenter/HbMergeQuery.queryListSubsidiaries.json",columnMap:[]};this.columns.forEach(function(e,a){a>0&&t.columnMap.push({cnName:e.label,enName:e.prop,size:e.width?e.width.replace("px",""):"",className:e.align?"text-"+e.align:"text-left",renderer:""})});var a={myParams:r()(t),title:window.encodeURI("关联方导入.xlsx")};this.$sacpApis.exportExcel(a,"关联方导入.xlsx").then(function(t){t.success?e.$message.success("下载成功!"):e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)}).finally(function(){})}},created:function(){this.handleCurstomerId(),this.getReletedPartStatus()}}),C={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"importRelatedPart"},[i("div",{class:{fullScreen:e.fullScreen?"fullScreen":"",fullScreenBox:!0}},[i("div",{staticClass:"tableClass"},[i("bdo-table",{ref:"table",attrs:{columns:e.columns,"enable-filter":!1,"enable-toolbox":!1,"enable-view-type":!1,data:e.tableData,"page-total":e.dataLength,showIndexColumn:!0,showCheckBox:!0,activeList:e.activeList,tableLoding:e.tableLoding,queryConfig:e.queryConfig,setBorder:e.setBorder,defaultExpandAll:!0,exportReport:!0},on:{handleSelect:e.handleCheckedSelect,isRefreshDataLength:e.isRefreshDataLength,exportFile:e.exportFile},scopedSlots:e._u([{key:"col-autoId",fn:function(t){return[i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"编辑",placement:"top-start"}},[i("el-button",{staticClass:"editBtn editBtnCol",attrs:{size:"mini",type:"text",disabled:0==t.row.activeFlag&&!t.row.userDefine,icon:"el-icon-edit-outline normalWeight"},on:{click:function(a){return e.handleEdit(t.$index,t.row)}}})],1),e._v(" "),"1"==t.row.activeFlag?i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"删除",placement:"top-start"}},[i("el-button",{staticClass:"delBtnCol",attrs:{size:"mini",type:"text",icon:"el-icon-delete normalWeight"},on:{click:function(a){return e.handleUserDefineDel(t.row.autoId,t)}}})],1):"0"!=t.row.activeFlag||t.row.userDefine?e._e():i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"激活",placement:"top-start"}},[i("el-button",{staticClass:"activeBtnCol",attrs:{size:"mini",type:"text",icon:"el-icon-s-opportunity normalWeight"},on:{click:function(a){return e.handleActive(t.row.autoId)}}})],1)]}}])},[e._v(" "),i("template",{slot:"text"},[i("div",[i("span",[e._v("关联方件数:"+e._s(e.count+"件"))]),e._v(" "),i("span",[e._v(" 合并范围内:"+e._s(e.merge+"件"))]),e._v(" "),i("span",[e._v(" 合并范围外且是关联方:"+e._s(e.outsideRange+"件"))]),e._v(" "),i("span",[e._v(" 作废:"+e._s(e.invalid+"件"))])])]),e._v(" "),i("template",{slot:"action"},[i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"项目重置",placement:"top-start"}},[i("el-button",{staticClass:"setBtn",attrs:{circle:"",size:"small",type:"primary",icon:"el-icon-switch-button"},on:{click:e.resetProject}})],1),e._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"模板导入",placement:"top-start"}},[i("el-button",{attrs:{circle:"",size:"small",type:"primary",icon:"el-icon-upload"},on:{click:e.importRelatedForm}})],1),e._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"模板导出",placement:"top-start"}},[i("el-button",{attrs:{circle:"",size:"small",type:"primary",icon:"el-icon-upload"},on:{click:e.exportRelatedForm}})],1),e._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"初始化子公司列表",placement:"top-start"}},[i("el-button",{staticClass:"initBtn",attrs:{circle:"",size:"small",type:"primary",icon:"el-icon-refresh-right"},on:{click:e.initSubCompanyList}})],1),e._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"批量删除",placement:"top-start"}},[i("el-button",{attrs:{circle:"",size:"small",type:"primary",icon:"el-icon-delete"},on:{click:e.bulkDelete}})],1),e._v(" "),i("el-dropdown",{on:{command:e.handleCommand}},[i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"添加子公司",placement:"top-start"}},[i("el-button",{attrs:{size:"small",circle:"",type:"primary",icon:"el-icon-circle-plus-outline"}})],1),e._v(" "),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",{attrs:{command:"addSubCompany"}},[e._v("添加子公司（选择项目管理系统已存在的客户）")]),e._v(" "),i("el-dropdown-item",{attrs:{command:"addTemporaryProject"}},[e._v("添加子公司（添加项目管理系统不存在的客户）")])],1)],1),e._v(" "),i("el-tooltip",{attrs:{effect:"dark",content:e.fullScreen?"取消全屏":"全屏",placement:"top-start"}},[i("el-button",{class:{fullScreenBtn:!0},attrs:{type:"primary",circle:"",size:"small"},on:{click:e.fullScreenChange}},[e.fullScreen?e._e():i("img",{attrs:{src:a("/Dxn"),alt:""}}),e._v(" "),e.fullScreen?i("img",{attrs:{src:a("W+0t"),alt:""}}):e._e()])],1)],1)],2)],1),e._v(" "),i("el-dialog",{attrs:{visible:e.dialogVisible,width:"45%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("div",{staticClass:"updateBox"},[i("el-input",{attrs:{type:"text",size:"mini"},model:{value:e.excelName,callback:function(t){e.excelName=t},expression:"excelName"}}),e._v(" "),i("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"uploadExcel",attrs:{type:"file",id:"uploadExcel",accept:".xls, .xlsx, .excel"},on:{change:e.readExcel}}),e._v(" "),i("el-button",{staticClass:"btnText uploadBtn",attrs:{type:"primary",size:"small"},on:{click:e.importExcel}},[i("i",{staticClass:"el-icon-folder-opened"}),e._v("浏览\n                    ")])],1),e._v(" "),i("div",{staticClass:"buttonList"},[i("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.confirDownload}},[e._v("模板文件下载 ")]),e._v(" "),i("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.confirUpload}},[e._v("确定 ")]),e._v(" "),i("el-button",{attrs:{type:"info",size:"small"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取消 ")])],1)]),e._v(" "),i("el-dialog",{attrs:{title:e.editTitle,visible:e.editDialogTableVisible,"destroy-on-close":!0,width:"45%"},on:{"update:visible":function(t){e.editDialogTableVisible=t},close:e.handleClose}},[i("el-form",{ref:"form",attrs:{model:e.form,rules:e.importRelatedEditFormRule}},[i("el-form-item",{attrs:{label:"母公司名称","label-width":e.formLabelWidth,prop:"parentCustomerName"}},[e.isEditOrAdd?i("el-input",{attrs:{disabled:""},model:{value:e.form.parentCustomerName,callback:function(t){e.$set(e.form,"parentCustomerName","string"==typeof t?t.trim():t)},expression:"form.parentCustomerName"}}):i("el-cascader",{ref:"cascader",staticClass:"importRelateCascader",attrs:{options:e.options,clearable:"",filterable:"",props:{checkStrictly:!0}},on:{change:e.handleChange},scopedSlots:e._u([{key:"default",fn:function(t){t.node;var a=t.data;return[i("span",{staticClass:"spanClass",attrs:{title:a.label}},[e._v(e._s(a.label))])]}}]),model:{value:e.form.parentCustomerName,callback:function(t){e.$set(e.form,"parentCustomerName","string"==typeof t?t.trim():t)},expression:"form.parentCustomerName"}})],1),e._v(" "),i("el-form-item",{staticClass:"projectName",attrs:{label:"客户","label-width":e.formLabelWidth,prop:e.isEditOrAdd?"showLabel":"mergeCustomer"}},[e.isEditOrAdd?i("el-input",{attrs:{disabled:e.isEditOrAdd},model:{value:e.showLabel,callback:function(t){e.showLabel="string"==typeof t?t.trim():t},expression:"showLabel"}}):i("el-select",{attrs:{filterable:"",placeholder:"请选择客户",clearable:""},on:{change:e.handleSelectedCustomer},model:{value:e.form.mergeCustomer,callback:function(t){e.$set(e.form,"mergeCustomer",t)},expression:"form.mergeCustomer"}},e._l(e.mergeCustomerNameList,function(e){return i("el-option",{key:e.customerId,attrs:{label:e.showLabel,value:e.customerId}})}),1)],1),e._v(" "),i("el-form-item",{staticClass:"projectName",attrs:{label:"标签","label-width":e.formLabelWidth,prop:"label"}},[i("el-select",{staticClass:"tagInput",attrs:{clearable:"",multiple:"","multiple-limit":e.multipleLimit,filterable:"","allow-create":"","default-first-option":e.defaultFirstOption,placeholder:"输入标签内容，用回车添加","filter-method":e.remoteMethod},on:{"remove-tag":e.removeTag},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleInputConfirm(t)}},model:{value:e.tagList,callback:function(t){e.tagList=t},expression:"tagList"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"认缴比例%","label-width":e.formLabelWidth,prop:"stockBreakRate"}},[i("el-input",{attrs:{disabled:e.notRequired},model:{value:e.form.stockBreakRate,callback:function(t){e.$set(e.form,"stockBreakRate","string"==typeof t?t.trim():t)},expression:"form.stockBreakRate"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"权益比例%","label-width":e.formLabelWidth,prop:"equityRatio"}},[i("el-input",{attrs:{disabled:e.notRequired},model:{value:e.form.equityRatio,callback:function(t){e.$set(e.form,"equityRatio","string"==typeof t?t.trim():t)},expression:"form.equityRatio"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"母公司投资比例%","label-width":e.formLabelWidth,prop:"investmentRatio"}},[i("el-input",{attrs:{disabled:e.notRequired},model:{value:e.form.investmentRatio,callback:function(t){e.$set(e.form,"investmentRatio","string"==typeof t?t.trim():t)},expression:"form.investmentRatio"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"合并比例（本期）%","label-width":e.formLabelWidth,prop:"curMergeProportion"}},[i("el-input",{attrs:{disabled:e.notRequired},model:{value:e.form.curMergeProportion,callback:function(t){e.$set(e.form,"curMergeProportion","string"==typeof t?t.trim():t)},expression:"form.curMergeProportion"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"合并比例（上期）%","label-width":e.formLabelWidth,prop:"preMergeProportion"}},[i("el-input",{attrs:{disabled:e.notRequired},model:{value:e.form.preMergeProportion,callback:function(t){e.$set(e.form,"preMergeProportion","string"==typeof t?t.trim():t)},expression:"form.preMergeProportion"}})],1),e._v(" "),i("el-form-item",{attrs:{label:" 所得税税率 %","label-width":e.formLabelWidth,prop:"incomeTaxRate"}},[i("el-input",{model:{value:e.form.incomeTaxRate,callback:function(t){e.$set(e.form,"incomeTaxRate","string"==typeof t?t.trim():t)},expression:"form.incomeTaxRate"}})],1),e._v(" "),i("el-form-item",{attrs:{label:" 提取比例 %","label-width":e.formLabelWidth,prop:"extractionRatio"}},[i("el-input",{model:{value:e.form.extractionRatio,callback:function(t){e.$set(e.form,"extractionRatio","string"==typeof t?t.trim():t)},expression:"form.extractionRatio"}})],1),e._v(" "),i("el-form-item",{staticClass:"projectName",attrs:{label:"持股方式","label-width":e.formLabelWidth,prop:"stockType"}},[i("el-select",{attrs:{filterable:"",clearableplaceholder:"请选择持股方式",clearable:""},on:{clear:e.clearMergeStockType},model:{value:e.form.stockType,callback:function(t){e.$set(e.form,"stockType",t)},expression:"form.stockType"}},e._l(e.stockTypeList,function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),i("el-form-item",{attrs:{label:"注册资本（万）","label-width":e.formLabelWidth,prop:"stockCapi"}},[i("el-input",{model:{value:e.form.stockCapi,callback:function(t){e.$set(e.form,"stockCapi","string"==typeof t?t.trim():t)},expression:"form.stockCapi"}})],1),e._v(" "),i("el-form-item",{staticClass:"nowrap",attrs:{label:"项目名称","label-width":e.formLabelWidth,prop:"mergeProjectName"}},[i("div",{staticStyle:{display:"flex","align-items":"center","justify-content":"center"}},[e.isTempProject?i("el-input",{model:{value:e.selectedProjectName,callback:function(t){e.selectedProjectName=t},expression:"selectedProjectName"}}):i("el-select",{staticStyle:{width:"100%","margin-right":"5px"},attrs:{filterable:"",placeholder:"请选择项目名称",clearable:""},on:{change:e.handleSelectedProject},model:{value:e.selectedProjectName,callback:function(t){e.selectedProjectName=t},expression:"selectedProjectName"}},e._l(e.projectList,function(e){return i("el-option",{key:e.projectid,staticStyle:{width:"100%"},attrs:{label:e.projectname,value:e.projectid}})}),1),e._v(" "),i("el-button",{attrs:{circle:"",size:"small",type:"primary",icon:"el-icon-refresh-left",title:"同步按钮"},on:{click:e.resetProjectList}})],1)]),e._v(" "),i("el-form-item",{attrs:{label:"项目简称","label-width":e.formLabelWidth,prop:"shortName"}},[i("el-input",{model:{value:e.form.shortName,callback:function(t){e.$set(e.form,"shortName","string"==typeof t?t.trim():t)},expression:"form.shortName"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"统一社会信用代码","label-width":e.formLabelWidth,prop:"uscc"}},[i("el-input",{attrs:{maxlength:"25"},model:{value:e.form.uscc,callback:function(t){e.$set(e.form,"uscc","string"==typeof t?t.trim():t)},expression:"form.uscc"}})],1),e._v(" "),e.isEditOrAdd?i("el-form-item",{staticClass:"isUnitChildProject",attrs:{label:"是否母公司单体项目:"}},[i("el-radio-group",{on:{change:e.radioChange},model:{value:e.form.isUnitChildProject,callback:function(t){e.$set(e.form,"isUnitChildProject",t)},expression:"form.isUnitChildProject"}},[i("el-radio",{attrs:{label:"0"}},[e._v("否")]),e._v(" "),i("el-radio",{attrs:{label:"1"}},[e._v("是")])],1)],1):e._e()],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"info",size:"small"},on:{click:function(t){return e.handleCancelEdit("form")}}},[e._v("取 消 ")]),e._v(" "),i("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.handleNewData("form")}}},[e._v("确 定 ")])],1)],1),e._v(" "),i("el-dialog",{attrs:{title:"添加子公司（添加项目管理系统不存在的客户）",visible:e.addTempProjectDialogVisible,"destroy-on-close":!0,width:"45%"},on:{"update:visible":function(t){e.addTempProjectDialogVisible=t},close:function(t){return e.handleCancelAddTempoProject("addTempProjectForm")}}},[i("el-form",{ref:"addTempProjectForm",attrs:{model:e.addTempProjectForm,rules:e.importRelatedEditFormRule}},[i("el-form-item",{attrs:{label:"母公司名称","label-width":e.formLabelWidth,prop:"parentId"}},[i("el-cascader",{ref:"cascader",staticClass:"importRelateCascader",attrs:{options:e.options,clearable:"",filterable:"",props:{checkStrictly:!0}},on:{change:e.handleChange},scopedSlots:e._u([{key:"default",fn:function(t){t.node;var a=t.data;return[i("span",{staticClass:"spanClass",attrs:{title:a.label}},[e._v(e._s(a.label))])]}}]),model:{value:e.addTempProjectForm.parentId,callback:function(t){e.$set(e.addTempProjectForm,"parentId","string"==typeof t?t.trim():t)},expression:"addTempProjectForm.parentId"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"认缴比例%","label-width":e.formLabelWidth,prop:"stockBreakRate"}},[i("el-input",{model:{value:e.addTempProjectForm.stockBreakRate,callback:function(t){e.$set(e.addTempProjectForm,"stockBreakRate","string"==typeof t?t.trim():t)},expression:"addTempProjectForm.stockBreakRate"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"权益比例%","label-width":e.formLabelWidth,prop:"equityRatio"}},[i("el-input",{model:{value:e.addTempProjectForm.equityRatio,callback:function(t){e.$set(e.addTempProjectForm,"equityRatio","string"==typeof t?t.trim():t)},expression:"addTempProjectForm.equityRatio"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"母公司投资比例%","label-width":e.formLabelWidth,prop:"investmentRatio"}},[i("el-input",{attrs:{disabled:e.notRequired},model:{value:e.addTempProjectForm.investmentRatio,callback:function(t){e.$set(e.addTempProjectForm,"investmentRatio","string"==typeof t?t.trim():t)},expression:"addTempProjectForm.investmentRatio"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"合并比例（本期）%","label-width":e.formLabelWidth,prop:"curMergeProportion"}},[i("el-input",{model:{value:e.addTempProjectForm.curMergeProportion,callback:function(t){e.$set(e.addTempProjectForm,"curMergeProportion","string"==typeof t?t.trim():t)},expression:"addTempProjectForm.curMergeProportion"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"合并比例（上期）%","label-width":e.formLabelWidth,prop:"preMergeProportion"}},[i("el-input",{model:{value:e.addTempProjectForm.preMergeProportion,callback:function(t){e.$set(e.addTempProjectForm,"preMergeProportion","string"==typeof t?t.trim():t)},expression:"addTempProjectForm.preMergeProportion"}})],1),e._v(" "),i("el-form-item",{attrs:{label:" 所得税税率 %","label-width":e.formLabelWidth,prop:"incomeTaxRate"}},[i("el-input",{model:{value:e.addTempProjectForm.incomeTaxRate,callback:function(t){e.$set(e.addTempProjectForm,"incomeTaxRate","string"==typeof t?t.trim():t)},expression:"addTempProjectForm.incomeTaxRate"}})],1),e._v(" "),i("el-form-item",{attrs:{label:" 提取比例 %","label-width":e.formLabelWidth,prop:"extractionRatio"}},[i("el-input",{model:{value:e.addTempProjectForm.extractionRatio,callback:function(t){e.$set(e.addTempProjectForm,"extractionRatio","string"==typeof t?t.trim():t)},expression:"addTempProjectForm.extractionRatio"}})],1),e._v(" "),i("el-form-item",{staticClass:"projectName",attrs:{label:"持股方式","label-width":e.formLabelWidth,prop:"stockType"}},[i("el-select",{attrs:{filterable:"",clearableplaceholder:"请选择持股方式",clearable:""},on:{clear:e.clearMergeStockType},model:{value:e.addTempProjectForm.stockType,callback:function(t){e.$set(e.addTempProjectForm,"stockType",t)},expression:"addTempProjectForm.stockType"}},e._l(e.stockTypeList,function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),i("el-form-item",{attrs:{label:"注册资本（万）","label-width":e.formLabelWidth,prop:"stockCapi"}},[i("el-input",{model:{value:e.addTempProjectForm.stockCapi,callback:function(t){e.$set(e.addTempProjectForm,"stockCapi","string"==typeof t?t.trim():t)},expression:"addTempProjectForm.stockCapi"}})],1),e._v(" "),i("el-form-item",{staticClass:"mergeProjectName",attrs:{label:"客户名称","label-width":e.formLabelWidth,prop:"mergeProjectName"}},[i("el-input",{model:{value:e.addTempProjectForm.mergeProjectName,callback:function(t){e.$set(e.addTempProjectForm,"mergeProjectName","string"==typeof t?t.trim():t)},expression:"addTempProjectForm.mergeProjectName"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"客户简称","label-width":e.formLabelWidth,prop:"shortName"}},[i("el-input",{model:{value:e.addTempProjectForm.shortName,callback:function(t){e.$set(e.addTempProjectForm,"shortName","string"==typeof t?t.trim():t)},expression:"addTempProjectForm.shortName"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"统一社会信用代码","label-width":e.formLabelWidth,prop:"uscc"}},[i("el-input",{attrs:{maxlength:"25"},model:{value:e.addTempProjectForm.uscc,callback:function(t){e.$set(e.addTempProjectForm,"uscc","string"==typeof t?t.trim():t)},expression:"addTempProjectForm.uscc"}})],1)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"info",size:"small"},on:{click:function(t){return e.handleCancelAddTempoProject("addTempProjectForm")}}},[e._v("取 消 ")]),e._v(" "),i("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.handleAddTempProject("addTempProjectForm")}}},[e._v("确 定 ")])],1)],1),e._v(" "),i("el-dialog",{attrs:{title:"提示",visible:e.delReasonDialogVisible,width:"30%"},on:{"update:visible":function(t){e.delReasonDialogVisible=t}}},[i("span",{staticStyle:{"text-align":"left",display:"inherit"}},[e._v("删除理由:")]),e._v(" "),i("el-input",{attrs:{maxlength:"100","show-word-limit":""},model:{value:e.delReason,callback:function(t){e.delReason="string"==typeof t?t.trim():t},expression:"delReason"}}),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"info",size:"small"},on:{click:function(t){e.delReasonDialogVisible=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.confirmedDel}},[e._v("确 定")])],1)],1),e._v(" "),i("el-dialog",{attrs:{title:"提示",visible:e.initCompyDialogVisible,width:"30%","destroy-on-close":!0},on:{"update:visible":function(t){e.initCompyDialogVisible=t}}},[i("div",{staticStyle:{"text-align":"left",display:"inherit","margin-bottom":"20px"}},[e._v("\n                    请选择数据初始化方式:\n                ")]),e._v(" "),i("el-radio-group",{model:{value:e.selectInitStyle,callback:function(t){e.selectInitStyle=t},expression:"selectInitStyle"}},e._l(e.selectInitStyleRadio,function(t){return i("el-radio",{key:t.index,attrs:{label:t.label}},[e._v(e._s(t.name)+" ")])}),1),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"info",size:"small"},on:{click:function(t){e.initCompyDialogVisible=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.confirmedSelectdInitStyle}},[e._v("确 定")])],1)],1)],1)])},staticRenderFns:[]};var y=a("VU/8")(v,C,!1,function(e){a("9Idm")},"data-v-7b41b49b",null);t.default=y.exports},iFwk:function(e,t){},kJUT:function(e,t){},oGeI:function(e,t){},oROU:function(e,t){},qER7:function(e,t){},"qN8/":function(e,t){},qnMx:function(e,t){},rO8z:function(e,t){},sImP:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("Gu7T"),r=a.n(i),s=a("gRE1"),o=a.n(s),n=a("fZjL"),l=a.n(n),c=a("//Fk"),u=a.n(c),d=a("pFYg"),m=a.n(d),p=a("woOf"),f=a.n(p),h=a("mvHQ"),g=a.n(h),b=a("MICi"),v=a.n(b),C=a("oGZU"),y=a.n(C),I=a("ZHXk"),x=a.n(I),w=a("UGJx"),D=a("lCTB"),S=a("lHA8"),T=a.n(S),k=a("c/Tr"),j=a.n(k),_=a("K/T8"),F={name:"transactionSummary",mixins:[],components:{},directives:{},data:function(){return{formatter:_.b,isBorder:!0,data:[],loading:!1,spanArr:[],pos:0,tabsName:"A1",tabIndex:2,tab:[],tableHeader:[],typeList:{},typeList1:{},tableAllData:[],mateShortName:[],activeTabName:"A1"}},watch:{},methods:{tabItemList:function(e){var t=[];e&&(this.tableAllData=e),this.tableAllData.forEach(function(e){"A0"!=e.classifyCode&&"G0"!=e.classifyCode&&"E0"!=e.classifyCode&&t.push(g()({label:e.classifyName,name:e.classifyCode}))});var a=j()(new T.a(t)).map(function(e){return JSON.parse(e)});this.tab=a,a&&a.length&&(this.tabsName=a[0].name),this.tabClick()},tabClick:function(e){var t=this;this.activeTabName=e?e.name:"A1";var a=[],i=[];this.tableAllData.forEach(function(e){e.classifyCode===t.tabsName&&(a[0]={title:e.classifyName,code:e.classifyCode},i.push({title:e.fieldName,dataField:e.dataField,prop:e.fieldCode,dicCode:e.dicCode,pageFieldType:e.pageFieldType}))}),a[0].children=i,a=[{title:"公司名称",prop:"shortName"},{title:"关联方名称",prop:"mergeCustomerName"}].concat(r()(a)),this.tableHeader=a,this.queryAllInternalTransactionInfo()},objectSpanMethod:function(e){e.row,e.column;var t=e.rowIndex;if(0===e.columnIndex){var a=this.spanArr[t];return{rowspan:a,colspan:a>0?1:0}}},getSpanArr:function(e){for(var t=0;t<e.length;t++)0===t?(this.spanArr.push(1),this.pos=0):e[t].mergeCustomerName===e[t-1].mergeCustomerName?(this.spanArr[this.pos]+=1,this.spanArr.push(0)):(this.spanArr.push(1),this.pos=t)},queryAllInternalTransactionInfo:function(){var e=this;this.loading=!0,this.$sacpApis.queryAllInternalTransactionInfo({param1:this.mergeProjectId}).then(function(t){t.success?(e.loading=!1,e.data=t.data[0][e.tabsName]?t.data[0][e.tabsName]:[],e.data&&e.data.length&&e.getSpanArr(e.data),e.enterpriseList()):e.$message.error(t.resultInfo.statusText)}).catch(function(t){e.$message.error(t)}).finally(function(){e.loading=!1})},cellDataHanlder:function(e,t){if("固定资产购入方式"===t.dicCode)return this.typeList[e[t.prop]];if("固定资产折旧方法"===t.dicCode)return this.typeList1[e[t.prop]];if("6"===t.pageFieldType)return e[t.prop]?e[t.prop].replace("|","-"):e[t.prop];switch(t.pageFieldType){case"1":return _.b.commafy("",e[t.prop]);case"5":return e[t.prop].slice(0,e[t.prop].lastIndexOf("-"));default:return e[t.prop]}},enterpriseList:function(){var e=this,t=sessionStorage.getItem("curCustomerData"),a=JSON.parse(t),i=a.curCustomerId,r=a.curProjectId;this.$sacpApis.enterpriseList({customerId:i,projectId:r}).then(function(t){t.success?t.data?t.data.forEach(function(t){e.data.forEach(function(a){t.mergeProjectId==a.mergeProjectId&&e.$set(a,"mergeCustomerName",t.shortName),t.mergeProjectId==a.childProjectId&&e.$set(a,"shortName",t.shortName)})}):e.dataLength=0:e.$message.error(t.resultInfo.statusText)}).catch(function(t){e.$message.error(t)}).finally(function(){})}},mounted:function(){var e={};this.$DIC("固定资产购入方式").map(function(t,a){e[t.value]=t.label}),this.typeList=e;var t={};this.$DIC("固定资产折旧方法").map(function(e,a){t[e.value]=e.label}),this.typeList1=t}},$={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-tabs",{attrs:{type:"card"},on:{"tab-click":e.tabClick},model:{value:e.tabsName,callback:function(t){e.tabsName=t},expression:"tabsName"}},e._l(e.tab,function(t,i){return a("el-tab-pane",{key:i,attrs:{label:t.label,name:t.name}},[e.activeTabName===t.name?a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"table",refInFor:!0,staticStyle:{width:"100%"},attrs:{data:e.data,border:e.isBorder,size:"small",height:"calc(100vh - 200px)"}},e._l(e.tableHeader,function(t,i){return a("el-table-column",{key:i,attrs:{"header-align":"center",stripe:!0,label:t.title,prop:t.prop,"min-width":"120px",align:"left","show-overflow-tooltip":!0}},e._l(t.children,function(t,i){return a("el-table-column",{key:i,attrs:{"header-align":"center",stripe:!0,label:t.title,prop:t.prop,"min-width":"120px","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(i){var r=i.row;return i.column,i.$index,[a("div",{style:{textAlign:isNaN(r[t.prop])?"left":"right"}},[e._v("\n                                "+e._s(e.cellDataHanlder(r,t))+"\n                            ")])]}}],null,!0)})}),1)}),1):e._e()],1)}),1)],1)},staticRenderFns:[]};var N=a("VU/8")(F,$,!1,function(e){a("0+Rn")},"data-v-4102afc4",null).exports,L=a("Dd8w"),A=a.n(L),P={name:"checkListTable",mixins:[],components:{},directives:{},props:["type"],data:function(){return{isBorder:!0,data:[],loading:!1}},methods:{submit:function(){},getTableData:function(){var e=this;this.data=[];var t={type:this.type};this.$sacpApis.insideTransactionCheck(t).then(function(t){if(t.success){var a=[];t.data.forEach(function(e){a.push(A()({},e,{sideGrossMargin:100*e.sideGrossMargin}))}),e.data=a}}).catch(function(t){e.$message.error(t)}).finally(function(){})},formatFun:function(e){return x.a.commafy(e,{digits:2})},max100:function(e,t){e>100?t.sideGrossMargin=100:e<0?t.sideGrossMargin=0:e||(t.sideGrossMargin=0)}}},M={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"table",staticStyle:{width:"100%"},attrs:{data:e.data,border:e.isBorder,size:"small"}},[a("el-table-column",{attrs:{label:"序号",width:"64px",type:"index"}}),e._v(" "),a("el-table-column",{attrs:{"header-align":"center",stripe:!0,prop:"label",label:"关联方名称","min-width":"120px",align:"right","show-overflow-tooltip":!0}}),e._v(" "),a("el-table-column",{attrs:{"header-align":"center",stripe:!0,prop:"checkData_1",label:"内部商品和劳务、租赁等交易","min-width":"120px",align:"right","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(e.formatFun(t.row.checkData_1))+"\n            ")]}}])}),e._v(" "),a("el-table-column",{attrs:{"header-align":"center",stripe:!0,prop:"checkData_2",label:"内部固定资产交易","min-width":"120px",align:"right","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(e.formatFun(t.row.checkData_2))+"\n            ")]}}])}),e._v(" "),a("el-table-column",{attrs:{"header-align":"center",stripe:!0,prop:"checkData_3",label:"内部无形资产交易","min-width":"120px",align:"right","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(e.formatFun(t.row.checkData_3))+"\n            ")]}}])}),e._v(" "),a("el-table-column",{attrs:{"header-align":"center",stripe:!0,prop:"count",label:"合计","min-width":"120px",align:"right","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(e.formatFun((t.row.checkData_1||0)+(t.row.checkData_2||0)+(t.row.checkData_3||0)))+"\n            ")]}}])})],1)],1)},staticRenderFns:[]};var E=a("VU/8")(P,M,!1,function(e){a("cC5m")},"data-v-54837d91",null).exports,R={name:"numberInput",inheritAttrs:!1,props:{value:{type:[String,Number],default:null,desc:"数值"},maxlength:{type:[String,Number],default:20,desc:"最大长度"},placeholder:{type:[String],default:"请输入内容",desc:"输入提示"},disabled:{type:[Boolean],default:!1,desc:"禁用"}},data:function(){return{formatValue:""}},computed:{inputListeners:function(){var e=this;return f()({},this.$listeners,{input:function(t){e.formatValue=t,e.$emit("input",parseFloat(e.fmoney(t).replace(/,/g,"")))},blur:function(t){e.formatValue=e.fmoney(e.value),e.$listeners.blur&&e.$listeners.blur(t)},focus:function(t){e.formatValue=e.value}})}},watch:{value:function(e){}},created:function(){this.formatValue=this.fmoney(this.value)},methods:{fmoney:function(e){if(0===e)return"0.00";if(""===e||null==e)return"";var t=2,a=parseFloat(e);t=t>0&&t<=20?t:2;for(var i=(e=a<0?(-1*parseFloat((e+"").replace(/[^\d\.-]/g,""))).toFixed(t)+"":parseFloat((e+"").replace(/[^\d\.-]/g,"")).toFixed(t)+"").split(".")[0].split("").reverse(),r=e.split(".")[1],s="",o=0;o<i.length;o++)s+=i[o]+((o+1)%3==0&&o+1!==i.length?",":"");return a<0?"-"+s.split("").reverse().join("")+"."+r:s.split("").reverse().join("")+"."+r}}},O={render:function(){var e=this,t=e.$createElement;return(e._self._c||t)("el-input",e._g(e._b({attrs:{value:e.formatValue,maxlength:e.maxlength,disabled:e.disabled,placeholder:e.placeholder}},"el-input",e.$attrs,!1),e.inputListeners))},staticRenderFns:[]};var B=a("VU/8")(R,O,!1,function(e){a("/829")},"data-v-74afe8b3",null).exports,V={name:"internalFixedOffsetTable",components:{numberInput:B,amountInput:{template:'<div class="subjectCell amountCell"\n                                @click="clickCell(true)"\n                                v-if="!showInput"\n                                >{{formatter.commafy(\'\',scope.row[scope.column.property]*1) }}</div\n                            >\n                            <el-input\n                                @blur.stop="clickCell(false)"\n                                v-else="showInput"\n                                ref="input"\n                                clearable\n                                v-model="scope.row[scope.column.property]"\n                            />',data:function(){return{formatter:_.b,showInput:!1,borrowing:!0}},props:["scope"],methods:{clickCell:function(e){var t=this;if(this.showInput=e,e)this.$nextTick(function(){t.$refs.input.focus()});else{var a=this.scope.row[this.scope.column.property];this.scope.row[this.scope.column.property]="string"==typeof a?a.replaceAll(",",""):a}}}},autocompleteInput:{template:'\n    <el-autocomplete\n                                v-model="scope.row[scope.column.property]"\n                                ref="autocomplete"\n                                :fetch-suggestions="querySearchAsync"\n                                placeholder="请输入内容"\n                                clearable\n                                @select="handleSelect"\n                                @focus="onFocus"\n                            ></el-autocomplete>',data:function(){return{showAutocomplete:!1,secondSubjectRestaurants:[]}},props:["scope","restaurants"],methods:{clickCell:function(e){var t=this;this.showAutocomplete=e,e&&this.$nextTick(function(){t.$refs.autocomplete.focus()})},onFocus:function(){this.scope&&this.scope.column&&"secondSubject"===this.scope.column.property&&this.querySecondarySubjectList(),this.scope&&this.scope.column&&"otherDescription"===this.scope.column.property&&this.queryOtherDescription()},querySecondarySubjectList:function(){var e=this,t=sessionStorage.getItem("curCustomerData"),a=JSON.parse(t),i=a.curCustomerId,r=a.curProjectId,s=this.scope.row,o={projectId:r,customerId:i,tbSubjectCode:s.subjectCode,tbSubjectName:s.subjectName};this.$sacpApis.querySecondarySubjectList(o).then(function(t){t.success?t.data&&t.data[0]&&t.data[0].list?t.data[0].list.forEach(function(t,a){e.secondSubjectRestaurants.push({label:t,value:t})}):e.secondSubjectRestaurants=[]:e.$message.error(t.resultInfo.statusText)}).catch(function(t){e.$message.error(t)})},queryOtherDescription:function(){this.scope.row},querySearchAsync:function(e,t){var a=this.scope&&this.scope.column&&"subjectName"===this.scope.column.property?this.restaurants:this.secondSubjectRestaurants,i=e?a.filter(this.createStateFilter(e)):a;clearTimeout(this.timeout),this.timeout=setTimeout(function(){t(i)},500*Math.random())},createStateFilter:function(e){return function(t){return 0===t.value.toLowerCase().indexOf(e.toLowerCase())}},handleSelect:function(e){"subjectName"===this.scope.column.property&&(this.scope.row.subjectCode=e.label)}}}},data:function(){return{activeName:"internalGoods",isBorder:!0,data:[],loading:!1,curProjectId:"",curCustomerId:"",tabList:[],columns:[{label:"科目",prop:"subjectName",align:"left"},{label:"二级科目",prop:"secondSubject",align:"center"},{label:"描述",prop:"otherDescription",align:"left"},{label:"合计",prop:"sum",align:"right"}],tbSubject:[],restaurants:[],state:"",timeout:null,data1:[],data2:[],tableColumns:[],tableData:[],checkResult:!1,borrowing:[],arrbox:"",leftTReeNode:[{children:[{label:"内部商品交易",type:"5",value:70,classify:"internalGoods"},{label:"内部租赁交易",type:"5",value:71,classify:!1},{label:"未实现对外销售的存货",type:"5",value:72,classify:!1},{label:"存货跌价准备抵销",type:"5",value:73,classify:"obsoleteStocks"},{label:"对递延所得税的影响",type:"5",value:74,classify:"deferredIncomeTax"},{label:"逆流交易抵销",type:"5",value:75,classify:"currentTrading"}],label:"内部商品和劳务、租赁等交易",type:"5",value:67,classify:!1},{children:[{label:"集团内部产品销售",type:"6",value:76,classify:"fixedAsset"},{label:"集团内部固定资产变卖交易",type:"6",value:77,classify:!1},{label:"固定资产折旧",type:"6",value:78,classify:!1},{label:"对递延所得税的影响",type:"6",value:79,classify:"deferredIncomeTax"},{label:"逆流交易抵销",type:"6",value:80,classify:"currentTrading"}],label:"内部固定资产交易",type:"6",value:68,classify:!1},{children:[{label:"",type:"7",value:81,classify:"intangibleAssets"},{label:"无形资产摊销",type:"7",value:82,classify:!1},{label:"对递延所得税的影响",type:"7",value:83,classify:"deferredIncomeTax"},{label:"逆流交易抵销",type:"7",value:84,classify:"currentTrading"}],label:"内部无形资产交易",type:"7",value:69,classify:!1}]}},watch:{tableData:{handler:function(e,t){this.sums()},immediate:!0,deep:!0}},methods:{handleClick:function(e,t){this.dataMarry(),this.arrbox?this.arrbox=new T.a([].concat(r()(e),r()(this.arrbox))):this.arrbox=[].concat(r()(e))},cellData:function(e){var t=e.row,a=e.column,i=t[a.property];return"sum"===a.property?_.b.commafy("",1*i):i},requestAll:function(){var e=this,t=sessionStorage.getItem("curCustomerData"),a=JSON.parse(t),i=a.curCustomerId,r=a.curProjectId,s=a.curYear;this.curYear=s,this.projectId=r,this.customerId=i,this.loading=!0;var o=this.$sacpApis.enterpriseList({customerId:i,projectId:r}).then(function(t){if(t.success){if(t.data)return t.data;e.dataLength=0}else e.$message.error(t.resultInfo.statusText)}).catch(function(t){e.$message.error(t)}).finally(function(){}),n=this.$sacpApis.queryInternalCommodityOffset().then(function(t){if(t.success){if(t.data)return e.$parent.treeNode=t.data,t.data[0].internalGoods.forEach(function(t){e.borrowing.push(t.direction)}),t.data}else e.$message.error(t.resultInfo.statusText)}).catch(function(t){e.$message.error(t)}).finally(function(){e.loading=!1}),c=this.$sacpApis.offsetEntrySubjectNameList().then(function(t){if(t.success){var a=t.data[0].tb;e.tbSubject=a,e.restaurants=a.map(function(e){return{value:e.label,label:e.value,direction:e.direction}})}else e.$message.error(t.resultInfo.statusText)}).catch(function(t){e.$message.error(t)}).finally(function(){});u.a.all([o,n,c]).then(function(t){e.data1=t[0],e.data2=t[1][0];var a=[{label:"抵销内部商品交易",name:"internalGoods"},{label:"存货跌价准备抵销",name:"obsoleteStocks"},{label:"对递延所得税的影响",name:"deferredIncomeTax"},{label:"内部无形资产交易",name:"intangibleAssets"},{label:"内部固定资产交易",name:"fixedAsset"},{label:"逆流交易抵销",name:"currentTrading"}],i=[];l()(e.data2).forEach(function(e){a.forEach(function(t){e===t.name&&i.push(t)})}),e.tabList=i,e.activeName=e.tabList[0].name,e.dataMarry()})},querySearchAsync:function(e,t){var a=this.restaurants,i=e?a.filter(this.createStateFilter(e)):a;clearTimeout(this.timeout),this.timeout=setTimeout(function(){t(i)},500*Math.random())},createStateFilter:function(e){return function(t){return 0===t.value.toLowerCase().indexOf(e.toLowerCase())}},handleSelect:function(e){},dataMarry:function(){var e=this,t=JSON.parse(g()(this.columns));(this.data2[this.activeName]?this.data2[this.activeName]:[]).forEach(function(a,i){l()(a).forEach(function(a,i){e.data1.forEach(function(e,i){a==e.mergeProjectId&&t.push({label:e.shortName,prop:a,align:"right"})})})}),t=j()(new T.a(t.map(function(e){return g()(e)}))).map(function(e){return JSON.parse(e)}),this.tableColumns=t;var a=.75*window.innerWidth;t.forEach(function(e){t.length<7?e.minWidth=parseInt(a/t.length):e.minWidth=120});var i=this.data2[this.activeName]?this.data2[this.activeName]:[];i.forEach(function(t){e.restaurants.forEach(function(e){t.subjectName===e.value&&(t.subjectCode=e.label)})}),this.tableData=i},sums:function(){var e=this;if(this.tableColumns.length>3){var t=this.tableColumns.map(function(e,t){if(t>3)return e.prop});this.tableData.forEach(function(a){var i=0;t.forEach(function(e){i=x.a.add(a[e],i)}),e.$set(a,"sum",i)})}},tableRowClassName:function(e){var t=e.row,a=e.rowIndex;return 1===t.direction&&a+1?"borrow-row":-1===t.direction&&a+1?"loan-row":"other-row"},getSummaries:function(e){var t=e.columns,a=e.data,i=[];t.forEach(function(e,t){if(0!==t)if(1!==t)if(2!==t){var r=a.map(function(t){return Number(t[e.property]*t.direction)});r.every(function(e){return isNaN(e)})?i[t]="":(i[t]=r.reduce(function(e,t){var a=Number(t);return isNaN(a)?e:e+t},0),i[t]+="")}else i[t]="";else i[t]="";else i[t]="核对"});var r=[];return i.forEach(function(e){var t=e&&!isNaN(1*e)?_.b.commafy("",1*e):e;r.push(t)}),this.footerStyle(r),r},footerStyle:function(e){this.checkResult="0.00"===e[3];for(var t=document.querySelectorAll(".el-table__footer-wrapper"),a=0;a<t.length+1;a++)if(t[a]){var i=t[a].querySelector("tr"),r=t[a].querySelectorAll("td");i&&r&&(this.checkResult?i.style.backgroundColor="#93ff93":i.style.backgroundColor="#ffc5ed",r.forEach(function(e){e.style.backgroundColor="unset"}))}},offsetEntryAddSave:function(e){var t=this;if(!this.checkResult)return this.$message.error("核对不为0!"),{then:function(){}};this.loading=!0;var a={};this.tableColumns.forEach(function(e,t){t>2&&(a[e.prop]=e.label)});var i="";if(e.children){for(var s=this.leftTReeNode.filter(function(t){return t.value===e.value})[0].children,o=0;o<s.length;o++)if(s[o].classify===this.activeName){i=s[o].value;break}}else i=e.value;this.arrbox=new T.a([].concat(r()(this.tableData),r()(this.arrbox))),this.tableData=[].concat(r()(this.arrbox)),this.tableData.forEach(function(e){for(var t in console.log(e,"XXXX"),e)for(var r in"number"==typeof e[t]&&(e[t]=""+e[t]),a)if(t===r){e[a[r]]=e[t];break}e.templateId=i,e.tbSubjectCode=e.subjectCode,e.tbSubjectName=e.subjectName,e["合计"]=""+e.sum});var n={yyyy:this.curYear,projectId:this.projectId,project:a,adjustType:e.type,arr:this.tableData};return this.$sacpApis.offsetEntryAddSave(n).then(function(e){return e.success?(t.loading=!1,t.$message.success("保存成功")):t.$message.error(e.resultInfo.statusText),e}).catch(function(e){return t.$message.error(e)}).finally(function(){t.loading=!1})}},mounted:function(){this.requestAll()}},q={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.loading,expression:"loading",modifiers:{fullscreen:!0,lock:!0}}]},[a("el-tabs",{attrs:{type:"card"},on:{"tab-click":function(t){return e.handleClick(e.tableData)}},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(e.tabList,function(t,i){return a("el-tab-pane",{key:i,attrs:{label:t.label,name:t.name}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,"show-summary":"","summary-method":e.getSummaries,border:"",height:"calc(100vh - 250px)","row-class-name":e.tableRowClassName}},e._l(e.tableColumns,function(t,i){return a("el-table-column",{key:i,attrs:{prop:t.prop,label:t.label,width:t.width,"min-width":t.minWdith,align:t.align,"header-align":t.align},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row,r=t.column;return["subjectName"===r.property?a("span",[e._v(e._s(1==i.direction?"借:":"贷:"))]):e._e(),e._v(" "),isNaN(1*r.property)?"subjectName"===r.property?a("autocomplete-input",{attrs:{scope:{row:i,column:r},restaurants:e.restaurants}}):"secondSubject"===r.property?a("autocomplete-input",{attrs:{scope:{row:i,column:r},restaurants:e.restaurants}}):"otherDescription"===r.property?a("autocomplete-input",{attrs:{scope:{row:i,column:r},restaurants:e.restaurants}}):a("span",[e._v(e._s(e.cellData({row:i,column:r})))]):a("amount-input",{attrs:{scope:{row:i,column:r}}})]}}],null,!0)})}),1)],1)}),1)],1)},staticRenderFns:[]};var z=a("VU/8")(V,q,!1,function(e){a("Xt8x")},"data-v-3353d700",null).exports,U=a("rX5e"),H={props:{roleList:Array},components:{transactionSummaryChildren:U.a},watch:{roleList:{handler:function(e){e&&e[0]&&(this.subjectNameList=(e[0].tb||[]).map(function(e){return{label:e.label,value:e.value,showLabel:e.value+"-"+e.label}}))},immediate:!0,deep:!0}},data:function(){return{colIndex:0,rowIndex:1,activeRowBackOld:{},costOffsetDialog:!1,dialogTitle:"",columnName:{},generationOffsetColumns:[],generationOffsetData:[],curCustomerId:null,curProjectId:null,changeTableFlag:!1,innerVisible:!1,yearList:[],radio:0,editTableColumns:[],editTableData:[],editTable:!1,checkedSelectedValue:[],templateId:null,mergeProjectId:"",digestArr:[],labelArr:[],subjectNameList:[],fullscreenLoading:!1,curObj:{},preObj:{},footerData:[],SummaryTableData:[],hasCheckBox:!0,contactProject:{},customerId:"",projectId:"",restaurants:[],footerObj:[],count:0,columnsInfo:[],footerTotal:0,tbSubject:[],treeNode:{},isShow:!1,queryParamRow:{},columnsData:"",arr:[]}},methods:{handleCheckedSelect:function(e){this.checkedSelectedValue=e},ofsetDialogConfirm:function(){var e=this;if(!this.editTable){if(!this.checkedSelectedValue||this.checkedSelectedValue&&!this.checkedSelectedValue.length)return this.$message.error("请选择子公司!");this.mergeProjectId=[],this.checkedSelectedValue.map(function(t){return e.mergeProjectId+=e.mergeProjectId.length?","+t.mergeProjectId:""+t.mergeProjectId});var t={param1:this.mergeProjectId},a={};this.checkedSelectedValue.map(function(e){a[e.shortName]=e.mergeProjectId}),this.sendMethods(t),this.sendChooseObj(a),this.costOffsetDialog=!1,this.checkedSelectedValue="",this.loading=!0,setTimeout(function(){e.loading=!1},400)}},sendChooseObj:function(e){this.$emit("chooseObj",e)},sendMethods:function(e){this.$emit("send",e)},costOfMethods:function(e,t,a,i){this.costOffsetDialog=!0,this.dialogTitle="成本法抵销",this.curProjectId=t,this.curCustomerId=e,this.yearList=a,this.radio=this.yearList&&this.yearList.length?this.yearList[0].label:this.radio,this.templateId=i.value,this.treeNode=i,this.changeTableFlag=!1,this.costOfMethodsInit()},mergeScopeInit:function(){var e=this;if(this.fullscreenLoading=!0,!this.curCustomerId||!this.curProjectId)return console.log("缺少客户id或项目id!");this.$sacpApis.findSubsidiary().then(function(t){t.success?t.data&&(e.hasCheckBox=!0,e.generationOffsetColumns=[{label:"公司简称",prop:"label",fixed:"left"},{label:"合并比例(本期)",prop:"curMergeProportion",fixed:"left"},{label:"合并比例(上期)",prop:"preMergeProportion",fixed:"left"},{label:"提取比例",prop:"extractionRatio",fixed:"left"}],e.generationOffsetData=t.data):e.$message.error(t.resultInfo.statusText)}).catch(function(t){e.$message.error(t)}).finally(function(){e.fullscreenLoading=!1,e.$store.commit("setMergeScopeRefresh",!1)})},costOfMethodsInit:function(){var e=this;if(this.fullscreenLoading=!0,!this.curCustomerId||!this.curProjectId)return console.log("缺少客户id或项目id!");this.$sacpApis.findSubsidiary().then(function(t){t.success?t.data&&(e.hasCheckBox=!0,e.generationOffsetColumns=[{label:"公司简称",prop:"shortName",fixed:"left"},{label:"合并比例(本期)",prop:"curMergeProportion",fixed:"left"},{label:"合并比例(上期)",prop:"preMergeProportion",fixed:"left"},{label:"提取比例",prop:"extractionRatio",fixed:"left"}],t.data.forEach(function(e){e.extractionRatio&&(e.extractionRatio=Math.round(1e4*e.extractionRatio)/100+"%"),e.curMergeProportion&&(e.curMergeProportion=Math.round(100*e.curMergeProportion)/100+"%"),e.preMergeProportion&&(e.preMergeProportion=Math.round(100*e.preMergeProportion)/100+"%")}),e.generationOffsetData=t.data):e.$message.error(t.resultInfo.statusText)}).catch(function(t){e.$message.error(t)}).finally(function(){e.fullscreenLoading=!1})},outDialogCancel:function(){this.checkedSelectedValue=[],this.innerVisible=!1,this.editTableData=[],this.editTableColumns=[],this.costOffsetDialog=!1,this.editTable=!1,this.changeTableFlag=!1,this.footerTotal=0,this.isShow=!1},currentComany:function(e){var t=this.columnName;for(var a in t)a&&a==e&&this.$refs.transactionSummaryChildren.querySingleContactSummary(t[a],a)}},mounted:function(){this.footerTotal=0}},Y={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"CostOffset"},[a("el-dialog",{attrs:{title:e.dialogTitle,visible:e.costOffsetDialog,"destroy-on-close":"","before-close":e.outDialogCancel,width:"85%"},on:{"update:visible":function(t){e.costOffsetDialog=t}}},[e.editTable?e._e():a("bdo-table",{ref:"offsetTable",attrs:{border:"",data:e.generationOffsetData,"page-total":e.generationOffsetData.length||0,columns:e.generationOffsetColumns,"enable-filter":!1,"enable-toolbox":!1,"enable-view-type":!1,"responsive-height-gap":250,showIndexColumn:!1,showCheckBox:e.hasCheckBox,enableRefresh:!1,enableHeadConfig:!1,setBorder:!0,"default-expand-all":!1,exportReport:!1},on:{handleSelect:e.handleCheckedSelect,currentComany:e.currentComany}}),e._v(" "),e.changeTableFlag?e._e():a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.outDialogCancel}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.ofsetDialogConfirm}},[e._v("确 定")])],1)],1),e._v(" "),a("transaction-summary-children",{ref:"transactionSummaryChildren"})],1)},staticRenderFns:[]},W=a("VU/8")(H,Y,!1,null,null,null).exports,G=a("HNYb"),J={name:"CostOffsetting",components:{numberInput:B,amountInput:{template:'<div class="subjectCell amountCell"\n                                @click="clickCell(true)"\n                                v-if="!showInput"\n                                >{{formatter.commafy(\'\',scope.row[scope.column.property]*1) }}</div\n                            >\n                            <el-input\n                                @blur.stop="clickCell(false)"\n                                v-else="showInput"\n                                ref="input"\n                                :maxlength="num"\n                                clearable\n                                v-model="scope.row[scope.column.property]"\n                            />',data:function(){return{formatter:_.b,showInput:!1,borrowing:!0,num:"16"}},props:["scope"],methods:{clickCell:function(e){var t=this;if(this.showInput=e,e)this.$nextTick(function(){t.$refs.input.focus()});else{var a=this.scope.row[this.scope.column.property];this.scope.row[this.scope.column.property]="string"==typeof a?a.replaceAll(",",""):a}}}},autocompleteInput:{template:'\n    <div class="subjectCell amountCell"\n                                @click="clickCell(true)"\n                                v-if="!showAutocomplete"\n                                >{{ scope.row[scope.column.property] }}</div\n                            >\n    <el-autocomplete\n                                v-else="showAutocomplete"\n                                v-model="scope.row[scope.column.property]"\n                                ref="autocomplete"\n                                :fetch-suggestions="querySearchAsync"\n                                placeholder="请输入内容"\n                                clearable\n                                :maxlength="num"\n                                size="large"\n                                @select="handleSelect"\n                                @blur="onBlur"\n                                @focus="onFocus"\n                            ></el-autocomplete>',data:function(){return{showAutocomplete:!1,secondSubjectRestaurants:[],num:16}},props:["scope","restaurants","adjustTableData"],methods:{clickCell:function(e){var t=this;this.showAutocomplete=e,e&&this.$nextTick(function(){t.$refs.autocomplete.focus()})},onBlur:function(){this.showAutocomplete=!this.showAutocomplete},onFocus:function(){this.scope&&this.scope.column&&"secondSubject"===this.scope.column.property&&this.querySecondarySubjectList(),this.scope&&this.scope.column&&"otherDescription"===this.scope.column.property&&this.queryOtherDescription()},querySecondarySubjectList:function(){var e,t=this,a=sessionStorage.getItem("curCustomerData"),i=JSON.parse(a),r=i.curCustomerId,s=i.curProjectId,o=this.scope.row,n={projectId:s,customerId:r,tbSubjectCode:(e=this.adjustTableData.filter(function(e){return e.tbSubjectName==o.label}))[0].tbSubjectId,tbSubjectName:e[0].tbSubjectName};this.$sacpApis.querySecondarySubjectList(n).then(function(e){e.success?e.data&&e.data[0]&&e.data[0].list?e.data[0].list.forEach(function(e,a){t.secondSubjectRestaurants.push({label:e,value:e})}):t.secondSubjectRestaurants=[]:t.$message.error(e.resultInfo.statusText)}).catch(function(e){t.$message.error(e)})},queryOtherDescription:function(){this.scope.row},querySearchAsync:function(e,t){var a=this.scope&&this.scope.column&&"label"===this.scope.column.property?this.restaurants:this.secondSubjectRestaurants;if(a instanceof Array)var i=a.filter(this.createStateFilter(e))||[].concat(r()(a));clearTimeout(this.timeout),this.timeout=setTimeout(function(){t(i)},500*Math.random())},createStateFilter:function(e){return function(t){return 0===t.value.toLowerCase().indexOf(e.toLowerCase())}},handleSelect:function(e){"label"===this.scope.column.property&&(this.scope.row.subjectCode=e.label)}}}},props:{childRow:{type:Object,default:{}},childObj:{type:Object,default:{}}},data:function(){return{activeName:"thisYear",isBorder:!0,data:[],loading:!1,curProjectId:"",curCustomerId:"",tabList:[{label:"本年",name:"thisYear"},{label:"上年",name:"oldYear"}],columns:[{label:"科目",prop:"label",align:"left",flag:"A"},{label:"二级科目",prop:"secondSubject",align:"left",flag:"B"},{label:"描述",prop:"otherDescription",align:"left",flag:"C"},{label:"合计",prop:"sum",align:"right",flag:"D"}],tbSubject:[],restaurants:[],state:"",timeout:null,data3:[],data1:[],data2:[],tableColumns:[],tableData:[],checkResult:!1,borrowing:[],arrbox:"",lsObj:{},lsColumns:[],subjectNameList:[],curYear:"",adjustTableData:[]}},computed:{},watch:{tableData:{handler:function(e,t){this.sums()},immediate:!0,deep:!0},roleList:{handler:function(e){e&&e[0]&&(this.subjectNameList=(e[0].tb||[]).map(function(e){return{label:e.label,value:e.value,showLabel:e.value+"-"+e.label}}))},immediate:!0,deep:!0}},methods:{costOfsetMethods:function(){var e=this.childRow;this.abb(e),this.dataMarry()},abb:function(e){var t=this,a=e.param1;this.loading=!0,this.$sacpApis.costOfMethodsOffset({param1:a}).then(function(e){e.success?(e.data&&(t.data3=e.data[0].pre,t.data1=e.data[0].cur,t.data2=e.data[0].columnName),t.dataMarry(),t.$nextTick(function(){t.$refs.ellTable[0].doLayout()})):t.$message.error(e.resultInfo.statusText)}).catch(function(e){t.$message.error(e)}).finally(function(){t.loading=!1})},queryOtherDescription:function(){this.scope.row},dataMarry:function(){var e=JSON.parse(g()(this.columns)),t=[],a=this.data2?this.data2:{};for(var i in a)t.push({label:i,prop:a[i],align:"right"}),e.push({label:i,prop:a[i],align:"right"});t=j()(new T.a(t.map(function(e){return g()(e)}))).map(function(e){return JSON.parse(e)}),e=j()(new T.a(e.map(function(e){return g()(e)}))).map(function(e){return JSON.parse(e)});var r=.75*window.innerWidth;t.forEach(function(e){t.length<7?e.minWidth=parseInt(r/t.length):e.minWidth=120}),this.lsColumns=e,this.tableColumns=t,"thisYear"==this.activeName&&(this.tableData=[],this.tableData=G.a.markDataList(this.data1||[])),"oldYear"==this.activeName&&(this.tableData=[],this.tableData=G.a.markDataList(this.data3||[]))},tableRowClassName:function(e){var t=e.row,a=e.rowIndex;return 1===t.direction&&a+1?"borrow-row":-1===t.direction&&a+1?"loan-row":"other-row"},sums:function(){var e=this;if(this.lsColumns.length>3){var t=this.lsColumns.map(function(e,t){if(t>3)return e.prop});this.tableData.forEach(function(a){var i=0;t.forEach(function(e){i=x.a.add(a[e],i)}),e.$set(a,"sum",i)})}},getSummaries:function(e){var t=e.columns,a=e.data,i=[];t.forEach(function(e,t){if(0!==t)if(1!==t)if(2!==t){var r=a.map(function(t){return Number(t[e.property]*t.direction)});r.every(function(e){return isNaN(e)})?i[t]="":(i[t]=r.reduce(function(e,t){var a=Number(t);return isNaN(a)?e:e+t},0),i[t]+="")}else i[t]="";else i[t]="";else i[t]="核对"});var r=[];return i.forEach(function(e){var t=e&&!isNaN(1*e)?_.b.commafy("",1*e):e;r.push(t)}),this.footerStyle(r),r},footerStyle:function(e){this.checkResult="0.00"===e[3];for(var t=document.querySelectorAll(".el-table__footer-wrapper"),a=0;a<t.length+1;a++)if(t[a]){var i=t[a].querySelector("tr"),r=t[a].querySelectorAll("td");i&&r&&(this.checkResult?i.style.backgroundColor="#93ff93":i.style.backgroundColor="#ffc5ed",r.forEach(function(e){e.style.backgroundColor="unset"}))}for(var s=document.querySelectorAll(".el-table__fixed-footer-wrapper"),o=0;o<s.length+1;o++)if(s[o]){var n=s[o].querySelector("tr"),l=s[o].querySelectorAll("td");n&&l&&(this.checkResult?n.style.backgroundColor="#93ff93":n.style.backgroundColor="#ffc5ed",l.forEach(function(e){e.style.backgroundColor="unset"}))}},handleClick:function(e,t){this.dataMarry()},cellData:function(e){var t=e.row,a=e.column,i=t[a.property];return"sum"===a.property?_.b.commafy("",1*i):i},saveAutoOffsetData:function(){var e=this;this.labelArr=this.childRow.param1.split(","),G.a.unmarkDataList(this.tableData).map(function(t){x.a.keys(t);var a=t.label;e.labelArr.map(function(e){x.a.has(t,e)&&x.a.get(t,e)}),x.a.set(t,"tbSubjectName",a);var i=e.tbSubject.filter(function(e){return a===e.label}),r=void 0,s=void 0;i&&i.length?r=(s=i[0].value)+"-"+i[0].label:(r=null,s=null),x.a.set(t,"tbSubjectCodeName",r),t["合计"]=""+t.sum,t.tbSubjectCode||x.a.set(t,"tbSubjectCode",s)})},offsetEntrySubjectNameList:function(e){var t=this;return new u.a(function(a,i){t.$sacpApis.offsetEntrySubjectNameList().then(function(i){if(i.success){var r=i.data[0].tb;t.tbSubject=r,e.forEach(function(e){r.forEach(function(t){t.label===e.subjectName&&(e.direction=t.direction)})}),a(e)}else t.$message.error(i.resultInfo.statusText)})})},offsetEntryAddSave:function(e){var t=this;if(!this.checkResult)return this.$message.error("核对不为0!"),{then:function(){}};this.loading=!0;var a={};this.tableColumns.forEach(function(e,t){t>2&&(a[e.prop]=e.label)});var i="";if(e.children){for(var r=this.leftTReeNode.filter(function(t){return t.value===e.value})[0].children,s=0;s<r.length;s++)if(r[s].classify===this.activeName){i=r[s].value;break}}else i=e.value;this.tableData.forEach(function(e){for(var t in e)for(var r in"number"==typeof e[t]&&(e[t]=""+e[t]),a)if(t===r){e[a[r]]=e[t];break}e.templateId=i,e.tbSubjectCode=e.subjectCode,e.tbSubjectName=e.subjectName,e["合计"]=""+e.sum}),this.saveAutoOffsetData();var o=JSON.parse(sessionStorage.getItem("curCustomerData"));this.curYear=o.curYear,"thisYear"==this.activeName&&(this.curYear=this.curYear),"oldYear"==this.activeName&&(this.curYear=this.curYear-1),console.log(this.tableData,"222");var n={yyyy:this.curYear,projectId:o.curProjectId,project:this.childObj,adjustType:e.type,arr:this.tableData};return this.$sacpApis.offsetEntryAddSave(n).then(function(e){return e.success?(t.loading=!1,t.$message.success("保存成功")):t.$message.error(e.resultInfo.statusText),e}).catch(function(e){return t.$message.error(e)}).finally(function(){t.loading=!1})},getSubjectNameList:function(){var e=this;this.$sacpApis.offsetEntrySubjectNameList().then(function(t){t.success?e.tbSubject=t.data[0].tb:e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)})},adjustDebTableInit:function(){var e=this;this.$sacpApis.queryProjectTb().then(function(t){t.success&&(e.adjustTableData=t.data)}).catch(function(t){return e.$message.error(t)})}},mounted:function(){this.adjustDebTableInit(),this.getSubjectNameList()}},X={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.loading,expression:"loading",modifiers:{fullscreen:!0,lock:!0}}]},[a("el-tabs",{attrs:{type:"card"},on:{"tab-click":function(t){return e.handleClick(e.tableData)}},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(e.tabList,function(t,i){return a("el-tab-pane",{key:i,attrs:{label:t.label,name:t.name,height:"calc(100vh - 250px)"}},[a("el-table",{ref:"ellTable",refInFor:!0,staticStyle:{width:"100%"},attrs:{data:e.tableData,"show-summary":"","row-class-name":e.tableRowClassName,"summary-method":e.getSummaries,"row-style":{height:"42px"},"cell-style":{padding:0},border:"",height:"calc(100vh - 250px)","max-height":"500px"}},[e._l(e.columns,function(t){return a("el-table-column",{key:t.flag,attrs:{prop:t.prop,label:t.label,width:"200",align:t.align,"header-align":t.align,fixed:""},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row,r=t.column;return["label"===r.property?a("span",[e._v(e._s(1==i.direction?"借:":"贷:"))]):e._e(),e._v(" "),isNaN(1*r.property)?"secondSubject"===r.property?a("autocomplete-input",{attrs:{scope:{row:i,column:r},restaurants:e.restaurants,adjustTableData:e.adjustTableData}}):"otherDescription"===r.property?a("autocomplete-input",{attrs:{scope:{row:i,column:r},restaurants:e.restaurants,adjustTableData:e.adjustTableData}}):a("span",[e._v(e._s(e.cellData({row:i,column:r})))]):a("amount-input",{attrs:{scope:{row:i,column:r}}})]}}],null,!0)})}),e._v(" "),e._l(e.tableColumns,function(t,i){return a("el-table-column",{key:i,attrs:{prop:t.prop,label:t.label,width:t.width,align:t.align,"min-width":200,"header-align":t.align},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row,r=t.column;return[isNaN(1*r.property)?e._e():a("amount-input",{attrs:{scope:{row:i,column:r}}})]}}],null,!0)})})],2)],1)}),1)],1)},staticRenderFns:[]};var Q=a("VU/8")(J,X,!1,function(e){a("XKgs")},"data-v-d951b72e",null).exports,Z={prop:"offsetEntry",components:{checkListTable:E,AutoGenerationOffset:D.a,transactionSummary:N,internalFixedOffsetTable:z,CostOffset:W,CostOffsetting:Q},computed:{refreshImportRelate:function(){return this.$store.state.refreshPagesMenuId}},watch:{refreshImportRelate:{handler:function(e){e===this.flag&&this.offsetEntryInit()}}},props:{customerId:String,projectId:String,subjectId:String,subjectName:String,offsetType:String,customerData:Array},mixins:[w.a],data:function(){var e=this;return{result:null,loading:!1,checkListTableShow:!1,secondSubject:[],isCollapse:!1,isScreen:!1,flag:"HB004-OE001",activeFlagValue:[],activeFlag:"",menuList:[],entryCategory:[],defaultProps:{children:"children",label:"label"},curMenuItem:{},isShowTable:!1,childRow:"",childObj:{},subtract:0,allAlign:"right",tbOffsetColumn:[{label:"操作",prop:"autoId",width:"50px",fixed:"left"},{label:"科目名称",prop:"tbSubjectName",fixed:"left"},{label:"二级科目",prop:"secondSubject",fixed:"left"},{label:"描述",prop:"otherDescription",fixed:"left"},{label:"借方金额",prop:"deb",align:"right",formatter:{type:"function",value:this.fixedNumber}},{label:"贷方金额",prop:"cre",align:"right",formatter:{type:"function",value:this.fixedNumber}},{label:"索引号",prop:"indexId",data:"indexId"},{label:"摘要",prop:"digest"},{label:"科目编号",prop:"tbSubjectCode"},{label:"项目",prop:"projectName"},{label:"状态",prop:"activeFlag",formatter:{type:"function",value:this.activeFlagFormatter}},{label:"未调整原因",prop:"reason"},{label:"调整年份",prop:"yyyy"}],tbOffsetColumn1:[{label:"操作",prop:"autoId",width:"150px",children:[{label:"操作",prop:"aaa",width:"150px"},{label:"操作",prop:"ddd",width:"150px"},{label:"操作",prop:"auwwwwtoId",width:"150px"}]},{label:"贷方金额",prop:"cre"},{label:"项目",prop:"projectName"},{label:"状态",prop:"activeFlag"},{label:"未调整原因",prop:"reason"},{label:"调整年份",prop:"yyyy"}],curTbOffsetData:[],spanArr:[],position:0,offsetTypes:[{label:"试算平衡表抵销",type:"2"},{label:"现金流量表抵销",type:"3"}],dataLenght:0,addDialogFormVisible:!1,addFormData:{style:"",object:""},addEditFormRule:{},formLabelWidth:"120px",addItemTableData:[],projectList:[],debDisabled:!1,creDisabled:!1,yearList:[],selectedProjectId:"",yyyy:"",editDialogFormVisible:!1,isEdit:!1,editOrAddTitle:"新建分录",selectedSubjectName:"",editItemTableData:[],selectOffsetObject:[],selectOffsetType:"",curRowIndex:-1,curRow:{},roleList:[],modelsDialogVisible:!1,changeModel:[],lastModelList:[],templateData:[],defaultPropsT:{children:"children",label:"label"},subjectNameList:[],tbSubjectNameValue:null,isNewAdjustForm:!1,curCustomerId:"",curAccYear:"",curProjectId:"",departmentIdr:"",queryConfig:function(t,a,i){return e.offsetEntryInit()},queryOffsetSummaryConfig:function(t,a,i){e.queryMergeCashFlowSummary()},activeRowBackOld:{},editTitle:"",selectYear:"",autoGenerationOffset:!1,autoGenerationOffsetDialog:!1,transactionOffentSet:!1,checkVisible:!1,checkItemTableData:[],checkItemColumn:[],checkStatus:!0,clear:!1,copyList:[],showBtnType:"",showInside:!1,InternalFixedOffsetIsShow:!1,costOffsettingIsShow:!1,treeNode:{},dialogVisible:!1,mergeCashFlowSummaryColumn:[],mergeCashFlowSummaryData:[],transactionDialogVisible:!1,fullScreen:!1,tabActive:"5",tab:[{label:"接受劳务",name:"5"},{label:"固定资产",name:"6"},{label:"无形资产",name:"7"}],queryOffsetParam:{},treeNodeValue:"",changedIdSet:[],childData:""}},methods:{fullScreenChange:function(){this.fullScreen=!this.fullScreen},saveSingleToHbInsiderTradingData:function(){var e=this;this.$sacpApis.saveSingleToHbInsiderTradingData().then(function(t){t.success?e.$message.success("初始化成功"):e.$message.error(t.resultInfo.statusText)})},loadingFalse:function(){this.loading=!1,this.InternalFixedOffsetIsShow=!1,this.offsetEntryInit()},costOffsetFalse:function(){this.loading=!1,this.costOffsettingIsShow=!1},cellClass:function(e){var t=e.row;e.rowIndex;""===this.rowIndexId?(this.rowIndexId=t.indexId,this.classCount=0):this.rowIndexId!==t.indexId&&(this.rowIndexId=t.indexId,this.classCount=!this.classCount)},closeInternalFixedOffsetShow:function(){this.InternalFixedOffsetIsShow=!1},closeCostOffsetting:function(){this.costOffsettingIsShow=!1},internalFixedOffsetTableSave:function(){var e=this;this.$refs.internalFixedOffsetTable.offsetEntryAddSave(this.treeNode).then(function(t){t.success&&(e.InternalFixedOffsetIsShow=!1)})},InternalFixedOffsetShow:function(){this.InternalFixedOffsetIsShow=!0},costOffsettingShow:function(){var e=this;this.$refs.costOffsettingModal.offsetEntryAddSave(this.treeNode).then(function(t){t.success&&(e.costOffsettingIsShow=!1)})},closeCheckListShow:function(){this.checkListTableShow=!1},showCheckList:function(){var e=this;this.checkListTableShow=!0,setTimeout(function(){e.$refs.checkListTable.getTableData()})},closeShowInside:function(){this.showInside=!1},showInsideTable:function(){var e=this;this.showInside=!0,setTimeout(function(){"5"===e.showBtnType&&e.$refs.tableType1.getTableData(),"6"===e.showBtnType&&e.$refs.tableType2.getTableData(),"7"===e.showBtnType&&e.$refs.tableType3.getTableData()})},queryMerchantInsideClassify:function(){var e=this;this.transactionDialogVisible=!0,this.$sacpApis.queryMerchantInsideClassify().then(function(t){t.success?(e.tableColumns=t.data,e.$nextTick(function(){e.$refs.transactionSummary.tabItemList(t.data)})):e.$message.error(t.resultInfo.statusText)}).catch(function(t){e.$message.error(t)}).finally(function(){e.fullscreenLoading=!1})},createFilter:function(e){return function(t){return 0===t.value.toLowerCase().indexOf(e.toLowerCase())}},querySearch:function(e,t,a){var i=a.secondSubjectList;t(e?i.filter(this.createFilter(e)):i)},queryDescription:function(e,t,a){},handleSelect:function(e){},rowStyle:function(e){e.row,e.rowIndex;return"font-size:14px !important;font-weight: bold;"},hasValue:function(e){var t=e.row,a=e.column;e.rowIndex;if(0==e.columnIndex)return"text-align:center;font-size:14px !important;font-weight:bold;color:#909399;";if(t[a.label]&&t[a.label].split(",").every(function(e){return!v()(1*e)}))return"color:red;"},handleCollapse:function(){this.isCollapse=!this.isCollapse},saveGenerationOffsetData:function(){this.$refs.autoGenerationOffsetTable.save()},changeOffsetTable:function(){this.$refs.autoGenerationOffsetTable.changeTable(this.curProjectId,this.yearList,this.curMenuItem)},initOffSetByHand:function(){this.$refs.autoGenerationOffsetTable.initOffSetByHand(this.curCustomerId,this.curProjectId,this.yearList,this.curMenuItem)},selectedActiveFlage:function(){this.offsetEntryInit()},updateFooterEvent:function(e){this.$refs.editItemTable;this.$refs.addItemTable.updateFooter()},isRefreshDataLength:function(e){this.dataLenght=e},refreshAutoOffsetTable:function(e){e&&this.offsetEntryInit()},rowClassName:function(e){e.row,e.rowIndex},rowspan:function(e,t){var a=this;this.spanArr[e]=[],this.position=0,this.curTbOffsetData.forEach(function(i,r){0===r?(a.spanArr[e].push(1),a.position=0):a.curTbOffsetData[r][t]===a.curTbOffsetData[r-1][t]?(a.spanArr[e][a.position]+=1,a.spanArr[e].push(0)):(a.curTbOffsetData.splice(),a.spanArr[e].push(1),a.position=r)}),this.spanArr[0]=this.spanArr[1];var i=0;for(var r in this.spanArr[0])this.spanArr[0][r]>0&&(i+=1,this.curTbOffsetData[r]&&this.$set(this.curTbOffsetData[r],"mergeCellOrder",i))},objectSpanMethod:function(e){e.row,e.column;for(var t=e.rowIndex,a=e.columnIndex,i=0;i<2;i++)if(a===i){var r=this.spanArr[i][t];return{rowspan:r,colspan:r>0?1:0}}},addOffsetEntry:function(e){switch(this.addDialogFormVisible=!0,this.isEdit=!1,this.selectOffsetObject=[],this.selectOffsetType="",this.lastModelList=[],this.addItemTableData=[{digest:"",tbSubjectName:"",deb:"0",cre:"0",dis:!1,secondSubject:"",projectName:"",projectId:""},{digest:"",tbSubjectName:"",deb:"0",dis:!1,cre:"0",secondSubject:"",projectName:"",projectId:""}],e){case"tb":this.selectOffsetType=2,this.isNewAdjustForm=!1,this.editOrAddTitle="新建试算平衡表抵销";break;case"cash":this.selectOffsetType=3,this.isNewAdjustForm=!1,this.editOrAddTitle="新建现金流量表抵销"}this.selectedOffsetType()},selectedOffsetType:function(){var e=this,t=[];this.selectOffsetType||(this.selectOffsetObject=[]),this.menuList.forEach(function(t){return t.type==e.selectOffsetType?e.entryCategory=t.children:""}),this.roleList.forEach(function(a){(t=e.selectOffsetType==Number(3)?a.cash:a.tb)&&t.map(function(e){e.showLabel=e.value+"-"+e.label}),e.subjectNameList=t,e.projectList=(a.project||[]).map(function(e){return{label:e.label,value:e.value,showLabel:e.label}})})},selectedOffsetObject:function(){var e=this;if(this.$refs.cascader.getCheckedNodes()[0]){var t=this.$refs.cascader.getCheckedNodes()[0].value;if(this.lastModelList.length){var a=x.a.findIndexOf(this.lastModelList,function(t){return t.data.value==x.a.last(e.selectOffsetObject)});this.$XModal.confirm("您确定要改变分录类别吗?这会导致已经填写过的内容丢失!").then(function(i){"confirm"===i?(e.$refs.addItemTable.remove(),e.modelsDialogVisible=!0,-1!=a&&e.lastModelList.splice(a,1),e.lastModelList.push(e.$refs.cascader.getCheckedNodes()[0]),e.getTemplateData(t),e.addItemTableData=[{digest:"",tbSubjectName:"",deb:"0",cre:"0",secondSubject:"",projectName:"",projectId:""},{digest:"",tbSubjectName:"",deb:"0",cre:"0",secondSubject:"",projectName:"",projectId:""}]):1==e.lastModelList.length?(e.$refs.cascader.getCheckedNodes()[0]=e.lastModelList[0],e.selectOffsetObject=e.lastModelList[0].path):(e.selectOffsetObject=e.lastModelList[e.lastModelList.length-1].path,e.$refs.cascader.getCheckedNodes()[0]=e.lastModelList[e.lastModelList.length-1])})}else this.modelsDialogVisible=!0,this.getTemplateData(t),this.lastModelList.push(this.$refs.cascader.getCheckedNodes()[0])}else this.lastModelList=[],this.addItemTableData=[{digest:"",tbSubjectName:"",dis:!1,deb:"0",cre:"0",secondSubject:"",secondSubjectList:[],projectName:"",projectId:""},{digest:"",tbSubjectName:"",deb:"0",dis:!1,cre:"0",secondSubject:"",secondSubjectList:[],projectName:"",projectId:""}]},getTemplateData:function(e){var t=this;this.$sacpApis.offsetEntryTemplate({templateId:e}).then(function(e){e.success?e.data&&(t.templateData=e.data):t.$message.error(e.resultInfo.statusText)}).catch(function(e){return t.$message.error(e)})},selectedAll:function(){var e=[];this.templateData.forEach(function(t){return e.push(t.label)}),this.$refs.tree.setCheckedKeys(e)},resetChecked:function(){var e=this;this.$nextTick(function(){e.$refs.tree.setCheckedKeys([])})},checkNote:function(e){var t=this;if(!e.tbSubjectCodeName)return this.$message.error("请先选择科目!");var a={projectId:this.curProjectId,customerId:this.curCustomerId,tbSubjectCode:e.tbSubjectCodeName.split("-")[0]};this.$sacpApis.offsetEntryView(g()(a)).then(function(e){if(e.success)if(1==e.resultInfo.status)t.$message.error("该科目未对照报表科目");else if(2==e.resultInfo.status)t.$message.error("该科目对照的报表科目未对照附注");else if(3==e.resultInfo.status)t.$alert("该科目附注未生成是否查看附注模板?",{confirmButtonText:"确定",callback:function(e){"confirm"===e&&t.viewTemplate(g()(a))}});else{var i={extraOptions:e.data[0].rowData,currentNode:{extraOptions:e.data[0].rowData}};i.autoId=i.extraOptions.autoId,sessionStorage.setItem("mergeNoteInfoNode",g()(i)),window.open("/Faith/dgcenter.do?m=openMergeNoteInfo&noteNo="+i.extraOptions.noteNo)}else t.$message.error(e.resultInfo.statusText)})},viewTemplate:function(e){this.$sacpApis.offsetViewTemplate(e).then(function(e){if(e.success&&e.data){var t={extraOptions:e.data[0].rowData,currentNode:{extraOptions:e.data[0].rowData}};t.autoId=t.extraOptions.autoId,sessionStorage.setItem("mergeNoteTemplateNode",g()(t)),window.open("/Faith/dgcenter.do?m=openMergeNoteTemplate&noteNo="+t.extraOptions.noteNo)}})},changeTbSubjectName:function(e,t){if(e&&(e.tbSubjectCodeName||e.tbSubjectName)){var a=[];e.tbSubjectName?a=this.subjectNameList.filter(function(t){return t.value==e.tbSubjectCodeName}):e.tbSubjectCodeName&&(a=this.subjectNameList.filter(function(t){return t.value==e.tbSubjectCodeName})),a.length&&this.addItemTableData.forEach(function(t){t.stdAcctCode==e.stdAcctCode&&(t.tbSubjectCode=a[0].value,t.tbSubjectName=a[0].label)})}e.tbSubjectCodeName&&this.querySecondarySubjectList(e,t),this.$refs.addItemTable.reloadData(this.addItemTableData)},clearTbSubjectName:function(e){e&&this.addItemTableData.forEach(function(t){t.stdAcctCode==e.stdAcctCode&&(t.tbSubjectCode="",t.tbSubjectName="",t.tbSubjectCodeName="")}),e.secondSubjectList=[],this.$refs.addItemTable.reloadData(this.addItemTableData)},handleCellClick:function(e){var t=e.row,a=e.rowIndex;e.column,e.columnIndex;this.curRowIndex=a,this.curRow=t},handleEditCellClick:function(e){var t=e.row,a=e.rowIndex;e.column,e.columnIndex;this.curRowIndex=a,this.curRow=t},editActivedEvent:function(e){var t=e.row,a=e.column;this.activeRowBackOld=f()({},t),this.creDisabled=!("cre"!==a.property||void 0!=t.cre||!this.isEdit),this.debDisabled=!("deb"!==a.property||void 0!=t.deb||!this.isEdit),this.debDisabled=Number(t.cre)>0&&!this.isEdit,this.creDisabled=Number(t.deb)>0&&!this.isEdit},insertEvent:function(e){this.$refs.addItemTable.insertAt(e,-1).row;this.addItemTableData.push({digest:"",tbSubjectName:"",deb:"0",cre:"0",secondSubjectList:[]})},removeEvent:function(){var e=this;this.addItemTableData.length<=2?this.$message.warning("至少需要新增2条数据"):this.$XModal.confirm("您确定要删除该数据?").then(function(t){"confirm"===t&&(e.$refs.addItemTable.remove(e.curRow),e.addItemTableData=e.addItemTableData.filter(function(t){return t.stdAcctCode!=e.curRow.stdAcctCode}))})},selectedYearDate:function(){var e=this;this.yearList.forEach(function(t){if(t.value==e.selectYear)return e.selectYear=t.label}),this.offsetEntryInit()},closeDialog:function(){var e=this;this.$XModal.confirm("您确定要取消编辑吗?").then(function(t){"confirm"===t&&(e.addDialogFormVisible=!1,e.addItemTableData=[],e.$refs.addItemTable.remove())})},selectedYear:function(){var e=this;this.yearList.forEach(function(t){if(t.value==e.yyyy)return e.yyyy=t.label})},submitAddDialogForm:function(e){var t=this;if(0==this.subtract){var a=this.$refs.addItemTable.data,i=function(e){return Number(a[e].cre)||Number(a[e].deb)?!a[e].cre&&!a[e].deb||x.a.trim(a[e].tbSubjectName)?((a[e].tbSubjectName||a[e].tbSubjectCodeName)&&t.subjectNameList.forEach(function(t){if(a[e].tbSubjectName&&a[e].tbSubjectName==x.a.trim(t.label)||a[e].tbSubjectCodeName&&(a[e].tbSubjectCodeName==x.a.trim(t.label)||a[e].tbSubjectCodeName==x.a.trim(t.value)))return a[e].tbSubjectName=t.label,void(a[e].tbSubjectCode=t.value)}),void(a[e].projectId&&(a[e].projectName=t.projectList.filter(function(t){return t.value===a[e].projectId})[0].label))):(t.$message.error("科目名称不能为空!"),{v:void 0}):(t.$message.error("无有效的可保存分录!"),{v:void 0})};for(var r in a){var s=i(r);if("object"===(void 0===s?"undefined":m()(s)))return s.v}this.saveOffSet(e,a)}else this.$message.error("差额必须为0才可以保存!")},saveOffSet:function(e,t){var a=this;for(var i in t)t[i].secondSubjectList=null;t.forEach(function(e){for(var t in e)"number"==typeof e[t]&&(e[t]=""+e[t])});var r={yyyy:this.yyyy||this.curAccYear,projectId:this.selectedProjectId,adjustType:this.selectOffsetType,arr:t};this.secondSubject.forEach(function(e,a){t.forEach(function(t,a){t.secondSubject==e.value&&(t.secondSubject=e.label)})}),this.$sacpApis.offsetEntryAddSave(r).then(function(i){i.success?(a.$message.success("保存成功"),a.hanldeSaveSuccess(e,t),a.offsetEntryInit(),a.$eventBus.$emit("page-refresh",i.resultInfo.refreshIndexes)):a.$message.error(i.resultInfo.statusText)}).catch(function(e){return a.$message.error(e)})},hanldeSaveSuccess:function(e,t){var a=this,i=this.menuList.filter(function(e){return e.type==a.selectOffsetType});this.handleNodeClick(i[0]),this.$refs.addItemTable.remove(),this.changeModel.length=0,this.selectOffsetObject=[],this.lastModelList=[],this.selectedProjectId="",this.yyyy="",e?(this.addDialogFormVisible=!1,this.$refs.addItemTable.revertData()):this.addItemTableData.forEach(function(e){x.a.clear(e,"")}),t[0].templateId&&this.curMenuItem.value==t[0].templateId&&this.offsetEntryInit(),this.$refs.addItemTable.reloadData(this.addItemTableData)},editOffset:function(e,t,a){var i=this;this.editDialogFormVisible=!0,this.curTbOffsetData.forEach(function(e){e.indexId==a.indexId&&(e.showLabel=e.tbSubjectCode&&e.tbSubjectName?e.tbSubjectCode+"-"+e.tbSubjectName:"",e.showProject=e.projectId&&e.projectName?e.projectId+"-"+e.projectName:"",i.editItemTableData.push(e))}),this.editTitle="编辑分录:"+a.indexId},submitEditDialogForm:function(){var e=this;if(0!=this.subtract)return this.$message.error("总金额存在差额,请修改");var t=this.$refs.editItemTable.data;t.forEach(function(e){for(var t in e)"number"==typeof e[t]&&(e[t]=e[t].toString())});var a={yyyy:t[0].yyyy,projectId:t[0].projectId,adjustType:t[0].adjustType,arr:t};this.$sacpApis.offsetModifySave(a).then(function(t){t.success?(e.$message.success("保存成功"),e.$eventBus.$emit("page-refresh",t.resultInfo.refreshIndexes)):e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$$message.error(t)}).finally(function(){e.editDialogFormVisible=!1,e.$refs.editItemTable.remove(),e.editItemTableData=[],e.offsetEntryInit()})},closeEditDialog:function(){var e=this;this.$XModal.confirm("您确定要取消编辑吗?").then(function(t){"confirm"===t&&(e.editDialogFormVisible=!1,e.editItemTableData=[],e.$refs.editItemTable.getUpdateRecords().length>0&&e.offsetEntryInit(),e.$refs.editItemTable.revertData(),e.$refs.editItemTable.remove())})},saveEditItem:function(){var e=this;this.copyList=[],this.modelsDialogVisible=!1,this.$refs.tree.getCheckedNodes().forEach(function(e){e.tbSubjectName=e.label,delete e.label});var t=this.$refs.tree.getCheckedNodes().filter(function(e){return e.digest&&e.tbSubjectName});if(t.map(function(t){e.subjectNameList.filter(function(e){x.a.trim(e.label)===x.a.trim(t.tbSubjectName)&&(t.tbSubjectCodeName=e.showLabel)})}),1==t.length){this.addItemTableData=t.concat([{digest:"",tbSubjectCodeName:"",tbSubjectName:"",dis:!1,deb:"0",cre:"0",secondSubjectList:[]}])}else t.length?this.addItemTableData=t:(this.addItemTableData=[{digest:"",tbSubjectCodeName:"",dis:!1,tbSubjectName:"",deb:"0",cre:"0",secondSubjectList:[]},{digest:"",dis:!1,tbSubjectName:"",deb:"0",cre:"0",secondSubjectList:[]}],this.$message("因没有对应的科目名称,有部分模板没有生成!"));this.$refs.addItemTable.remove();var a=[];this.addItemTableData.forEach(function(e,t){var i={tbSubjectName:e.tbSubjectName,tbSubjectCode:e.tbSubjectCodeName.split("-")[0]};a.push(i)}),this.querySecondarySubjectsList(a)},querySecondarySubjectsList:function(e){var t=this,a={projectId:this.curProjectId,customerId:this.curCustomerId,params:e};this.$sacpApis.querySecondarySubjectsList(a).then(function(e){if(e.success){var a=function(a){t.addItemTableData.map(function(t){if(t.tbSubjectCodeName.split("-")[0]==a){var i=[];e.data[0].list[a].map(function(e){i.push({label:e,value:e})}),t.secondSubjectList=i}})};for(var i in e.data[0].list)a(i)}})},delOffset:function(e){var t=this;this.$confirm("确定要删除这条数据吗？","确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.handleDelete(e)}).catch(function(e){})},lookOffset:function(e){this.$refs.autoGenerationOffsetTable.queryAutoOffsetInfoData(e)},handleDelete:function(e){var t=this,a={autoId:e.autoId};this.$sacpApis.offsetDelete(a).then(function(e){e.success?(t.$message.success("删除成功"),t.$eventBus.$emit("page-refresh",e.resultInfo.refreshIndexes),t.offsetEntryInit()):t.$message.error(e.resultInfo.statusText)}).catch(function(e){return t.$message.error(e)})},rowDisabled:function(e){var t=this;"0"==e.row.activeFlag?this.hanldeInvalidOffsetData(e,""):this.$confirm("确定要禁用这条数据吗？","确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.$prompt("请输入禁用理由","",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^\S{1,100}$/,inputErrorMessage:"禁用理由长度限制为100字!"}).then(function(a){var i=a.value;t.hanldeInvalidOffsetData(e,i)}).catch(function(){})}).catch(function(e){})},hanldeInvalidOffsetData:function(e,t){var a=this,i={autoId:e.row.autoId,reason:t};this.$sacpApis.invalidOffset(i).then(function(e){e.success?(a.offsetEntryInit(),a.$eventBus.$emit("page-refresh",e.resultInfo.refreshIndexes)):a.$message.error(e.resultInfo.statusText)}).catch(function(e){return a.$message.error(e)})},footerColspanMethod:function(e){e.columnIndex},footerMethod:function(e){var t=this,a=e.columns,i=e.data,r=[a.map(function(e,a){if(1===a)return"合 计";if(["deb","cre"].includes(e.property)){var r=void 0;for(var s in i){var o=i[s][e.property];-1!=String(o).indexOf(",")&&(o=String(o).replace(/,/gi,"")),o="string"==typeof o&&0==o.indexOf(0)&&o.indexOf(".")<1?0:1*o,r=x.a.add(r,t.removeComafy(o))}return x.a.commafy(r,{digits:2})}return null})];return 5===a.length?this.subtract=x.a.commafy(x.a.subtract(this.removeComafy(r[0][3]),this.removeComafy(r[0][4])),{digits:2}):4===a.length&&(this.subtract=x.a.commafy(x.a.subtract(this.removeComafy(r[0][2]),this.removeComafy(r[0][3])),{digits:2})),r},removeComafy:function(e){return-1!=String(e).indexOf(",")&&(e=String(e).replace(/,/gi,"")),Number(e)},offsetEntryInit:function(){var e=this;this.curTbOffsetData=[];var t,a=this.curCustomerId,i=this.curProjectId;return t=this.curMenuItem.value,this.queryOffsetParam={customerId:a,projectId:i,year:this.selectYear||"",value:t,offsetType:this.curMenuItem.type,activeFlage:this.activeFlag||""},new u.a(function(t,a){e.$sacpApis.queryOffsetListByTemplateId(e.queryOffsetParam).then(function(a){e.isShowTable=!0;e.curTbOffsetData=a.data,a.data?(e.handleDataLength(),e.rowspan(0,"autoId"),e.rowspan(1,"indexId")):e.dataLenght=0,t(a)}).catch(function(t){e.$message.error(t),a(t)}).finally(function(){e.$store.commit("setRefreshPagesMenuId","")})})},handleDataLength:function(){var e=this,t=this.curTbOffsetData.reduce(function(t,a){return!e.curTbOffsetData[a.indexId]&&(e.curTbOffsetData[a.indexId]=t.push(a)),t},[]);return this.dataLenght=t.length},handleMenu:function(){var e=this;this.$sacpApis.offsetEntryIndexMenu({departmentId:this.departmentIdr}).then(function(t){t.success?e.menuList=t.data:e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)}).finally(function(){})},handleNodeClick:function(e){this.debounce(this.getChangeOffsetIdCheckItem(),2e3),this.showBtnType=e.type,this.treeNode=e,e&&e.value!=this.curMenuItem.value&&("4"!=e.type||"58"!=e.value&&"59"!=e.value&&"61"!=e.value?this.isScreen=!1:this.isScreen=!0,62===e.value||63===e.value?this.autoGenerationOffset=!0:this.autoGenerationOffset=!1,"8"==e.type?(this.queryCheckItem(),this.transactionOffentSet=!0):this.transactionOffentSet=!1,this.curMenuItem=e,this.offsetEntryInit())},debounce:function(e,t){var a=void 0;return function(){var i=this,r=arguments;a&&clearTimeout(a),a=setTimeout(function(){e.apply(i,r)},t)}},setIcons:function(){y.a.setup({icon:{TABLE_EDIT:""}})},editClosedEvent:function(e){var t=e.row,a=(e.rowIndex,e.column);-1!=String(t[a.property]).indexOf(",")&&(t[a.property]=t[a.property].replace(/,/gi,"")),t[a.property]=void 0!=t[a.property]?x.a.trim(t[a.property]):t[a.property],"cre"!=a.property&&"deb"!=a.property||!(t[a.property]&&!/^(-?[1-9]\d+|-?\d?)(\.\d+)?$/.test(t[a.property])||void 0!=t[a.property]&&!t[a.property])||(t[a.property]=0)},activeFlagFormatter:function(e,t){return"0"==t?"废弃":"1"==t?"有效":void 0},formatFixedNumber:function(e,t){var a=e.cellValue;return-1!=String(a).indexOf(",")&&(a=a.replace(/,/gi,"")),x.a.commafy(a,{digits:2})},fixedNumber:function(e,t){return x.a.commafy(t,{digits:2})},getSubjectNameList:function(){var e=this;this.$sacpApis.offsetEntrySubjectNameList().then(function(t){t.success?e.roleList=t.data:e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)})},handleCurYear:function(){var e=this.curAccYear,t={value:"1",label:e},a={value:"2",label:e-1};this.yearList.push(t,a)},handleCurstomerId:function(){var e=JSON.parse(sessionStorage.getItem("curCustomerData"));this.curCustomerId=e.curCustomerId,this.curProjectId=e.curProjectId,this.curAccYear=e.curYear,this.departmentIdr=e.departmentIdr,this.handleMenu(),this.setIcons(),this.getSubjectNameList(),this.handleCurYear()},getChangeOffsetIdCheckItem:function(){var e=this;this.$sacpApis.getChangeOffsetIdCheckItem().then(function(t){t.success?e.changedIdSet=t.data[0].changedIdSet:e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)}).finally(function(){})},queryCheckItem:function(){var e=this;this.$sacpApis.queryCheckItem().then(function(t){if(t.success){var a=t.data[0].checkData,i=t.data[0].columnName;e.checkStatus=t.data[0].checkFlag,e.treeNode.checkFlag=t.data[0].checkFlag,t.data[0].checkFlag||(e.menuList[2].checkFlag=!1);var r=[];e.checkItemColumn=[{prop:"company",label:""}],e.checkItemTableData=[],a.forEach(function(e,t){r.push({company:l()(e)[0]}),o()(e).flat(1/0).forEach(function(e){f()(r[t],e)})}),r.forEach(function(e){var t=i.findIndex(function(t){return t==e.company});o()(e).forEach(function(t,a){0==t?e[l()(e)[a]]="平":t&&"number"==typeof t&&(e[l()(e)[a]]=x.a.commafy(t,{digits:2}),e.isNumber=!0)}),e.id=t}),r.sort(function(e,t){return e.id-t.id}),i.forEach(function(t){e.checkItemColumn.push({prop:t,label:t})}),e.checkItemTableData=r}else e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)}).finally(function(){})},checkTransactionSummary:function(){this.$refs.autoGenerationOffsetTable.queryContactSummary()},createOffset:function(e){64===this.treeNode.value?this.$refs.autoGenerationOffsetTable.queryContactSummary2(this.curMenuItem,this.curProjectId,this.curCustomerId,this.treeNode,e):this.$refs.autoGenerationOffsetTable.badDebt(this.curMenuItem,this.curProjectId,this.curCustomerId,this.treeNode,e)},badDebt:function(e){this.$refs.autoGenerationOffsetTable.badDebt(this.curMenuItem,this.curProjectId,this.curCustomerId,this.treeNode,e)},againCreateOffset:function(){var e=this;this.$sacpApis.initContactInformation().then(function(t){t.success?e.$message.success("子公司数据获取成功!"):e.$message.error(t.resultInfo.statusText)})},checkItemShow:function(){this.checkVisible=!0,this.queryCheckItem()},querySecondarySubjectList:function(e,t,a){var i=this;e.secondSubjectList=[],e.dis=!0;var s={projectId:this.curProjectId,customerId:this.curCustomerId,tbSubjectCode:e.tbSubjectCode,tbSubjectName:e.tbSubjectName};this.$sacpApis.querySecondarySubjectList(s).then(function(t){e.dis=!1,t.data&&t.data[0]&&t.data[0].list&&t.data[0].list.forEach(function(t,a){e.secondSubjectList.push({label:t,value:t})}),i.$forceUpdate(),a&&"1"===a&&(i.copyList.push(e),i.addItemTableData=[].concat(r()(i.copyList)))})},clearSecondSubject:function(e){e.secondSubject="",this.$refs.addItemTable.reloadData(this.addItemTableData)},renderContent:function(e,t){var a=t.node,i=t.data;t.store;return e("span",{class:"custom-tree-node",style:"color:"+(-1!=this.changedIdSet.indexOf(i.value)?"red":"")},[e("span",[a.label])])},handleClose:function(){this.dialogVisible=!1},queryMergeCashFlowSummary:function(){var e=this;this.dialogVisible=!0,this.$sacpApis.queryMergeCashFlowSummary().then(function(t){if(t.success){if(t.data){var a=t.data[0],i=a.columnName,r=[],s=[];for(var o in i)r.push({label:o,prop:i[o],miniWidth:"100px",align:"right",formatter:{type:"function",value:e.fixedNumber}}),s.push(i[o]);r.unshift({label:"科目",prop:"colName",fixed:"left",miniWidth:"200px"}),r.push({label:"合计",prop:"sum",fixed:"left",align:"right",miniWidth:"100px",formatter:{type:"function",value:e.fixedNumber}}),e.mergeCashFlowSummaryColumn=r,a.tableData.forEach(function(e){var t=0;s.forEach(function(a){t=x.a.add(t,e[a])}),e.sum=t}),e.mergeCashFlowSummaryData=a.tableData}}else e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)})},initCashFlowStatementOffsetData:function(){var e=this;this.getChangedOffsetId(),this.loading=!0,setTimeout(function(){e.loading=!1},1e4),this.$sacpApis.initCashFlowStatementOffsetData().then(function(t){t.success?(e.$message.success("初始化成功!"),e.loading=!1):(e.$message.error(t.resultInfo.statusText),e.loading=!1)}).catch(function(t){return e.$message.error(t)})},cashFlowCreateOffset:function(){this.$refs.autoGenerationOffsetTable.queryMergeCashFlowSummary(this.treeNode)},costOfMethods:function(){91==this.treeNode.value&&this.$refs.costOffset.costOfMethods(this.curCustomerId,this.curProjectId,this.yearList,this.curMenuItem)},chooseObj:function(e){this.childObj=e},receiveEvent:function(e){var t=this;this.costOffsettingIsShow=!0,this.childRow=e,this.$nextTick(function(){t.$refs.costOffsettingModal.costOfsetMethods()})},handleTransactionDialogClose:function(e){this.transactionDialogVisible=!1},exportFile:function(){var e=this.queryOffsetParam,t=e.customerId,a=e.projectId,i=e.subjectName,r=e.subjectId,s=e.year,o=e.offsetType,n=e.value,l=e.mergeProject,c=e.activeFlage,u={columns:this.tbOffsetColumn,params:{param1:t,param2:a,param3:i,param4:r,param5:s,param6:o,param7:n,param8:l,param9:c},url:"dgCenter/HbOffsetEntry.queryOffsetListByTemplateId.json",fileName:"抵销分录"};this.exportExcel(u)},cellStyle:function(e){e.rowIndex;var t=e.columnIndex,a=e.row;e.column;return 6!=t&&5!==t||0!==a.dataType?{}:{color:"#E6A23C"}}},created:function(){this.handleCurstomerId();var e=this.$DIC("activeFlag");e.push({label:"全部",value:null}),this.activeFlagValue=e,this.getChangeOffsetIdCheckItem()}},K={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"offsetEntry"},[i("div",{class:{fullScreen:e.fullScreen?"fullScreen":"",fullScreenBox:!0}},[i("el-container",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.loading,expression:"loading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"offsetEntryContainer",staticStyle:{border:"1px solid #eee"}},[i("el-aside",{class:e.isCollapse?"collapse":null,staticStyle:{height:"100%",width:"280px"}},[i("div",{staticClass:"treeList"},[i("el-tree",{attrs:{data:e.menuList,props:e.defaultProps,"render-content":e.renderContent},on:{"node-click":e.handleNodeClick}})],1)]),e._v(" "),e.isShowTable?i("el-main",[i("el-row",{staticClass:"row-bg",attrs:{type:"flex"}},[i("el-col",{staticClass:"collapseBtn",attrs:{span:1}},[i("el-button",{class:e.isCollapse?"el-icon-caret-right":"el-icon-caret-left",attrs:{type:"primary",size:"small",title:e.isCollapse?"展开":"收起"},on:{click:e.handleCollapse}})],1),e._v(" "),i("el-col",{attrs:{span:23}},[i("div",{staticClass:"headerBtnList"},[i("el-col",{staticClass:"tips"},[i("span",{directives:[{name:"show",rawName:"v-show",value:e.transactionOffentSet&&!e.checkStatus,expression:"\n                                        transactionOffentSet && !checkStatus\n                                    "}]},[e._v("校验不平")])]),e._v(" "),i("el-col",["5"===e.showBtnType?i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"初始化内部交易数据",placement:"top-start"}},["5"===e.showBtnType?i("el-button",{attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-refresh-right"},on:{click:function(t){return e.saveSingleToHbInsiderTradingData()}}}):e._e()],1):e._e(),e._v(" "),"5"===e.showBtnType?i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"生成抵销",placement:"top-start"}},["5"===e.showBtnType?i("el-button",{attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-s-order"},on:{click:function(t){return e.InternalFixedOffsetShow()}}}):e._e()],1):e._e(),e._v(" "),"5"===e.showBtnType?i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"查看校验表",placement:"top-start"}},["5"===e.showBtnType?i("el-button",{attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-tickets"},on:{click:function(t){return e.showCheckList()}}}):e._e()],1):e._e(),e._v(" "),"5"===e.showBtnType?i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"查看内部交易汇总",placement:"top-start"}},["5"===e.showBtnType?i("el-button",{staticStyle:{"margin-right":"35px !important"},attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-folder-opened"},on:{click:function(t){return e.queryMerchantInsideClassify()}}}):e._e()],1):e._e(),e._v(" "),e.transactionOffentSet||e.autoGenerationOffset||"2"!=e.showBtnType||"4"===e.showBtnType||"5"===e.showBtnType||"8"===e.showBtnType?e._e():i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"新建抵销",placement:"top-start"}},[e.transactionOffentSet||e.autoGenerationOffset?e._e():i("el-button",{staticClass:"balanceOffset",attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-folder-add"},on:{click:function(t){return e.addOffsetEntry("tb")}}})],1),e._v(" "),i("el-tooltip",{attrs:{effect:"dark",content:e.fullScreen?"取消全屏":"全屏",placement:"top-start"}},[i("el-button",{class:e.isScreen?"fullScreenBtnFlag":"fullScreenBtn",attrs:{type:"primary",circle:"",size:"small"},on:{click:e.fullScreenChange}},[e.fullScreen?e._e():i("img",{attrs:{src:a("/Dxn"),alt:""}}),e._v(" "),e.fullScreen?i("img",{attrs:{src:a("W+0t"),alt:""}}):e._e()])],1),e._v(" "),e.transactionOffentSet||e.autoGenerationOffset||"3"!=e.showBtnType||"4"===e.showBtnType||"5"===e.showBtnType||"8"===e.showBtnType?e._e():i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"新建抵销",placement:"top-start"}},[e.transactionOffentSet||e.autoGenerationOffset?e._e():i("el-button",{staticStyle:{"margin-right":"35px !important"},attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-tickets"},on:{click:function(t){return e.addOffsetEntry("cash")}}})],1),e._v(" "),!e.transactionOffentSet&&e.autoGenerationOffset?i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"生成抵销",placement:"top-start"}},[!e.transactionOffentSet&&e.autoGenerationOffset?i("el-button",{staticStyle:{"margin-right":"40px !important"},attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-s-help"},on:{click:e.initOffSetByHand}}):e._e()],1):e._e(),e._v(" "),e.transactionOffentSet?i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"重新获取子公司数据",placement:"top-start"}},[e.transactionOffentSet?i("el-button",{attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-refresh"},on:{click:e.againCreateOffset}}):e._e()],1):e._e(),e._v(" "),e.transactionOffentSet&&!e.curMenuItem.children?i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"生成抵销",placement:"top-start"}},[e.transactionOffentSet&&!e.curMenuItem.children?i("el-button",{attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-s-help"},on:{click:e.createOffset}}):e._e()],1):e._e(),e._v(" "),e.transactionOffentSet?i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"内部往来汇总",placement:"top-start"}},[e.transactionOffentSet?i("el-button",{attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-pie-chart"},on:{click:e.checkTransactionSummary}}):e._e()],1):e._e(),e._v(" "),e.transactionOffentSet?i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"查看校验项",placement:"top-start"}},[e.transactionOffentSet?i("el-button",{staticStyle:{"margin-right":"35px !important"},attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-data-analysis"},on:{click:e.checkItemShow}}):e._e()],1):e._e(),e._v(" "),"9"===e.showBtnType?i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"初始化子公司现金流量表",placement:"top-start"}},[i("el-button",{attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-refresh-right"},on:{click:function(t){return e.initCashFlowStatementOffsetData()}}})],1):e._e(),e._v(" "),"9"===e.showBtnType?i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"现金流量表自动抵销汇总查询",placement:"top-start"}},[i("el-button",{attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-pie-chart"},on:{click:function(t){return e.queryMergeCashFlowSummary()}}})],1):e._e(),e._v(" "),"9"===e.showBtnType?i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"生成抵销",placement:"top-start"}},["9"===e.showBtnType?i("el-button",{staticStyle:{"margin-right":"35px !important"},attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-s-help"},on:{click:e.cashFlowCreateOffset}}):e._e()],1):e._e(),e._v(" "),"6"===e.showBtnType?i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"生成抵销",placement:"top-start"}},["6"===e.showBtnType?i("el-button",{staticStyle:{"margin-right":"35px !important"},attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-s-help"},on:{click:e.costOfMethods}}):e._e()],1):e._e()],1)],1),e._v(" "),i("BdoTable",{ref:"offsetTable",class:e.isScreen?"fullScreenFlag":"",attrs:{border:"",data:e.curTbOffsetData,"page-total":e.dataLenght,columns:e.tbOffsetColumn,"enable-filter":!1,"enable-toolbox":!1,"enable-view-type":!1,"responsive-height-gap":250,"span-method":this.spanArr&&this.spanArr.length?e.objectSpanMethod:function(){return[1,1]},"cell-style":e.cellStyle,showIndexColumn:!0,showCheckBox:!1,setBorder:!0,queryConfig:e.queryConfig,"row-class-name":{id:"indexId"}},on:{isRefreshDataLength:e.isRefreshDataLength,exportFile:e.exportFile},scopedSlots:e._u([{key:"col-autoId",fn:function(t){return[i("div",{staticClass:"buttonList"},[i("div",{staticStyle:{display:"flex","flex-direction":"column",width:"fit-content"}},[i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"编辑",placement:"top-start"}},[i("el-button",{attrs:{size:"mini",type:"success",icon:"el-icon-edit-outline normalWeight"},on:{click:function(a){return e.editOffset(t.row.autoId,t.row.customerId,t.row)}}})],1),e._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"删除",placement:"top-start"}},[i("el-button",{attrs:{size:"mini",type:"danger",disabled:"0"==t.row.activeFlag,icon:"el-icon-close normalWeight"},on:{click:function(a){return e.delOffset(t.row)}}})],1),e._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"查看",placement:"top-start"}},[i("el-button",{attrs:{size:"mini",type:"success",icon:"el-icon-view normalWeight"},on:{click:function(a){return e.lookOffset(t.row)}}})],1),e._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"1"==t.row.activeFlag?"禁用":"激活",placement:"top-start"}},[i("el-button",{attrs:{size:"mini",icon:"1"==t.row.activeFlag?"el-icon-unlock normalWeight":"el-icon-lock normalWeight",type:"1"==t.row.activeFlag?"info":"danger"},on:{click:function(a){return e.rowDisabled(t)}}})],1)],1)])]}}],null,!1,569962258)},[i("template",{slot:"action"},[i("div",{staticStyle:{float:"right",display:"flex"}},[i("div",{staticStyle:{"margin-right":"8px"}},[i("span",{staticStyle:{color:"#b1b1b1"}},[e._v("选择年份:")]),e._v(" "),i("el-select",{attrs:{filterable:"",clearable:"",placeholder:"请选择年份"},on:{change:e.selectedYearDate},model:{value:e.selectYear,callback:function(t){e.selectYear=t},expression:"selectYear"}},e._l(e.yearList,function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),i("div",[i("span",{staticStyle:{color:"#b1b1b1"}},[e._v("状态查询:")]),e._v(" "),i("el-select",{attrs:{filterable:"",clearable:"",placeholder:"请选择状态"},on:{change:e.selectedActiveFlage},model:{value:e.activeFlag,callback:function(t){e.activeFlag=t},expression:"activeFlag"}},e._l(e.activeFlagValue,function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)])])],2)],1)],1)],1):e._e()],1),e._v(" "),i("el-dialog",{attrs:{title:e.editOrAddTitle,visible:e.addDialogFormVisible,"before-close":e.closeDialog,width:"90%"},on:{"update:visible":function(t){e.addDialogFormVisible=t}}},[i("el-row",{staticClass:"entry",attrs:{gutter:20}},[i("el-col",{attrs:{span:e.isNewAdjustForm?8:12}},[i("span",{staticClass:"selectTitle"},[e._v("分录类别:")]),e._v(" "),i("el-cascader",{ref:"cascader",attrs:{clearable:"",options:e.entryCategory},on:{change:e.selectedOffsetObject},model:{value:e.selectOffsetObject,callback:function(t){e.selectOffsetObject=t},expression:"selectOffsetObject"}})],1),e._v(" "),i("el-col",{attrs:{span:e.isNewAdjustForm?8:12}},[i("span",{staticClass:"selectTitle"},[e._v("年份:")]),e._v(" "),i("el-select",{attrs:{filterable:"",clearable:"",placeholder:"请选择年份"},on:{change:e.selectedYear},model:{value:e.yyyy,callback:function(t){e.yyyy=t},expression:"yyyy"}},e._l(e.yearList,function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1),e._v(" "),i("vxe-grid",{ref:"addItemTable",attrs:{border:"",height:"385",data:e.addItemTableData,"edit-config":{trigger:"click",mode:"cell"},"row-key":!0,"row-id":"stdAcctCode","keep-source":"","show-footer":"","footer-span-method":e.footerColspanMethod,"footer-method":e.footerMethod,"header-align":"center"},on:{"cell-click":e.handleCellClick,"edit-actived":e.editActivedEvent,"edit-closed":e.editClosedEvent}},[i("vxe-table-column",{staticClass:"oEbtnList",attrs:{width:"30"}},[i("vxe-button",{staticClass:"addBtn",attrs:{icon:"vxe-icon--circle-plus"},on:{click:function(t){return e.insertEvent()}}}),e._v(" "),i("vxe-button",{staticClass:"delBtn",attrs:{icon:"vxe-icon--remove"},on:{click:e.removeEvent}})],1),e._v(" "),i("vxe-table-column",{attrs:{field:"digest",title:"摘要","edit-render":{name:"input",autoselect:!0}}}),e._v(" "),i("vxe-table-column",{attrs:{field:"projectId",title:"项目"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[i("el-select",{attrs:{clearable:"",disabled:e.isEdit,filterable:""},model:{value:a.projectId,callback:function(t){e.$set(a,"projectId",t)},expression:"row.projectId"}},e._l(e.projectList,function(e){return i("el-option",{key:e.value,attrs:{value:e.value,label:e.showLabel}})}),1)]}}])}),e._v(" "),i("vxe-table-column",{attrs:{field:"tbSubjectCodeName",title:"科目名称"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row,r=t.rowIndex;return[i("el-select",{attrs:{clearable:"",disabled:e.isEdit,filterable:""},on:{change:function(t){return e.changeTbSubjectName(a,r)},clear:function(t){return e.clearTbSubjectName(a,r)}},model:{value:a.tbSubjectCodeName,callback:function(t){e.$set(a,"tbSubjectCodeName",t)},expression:"row.tbSubjectCodeName"}},e._l(e.subjectNameList,function(e){return i("el-option",{key:e.value,attrs:{value:e.value,label:e.showLabel}})}),1)]}}])}),e._v(" "),i("vxe-table-column",{attrs:{title:"二级科目",field:"secondSubject","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[i("el-autocomplete",{staticStyle:{width:"100%",padding:"0 15px 0 0"},attrs:{disabled:e.isEdit||a.dis,clearable:"",filterable:"","fetch-suggestions":function(t,i){e.querySearch(t,i,a)},placeholder:"请输入内容"},on:{select:e.handleSelect,clear:function(t){return e.clearSecondSubject(a)}},model:{value:a.secondSubject,callback:function(t){e.$set(a,"secondSubject",t)},expression:"row.secondSubject"}}),e._v(" "),i("i",{staticClass:"el-icon-view check-note-viewIcon",attrs:{title:"预览附注"},on:{click:function(t){return e.checkNote(a)}}})]}}])}),e._v(" "),i("vxe-table-column",{attrs:{field:"otherDescription",title:"描述","edit-render":{name:"input",autoselect:!0}}}),e._v(" "),i("vxe-table-column",{attrs:{title:"借方金额",field:"deb","edit-render":{name:"input",autoselect:!0,immediate:!0,attrs:{disabled:e.debDisabled},events:{input:e.updateFooterEvent}},formatter:e.formatFixedNumber,align:e.allAlign,"header-align":"center"}}),e._v(" "),i("vxe-table-column",{attrs:{title:"贷方金额",field:"cre","edit-render":{name:"input",autoselect:!0,immediate:!0,attrs:{disabled:e.creDisabled},events:{input:e.updateFooterEvent}},formatter:e.formatFixedNumber,align:e.allAlign,"header-align":"center"}})],1),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:0!=e.subtract,expression:"subtract != 0"}],staticClass:"balance",staticStyle:{"text-align":"right",color:"red","padding-right":"20px"}},[e._v("\n                差 额:"+e._s(e.subtract)+"\n            ")]),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"info",size:"small"},on:{click:e.closeDialog}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.submitAddDialogForm(!1)}}},[e._v("保存且继续添加分录")]),e._v(" "),i("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.submitAddDialogForm(!0)}}},[e._v("保存后关闭")])],1)],1),e._v(" "),i("el-dialog",{attrs:{title:e.editTitle,visible:e.editDialogFormVisible,"before-close":e.closeEditDialog,width:"90%"},on:{"update:visible":function(t){e.editDialogFormVisible=t}}},[i("vxe-grid",{ref:"editItemTable",attrs:{border:"",height:"385",data:e.editItemTableData,"edit-config":{trigger:"click",mode:"cell"},"row-key":!0,"row-id":"stdAcctCode","keep-source":"","show-footer":"","footer-span-method":e.footerColspanMethod,"footer-method":e.footerMethod,"header-align":"center"},on:{"cell-click":e.handleEditCellClick,"edit-actived":e.editActivedEvent,"edit-closed":e.editClosedEvent}},[i("vxe-table-column",{attrs:{field:"digest",title:"摘要","edit-render":{name:"input",autoselect:!0}}}),e._v(" "),i("vxe-table-column",{attrs:{field:"projectId",title:"项目"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[i("el-input",{attrs:{disabled:""},model:{value:a.showProject,callback:function(t){e.$set(a,"showProject",t)},expression:"row.showProject"}})]}}])}),e._v(" "),i("vxe-table-column",{attrs:{field:"showLabel",title:"科目名称"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[i("el-input",{attrs:{disabled:""},model:{value:a.showLabel,callback:function(t){e.$set(a,"showLabel",t)},expression:"row.showLabel"}})]}}])}),e._v(" "),i("vxe-table-column",{attrs:{title:"二级科目",field:"secondSubject","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[i("el-input",{attrs:{disabled:""},model:{value:a.secondSubject,callback:function(t){e.$set(a,"secondSubject",t)},expression:"row.secondSubject"}})]}}])}),e._v(" "),i("vxe-table-column",{attrs:{title:"描述",field:"otherDescription","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[i("el-input",{attrs:{disabled:""},model:{value:a.otherDescription,callback:function(t){e.$set(a,"otherDescription",t)},expression:"row.otherDescription"}})]}}])}),e._v(" "),i("vxe-table-column",{attrs:{title:"借方金额",field:"deb","edit-render":{name:"input",autoselect:!0,attrs:{disabled:e.debDisabled}},formatter:e.formatFixedNumber,align:e.allAlign,"header-align":"center"}}),e._v(" "),i("vxe-table-column",{attrs:{title:"贷方金额",field:"cre","edit-render":{name:"input",autoselect:!0,attrs:{disabled:e.creDisabled}},formatter:e.formatFixedNumber,align:e.allAlign,"header-align":"center"}})],1),e._v(" "),0!=e.subtract?i("div",{staticClass:"balance",staticStyle:{"text-align":"right",color:"red","padding-right":"20px"}},[e._v("\n                差 额:"+e._s(e.subtract)+"\n            ")]):e._e(),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"info",size:"small"},on:{click:e.closeEditDialog}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.submitEditDialogForm("addForm")}}},[e._v("保存后关闭")])],1)],1),e._v(" "),i("el-dialog",{attrs:{title:"选择模板",visible:e.modelsDialogVisible,"destroy-on-close":!0,width:"80%"},on:{"update:visible":function(t){e.modelsDialogVisible=t}}},[i("el-tree",{ref:"tree",attrs:{data:e.templateData,"show-checkbox":"","default-expand-all":"","node-key":"label","highlight-current":"",props:e.defaultPropsT},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.node,r=t.data;return i("span",{staticClass:"custom-tree-node"},[i("span",[e._v(e._s(a.label))]),e._v(" "),r.secondSubject?i("span",{staticClass:"second_subject"},[e._v("\n                        "+e._s("("+r.secondSubject+")")+"\n                    ")]):e._e()])}}])}),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.selectedAll}},[e._v("全 选")]),e._v(" "),i("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.resetChecked}},[e._v("清 空")]),e._v(" "),i("el-button",{attrs:{type:"info",size:"small"},on:{click:function(t){e.modelsDialogVisible=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.saveEditItem()}}},[e._v("保 存")])],1)],1),e._v(" "),i("auto-generation-offset",{ref:"autoGenerationOffsetTable",attrs:{roleList:e.roleList},on:{refreshAutoOffsetTable:e.refreshAutoOffsetTable}}),e._v(" "),i("el-dialog",{attrs:{title:"查看校验项  (校验公式：资产类往来合计=负债类往来合计)",visible:e.checkVisible,width:"70%"},on:{"update:visible":function(t){e.checkVisible=t}}},[[i("el-table",{staticClass:"checkTable",attrs:{data:e.checkItemTableData,"row-style":e.rowStyle,"cell-style":e.hasValue,"show-overflow-tooltip":!0,border:""}},e._l(e.checkItemColumn,function(e,t){return i("el-table-column",{key:t,attrs:{prop:e.prop,label:e.label}})}),1)]],2),e._v(" "),i("el-dialog",{staticClass:"internalTransaction",attrs:{width:"80%",title:"内部交易汇总",visible:e.transactionDialogVisible,"before-close":e.handleTransactionDialogClose},on:{"update:visible":function(t){e.transactionDialogVisible=t}}},[i("transaction-summary",{ref:"transactionSummary"})],1),e._v(" "),i("el-dialog",{attrs:{title:"校验表(校验项=（A账面对B的资产合计-负债合计）+（B账面对A的资产合计-负债合计）)",visible:e.checkListTableShow,"before-close":e.closeCheckListShow,width:"90%","close-on-click-modal":!1},on:{"update:visible":function(t){e.checkListTableShow=t}}},[i("checkListTable",{ref:"checkListTable",attrs:{type:e.showBtnType},on:{closeShowInside:e.closeCheckListShow}}),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"info",size:"small"},on:{click:e.closeCheckListShow}},[e._v("关 闭")])],1)],1),e._v(" "),i("el-dialog",{attrs:{title:"生成内部交易抵销",visible:e.InternalFixedOffsetIsShow,"before-close":e.closeInternalFixedOffsetShow,width:"75%","close-on-click-modal":!1},on:{"update:visible":function(t){e.InternalFixedOffsetIsShow=t}}},[e.InternalFixedOffsetIsShow?i("internalFixedOffsetTable",{ref:"internalFixedOffsetTable",attrs:{type:e.showBtnType},on:{loadingFalse:e.loadingFalse,closeShowInside:e.closeInternalFixedOffsetShow}}):e._e(),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"info",size:"small"},on:{click:e.closeInternalFixedOffsetShow}},[e._v("关 闭")]),e._v(" "),i("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.internalFixedOffsetTableSave()}}},[e._v("保存后关闭")])],1)],1),e._v(" "),i("el-dialog",{attrs:{title:"现金流量表自动抵销汇总",visible:e.dialogVisible,width:"80%","before-close":e.handleClose},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("BdoTable",{attrs:{columns:e.mergeCashFlowSummaryColumn,data:e.mergeCashFlowSummaryData,"enable-filter":!1,"enable-toolbox":!1,"enable-view-type":!1,showCheckBox:!1,showIndexColumn:!1,responsiveHeightGap:180,exportReport:!1,setBorder:!0,queryConfig:e.queryOffsetSummaryConfig}})],1),e._v(" "),i("el-dialog",{attrs:{title:"成本法抵销",visible:e.costOffsettingIsShow,"before-close":e.closeCostOffsetting,width:"75%","destroy-on-close":"","close-on-click-modal":!1},on:{"update:visible":function(t){e.costOffsettingIsShow=t}}},[i("CostOffsetting",{ref:"costOffsettingModal",attrs:{type:e.showBtnType,childRow:e.childRow,childObj:e.childObj},on:{costOffsetFalse:e.costOffsetFalse,closeShowInside:e.closeCostOffsetting}}),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"info",size:"small"},on:{click:e.closeCostOffsetting}},[e._v("关 闭")]),e._v(" "),i("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.costOffsettingShow()}}},[e._v("保存后关闭")])],1)],1),e._v(" "),i("cost-offset",{ref:"costOffset",attrs:{roleList:e.roleList},on:{send:e.receiveEvent,chooseObj:e.chooseObj,refreshAutoOffsetTable:e.refreshAutoOffsetTable}})],1)])},staticRenderFns:[]};var ee=a("VU/8")(Z,K,!1,function(e){a("qnMx"),a("NqmM")},"data-v-4fa0420f",null);t.default=ee.exports},uK8n:function(e,t){},ySjk:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("mvHQ"),r=a.n(i),s=a("woOf"),o=a.n(s),n=a("pFYg"),l=a.n(n),c=a("ABj6"),u=a("ZHXk"),d=a.n(u),m=a("oGZU"),p=a.n(m),f={prop:"offsetEntry",components:{BdoTable:c.a},props:{curTbOffsetData:Array,singleProjectId:String,auditAjustmnetData:Array},watch:{auditAjustmnetData:{handler:function(e){e&&(this.curData=this.auditAjustmnetData,this.handleDataLength(),this.rowspan(0,"autoId"),this.rowspan(1,"indexId"))},immediate:!0,deep:!0}},data:function(){return{menuList:[],entryCategory:[],defaultProps:{children:"children",label:"label"},curMenuItem:{},isShowTable:!1,subtract:0,allAlign:"right",editDialogFormVisible:!1,tbOffsetColumn:[{label:"操作",prop:"autoId",width:"200px"},{label:"索引号",prop:"indexId",data:"indexId"},{label:"摘要",prop:"digest"},{label:"科目编号",prop:"tbSubjectCode"},{label:"科目名称",prop:"tbSubjectName"},{label:"附注科目",prop:"secondSubject"},{label:"借方金额",prop:"deb",align:"right",formatter:{type:"function",value:this.fixedNumber}},{label:"贷方金额",prop:"cre",align:"right",formatter:{type:"function",value:this.fixedNumber}},{label:"状态",prop:"activeFlag",formatter:{type:"function",value:this.activeFlagFormatter}},{label:"未调整原因",prop:"reason"},{label:"调整年份",prop:"yyyy"},{label:"项目名称",prop:"projectName",formatter:{type:"function",value:this.projectNameFn}}],spanArr:[],position:0,dataLenght:0,addDialogFormVisible:!1,addFormData:{style:"",object:""},addEditFormRule:{},formLabelWidth:"120px",addItemTableData:[],projectList:[],debDisabled:!1,creDisabled:!1,yearList:[],yyyy:"",isEdit:!1,editOrAddTitle:"新建分录",selectedSubjectName:"",selectOffsetObject:[],selectOffsetType:"",curRowIndex:-1,curRow:{},roleList:[],modelsDialogVisible:!1,changeModel:[],lastModelList:[],templateData:[],defaultPropsT:{children:"children",label:"label"},subjectNameList:[],tbSubjectNameValue:null,isNewAdjustForm:!1,curCustomerId:"",curProjectId:"",curYear:"",curData:[],editItemTableData:[],editTitle:"",activeRowBackOld:[]}},methods:{rowspan:function(e,t){var a=this;this.spanArr[e]=[],this.position=0,this.curData.forEach(function(i,r){0===r?(a.spanArr[e].push(1),a.position=0):a.curData[r][t]===a.curData[r-1][t]?(a.spanArr[e][a.position]+=1,a.spanArr[e].push(0)):(a.spanArr[e].push(1),a.position=r)}),this.spanArr[0]=this.spanArr[1];var i=0;for(var r in this.spanArr[0])this.spanArr[0][r]>0&&(i+=1,this.curData[r]&&this.$set(this.curData[r],"mergeCellOrder",i))},objectSpanMethod:function(e){e.row,e.column;for(var t=e.rowIndex,a=e.columnIndex,i=0;i<2;i++)if(a===i){var r=this.spanArr[i][t];return{rowspan:r,colspan:r>0?1:0}}},selectedAll:function(){var e=[];this.templateData.forEach(function(t){return e.push(t.label)}),this.$refs.tree.setCheckedKeys(e)},resetChecked:function(){var e=this;this.$nextTick(function(){e.$refs.tree.setCheckedKeys([])})},handleCellClick:function(e){var t=e.row,a=e.rowIndex;e.column,e.columnIndex;this.curRowIndex=a,this.curRow=t},editDialogActivedEvent:function(e){var t=e.row;e.column;Number(t.deb)?(this.creDisabled=!0,this.debDisabled=!1):this.creDisabled=!1,Number(t.cre)?(this.creDisabled=!1,this.debDisabled=!0):this.debDisabled=!1},editClosedEvent:function(e){var t=e.row,a=(e.rowIndex,e.column);-1!=String(t[a.property]).indexOf(",")&&(t[a.property]=t[a.property].replace(/,/gi,"")),t[a.property]=d.a.trim(t[a.property]),"cre"!=a.property&&"deb"!=a.property||(!t[a.property]||/^(-?[1-9]\d+|-?\d?)(\.\d+)?$/.test(t[a.property]))&&t[a.property]||(t[a.property]="0.00")},selectedYear:function(){var e=this;this.yearList.forEach(function(t){if(t.value==e.yyyy)return e.yyyy=t.label})},validSaveData:function(e){var t=this;if(0==this.subtract){var a=this.$refs.addItemTable.data,i=function(e){return Number(a[e].cre)||Number(a[e].deb)?!a[e].cre&&!a[e].deb||d.a.trim(a[e].tbSubjectName)?void(a[e].tbSubjectName&&t.subjectNameList.forEach(function(t){if(a[e].tbSubjectName==d.a.trim(t.label))return a[e].tbSubjectCode=t.value})):(t.$message.error("科目名称不能为空!"),{v:void 0}):(t.$message.error("无有效的可保存分录!"),{v:void 0})};for(var r in a){var s=i(r);if("object"===(void 0===s?"undefined":l()(s)))return s.v}this.saveOffSet(e,a)}else this.$message.error("差额必须为0才可以保存!")},saveOffSet:function(e,t){var a=this,i={yyyy:this.yyyy||this.curYear,projectId:this.singleProjectId,adjustType:1,arr:t};this.$sacpApis.offsetEntryAddSave(i).then(function(i){i.success?(a.hanldeSaveSuccess(e,t),a.$message.success("保存成功")):a.$message.error(i.resultInfo.statusText)}).catch(function(e){return a.$message.error(e)})},hanldeSaveSuccess:function(e,t){this.$refs.addItemTable.remove(),this.lastModelList=[],this.yyyy="",e?this.$refs.addItemTable.revertData():(this.addItemTableData.length=2,this.addItemTableData.forEach(function(e){d.a.clear(e,"")})),this.offsetEntryInit(),this.$refs.addItemTable.reloadData(this.addItemTableData)},editOffset:function(e,t,a){for(var i in this.editDialogFormVisible=!0,this.editItemTableData.length=0,this.curData)this.curData[i].indexId==a.indexId&&(this.curData[i].showLabel=this.curData[i].tbSubjectCode+"-"+this.curData[i].tbSubjectName,this.editItemTableData.push(this.curData[i]));this.editTitle="编辑审计调整列表:"+a.indexId},submitEditDialogForm:function(){var e=this;if(0==this.subtract){var t=this.$refs.editItemTable.data,a={yyyy:t[0].yyyy,projectId:t[0].projectId,adjustType:t[0].adjustType,arr:t};this.$sacpApis.offsetModifySave(a).then(function(t){t.success?(e.$message.success("保存成功"),e.editDialogFormVisible=!1,e.$refs.editItemTable.remove(),e.editItemTableData=[],e.offsetEntryInit(),e.$emit("isResetValid",!0)):e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)})}else this.$message.error("总金额存在差额,请修改")},closeEditDialog:function(){var e=this;this.$XModal.confirm("您确定要取消编辑吗?").then(function(t){"confirm"===t&&(e.editDialogFormVisible=!1,e.$refs.editItemTable.getUpdateRecords().length>0&&e.offsetEntryInit(),e.$refs.editItemTable.revertData(),e.$refs.editItemTable.remove())})},saveEditItem:function(){this.modelsDialogVisible=!1,this.$refs.tree.getCheckedNodes().forEach(function(e){e.tbSubjectName=e.label,delete e.label});var e=this.$refs.tree.getCheckedNodes().filter(function(e){return e.digest&&e.tbSubjectName});for(var t in e)!d.a.some(this.subjectNameList,function(a){return d.a.trim(a.label)===d.a.trim(e[t].tbSubjectName)})&&e.splice(t,1);if(1==e.length){this.addItemTableData=e.concat([{digest:"",tbSubjectName:"",deb:"",cre:""}])}else e.length?this.addItemTableData=e:(this.addItemTableData=[{digest:"",tbSubjectName:"",deb:"",cre:""},{digest:"",tbSubjectName:"",deb:"",cre:""}],this.$message("因没有对应的科目名称,有部分模板没有生成!"));this.$refs.addItemTable.remove()},delOffset:function(e){var t=this;this.$confirm("确定要删除这条数据吗？","确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.handleDelete(e)}).catch(function(e){})},handleDelete:function(e){var t=this,a={autoId:e.autoId};this.$sacpApis.offsetDelete(a).then(function(e){e.success?(t.$message.success("删除成功"),t.offsetEntryInit(),t.$emit("isResetValid",!0)):t.$message.error(e.resultInfo.statusText)}).catch(function(e){return t.$message.error(e)})},rowDisabled:function(e){var t=this;"0"==e.row.activeFlag?this.$confirm("确定要激活这条数据吗？","确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.hanldeInvalidOffsetData(e,"")}).catch(function(e){}):this.$confirm("确定要禁用这条数据吗？","确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.$prompt("请输入禁用理由","",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(a){var i=a.value;t.hanldeInvalidOffsetData(e,i)}).catch(function(){})}).catch(function(e){})},hanldeInvalidOffsetData:function(e,t){var a=this,i={autoId:e.row.autoId,reason:t};this.$sacpApis.invalidOffset(i).then(function(e){e.success?(a.$emit("isResetValid",!0),a.offsetEntryInit()):a.$message.error(e.resultInfo.statusText)}).catch(function(e){return a.$message.error(e)})},footerColspanMethod:function(e){e.columnIndex},footerMethod:function(e){var t=this,a=e.columns,i=e.data,r=[a.map(function(e,a){if(1===a)return"合 计";if(["deb","cre"].includes(e.property)){var r=void 0;for(var s in i)r=d.a.add(r,t.removeComafy(i[s][e.property]));return d.a.commafy(r,{digits:2})}return null})];return 5===a.length?this.subtract=d.a.commafy(d.a.subtract(this.removeComafy(r[0][3]),this.removeComafy(r[0][4])),{digits:2}):4===a.length&&(this.subtract=d.a.commafy(d.a.subtract(this.removeComafy(r[0][2]),this.removeComafy(r[0][3])),{digits:2})),r},removeComafy:function(e){return-1!=String(e).indexOf(",")&&(e=String(e).replace(/,/gi,"")),Number(e)},offsetEntryInit:function(){var e,t=this;e=this.singleProjectId,this.$sacpApis.queryOffsetList({customerId:this.curCustomerId,projectId:this.curProjectId,year:"",offsetType:1,value:null,mergeProject:e}).then(function(e){t.curData=e.data,e.data?(t.handleDataLength(),t.rowspan(0,"autoId"),t.rowspan(1,"indexId")):t.dataLenght=0}).catch(function(e){return t.$message.error(e)})},isRefreshDataLength:function(e){this.dataLenght=e},handleDataLength:function(){var e={},t=this.curData.reduce(function(t,a){return!e[a.indexId]&&(e[a.indexId]=t.push(a)),t},[]);this.dataLenght=t.length},setIcons:function(){p.a.setup({icon:{TABLE_EDIT:""}})},projectNameFn:function(e,t){return""+e.projectName},activeFlagFormatter:function(e,t){return"0"==t?"废弃":"1"==t?"有效":void 0},formatFixedNumber:function(e,t){var a=e.cellValue;return-1!=String(a).indexOf(",")&&(a=a.replace(/,/gi,"")),d.a.commafy(a,{digits:2})},fixedNumber:function(e,t){return d.a.commafy(t,{digits:2})},getSubjectNameList:function(){var e=this;this.$sacpApis.offsetEntrySubjectNameList().then(function(t){if(t.success){e.roleList=t.data;var a=[];t.data.forEach(function(e){return a=e.tb}),a&&a.map(function(e){e.showLabel=e.value+"-"+e.label}),e.subjectNameList=a}else e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)})},handleCurYear:function(){var e={value:"1",label:this.curYear},t={value:"2",label:this.curYear-1};this.yearList.push(e,t)},handleGetParmas:function(){var e=JSON.parse(sessionStorage.getItem("curCustomerData"));this.curCustomerId=e.curCustomerId,this.curProjectId=e.curProjectId,this.curYear=e.curYear,this.handleCurYear()},isRefresh:function(e){e&&this.offsetEntryInit()}},created:function(){this.handleGetParmas(),this.setIcons()}},h={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"mergeAuditAjustment"},[a("div",{staticClass:"tableClass"},[a("bdo-table",{ref:"offsetTable",attrs:{data:e.curData,"page-total":e.dataLenght,columns:e.tbOffsetColumn,"enable-filter":!1,"enable-toolbox":!1,"row-class-name":{id:"indexId"},"enable-view-type":!1,"span-method":e.objectSpanMethod,showIndexColumn:!0,showCheckBox:!1,setBorder:!0,exportReport:!1},on:{isRefreshDataLength:e.isRefreshDataLength,isRefresh:e.isRefresh},scopedSlots:e._u([{key:"col-autoId",fn:function(t){return[a("div",{staticClass:"buttonList"},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"编辑",placement:"top-start"}},[a("el-button",{attrs:{size:"small",type:"success",disabled:"0"==t.row.activeFlag,icon:"el-icon-edit-outline normalWeight"},on:{click:function(a){return e.editOffset(t.row.autoId,t.row.customerId,t.row)}}})],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"删除",placement:"top-start"}},[a("el-button",{attrs:{size:"small",type:"danger",disabled:"0"==t.row.activeFlag,icon:"el-icon-close normalWeight"},on:{click:function(a){return e.delOffset(t.row)}}})],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"1"==t.row.activeFlag?"禁用":"激活",placement:"top-start"}},[a("el-button",{attrs:{size:"small",icon:"1"==t.row.activeFlag?"el-icon-unlock normalWeight":"el-icon-lock normalWeight",type:"1"==t.row.activeFlag?"info":"danger"},on:{click:function(a){return e.rowDisabled(t)}}})],1)],1)]}}])})],1),e._v(" "),a("el-dialog",{attrs:{title:e.editTitle,visible:e.editDialogFormVisible,"before-close":e.closeEditDialog,width:"90%"},on:{"update:visible":function(t){e.editDialogFormVisible=t}}},[a("vxe-grid",{ref:"editItemTable",attrs:{border:"",height:"385",data:e.editItemTableData,"edit-config":{trigger:"click",mode:"cell"},"row-key":!0,"row-id":"stdAcctCode","show-footer":"","keep-source":"","footer-span-method":e.footerColspanMethod,"footer-method":e.footerMethod,"header-align":"center"},on:{"edit-actived":e.editDialogActivedEvent,"edit-closed":e.editClosedEvent}},[a("vxe-table-column",{attrs:{field:"digest",title:"摘要","edit-render":{name:"input",autoselect:!0}}}),e._v(" "),a("vxe-table-column",{attrs:{field:"showLabel",title:"科目名称"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return t.rowIndex,[a("el-input",{attrs:{disabled:""},model:{value:i.showLabel,callback:function(t){e.$set(i,"showLabel",t)},expression:"row.showLabel"}})]}}])}),e._v(" "),a("vxe-table-column",{attrs:{field:"showLabel",title:"附注科目"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return t.rowIndex,[a("el-input",{attrs:{disabled:""},model:{value:i.secondSubject,callback:function(t){e.$set(i,"secondSubject",t)},expression:"row.secondSubject"}})]}}])}),e._v(" "),a("vxe-table-column",{attrs:{title:"借方金额",field:"deb","edit-render":{name:"input",autoselect:!0,attrs:{disabled:e.debDisabled}},formatter:e.formatFixedNumber,align:e.allAlign,"header-align":"center"}}),e._v(" "),a("vxe-table-column",{attrs:{title:"贷方金额",field:"cre","edit-render":{name:"input",autoselect:!0,attrs:{disabled:e.creDisabled}},formatter:e.formatFixedNumber,align:e.allAlign,"header-align":"center"}})],1),e._v(" "),0!=e.subtract?a("div",{staticClass:"balance",staticStyle:{"text-align":"right",color:"red","padding-right":"20px"}},[e._v("\n            差 额:"+e._s(e.subtract)+"\n        ")]):e._e(),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"info",size:"small"},on:{click:e.closeEditDialog}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.submitEditDialogForm("addForm")}}},[e._v("保存后关闭")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"选择模板",visible:e.modelsDialogVisible,"destroy-on-close":!0,width:"80%"},on:{"update:visible":function(t){e.modelsDialogVisible=t}}},[a("el-tree",{ref:"tree",attrs:{data:e.templateData,"show-checkbox":"","default-expand-all":"","node-key":"label","highlight-current":"",props:e.defaultPropsT}}),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.selectedAll}},[e._v("全 选")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.resetChecked}},[e._v("清 空")]),e._v(" "),a("el-button",{attrs:{type:"info",size:"small"},on:{click:function(t){e.modelsDialogVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.saveEditItem()}}},[e._v("保 存")])],1)],1)],1)},staticRenderFns:[]};var g=a("VU/8")(f,h,!1,function(e){a("iFwk"),a("yoIW")},"data-v-0317cbc2",null).exports,b=(a("I/JX"),a("r9ye")),v=a("UGJx"),C=a("lCTB"),y=(a("0RKR"),a("K/T8"),"/Faith/contacts/index.html"),I={name:"mergeScopeIn",components:{BdoTable:c.a,tableType:b.a,AutoGenerationOffset:C.a},props:{tableData:Array},mixins:[v.a],data:function(){var e=this,t=function(e,t,a){""==t||isNaN(t)?a(new Error("请输入正确的数值")):!isNaN(t)&&(parseFloat(t).toFixed(2)<0||parseFloat(t).toFixed(2)>100)?a(new Error("请输入正确的数值")):a()};return{tableData1:[{}],multipleSelection:[],mergeFileVisible:!1,flag:"HB002-MC001",tab:[{label:"接受劳务",name:"5"},{label:"固定资产",name:"6"},{label:"无形资产",name:"7"}],mergeProjectId:"",activedFlage:"",mergeUploadDialogVisible:!1,excelName:"",mergeScopeEditDialogTableVisible:!1,formLabelWidth:"120px",mergeScopeEditFormData:{autoId:0,checkStatus:"",customerId:"",stockBreakRate:null,isUnitChildProject:"",mergeCustomerId:"",mergeCustomerName:"",mergeFinanceReportType:"",mergeProjectId:"",mergeProjectName:"",mergeScope:"",noteStatus:"",projectId:"",projectSource:"",reportStatus:"",shortName:"",trialBalanceStatus:"",equityRatio:null,preMergeProportion:null,curMergeProportion:null,causeDescription:"",uscc:"",incomeTaxRate:null,extractionRatio:null},mergeProjectNameList:[],mergeScopedEditFormRule:{mergeCustomerName:[{required:!0,message:"公司不能为空",trigger:"blur"}],stockBreakRate:[{required:!0,message:"认缴比例不能为空",trigger:"blur"},{validator:t,trigger:"change"}],equityRatio:[{required:!0,message:"权益比例不能为空",trigger:"blur"},{validator:t,trigger:"change"}],curMergeProportion:[{required:!0,message:"合并比例(本期)不能为空",trigger:"blur"},{validator:t,trigger:"change"}],preMergeProportion:[{required:!0,message:"合并比例(上期)不能为空",trigger:"blur"},{validator:t,trigger:"change"}],mergeProjectName:[{required:!0,message:"项目不能为空",trigger:"change"}],uscc:[{required:!0,message:"统一社会信用代码不能为空",trigger:"blur"}],incomeTaxRate:[{validator:t,trigger:"change"}],extractionRatio:[{validator:t,trigger:"change"}]},bodyHeight:0,customerId:"",projectId:"",differences:[],diffFlag:!1,columnsList:[{prop:"autoId",label:"操作",width:"230px",filterOptions:{disabled:!0}},{prop:"mergeCustomerName",label:"客户名称",width:"200px",filterOptions:{disabled:!0}},{prop:"shortName",label:"项目简称",width:"180px",filterOptions:{disabled:!0}},{prop:"uscc",label:"统一社会信用代码",filterOptions:{disabled:!0}},{prop:"incomeTaxRate",label:"所得税税率",filterOptions:{disabled:!0}},{prop:"extractionRatio",label:"母公司投资比例",filterOptions:{disabled:!0}},{prop:"extractionRatio",label:"提取比例",filterOptions:{disabled:!0}},{prop:"stockBreakRate",label:"认缴比例",width:"120px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtEquity}},{prop:"equityRatio",label:"权益比例",width:"120px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtEquity}},{prop:"curMergeProportion",label:"合并比例(本期)",width:"120px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtEquity}},{prop:"preMergeProportion",label:"合并比例(上期)",width:"120px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtEquity}},{prop:"mergeScope",label:"合并范围",miniWidth:"120px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtMergeScope}},{prop:"causeDescription",label:"原因说明",width:"120px",filterOptions:{disabled:!0}},{prop:"mergeProjectName",label:"项目名称",width:"180px",filterOptions:{disabled:!0}},{prop:"projectSource",label:"项目来源",width:"120px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtSource}},{prop:"trialBalanceStatus",label:"是否导入试算平衡表",width:"160px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtCheckStatus},fixed:"right"},{prop:"reportStatus",label:"是否导入报表",width:"160px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtCheckStatus},fixed:"right"},{prop:"noteStatus",label:"是否导入附注",width:"160px",flag:"a",disableToolbox:!0,filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtCheckStatus},fixed:"right"},{prop:"lastInitializationTimeDeal",label:"导入关联方交易汇总  ",width:"160px",flag:"a",disableToolbox:!0,filterOptions:{disabled:!0},formatter:{type:"function",value:this.formatterDate},fixed:"right"},{prop:"lastInitializationTimeContacts",label:"导入关联方对账",width:"160px",flag:"a",disableToolbox:!0,filterOptions:{disabled:!0},formatter:{type:"function",value:this.formatterDate},fixed:"right"},{prop:"lastInitializationTimeCashFlow",label:"导入关联方现流表对账",width:"160px",flag:"a",disableToolbox:!0,filterOptions:{disabled:!0},formatter:{type:"function",value:this.formatterDate},fixed:"right"}],tableDataList:[],mergeScope:1,uploadedCBData:{mergeProjectId:"",fileId:"",isParentNoteInfo:!1,fileType:""},dataLength:0,tableLoding:!1,fullscreenLoading:!1,queryConfig:function(t,a,i){e.fullscreenLoading=!0,e.$sacpApis.enterpriseList({customerId:e.curCustomerId,projectId:e.curProjectId,mergeScope:e.activeName,type:e.$constantVar.API_SACP_QUERY_COMPANY}).then(function(t){t.success&&(t.data.map(function(e){e.extractionRatio=parseFloat(100*e.extractionRatio).toFixed(2)+"%",e.incomeTaxRate=e.incomeTaxRate+"%"}),e.tableDataList=t.data,e.handleValidTotal())}).finally(function(){return e.fullscreenLoading=!1})},mergeScopeOptions:this.$DIC("合并范围"),projectSouce:this.$DIC("合并报表项目来源"),uploadFileList:[],uploadFileData:[],filedata:new FormData,setBorder:!0,validProjectTotal:0,passValid:0,failedValid:0,isShowProjectPanorama:!1,curCustomerId:"",curProjectId:"",curAccYear:"",menuId:"HB002-MC001",activeLabel:"",isInit:!0,auditAjustmnetData:[],adjustTableData:[],importFileName:"",importFilePath:"",selList:[],userDefined:"",oldTableData:{},showDebLabel:"",activeName:"1",oldActieRowData:{},causeDescription:"",causeDescriptionCache:"",haschangeMergeScope:!1,dialogTableVisible:!1,uploadFileListDialogTableVisible:!1,fileListColumns:[{prop:"autoId",label:"处理",width:"170px",fixed:!0,filterOptions:{disabled:!0}},{prop:"fileName",label:"文件名称",fixed:!0,filterOptions:{disabled:!0}},{prop:"uploadDate",label:"上传时间",fixed:!0,formatter:{type:"function",value:this.formatterDate},filterOptions:{disabled:!0}},{prop:"userName",label:"上传人",fixed:!0,filterOptions:{disabled:!0}}],fileList:[],uploadedData:{},dealVisible:!1,uploadDealFileList:[],dealParam:{},tabActive:"5",tabData:[],tabTitle:[],cuRmergeProjectId:5,contactData:[],transactionDialogVisible:!1,tabName:"5",curRow:{},tableColumns:[],mergeProjectName:"",ENV_ROUTE:y,uploadCashFlowStatementFileList:[],cashFlowStatementVisible:!1,viewCashFlowMerchantVisible:!1,viewCashFlowMerchantColumns:[],viewCashFlowMerchantData:[],viewCashFlowMerchantDataLength:0,diffDetailData:[]}},methods:{dialogTable:function(){if(0==this.uploadCashFlowStatementFileList.length)return this.$message.error("请先上传文件！"),!1;this.checkCashFlowMerchantFile()},toggleSelection:function(e){var t=this;e?e.forEach(function(e){t.$refs.multipleTable.toggleRowSelection(e)}):this.$refs.multipleTable.clearSelection()},handleSelectionChange:function(e){this.multipleSelection=e},downloadInternalTradingDataTemplate:function(){var e=this;this.$sacpApis.downloadInternalTradingDataTemplate({id:this.curRow.mergeProjectId}).then(function(e){e.success}).catch(function(t){e.$message.error()})},goAssociatedTransactionVoucherTable:function(e){var t="";t=window.location.protocol+"//"+window.location.host;var a=e.mergeProjectName.split("-")[1]?e.mergeProjectName.split("-")[1]:e.mergeProjectName.split("-")[0],i=e.mergeCustomerName.split("-")[1]?e.mergeCustomerName.split("-")[1]:e.mergeCustomerName.split("-")[0],s=sessionStorage.getItem("curCustomerData"),o=JSON.parse(s),n=o.curCustomerId,l=o.curProjectId,c=JSON.parse(r()(sessionStorage.getItem("menuID")));window.open(t+y+"#/associatedTransactionVoucherTable?type=true&curCustomerId="+e.mergeCustomerId+"&curCustomerName="+i+"&preProjectId="+e.mergeProjectId+"&curProjectName="+a+"&mergeProjectId="+l+"&mergeCustomerId="+n+"&menuID="+c)},internalTransaction:function(e){var t="";t=window.location.protocol+"//"+window.location.host;var a=e.mergeProjectName,i=e.mergeCustomerName,s=e.mergeCustomerId,o=e.mergeProjectId,n=a.split("-"),l=i.split("-"),c=n[1]?n[1]:n[0],u=l[1]?l[1]:l[0],d=t+y+"#/index",m=sessionStorage.getItem("curCustomerData"),p=JSON.parse(m),f=p.curCustomerId,h=p.curProjectId,g=p.curYear,b={type:!0,curCustomerId:s,curCustomerName:u,curProjectId:o,curProjectName:c,mergeProjectId:h,mergeCustomerId:f,menuID:JSON.parse(r()(sessionStorage.getItem("menuID"))),curAccYear:g,mergeProjectName:a,mergeCustomerName:i,active:5};window.sessionStorage.setItem("mergeQuery",r()(b)),window.open(d)},cashFlowStatement:function(e){var t="";t=window.location.protocol+"//"+window.location.host;var a=e.mergeProjectName,i=e.mergeCustomerName,s=e.mergeCustomerId,o=e.mergeProjectId,n=a.split("-"),l=i.split("-"),c=n[1]?n[1]:n[0],u=l[1]?l[1]:l[0],d=t+"/Faith/auditReport/index.html#/index",m=sessionStorage.getItem("curCustomerData"),p=JSON.parse(m),f=p.curCustomerId,h=p.curProjectId,g=p.curYear,b=JSON.parse(r()(sessionStorage.getItem("menuID")));window.open(d+"?type=true&curCustomerId="+s+"&curCustomerName="+u+"&curProjectId="+o+"&curProjectName="+c+"&mergeProjectId="+h+"&mergeCustomerId="+f+"&menuID="+b+"&curAccYear="+g+"&mergeProjectName="+a+"&mergeCustomerName="+i+"&active=5")},downloadFileMerge:function(){var e={param1:this.curRow.mergeProjectId};this.$sacpApis.downloadContactsImportTemplate(e,"内部往来数据导入模板.xlsx")},importFileFun:function(e){var t=this,a={param1:r()(e)};this.$sacpApis.parseInternalTransactionDocuments(a).then(function(e){e.success?(t.$message.success("导入成功"),t.mergeFileVisible=!1,t.mergeScopeInit()):t.$message.error(e.resultInfo.statusText)}).catch(function(e){return t.$message.error(e)}).finally(function(){t.uploadFileRemove(),t.fullscreenLoading=!1})},updataEnter:function(){var e=this;if(!this.uploadFileData||!this.uploadFileData.length)return this.$message.error("请上传文件!");this.filedata=new FormData,this.uploadFileData.map(function(t,a){e.filedata.append("file"+a,t)}),this.fullscreenLoading=!0,this.filedata.append("mergeProjectId",this.uploadedData.mergeProjectId),this.$sacpApis.bulkUpload(this.filedata).then(function(t){if(e.uploadFileRemove(),t.success)e.importFileFun(t.data[0]),e.queryConfig();else{var a=t.resultInfo.statusText;e.$message.error(a)}}).catch(function(t){return e.$message.error(t)}).finally(function(){e.uploadFileRemove(),e.fullscreenLoading=!1})},checkCashFlowMerchantFile:function(){var e=this,t=new FormData;t.append("file",this.uploadCashFlowStatementFileList[0]),this.$sacpApis.bulkUpload(t).then(function(t){if(t.success)e.importFileName=t.data[0].name,e.importFilePath=t.data[0].path,e.checkCashFlowMerchantOK();else{var a=t.resultInfo.statusText;e.$message.error(a)}}).catch(function(t){return e.$message.error(t)}).finally(function(){})},checkCashFlowMerchantOK:function(){var e=this,t=this.curRow,a=t.mergeCustomerId,i=t.mergeProjectId,r={customerId:t.customerId,projectId:t.projectId,mergeCustomerId:a,mergeProjectId:i,fileId:[{path:this.importFilePath,name:this.importFileName}]};this.$sacpApis.checkCashFlowMerchantFile(r).then(function(t){if(t.success){if(e.$message.success("上传成功!"),0===t.data[0].list.length){e.merChantFile([])}}else{var a=t.resultInfo.statusText;e.$message.error(a)}}).catch(function(e){}).finally(function(){})},merChantFile:function(e){var t=this;if(0===e.length){var a=this.curRow,i=a.mergeCustomerId,r=a.mergeProjectId,s={customerId:a.customerId,projectId:a.projectId,mergeCustomerId:i,mergeProjectId:r,fileId:[{path:this.importFilePath,name:this.importFileName}],projects:e};this.$sacpApis.importCashFlowMerchantFile(s).then(function(e){t.cashFlowStatementVisible=!1}).catch(function(e){}).finally(function(){})}},checkCashFlowMerchante:function(){var e=this;this.$sacpApis.checkCashFlowMerchant({projectId:this.projectId,menuId:this.projectId,customerId:this.customerId}).then(function(t){e.statusData=t.data[0].list}).catch(function(e){}).finally(function(){})},updataDealEnter:function(){var e=this;if(!this.uploadDealFileList||!this.uploadDealFileList.length)return this.$message.error("请上传文件!");this.fullscreenLoading=!0,this.filedata=new FormData,this.uploadDealFileList.map(function(t,a){e.filedata.append("file"+a,t)}),this.$sacpApis.bulkUpload(this.filedata).then(function(t){if(t.success)e.$message.success("上传成功!"),setTimeout(function(){e.fullscreenLoading=!1},2e3),e.dealVisible=!1,e.dealParam.jsonData=r()(t.data[0]),e.saveImportedInternalTradingData(),e.queryConfig();else{var a=t.resultInfo.statusText;e.$message.error(a)}}).catch(function(t){return e.$message.error(t)}).finally(function(){setTimeout(function(){e.fullscreenLoading=!1},2e3)})},saveImportedInternalTradingData:function(){var e=this;this.$sacpApis.saveImportedInternalTradingData(this.dealParam).then(function(t){if(t.success);else{var a=t.resultInfo.statusText;e.$message.error(a)}}).catch(function(t){return e.$message.error(t)}).finally(function(){})},importFileMerge:function(e){this.curRow=e.row,this.uploadedData.mergeProjectId=e.row.mergeProjectId,this.mergeFileVisible=!0,this.uploadFileData=[]},importDealData:function(e){this.curRow=e.row;var t=e.row,a=t.mergeCustomerId,i=t.mergeProjectId,r=t.mergeCustomerName,s=t.mergeProjectName;this.dealParam={param1:a,param2:i,param3:r,param4:s},this.dealVisible=!0,this.uploadDealFileList=[]},uploadFileRemove:function(e,t){this.uploadFileData=[]},uploadFileChange:function(e,t){this.uploadFileData.push(e.raw)},uploadDealFileRemove:function(e,t){this.uploadDealFileList=[]},uploadDealFileChange:function(e,t){this.uploadDealFileList.push(e.raw)},uploadClose:function(){this.uploadedData.mergeProjectId="",this.mergeFileVisible=!1,this.uploadFileData=[]},uploadDealClose:function(){this.dealVisible=!1,this.uploadDealFileList=[]},fillChangeMergeScopeReason:function(){return this.mergeScopeEditFormData.curMergeProportion&&(this.mergeScopeEditFormData.curMergeProportion>50&&"0"===this.mergeScopeEditFormData.mergeScope||this.mergeScopeEditFormData.curMergeProportion<=50&&"1"===this.mergeScopeEditFormData.mergeScope)?(this.haschangeMergeScope=!0,this.mergeUploadDialogVisible=!0,!1):(this.haschangeMergeScope=!1,this.mergeUploadDialogVisible=!1,!0)},handleReviewUploadFile:function(e){var t=this;this.uploadFileListDialogTableVisible=!0,this.fullscreenLoading=!0,this.$sacpApis.hbMergeProjectQueryHbFile({jsonData:r()({mergeProjectId:e.row.mergeProjectId})}).then(function(e){e.success?t.fileList=e.data||[]:t.$message.error(e.resultInfo.statusText)}).catch(function(e){return t.$message.error(e)}).finally(function(){t.fullscreenLoading=!1})},reviewFile:function(e){if(!e.row.fileName||e.row.fileName.indexOf(".xlsx")>-1||e.row.fileName.indexOf(".zip")>-1)return this.$message.error("预览功能仅支持图片和PDF类型文件!");var t=this.$router.resolve({name:"PreviewPdf",query:{randomNum:e.row.autoId}}).href;window.open(t,"_blank")},deleteFile:function(e){var t=this;this.fullscreenLoading=!0,this.$sacpApis.deleteAttachment(e.row.autoId).then(function(a){a.success?t.$message.success("删除成功!")&&t.handleReviewUploadFile(e):t.$message.error(a.resultInfo.statusText)}).catch(function(e){return t.$message.error(e)}).finally(function(){t.fullscreenLoading=!1})},downloadFile:function(e){var t=window.location.origin+"/Faith/dgCenter/HbMergeProject.downloadAttachment.json?param1="+e.row.autoId;window.open(t,"_blank")},handleInitData:function(e){var t=this,a="";a=e.row.hasChildAdjust?"初始化子公司数据会删除子公司的试算平衡表、审定报表，确认要初始化吗？":"初始化子公司数据会删除子公司的试算平衡表、审定报表、子公司审计调整数据，确认要初始化吗？",this.$confirm(a,"确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.row.hasChildAdjust?t.$confirm("是否保留分录","确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.confirmInitData(e,!0)}).catch(function(){return t.confirmInitData(e,!1)}):t.confirmInitData(e,!1)}).catch(function(e){})},diffShow:function(e){var t=this;this.diffFlag=!0;this.$sacpApis.getDiffChildDetail({mergeProjectId:2020043047,type:0}).then(function(e){e.data&&(t.diffDetailData=e.data[0])}).catch(function(e){return t.$message.error(e)}).finally(function(){return t.fullscreenLoading=!1})},closeDiffDialog:function(){this.diffFlag=!1},commafyFn:function(e){var t=e.cellValue;e.row,e.column;return d.a.commafy(t,{digits:2})},cellClassName:function(e){var t=e.row,a=e.column;return"auditAmount"===a.property&&t.auditAmount!==t.preAuditAmount?"col-red":"preAuditAmount"===a.property&&t.auditAmount!==t.preAuditAmount?"col-red":void 0},confirmInitData:function(e,t){var a=this;this.fullscreenLoading=!0;var i={mergeProjectId:e.row.mergeProjectId,retainChildAdjust:t};this.$sacpApis.getInitSingleCompanyData(i).then(function(e){e.success?(a.$message.success("初始化数据成功!"),a.$eventBus.$emit("page-refresh",e.resultInfo.refreshIndexes)):a.$message.error(e.resultInfo.statusText)}).catch(function(e){return a.$message.error(e)}).finally(function(){return a.fullscreenLoading=!1})},uploadChange:function(e,t){if(this.uploadFileList.some(function(t){return t.name==e.name}))return this.$message.warning("不可以重复上传相同文件名文件,请删除!");this.uploadFileList.push(e.raw)},causeDescriptionChange:function(e){this.causeDescriptionCache=this.causeDescription},confirUpload:function(){var e=this;if(0==this.uploadFileList.length||!this.uploadFileList.length)return this.$message.error("请上传文件!");if(this.filedata=new FormData,this.uploadFileList.map(function(t,a){e.filedata.append("file"+a,t)}),this.haschangeMergeScope){if(!this.causeDescription.trim())return this.$message.error("请填写说明原因!");this.handleUplaodReasonFile()}else this.handleUploadSuccess()},handleUplaodReasonFile:function(){var e=this;this.fullscreenLoading=!0,this.filedata.append("mergeProjectId",this.mergeScopeEditFormData.mergeProjectId),this.$sacpApis.hbMergeProjectBatchUploadbulkUpload(this.filedata).then(function(t){if(t.success)e.$message.success("上传成功!"),setTimeout(function(){e.fullscreenLoading=!1},2e3);else{var a=t.resultInfo.statusText;e.$message.error(a)}}).catch(function(t){return e.$message.error(t)}).finally(function(){e.clearUploadData(),e.mergeUploadDialogVisible=!1,e.causeDescription="",e.dialogVisible=!1,e.haschangeMergeScope=!1,setTimeout(function(){e.fullscreenLoading=!1},2e3)})},handleUploadSuccess:function(){var e=this;this.fullscreenLoading=!0,this.$sacpApis.bulkUpload(this.filedata).then(function(t){if(t.success)setTimeout(function(){e.fullscreenLoading=!1},2e4),e.uploadSuccessCB(t.data);else{var a=t.resultInfo.statusText;e.$message.error(a)}}).catch(function(t){return e.$message.error(t)}).finally(function(){e.clearUploadData(),e.mergeUploadDialogVisible=!1,e.causeDescription="",e.dialogVisible=!1,setTimeout(function(){e.fullscreenLoading=!1},2e3)})},clearUploadData:function(){this.$refs.uploadExcel;this.excelFile="",this.excelName="",this.uploadFileList=[],this.filedata=new FormData,this.causeDescription=""},uploadSuccessCB:function(e){var t=this;this.uploadedCBData.fileId=e,this.$sacpApis.mergeScopeUploadCB(this.uploadedCBData).then(function(e){e.success?(t.$message.success("上传成功"),t.$eventBus.$emit("page-refresh",e.resultInfo.refreshIndexes)):t.$message.error(e.resultInfo.statusText)}).catch(function(e){t.$message.error(e)}).finally(function(){t.haschangeMergeScope=!1})},beforeRemove:function(e,t){this.uploadFileList=this.uploadFileList.filter(function(t){return t.name!=e.name})},cancelUpload:function(){this.mergeUploadDialogVisible=!1,this.uploadFileList=[],this.causeDescription="",this.causeDescriptionCache=""},handleMergeScopeProject:function(e){if(e){var t=this.mergeProjectNameList.filter(function(t){return t.projectid==e});this.mergeScopeEditFormData.mergeProjectId=t[0].projectid,this.mergeScopeEditFormData.mergeProjectName=t[0].projectname}},clearMergeProjectName:function(){this.$set(this.mergeScopeEditFormData,"mergeProjectName",""),this.$set(this.mergeScopeEditFormData,"mergeProjectId","")},submitEditDialogForm:function(e){var t=this;if(this.haschangeMergeScope&&!this.causeDescriptionCache)return this.fillChangeMergeScopeReason();this.mergeScopeEditFormData.causeDescription=this.causeDescriptionCache?this.causeDescriptionCache:this.mergeScopeEditFormData.causeDescription,this.$refs[e].validate(function(a){if(a){var i=JSON.parse(r()(t.mergeScopeEditFormData));i.extractionRatio=(Math.round(parseFloat(100*i.extractionRatio))/1e4).toFixed(4),t.$sacpApis.mergeScopeEditSave(i).then(function(a){a.success?(t.oldActieRowData.mergeScope!=t.mergeScopeEditFormData.mergeScope&&t.$store.commit("setRemoveAliveList","mergeScopeOut"),t.$eventBus.$emit("page-refresh",a.resultInfo.refreshIndexes),t.$message.success("编辑成功"),t.$refs[e].resetFields(),t.mergeScopeEditDialogTableVisible=!1,t.mergeScopeInit()):t.$message.error(a.resultInfo.statusText)}).catch(function(e){t.$message.error(e)}).finally(function(){t.causeDescription=""})}})},fmtProject:function(e,t){return e.mergeProjectId||e.mergeProjectName?-1!=e.mergeProjectName.indexOf("-")?e.mergeProjectName:e.mergeProjectId+"-"+e.mergeProjectName:"-"},fmtCheckStatus:function(e,t){switch(t){case"1":return"√";default:return"×"}},fmtEquity:function(e,t){return t+"%"},fmtMergeScope:function(e,t){switch(t){case"1":return"合并范围内";default:return"合并范围外且是关联方"}},fmtSource:function(e,t){switch(t){case"1":return"SACP";case"2":return"PM";case"3":return"非SACP报表审计";case"4":return"非SACP的BDO境外审计";case"5":return"非SACP其他事务所审计"}},editProject:function(e){this.haschangeMergeScope=!1,this.oldActieRowData=e,this.mergeProjectNameList=[];var t=this.mergeScopeEditFormData;this.mergeScopeEditDialogTableVisible=!0,t.autoId=e.autoId,t.checkStatus=e.checkStatus,t.customerId=e.customerId,t.stockBreakRate=e.stockBreakRate,t.mergeCustomerId=e.mergeCustomerId,t.mergeCustomerName=e.mergeCustomerName,t.mergeFinanceReportType=e.mergeFinanceReportType,t.mergeProjectId=e.mergeProjectId,t.mergeProjectName=e.mergeProjectName,t.isUnitChildProject=e.isUnitChildProject,t.mergeScope=e.mergeScope,t.noteStatus=e.noteStatus,t.projectSource=e.projectSource,t.reportStatus=e.reportStatus,t.shortName=e.shortName,t.trialBalanceStatus=e.trialBalanceStatus,t.equityRatio=e.equityRatio,t.curMergeProportion=e.curMergeProportion,t.preMergeProportion=e.preMergeProportion,e.incomeTaxRate=e.incomeTaxRate.replace("%",""),t.incomeTaxRate=e.incomeTaxRate,e.extractionRatio=e.extractionRatio.replace("%",""),t.extractionRatio=Math.round(parseFloat(100*e.extractionRatio).toFixed(2))/100,t.uscc=e.uscc,t.projectId=this.curProjectId,this.getProjectNameList(t.mergeCustomerId)},delProject:function(e,t,a){var i=this,r={autoIds:e};this.$sacpApis.mergeScopeDelete(r).then(function(e){e.success?(i.$message.success("删除成功"),i.mergeScopeInit(),i.$eventBus.$emit("page-refresh",e.resultInfo.refreshIndexes)):i.$message.error(e.resultInfo.statusText)}).catch(function(e){i.$message.error(e)})},openView:function(e,t){switch(t){case"QUERY_TB":if("1"!==e.trialBalanceStatus)return void this.$message("试算平衡表未导入！");var a="";a=-1!=e.mergeProjectName.indexOf("-")?e.mergeProjectName:e.mergeProjectId+"-"+e.mergeProjectName;var i={customerId:e.customerId,mergeCustomerName:e.mergeCustomerName,projectId:a,type:t,curYear:this.curAccYear,mergeCustomerId:e.mergeCustomerId};sessionStorage.setItem("projectItem",r()(i)),this.checkTb(i);break;case"QUERY_REPORT":if("1"!==e.reportStatus)return void this.$message("审定报表未导入！");a="";a=-1!=e.mergeProjectName.indexOf("-")?e.mergeProjectName:e.mergeProjectId+"-"+e.mergeProjectName;i={customerId:e.customerId,mergeCustomerName:e.mergeCustomerName,projectId:a,type:t,curYear:this.curAccYear,mergeCustomerId:e.mergeCustomerId};sessionStorage.setItem("projectItem",r()(i)),this.checkReport(i);break;case"note":if("0"===e.noteStatus)return void this.$parent.$message("附注未导入！");a="";a=-1!=e.mergeProjectName.indexOf("-")?e.mergeProjectName:e.mergeProjectId+"-"+e.mergeProjectName;i={customerId:e.customerId,mergeCustomerName:e.mergeCustomerName,projectId:a,type:"",mergeCustomerId:e.mergeCustomerId};sessionStorage.setItem("projectItem",r()(i)),this.checkNote(i)}},checkTb:function(e){var t=this.$router.resolve({path:"/checkTb",query:{curYear:e.curYear,menuID:"HB002-MC004-0001"}}).href;window.open(t,"_blank")},checkReport:function(e){var t=this.$router.resolve({path:"/checkReport",query:{curYear:e.curYear,menuID:"HB002-MC005-001"}}).href;window.open(t,"_blank")},checkNote:function(e){var t=this.$router.resolve({path:"/checkNote",query:{curYear:e.curYear}}).href;window.open(t,"_blank")},calcTaskProgress:function(e,t){return t?Math.round(e/t*100):0},importFile:function(e){this.uploadedCBData.mergeProjectId=e.row.mergeProjectId,this.mergeUploadDialogVisible=!0,this.uploadFileList=[],this.causeDescription="",this.haschangeMergeScope=!1},reload:function(){this.$refs.table.reload()},getProjectNameList:function(e){var t=this,a={customerId:e};this.$sacpApis.reachProjectInfo(a).then(function(e){e.success?e.data&&e.data.find(function(e){var a={projectid:e.projectId,projectname:e.ProjectName};t.mergeProjectNameList.push(a)}):t.$message.error(e.resultInfo.statusText)}).catch(function(e){t.$message.error(e)})},isRefreshDataLength:function(e){this.dataLength=e},handleValidTotal:function(){var e=this;this.$sacpApis.mergeScopeValidTotal({activeName:this.activeName}).then(function(t){if(t.success){var a=t.data[0],i=a.checkPassNumber,r=a.checkFailureNumber,s=a.projectSize,o=a.directionStatusCheck;e.passValid=i,e.failedValid=r,e.validProjectTotal=s,e.$emit("dialogState",o)}else e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)}).finally()},handleCurstomerId:function(){var e=JSON.parse(sessionStorage.getItem("curCustomerData"));this.curCustomerId=e.curCustomerId,this.curProjectId=e.curProjectId,this.curAccYear=e.curYear},mergeScopeInit:function(){var e=this;this.fullscreenLoading=!0,this.$sacpApis.enterpriseList({customerId:this.curCustomerId,projectId:this.curProjectId,mergeScope:this.activeName}).then(function(t){t.success?t.data?(t.data.map(function(e){e.extractionRatio=parseFloat(100*e.extractionRatio)+"%",e.incomeTaxRate=e.incomeTaxRate+"%"}),e.tableDataList=t.data,e.dataLength=e.tableDataList.length,e.handleValidTotal()):e.dataLength=0:e.$message.error(t.resultInfo.statusText)}).catch(function(t){e.$message.error(t)}).finally(function(){e.fullscreenLoading=!1,e.$store.commit("setMergeScopeRefresh",!1)})},formatterDate:function(e,t){return d.a.toDateString(t,"yyyy-MM-dd HH:mm:ss")},hasChildAdjust:function(){if(this.tableDataList&&this.tableDataList.length)return this.tableDataList.some(function(e){return e.hasChildAdjust})},deleteOldContactsData:function(e){var t=this;this.$confirm("是否要删除子公司关联方交易汇总  ？","确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.fullscreenLoading=!0,t.$sacpApis.deleteOldContactsData({param1:e.mergeProjectId}).then(function(e){e.success?(t.$message.success("删除成功!"),t.queryConfig()):t.$message.error(e.resultInfo.statusText)}).catch(function(e){t.$message.error(e)}).finally(function(){t.fullscreenLoading=!1})}).catch(function(e){})},deleteOldTransactionData:function(e){var t=this;this.$confirm("是否要删除该条往来数据？","确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.fullscreenLoading=!0,t.$sacpApis.deleteOldTransactionData({param1:e.mergeProjectId}).then(function(e){e.success?(t.fullscreenLoading=!1,t.$message.success("删除成功!"),t.queryConfig()):t.$message.error(e.resultInfo.statusText)}).catch(function(e){t.$message.error(e)}).finally(function(){t.fullscreenLoading=!1})}).catch(function(e){})},clearCashFlowMerchantFile:function(e){var t=this;this.$confirm("是否删除该子公司项目所有现流表关联方对账？","确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.fullscreenLoading=!0;var a=e.mergeCustomerId,i=e.mergeProjectId,r={customerId:e.customerId,projectId:e.projectId,mergeCustomerId:a,mergeProjectId:i};t.$sacpApis.clearCashFlowMerchant(r).then(function(a){a.success?(t.$message.success("删除成功!"),e.lastInitializationTimeCashFlow=""):t.$message.error(a.resultInfo.statusText)}).catch(function(e){t.$message.error(e)}).finally(function(){t.fullscreenLoading=!1})}).catch(function(e){})},querySingleInsideTransactionSummaryData:function(e){var t=this;this.transactionDialogVisible=!0,e&&e.row&&(this.cuRmergeProjectId=e.row.mergeProjectId);var a={param1:this.tabActive,param2:this.cuRmergeProjectId};this.$sacpApis.querySingleInsideTransactionSummaryData(a).then(function(e){e.success?t.tabData=e.data:t.$message.error(e.resultInfo.statusText)}).catch(function(e){t.$message.error(e)}).finally(function(){t.fullscreenLoading=!1})},queryMerchantInsideClassify:function(e){var t=this;this.transactionDialogVisible=!0,this.mergeProjectId=e.mergeProjectId,this.mergeProjectName=e.mergeProjectName,this.$sacpApis.queryMerchantInsideClassify().then(function(a){a.success?(t.tableColumns=a.data,t.$nextTick(function(){t.$refs.tableType.tabItemList(a.data,e.mergeProjectId)})):t.$message.error(a.resultInfo.statusText)}).catch(function(e){t.$message.error(e)}).finally(function(){t.fullscreenLoading=!1})},queryContactSummary:function(e){var t=this;this.$nextTick(function(){t.$refs.autoGenerationOffsetTable.queryContactSummary(e.row.mergeProjectId,e.row.shortName)})},handleClose:function(e){this.transactionDialogVisible=!1},importRelatedParty:function(e){this.curRow=e.row,this.cashFlowStatementVisible=!0,this.uploadCashFlowStatementFileList=[]},uploadCashFlowStatementClose:function(){this.cashFlowStatementVisible=!1,this.uploadCashFlowStatementFileList=[]},uploadcashFlowStatementFileRemove:function(e,t){this.uploadCashFlowStatementFileList=[]},uploadcashFlowStatementFileChange:function(e,t){this.uploadCashFlowStatementFileList.push(e.raw)},downCashFlowMerchantFileTemp:function(){var e=this,t=this.curRow,a=t.mergeCustomerId,i=t.mergeProjectId,r={customerId:t.customerId,projectId:t.projectId,mergeCustomerId:a,mergeProjectId:i};this.$sacpApis.downCashFlowMerchantFileTemp(r,"关联方现流表对账").then(function(e){e.success}).catch(function(t){e.$message.error()})},updataCashFlowStatementEnter:function(){var e=this;if(!this.uploadCashFlowStatementFileList||!this.uploadCashFlowStatementFileList.length)return this.$message.error("请上传文件!");this.fullscreenLoading=!0,this.filedata=new FormData,this.uploadCashFlowStatementFileList.map(function(t,a){e.filedata.append("file"+a,t)}),this.$sacpApis.bulkUpload(this.filedata).then(function(t){if(t.success)e.fullscreenLoading=!1,e.importCashFlowMerchantFile(t.data);else{var a=t.resultInfo.statusText;e.$message.error(a)}}).catch(function(t){return e.$message.error(t)}).finally(function(){e.fullscreenLoading=!1,e.cashFlowStatementVisible=!1})},importCashFlowMerchantFile:function(e){var t=this,a=this.curRow,i=a.mergeCustomerId,r=a.mergeProjectId,s={customerId:a.customerId,projectId:a.projectId,mergeCustomerId:i,mergeProjectId:r,fileId:e};this.$sacpApis.importCashFlowMerchantFile(s).then(function(e){e.success?(t.$message.success("上传成功!"),t.cashFlowStatementVisible=!1,t.queryConfig()):t.$message.error(e.resultInfo.statusText)}).catch(function(e){return t.$message.error(e)}).finally(function(){t.cashFlowStatementVisible=!1})},importFiles:function(e,t){this[e.trim()](t)},looks:function(e,t){this[e.trim()](t.row)},viewCashFlowMerchant:function(e){var t=this;this.fullscreenLoading=!0,e&&(this.curRow=e),this.viewCashFlowMerchantVisible=!0;var a=this.curRow,i=a.mergeCustomerId,r=a.mergeProjectId,s=a.customerId,o=a.projectId,n=a.mergeProjectName;this.mergeProjectName=n;var l={customerId:s,projectId:o,mergeCustomerId:i,mergeProjectId:r};this.$sacpApis.viewCashFlowMerchant(l).then(function(e){if(e.success){var a=e.data[0];if(e.data&&a&&a.list){var i=a.customerNameList,r=[{prop:"colDisp",label:"项目","min-width":"270px"}];for(var s in i[0])s.search("mergeCustomerName")>-1&&r.push({label:i[0][s],prop:"amount"+s.split("mergeCustomerName")[1],align:"right","min-width":"200px",formatter:{type:"function",value:t.commafy}});r.push({prop:"sumAmount",label:"合计",align:"right","min-width":"130px",formatter:{type:"function",value:t.commafy}}),t.viewCashFlowMerchantColumns=r,a.list.forEach(function(e){e.colDisp=e.colDisp?e.colDisp.replaceAll(" "," "):""}),t.viewCashFlowMerchantData=a.list,t.viewCashFlowMerchantDataLength=a.list.length}else t.viewCashFlowMerchantData=[]}else t.$message.error(e.resultInfo.statusText)}).catch(function(e){t.$message.error(e)}).finally(function(){t.fullscreenLoading=!1})},isRefreshviewCashFlowMerchantDataLength:function(e){this.viewCashFlowMerchantDataLength=e},handLeviewCashFlowMerchantClose:function(){this.viewCashFlowMerchantVisible=!1},commafy:function(e,t){return d.a.commafy(t,{digits:2})},queryViewCashFlowMerchant:function(){this.viewCashFlowMerchant()},cellStyle:function(){return{"white-space":"pre"}},exportFile:function(){this.exportExcel()},getChildTbData:function(){var e=this;this.$sacpApis.getCheckChildTbData({customerId:this.curCustomerId,projectId:this.curProjectId}).then(function(t){var a="";if(t.data)for(a in t.data[0])e.differences.push(a);return e.differences})},exportExcel:function(){var e=this,t={param1:this.curCustomerId,param2:this.curProjectId,param3:this.activeName,type:this.$constantVar.API_SACP_QUERY_COMPANY,queryUrl:"dgCenter/HbMergeProject.enterpriseList.json",columnMap:[]};this.columnsList.forEach(function(e,a){a>0&&t.columnMap.push({cnName:e.label,enName:e.prop,size:e.width?e.width.replace("px",""):"",className:e.align?"text-"+e.align:"text-left",renderer:"mergeScope"===e.prop?"getDicLabelByVal|"+e.label:""})});var a={myParams:r()(t),title:window.encodeURI("合并范围内.xlsx")};this.$sacpApis.exportExcel(a,"合并范围内.xlsx").then(function(t){t.success?e.$message.success("下载成功!"):e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)}).finally(function(){})}},activated:function(){var e=this;this.$eventBus.$off("click-tab").$on("click-tab",function(t){t&&t.indexId===e.flag&&t.isMark&&e.mergeScopeInit()})},created:function(){this.handleCurstomerId(),this.selList=this.$DIC("借贷"),this.mergeScopeOptions=this.$DIC("合并范围"),this.getChildTbData()}},x={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"mergeScopeIn"},[a("bdo-table",{ref:"table",attrs:{columns:e.columnsList,"enable-filter":!1,"enable-toolbox":!1,"enable-view-type":!1,data:e.tableDataList,"page-total":e.dataLength,"responsive-height-gap":e.bodyHeight,showIndexColumn:!1,showCheckBox:!1,tableLoding:e.tableLoding,queryConfig:e.queryConfig,setBorder:e.setBorder,exportReport:!1},on:{isRefreshDataLength:e.isRefreshDataLength,exportFile:e.exportFile},scopedSlots:e._u([{key:"col-mergeCustomerName",fn:function(t){return[e._v("\n            "+e._s(t.row.mergeCustomerName)+"\n            "),"1"==t.row.isUnitChildProject?a("span",{staticStyle:{color:"rgb(230 162 60)",display:"inline-block",padding:"0px 5px",background:"rgb(253 246 236)",border:"1px solid #ccc","border-radius":"5px"}},[e._v("\n                母公司")]):e._e()]}},{key:"col-autoId",fn:function(t){return[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"编辑",placement:"top-start"}},[a("el-button",{staticClass:"editBtnCol",attrs:{size:"small",type:"text",icon:"el-icon-edit-outline normalWeight"},on:{click:function(a){return e.editProject(t.row)}}})],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"查看上传文件",placement:"top-start"}},[a("el-button",{staticClass:"activeBtnCol",attrs:{size:"small",type:"text",icon:"el-icon-document-copy normalWeight"},on:{click:function(a){return e.handleReviewUploadFile(t)}}})],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"初始化数据",placement:"top-start"}},[a("el-button",{staticClass:"setBtn",staticStyle:{color:"#fff"},attrs:{size:"small",type:"text",circle:"",icon:"el-icon-switch-button"},on:{click:function(a){return e.handleInitData(t)}}})],1),e._v(" "),a("el-dropdown",{attrs:{placement:"top",trigger:"click"},on:{command:function(a){e.importFiles(a,t)}}},[a("el-button",{staticStyle:{"margin-left":"5px"},attrs:{type:"primary",circle:"",size:"small",icon:"el-icon-upload normalWeight"}}),e._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{disabled:!t.row.mergeProjectName,command:"importFile"}},[e._v("\n                        导入报表\n                    ")]),e._v(" "),a("el-dropdown-item",{attrs:{command:"importFileMerge"}},[e._v("\n                        导入关联方对账\n                    ")]),e._v(" "),a("el-dropdown-item",{attrs:{command:"importDealData"}},[e._v("\n                        导入关联方交易汇总\n                    ")]),e._v(" "),a("el-dropdown-item",{attrs:{command:"importRelatedParty"}},[e._v("\n                        导入关联方现流表对账\n                    ")])],1)],1),e._v(" "),a("el-dropdown",{staticStyle:{"margin-left":"5px"},attrs:{placement:"top",trigger:"click"},on:{command:function(a){e.looks(a,t)}}},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"查看",placement:"top-start"}},[a("el-button",{attrs:{type:"primary",size:"small",circle:"",icon:"el-icon-search"}})],1),e._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{command:"\n                                goAssociatedTransactionVoucherTable\n                            "}},[e._v("\n                        查看关联方对账\n                    ")]),e._v(" "),a("el-dropdown-item",{attrs:{command:"internalTransaction"}},[e._v("\n                        查看关联方交易汇总\n                    ")]),e._v(" "),a("el-dropdown-item",{attrs:{command:"cashFlowStatement"}},[e._v("\n                        查看现金流量表对账\n                    ")])],1)],1)]}},{key:"col-trialBalanceStatus",fn:function(t){return["1"===t.row.trialBalanceStatus?a("el-button",{attrs:{size:"small",type:"text"},on:{click:function(a){return e.openView(t.row,"QUERY_TB")}}},[e._v("查看\n                "),t.row.checkTb?e.differences.indexOf(t.row.mergeProjectId)>-1?a("span",{staticClass:"errorInfo",on:{click:function(a){return a.stopPropagation(),e.diffShow(t.row)}}},[e._v("（存在差异）")]):e._e():a("span",{staticClass:"errorInfo"},[e._v("（校验错误）")]),e._v(" "),a("div",{staticClass:"time"},[e._v("\n                    "+e._s(e.formatterDate(t.row,t.row.lastInitializationTime))+"\n                ")])]):e._e(),e._v(" "),"1"!==t.row.trialBalanceStatus?a("span",[e._v("未导入")]):e._e()]}},{key:"col-reportStatus",fn:function(t){return["1"===t.row.reportStatus?a("el-button",{attrs:{size:"small",type:"text"},on:{click:function(a){return e.openView(t.row,"QUERY_REPORT")}}},[e._v("查看"),t.row.checkReport?e._e():a("span",{staticClass:"errorInfo"},[e._v("（校验错误）")]),e._v(" "),a("div",{staticClass:"time"},[e._v("\n                    "+e._s(e.formatterDate(t.row,t.row.lastInitializationTimeReport))+"\n                ")])]):e._e(),e._v(" "),"1"!==t.row.reportStatus?a("span",[e._v("未导入")]):e._e()]}},{key:"col-noteStatus",fn:function(t){return["1"===t.row.noteStatus||"2"===t.row.noteStatus?a("el-button",{attrs:{size:"small",type:"text"},on:{click:function(a){return e.openView(t.row,"note")}}},[e._v("查看\n                "),"2"===t.row.noteStatus&&"0"===t.row.checkStatus?a("span",{staticClass:"errorInfo"},[e._v("（校验错误）")]):e._e(),e._v(" "),"1"===t.row.noteStatus&&"1"===t.row.checkStatus?a("span",{staticClass:"errorInfo"},[e._v("(未校验)")]):e._e(),e._v(" "),a("div",{staticClass:"time"},[e._v("\n                    "+e._s(e.formatterDate(t.row,t.row.lastInitializationTimeNote))+"\n                ")])]):e._e(),e._v(" "),"0"!==t.row.noteStatus||"0"!==t.row.checkStatus&&"1"!==t.row.checkStatus?e._e():a("span",[e._v("未导入")])]}},{key:"col-lastInitializationTimeDeal",fn:function(t){return[t.row.lastInitializationTimeDeal?a("el-button",{attrs:{size:"small",type:"text"}},[a("span",{on:{click:function(a){return e.queryMerchantInsideClassify(t.row)}}},[e._v("\n                    查看\n                ")]),e._v(" "),a("span",{staticStyle:{color:"red"},on:{click:function(a){return e.deleteOldTransactionData(t.row)}}},[e._v("删除")]),e._v(" "),a("div",{staticClass:"time"},[e._v("\n                    "+e._s(e.formatterDate(t.row,t.row.lastInitializationTimeDeal))+"\n                ")])]):e._e()]}},{key:"col-lastInitializationTimeContacts",fn:function(t){return[t.row.lastInitializationTimeContacts?a("el-button",{attrs:{size:"small",type:"text"}},[a("span",{on:{click:function(a){return e.queryContactSummary(t)}}},[e._v("查看")]),e._v(" "),a("span",{staticStyle:{color:"red"},on:{click:function(a){return e.deleteOldContactsData(t.row)}}},[e._v("删除")]),e._v(" "),a("div",{staticClass:"time"},[e._v("\n                    "+e._s(e.formatterDate(t.row,t.row.lastInitializationTimeContacts))+"\n                ")])]):e._e()]}},{key:"col-lastInitializationTimeCashFlow",fn:function(t){var i=t.row;return[i.lastInitializationTimeCashFlow?a("el-button",{attrs:{size:"small",type:"text"}},[a("span",{on:{click:function(t){return e.viewCashFlowMerchant(i)}}},[e._v("查看")]),e._v(" "),a("span",{staticStyle:{color:"red"},on:{click:function(t){return e.clearCashFlowMerchantFile(i)}}},[e._v("删除")]),e._v(" "),a("div",{staticClass:"time"},[e._v("\n                    "+e._s(e.formatterDate(i,i.lastInitializationTimeCashFlow))+"\n                ")])]):e._e()]}}])},[e._v(" "),a("template",{slot:"text"},[a("div",{staticClass:"totalValidMessage"},[e._v("\n                项目数:"+e._s(e.validProjectTotal)+"件 校验通过:"+e._s(e.passValid)+"件\n                "),a("span",{class:e.failedValid?"errorInfo":""},[e._v("校验失败:"+e._s(e.failedValid)+"件")])])])],2),e._v(" "),a("el-dialog",{attrs:{title:e.haschangeMergeScope?"原因说明":"导入",visible:e.mergeUploadDialogVisible,"destroy-on-close":!0,"before-close":e.cancelUpload,width:"40%"},on:{"update:visible":function(t){e.mergeUploadDialogVisible=t}}},[a("div",[e.haschangeMergeScope?a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:5}},[a("span",{staticStyle:{color:"red"}},[e._v("* ")]),a("span",[e._v("原因说明:")])]),e._v(" "),a("el-col",{attrs:{span:19}},[a("el-input",{attrs:{type:"textarea",maxlength:"60","show-word-limit":""},on:{blur:e.causeDescriptionChange},model:{value:e.causeDescription,callback:function(t){e.causeDescription=t},expression:"causeDescription"}})],1)],1):e._e(),e._v(" "),a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:5}},[e.haschangeMergeScope?a("span",{staticStyle:{color:"red"}},[e._v("*\n                    ")]):e._e()]),e._v(" "),a("el-col",{staticClass:"reasonUpload",attrs:{span:e.haschangeMergeScope?19:24}},[a("el-upload",{ref:"uploadFile",staticClass:"uploadTool",attrs:{drag:"",action:"",multiple:"","file-list":e.uploadFileList,accept:e.haschangeMergeScope?".xlsx,.zip,.jpg,.pdf,.png,.jpeg":".xlsx,.zip","auto-upload":!1,"on-change":e.uploadChange,"on-remove":e.beforeRemove}},[a("i",{staticClass:"el-icon-upload"}),e._v(" "),a("div",{staticClass:"el-upload__text"},[e._v("\n                            将文件拖到此处，或"),a("em",[e._v("点击上传")]),e._v(" "),e.haschangeMergeScope?e._e():a("p",[e._v("\n                                只能上传excel或zip文件\n                            ")])])])],1)],1)],1),e._v(" "),a("div",{staticClass:"buttonList"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.confirUpload}},[e._v("确定")]),e._v(" "),a("el-button",{attrs:{type:"info",size:"small"},on:{click:e.cancelUpload}},[e._v("取消")])],1)]),e._v(" "),a("el-dialog",{attrs:{title:"编辑",visible:e.mergeScopeEditDialogTableVisible,"destroy-on-close":!0,width:"40%"},on:{"update:visible":function(t){e.mergeScopeEditDialogTableVisible=t}}},[a("el-form",{ref:"mergeScopeEditFormData",attrs:{model:e.mergeScopeEditFormData,rules:e.mergeScopedEditFormRule}},[a("el-form-item",{attrs:{label:"公司名称","label-width":e.formLabelWidth,prop:"mergeCustomerName"}},[a("el-input",{attrs:{disabled:""},model:{value:e.mergeScopeEditFormData.mergeCustomerName,callback:function(t){e.$set(e.mergeScopeEditFormData,"mergeCustomerName","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.mergeCustomerName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"项目简称","label-width":e.formLabelWidth,prop:"shortName"}},[a("el-input",{attrs:{type:"text"},model:{value:e.mergeScopeEditFormData.shortName,callback:function(t){e.$set(e.mergeScopeEditFormData,"shortName","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.shortName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"统一社会信用代码","label-width":e.formLabelWidth,prop:"uscc"}},[a("el-input",{attrs:{maxlength:"25"},model:{value:e.mergeScopeEditFormData.uscc,callback:function(t){e.$set(e.mergeScopeEditFormData,"uscc","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.uscc"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"认缴比例","label-width":e.formLabelWidth,prop:"stockBreakRate"}},[a("el-input",{model:{value:e.mergeScopeEditFormData.stockBreakRate,callback:function(t){e.$set(e.mergeScopeEditFormData,"stockBreakRate","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.stockBreakRate"}},[a("i",{staticClass:"percent",staticStyle:{"font-style":"normal"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("%")])])],1),e._v(" "),a("el-form-item",{attrs:{label:"权益比例","label-width":e.formLabelWidth,prop:"equityRatio"}},[a("el-input",{model:{value:e.mergeScopeEditFormData.equityRatio,callback:function(t){e.$set(e.mergeScopeEditFormData,"equityRatio","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.equityRatio"}},[a("i",{staticClass:"percent",staticStyle:{"font-style":"normal"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("%")])])],1),e._v(" "),a("el-form-item",{attrs:{label:"合并比例（本期）","label-width":e.formLabelWidth,prop:"curMergeProportion"}},[a("el-input",{on:{blur:e.fillChangeMergeScopeReason},model:{value:e.mergeScopeEditFormData.curMergeProportion,callback:function(t){e.$set(e.mergeScopeEditFormData,"curMergeProportion","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.curMergeProportion"}},[a("i",{staticClass:"percent",staticStyle:{"font-style":"normal"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("%")])])],1),e._v(" "),a("el-form-item",{attrs:{label:"合并比例（上期）","label-width":e.formLabelWidth,prop:"preMergeProportion"}},[a("el-input",{model:{value:e.mergeScopeEditFormData.preMergeProportion,callback:function(t){e.$set(e.mergeScopeEditFormData,"preMergeProportion","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.preMergeProportion"}},[a("i",{staticClass:"percent",staticStyle:{"font-style":"normal"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("%")])])],1),e._v(" "),a("el-form-item",{attrs:{label:" 所得税税率 %","label-width":e.formLabelWidth,prop:"incomeTaxRate"}},[a("el-input",{model:{value:e.mergeScopeEditFormData.incomeTaxRate,callback:function(t){e.$set(e.mergeScopeEditFormData,"incomeTaxRate","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.incomeTaxRate"}},[a("i",{staticClass:"percent",staticStyle:{"font-style":"normal"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("%")])])],1),e._v(" "),a("el-form-item",{attrs:{label:" 提取比例 %","label-width":e.formLabelWidth,prop:"extractionRatio"}},[a("el-input",{model:{value:e.mergeScopeEditFormData.extractionRatio,callback:function(t){e.$set(e.mergeScopeEditFormData,"extractionRatio","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.extractionRatio"}},[a("i",{staticClass:"percent",staticStyle:{"font-style":"normal"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("%")])])],1),e._v(" "),a("el-form-item",{staticClass:"mergeScopeSelect",attrs:{label:"合并范围","label-width":e.formLabelWidth,prop:"mergeScope"}},[a("el-select",{attrs:{placeholder:"请选择合并范围"},on:{change:e.fillChangeMergeScopeReason},model:{value:e.mergeScopeEditFormData.mergeScope,callback:function(t){e.$set(e.mergeScopeEditFormData,"mergeScope","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.mergeScope"}},e._l(e.mergeScopeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1),e._v(" "),e.haschangeMergeScope?a("div",{staticClass:"resetBtn",on:{click:function(t){e.mergeUploadDialogVisible=!0}}},[a("el-button",{attrs:{circle:"",size:"small",type:"primary",icon:"el-icon-edit-outline",title:"原因说明"}})],1):e._e()],1),e._v(" "),a("el-form-item",{staticClass:"projectSource",attrs:{label:"项目来源","label-width":e.formLabelWidth,prop:"projectSource"}},[a("el-select",{attrs:{placeholder:"请选择项目来源"},model:{value:e.mergeScopeEditFormData.projectSource,callback:function(t){e.$set(e.mergeScopeEditFormData,"projectSource","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.projectSource"}},e._l(e.projectSouce,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{staticClass:"projectName",attrs:{label:"项目名称","label-width":e.formLabelWidth,prop:"mergeProjectName"}},[a("el-select",{staticClass:"projectList",attrs:{placeholder:"请选择项目名称",clearable:"",filterable:""},on:{clear:e.clearMergeProjectName,change:e.handleMergeScopeProject},model:{value:e.mergeScopeEditFormData.mergeProjectName,callback:function(t){e.$set(e.mergeScopeEditFormData,"mergeProjectName","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.mergeProjectName"}},e._l(e.mergeProjectNameList,function(e,t){return a("el-option",{key:t,attrs:{label:e.projectname,value:e.projectid}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"是否母公司单体项目:"}},[a("el-radio-group",{staticClass:"isUnitChildProject",model:{value:e.mergeScopeEditFormData.isUnitChildProject,callback:function(t){e.$set(e.mergeScopeEditFormData,"isUnitChildProject",t)},expression:"mergeScopeEditFormData.isUnitChildProject"}},[a("el-radio",{attrs:{label:"0"}},[e._v("否")]),e._v(" "),a("el-radio",{attrs:{label:"1"}},[e._v("是")])],1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"info",size:"small"},on:{click:function(t){e.mergeScopeEditDialogTableVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.submitEditDialogForm("mergeScopeEditFormData")}}},[e._v("确 定")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"上传文件列表",visible:e.uploadFileListDialogTableVisible,"destroy-on-close":!0,width:"75%"},on:{"update:visible":function(t){e.uploadFileListDialogTableVisible=t}}},[a("bdo-table",{ref:"uploadFileTable",attrs:{columns:e.fileListColumns,"enable-filter":!1,"enable-toolbox":!1,"enable-view-type":!1,data:e.fileList,"page-total":e.fileList.length||0,"responsive-height-gap":e.bodyHeight,showIndexColumn:!0,enableHeadConfig:!1,headerListConfig:!0,enableRefresh:!1,showCheckBox:!1,setBorder:e.setBorder},scopedSlots:e._u([{key:"col-autoId",fn:function(t){return[a("el-button",{attrs:{title:"预览",size:"small",type:"text",icon:"el-icon-view normalWeight selfGreen"},on:{click:function(a){return e.reviewFile(t)}}}),e._v(" "),a("el-button",{attrs:{title:"删除文件",size:"small",type:"text",icon:"el-icon-delete normalWeight delBtnCol"},on:{click:function(a){return e.deleteFile(t)}}}),e._v(" "),a("el-button",{attrs:{title:"下载",size:"small",type:"text",icon:"el-icon-download normalWeight selfBlue"},on:{click:function(a){return e.downloadFile(t)}}})]}}])})],1),e._v(" "),a("el-dialog",{attrs:{title:"导入关联方对账",visible:e.mergeFileVisible,"destroy-on-close":!0,"before-close":e.uploadClose,width:"40%"},on:{"update:visible":function(t){e.mergeFileVisible=t}}},[a("div",[a("el-row",{attrs:{gutter:10}},[a("el-col",{staticClass:"reasonUpload",attrs:{span:24}},[a("el-upload",{ref:"uploadFile",staticClass:"uploadTool",attrs:{drag:"",limit:1,accept:".xlsx",action:"",multiple:"","file-list":e.uploadFileData,"auto-upload":!1,"on-change":e.uploadFileChange,"on-remove":e.uploadFileRemove}},[a("i",{staticClass:"el-icon-upload"}),e._v(" "),a("div",{staticClass:"el-upload__text"},[e._v("\n                            将文件拖到此处，或"),a("em",[e._v("点击上传")]),e._v(" "),a("p",[e._v("只能上传.xlsx文件")])])])],1)],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"下载内部往来数据导入模板",placement:"top-start"}},[a("el-button",{staticClass:"downloadBtnCol",attrs:{size:"small",type:"text",icon:"el-icon-download normalWeight"},on:{click:function(t){return e.downloadFileMerge()}}},[e._v("\n                    下载内部往来数据导入模板\n                ")])],1)],1),e._v(" "),a("div",{staticClass:"buttonList"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.updataEnter}},[e._v("确定")]),e._v(" "),a("el-button",{attrs:{type:"info",size:"small"},on:{click:e.uploadClose}},[e._v("取消")])],1)]),e._v(" "),a("el-dialog",{attrs:{title:"导入关联方交易汇总",visible:e.dealVisible,"destroy-on-close":!0,"before-close":e.uploadDealClose,width:"40%"},on:{"update:visible":function(t){e.dealVisible=t}}},[a("div",[a("el-row",{attrs:{gutter:10}},[a("el-col",{staticClass:"reasonUpload",attrs:{span:24}},[a("el-upload",{ref:"uploadFile",staticClass:"uploadTool",attrs:{drag:"",limit:1,accept:".xlsx",action:"",multiple:"","file-list":e.uploadDealFileList,"auto-upload":!1,"on-change":e.uploadDealFileChange,"on-remove":e.uploadDealFileRemove}},[a("i",{staticClass:"el-icon-upload"}),e._v(" "),a("div",{staticClass:"el-upload__text"},[e._v("\n                            将文件拖到此处，或"),a("em",[e._v("点击上传")]),e._v(" "),a("p",[e._v("只能上传.xlsx文件")])])])],1)],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"下载关联方交易汇总  导入模板",placement:"top-start"}},[a("el-button",{staticClass:"downloadBtnCol",attrs:{size:"small",type:"text",icon:"el-icon-bottom normalWeight"},on:{click:function(t){return e.downloadInternalTradingDataTemplate()}}},[e._v("\n                    下载关联方交易汇总 导入模板\n                ")])],1)],1),e._v(" "),a("div",{staticClass:"buttonList"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.updataDealEnter}},[e._v("确定")]),e._v(" "),a("el-button",{attrs:{type:"info",size:"small"},on:{click:e.uploadDealClose}},[e._v("取消")])],1)]),e._v(" "),a("el-dialog",{attrs:{title:"导入关联方现流表对账",visible:e.cashFlowStatementVisible,"destroy-on-close":!0,"before-close":e.uploadCashFlowStatementClose,width:"40%"},on:{"update:visible":function(t){e.cashFlowStatementVisible=t}}},[a("div",[a("el-row",{attrs:{gutter:10}},[a("el-col",{staticClass:"reasonUpload",attrs:{span:24}},[a("el-upload",{ref:"uploadFile",staticClass:"uploadTool",attrs:{drag:"",limit:1,accept:".xlsx",action:"","file-list":e.uploadCashFlowStatementFileList,"auto-upload":!1,"on-change":e.uploadcashFlowStatementFileChange,"on-remove":e.uploadcashFlowStatementFileRemove}},[a("i",{staticClass:"el-icon-upload"}),e._v(" "),a("div",{staticClass:"el-upload__text"},[e._v("\n                            将文件拖到此处，或"),a("em",[e._v("点击上传")]),e._v(" "),a("p",[e._v("只能上传.xlsx文件")])])])],1)],1),e._v(" "),e.cashFlowStatementVisible?a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"下载关联方现流表对账导入模板",placement:"top-start"}},[a("el-button",{staticClass:"downloadBtnCol",attrs:{size:"small",type:"text",icon:"el-icon-bottom normalWeight"},on:{click:function(t){return e.downCashFlowMerchantFileTemp()}}},[e._v("\n                    下载关联方现流表对账导入模板\n                ")])],1):e._e()],1),e._v(" "),a("div",{staticClass:"buttonList"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.dialogTable}},[e._v("确定")]),e._v(" "),a("el-button",{attrs:{type:"info",size:"small"},on:{click:e.uploadCashFlowStatementClose}},[e._v("取消")])],1)]),e._v(" "),a("el-dialog",{attrs:{title:"下列已确认完成的关联方列表，请选择哪些需要保存当前数据，哪些需要删除！(勾选为保留当前数据)",visible:e.dialogTableVisible},on:{"update:visible":function(t){e.dialogTableVisible=t}}},[a("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.tableData1,"tooltip-effect":"dark"},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),a("el-table-column",{attrs:{label:"客户",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.date))]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:"项目",width:"120"}})],1),e._v(" "),a("div",{staticStyle:{"margin-top":"20px"}},[a("el-button",{on:{click:function(t){return e.toggleSelection([e.tableData[1],e.tableData[2]])}}},[e._v("确定")]),e._v(" "),a("el-button",{on:{click:function(t){return e.toggleSelection()}}},[e._v("取消")])],1)],1),e._v(" "),a("el-dialog",{staticClass:"internalTransaction",attrs:{width:"80%",title:"关联方交易汇总 : "+this.mergeProjectName,visible:e.transactionDialogVisible,"before-close":e.handleClose},on:{"update:visible":function(t){e.transactionDialogVisible=t}}},[a("table-type",{ref:"tableType"})],1),e._v(" "),a("auto-generation-offset",{ref:"autoGenerationOffsetTable"}),e._v(" "),a("el-dialog",{staticClass:"internalTransaction",attrs:{width:"80%",title:"关联方现流表对账 : "+this.mergeProjectName,visible:e.viewCashFlowMerchantVisible,"before-close":e.handLeviewCashFlowMerchantClose},on:{"update:visible":function(t){e.viewCashFlowMerchantVisible=t}}},[a("bdo-table",{attrs:{columns:e.viewCashFlowMerchantColumns,"enable-filter":!1,"enable-toolbox":!1,"enable-view-type":!1,data:e.viewCashFlowMerchantData,"page-total":e.viewCashFlowMerchantDataLength,"responsive-height-gap":e.bodyHeight,showIndexColumn:!1,showCheckBox:!1,tableLoding:e.tableLoding,queryConfig:e.queryViewCashFlowMerchant,setBorder:e.setBorder,exportReport:!1,"cell-style":{"white-space":"pre !important"}}})],1),e._v(" "),a("el-dialog",{attrs:{title:"查看差异详情",width:"75%",visible:e.diffFlag,"destroy-on-close":!0,"before-close":e.closeDiffDialog},on:{"update:visible":function(t){e.diffFlag=t}}},[a("vxe-table",{ref:"diffTable",attrs:{border:"",resizable:"","row-key":"","show-overflow":"","highlight-hover-row":"",height:"480",data:e.diffDetailData,"cell-class-name":e.cellClassName,"edit-config":{trigger:"click",mode:"row"}}},[a("vxe-table-column",{attrs:{field:"subjectId",fixed:"left",width:"100",title:"科目编号"}}),e._v(" "),a("vxe-table-column",{attrs:{field:"subjectName",fixed:"left",width:"100",title:"科目名称"}}),e._v(" "),a("vxe-table-column",{attrs:{field:"auditAmount","min-width":"100",formatter:e.commafyFn,title:"本期金额"}}),e._v(" "),a("vxe-table-column",{attrs:{field:"auditAmountDiff","min-width":"100",formatter:e.commafyFn,title:"本期差异额"}}),e._v(" "),a("vxe-table-column",{attrs:{field:"auditAmountPreVer","min-width":"100",formatter:e.commafyFn,title:"本期金额(旧)"}}),e._v(" "),a("vxe-table-column",{attrs:{field:"preAuditAmount","min-width":"100",formatter:e.commafyFn,title:"上期金额"}}),e._v(" "),a("vxe-table-column",{attrs:{"min-width":"100",field:"preAuditAmountDiff",formatter:e.commafyFn,title:"上期差异额"}}),e._v(" "),a("vxe-table-column",{attrs:{field:"preAuditAmountPreVer","min-width":"100",formatter:e.commafyFn,title:"上期金额(旧)"}})],1)],1)],1)},staticRenderFns:[]};var w=a("VU/8")(I,x,!1,function(e){a("3+Il"),a("I7wC")},"data-v-5eb68aea",null).exports,D={name:"mergeScopeOut",components:{BdoTable:c.a},mixins:[v.a],data:function(){var e=this,t=function(e,t,a){""==t||isNaN(t)?a(new Error("请输入正确的数值")):!isNaN(t)&&(parseFloat(t).toFixed(2)<0||parseFloat(t).toFixed(2)>100)?a(new Error("请输入正确的数值")):a()};return{flag:"HB002-MC002",mergeUploadDialogVisible:!1,excelName:"",mergeScopeEditDialogTableVisible:!1,formLabelWidth:"120px",mergeScopeEditFormData:{autoId:0,checkStatus:"",customerId:"",stockBreakRate:null,isUnitChildProject:"",mergeCustomerId:"",mergeCustomerName:"",mergeFinanceReportType:"",mergeProjectId:"",mergeProjectName:"",mergeScope:"",noteStatus:"",projectId:"",projectSource:"",reportStatus:"",shortName:"",trialBalanceStatus:"",equityRatio:null,preMergeProportion:null,curMergeProportion:null,causeDescription:"",uscc:"",incomeTaxRate:null},mergeProjectNameList:[],mergeScopedEditFormRule:{mergeCustomerName:[{required:!0,message:"公司不能为空",trigger:"blur"}],stockBreakRate:[{required:!0,message:"认缴比例不能为空",trigger:"blur"},{validator:t,trigger:"change"}],equityRatio:[{required:!0,message:"权益比例不能为空",trigger:"blur"},{validator:t,trigger:"change"}],curMergeProportion:[{required:!0,message:"合并比例(本期)不能为空",trigger:"blur"},{validator:t,trigger:"change"}],preMergeProportion:[{required:!0,message:"合并比例(上期)不能为空",trigger:"blur"},{validator:t,trigger:"change"}],mergeProjectName:[{required:!0,message:"项目不能为空",trigger:"change"}],uscc:[{required:!0,message:"统一社会信用代码不能为空",trigger:"blur"}],incomeTaxRate:[{validator:t,trigger:"change"}]},bodyHeight:230,customerId:"",projectId:"",columnsList:[{prop:"autoId",label:"操作",width:"170px",filterOptions:{disabled:!0}},{prop:"mergeCustomerName",label:"客户名称",width:"200px",filterOptions:{disabled:!0}},{prop:"shortName",label:"项目简称",width:"180px",filterOptions:{disabled:!0}},{prop:"uscc",label:"统一社会信用代码",filterOptions:{disabled:!0}},{prop:"incomeTaxRate",label:"所得税税率",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtEquity}},{prop:"stockBreakRate",label:"认缴比例",width:"120px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtEquity}},{prop:"equityRatio",label:"权益比例",width:"120px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtEquity}},{prop:"extractionRatio",label:"母公司投资比例",filterOptions:{disabled:!0}},{prop:"extractionRatio",label:"提取比例",filterOptions:{disabled:!0}},{prop:"curMergeProportion",label:"合并比例(本期)",width:"120px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtEquity}},{prop:"preMergeProportion",label:"合并比例(上期)",width:"120px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtEquity}},{prop:"mergeScope",label:"合并范围",miniWidth:"120px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtMergeScope}},{prop:"causeDescription",label:"原因说明",width:"120px",filterOptions:{disabled:!0}},{prop:"mergeProjectName",label:"项目名称",width:"180px",filterOptions:{disabled:!0}},{prop:"projectSource",label:"项目来源",width:"120px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtSource}},{prop:"trialBalanceStatus",label:"是否导入试算平衡表",width:"160px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtCheckStatus},fixed:"right"},{prop:"reportStatus",label:"是否导入报表",width:"160px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtCheckStatus},fixed:"right"},{prop:"noteStatus",label:"是否导入附注",width:"160px",flag:"a",disableToolbox:!0,filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtCheckStatus},fixed:"right"}],tableDataList:[],mergeScope:1,uploadedCBData:{mergeProjectId:"",fileId:"",isParentNoteInfo:!1,fileType:""},dataLength:0,tableLoding:!1,fullscreenLoading:!1,queryConfig:function(t,a,i){e.fullscreenLoading=!0,e.$sacpApis.enterpriseList({customerId:e.curCustomerId,projectId:e.curProjectId,mergeScope:e.activeName,type:e.$constantVar.API_SACP_QUERY_COMPANY,pageNum:t,pageSize:a}).then(function(t){t.success?t.data?(t.data.map(function(e){e.extractionRatio=parseFloat(100*e.extractionRatio).toFixed(2)+"%",e.incomeTaxRate=e.incomeTaxRate+"%"}),e.tableDataList=t.data,e.dataLength=e.tableDataList,e.handleValidTotal()):e.dataLength=0:e.$message.error(t.resultInfo.statusText)}).finally(function(){return e.fullscreenLoading=!1})},mergeScopeOptions:this.$DIC("合并范围"),projectSouce:this.$DIC("合并报表项目来源"),uploadFileList:[],filedata:new FormData,setBorder:!0,validProjectTotal:0,passValid:0,failedValid:0,isShowProjectPanorama:!1,curCustomerId:"",curProjectId:"",curAccYear:"",menuId:"HB002-MC001",activeLabel:"",isInit:!0,auditAjustmnetData:[],adjustTableData:[],selList:[],userDefined:"",oldTableData:{},showDebLabel:"",activeName:"0",oldActieRowData:{},firstCreate:!0,changeMergeScopeReason:"",haschangeMergeScope:!1,uploadFileListDialogTableVisible:!1,fileListColumns:[{prop:"autoId",label:"处理",fixed:!0,width:"170px",filterOptions:{disabled:!0}},{prop:"fileName",label:"文件名称",fixed:!0,filterOptions:{disabled:!0}},{prop:"uploadDate",label:"上传时间",fixed:!0,formatter:{type:"function",value:this.formatterDate},filterOptions:{disabled:!0}},{prop:"userName",label:"上传人",fixed:!0,filterOptions:{disabled:!0}}],fileList:[],causeDescription:"",causeDescriptionCache:""}},methods:{fillChangeMergeScopeReason:function(){return this.mergeScopeEditFormData.curMergeProportion<=50&&"1"===this.mergeScopeEditFormData.mergeScope?(this.haschangeMergeScope=!0,this.mergeUploadDialogVisible=!0,!1):this.mergeScopeEditFormData.curMergeProportion&&this.mergeScopeEditFormData.curMergeProportion>50&&"0"===this.mergeScopeEditFormData.mergeScope?(this.haschangeMergeScope=!0,this.mergeUploadDialogVisible=!0,!1):(this.haschangeMergeScope=!1,this.mergeUploadDialogVisible=!1,!0)},handleReviewUploadFile:function(e){var t=this;this.uploadFileListDialogTableVisible=!0,this.fullscreenLoading=!0,this.$sacpApis.hbMergeProjectQueryHbFile({jsonData:r()({mergeProjectId:e.row.mergeProjectId})}).then(function(e){e.success?t.fileList=e.data||[]:t.$message.error(e.resultInfo.statusText)}).catch(function(e){return t.$message.error(e)}).finally(function(){t.fullscreenLoading=!1})},reviewFile:function(e){if(!e.row.fileName||e.row.fileName.indexOf(".xlsx")>-1||e.row.fileName.indexOf(".zip")>-1)return this.$message.error("预览功能仅支持图片和PDF类型文件!");var t=this.$router.resolve({name:"PreviewPdf",query:{randomNum:e.row.autoId}}).href;window.open(t,"_blank")},deleteFile:function(e){var t=this;this.fullscreenLoading=!0,this.$sacpApis.deleteAttachment(e.row.autoId).then(function(a){a.success?t.$message.success("删除成功!")&&t.handleReviewUploadFile(e):t.$message.error(a.resultInfo.statusText)}).catch(function(e){return t.$message.error(e)}).finally(function(){t.fullscreenLoading=!1})},downloadFile:function(e){var t=window.location.origin+"/Faith/dgCenter/HbMergeProject.downloadAttachment.json?param1="+e.row.autoId;window.open(t,"_blank")},handleInitData:function(e){var t=this,a="";a=e.row.hasChildAdjust?"初始化子公司数据会删除子公司的试算平衡表、审定报表，确认要初始化吗？":"初始化子公司数据会删除子公司的试算平衡表、审定报表、子公司审计调整数据，确认要初始化吗？",this.$confirm(a,"确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.row.hasChildAdjust?t.$confirm("是否保留分录","确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.confirmInitData(e,!0)}).catch(function(){return t.confirmInitData(e,!1)}):t.confirmInitData(e,!1)}).catch(function(e){})},confirmInitData:function(e,t){var a=this;this.fullscreenLoading=!0;var i={mergeProjectId:e.row.mergeProjectId,retainChildAdjust:t};this.$sacpApis.getInitSingleCompanyData(i).then(function(e){e.success?(a.$message.success("初始化数据成功!"),a.mergeScopeInit(),a.$eventBus.$emit("page-refresh",e.resultInfo.refreshIndexes)):a.$message.error(e.resultInfo.statusText)}).catch(function(e){return a.$message.error(e)}).finally(function(){return a.fullscreenLoading=!1})},uploadChange:function(e,t){if(this.uploadFileList.some(function(t){return t.name==e.name}))return this.$message.warning("不可以重复上传相同文件名文件,请删除!");this.uploadFileList.push(e.raw)},causeDescriptionChange:function(e){this.causeDescriptionCache=this.causeDescription},confirUpload:function(){var e=this;if(!this.uploadFileList||!this.uploadFileList.length)return this.$message.error("请上传文件!");if(this.uploadFileList.map(function(t,a){e.filedata.append("file"+a,t)}),this.haschangeMergeScope){if(!this.causeDescription.trim())return this.$message.error("请填写说明原因!");this.handleUplaodReasonFile()}else this.handleUploadSuccess()},handleUplaodReasonFile:function(){var e=this;this.fullscreenLoading=!0,this.filedata.append("mergeProjectId",this.mergeScopeEditFormData.mergeProjectId),this.$sacpApis.hbMergeProjectBatchUploadbulkUpload(this.filedata).then(function(t){if(t.success)e.$message.success("上传成功!");else{var a=t.resultInfo.statusText;e.$message.error(a)}}).catch(function(t){return e.$message.error(t)}).finally(function(){e.clearUploadData(),e.mergeUploadDialogVisible=!1,e.dialogVisible=!1,e.fullscreenLoading=!1,e.haschangeMergeScope=!1})},clearUploadData:function(){this.$refs.uploadExcel;this.excelFile="",this.excelName="",this.uploadFileList=[],this.causeDescription="",this.filedata=new FormData},handleUploadSuccess:function(){var e=this;this.$sacpApis.bulkUpload(this.filedata).then(function(t){if(t.success)e.clearUploadData(),e.uploadSuccessCB(t.data);else{var a=t.resultInfo.statusText;e.$message.error(a)}}).catch(function(t){return e.$message.error(t)}).finally(function(){e.mergeUploadDialogVisible=!1,e.dialogVisible=!1})},uploadSuccessCB:function(e){var t=this;this.uploadedCBData.fileId=e,this.$sacpApis.mergeScopeUploadCB(this.uploadedCBData).then(function(e){e.success?(t.$message.success("上传成功"),t.mergeScopeInit(),t.$eventBus.$emit("page-refresh",e.resultInfo.refreshIndexes)):t.$message.error(e.resultInfo.statusText)}).catch(function(e){t.$message.error(e)})},beforeRemove:function(e,t){this.uploadFileList=this.uploadFileList.filter(function(t){return t.name!=e.name})},cancelUpload:function(){this.mergeUploadDialogVisible=!1,this.uploadFileList=[],this.causeDescription="",this.causeDescriptionCache=""},handleMergeScopeProject:function(e){if(e){var t=this.mergeProjectNameList.filter(function(t){return t.projectid==e});this.mergeScopeEditFormData.mergeProjectId=t[0].projectid,this.mergeScopeEditFormData.mergeProjectName=t[0].projectname}},clearMergeProjectName:function(){this.$set(this.mergeScopeEditFormData,"mergeProjectName",""),this.$set(this.mergeScopeEditFormData,"mergeProjectId","")},submitEditDialogForm:function(e){var t=this;if(this.haschangeMergeScope&&!this.causeDescriptionCache)return this.fillChangeMergeScopeReason();this.mergeScopeEditFormData.causeDescription=this.causeDescriptionCache?this.causeDescriptionCache:this.mergeScopeEditFormData.causeDescription,this.$refs[e].validate(function(a){a?t.$sacpApis.mergeScopeEditSave(t.mergeScopeEditFormData).then(function(a){a.success?(t.oldActieRowData.mergeScope!=t.mergeScopeEditFormData.mergeScope&&t.$store.commit("setRemoveAliveList","mergeScopeIn"),t.$eventBus.$emit("page-refresh",a.resultInfo.refreshIndexes),t.$message.success("编辑成功"),t.$refs[e].resetFields(),t.mergeScopeEditDialogTableVisible=!1,t.mergeScopeInit()):t.$message.error(a.resultInfo.statusText)}).catch(function(e){t.$message.error(e)}):t.$message.error("校验未过!")})},fmtProject:function(e,t){return e.mergeProjectId||e.mergeProjectName?-1!=e.mergeProjectName.indexOf("-")?e.mergeProjectName:e.mergeProjectId+"-"+e.mergeProjectName:"-"},fmtCheckStatus:function(e,t){switch(t){case"1":return"√";default:return"×"}},fmtEquity:function(e,t){return t+"%"},fmtMergeScope:function(e,t){switch(t){case"1":return"合并范围内";default:return"合并范围外且是关联方"}},fmtSource:function(e,t){switch(t){case"1":return"SACP";case"2":return"PM";case"3":return"非SACP报表审计";case"4":return"非SACP的BDO境外审计";case"5":return"非SACP其他事务所审计"}},editProject:function(e){this.oldActieRowData=e,this.mergeProjectNameList=[],this.mergeScopeEditDialogTableVisible=!0;var t=this.mergeScopeEditFormData;t.autoId=e.autoId,t.checkStatus=e.checkStatus,t.customerId=e.customerId,t.stockBreakRate=e.stockBreakRate,t.mergeCustomerId=e.mergeCustomerId,t.mergeCustomerName=e.mergeCustomerName,t.mergeFinanceReportType=e.mergeFinanceReportType,t.mergeProjectId=e.mergeProjectId,t.mergeProjectName=e.mergeProjectName,t.isUnitChildProject=e.isUnitChildProject,t.mergeScope=e.mergeScope,t.noteStatus=e.noteStatus,t.projectSource=e.projectSource,t.reportStatus=e.reportStatus,t.shortName=e.shortName,t.trialBalanceStatus=e.trialBalanceStatus,t.equityRatio=e.equityRatio,t.curMergeProportion=e.curMergeProportion,t.preMergeProportion=e.preMergeProportion,t.incomeTaxRate=e.incomeTaxRate,t.uscc=e.uscc,t.projectId=this.curProjectId,this.getProjectNameList(t.mergeCustomerId)},delProject:function(e,t,a){var i=this,r={autoIds:e};this.$sacpApis.mergeScopeDelete(r).then(function(e){e.success?(i.$message.success("删除成功"),i.mergeScopeInit()):i.$message.error(e.resultInfo.statusText)}).catch(function(e){i.$message.error(e)})},openView:function(e,t){switch(t){case"QUERY_TB":if("1"!==e.trialBalanceStatus)return void this.$message("试算平衡表未导入！");var a="";a=-1!=e.mergeProjectName.indexOf("-")?e.mergeProjectName:e.mergeProjectId+"-"+e.mergeProjectName;var i={customerId:e.customerId,mergeCustomerName:e.mergeCustomerName,projectId:a,type:t,curYear:this.curAccYear,mergeCustomerId:e.mergeCustomerId};sessionStorage.setItem("projectItem",r()(i)),this.checkTb(i);break;case"QUERY_REPORT":if("1"!==e.reportStatus)return void this.$message("审定报表未导入！");a="";a=-1!=e.mergeProjectName.indexOf("-")?e.mergeProjectName:e.mergeProjectId+"-"+e.mergeProjectName;i={customerId:e.customerId,mergeCustomerName:e.mergeCustomerName,projectId:a,type:t,curYear:this.curAccYear,mergeCustomerId:e.mergeCustomerId};sessionStorage.setItem("projectItem",r()(i)),this.checkReport(i);break;case"note":if("0"===e.noteStatus)return void this.$parent.$message("附注未导入！");a="";a=-1!=e.mergeProjectName.indexOf("-")?e.mergeProjectName:e.mergeProjectId+"-"+e.mergeProjectName;i={customerId:e.customerId,mergeCustomerName:e.mergeCustomerName,projectId:a,type:"",mergeCustomerId:e.mergeCustomerId};sessionStorage.setItem("projectItem",r()(i)),this.checkNote(i)}},checkTb:function(e){var t=this.$router.resolve({path:"/checkTb",query:{curYear:e.curYear,menuID:"HB002-MC004-0001"}}).href;window.open(t,"_blank")},checkReport:function(e){var t=this.$router.resolve({path:"/checkReport",query:{curYear:e.curYear,menuID:"HB002-MC005-001"}}).href;window.open(t,"_blank")},checkNote:function(e){var t=this.$router.resolve({path:"/checkNote",query:{curYear:e.curYear}}).href;window.open(t,"_blank")},calcTaskProgress:function(e,t){return t?Math.round(e/t*100):0},importFile:function(e,t,a){this.uploadedCBData.mergeProjectId=a.row.mergeProjectId,this.mergeUploadDialogVisible=!0},reload:function(){this.$refs.table.reload()},getProjectNameList:function(e){var t=this,a={customerId:e};this.$sacpApis.reachProjectInfo(a).then(function(e){e.success?e.data&&e.data.find(function(e){var a={projectid:e.projectId,projectname:e.ProjectName};t.mergeProjectNameList.push(a)}):t.$message.error(e.resultInfo.statusText)}).catch(function(e){t.$message.error(e)})},isRefreshDataLength:function(e){this.dataLength=e},handleValidTotal:function(){var e=this;this.$sacpApis.mergeScopeValidTotal({activeName:this.activeName}).then(function(t){t.success?(e.passValid=t.data[0].checkPassNumber,e.failedValid=t.data[0].checkFailureNumber,e.validProjectTotal=t.data[0].projectSize):e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)}).finally()},offsetEntryInit:function(){var e=this;this.singleProjectId,this.$sacpApis.queryOffsetList({customerId:this.curCustomerId,projectId:this.curProjectId,year:"",offsetType:1,value:null,mergeProject:null}).then(function(t){e.auditAjustmnetData=t.data}).catch(function(t){return e.$message.error(t)})},handleCurstomerId:function(){var e=JSON.parse(sessionStorage.getItem("curCustomerData"));this.curCustomerId=e.curCustomerId,this.curProjectId=e.curProjectId,this.curAccYear=e.curYear,this.isInit=!1},mergeScopeInit:function(){var e=this;this.fullscreenLoading=!0;this.$sacpApis.enterpriseList({customerId:this.curCustomerId,projectId:this.curProjectId,mergeScope:this.activeName}).then(function(t){t.success?t.data?(e.tableDataList=t.data,e.dataLength=e.tableDataList,e.handleValidTotal()):e.dataLength=0:e.$message.error(t.resultInfo.statusText)}).catch(function(t){e.$message.error(t)}).finally(function(){e.fullscreenLoading=!1,e.isInit=!0,e.$store.commit("setMergeScopeRefresh",!1)})},formatterDate:function(e,t){return d.a.toDateString(t,"yyyy-MM-dd HH:mm:ss")},hasChildAdjust:function(){if(this.tableDataList&&this.tableDataList.length)return this.tableDataList.some(function(e){return e.hasChildAdjust})},exportFile:function(){var e={columns:this.columnsList,params:{param1:this.curCustomerId,param2:this.curProjectId,param3:this.activeName},url:"dgCenter/HbMergeProject.enterpriseList.json",fileName:"合并范围外且是关联方"};this.exportExcel(e)}},activated:function(){var e=this;this.$eventBus.$off("click-tab").$on("click-tab",function(t){t&&t.indexId===e.flag&&t.isMark&&e.mergeScopeInit()})},created:function(){this.handleCurstomerId(),this.selList=this.$DIC("借贷"),this.mergeScopeOptions=this.$DIC("合并范围"),this.firstCreate=!1}},S={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"mergeScopeOut"},[a("bdo-table",{ref:"table",attrs:{columns:e.columnsList,"enable-filter":!1,"enable-toolbox":!1,"enable-view-type":!1,data:e.tableDataList,"page-total":e.tableDataList.length||0,"responsive-height-gap":e.bodyHeight,showIndexColumn:!1,showCheckBox:!1,tableLoding:e.tableLoding,queryConfig:e.queryConfig,setBorder:e.setBorder,exportReport:!1},on:{isRefreshDataLength:e.isRefreshDataLength,exportFile:e.exportFile},scopedSlots:e._u([{key:"col-mergeCustomerName",fn:function(t){return[e._v("\n            "+e._s(t.row.mergeCustomerName)+"\n            "),"1"==t.row.isUnitChildProject?a("span",{staticStyle:{color:"rgb(230 162 60)",display:"inline-block",padding:"0px 5px",background:"rgb(253 246 236)",border:"1px solid #ccc","border-radius":"5px"}},[e._v("\n                母公司\n            ")]):e._e()]}},{key:"col-autoId",fn:function(t){return[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"编辑",placement:"top-start"}},[a("el-button",{staticClass:"editBtnCol",attrs:{size:"small",type:"text",icon:"el-icon-edit-outline normalWeight"},on:{click:function(a){return e.editProject(t.row)}}})],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"导入",placement:"top-start"}},[a("el-button",{staticClass:"uploadBtnCol",attrs:{size:"small",type:"text",disabled:!t.row.mergeProjectName,icon:"el-icon-upload normalWeight"},on:{click:function(a){return e.importFile(t.row.autoId,t.row.customerId,t)}}})],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"初始化数据",placement:"top-start"}},[a("el-button",{staticClass:"activeBtnCol",attrs:{size:"small",type:"text",icon:"el-icon-switch-button"},on:{click:function(a){return e.handleInitData(t)}}})],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"查看上传文件",placement:"top-start"}},[a("el-button",{staticClass:"activeBtnCol",attrs:{size:"small",type:"text",icon:"el-icon-document-copy normalWeight"},on:{click:function(a){return e.handleReviewUploadFile(t)}}})],1)]}},{key:"col-trialBalanceStatus",fn:function(t){return["1"===t.row.trialBalanceStatus?a("el-button",{attrs:{size:"small",type:"text"},on:{click:function(a){return e.openView(t.row,"QUERY_TB")}}},[e._v("查看"),t.row.checkTb?e._e():a("span",{staticClass:"errorInfo"},[e._v("(校验失败)")])]):e._e(),e._v(" "),"1"!==t.row.trialBalanceStatus?a("span",[e._v("未导入")]):e._e()]}},{key:"col-reportStatus",fn:function(t){return["1"===t.row.reportStatus?a("el-button",{attrs:{size:"small",type:"text"},on:{click:function(a){return e.openView(t.row,"QUERY_REPORT")}}},[e._v("查看"),t.row.checkReport?e._e():a("span",{staticClass:"errorInfo"},[e._v("(校验失败)")])]):e._e(),e._v(" "),"1"!==t.row.reportStatus?a("span",[e._v("未导入")]):e._e()]}},{key:"col-noteStatus",fn:function(t){return["1"===t.row.noteStatus||"2"===t.row.noteStatus?a("el-button",{attrs:{size:"small",type:"text"},on:{click:function(a){return e.openView(t.row,"note")}}},[e._v("查看\n                "),"2"===t.row.noteStatus&&"0"===t.row.checkStatus?a("span",{staticClass:"errorInfo"},[e._v("(校验失败)")]):e._e(),e._v(" "),"1"===t.row.noteStatus&&"1"===t.row.checkStatus?a("span",{staticClass:"errorInfo"},[e._v("(未校验)")]):e._e()]):e._e(),e._v(" "),"0"!==t.row.noteStatus||"0"!==t.row.checkStatus&&"1"!==t.row.checkStatus?e._e():a("span",[e._v("未导入")])]}}])},[e._v(" "),a("template",{slot:"text"},[a("div",{staticClass:"totalValidMessage"},[e._v("\n                项目数:"+e._s(e.validProjectTotal)+"件 校验通过:"+e._s(e.passValid)+"件\n                "),a("span",{class:e.failedValid?"errorInfo":""},[e._v("校验失败:"+e._s(e.failedValid)+"件")])])])],2),e._v(" "),a("el-dialog",{attrs:{title:e.haschangeMergeScope?"原因说明":"导入",visible:e.mergeUploadDialogVisible,"destroy-on-close":!0,"before-close":e.cancelUpload,width:"40%"},on:{"update:visible":function(t){e.mergeUploadDialogVisible=t}}},[a("div",[e.haschangeMergeScope?a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:5}},[a("span",{staticStyle:{color:"red"}},[e._v("* ")]),a("span",[e._v("原因说明:")])]),e._v(" "),a("el-col",{attrs:{span:19}},[a("el-input",{attrs:{type:"textarea",maxlength:"60","show-word-limit":""},on:{blur:e.causeDescriptionChange},model:{value:e.causeDescription,callback:function(t){e.causeDescription=t},expression:"causeDescription"}})],1)],1):e._e(),e._v(" "),a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:5}},[e.haschangeMergeScope?a("span",{staticStyle:{color:"red"}},[e._v("*\n                    ")]):e._e()]),e._v(" "),a("el-col",{staticClass:"reasonUpload",attrs:{span:e.haschangeMergeScope?19:24}},[a("el-upload",{ref:"uploadFile",staticClass:"uploadTool",attrs:{drag:"",action:"",multiple:"","file-list":e.uploadFileList,accept:e.haschangeMergeScope?".xlsx,.zip,.jpg,.pdf,.png,.jpeg":".xlsx,.zip","auto-upload":!1,"on-change":e.uploadChange,"on-remove":e.beforeRemove}},[a("i",{staticClass:"el-icon-upload"}),e._v(" "),a("div",{staticClass:"el-upload__text"},[e._v("\n                            将文件拖到此处，或"),a("em",[e._v("点击上传")]),e._v(" "),e.haschangeMergeScope?e._e():a("p",[e._v("\n                                只能上传excel或zip文件\n                            ")])])])],1)],1)],1),e._v(" "),a("div",{staticClass:"buttonList"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.confirUpload}},[e._v("确定")]),e._v(" "),a("el-button",{attrs:{type:"info",size:"small"},on:{click:e.cancelUpload}},[e._v("取消")])],1)]),e._v(" "),a("el-dialog",{attrs:{title:"编辑",visible:e.mergeScopeEditDialogTableVisible,"destroy-on-close":!0,width:"40%"},on:{"update:visible":function(t){e.mergeScopeEditDialogTableVisible=t}}},[a("el-form",{ref:"mergeScopeEditFormData",attrs:{model:e.mergeScopeEditFormData,rules:e.mergeScopedEditFormRule}},[a("el-form-item",{attrs:{label:"公司名称","label-width":e.formLabelWidth,prop:"mergeCustomerName"}},[a("el-input",{attrs:{disabled:""},model:{value:e.mergeScopeEditFormData.mergeCustomerName,callback:function(t){e.$set(e.mergeScopeEditFormData,"mergeCustomerName","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.mergeCustomerName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"项目简称","label-width":e.formLabelWidth,prop:"shortName"}},[a("el-input",{attrs:{type:"text"},model:{value:e.mergeScopeEditFormData.shortName,callback:function(t){e.$set(e.mergeScopeEditFormData,"shortName","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.shortName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"统一社会信用代码","label-width":e.formLabelWidth,prop:"uscc"}},[a("el-input",{attrs:{maxlength:"25"},model:{value:e.mergeScopeEditFormData.uscc,callback:function(t){e.$set(e.mergeScopeEditFormData,"uscc","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.uscc"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"认缴比例","label-width":e.formLabelWidth,prop:"stockBreakRate"}},[a("el-input",{model:{value:e.mergeScopeEditFormData.stockBreakRate,callback:function(t){e.$set(e.mergeScopeEditFormData,"stockBreakRate","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.stockBreakRate"}},[a("i",{staticClass:"percent",staticStyle:{"font-style":"normal"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("%")])])],1),e._v(" "),a("el-form-item",{attrs:{label:"权益比例","label-width":e.formLabelWidth,prop:"equityRatio"}},[a("el-input",{model:{value:e.mergeScopeEditFormData.equityRatio,callback:function(t){e.$set(e.mergeScopeEditFormData,"equityRatio","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.equityRatio"}},[a("i",{staticClass:"percent",staticStyle:{"font-style":"normal"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("%")])])],1),e._v(" "),a("el-form-item",{attrs:{label:"合并比例（本期）","label-width":e.formLabelWidth,prop:"curMergeProportion"}},[a("el-input",{on:{blur:e.fillChangeMergeScopeReason},model:{value:e.mergeScopeEditFormData.curMergeProportion,callback:function(t){e.$set(e.mergeScopeEditFormData,"curMergeProportion","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.curMergeProportion"}},[a("i",{staticClass:"percent",staticStyle:{"font-style":"normal"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("%")])])],1),e._v(" "),a("el-form-item",{attrs:{label:"合并比例（上期）","label-width":e.formLabelWidth,prop:"preMergeProportion"}},[a("el-input",{model:{value:e.mergeScopeEditFormData.preMergeProportion,callback:function(t){e.$set(e.mergeScopeEditFormData,"preMergeProportion","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.preMergeProportion"}},[a("i",{staticClass:"percent",staticStyle:{"font-style":"normal"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("%")])])],1),e._v(" "),a("el-form-item",{attrs:{label:" 所得税税率 %","label-width":e.formLabelWidth,prop:"incomeTaxRate"}},[a("el-input",{model:{value:e.mergeScopeEditFormData.incomeTaxRate,callback:function(t){e.$set(e.mergeScopeEditFormData,"incomeTaxRate","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.incomeTaxRate"}})],1),e._v(" "),a("el-form-item",{staticClass:"mergeScopeSelect",attrs:{label:"合并范围","label-width":e.formLabelWidth,prop:"mergeScope"}},[a("el-select",{attrs:{placeholder:"请选择合并范围"},on:{change:e.fillChangeMergeScopeReason},model:{value:e.mergeScopeEditFormData.mergeScope,callback:function(t){e.$set(e.mergeScopeEditFormData,"mergeScope","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.mergeScope"}},e._l(e.mergeScopeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1),e._v(" "),e.haschangeMergeScope?a("div",{staticClass:"resetBtn",on:{click:function(t){e.mergeUploadDialogVisible=!0}}},[a("el-button",{attrs:{circle:"",size:"small",type:"primary",icon:"el-icon-edit-outline",title:"原因说明"}})],1):e._e()],1),e._v(" "),a("el-form-item",{staticClass:"projectSource",attrs:{label:"项目来源","label-width":e.formLabelWidth,prop:"projectSource"}},[a("el-select",{attrs:{placeholder:"请选择项目来源"},model:{value:e.mergeScopeEditFormData.projectSource,callback:function(t){e.$set(e.mergeScopeEditFormData,"projectSource","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.projectSource"}},e._l(e.projectSouce,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{staticClass:"projectName",attrs:{label:"项目名称","label-width":e.formLabelWidth,prop:"mergeProjectName"}},[a("el-select",{staticClass:"projectList",attrs:{placeholder:"请选择项目名称",clearable:"",filterable:""},on:{clear:e.clearMergeProjectName,change:e.handleMergeScopeProject},model:{value:e.mergeScopeEditFormData.mergeProjectName,callback:function(t){e.$set(e.mergeScopeEditFormData,"mergeProjectName","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.mergeProjectName"}},e._l(e.mergeProjectNameList,function(e,t){return a("el-option",{key:t,attrs:{label:e.projectname,value:e.projectid}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"是否母公司单体项目:"}},[a("el-radio-group",{staticClass:"isUnitChildProject",model:{value:e.mergeScopeEditFormData.isUnitChildProject,callback:function(t){e.$set(e.mergeScopeEditFormData,"isUnitChildProject",t)},expression:"mergeScopeEditFormData.isUnitChildProject"}},[a("el-radio",{attrs:{label:"0"}},[e._v("否")]),e._v(" "),a("el-radio",{attrs:{label:"1"}},[e._v("是")])],1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"info",size:"small"},on:{click:function(t){e.mergeScopeEditDialogTableVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.submitEditDialogForm("mergeScopeEditFormData")}}},[e._v("确 定")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"上传文件列表",visible:e.uploadFileListDialogTableVisible,"destroy-on-close":!0,width:"75%"},on:{"update:visible":function(t){e.uploadFileListDialogTableVisible=t}}},[a("bdo-table",{ref:"uploadFileTable",attrs:{columns:e.fileListColumns,"enable-filter":!1,"enable-toolbox":!1,"enable-view-type":!1,data:e.fileList,"page-total":e.fileList.length||0,"responsive-height-gap":e.bodyHeight,showIndexColumn:!0,enableHeadConfig:!1,headerListConfig:!0,enableRefresh:!1,showCheckBox:!1,setBorder:e.setBorder},scopedSlots:e._u([{key:"col-autoId",fn:function(t){return[a("el-button",{attrs:{title:"预览",size:"small",type:"text",icon:"el-icon-view normalWeight selfGreen"},on:{click:function(a){return e.reviewFile(t)}}}),e._v(" "),a("el-button",{attrs:{title:"删除文件",size:"small",type:"text",icon:"el-icon-delete normalWeight delBtnCol"},on:{click:function(a){return e.deleteFile(t)}}}),e._v(" "),a("el-button",{attrs:{title:"下载",size:"small",type:"text",icon:"el-icon-download normalWeight selfBlue"},on:{click:function(a){return e.downloadFile(t)}}})]}}])})],1)],1)},staticRenderFns:[]};var T=a("VU/8")(D,S,!1,function(e){a("9VHK"),a("+dOl")},"data-v-13733568",null).exports,k=a("Dd8w"),j=a.n(k),_=a("NYxO"),F={name:"unimportRelate",components:{BdoTable:c.a},computed:j()({},Object(_.b)(["refreshUnImportRelate"]),{refreshUnImportRelate:function(){return this.$store.state.refreshUnImportRelate}}),watch:{refreshUnImportRelate:{handler:function(e){if(e){if(!this.curCustomerId||!this.curProjectId){var t=JSON.parse(sessionStorage.getItem("curCustomerData"));this.curCustomerId=t.curCustomerId,this.curProjectId=t.curProjectId,this.curAccYear=t.curYear}this.mergeScopeInit()}},immediate:!0}},mixins:[v.a],data:function(){var e=this,t=function(e,t,a){""==t||isNaN(t)?a(new Error("请输入正确的数值")):!isNaN(t)&&(parseFloat(t).toFixed(2)<0||parseFloat(t).toFixed(2)>100)?a(new Error("请输入正确的数值")):a()};return{flag:"HB002-MC003",mergeUploadDialogVisible:!1,excelName:"",mergeScopeEditDialogTableVisible:!1,formLabelWidth:"120px",mergeScopeEditFormData:{autoId:0,checkStatus:"",customerId:"",stockBreakRate:null,isUnitChildProject:"",mergeCustomerId:"",mergeCustomerName:"",mergeFinanceReportType:"",mergeProjectId:"",mergeProjectName:"",mergeScope:"",noteStatus:"",projectId:"",projectSource:"",reportStatus:"",shortName:"",trialBalanceStatus:"",equityRatio:null,preMergeProportion:null,curMergeProportion:null,causeDescription:"",uscc:"",incomeTaxRate:null},mergeProjectNameList:[],mergeScopedEditFormRule:{mergeCustomerName:[{required:!0,message:"公司不能为空",trigger:"blur"}],stockBreakRate:[{required:!0,message:"认缴比例不能为空",trigger:"blur"},{validator:t,trigger:"change"}],equityRatio:[{required:!0,message:"权益比例不能为空",trigger:"blur"},{validator:t,trigger:"change"}],curMergeProportion:[{required:!0,message:"合并比例(本期)不能为空",trigger:"blur"},{validator:t,trigger:"change"}],preMergeProportion:[{required:!0,message:"合并比例(上期)不能为空",trigger:"blur"},{validator:t,trigger:"change"}],mergeProjectName:[{required:!0,message:"项目不能为空",trigger:"change"}],uscc:[{required:!0,message:"统一社会信用代码不能为空",trigger:"blur"}],incomeTaxRate:[{validator:t,trigger:"change"}]},bodyHeight:230,customerId:"",projectId:"",columnsList:[{prop:"autoId",label:"操作",width:"220px"},{prop:"mergeCustomerName",label:"客户名称",width:"200px",filterOptions:{disabled:!0}},{prop:"shortName",label:"项目简称",width:"180px",filterOptions:{disabled:!0}},{prop:"uscc",label:"统一社会信用代码",filterOptions:{disabled:!0}},{prop:"incomeTaxRate",label:"所得税税率",filterOptions:{disabled:!0}},{prop:"stockBreakRate",label:"认缴比例",width:"120px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtEquity}},{prop:"equityRatio",label:"权益比例",width:"120px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtEquity}},{prop:"extractionRatio",label:"母公司投资比例",filterOptions:{disabled:!0}},{prop:"extractionRatio",label:"提取比例",filterOptions:{disabled:!0}},{prop:"curMergeProportion",label:"合并比例(本期)",width:"120px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtEquity}},{prop:"preMergeProportion",label:"合并比例(上期)",width:"120px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtEquity}},{prop:"remark",label:"作废理由",width:"120px",filterOptions:{disabled:!0}},{prop:"mergeScope",label:"合并范围",miniWidth:"120px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtMergeScope}},{prop:"causeDescription",label:"原因说明",width:"120px",filterOptions:{disabled:!0}},{prop:"mergeProjectName",label:"项目名称",width:"180px",filterOptions:{disabled:!0}},{prop:"projectSource",label:"项目来源",width:"120px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtSource}},{prop:"trialBalanceStatus",label:"是否导入试算平衡表",width:"160px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtCheckStatus},fixed:"right"},{prop:"reportStatus",label:"是否导入报表",width:"160px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtCheckStatus},fixed:"right"},{prop:"noteStatus",label:"是否导入附注",width:"160px",flag:"a",disableToolbox:!0,filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtCheckStatus},fixed:"right"}],tableDataList:[],mergeScope:1,uploadedCBData:{mergeProjectId:"",fileId:"",isParentNoteInfo:!1,fileType:""},dataLength:0,tableLoding:!1,fullscreenLoading:!1,queryConfig:function(t,a,i){e.fullscreenLoading=!0,e.$sacpApis.enterpriseList({customerId:e.curCustomerId,projectId:e.curProjectId,mergeScope:e.activeName,type:e.$constantVar.API_SACP_QUERY_COMPANY,pageNum:t,pageSize:a}).then(function(t){t.success?t.data?(t.data.map(function(e){e.extractionRatio=parseFloat(100*e.extractionRatio).toFixed(2)+"%",e.incomeTaxRate=e.incomeTaxRate+"%"}),e.tableDataList=t.data,e.dataLength=e.tableDataList,e.handleValidTotal()):e.dataLength=0:e.$message.error(t.resultInfo.statusText)}).finally(function(){return e.fullscreenLoading=!1})},mergeScopeOptions:this.$DIC("合并范围"),projectSouce:this.$DIC("合并报表项目来源"),uploadFileList:[],filedata:new FormData,setBorder:!0,validProjectTotal:0,passValid:0,failedValid:0,isShowProjectPanorama:!1,curCustomerId:"",curProjectId:"",curAccYear:"",menuId:"HB002-MC001",activeLabel:"",isInit:!0,auditAjustmnetData:[],adjustTableData:[],selList:[],userDefined:"",oldTableData:{},showDebLabel:"",activeName:"2",oldActieRowData:{},changeMergeScopeReason:"",haschangeMergeScope:!1,uploadFileListDialogTableVisible:!1,fileListColumns:[{prop:"autoId",label:"处理",fixed:!0,width:"170px",filterOptions:{disabled:!0}},{prop:"fileName",label:"文件名称",fixed:!0,filterOptions:{disabled:!0}},{prop:"uploadDate",label:"上传时间",fixed:!0,formatter:{type:"function",value:this.formatterDate},filterOptions:{disabled:!0}},{prop:"userName",label:"上传人",fixed:!0,filterOptions:{disabled:!0}}],fileList:[],causeDescription:"",causeDescriptionCache:""}},methods:{fillChangeMergeScopeReason:function(){return this.mergeScopeEditFormData.curMergeProportion<=50&&"1"===this.mergeScopeEditFormData.mergeScope?(this.haschangeMergeScope=!0,this.mergeUploadDialogVisible=!0,!1):this.mergeScopeEditFormData.curMergeProportion&&this.mergeScopeEditFormData.curMergeProportion>50&&"0"===this.mergeScopeEditFormData.mergeScope?(this.haschangeMergeScope=!0,this.mergeUploadDialogVisible=!0,!1):(this.haschangeMergeScope=!1,this.mergeUploadDialogVisible=!1,!0)},handleReviewUploadFile:function(e){var t=this;this.uploadFileListDialogTableVisible=!0,this.fullscreenLoading=!0,this.$sacpApis.hbMergeProjectQueryHbFile({jsonData:r()({mergeProjectId:e.row.mergeProjectId})}).then(function(e){e.success?t.fileList=e.data||[]:t.$message.error(e.resultInfo.statusText)}).catch(function(e){return t.$message.error(e)}).finally(function(){t.fullscreenLoading=!1})},reviewFile:function(e){if(!e.row.fileName||e.row.fileName.indexOf(".xlsx")>-1||e.row.fileName.indexOf(".zip")>-1)return this.$message.error("预览功能仅支持图片和PDF类型文件!");var t=this.$router.resolve({name:"PreviewPdf",query:{randomNum:e.row.autoId}}).href;window.open(t,"_blank")},deleteFile:function(e){var t=this;this.fullscreenLoading=!0,this.$sacpApis.deleteAttachment(e.row.autoId).then(function(a){a.success?t.$message.success("删除成功!")&&t.handleReviewUploadFile(e):t.$message.error(a.resultInfo.statusText)}).catch(function(e){return t.$message.error(e)}).finally(function(){t.fullscreenLoading=!1})},downloadFile:function(e){var t=window.location.origin+"/Faith/dgCenter/HbMergeProject.downloadAttachment.json?param1="+e.row.autoId;window.open(t,"_blank")},handleInitData:function(e){var t=this,a="";a=e.row.hasChildAdjust?"初始化子公司数据会删除子公司的试算平衡表、审定报表，确认要初始化吗？":"初始化子公司数据会删除子公司的试算平衡表、审定报表、子公司审计调整数据，确认要初始化吗？",this.$confirm(a,"确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.row.hasChildAdjust?t.$confirm("是否保留分录","确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.confirmInitData(e,!0)}).catch(function(){return t.confirmInitData(e,!1)}):t.confirmInitData(e,!1)}).catch(function(e){})},confirmInitData:function(e,t){var a=this;this.fullscreenLoading=!0;var i={mergeProjectId:e.row.mergeProjectId,retainChildAdjust:t};this.$sacpApis.getInitSingleCompanyData(i).then(function(e){e.success?(a.$message.success("初始化数据成功!"),a.mergeScopeInit(),a.$eventBus.$emit("page-refresh",e.resultInfo.refreshIndexes)):a.$message.error(e.resultInfo.statusText)}).catch(function(e){return a.$message.error(e)}).finally(function(){return a.fullscreenLoading=!1})},uploadChange:function(e,t){if(this.uploadFileList.some(function(t){return t.name==e.name}))return this.$message.warning("不可以重复上传相同文件名文件,请删除!");this.uploadFileList.push(e.raw)},causeDescriptionChange:function(e){this.causeDescriptionCache=this.causeDescription},confirUpload:function(){var e=this;if(!this.uploadFileList||!this.uploadFileList.length)return this.$message.error("请上传文件!");if(this.uploadFileList.map(function(t,a){e.filedata.append("file"+a,t)}),this.haschangeMergeScope){if(!this.causeDescription.trim())return this.$message.error("请填写说明原因!");this.handleUplaodReasonFile()}else this.handleUploadSuccess()},handleUplaodReasonFile:function(){var e=this;this.fullscreenLoading=!0,this.filedata.append("mergeProjectId",this.mergeScopeEditFormData.mergeProjectId),this.$sacpApis.hbMergeProjectBatchUploadbulkUpload(this.filedata).then(function(t){if(t.success)e.$message.success("上传成功!");else{var a=t.resultInfo.statusText;e.$message.error(a)}}).catch(function(t){return e.$message.error(t)}).finally(function(){e.clearUploadData(),e.mergeUploadDialogVisible=!1,e.dialogVisible=!1,e.fullscreenLoading=!1,e.haschangeMergeScope=!1})},clearUploadData:function(){this.$refs.uploadExcel;this.excelFile="",this.excelName="",this.uploadFileList=[],this.causeDescription="",this.filedata=new FormData},handleUploadSuccess:function(){var e=this;this.$sacpApis.bulkUpload(this.filedata).then(function(t){if(t.success)e.clearUploadData(),e.uploadSuccessCB(t.data);else{var a=t.resultInfo.statusText;e.$message.error(a)}}).catch(function(t){return e.$message.error(t)}).finally(function(){e.mergeUploadDialogVisible=!1,e.dialogVisible=!1})},uploadSuccessCB:function(e){var t=this;this.uploadedCBData.fileId=e,this.$sacpApis.mergeScopeUploadCB(this.uploadedCBData).then(function(e){e.success?(t.$message.success("上传成功"),t.mergeScopeInit(),t.$eventBus.$emit("page-refresh",e.resultInfo.refreshIndexes)):t.$message.error(e.resultInfo.statusText)}).catch(function(e){t.$message.error(e)})},beforeRemove:function(e,t){this.uploadFileList=this.uploadFileList.filter(function(t){return t.name!=e.name})},cancelUpload:function(){this.mergeUploadDialogVisible=!1,this.uploadFileList=[],this.causeDescription="",this.causeDescriptionCache=""},handleActive:function(e){var t=this,a={autoId:e};this.$sacpApis.deleteActive(a).then(function(e){e.success?(t.$store.commit("setRefreshUnImportRelate",!1),t.activedFlage&&t.$store.commit("setRemoveAliveList","mergeScopeIn"),t.mergeScopeInit()):t.$message.error(e.resultInfo.statusText)}).catch(function(e){return t.$message.error(e)})},handleMergeScopeProject:function(e){if(e){var t=this.mergeProjectNameList.filter(function(t){return t.projectid==e});this.mergeScopeEditFormData.mergeProjectId=t[0].projectid,this.mergeScopeEditFormData.mergeProjectName=t[0].projectname}},clearMergeProjectName:function(){this.$set(this.mergeScopeEditFormData,"mergeProjectName",""),this.$set(this.mergeScopeEditFormData,"mergeProjectId","")},submitEditDialogForm:function(e){var t=this;if(this.haschangeMergeScope&&!this.causeDescriptionCache)return this.fillChangeMergeScopeReason();this.mergeScopeEditFormData.causeDescription=this.causeDescriptionCache?this.causeDescriptionCache:this.mergeScopeEditFormData.causeDescription,this.$refs[e].validate(function(a){a?t.$sacpApis.mergeScopeEditSave(t.mergeScopeEditFormData).then(function(a){a.success?(t.oldActieRowData.mergeScope!=t.mergeScopeEditFormData.mergeScope&&(0==t.mergeScopeEditFormData.mergeScope?t.$store.commit("setRemoveAliveList","mergeScopeOut"):1==t.mergeScopeEditFormData.mergeScope&&t.$store.commit("setRemoveAliveList","mergeScopeIn")),t.$eventBus.$emit("page-refresh",a.resultInfo.refreshIndexes),t.$message.success("编辑成功"),t.$refs[e].resetFields(),t.mergeScopeEditDialogTableVisible=!1,t.mergeScopeInit()):t.$message.error(a.resultInfo.statusText)}).catch(function(e){t.$message.error(e)}):t.$message.error("校验未过!")})},fmtProject:function(e,t){return e.mergeProjectId||e.mergeProjectName?-1!=e.mergeProjectName.indexOf("-")?e.mergeProjectName:e.mergeProjectId+"-"+e.mergeProjectName:"-"},fmtCheckStatus:function(e,t){switch(t){case"1":return"√";default:return"×"}},fmtEquity:function(e,t){return t+"%"},fmtMergeScope:function(e,t){switch(t){case"1":return"合并范围内";default:return"合并范围外且是关联方"}},fmtSource:function(e,t){switch(t){case"1":return"SACP";case"2":return"PM";case"3":return"非SACP报表审计";case"4":return"非SACP的BDO境外审计";case"5":return"非SACP其他事务所审计"}},editProject:function(e){this.oldActieRowData=e,this.mergeProjectNameList=[],this.mergeScopeEditDialogTableVisible=!0;var t=this.mergeScopeEditFormData;t.autoId=e.autoId,t.checkStatus=e.checkStatus,t.customerId=e.customerId,t.stockBreakRate=e.stockBreakRate,t.mergeCustomerId=e.mergeCustomerId,t.mergeCustomerName=e.mergeCustomerName,t.mergeFinanceReportType=e.mergeFinanceReportType,t.mergeProjectId=e.mergeProjectId,t.mergeProjectName=e.mergeProjectName,t.isUnitChildProject=e.isUnitChildProject,t.mergeScope=e.mergeScope,t.noteStatus=e.noteStatus,t.projectSource=e.projectSource,t.reportStatus=e.reportStatus,t.shortName=e.shortName,t.trialBalanceStatus=e.trialBalanceStatus,t.equityRatio=e.equityRatio,t.curMergeProportion=e.curMergeProportion,t.preMergeProportion=e.preMergeProportion,t.incomeTaxRate=e.incomeTaxRate,t.uscc=e.uscc,t.projectId=this.curProjectId,this.getProjectNameList(t.mergeCustomerId)},delProject:function(e,t,a){var i=this,r={autoIds:e};this.$sacpApis.mergeScopeDelete(r).then(function(e){e.success?(i.$message.success("删除成功"),i.mergeScopeInit()):i.$message.error(e.resultInfo.statusText)}).catch(function(e){i.$message.error(e)})},openView:function(e,t){switch(t){case"QUERY_TB":if("1"!==e.trialBalanceStatus)return void this.$message("试算平衡表未导入！");var a="";a=-1!=e.mergeProjectName.indexOf("-")?e.mergeProjectName:e.mergeProjectId+"-"+e.mergeProjectName;var i={customerId:e.customerId,mergeCustomerName:e.mergeCustomerName,projectId:a,type:t,curYear:this.curAccYear,mergeCustomerId:e.mergeCustomerId};sessionStorage.setItem("projectItem",r()(i)),this.checkTb(i);break;case"QUERY_REPORT":if("1"!==e.reportStatus)return void this.$message("审定报表未导入！");a="";a=-1!=e.mergeProjectName.indexOf("-")?e.mergeProjectName:e.mergeProjectId+"-"+e.mergeProjectName;i={customerId:e.customerId,mergeCustomerName:e.mergeCustomerName,projectId:a,type:t,curYear:this.curAccYear,mergeCustomerId:e.mergeCustomerId};sessionStorage.setItem("projectItem",r()(i)),this.checkReport(i);break;case"note":if("0"===e.noteStatus)return void this.$parent.$message("附注未导入！");a="";a=-1!=e.mergeProjectName.indexOf("-")?e.mergeProjectName:e.mergeProjectId+"-"+e.mergeProjectName;i={customerId:e.customerId,mergeCustomerName:e.mergeCustomerName,projectId:a,type:"",mergeCustomerId:e.mergeCustomerId};sessionStorage.setItem("projectItem",r()(i)),this.checkNote(i)}},checkTb:function(e){var t=this.$router.resolve({path:"/checkTb",query:{curYear:e.curYear,menuID:"HB002-MC004-0001"}}).href;window.open(t,"_blank")},checkReport:function(e){var t=this.$router.resolve({path:"/checkReport",query:{curYear:e.curYear,menuID:"HB002-MC005-001"}}).href;window.open(t,"_blank")},checkNote:function(e){var t=this.$router.resolve({path:"/checkNote",query:{curYear:e.curYear}}).href;window.open(t,"_blank")},calcTaskProgress:function(e,t){return t?Math.round(e/t*100):0},importFile:function(e,t,a){this.uploadedCBData.mergeProjectId=a.row.mergeProjectId,this.mergeUploadDialogVisible=!0},getProjectNameList:function(e){var t=this,a={customerId:e};this.$sacpApis.reachProjectInfo(a).then(function(e){e.success?e.data&&e.data.find(function(e){var a={projectid:e.projectId,projectname:e.ProjectName};t.mergeProjectNameList.push(a)}):t.$message.error(e.resultInfo.statusText)}).catch(function(e){t.$message.error(e)})},isRefreshDataLength:function(e){this.dataLength=e},handleValidTotal:function(){var e=this;this.$sacpApis.mergeScopeValidTotal({activeName:this.activeName}).then(function(t){t.success?(e.passValid=t.data[0].checkPassNumber,e.failedValid=t.data[0].checkFailureNumber,e.validProjectTotal=t.data[0].projectSize):e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)}).finally()},handleCurstomerId:function(){var e=JSON.parse(sessionStorage.getItem("curCustomerData"));this.curCustomerId=e.curCustomerId,this.curProjectId=e.curProjectId,this.curAccYear=e.curYear,this.isInit=!1},mergeScopeInit:function(){var e=this;this.fullscreenLoading=!0;this.$sacpApis.enterpriseList({customerId:this.curCustomerId,projectId:this.curProjectId,mergeScope:this.activeName}).then(function(t){t.success?t.data?(e.tableDataList=t.data,e.dataLength=t.totalCount,e.handleValidTotal()):e.dataLength=0:e.$message.error(t.resultInfo.statusText)}).catch(function(t){e.$message.error(t)}).finally(function(){e.fullscreenLoading=!1,e.isInit=!0,e.$store.commit("setMergeScopeRefresh",!1)})},formatterDate:function(e,t){return d.a.toDateString(t,"yyyy-MM-dd HH:mm:ss")},hasChildAdjust:function(){if(this.tableDataList&&this.tableDataList.length)return this.tableDataList.some(function(e){return e.hasChildAdjust})},exportFile:function(){var e={columns:this.columnsList,params:{param1:this.curCustomerId,param2:this.curProjectId,param3:this.activeName},url:"dgCenter/HbMergeProject.enterpriseList.json",fileName:"非关联方"};this.exportExcel(e)}},activated:function(){var e=this;this.$eventBus.$off("click-tab").$on("click-tab",function(t){t&&t.indexId===e.flag&&t.isMark&&e.mergeScopeInit()})},created:function(){this.handleCurstomerId(),this.selList=this.$DIC("借贷"),this.mergeScopeOptions=this.$DIC("合并范围")}},$={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"unimportRelate"},[a("bdo-table",{ref:"table",attrs:{columns:e.columnsList,"enable-filter":!1,"enable-toolbox":!1,"enable-view-type":!1,data:e.tableDataList,"page-total":e.tableDataList.length,"responsive-height-gap":e.bodyHeight,showIndexColumn:!1,showCheckBox:!1,tableLoding:e.tableLoding,queryConfig:e.queryConfig,setBorder:e.setBorder,exportReport:!1},on:{isRefreshDataLength:e.isRefreshDataLength,exportFile:e.exportFile},scopedSlots:e._u([{key:"col-autoId",fn:function(t){return[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"编辑",placement:"top-start"}},[a("el-button",{staticClass:"editBtnCol",attrs:{size:"small",type:"text",icon:"el-icon-edit-outline normalWeight"},on:{click:function(a){return e.editProject(t.row)}}})],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"导入",placement:"top-start"}},[a("el-button",{staticClass:"uploadBtnCol",attrs:{size:"small",type:"text",disabled:!t.row.mergeProjectName,icon:"el-icon-upload normalWeight"},on:{click:function(a){return e.importFile(t.row.autoId,t.row.customerId,t)}}})],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"激活",placement:"top-start"}},[a("el-button",{staticClass:"activeBtnCol",attrs:{size:"small",type:"text",icon:"el-icon-s-opportunity normalWeight"},on:{click:function(a){return e.handleActive(t.row.autoId)}}})],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"初始化数据",placement:"top-start"}},[a("el-button",{staticClass:"activeBtnCol",attrs:{size:"small",type:"text",icon:"el-icon-switch-button"},on:{click:function(a){return e.handleInitData(t)}}})],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"查看上传文件",placement:"top-start"}},[a("el-button",{staticClass:"activeBtnCol",attrs:{size:"small",type:"text",icon:"el-icon-document-copy normalWeight"},on:{click:function(a){return e.handleReviewUploadFile(t)}}})],1)]}},{key:"col-trialBalanceStatus",fn:function(t){return["1"===t.row.trialBalanceStatus?a("el-button",{attrs:{size:"small",type:"text"},on:{click:function(a){return e.openView(t.row,"QUERY_TB")}}},[e._v("查看"),t.row.checkTb?e._e():a("span",{staticClass:"errorInfo"},[e._v("(校验失败)")])]):e._e(),e._v(" "),"1"!==t.row.trialBalanceStatus?a("span",[e._v("未导入")]):e._e()]}},{key:"col-reportStatus",fn:function(t){return["1"===t.row.reportStatus?a("el-button",{attrs:{size:"small",type:"text"},on:{click:function(a){return e.openView(t.row,"QUERY_REPORT")}}},[e._v("查看"),t.row.checkReport?e._e():a("span",{staticClass:"errorInfo"},[e._v("(校验失败)")])]):e._e(),e._v(" "),"1"!==t.row.reportStatus?a("span",[e._v("未导入")]):e._e()]}},{key:"col-noteStatus",fn:function(t){return["1"===t.row.noteStatus||"2"===t.row.noteStatus?a("el-button",{attrs:{size:"small",type:"text"},on:{click:function(a){return e.openView(t.row,"note")}}},[e._v("查看\n                "),"2"===t.row.noteStatus&&"0"===t.row.checkStatus?a("span",{staticClass:"errorInfo"},[e._v("(校验失败)")]):e._e(),e._v(" "),"1"===t.row.noteStatus&&"1"===t.row.checkStatus?a("span",{staticClass:"errorInfo"},[e._v("(未校验)")]):e._e()]):e._e(),e._v(" "),"0"!==t.row.noteStatus||"0"!==t.row.checkStatus&&"1"!==t.row.checkStatus?e._e():a("span",[e._v("未导入")])]}}])},[a("template",{slot:"text"},[a("div",{staticClass:"totalValidMessage"},[e._v("\n                项目数:"+e._s(e.validProjectTotal)+"件 校验通过:"+e._s(e.passValid)+"件\n                "),a("span",{class:e.failedValid?"errorInfo":""},[e._v("校验失败:"+e._s(e.failedValid)+"件")])])])],2),e._v(" "),a("el-dialog",{attrs:{title:e.haschangeMergeScope?"原因说明":"导入",visible:e.mergeUploadDialogVisible,"destroy-on-close":!0,"before-close":e.cancelUpload,width:"40%"},on:{"update:visible":function(t){e.mergeUploadDialogVisible=t}}},[a("div",[e.haschangeMergeScope?a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:5}},[a("span",{staticStyle:{color:"red"}},[e._v("* ")]),a("span",[e._v("原因说明:")])]),e._v(" "),a("el-col",{attrs:{span:19}},[a("el-input",{attrs:{type:"textarea",maxlength:"60","show-word-limit":""},on:{blur:e.causeDescriptionChange},model:{value:e.causeDescription,callback:function(t){e.causeDescription=t},expression:"causeDescription"}})],1)],1):e._e(),e._v(" "),a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:5}},[e.haschangeMergeScope?a("span",{staticStyle:{color:"red"}},[e._v("*\n                    ")]):e._e()]),e._v(" "),a("el-col",{staticClass:"reasonUpload",attrs:{span:e.haschangeMergeScope?19:24}},[a("el-upload",{ref:"uploadFile",staticClass:"uploadTool",attrs:{drag:"",action:"",multiple:"","file-list":e.uploadFileList,accept:e.haschangeMergeScope?".xlsx,.zip,.jpg,.pdf,.png,.jpeg":".xlsx,.zip","auto-upload":!1,"on-change":e.uploadChange,"on-remove":e.beforeRemove}},[a("i",{staticClass:"el-icon-upload"}),e._v(" "),a("div",{staticClass:"el-upload__text"},[e._v("\n                            将文件拖到此处，或"),a("em",[e._v("点击上传")]),e._v(" "),e.haschangeMergeScope?e._e():a("p",[e._v("\n                                只能上传excel或zip文件\n                            ")])])])],1)],1)],1),e._v(" "),a("div",{staticClass:"buttonList"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.confirUpload}},[e._v("确定")]),e._v(" "),a("el-button",{attrs:{type:"info",size:"small"},on:{click:e.cancelUpload}},[e._v("取消")])],1)]),e._v(" "),a("el-dialog",{attrs:{title:"编辑",visible:e.mergeScopeEditDialogTableVisible,"destroy-on-close":!0,width:"40%"},on:{"update:visible":function(t){e.mergeScopeEditDialogTableVisible=t}}},[a("el-form",{ref:"mergeScopeEditFormData",attrs:{model:e.mergeScopeEditFormData,rules:e.mergeScopedEditFormRule}},[a("el-form-item",{attrs:{label:"公司名称","label-width":e.formLabelWidth,prop:"mergeCustomerName"}},[a("el-input",{attrs:{disabled:""},model:{value:e.mergeScopeEditFormData.mergeCustomerName,callback:function(t){e.$set(e.mergeScopeEditFormData,"mergeCustomerName","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.mergeCustomerName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"项目简称","label-width":e.formLabelWidth,prop:"shortName"}},[a("el-input",{attrs:{type:"text"},model:{value:e.mergeScopeEditFormData.shortName,callback:function(t){e.$set(e.mergeScopeEditFormData,"shortName","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.shortName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"统一社会信用代码","label-width":e.formLabelWidth,prop:"uscc"}},[a("el-input",{attrs:{maxlength:"25"},model:{value:e.mergeScopeEditFormData.uscc,callback:function(t){e.$set(e.mergeScopeEditFormData,"uscc","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.uscc"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"认缴比例","label-width":e.formLabelWidth,prop:"stockBreakRate"}},[a("el-input",{model:{value:e.mergeScopeEditFormData.stockBreakRate,callback:function(t){e.$set(e.mergeScopeEditFormData,"stockBreakRate","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.stockBreakRate"}},[a("i",{staticClass:"percent",staticStyle:{"font-style":"normal"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("%")])])],1),e._v(" "),a("el-form-item",{attrs:{label:"权益比例","label-width":e.formLabelWidth,prop:"equityRatio"}},[a("el-input",{model:{value:e.mergeScopeEditFormData.equityRatio,callback:function(t){e.$set(e.mergeScopeEditFormData,"equityRatio","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.equityRatio"}},[a("i",{staticClass:"percent",staticStyle:{"font-style":"normal"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("%")])])],1),e._v(" "),a("el-form-item",{attrs:{label:"合并比例（本期）","label-width":e.formLabelWidth,prop:"curMergeProportion"}},[a("el-input",{on:{blur:e.fillChangeMergeScopeReason},model:{value:e.mergeScopeEditFormData.curMergeProportion,callback:function(t){e.$set(e.mergeScopeEditFormData,"curMergeProportion","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.curMergeProportion"}},[a("i",{staticClass:"percent",staticStyle:{"font-style":"normal"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("%")])])],1),e._v(" "),a("el-form-item",{attrs:{label:"合并比例（上期）","label-width":e.formLabelWidth,prop:"preMergeProportion"}},[a("el-input",{model:{value:e.mergeScopeEditFormData.preMergeProportion,callback:function(t){e.$set(e.mergeScopeEditFormData,"preMergeProportion","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.preMergeProportion"}},[a("i",{staticClass:"percent",staticStyle:{"font-style":"normal"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("%")])])],1),e._v(" "),a("el-form-item",{attrs:{label:" 所得税税率 %","label-width":e.formLabelWidth,prop:"incomeTaxRate"}},[a("el-input",{model:{value:e.mergeScopeEditFormData.incomeTaxRate,callback:function(t){e.$set(e.mergeScopeEditFormData,"incomeTaxRate","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.incomeTaxRate"}})],1),e._v(" "),a("el-form-item",{staticClass:"mergeScopeSelect",attrs:{label:"合并范围","label-width":e.formLabelWidth,prop:"mergeScope"}},[a("el-select",{attrs:{placeholder:"请选择合并范围"},model:{value:e.mergeScopeEditFormData.mergeScope,callback:function(t){e.$set(e.mergeScopeEditFormData,"mergeScope","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.mergeScope"}},e._l(e.mergeScopeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1),e._v(" "),e.haschangeMergeScope?a("div",{staticClass:"resetBtn",on:{click:function(t){e.mergeUploadDialogVisible=!0}}},[a("el-button",{attrs:{circle:"",size:"small",type:"primary",icon:"el-icon-edit-outline",title:"原因说明"}})],1):e._e()],1),e._v(" "),a("el-form-item",{staticClass:"projectSource",attrs:{label:"项目来源","label-width":e.formLabelWidth,prop:"projectSource"}},[a("el-select",{attrs:{placeholder:"请选择项目来源"},model:{value:e.mergeScopeEditFormData.projectSource,callback:function(t){e.$set(e.mergeScopeEditFormData,"projectSource","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.projectSource"}},e._l(e.projectSouce,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{staticClass:"projectName",attrs:{label:"项目名称","label-width":e.formLabelWidth,prop:"mergeProjectName"}},[a("el-select",{staticClass:"projectList",attrs:{placeholder:"请选择项目名称",clearable:"",filterable:""},on:{clear:e.clearMergeProjectName,change:e.handleMergeScopeProject},model:{value:e.mergeScopeEditFormData.mergeProjectName,callback:function(t){e.$set(e.mergeScopeEditFormData,"mergeProjectName","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.mergeProjectName"}},e._l(e.mergeProjectNameList,function(e,t){return a("el-option",{key:t,attrs:{label:e.projectname,value:e.projectid}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"是否母公司单体项目:"}},[a("el-radio-group",{staticClass:"isUnitChildProject",model:{value:e.mergeScopeEditFormData.isUnitChildProject,callback:function(t){e.$set(e.mergeScopeEditFormData,"isUnitChildProject",t)},expression:"mergeScopeEditFormData.isUnitChildProject"}},[a("el-radio",{attrs:{label:"0"}},[e._v("否")]),e._v(" "),a("el-radio",{attrs:{label:"1"}},[e._v("是")])],1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"info",size:"small"},on:{click:function(t){e.mergeScopeEditDialogTableVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.submitEditDialogForm("mergeScopeEditFormData")}}},[e._v("确 定")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"上传文件列表",visible:e.uploadFileListDialogTableVisible,"destroy-on-close":!0,width:"75%"},on:{"update:visible":function(t){e.uploadFileListDialogTableVisible=t}}},[a("bdo-table",{ref:"uploadFileTable",attrs:{columns:e.fileListColumns,"enable-filter":!1,"enable-toolbox":!1,"enable-view-type":!1,data:e.fileList,"page-total":e.fileList.length||0,"responsive-height-gap":e.bodyHeight,showIndexColumn:!0,enableHeadConfig:!1,headerListConfig:!0,enableRefresh:!1,showCheckBox:!1,setBorder:e.setBorder},scopedSlots:e._u([{key:"col-autoId",fn:function(t){return[a("el-button",{attrs:{title:"预览",size:"small",type:"text",icon:"el-icon-view normalWeight selfGreen"},on:{click:function(a){return e.reviewFile(t)}}}),e._v(" "),a("el-button",{attrs:{title:"删除文件",size:"small",type:"text",icon:"el-icon-delete normalWeight delBtnCol"},on:{click:function(a){return e.deleteFile(t)}}}),e._v(" "),a("el-button",{attrs:{title:"下载",size:"small",type:"text",icon:"el-icon-download normalWeight selfBlue"},on:{click:function(a){return e.downloadFile(t)}}})]}}])})],1)],1)},staticRenderFns:[]};var N=a("VU/8")(F,$,!1,function(e){a("kJUT"),a("0CTG")},"data-v-2fd37217",null).exports,L=(a("30bX"),{name:"mergeScope",mixins:[v.a],components:{BdoTable:c.a,aduitAjustment:g,mergeScopeIn:w,mergeScopeOut:T,unimportRelate:N},props:{customerData:Array},computed:{openAdjust:function(){return this.$store.state.openAdjustDialog},getRefreshPagesId:function(){return this.$store.state.addBagdeScope},refreshImportRelate:function(){return this.$store.state.refreshPagesMenuId},initAllSubsidiaryData:function(){return this.$store.state.initMergeScope}},watch:{getRefreshPagesId:{handler:function(e){if(e){var t=window.location.hash.split("=");this.mergeScopeTabs.forEach(function(t){t.isMark=!(!("string"==typeof e&&e.indexOf(t.indexId)>-1||"object"===(void 0===e?"undefined":l()(e))&&e.refreshIndexes&&e.refreshIndexes.indexOf(t.indexId)>-1)||"HB002-MC007"==t.indexId||"HB002-MC003"==t.indexId)});var a=this.mergeScopeTabs.filter(function(e){return e.name===t[t.length-1]})[0],i=a?a.label:"";window.location.hash.indexOf("/MergeScope")>-1&&a&&!0===a.isMark&&this.handleClick({name:t[t.length-1],label:i})}},immediate:!0,deep:!0},refreshImportRelate:{handler:function(e){e===this.flag&&this.offsetEntryInit()}},openAdjust:{handler:function(e){this.adjustDebDialog=e.flage,this.active=e.active,e&&this.adjustDebTableInit()},immediate:!0,deep:!0},initAllSubsidiaryData:{handler:function(e){e&&this.initSonCompanyData()},immediate:!0}},data:function(){return{blackList:"",currentTabComponent:"mergeScopeIn",active:0,adjustDebDialog:!1,isAduitAjustment:!1,activeName:"1",mergeScopeTabs:[{label:"合并范围内",name:"1",indexId:"HB002-MC001",routeName:"mergeScopeIn",isMark:!1},{label:"合并范围外且是关联方",name:"0",indexId:"HB002-MC002",routeName:"mergeScopeOut",isMark:!1},{label:"非关联方",name:"2",indexId:"HB002-MC003",routeName:"unimportRelate",isMark:!1},{label:"审计调整汇总",name:"3",indexId:"HB002-MC007",routeName:"aduitAjustment",isMark:!1}],customerId:"",projectId:"",tableData:[],mergeScope:1,uploadedCBData:{mergeProjectId:"",fileId:"",isParentNoteInfo:!1,fileType:""},dataLength:0,fullscreenLoading:!1,curCustomerId:"",curProjectId:"",curAccYear:"",menuId:"HB002-MC001",activeLabel:"",isInit:!0,isShowRemark:!1,auditAjustmnetData:[],adjustTableData:[],selList:[],userDefined:"",oldTableData:{},showDebLabel:"",activeTabCollection:[],isInitAll:!1,fullScreen:!1}},methods:{fullScreenChange:function(){this.fullScreen=!this.fullScreen},initSonCompanyData:function(){var e,t=this,a=window.location.hash.split("="),i=!1;if(a&&a.length)switch(a[a.length-1]){case"0":i=this.$refs.mergeScopeOut.hasChildAdjust();break;case"1":i=this.$refs.mergeScopeIn.hasChildAdjust();break;case"2":i=this.$refs.unimportRelate.hasChildAdjust();break;default:i=!1}e=(i=!1)?"初始化子公司数据会删除子公司的试算平衡表、审定报表，确认要初始化吗？":"初始化子公司数据会删除子公司的试算平衡表、审定报表、子公司审计调整数据，确认要初始化吗？",this.$confirm(e,"确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){i?t.$confirm("是否保留分录","确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.confirmInitData(!0)}).catch(function(){return t.confirmInitData(!1)}):t.confirmInitData(!1)}).catch(function(e){})},confirmInitData:function(e){var t=this;this.fullscreenLoading=!0,this.$sacpApis.getInitDataForMergeScope({retainChildAdjust:e}).then(function(e){if(e.success){t.$message.success("初始化子公司数据成功!"),t.$eventBus.$emit("page-refresh",e.resultInfo.refreshIndexes);var a={flage:!0,active:t.active};t.$store.commit("setOpenAdjust",a)}else t.$message.error(e.resultInfo.statusText)}).catch(function(e){return t.$message.error(e)}).finally(function(){t.fullscreenLoading=!1,t.$store.commit("setInitMergeScope",!1)})},filterAgeMethod:function(e){var t=e.value,a=e.row;e.column;return a.direction==t},closeAdjustDebDialog:function(){return this.adjustDebDialog=!1,this.$store.commit("setOpenAdjust",!1),!1},saveOldRow:function(e){this.oldTableData=o()({},e)},roleChangeEvent:function(e){var t=this;e&&"贷"==e.showDebLabel?e.direction=-1:e&&"借"==e.showDebLabel&&(e.direction=1),this.active>=3?this.$confirm("节点试算平衡表已完成,修改借贷方向提示 修改科目借贷方向会初始化试算平衡表，确认修改？","确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.handleAdjustDebTab(e)}).catch(function(a){e.showDebLabel=t.oldTableData.showDebLabel}):this.handleAdjustDebTab(e)},handleAdjustDebTab:function(e){var t=this;this.fullscreenLoading=!0;var a={autoId:e.autoId,direction:e.direction,tbSubjectCode:e.tbSubjectId};this.$sacpApis.updateProjectTb(a).then(function(a){a.success?(t.$message.success("修改借贷方向成功!"),e.userDefined=3):t.$message.error(a.resultInfo.statusText)}).catch(function(e){return t.$message.error(e)}).finally(function(){return t.fullscreenLoading=!1}),3==e.userDefined&&this.active<3?this.$refs.adjuctXTable.reloadData(this.adjustTableData):this.$refs.adjuctXTable.reloadRow(e,null,null)},rowClassName:function(e){var t=e.row;e.rowIndex;return 1==t.userDefined?"row-green":2==t.userDefined?"row-lightBlue":3==t.userDefined?"row-white":void 0},adjustDebTableInit:function(){var e=this;this.$sacpApis.queryProjectTb().then(function(t){t.success?(e.adjustTableData=t.data,e.adjustTableData.map(function(e){1==e.direction?e.showDebLabel="借":-1==e.direction&&(e.showDebLabel="贷")})):e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)})},handleClick:function(e){var t=this;switch(this.mergeScopeTabs.forEach(function(a){a.label==e.label&&a.name==e.name&&(t.currentTabComponent=a.routeName,!0===a.isMark&&(a.isMark=!1,"mergeScopeIn"===a.routeName?t.$nextTick(function(){t.$refs.mergeScopeIn.mergeScopeInit()}):"mergeScopeOut"===a.routeName?t.$nextTick(function(){t.$refs.mergeScopeOut.mergeScopeInit()}):"unimportRelate"===a.routeName&&t.$nextTick(function(){t.$refs.unimportRelate.mergeScopeInit()}),t.removeClickedMenuId(t.getRefreshPagesId,a.indexId)))}),e.name){case"0":this.menuId="HB002-MC002",this.activeLabel="合并范围外且是关联方",this.isShowRemark=!1,this.isAduitAjustment=!1;break;case"1":this.menuId="HB002-MC001",this.activeLabel="合并范围内",this.isShowRemark=!1,this.isAduitAjustment=!1;break;case"2":this.menuId="HB002-MC003",this.activeLabel="非关联方",this.isShowRemark=!0,this.isAduitAjustment=!1;break;case"3":this.menuId="HB002-MC007",this.activeLabel="审计调整汇总",this.isShowRemark=!1,this.isAduitAjustment=!0,this.offsetEntryInit()}this.$router.push({name:"MergeScope",query:{tab:e.name}}),this.$store.commit("setClosePostill",!1),this.$store.commit("setMenuId",this.menuId),this.$store.commit("setActiveLabel",this.activeLabel),this.$store.commit("setMergeScopeActiveTab",e.name);this.activeTabCollection.some(function(t){return t==e.name});this.activeTabCollection.push(e.name),this.mergeScopeTabs.every(function(e){return 0==e.isMark})&&(this.$store.commit("setRemoveBagdeScope","MergeScope"),this.deleteLocalStorage("HB002"))},deleteLocalStorage:function(e){var t=JSON.parse(localStorage.getItem("refreshIndexes"));if(t&&t.refreshIndexes&&t.refreshIndexes.length){var a="string"==typeof t.refreshIndexes&&t.refreshIndexes.split(",")||t.refreshIndexes;a=a.filter(function(t){return-1===t.indexOf(e)});var i={key:t.key,refreshIndexes:a.join()};localStorage.setItem("refreshIndexes",r()(i))}},removeClickedMenuId:function(e,t){if(e&&"string"==typeof e){var a=e.split(",").filter(function(e){return e!=t}).join();this.$eventBus.$emit("page-refresh",a)}},mergeScopeInit:function(){var e=this;this.fullscreenLoading=!0;this.$sacpApis.enterpriseList({customerId:this.curCustomerId,projectId:this.curProjectId,mergeScope:this.activeName}).then(function(t){t.success?t.data?(e.tableData=t.data,e.dataLength=t.totalCount,e.handleValidTotal()):e.dataLength=0:e.$message.error(t.resultInfo.statusText)}).catch(function(t){e.$message.error(t)}).finally(function(){e.fullscreenLoading=!1,e.isInit=!0,e.$store.commit("setMergeScopeRefresh",!1)})},handleValidTotal:function(){var e=this;this.$sacpApis.mergeScopeValidTotal({activeName:this.activeName}).then(function(t){if(t.success){var a=t.data[0],i=a.checkPassNumber,r=a.checkFailureNumber,s=a.projectSize;a.directionStatusCheck;e.passValid=i,e.failedValid=r,e.validProjectTotal=s}else e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)}).finally()},offsetEntryInit:function(){var e=this;this.singleProjectId,this.$sacpApis.queryOffsetList({customerId:this.curCustomerId,projectId:this.curProjectId,year:"",offsetType:1,value:null,mergeProject:null}).then(function(t){e.auditAjustmnetData=t.data}).catch(function(t){return e.$message.error(t)})},handleCurstomerId:function(){var e=JSON.parse(sessionStorage.getItem("curCustomerData"));this.curCustomerId=e.curCustomerId,this.curProjectId=e.curProjectId,this.curAccYear=e.curYear,this.intoPageHandleData()},showComponent:function(e){this.currentTabComponent=this.mergeScopeTabs.filter(function(t){return t.name===e})[0].routeName},intoPageHandleData:function(){var e=this;this.$route.query.tab?(this.showComponent(this.$route.query.tab),"1"==this.activeName?this.activeName=this.$route.query.tab:this.$router.push({name:"MergeScope",tab:this.$route.query.tab})):this.activeName=this.activeName,this.isInit=!1;var t=this.mergeScopeTabs.filter(function(t){return t.name===e.activeName})[0].label;this.handleClick({name:this.activeName,label:t})},dialogState:function(e){this.adjustDebTableInit(),this.adjustDebDialog=e}},activated:function(){var e=this,t=this.mergeScopeTabs.filter(function(t){return t.routeName===e.currentTabComponent&&!0===t.isMark})[0],a=t&&t.indexId?t.indexId:"";this.$eventBus.$emit("click-tab",t),this.mergeScopeTabs.map(function(t){return t.isMark=t.routeName!==e.currentTabComponent&&t.isMark}),this.mergeScopeTabs.every(function(e){return 0==e.isMark})&&this.$store.commit("setRemoveBagdeScope","MergeScope"),this.removeClickedMenuId(this.getRefreshPagesId,a)},created:function(){this.handleCurstomerId(),this.selList=this.$DIC("借贷")}}),A={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"mergeScope"},[i("div",{class:{fullScreen:e.fullScreen?"fullScreen":"",fullScreenBox:!0}},[i("el-tooltip",{attrs:{effect:"dark",content:e.fullScreen?"取消全屏":"全屏",placement:"top-start"}},[i("el-button",{class:{fullScreenBtn:!0},attrs:{type:"primary",circle:"",size:"small"},on:{click:e.fullScreenChange}},[e.fullScreen?e._e():i("img",{attrs:{src:a("/Dxn"),alt:""}}),e._v(" "),e.fullScreen?i("img",{attrs:{src:a("W+0t"),alt:""}}):e._e()])],1),e._v(" "),i("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(e.mergeScopeTabs,function(t){return i("el-tab-pane",{key:t.index,attrs:{label:t.label,name:t.name}},[i("span",{attrs:{slot:"label",id:"extendEl"},slot:"label"},[t.isMark?i("el-badge",{staticClass:"item",attrs:{"is-dot":""}}):e._e(),e._v("\n                    "+e._s(t.label)+"\n                ")],1)])}),1),e._v(" "),i("keep-alive",{attrs:{exclude:e.blackList}},["mergeScopeIn"===e.currentTabComponent?i("mergeScopeIn",{ref:"mergeScopeIn",on:{dialogState:e.dialogState}}):e._e(),e._v(" "),"mergeScopeOut"===e.currentTabComponent?i("mergeScopeOut",{ref:"mergeScopeOut"}):e._e(),e._v(" "),"unimportRelate"===e.currentTabComponent?i("unimportRelate",{ref:"unimportRelate"}):e._e(),e._v(" "),"aduitAjustment"===e.currentTabComponent?i("aduitAjustment",{ref:"aduitAjustment",attrs:{auditAjustmnetData:e.auditAjustmnetData}}):e._e()],1),e._v(" "),i("el-dialog",{attrs:{title:"设置TB借贷方向(*绿色:母公司单体带入,紫色:默认规则带入)",visible:e.adjustDebDialog,"destroy-on-close":!0,"before-close":e.closeAdjustDebDialog},on:{"update:visible":function(t){e.adjustDebDialog=t}}},[i("vxe-table",{ref:"adjuctXTable",attrs:{border:"",resizable:"","row-key":"","show-overflow":"","highlight-hover-row":"",height:"500",data:e.adjustTableData,"edit-config":{trigger:"click",mode:"row"},"row-class-name":e.rowClassName,"filter-config":{iconNone:"vxe-icon--funnel",iconMatch:"vxe-icon--funnel"}}},[i("vxe-table-column",{attrs:{field:"tbSubjectId",title:"TB科目编号"}}),e._v(" "),i("vxe-table-column",{attrs:{field:"tbSubjectName",title:"TB科目名称"}}),e._v(" "),i("vxe-table-column",{attrs:{field:"showDebLabel",title:"借贷方向(下拉选)",filters:[{label:"借",value:"1"},{label:"贷",value:"-1"},{label:"无",value:null}],"filter-method":e.filterAgeMethod},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return t.rowIndex,[i("el-select",{attrs:{clearable:"",filterable:""},on:{change:function(t){return e.roleChangeEvent(a)}},nativeOn:{click:function(t){return e.saveOldRow(a)}},model:{value:a.showDebLabel,callback:function(t){e.$set(a,"showDebLabel",t)},expression:"row.showDebLabel"}},e._l(e.selList,function(e){return i("el-option",{key:e.value,attrs:{value:e.label,label:e.label}})}),1)]}}])})],1)],1)],1)])},staticRenderFns:[]};var P=a("VU/8")(L,A,!1,function(e){a("5kUB")},"data-v-74ad1def",null);t.default=P.exports},yoIW:function(e,t){}});