webpackJsonp([9],{"3cZE":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("//Fk"),n=s.n(a),i=s("Gu7T"),c=s.n(i),r=s("Dd8w"),o=s.n(r),h=s("+6Bu"),u=s.n(h),d=s("0RKR"),l=s("ZHXk"),m=s.n(l),f=s("2vhu"),I=s("7+uW"),y=s("vn6w"),p=s.n(y);I.a.component("vue-draggable-resizable",p.a);var g=function(e,t,s){return{children:e,attrs:{}}},M={name:"merchantRangeSelection",data:function(){var e=this;return this.components={header:{cell:function(t,s,a){var n=s.key,i=u()(s,["key"]),r=e.columns.find(function(e){return(e.dataIndex||e.key)===n});if(!r||!r.width)return t("th",o()({},i),[].concat(c()(a)));var h={key:r.dataIndex||r.key,class:"table-draggable-handle",attrs:{w:10,x:r.width,z:1,axis:"x",draggable:!0,resizable:!1},on:{dragging:function(e,t){r.width=Math.max(e,1)}}},d=t("vue-draggable-resizable",o()({},h));return t("th",o()({},i,{class:"resize-table-th"}),[].concat(c()(a),[d]))}}},{columns:[{title:"科目",dataIndex:"subjectName",width:170,customRender:g},{title:"客商勾选",colSpan:2,width:170,key:"subjectIsMerchant",scopedSlots:{customRender:"subjectIsMerchant"}},{title:"辅助核算",colSpan:0,width:200,dataIndex:"assitemIsMerchant",key:"assitemIsMerchant",scopedSlots:{customRender:"assitemIsMerchant"}},{title:"辅助核算选择",dataIndex:"assItemName",key:"assItemName",scopedSlots:{customRender:"assItemName"}},{title:"操作",key:"action",width:170,scopedSlots:{customRender:"action"}}],dataList:[],disabledSelect:!1,key:-1,customerInformation:d.a.findUserInfo(),addDataDialogVisible:!1,subjectTree:d.a.findMerchantRangeTree(),checkedKeys:[],expandedKeys:[],selectedKeys:[],spinning:!1,assitemTypeTree:[],selectDialogVisible:!1,assitemIsMerchantExpandedKeys:[],assitemIsMerchantSelectedKeys:[],assitemIsMerchantTree:[],assitemIsMerchantCheckedKeys:[],currentRow:{},checkStrictly:!0,saveSuccess:!1}},methods:{openSubjectTreeDialog:function(){this.addDataDialogVisible=!0},submitAddData:function(){var e=this;if(0==this.checkedKeys.length)return this.$message.warning("请选择需要添加的科目");var t=m.a.toTreeArray(this.subjectTree);this.checkedKeys.checked.map(function(s){var a=t.filter(function(e){return e.subjectId==s})[0];delete a.children,e.dataList.push(a)}),this.checkedKeys=[],this.hideModal()},onExpand:function(e){this.expandedKeys=e},onCheck:function(e){this.checkedKeys=e},hideModal:function(){this.addDataDialogVisible=!1},openSelectDialog:function(e){if(!e.assitemIsMerchant||e.assitemIsMerchant&&"0"==e.assitemIsMerchant)return this.$message.warning("请先选中辅助核算!");this.selectDialogVisible=!0,this.currentRow=e;var t={lockCustomerId:this.customerInformation.curCustomerId,lockYyyy:this.customerInformation.curAccYear,param11:e.subjectId,param20:1};this.queryMerchantTree(t)},onLoadData:function(e){var t=this;return new n.a(function(s){var a={lockCustomerId:t.customerInformation.curCustomerId,lockYyyy:t.customerInformation.curAccYear,param11:t.currentRow.subjectId,param21:e.dataRef.assItemId};t.queryMerchantTree(a),s()})},queryMerchantTree:function(e){var t=this;this.$sacpApis.findAssitemTypeTree(e).then(function(s){if(s.success)if(s.data.map(function(e){e.isLeaf=!(""===e.parentId&&!e.isLeaf||!e.isLeaf)}),e.param21){var a,n=t.assitemIsMerchantTree.filter(function(t){return t.id===e.param21});(a=n).push.apply(a,c()(s.data)),m.a.toArrayTree(n,{sortKey:"id"}),n=n.filter(function(e){return""===e.parentId}),t.assitemIsMerchantTree=t.assitemIsMerchantTree.filter(function(e){return e.id!=n[0].id}),t.assitemIsMerchantTree.push(n[0]),t.assitemIsMerchantTree=m.a.sortBy(t.assitemIsMerchantTree,"id")}else t.assitemIsMerchantTree=s.data;else t.$message.error(s.resultInfo.statusText)}).catch(function(e){return t.$message.error(e)}).finally(function(){t.spinning=!1})},submitAssitemIsMerchantData:function(){if(0==this.assitemIsMerchantTree.length||!this.assitemIsMerchantCheckedKeys||0==this.assitemIsMerchantCheckedKeys.length)return this.hideAssitemIsMerchantModal();var e=m.a.toTreeArray(this.assitemIsMerchantTree),t=[];this.assitemIsMerchantCheckedKeys.checked.map(function(s){t.push(e.filter(function(e){return e.assItemId==s})[0])});var s=void 0,a=void 0;t&&t.length&&t.map(function(e){e&&(s+=","+e.assItemId,a+=","+e.assItemName)}),s=s.split(",").filter(function(e){return"undefined"!=e}).join(),a=a.split(",").filter(function(e){return"undefined"!=e}).join(),this.currentRow.assItemId=s,this.currentRow.assItemName=a,this.hideAssitemIsMerchantModal()},hideAssitemIsMerchantModal:function(){this.selectDialogVisible=!1,this.assitemIsMerchantCheckedKeys=[],this.assitemIsMerchantTree=[],this.assitemIsMerchantExpandedKeys=[]},assitemIsMerchantOnExpand:function(e,t){t.expanded,t.node;this.assitemIsMerchantExpandedKeys=e;var s={lockCustomerId:this.customerInformation.curCustomerId,lockYyyy:this.customerInformation.curAccYear,param11:this.currentRow.subjectId,param21:this.assitemIsMerchantExpandedKeys[this.assitemIsMerchantExpandedKeys.length-1]};e&&e.length&&this.queryMerchantTree(s)},onChange:function(e,t){this.key=t.key,"subjectName"==e?t.subjectIsMerchant&&"0"!=t.subjectIsMerchant?t.subjectIsMerchant="0":t.subjectIsMerchant="1":t.assitemIsMerchant&&"0"!=t.assitemIsMerchant?t.assitemIsMerchant="0":t.assitemIsMerchant="1",t.key=t.key+"+a"},submitMerchantRangeData:function(){var e=this;return this.dataList.some(function(e){return"0"==e.subjectIsMerchant&&"0"==e.assitemIsMerchant})?this.$message.error("请勾选科目或辅助核算"):this.dataList.some(function(e){return"1"==e.assitemIsMerchant&&!e.assItemName})?this.$message.error("勾选辅助核算后必须有辅助核算选择"):(this.spinning=!0,void this.$sacpApis.saveMerchantRange(this.dataList).then(function(t){t.success?(e.$store.commit("setNextStep",!0),e.$message.success("保存成功!")):e.$message.error(t.resultInfo.statusText)}).catch(function(t){e.$message.error(t)}).finally(function(){e.spinning=!1,e.hideAssitemIsMerchantModal(),e.queryMerchantRangeData()}))},deleteRow:function(e){this.dataList=this.dataList.filter(function(t){return t.key!=e.key})},queryMerchantRangeData:function(){var e=this;this.$sacpApis.queryMerchantRange().then(function(t){t.success?(t.data&&t.data.length&&t.data.forEach(function(e,t){m.a.set(e,"key",t)}),e.dataList=t.data):e.$message.error(t.resultInfo.statusText)}).catch(function(t){e.$message.error(t)}).finally(function(){})},resetMerchant:function(){var e=this;this.spinning=!0,this.$sacpApis.resetMerchant().then(function(t){t.success?e.queryMerchantRangeData()&&e.$message.success("重置成功!"):e.$message.error(t.resultInfo.statusText)}).catch(function(t){e.$message.error(t)}).finally(function(){e.spinning=!1})},manualRefesh:function(){this.queryMerchantRangeData()}},created:function(){this.queryMerchantRangeData()},beforeCreate:function(){this.simpleImage=f.a.PRESENTED_IMAGE_SIMPLE}},k={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("a-spin",{staticClass:"merchant-range-spin",attrs:{tip:"加载中...",spinning:e.spinning,size:"large"}},[s("div",{staticClass:"merchantRangeSelection"},[s("div",{staticStyle:{textalign:"center","margin-bottom":"8px"}},[s("a-icon",{staticStyle:{"margin-right":"8px"},attrs:{type:"tag"}}),e._v("\n            "+e._s("共查询到"+(e.dataList.length||0)+"条数据")+"\n            "),s("span",{staticStyle:{color:"#409eff","margin-left":"10px",cursor:"pointer"},on:{click:e.manualRefesh}},[s("a-icon",{staticStyle:{"margin-right":"5px"},attrs:{type:"sync"}}),e._v("刷新\n            ")],1)],1),e._v(" "),s("a-table",{staticClass:"merchant-range-table",attrs:{columns:e.columns,"data-source":e.dataList,bordered:"",pagination:!1,rowKey:function(e){return e.key},scroll:{y:"calc(100% - 72px)"},components:e.components},scopedSlots:e._u([{key:"subjectIsMerchant",fn:function(t,a){return[s("a-checkbox",{attrs:{checked:"1"==a.subjectIsMerchant},on:{change:function(t){return e.onChange("subjectName",a)}}},[e._v("\n                    科目\n                ")])]}},{key:"assitemIsMerchant",fn:function(t,a){return[s("a-checkbox",{attrs:{checked:"1"==a.assitemIsMerchant},on:{change:function(t){return e.onChange("account",a)}}},[e._v("\n                    辅助核算\n                ")])]}},{key:"assItemName",fn:function(t,a){return[s("span",{staticClass:"select-assItemName",on:{click:function(t){return e.openSelectDialog(a)}}},[e._v("\n                    "+e._s(a.assItemName)+"\n                ")])]}},{key:"action",fn:function(t,a){return[s("a-popconfirm",{attrs:{title:"确定要删除这条数据吗?","ok-text":"确定","cancel-text":"取消"},on:{confirm:function(t){return e.deleteRow(a)}}},[s("a",[e._v("删除")])])]}}])}),e._v(" "),s("a-modal",{staticClass:"assSubjectDialog",attrs:{title:"添加科目","ok-text":"确认","cancel-text":"取消",width:"50%"},on:{ok:e.submitAddData,cancel:e.hideModal},model:{value:e.addDataDialogVisible,callback:function(t){e.addDataDialogVisible=t},expression:"addDataDialogVisible"}},[s("a-tree",{attrs:{checkable:"","expanded-keys":e.expandedKeys,"selected-keys":e.selectedKeys,"tree-data":e.subjectTree,checkStrictly:e.checkStrictly,"replace-fields":{}},on:{expand:e.onExpand},model:{value:e.checkedKeys,callback:function(t){e.checkedKeys=t},expression:"checkedKeys"}})],1),e._v(" "),s("a-modal",{staticClass:"assSubjectDialog",attrs:{title:"辅助核算选择","ok-text":"确认","cancel-text":"取消",width:"50%"},on:{ok:e.submitAssitemIsMerchantData,cancel:e.hideAssitemIsMerchantModal},model:{value:e.selectDialogVisible,callback:function(t){e.selectDialogVisible=t},expression:"selectDialogVisible"}},[s("a-tree",{attrs:{checkable:"","tree-data":e.assitemIsMerchantTree,"expanded-keys":e.assitemIsMerchantExpandedKeys,"selected-keys":e.assitemIsMerchantSelectedKeys,checkStrictly:e.checkStrictly},on:{expand:e.assitemIsMerchantOnExpand},model:{value:e.assitemIsMerchantCheckedKeys,callback:function(t){e.assitemIsMerchantCheckedKeys=t},expression:"assitemIsMerchantCheckedKeys"}}),e._v(" "),this.assitemIsMerchantTree&&this.assitemIsMerchantTree.length?e._e():s("a-empty",{attrs:{image:e.simpleImage}})],1)],1)])},staticRenderFns:[]};var b=s("VU/8")(M,k,!1,function(e){s("e9KT")},null,null);t.default=b.exports},e9KT:function(e,t){}});
//# sourceMappingURL=9.f9132fff429b03b2795e.js.map