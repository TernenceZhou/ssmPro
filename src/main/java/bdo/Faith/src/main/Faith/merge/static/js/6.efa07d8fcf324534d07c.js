webpackJsonp([6],{"+dOl":function(e,t){},"0CTG":function(e,t){},"3+Il":function(e,t){},"5kUB":function(e,t){},"9VHK":function(e,t){},I7wC:function(e,t){},iFwk:function(e,t){},kJUT:function(e,t){},ySjk:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("mvHQ"),o=a.n(r),i=a("woOf"),s=a.n(i),n=a("pFYg"),l=a.n(n),c=a("ABj6"),u=a("ZHXk"),m=a.n(u),d=a("oGZU"),p=a.n(d),f={prop:"offsetEntry",components:{BdoTable:c.a},props:{curTbOffsetData:Array,singleProjectId:String,auditAjustmnetData:Array},watch:{auditAjustmnetData:{handler:function(e){e&&(this.curData=this.auditAjustmnetData,this.handleDataLength(),this.rowspan(0,"autoId"),this.rowspan(1,"indexId"))},immediate:!0,deep:!0}},data:function(){return{menuList:[],entryCategory:[],defaultProps:{children:"children",label:"label"},curMenuItem:{},isShowTable:!1,subtract:0,allAlign:"right",editDialogFormVisible:!1,tbOffsetColumn:[{label:"操作",prop:"autoId",width:"200px"},{label:"索引号",prop:"indexId",data:"indexId"},{label:"摘要",prop:"digest"},{label:"科目编号",prop:"tbSubjectCode"},{label:"科目名称",prop:"tbSubjectName"},{label:"附注科目",prop:"secondSubject"},{label:"借方金额",prop:"deb",align:"right",formatter:{type:"function",value:this.fixedNumber}},{label:"贷方金额",prop:"cre",align:"right",formatter:{type:"function",value:this.fixedNumber}},{label:"状态",prop:"activeFlag",formatter:{type:"function",value:this.activeFlagFormatter}},{label:"未调整原因",prop:"reason"},{label:"调整年份",prop:"yyyy"},{label:"项目名称",prop:"projectName",formatter:{type:"function",value:this.projectNameFn}}],spanArr:[],position:0,dataLenght:0,addDialogFormVisible:!1,addFormData:{style:"",object:""},addEditFormRule:{},formLabelWidth:"120px",addItemTableData:[],projectList:[],debDisabled:!1,creDisabled:!1,yearList:[],yyyy:"",isEdit:!1,editOrAddTitle:"新建分录",selectedSubjectName:"",selectOffsetObject:[],selectOffsetType:"",curRowIndex:-1,curRow:{},roleList:[],modelsDialogVisible:!1,changeModel:[],lastModelList:[],templateData:[],defaultPropsT:{children:"children",label:"label"},subjectNameList:[],tbSubjectNameValue:null,isNewAdjustForm:!1,curCustomerId:"",curProjectId:"",curYear:"",curData:[],editItemTableData:[],editTitle:"",activeRowBackOld:[]}},methods:{rowspan:function(e,t){var a=this;this.spanArr[e]=[],this.position=0,this.curData.forEach(function(r,o){0===o?(a.spanArr[e].push(1),a.position=0):a.curData[o][t]===a.curData[o-1][t]?(a.spanArr[e][a.position]+=1,a.spanArr[e].push(0)):(a.spanArr[e].push(1),a.position=o)}),this.spanArr[0]=this.spanArr[1];var r=0;for(var o in this.spanArr[0])this.spanArr[0][o]>0&&(r+=1,this.curData[o]&&this.$set(this.curData[o],"mergeCellOrder",r))},objectSpanMethod:function(e){e.row,e.column;for(var t=e.rowIndex,a=e.columnIndex,r=0;r<2;r++)if(a===r){var o=this.spanArr[r][t];return{rowspan:o,colspan:o>0?1:0}}},selectedAll:function(){var e=[];this.templateData.forEach(function(t){return e.push(t.label)}),this.$refs.tree.setCheckedKeys(e)},resetChecked:function(){var e=this;this.$nextTick(function(){e.$refs.tree.setCheckedKeys([])})},handleCellClick:function(e){var t=e.row,a=e.rowIndex;e.column,e.columnIndex;this.curRowIndex=a,this.curRow=t},editDialogActivedEvent:function(e){var t=e.row;e.column;Number(t.deb)?(this.creDisabled=!0,this.debDisabled=!1):this.creDisabled=!1,Number(t.cre)?(this.creDisabled=!1,this.debDisabled=!0):this.debDisabled=!1},editClosedEvent:function(e){var t=e.row,a=(e.rowIndex,e.column);-1!=String(t[a.property]).indexOf(",")&&(t[a.property]=t[a.property].replace(/,/gi,"")),t[a.property]=m.a.trim(t[a.property]),"cre"!=a.property&&"deb"!=a.property||(!t[a.property]||/^(-?[1-9]\d+|-?\d?)(\.\d+)?$/.test(t[a.property]))&&t[a.property]||(t[a.property]="0.00")},selectedYear:function(){var e=this;this.yearList.forEach(function(t){if(t.value==e.yyyy)return e.yyyy=t.label})},validSaveData:function(e){var t=this;if(0==this.subtract){var a=this.$refs.addItemTable.data,r=function(e){return Number(a[e].cre)||Number(a[e].deb)?!a[e].cre&&!a[e].deb||m.a.trim(a[e].tbSubjectName)?void(a[e].tbSubjectName&&t.subjectNameList.forEach(function(t){if(a[e].tbSubjectName==m.a.trim(t.label))return a[e].tbSubjectCode=t.value})):(t.$message.error("科目名称不能为空!"),{v:void 0}):(t.$message.error("无有效的可保存分录!"),{v:void 0})};for(var o in a){var i=r(o);if("object"===(void 0===i?"undefined":l()(i)))return i.v}this.saveOffSet(e,a)}else this.$message.error("差额必须为0才可以保存!")},saveOffSet:function(e,t){var a=this,r={yyyy:this.yyyy||this.curYear,projectId:this.singleProjectId,adjustType:1,arr:t};this.$sacpApis.offsetEntryAddSave(r).then(function(r){r.success?(a.hanldeSaveSuccess(e,t),a.$message.success("保存成功")):a.$message.error(r.resultInfo.statusText)}).catch(function(e){return a.$message.error(e)})},hanldeSaveSuccess:function(e,t){this.$refs.addItemTable.remove(),this.lastModelList=[],this.yyyy="",e?this.$refs.addItemTable.revertData():(this.addItemTableData.length=2,this.addItemTableData.forEach(function(e){m.a.clear(e,"")})),this.offsetEntryInit(),this.$refs.addItemTable.reloadData(this.addItemTableData)},editOffset:function(e,t,a){for(var r in this.editDialogFormVisible=!0,this.editItemTableData.length=0,this.curData)this.curData[r].indexId==a.indexId&&(this.curData[r].showLabel=this.curData[r].tbSubjectCode+"-"+this.curData[r].tbSubjectName,this.editItemTableData.push(this.curData[r]));this.editTitle="编辑审计调整列表:"+a.indexId},submitEditDialogForm:function(){var e=this;if(0==this.subtract){var t=this.$refs.editItemTable.data,a={yyyy:t[0].yyyy,projectId:t[0].projectId,adjustType:t[0].adjustType,arr:t};this.$sacpApis.offsetModifySave(a).then(function(t){t.success?(e.$message.success("保存成功"),e.editDialogFormVisible=!1,e.$refs.editItemTable.remove(),e.editItemTableData=[],e.offsetEntryInit(),e.$emit("isResetValid",!0)):e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)})}else this.$message.error("总金额存在差额,请修改")},closeEditDialog:function(){var e=this;this.$XModal.confirm("您确定要取消编辑吗?").then(function(t){"confirm"===t&&(e.editDialogFormVisible=!1,e.$refs.editItemTable.getUpdateRecords().length>0&&e.offsetEntryInit(),e.$refs.editItemTable.revertData(),e.$refs.editItemTable.remove())})},saveEditItem:function(){this.modelsDialogVisible=!1,this.$refs.tree.getCheckedNodes().forEach(function(e){e.tbSubjectName=e.label,delete e.label});var e=this.$refs.tree.getCheckedNodes().filter(function(e){return e.digest&&e.tbSubjectName});for(var t in e)!m.a.some(this.subjectNameList,function(a){return m.a.trim(a.label)===m.a.trim(e[t].tbSubjectName)})&&e.splice(t,1);if(1==e.length){this.addItemTableData=e.concat([{digest:"",tbSubjectName:"",deb:"",cre:""}])}else e.length?this.addItemTableData=e:(this.addItemTableData=[{digest:"",tbSubjectName:"",deb:"",cre:""},{digest:"",tbSubjectName:"",deb:"",cre:""}],this.$message("因没有对应的科目名称,有部分模板没有生成!"));this.$refs.addItemTable.remove()},delOffset:function(e){var t=this;this.$confirm("确定要删除这条数据吗？","确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.handleDelete(e)}).catch(function(e){})},handleDelete:function(e){var t=this,a={autoId:e.autoId};this.$sacpApis.offsetDelete(a).then(function(e){e.success?(t.$message.success("删除成功"),t.offsetEntryInit(),t.$emit("isResetValid",!0)):t.$message.error(e.resultInfo.statusText)}).catch(function(e){return t.$message.error(e)})},rowDisabled:function(e){var t=this;"0"==e.row.activeFlag?this.$confirm("确定要激活这条数据吗？","确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.hanldeInvalidOffsetData(e,"")}).catch(function(e){}):this.$confirm("确定要禁用这条数据吗？","确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.$prompt("请输入禁用理由","",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(a){var r=a.value;t.hanldeInvalidOffsetData(e,r)}).catch(function(){})}).catch(function(e){})},hanldeInvalidOffsetData:function(e,t){var a=this,r={autoId:e.row.autoId,reason:t};this.$sacpApis.invalidOffset(r).then(function(e){e.success?(a.$emit("isResetValid",!0),a.offsetEntryInit()):a.$message.error(e.resultInfo.statusText)}).catch(function(e){return a.$message.error(e)})},footerColspanMethod:function(e){e.columnIndex},footerMethod:function(e){var t=this,a=e.columns,r=e.data,o=[a.map(function(e,a){if(1===a)return"合 计";if(["deb","cre"].includes(e.property)){var o=void 0;for(var i in r)o=m.a.add(o,t.removeComafy(r[i][e.property]));return m.a.commafy(o,{digits:2})}return null})];return 5===a.length?this.subtract=m.a.commafy(m.a.subtract(this.removeComafy(o[0][3]),this.removeComafy(o[0][4])),{digits:2}):4===a.length&&(this.subtract=m.a.commafy(m.a.subtract(this.removeComafy(o[0][2]),this.removeComafy(o[0][3])),{digits:2})),o},removeComafy:function(e){return-1!=String(e).indexOf(",")&&(e=String(e).replace(/,/gi,"")),Number(e)},offsetEntryInit:function(){var e,t=this;e=this.singleProjectId,this.$sacpApis.queryOffsetList({customerId:this.curCustomerId,projectId:this.curProjectId,year:"",offsetType:1,value:null,mergeProject:e}).then(function(e){t.curData=e.data,e.data?(t.handleDataLength(),t.rowspan(0,"autoId"),t.rowspan(1,"indexId")):t.dataLenght=0}).catch(function(e){return t.$message.error(e)})},isRefreshDataLength:function(e){this.dataLenght=e},handleDataLength:function(){var e={},t=this.curData.reduce(function(t,a){return!e[a.indexId]&&(e[a.indexId]=t.push(a)),t},[]);this.dataLenght=t.length},setIcons:function(){p.a.setup({icon:{TABLE_EDIT:""}})},projectNameFn:function(e,t){return""+e.projectName},activeFlagFormatter:function(e,t){return"0"==t?"废弃":"1"==t?"有效":void 0},formatFixedNumber:function(e,t){var a=e.cellValue;return-1!=String(a).indexOf(",")&&(a=a.replace(/,/gi,"")),m.a.commafy(a,{digits:2})},fixedNumber:function(e,t){return m.a.commafy(t,{digits:2})},getSubjectNameList:function(){var e=this;this.$sacpApis.offsetEntrySubjectNameList().then(function(t){if(t.success){e.roleList=t.data;var a=[];t.data.forEach(function(e){return a=e.tb}),a&&a.map(function(e){e.showLabel=e.value+"-"+e.label}),e.subjectNameList=a}else e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)})},handleCurYear:function(){var e={value:"1",label:this.curYear},t={value:"2",label:this.curYear-1};this.yearList.push(e,t)},handleGetParmas:function(){var e=JSON.parse(sessionStorage.getItem("curCustomerData"));this.curCustomerId=e.curCustomerId,this.curProjectId=e.curProjectId,this.curYear=e.curYear,this.handleCurYear()},isRefresh:function(e){e&&this.offsetEntryInit()}},created:function(){this.handleGetParmas(),this.setIcons()}},h={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"mergeAuditAjustment"},[a("div",{staticClass:"tableClass"},[a("bdo-table",{ref:"offsetTable",attrs:{data:e.curData,"page-total":e.dataLenght,columns:e.tbOffsetColumn,"enable-filter":!1,"enable-toolbox":!1,"row-class-name":{id:"indexId"},"enable-view-type":!1,"span-method":e.objectSpanMethod,showIndexColumn:!0,showCheckBox:!1,setBorder:!0,exportReport:!1},on:{isRefreshDataLength:e.isRefreshDataLength,isRefresh:e.isRefresh},scopedSlots:e._u([{key:"col-autoId",fn:function(t){return[a("div",{staticClass:"buttonList"},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"编辑",placement:"top-start"}},[a("el-button",{attrs:{size:"small",type:"success",disabled:"0"==t.row.activeFlag,icon:"el-icon-edit-outline normalWeight"},on:{click:function(a){return e.editOffset(t.row.autoId,t.row.customerId,t.row)}}})],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"删除",placement:"top-start"}},[a("el-button",{attrs:{size:"small",type:"danger",disabled:"0"==t.row.activeFlag,icon:"el-icon-close normalWeight"},on:{click:function(a){return e.delOffset(t.row)}}})],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"1"==t.row.activeFlag?"禁用":"激活",placement:"top-start"}},[a("el-button",{attrs:{size:"small",icon:"1"==t.row.activeFlag?"el-icon-unlock normalWeight":"el-icon-lock normalWeight",type:"1"==t.row.activeFlag?"info":"danger"},on:{click:function(a){return e.rowDisabled(t)}}})],1)],1)]}}])})],1),e._v(" "),a("el-dialog",{attrs:{title:e.editTitle,visible:e.editDialogFormVisible,"before-close":e.closeEditDialog,width:"90%"},on:{"update:visible":function(t){e.editDialogFormVisible=t}}},[a("vxe-grid",{ref:"editItemTable",attrs:{border:"",height:"385",data:e.editItemTableData,"edit-config":{trigger:"click",mode:"cell"},"row-key":!0,"row-id":"stdAcctCode","show-footer":"","keep-source":"","footer-span-method":e.footerColspanMethod,"footer-method":e.footerMethod,"header-align":"center"},on:{"edit-actived":e.editDialogActivedEvent,"edit-closed":e.editClosedEvent}},[a("vxe-table-column",{attrs:{field:"digest",title:"摘要","edit-render":{name:"input",autoselect:!0}}}),e._v(" "),a("vxe-table-column",{attrs:{field:"showLabel",title:"科目名称"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return t.rowIndex,[a("el-input",{attrs:{disabled:""},model:{value:r.showLabel,callback:function(t){e.$set(r,"showLabel",t)},expression:"row.showLabel"}})]}}])}),e._v(" "),a("vxe-table-column",{attrs:{field:"showLabel",title:"附注科目"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return t.rowIndex,[a("el-input",{attrs:{disabled:""},model:{value:r.secondSubject,callback:function(t){e.$set(r,"secondSubject",t)},expression:"row.secondSubject"}})]}}])}),e._v(" "),a("vxe-table-column",{attrs:{title:"借方金额",field:"deb","edit-render":{name:"input",autoselect:!0,attrs:{disabled:e.debDisabled}},formatter:e.formatFixedNumber,align:e.allAlign,"header-align":"center"}}),e._v(" "),a("vxe-table-column",{attrs:{title:"贷方金额",field:"cre","edit-render":{name:"input",autoselect:!0,attrs:{disabled:e.creDisabled}},formatter:e.formatFixedNumber,align:e.allAlign,"header-align":"center"}})],1),e._v(" "),0!=e.subtract?a("div",{staticClass:"balance",staticStyle:{"text-align":"right",color:"red","padding-right":"20px"}},[e._v("\n            差 额:"+e._s(e.subtract)+"\n        ")]):e._e(),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"info",size:"small"},on:{click:e.closeEditDialog}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.submitEditDialogForm("addForm")}}},[e._v("保存后关闭")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"选择模板",visible:e.modelsDialogVisible,"destroy-on-close":!0,width:"80%"},on:{"update:visible":function(t){e.modelsDialogVisible=t}}},[a("el-tree",{ref:"tree",attrs:{data:e.templateData,"show-checkbox":"","default-expand-all":"","node-key":"label","highlight-current":"",props:e.defaultPropsT}}),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.selectedAll}},[e._v("全 选")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.resetChecked}},[e._v("清 空")]),e._v(" "),a("el-button",{attrs:{type:"info",size:"small"},on:{click:function(t){e.modelsDialogVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.saveEditItem()}}},[e._v("保 存")])],1)],1)],1)},staticRenderFns:[]};var g=a("VU/8")(f,h,!1,function(e){a("iFwk"),a("yoIW")},"data-v-0317cbc2",null).exports,b=(a("I/JX"),a("r9ye")),v=a("UGJx"),I=a("lCTB"),S=(a("0RKR"),a("K/T8"),"/Faith/contacts/index.html"),C={name:"mergeScopeIn",components:{BdoTable:c.a,tableType:b.a,AutoGenerationOffset:I.a},props:{tableData:Array},mixins:[v.a],data:function(){var e=this,t=function(e,t,a){""==t||isNaN(t)?a(new Error("请输入正确的数值")):!isNaN(t)&&(parseFloat(t).toFixed(2)<0||parseFloat(t).toFixed(2)>100)?a(new Error("请输入正确的数值")):a()};return{tableData1:[{}],multipleSelection:[],mergeFileVisible:!1,flag:"HB002-MC001",tab:[{label:"接受劳务",name:"5"},{label:"固定资产",name:"6"},{label:"无形资产",name:"7"}],mergeProjectId:"",activedFlage:"",mergeUploadDialogVisible:!1,excelName:"",mergeScopeEditDialogTableVisible:!1,formLabelWidth:"120px",mergeScopeEditFormData:{autoId:0,checkStatus:"",customerId:"",stockBreakRate:null,isUnitChildProject:"",mergeCustomerId:"",mergeCustomerName:"",mergeFinanceReportType:"",mergeProjectId:"",mergeProjectName:"",mergeScope:"",noteStatus:"",projectId:"",projectSource:"",reportStatus:"",shortName:"",trialBalanceStatus:"",equityRatio:null,preMergeProportion:null,curMergeProportion:null,causeDescription:"",uscc:"",incomeTaxRate:null,extractionRatio:null},mergeProjectNameList:[],mergeScopedEditFormRule:{mergeCustomerName:[{required:!0,message:"公司不能为空",trigger:"blur"}],stockBreakRate:[{required:!0,message:"认缴比例不能为空",trigger:"blur"},{validator:t,trigger:"change"}],equityRatio:[{required:!0,message:"权益比例不能为空",trigger:"blur"},{validator:t,trigger:"change"}],curMergeProportion:[{required:!0,message:"合并比例(本期)不能为空",trigger:"blur"},{validator:t,trigger:"change"}],preMergeProportion:[{required:!0,message:"合并比例(上期)不能为空",trigger:"blur"},{validator:t,trigger:"change"}],mergeProjectName:[{required:!0,message:"项目不能为空",trigger:"change"}],uscc:[{required:!0,message:"统一社会信用代码不能为空",trigger:"blur"}],incomeTaxRate:[{validator:t,trigger:"change"}],extractionRatio:[{validator:t,trigger:"change"}]},bodyHeight:0,customerId:"",projectId:"",differences:[],diffFlag:!1,columnsList:[{prop:"autoId",label:"操作",width:"230px",filterOptions:{disabled:!0}},{prop:"mergeCustomerName",label:"客户名称",width:"200px",filterOptions:{disabled:!0}},{prop:"shortName",label:"项目简称",width:"180px",filterOptions:{disabled:!0}},{prop:"uscc",label:"统一社会信用代码",filterOptions:{disabled:!0}},{prop:"incomeTaxRate",label:"所得税税率",filterOptions:{disabled:!0}},{prop:"extractionRatio",label:"母公司投资比例",filterOptions:{disabled:!0}},{prop:"extractionRatio",label:"提取比例",filterOptions:{disabled:!0}},{prop:"stockBreakRate",label:"认缴比例",width:"120px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtEquity}},{prop:"equityRatio",label:"权益比例",width:"120px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtEquity}},{prop:"curMergeProportion",label:"合并比例(本期)",width:"120px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtEquity}},{prop:"preMergeProportion",label:"合并比例(上期)",width:"120px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtEquity}},{prop:"mergeScope",label:"合并范围",miniWidth:"120px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtMergeScope}},{prop:"causeDescription",label:"原因说明",width:"120px",filterOptions:{disabled:!0}},{prop:"mergeProjectName",label:"项目名称",width:"180px",filterOptions:{disabled:!0}},{prop:"projectSource",label:"项目来源",width:"120px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtSource}},{prop:"trialBalanceStatus",label:"是否导入试算平衡表",width:"160px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtCheckStatus},fixed:"right"},{prop:"reportStatus",label:"是否导入报表",width:"160px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtCheckStatus},fixed:"right"},{prop:"noteStatus",label:"是否导入附注",width:"160px",flag:"a",disableToolbox:!0,filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtCheckStatus},fixed:"right"},{prop:"lastInitializationTimeDeal",label:"导入关联方交易汇总  ",width:"160px",flag:"a",disableToolbox:!0,filterOptions:{disabled:!0},formatter:{type:"function",value:this.formatterDate},fixed:"right"},{prop:"lastInitializationTimeContacts",label:"导入关联方对账",width:"160px",flag:"a",disableToolbox:!0,filterOptions:{disabled:!0},formatter:{type:"function",value:this.formatterDate},fixed:"right"},{prop:"lastInitializationTimeCashFlow",label:"导入关联方现流表对账",width:"160px",flag:"a",disableToolbox:!0,filterOptions:{disabled:!0},formatter:{type:"function",value:this.formatterDate},fixed:"right"}],tableDataList:[],mergeScope:1,uploadedCBData:{mergeProjectId:"",fileId:"",isParentNoteInfo:!1,fileType:""},dataLength:0,tableLoding:!1,fullscreenLoading:!1,queryConfig:function(t,a,r){e.fullscreenLoading=!0,e.$sacpApis.enterpriseList({customerId:e.curCustomerId,projectId:e.curProjectId,mergeScope:e.activeName,type:e.$constantVar.API_SACP_QUERY_COMPANY}).then(function(t){t.success&&(t.data.map(function(e){e.extractionRatio=parseFloat(100*e.extractionRatio).toFixed(2)+"%",e.incomeTaxRate=e.incomeTaxRate+"%"}),e.tableDataList=t.data,e.handleValidTotal())}).finally(function(){return e.fullscreenLoading=!1})},mergeScopeOptions:this.$DIC("合并范围"),projectSouce:this.$DIC("合并报表项目来源"),uploadFileList:[],uploadFileData:[],filedata:new FormData,setBorder:!0,validProjectTotal:0,passValid:0,failedValid:0,isShowProjectPanorama:!1,curCustomerId:"",curProjectId:"",curAccYear:"",menuId:"HB002-MC001",activeLabel:"",isInit:!0,auditAjustmnetData:[],adjustTableData:[],importFileName:"",importFilePath:"",selList:[],userDefined:"",oldTableData:{},showDebLabel:"",activeName:"1",oldActieRowData:{},causeDescription:"",causeDescriptionCache:"",haschangeMergeScope:!1,dialogTableVisible:!1,uploadFileListDialogTableVisible:!1,fileListColumns:[{prop:"autoId",label:"处理",width:"170px",fixed:!0,filterOptions:{disabled:!0}},{prop:"fileName",label:"文件名称",fixed:!0,filterOptions:{disabled:!0}},{prop:"uploadDate",label:"上传时间",fixed:!0,formatter:{type:"function",value:this.formatterDate},filterOptions:{disabled:!0}},{prop:"userName",label:"上传人",fixed:!0,filterOptions:{disabled:!0}}],fileList:[],uploadedData:{},dealVisible:!1,uploadDealFileList:[],dealParam:{},tabActive:"5",tabData:[],tabTitle:[],cuRmergeProjectId:5,contactData:[],transactionDialogVisible:!1,tabName:"5",curRow:{},tableColumns:[],mergeProjectName:"",ENV_ROUTE:S,uploadCashFlowStatementFileList:[],cashFlowStatementVisible:!1,viewCashFlowMerchantVisible:!1,viewCashFlowMerchantColumns:[],viewCashFlowMerchantData:[],viewCashFlowMerchantDataLength:0,diffDetailData:[]}},methods:{dialogTable:function(){if(0==this.uploadCashFlowStatementFileList.length)return this.$message.error("请先上传文件！"),!1;this.checkCashFlowMerchantFile()},toggleSelection:function(e){var t=this;e?e.forEach(function(e){t.$refs.multipleTable.toggleRowSelection(e)}):this.$refs.multipleTable.clearSelection()},handleSelectionChange:function(e){this.multipleSelection=e},downloadInternalTradingDataTemplate:function(){var e=this;this.$sacpApis.downloadInternalTradingDataTemplate({id:this.curRow.mergeProjectId}).then(function(e){e.success}).catch(function(t){e.$message.error()})},goAssociatedTransactionVoucherTable:function(e){var t="";t=window.location.protocol+"//"+window.location.host;var a=e.mergeProjectName.split("-")[1]?e.mergeProjectName.split("-")[1]:e.mergeProjectName.split("-")[0],r=e.mergeCustomerName.split("-")[1]?e.mergeCustomerName.split("-")[1]:e.mergeCustomerName.split("-")[0],i=sessionStorage.getItem("curCustomerData"),s=JSON.parse(i),n=s.curCustomerId,l=s.curProjectId,c=JSON.parse(o()(sessionStorage.getItem("menuID")));window.open(t+S+"#/associatedTransactionVoucherTable?type=true&curCustomerId="+e.mergeCustomerId+"&curCustomerName="+r+"&preProjectId="+e.mergeProjectId+"&curProjectName="+a+"&mergeProjectId="+l+"&mergeCustomerId="+n+"&menuID="+c)},internalTransaction:function(e){var t="";t=window.location.protocol+"//"+window.location.host;var a=e.mergeProjectName,r=e.mergeCustomerName,i=e.mergeCustomerId,s=e.mergeProjectId,n=a.split("-"),l=r.split("-"),c=n[1]?n[1]:n[0],u=l[1]?l[1]:l[0],m=t+S+"#/index",d=sessionStorage.getItem("curCustomerData"),p=JSON.parse(d),f=p.curCustomerId,h=p.curProjectId,g=p.curYear,b={type:!0,curCustomerId:i,curCustomerName:u,curProjectId:s,curProjectName:c,mergeProjectId:h,mergeCustomerId:f,menuID:JSON.parse(o()(sessionStorage.getItem("menuID"))),curAccYear:g,mergeProjectName:a,mergeCustomerName:r,active:5};window.sessionStorage.setItem("mergeQuery",o()(b)),window.open(m)},cashFlowStatement:function(e){var t="";t=window.location.protocol+"//"+window.location.host;var a=e.mergeProjectName,r=e.mergeCustomerName,i=e.mergeCustomerId,s=e.mergeProjectId,n=a.split("-"),l=r.split("-"),c=n[1]?n[1]:n[0],u=l[1]?l[1]:l[0],m=t+"/Faith/auditReport/index.html#/index",d=sessionStorage.getItem("curCustomerData"),p=JSON.parse(d),f=p.curCustomerId,h=p.curProjectId,g=p.curYear,b=JSON.parse(o()(sessionStorage.getItem("menuID")));window.open(m+"?type=true&curCustomerId="+i+"&curCustomerName="+u+"&curProjectId="+s+"&curProjectName="+c+"&mergeProjectId="+h+"&mergeCustomerId="+f+"&menuID="+b+"&curAccYear="+g+"&mergeProjectName="+a+"&mergeCustomerName="+r+"&active=5")},downloadFileMerge:function(){var e={param1:this.curRow.mergeProjectId};this.$sacpApis.downloadContactsImportTemplate(e,"内部往来数据导入模板.xlsx")},importFileFun:function(e){var t=this,a={param1:o()(e)};this.$sacpApis.parseInternalTransactionDocuments(a).then(function(e){e.success?(t.$message.success("导入成功"),t.mergeFileVisible=!1,t.mergeScopeInit()):t.$message.error(e.resultInfo.statusText)}).catch(function(e){return t.$message.error(e)}).finally(function(){t.uploadFileRemove(),t.fullscreenLoading=!1})},updataEnter:function(){var e=this;if(!this.uploadFileData||!this.uploadFileData.length)return this.$message.error("请上传文件!");this.filedata=new FormData,this.uploadFileData.map(function(t,a){e.filedata.append("file"+a,t)}),this.fullscreenLoading=!0,this.filedata.append("mergeProjectId",this.uploadedData.mergeProjectId),this.$sacpApis.bulkUpload(this.filedata).then(function(t){if(e.uploadFileRemove(),t.success)e.importFileFun(t.data[0]),e.queryConfig();else{var a=t.resultInfo.statusText;e.$message.error(a)}}).catch(function(t){return e.$message.error(t)}).finally(function(){e.uploadFileRemove(),e.fullscreenLoading=!1})},checkCashFlowMerchantFile:function(){var e=this,t=new FormData;t.append("file",this.uploadCashFlowStatementFileList[0]),this.$sacpApis.bulkUpload(t).then(function(t){if(t.success)e.importFileName=t.data[0].name,e.importFilePath=t.data[0].path,e.checkCashFlowMerchantOK();else{var a=t.resultInfo.statusText;e.$message.error(a)}}).catch(function(t){return e.$message.error(t)}).finally(function(){})},checkCashFlowMerchantOK:function(){var e=this,t=this.curRow,a=t.mergeCustomerId,r=t.mergeProjectId,o={customerId:t.customerId,projectId:t.projectId,mergeCustomerId:a,mergeProjectId:r,fileId:[{path:this.importFilePath,name:this.importFileName}]};this.$sacpApis.checkCashFlowMerchantFile(o).then(function(t){if(t.success){if(e.$message.success("上传成功!"),0===t.data[0].list.length){e.merChantFile([])}}else{var a=t.resultInfo.statusText;e.$message.error(a)}}).catch(function(e){}).finally(function(){})},merChantFile:function(e){var t=this;if(0===e.length){var a=this.curRow,r=a.mergeCustomerId,o=a.mergeProjectId,i={customerId:a.customerId,projectId:a.projectId,mergeCustomerId:r,mergeProjectId:o,fileId:[{path:this.importFilePath,name:this.importFileName}],projects:e};this.$sacpApis.importCashFlowMerchantFile(i).then(function(e){t.cashFlowStatementVisible=!1}).catch(function(e){}).finally(function(){})}},checkCashFlowMerchante:function(){var e=this;this.$sacpApis.checkCashFlowMerchant({projectId:this.projectId,menuId:this.projectId,customerId:this.customerId}).then(function(t){e.statusData=t.data[0].list}).catch(function(e){}).finally(function(){})},updataDealEnter:function(){var e=this;if(!this.uploadDealFileList||!this.uploadDealFileList.length)return this.$message.error("请上传文件!");this.fullscreenLoading=!0,this.filedata=new FormData,this.uploadDealFileList.map(function(t,a){e.filedata.append("file"+a,t)}),this.$sacpApis.bulkUpload(this.filedata).then(function(t){if(t.success)e.$message.success("上传成功!"),setTimeout(function(){e.fullscreenLoading=!1},2e3),e.dealVisible=!1,e.dealParam.jsonData=o()(t.data[0]),e.saveImportedInternalTradingData(),e.queryConfig();else{var a=t.resultInfo.statusText;e.$message.error(a)}}).catch(function(t){return e.$message.error(t)}).finally(function(){setTimeout(function(){e.fullscreenLoading=!1},2e3)})},saveImportedInternalTradingData:function(){var e=this;this.$sacpApis.saveImportedInternalTradingData(this.dealParam).then(function(t){if(t.success);else{var a=t.resultInfo.statusText;e.$message.error(a)}}).catch(function(t){return e.$message.error(t)}).finally(function(){})},importFileMerge:function(e){this.curRow=e.row,this.uploadedData.mergeProjectId=e.row.mergeProjectId,this.mergeFileVisible=!0,this.uploadFileData=[]},importDealData:function(e){this.curRow=e.row;var t=e.row,a=t.mergeCustomerId,r=t.mergeProjectId,o=t.mergeCustomerName,i=t.mergeProjectName;this.dealParam={param1:a,param2:r,param3:o,param4:i},this.dealVisible=!0,this.uploadDealFileList=[]},uploadFileRemove:function(e,t){this.uploadFileData=[]},uploadFileChange:function(e,t){this.uploadFileData.push(e.raw)},uploadDealFileRemove:function(e,t){this.uploadDealFileList=[]},uploadDealFileChange:function(e,t){this.uploadDealFileList.push(e.raw)},uploadClose:function(){this.uploadedData.mergeProjectId="",this.mergeFileVisible=!1,this.uploadFileData=[]},uploadDealClose:function(){this.dealVisible=!1,this.uploadDealFileList=[]},fillChangeMergeScopeReason:function(){return this.mergeScopeEditFormData.curMergeProportion&&(this.mergeScopeEditFormData.curMergeProportion>50&&"0"===this.mergeScopeEditFormData.mergeScope||this.mergeScopeEditFormData.curMergeProportion<=50&&"1"===this.mergeScopeEditFormData.mergeScope)?(this.haschangeMergeScope=!0,this.mergeUploadDialogVisible=!0,!1):(this.haschangeMergeScope=!1,this.mergeUploadDialogVisible=!1,!0)},handleReviewUploadFile:function(e){var t=this;this.uploadFileListDialogTableVisible=!0,this.fullscreenLoading=!0,this.$sacpApis.hbMergeProjectQueryHbFile({jsonData:o()({mergeProjectId:e.row.mergeProjectId})}).then(function(e){e.success?t.fileList=e.data||[]:t.$message.error(e.resultInfo.statusText)}).catch(function(e){return t.$message.error(e)}).finally(function(){t.fullscreenLoading=!1})},reviewFile:function(e){if(!e.row.fileName||e.row.fileName.indexOf(".xlsx")>-1||e.row.fileName.indexOf(".zip")>-1)return this.$message.error("预览功能仅支持图片和PDF类型文件!");var t=this.$router.resolve({name:"PreviewPdf",query:{randomNum:e.row.autoId}}).href;window.open(t,"_blank")},deleteFile:function(e){var t=this;this.fullscreenLoading=!0,this.$sacpApis.deleteAttachment(e.row.autoId).then(function(a){a.success?t.$message.success("删除成功!")&&t.handleReviewUploadFile(e):t.$message.error(a.resultInfo.statusText)}).catch(function(e){return t.$message.error(e)}).finally(function(){t.fullscreenLoading=!1})},downloadFile:function(e){var t=window.location.origin+"/Faith/dgCenter/HbMergeProject.downloadAttachment.json?param1="+e.row.autoId;window.open(t,"_blank")},handleInitData:function(e){var t=this,a="";a=e.row.hasChildAdjust?"初始化子公司数据会删除子公司的试算平衡表、审定报表，确认要初始化吗？":"初始化子公司数据会删除子公司的试算平衡表、审定报表、子公司审计调整数据，确认要初始化吗？",this.$confirm(a,"确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.row.hasChildAdjust?t.$confirm("是否保留分录","确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.confirmInitData(e,!0)}).catch(function(){return t.confirmInitData(e,!1)}):t.confirmInitData(e,!1)}).catch(function(e){})},diffShow:function(e){var t=this;this.diffFlag=!0;this.$sacpApis.getDiffChildDetail({mergeProjectId:2020043047,type:0}).then(function(e){e.data&&(t.diffDetailData=e.data[0])}).catch(function(e){return t.$message.error(e)}).finally(function(){return t.fullscreenLoading=!1})},closeDiffDialog:function(){this.diffFlag=!1},commafyFn:function(e){var t=e.cellValue;e.row,e.column;return m.a.commafy(t,{digits:2})},cellClassName:function(e){var t=e.row,a=e.column;return"auditAmount"===a.property&&t.auditAmount!==t.preAuditAmount?"col-red":"preAuditAmount"===a.property&&t.auditAmount!==t.preAuditAmount?"col-red":void 0},confirmInitData:function(e,t){var a=this;this.fullscreenLoading=!0;var r={mergeProjectId:e.row.mergeProjectId,retainChildAdjust:t};this.$sacpApis.getInitSingleCompanyData(r).then(function(e){e.success?(a.$message.success("初始化数据成功!"),a.$eventBus.$emit("page-refresh",e.resultInfo.refreshIndexes)):a.$message.error(e.resultInfo.statusText)}).catch(function(e){return a.$message.error(e)}).finally(function(){return a.fullscreenLoading=!1})},uploadChange:function(e,t){if(this.uploadFileList.some(function(t){return t.name==e.name}))return this.$message.warning("不可以重复上传相同文件名文件,请删除!");this.uploadFileList.push(e.raw)},causeDescriptionChange:function(e){this.causeDescriptionCache=this.causeDescription},confirUpload:function(){var e=this;if(0==this.uploadFileList.length||!this.uploadFileList.length)return this.$message.error("请上传文件!");if(this.filedata=new FormData,this.uploadFileList.map(function(t,a){e.filedata.append("file"+a,t)}),this.haschangeMergeScope){if(!this.causeDescription.trim())return this.$message.error("请填写说明原因!");this.handleUplaodReasonFile()}else this.handleUploadSuccess()},handleUplaodReasonFile:function(){var e=this;this.fullscreenLoading=!0,this.filedata.append("mergeProjectId",this.mergeScopeEditFormData.mergeProjectId),this.$sacpApis.hbMergeProjectBatchUploadbulkUpload(this.filedata).then(function(t){if(t.success)e.$message.success("上传成功!"),setTimeout(function(){e.fullscreenLoading=!1},2e3);else{var a=t.resultInfo.statusText;e.$message.error(a)}}).catch(function(t){return e.$message.error(t)}).finally(function(){e.clearUploadData(),e.mergeUploadDialogVisible=!1,e.causeDescription="",e.dialogVisible=!1,e.haschangeMergeScope=!1,setTimeout(function(){e.fullscreenLoading=!1},2e3)})},handleUploadSuccess:function(){var e=this;this.fullscreenLoading=!0,this.$sacpApis.bulkUpload(this.filedata).then(function(t){if(t.success)setTimeout(function(){e.fullscreenLoading=!1},2e4),e.uploadSuccessCB(t.data);else{var a=t.resultInfo.statusText;e.$message.error(a)}}).catch(function(t){return e.$message.error(t)}).finally(function(){e.clearUploadData(),e.mergeUploadDialogVisible=!1,e.causeDescription="",e.dialogVisible=!1,setTimeout(function(){e.fullscreenLoading=!1},2e3)})},clearUploadData:function(){this.$refs.uploadExcel;this.excelFile="",this.excelName="",this.uploadFileList=[],this.filedata=new FormData,this.causeDescription=""},uploadSuccessCB:function(e){var t=this;this.uploadedCBData.fileId=e,this.$sacpApis.mergeScopeUploadCB(this.uploadedCBData).then(function(e){e.success?(t.$message.success("上传成功"),t.$eventBus.$emit("page-refresh",e.resultInfo.refreshIndexes)):t.$message.error(e.resultInfo.statusText)}).catch(function(e){t.$message.error(e)}).finally(function(){t.haschangeMergeScope=!1})},beforeRemove:function(e,t){this.uploadFileList=this.uploadFileList.filter(function(t){return t.name!=e.name})},cancelUpload:function(){this.mergeUploadDialogVisible=!1,this.uploadFileList=[],this.causeDescription="",this.causeDescriptionCache=""},handleMergeScopeProject:function(e){if(e){var t=this.mergeProjectNameList.filter(function(t){return t.projectid==e});this.mergeScopeEditFormData.mergeProjectId=t[0].projectid,this.mergeScopeEditFormData.mergeProjectName=t[0].projectname}},clearMergeProjectName:function(){this.$set(this.mergeScopeEditFormData,"mergeProjectName",""),this.$set(this.mergeScopeEditFormData,"mergeProjectId","")},submitEditDialogForm:function(e){var t=this;if(this.haschangeMergeScope&&!this.causeDescriptionCache)return this.fillChangeMergeScopeReason();this.mergeScopeEditFormData.causeDescription=this.causeDescriptionCache?this.causeDescriptionCache:this.mergeScopeEditFormData.causeDescription,this.$refs[e].validate(function(a){if(a){var r=JSON.parse(o()(t.mergeScopeEditFormData));r.extractionRatio=(Math.round(parseFloat(100*r.extractionRatio))/1e4).toFixed(4),t.$sacpApis.mergeScopeEditSave(r).then(function(a){a.success?(t.oldActieRowData.mergeScope!=t.mergeScopeEditFormData.mergeScope&&t.$store.commit("setRemoveAliveList","mergeScopeOut"),t.$eventBus.$emit("page-refresh",a.resultInfo.refreshIndexes),t.$message.success("编辑成功"),t.$refs[e].resetFields(),t.mergeScopeEditDialogTableVisible=!1,t.mergeScopeInit()):t.$message.error(a.resultInfo.statusText)}).catch(function(e){t.$message.error(e)}).finally(function(){t.causeDescription=""})}})},fmtProject:function(e,t){return e.mergeProjectId||e.mergeProjectName?-1!=e.mergeProjectName.indexOf("-")?e.mergeProjectName:e.mergeProjectId+"-"+e.mergeProjectName:"-"},fmtCheckStatus:function(e,t){switch(t){case"1":return"√";default:return"×"}},fmtEquity:function(e,t){return t+"%"},fmtMergeScope:function(e,t){switch(t){case"1":return"合并范围内";default:return"合并范围外且是关联方"}},fmtSource:function(e,t){switch(t){case"1":return"SACP";case"2":return"PM";case"3":return"非SACP报表审计";case"4":return"非SACP的BDO境外审计";case"5":return"非SACP其他事务所审计"}},editProject:function(e){this.haschangeMergeScope=!1,this.oldActieRowData=e,this.mergeProjectNameList=[];var t=this.mergeScopeEditFormData;this.mergeScopeEditDialogTableVisible=!0,t.autoId=e.autoId,t.checkStatus=e.checkStatus,t.customerId=e.customerId,t.stockBreakRate=e.stockBreakRate,t.mergeCustomerId=e.mergeCustomerId,t.mergeCustomerName=e.mergeCustomerName,t.mergeFinanceReportType=e.mergeFinanceReportType,t.mergeProjectId=e.mergeProjectId,t.mergeProjectName=e.mergeProjectName,t.isUnitChildProject=e.isUnitChildProject,t.mergeScope=e.mergeScope,t.noteStatus=e.noteStatus,t.projectSource=e.projectSource,t.reportStatus=e.reportStatus,t.shortName=e.shortName,t.trialBalanceStatus=e.trialBalanceStatus,t.equityRatio=e.equityRatio,t.curMergeProportion=e.curMergeProportion,t.preMergeProportion=e.preMergeProportion,e.incomeTaxRate=e.incomeTaxRate.replace("%",""),t.incomeTaxRate=e.incomeTaxRate,e.extractionRatio=e.extractionRatio.replace("%",""),t.extractionRatio=Math.round(parseFloat(100*e.extractionRatio).toFixed(2))/100,t.uscc=e.uscc,t.projectId=this.curProjectId,this.getProjectNameList(t.mergeCustomerId)},delProject:function(e,t,a){var r=this,o={autoIds:e};this.$sacpApis.mergeScopeDelete(o).then(function(e){e.success?(r.$message.success("删除成功"),r.mergeScopeInit(),r.$eventBus.$emit("page-refresh",e.resultInfo.refreshIndexes)):r.$message.error(e.resultInfo.statusText)}).catch(function(e){r.$message.error(e)})},openView:function(e,t){switch(t){case"QUERY_TB":if("1"!==e.trialBalanceStatus)return void this.$message("试算平衡表未导入！");var a="";a=-1!=e.mergeProjectName.indexOf("-")?e.mergeProjectName:e.mergeProjectId+"-"+e.mergeProjectName;var r={customerId:e.customerId,mergeCustomerName:e.mergeCustomerName,projectId:a,type:t,curYear:this.curAccYear,mergeCustomerId:e.mergeCustomerId};sessionStorage.setItem("projectItem",o()(r)),this.checkTb(r);break;case"QUERY_REPORT":if("1"!==e.reportStatus)return void this.$message("审定报表未导入！");a="";a=-1!=e.mergeProjectName.indexOf("-")?e.mergeProjectName:e.mergeProjectId+"-"+e.mergeProjectName;r={customerId:e.customerId,mergeCustomerName:e.mergeCustomerName,projectId:a,type:t,curYear:this.curAccYear,mergeCustomerId:e.mergeCustomerId};sessionStorage.setItem("projectItem",o()(r)),this.checkReport(r);break;case"note":if("0"===e.noteStatus)return void this.$parent.$message("附注未导入！");a="";a=-1!=e.mergeProjectName.indexOf("-")?e.mergeProjectName:e.mergeProjectId+"-"+e.mergeProjectName;r={customerId:e.customerId,mergeCustomerName:e.mergeCustomerName,projectId:a,type:"",mergeCustomerId:e.mergeCustomerId};sessionStorage.setItem("projectItem",o()(r)),this.checkNote(r)}},checkTb:function(e){var t=this.$router.resolve({path:"/checkTb",query:{curYear:e.curYear,menuID:"HB002-MC004-0001"}}).href;window.open(t,"_blank")},checkReport:function(e){var t=this.$router.resolve({path:"/checkReport",query:{curYear:e.curYear,menuID:"HB002-MC005-001"}}).href;window.open(t,"_blank")},checkNote:function(e){var t=this.$router.resolve({path:"/checkNote",query:{curYear:e.curYear}}).href;window.open(t,"_blank")},calcTaskProgress:function(e,t){return t?Math.round(e/t*100):0},importFile:function(e){this.uploadedCBData.mergeProjectId=e.row.mergeProjectId,this.mergeUploadDialogVisible=!0,this.uploadFileList=[],this.causeDescription="",this.haschangeMergeScope=!1},reload:function(){this.$refs.table.reload()},getProjectNameList:function(e){var t=this,a={customerId:e};this.$sacpApis.reachProjectInfo(a).then(function(e){e.success?e.data&&e.data.find(function(e){var a={projectid:e.projectId,projectname:e.ProjectName};t.mergeProjectNameList.push(a)}):t.$message.error(e.resultInfo.statusText)}).catch(function(e){t.$message.error(e)})},isRefreshDataLength:function(e){this.dataLength=e},handleValidTotal:function(){var e=this;this.$sacpApis.mergeScopeValidTotal({activeName:this.activeName}).then(function(t){if(t.success){var a=t.data[0],r=a.checkPassNumber,o=a.checkFailureNumber,i=a.projectSize,s=a.directionStatusCheck;e.passValid=r,e.failedValid=o,e.validProjectTotal=i,e.$emit("dialogState",s)}else e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)}).finally()},handleCurstomerId:function(){var e=JSON.parse(sessionStorage.getItem("curCustomerData"));this.curCustomerId=e.curCustomerId,this.curProjectId=e.curProjectId,this.curAccYear=e.curYear},mergeScopeInit:function(){var e=this;this.fullscreenLoading=!0,this.$sacpApis.enterpriseList({customerId:this.curCustomerId,projectId:this.curProjectId,mergeScope:this.activeName}).then(function(t){t.success?t.data?(t.data.map(function(e){e.extractionRatio=parseFloat(100*e.extractionRatio)+"%",e.incomeTaxRate=e.incomeTaxRate+"%"}),e.tableDataList=t.data,e.dataLength=e.tableDataList.length,e.handleValidTotal()):e.dataLength=0:e.$message.error(t.resultInfo.statusText)}).catch(function(t){e.$message.error(t)}).finally(function(){e.fullscreenLoading=!1,e.$store.commit("setMergeScopeRefresh",!1)})},formatterDate:function(e,t){return m.a.toDateString(t,"yyyy-MM-dd HH:mm:ss")},hasChildAdjust:function(){if(this.tableDataList&&this.tableDataList.length)return this.tableDataList.some(function(e){return e.hasChildAdjust})},deleteOldContactsData:function(e){var t=this;this.$confirm("是否要删除子公司关联方交易汇总  ？","确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.fullscreenLoading=!0,t.$sacpApis.deleteOldContactsData({param1:e.mergeProjectId}).then(function(e){e.success?(t.$message.success("删除成功!"),t.queryConfig()):t.$message.error(e.resultInfo.statusText)}).catch(function(e){t.$message.error(e)}).finally(function(){t.fullscreenLoading=!1})}).catch(function(e){})},deleteOldTransactionData:function(e){var t=this;this.$confirm("是否要删除该条往来数据？","确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.fullscreenLoading=!0,t.$sacpApis.deleteOldTransactionData({param1:e.mergeProjectId}).then(function(e){e.success?(t.fullscreenLoading=!1,t.$message.success("删除成功!"),t.queryConfig()):t.$message.error(e.resultInfo.statusText)}).catch(function(e){t.$message.error(e)}).finally(function(){t.fullscreenLoading=!1})}).catch(function(e){})},clearCashFlowMerchantFile:function(e){var t=this;this.$confirm("是否删除该子公司项目所有现流表关联方对账？","确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.fullscreenLoading=!0;var a=e.mergeCustomerId,r=e.mergeProjectId,o={customerId:e.customerId,projectId:e.projectId,mergeCustomerId:a,mergeProjectId:r};t.$sacpApis.clearCashFlowMerchant(o).then(function(a){a.success?(t.$message.success("删除成功!"),e.lastInitializationTimeCashFlow=""):t.$message.error(a.resultInfo.statusText)}).catch(function(e){t.$message.error(e)}).finally(function(){t.fullscreenLoading=!1})}).catch(function(e){})},querySingleInsideTransactionSummaryData:function(e){var t=this;this.transactionDialogVisible=!0,e&&e.row&&(this.cuRmergeProjectId=e.row.mergeProjectId);var a={param1:this.tabActive,param2:this.cuRmergeProjectId};this.$sacpApis.querySingleInsideTransactionSummaryData(a).then(function(e){e.success?t.tabData=e.data:t.$message.error(e.resultInfo.statusText)}).catch(function(e){t.$message.error(e)}).finally(function(){t.fullscreenLoading=!1})},queryMerchantInsideClassify:function(e){var t=this;this.transactionDialogVisible=!0,this.mergeProjectId=e.mergeProjectId,this.mergeProjectName=e.mergeProjectName,this.$sacpApis.queryMerchantInsideClassify().then(function(a){a.success?(t.tableColumns=a.data,t.$nextTick(function(){t.$refs.tableType.tabItemList(a.data,e.mergeProjectId)})):t.$message.error(a.resultInfo.statusText)}).catch(function(e){t.$message.error(e)}).finally(function(){t.fullscreenLoading=!1})},queryContactSummary:function(e){var t=this;this.$nextTick(function(){t.$refs.autoGenerationOffsetTable.queryContactSummary(e.row.mergeProjectId,e.row.shortName)})},handleClose:function(e){this.transactionDialogVisible=!1},importRelatedParty:function(e){this.curRow=e.row,this.cashFlowStatementVisible=!0,this.uploadCashFlowStatementFileList=[]},uploadCashFlowStatementClose:function(){this.cashFlowStatementVisible=!1,this.uploadCashFlowStatementFileList=[]},uploadcashFlowStatementFileRemove:function(e,t){this.uploadCashFlowStatementFileList=[]},uploadcashFlowStatementFileChange:function(e,t){this.uploadCashFlowStatementFileList.push(e.raw)},downCashFlowMerchantFileTemp:function(){var e=this,t=this.curRow,a=t.mergeCustomerId,r=t.mergeProjectId,o={customerId:t.customerId,projectId:t.projectId,mergeCustomerId:a,mergeProjectId:r};this.$sacpApis.downCashFlowMerchantFileTemp(o,"关联方现流表对账").then(function(e){e.success}).catch(function(t){e.$message.error()})},updataCashFlowStatementEnter:function(){var e=this;if(!this.uploadCashFlowStatementFileList||!this.uploadCashFlowStatementFileList.length)return this.$message.error("请上传文件!");this.fullscreenLoading=!0,this.filedata=new FormData,this.uploadCashFlowStatementFileList.map(function(t,a){e.filedata.append("file"+a,t)}),this.$sacpApis.bulkUpload(this.filedata).then(function(t){if(t.success)e.fullscreenLoading=!1,e.importCashFlowMerchantFile(t.data);else{var a=t.resultInfo.statusText;e.$message.error(a)}}).catch(function(t){return e.$message.error(t)}).finally(function(){e.fullscreenLoading=!1,e.cashFlowStatementVisible=!1})},importCashFlowMerchantFile:function(e){var t=this,a=this.curRow,r=a.mergeCustomerId,o=a.mergeProjectId,i={customerId:a.customerId,projectId:a.projectId,mergeCustomerId:r,mergeProjectId:o,fileId:e};this.$sacpApis.importCashFlowMerchantFile(i).then(function(e){e.success?(t.$message.success("上传成功!"),t.cashFlowStatementVisible=!1,t.queryConfig()):t.$message.error(e.resultInfo.statusText)}).catch(function(e){return t.$message.error(e)}).finally(function(){t.cashFlowStatementVisible=!1})},importFiles:function(e,t){this[e.trim()](t)},looks:function(e,t){this[e.trim()](t.row)},viewCashFlowMerchant:function(e){var t=this;this.fullscreenLoading=!0,e&&(this.curRow=e),this.viewCashFlowMerchantVisible=!0;var a=this.curRow,r=a.mergeCustomerId,o=a.mergeProjectId,i=a.customerId,s=a.projectId,n=a.mergeProjectName;this.mergeProjectName=n;var l={customerId:i,projectId:s,mergeCustomerId:r,mergeProjectId:o};this.$sacpApis.viewCashFlowMerchant(l).then(function(e){if(e.success){var a=e.data[0];if(e.data&&a&&a.list){var r=a.customerNameList,o=[{prop:"colDisp",label:"项目","min-width":"270px"}];for(var i in r[0])i.search("mergeCustomerName")>-1&&o.push({label:r[0][i],prop:"amount"+i.split("mergeCustomerName")[1],align:"right","min-width":"200px",formatter:{type:"function",value:t.commafy}});o.push({prop:"sumAmount",label:"合计",align:"right","min-width":"130px",formatter:{type:"function",value:t.commafy}}),t.viewCashFlowMerchantColumns=o,a.list.forEach(function(e){e.colDisp=e.colDisp?e.colDisp.replaceAll(" "," "):""}),t.viewCashFlowMerchantData=a.list,t.viewCashFlowMerchantDataLength=a.list.length}else t.viewCashFlowMerchantData=[]}else t.$message.error(e.resultInfo.statusText)}).catch(function(e){t.$message.error(e)}).finally(function(){t.fullscreenLoading=!1})},isRefreshviewCashFlowMerchantDataLength:function(e){this.viewCashFlowMerchantDataLength=e},handLeviewCashFlowMerchantClose:function(){this.viewCashFlowMerchantVisible=!1},commafy:function(e,t){return m.a.commafy(t,{digits:2})},queryViewCashFlowMerchant:function(){this.viewCashFlowMerchant()},cellStyle:function(){return{"white-space":"pre"}},exportFile:function(){this.exportExcel()},getChildTbData:function(){var e=this;this.$sacpApis.getCheckChildTbData({customerId:this.curCustomerId,projectId:this.curProjectId}).then(function(t){var a="";if(t.data)for(a in t.data[0])e.differences.push(a);return e.differences})},exportExcel:function(){var e=this,t={param1:this.curCustomerId,param2:this.curProjectId,param3:this.activeName,type:this.$constantVar.API_SACP_QUERY_COMPANY,queryUrl:"dgCenter/HbMergeProject.enterpriseList.json",columnMap:[]};this.columnsList.forEach(function(e,a){a>0&&t.columnMap.push({cnName:e.label,enName:e.prop,size:e.width?e.width.replace("px",""):"",className:e.align?"text-"+e.align:"text-left",renderer:"mergeScope"===e.prop?"getDicLabelByVal|"+e.label:""})});var a={myParams:o()(t),title:window.encodeURI("合并范围内.xlsx")};this.$sacpApis.exportExcel(a,"合并范围内.xlsx").then(function(t){t.success?e.$message.success("下载成功!"):e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)}).finally(function(){})}},activated:function(){var e=this;this.$eventBus.$off("click-tab").$on("click-tab",function(t){t&&t.indexId===e.flag&&t.isMark&&e.mergeScopeInit()})},created:function(){this.handleCurstomerId(),this.selList=this.$DIC("借贷"),this.mergeScopeOptions=this.$DIC("合并范围"),this.getChildTbData()}},D={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"mergeScopeIn"},[a("bdo-table",{ref:"table",attrs:{columns:e.columnsList,"enable-filter":!1,"enable-toolbox":!1,"enable-view-type":!1,data:e.tableDataList,"page-total":e.dataLength,"responsive-height-gap":e.bodyHeight,showIndexColumn:!1,showCheckBox:!1,tableLoding:e.tableLoding,queryConfig:e.queryConfig,setBorder:e.setBorder,exportReport:!1},on:{isRefreshDataLength:e.isRefreshDataLength,exportFile:e.exportFile},scopedSlots:e._u([{key:"col-mergeCustomerName",fn:function(t){return[e._v("\n            "+e._s(t.row.mergeCustomerName)+"\n            "),"1"==t.row.isUnitChildProject?a("span",{staticStyle:{color:"rgb(230 162 60)",display:"inline-block",padding:"0px 5px",background:"rgb(253 246 236)",border:"1px solid #ccc","border-radius":"5px"}},[e._v("\n                母公司")]):e._e()]}},{key:"col-autoId",fn:function(t){return[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"编辑",placement:"top-start"}},[a("el-button",{staticClass:"editBtnCol",attrs:{size:"small",type:"text",icon:"el-icon-edit-outline normalWeight"},on:{click:function(a){return e.editProject(t.row)}}})],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"查看上传文件",placement:"top-start"}},[a("el-button",{staticClass:"activeBtnCol",attrs:{size:"small",type:"text",icon:"el-icon-document-copy normalWeight"},on:{click:function(a){return e.handleReviewUploadFile(t)}}})],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"初始化数据",placement:"top-start"}},[a("el-button",{staticClass:"setBtn",staticStyle:{color:"#fff"},attrs:{size:"small",type:"text",circle:"",icon:"el-icon-switch-button"},on:{click:function(a){return e.handleInitData(t)}}})],1),e._v(" "),a("el-dropdown",{attrs:{placement:"top",trigger:"click"},on:{command:function(a){e.importFiles(a,t)}}},[a("el-button",{staticStyle:{"margin-left":"5px"},attrs:{type:"primary",circle:"",size:"small",icon:"el-icon-upload normalWeight"}}),e._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{disabled:!t.row.mergeProjectName,command:"importFile"}},[e._v("\n                        导入报表\n                    ")]),e._v(" "),a("el-dropdown-item",{attrs:{command:"importFileMerge"}},[e._v("\n                        导入关联方对账\n                    ")]),e._v(" "),a("el-dropdown-item",{attrs:{command:"importDealData"}},[e._v("\n                        导入关联方交易汇总\n                    ")]),e._v(" "),a("el-dropdown-item",{attrs:{command:"importRelatedParty"}},[e._v("\n                        导入关联方现流表对账\n                    ")])],1)],1),e._v(" "),a("el-dropdown",{staticStyle:{"margin-left":"5px"},attrs:{placement:"top",trigger:"click"},on:{command:function(a){e.looks(a,t)}}},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"查看",placement:"top-start"}},[a("el-button",{attrs:{type:"primary",size:"small",circle:"",icon:"el-icon-search"}})],1),e._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{command:"\n                                goAssociatedTransactionVoucherTable\n                            "}},[e._v("\n                        查看关联方对账\n                    ")]),e._v(" "),a("el-dropdown-item",{attrs:{command:"internalTransaction"}},[e._v("\n                        查看关联方交易汇总\n                    ")]),e._v(" "),a("el-dropdown-item",{attrs:{command:"cashFlowStatement"}},[e._v("\n                        查看现金流量表对账\n                    ")])],1)],1)]}},{key:"col-trialBalanceStatus",fn:function(t){return["1"===t.row.trialBalanceStatus?a("el-button",{attrs:{size:"small",type:"text"},on:{click:function(a){return e.openView(t.row,"QUERY_TB")}}},[e._v("查看\n                "),t.row.checkTb?e.differences.indexOf(t.row.mergeProjectId)>-1?a("span",{staticClass:"errorInfo",on:{click:function(a){return a.stopPropagation(),e.diffShow(t.row)}}},[e._v("（存在差异）")]):e._e():a("span",{staticClass:"errorInfo"},[e._v("（校验错误）")]),e._v(" "),a("div",{staticClass:"time"},[e._v("\n                    "+e._s(e.formatterDate(t.row,t.row.lastInitializationTime))+"\n                ")])]):e._e(),e._v(" "),"1"!==t.row.trialBalanceStatus?a("span",[e._v("未导入")]):e._e()]}},{key:"col-reportStatus",fn:function(t){return["1"===t.row.reportStatus?a("el-button",{attrs:{size:"small",type:"text"},on:{click:function(a){return e.openView(t.row,"QUERY_REPORT")}}},[e._v("查看"),t.row.checkReport?e._e():a("span",{staticClass:"errorInfo"},[e._v("（校验错误）")]),e._v(" "),a("div",{staticClass:"time"},[e._v("\n                    "+e._s(e.formatterDate(t.row,t.row.lastInitializationTimeReport))+"\n                ")])]):e._e(),e._v(" "),"1"!==t.row.reportStatus?a("span",[e._v("未导入")]):e._e()]}},{key:"col-noteStatus",fn:function(t){return["1"===t.row.noteStatus||"2"===t.row.noteStatus?a("el-button",{attrs:{size:"small",type:"text"},on:{click:function(a){return e.openView(t.row,"note")}}},[e._v("查看\n                "),"2"===t.row.noteStatus&&"0"===t.row.checkStatus?a("span",{staticClass:"errorInfo"},[e._v("（校验错误）")]):e._e(),e._v(" "),"1"===t.row.noteStatus&&"1"===t.row.checkStatus?a("span",{staticClass:"errorInfo"},[e._v("(未校验)")]):e._e(),e._v(" "),a("div",{staticClass:"time"},[e._v("\n                    "+e._s(e.formatterDate(t.row,t.row.lastInitializationTimeNote))+"\n                ")])]):e._e(),e._v(" "),"0"!==t.row.noteStatus||"0"!==t.row.checkStatus&&"1"!==t.row.checkStatus?e._e():a("span",[e._v("未导入")])]}},{key:"col-lastInitializationTimeDeal",fn:function(t){return[t.row.lastInitializationTimeDeal?a("el-button",{attrs:{size:"small",type:"text"}},[a("span",{on:{click:function(a){return e.queryMerchantInsideClassify(t.row)}}},[e._v("\n                    查看\n                ")]),e._v(" "),a("span",{staticStyle:{color:"red"},on:{click:function(a){return e.deleteOldTransactionData(t.row)}}},[e._v("删除")]),e._v(" "),a("div",{staticClass:"time"},[e._v("\n                    "+e._s(e.formatterDate(t.row,t.row.lastInitializationTimeDeal))+"\n                ")])]):e._e()]}},{key:"col-lastInitializationTimeContacts",fn:function(t){return[t.row.lastInitializationTimeContacts?a("el-button",{attrs:{size:"small",type:"text"}},[a("span",{on:{click:function(a){return e.queryContactSummary(t)}}},[e._v("查看")]),e._v(" "),a("span",{staticStyle:{color:"red"},on:{click:function(a){return e.deleteOldContactsData(t.row)}}},[e._v("删除")]),e._v(" "),a("div",{staticClass:"time"},[e._v("\n                    "+e._s(e.formatterDate(t.row,t.row.lastInitializationTimeContacts))+"\n                ")])]):e._e()]}},{key:"col-lastInitializationTimeCashFlow",fn:function(t){var r=t.row;return[r.lastInitializationTimeCashFlow?a("el-button",{attrs:{size:"small",type:"text"}},[a("span",{on:{click:function(t){return e.viewCashFlowMerchant(r)}}},[e._v("查看")]),e._v(" "),a("span",{staticStyle:{color:"red"},on:{click:function(t){return e.clearCashFlowMerchantFile(r)}}},[e._v("删除")]),e._v(" "),a("div",{staticClass:"time"},[e._v("\n                    "+e._s(e.formatterDate(r,r.lastInitializationTimeCashFlow))+"\n                ")])]):e._e()]}}])},[e._v(" "),a("template",{slot:"text"},[a("div",{staticClass:"totalValidMessage"},[e._v("\n                项目数:"+e._s(e.validProjectTotal)+"件 校验通过:"+e._s(e.passValid)+"件\n                "),a("span",{class:e.failedValid?"errorInfo":""},[e._v("校验失败:"+e._s(e.failedValid)+"件")])])])],2),e._v(" "),a("el-dialog",{attrs:{title:e.haschangeMergeScope?"原因说明":"导入",visible:e.mergeUploadDialogVisible,"destroy-on-close":!0,"before-close":e.cancelUpload,width:"40%"},on:{"update:visible":function(t){e.mergeUploadDialogVisible=t}}},[a("div",[e.haschangeMergeScope?a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:5}},[a("span",{staticStyle:{color:"red"}},[e._v("* ")]),a("span",[e._v("原因说明:")])]),e._v(" "),a("el-col",{attrs:{span:19}},[a("el-input",{attrs:{type:"textarea",maxlength:"60","show-word-limit":""},on:{blur:e.causeDescriptionChange},model:{value:e.causeDescription,callback:function(t){e.causeDescription=t},expression:"causeDescription"}})],1)],1):e._e(),e._v(" "),a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:5}},[e.haschangeMergeScope?a("span",{staticStyle:{color:"red"}},[e._v("*\n                    ")]):e._e()]),e._v(" "),a("el-col",{staticClass:"reasonUpload",attrs:{span:e.haschangeMergeScope?19:24}},[a("el-upload",{ref:"uploadFile",staticClass:"uploadTool",attrs:{drag:"",action:"",multiple:"","file-list":e.uploadFileList,accept:e.haschangeMergeScope?".xlsx,.zip,.jpg,.pdf,.png,.jpeg":".xlsx,.zip","auto-upload":!1,"on-change":e.uploadChange,"on-remove":e.beforeRemove}},[a("i",{staticClass:"el-icon-upload"}),e._v(" "),a("div",{staticClass:"el-upload__text"},[e._v("\n                            将文件拖到此处，或"),a("em",[e._v("点击上传")]),e._v(" "),e.haschangeMergeScope?e._e():a("p",[e._v("\n                                只能上传excel或zip文件\n                            ")])])])],1)],1)],1),e._v(" "),a("div",{staticClass:"buttonList"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.confirUpload}},[e._v("确定")]),e._v(" "),a("el-button",{attrs:{type:"info",size:"small"},on:{click:e.cancelUpload}},[e._v("取消")])],1)]),e._v(" "),a("el-dialog",{attrs:{title:"编辑",visible:e.mergeScopeEditDialogTableVisible,"destroy-on-close":!0,width:"40%"},on:{"update:visible":function(t){e.mergeScopeEditDialogTableVisible=t}}},[a("el-form",{ref:"mergeScopeEditFormData",attrs:{model:e.mergeScopeEditFormData,rules:e.mergeScopedEditFormRule}},[a("el-form-item",{attrs:{label:"公司名称","label-width":e.formLabelWidth,prop:"mergeCustomerName"}},[a("el-input",{attrs:{disabled:""},model:{value:e.mergeScopeEditFormData.mergeCustomerName,callback:function(t){e.$set(e.mergeScopeEditFormData,"mergeCustomerName","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.mergeCustomerName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"项目简称","label-width":e.formLabelWidth,prop:"shortName"}},[a("el-input",{attrs:{type:"text"},model:{value:e.mergeScopeEditFormData.shortName,callback:function(t){e.$set(e.mergeScopeEditFormData,"shortName","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.shortName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"统一社会信用代码","label-width":e.formLabelWidth,prop:"uscc"}},[a("el-input",{attrs:{maxlength:"25"},model:{value:e.mergeScopeEditFormData.uscc,callback:function(t){e.$set(e.mergeScopeEditFormData,"uscc","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.uscc"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"认缴比例","label-width":e.formLabelWidth,prop:"stockBreakRate"}},[a("el-input",{model:{value:e.mergeScopeEditFormData.stockBreakRate,callback:function(t){e.$set(e.mergeScopeEditFormData,"stockBreakRate","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.stockBreakRate"}},[a("i",{staticClass:"percent",staticStyle:{"font-style":"normal"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("%")])])],1),e._v(" "),a("el-form-item",{attrs:{label:"权益比例","label-width":e.formLabelWidth,prop:"equityRatio"}},[a("el-input",{model:{value:e.mergeScopeEditFormData.equityRatio,callback:function(t){e.$set(e.mergeScopeEditFormData,"equityRatio","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.equityRatio"}},[a("i",{staticClass:"percent",staticStyle:{"font-style":"normal"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("%")])])],1),e._v(" "),a("el-form-item",{attrs:{label:"合并比例（本期）","label-width":e.formLabelWidth,prop:"curMergeProportion"}},[a("el-input",{on:{blur:e.fillChangeMergeScopeReason},model:{value:e.mergeScopeEditFormData.curMergeProportion,callback:function(t){e.$set(e.mergeScopeEditFormData,"curMergeProportion","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.curMergeProportion"}},[a("i",{staticClass:"percent",staticStyle:{"font-style":"normal"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("%")])])],1),e._v(" "),a("el-form-item",{attrs:{label:"合并比例（上期）","label-width":e.formLabelWidth,prop:"preMergeProportion"}},[a("el-input",{model:{value:e.mergeScopeEditFormData.preMergeProportion,callback:function(t){e.$set(e.mergeScopeEditFormData,"preMergeProportion","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.preMergeProportion"}},[a("i",{staticClass:"percent",staticStyle:{"font-style":"normal"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("%")])])],1),e._v(" "),a("el-form-item",{attrs:{label:" 所得税税率 %","label-width":e.formLabelWidth,prop:"incomeTaxRate"}},[a("el-input",{model:{value:e.mergeScopeEditFormData.incomeTaxRate,callback:function(t){e.$set(e.mergeScopeEditFormData,"incomeTaxRate","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.incomeTaxRate"}},[a("i",{staticClass:"percent",staticStyle:{"font-style":"normal"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("%")])])],1),e._v(" "),a("el-form-item",{attrs:{label:" 提取比例 %","label-width":e.formLabelWidth,prop:"extractionRatio"}},[a("el-input",{model:{value:e.mergeScopeEditFormData.extractionRatio,callback:function(t){e.$set(e.mergeScopeEditFormData,"extractionRatio","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.extractionRatio"}},[a("i",{staticClass:"percent",staticStyle:{"font-style":"normal"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("%")])])],1),e._v(" "),a("el-form-item",{staticClass:"mergeScopeSelect",attrs:{label:"合并范围","label-width":e.formLabelWidth,prop:"mergeScope"}},[a("el-select",{attrs:{placeholder:"请选择合并范围"},on:{change:e.fillChangeMergeScopeReason},model:{value:e.mergeScopeEditFormData.mergeScope,callback:function(t){e.$set(e.mergeScopeEditFormData,"mergeScope","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.mergeScope"}},e._l(e.mergeScopeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1),e._v(" "),e.haschangeMergeScope?a("div",{staticClass:"resetBtn",on:{click:function(t){e.mergeUploadDialogVisible=!0}}},[a("el-button",{attrs:{circle:"",size:"small",type:"primary",icon:"el-icon-edit-outline",title:"原因说明"}})],1):e._e()],1),e._v(" "),a("el-form-item",{staticClass:"projectSource",attrs:{label:"项目来源","label-width":e.formLabelWidth,prop:"projectSource"}},[a("el-select",{attrs:{placeholder:"请选择项目来源"},model:{value:e.mergeScopeEditFormData.projectSource,callback:function(t){e.$set(e.mergeScopeEditFormData,"projectSource","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.projectSource"}},e._l(e.projectSouce,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{staticClass:"projectName",attrs:{label:"项目名称","label-width":e.formLabelWidth,prop:"mergeProjectName"}},[a("el-select",{staticClass:"projectList",attrs:{placeholder:"请选择项目名称",clearable:"",filterable:""},on:{clear:e.clearMergeProjectName,change:e.handleMergeScopeProject},model:{value:e.mergeScopeEditFormData.mergeProjectName,callback:function(t){e.$set(e.mergeScopeEditFormData,"mergeProjectName","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.mergeProjectName"}},e._l(e.mergeProjectNameList,function(e,t){return a("el-option",{key:t,attrs:{label:e.projectname,value:e.projectid}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"是否母公司单体项目:"}},[a("el-radio-group",{staticClass:"isUnitChildProject",model:{value:e.mergeScopeEditFormData.isUnitChildProject,callback:function(t){e.$set(e.mergeScopeEditFormData,"isUnitChildProject",t)},expression:"mergeScopeEditFormData.isUnitChildProject"}},[a("el-radio",{attrs:{label:"0"}},[e._v("否")]),e._v(" "),a("el-radio",{attrs:{label:"1"}},[e._v("是")])],1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"info",size:"small"},on:{click:function(t){e.mergeScopeEditDialogTableVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.submitEditDialogForm("mergeScopeEditFormData")}}},[e._v("确 定")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"上传文件列表",visible:e.uploadFileListDialogTableVisible,"destroy-on-close":!0,width:"75%"},on:{"update:visible":function(t){e.uploadFileListDialogTableVisible=t}}},[a("bdo-table",{ref:"uploadFileTable",attrs:{columns:e.fileListColumns,"enable-filter":!1,"enable-toolbox":!1,"enable-view-type":!1,data:e.fileList,"page-total":e.fileList.length||0,"responsive-height-gap":e.bodyHeight,showIndexColumn:!0,enableHeadConfig:!1,headerListConfig:!0,enableRefresh:!1,showCheckBox:!1,setBorder:e.setBorder},scopedSlots:e._u([{key:"col-autoId",fn:function(t){return[a("el-button",{attrs:{title:"预览",size:"small",type:"text",icon:"el-icon-view normalWeight selfGreen"},on:{click:function(a){return e.reviewFile(t)}}}),e._v(" "),a("el-button",{attrs:{title:"删除文件",size:"small",type:"text",icon:"el-icon-delete normalWeight delBtnCol"},on:{click:function(a){return e.deleteFile(t)}}}),e._v(" "),a("el-button",{attrs:{title:"下载",size:"small",type:"text",icon:"el-icon-download normalWeight selfBlue"},on:{click:function(a){return e.downloadFile(t)}}})]}}])})],1),e._v(" "),a("el-dialog",{attrs:{title:"导入关联方对账",visible:e.mergeFileVisible,"destroy-on-close":!0,"before-close":e.uploadClose,width:"40%"},on:{"update:visible":function(t){e.mergeFileVisible=t}}},[a("div",[a("el-row",{attrs:{gutter:10}},[a("el-col",{staticClass:"reasonUpload",attrs:{span:24}},[a("el-upload",{ref:"uploadFile",staticClass:"uploadTool",attrs:{drag:"",limit:1,accept:".xlsx",action:"",multiple:"","file-list":e.uploadFileData,"auto-upload":!1,"on-change":e.uploadFileChange,"on-remove":e.uploadFileRemove}},[a("i",{staticClass:"el-icon-upload"}),e._v(" "),a("div",{staticClass:"el-upload__text"},[e._v("\n                            将文件拖到此处，或"),a("em",[e._v("点击上传")]),e._v(" "),a("p",[e._v("只能上传.xlsx文件")])])])],1)],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"下载内部往来数据导入模板",placement:"top-start"}},[a("el-button",{staticClass:"downloadBtnCol",attrs:{size:"small",type:"text",icon:"el-icon-download normalWeight"},on:{click:function(t){return e.downloadFileMerge()}}},[e._v("\n                    下载内部往来数据导入模板\n                ")])],1)],1),e._v(" "),a("div",{staticClass:"buttonList"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.updataEnter}},[e._v("确定")]),e._v(" "),a("el-button",{attrs:{type:"info",size:"small"},on:{click:e.uploadClose}},[e._v("取消")])],1)]),e._v(" "),a("el-dialog",{attrs:{title:"导入关联方交易汇总",visible:e.dealVisible,"destroy-on-close":!0,"before-close":e.uploadDealClose,width:"40%"},on:{"update:visible":function(t){e.dealVisible=t}}},[a("div",[a("el-row",{attrs:{gutter:10}},[a("el-col",{staticClass:"reasonUpload",attrs:{span:24}},[a("el-upload",{ref:"uploadFile",staticClass:"uploadTool",attrs:{drag:"",limit:1,accept:".xlsx",action:"",multiple:"","file-list":e.uploadDealFileList,"auto-upload":!1,"on-change":e.uploadDealFileChange,"on-remove":e.uploadDealFileRemove}},[a("i",{staticClass:"el-icon-upload"}),e._v(" "),a("div",{staticClass:"el-upload__text"},[e._v("\n                            将文件拖到此处，或"),a("em",[e._v("点击上传")]),e._v(" "),a("p",[e._v("只能上传.xlsx文件")])])])],1)],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"下载关联方交易汇总  导入模板",placement:"top-start"}},[a("el-button",{staticClass:"downloadBtnCol",attrs:{size:"small",type:"text",icon:"el-icon-bottom normalWeight"},on:{click:function(t){return e.downloadInternalTradingDataTemplate()}}},[e._v("\n                    下载关联方交易汇总 导入模板\n                ")])],1)],1),e._v(" "),a("div",{staticClass:"buttonList"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.updataDealEnter}},[e._v("确定")]),e._v(" "),a("el-button",{attrs:{type:"info",size:"small"},on:{click:e.uploadDealClose}},[e._v("取消")])],1)]),e._v(" "),a("el-dialog",{attrs:{title:"导入关联方现流表对账",visible:e.cashFlowStatementVisible,"destroy-on-close":!0,"before-close":e.uploadCashFlowStatementClose,width:"40%"},on:{"update:visible":function(t){e.cashFlowStatementVisible=t}}},[a("div",[a("el-row",{attrs:{gutter:10}},[a("el-col",{staticClass:"reasonUpload",attrs:{span:24}},[a("el-upload",{ref:"uploadFile",staticClass:"uploadTool",attrs:{drag:"",limit:1,accept:".xlsx",action:"","file-list":e.uploadCashFlowStatementFileList,"auto-upload":!1,"on-change":e.uploadcashFlowStatementFileChange,"on-remove":e.uploadcashFlowStatementFileRemove}},[a("i",{staticClass:"el-icon-upload"}),e._v(" "),a("div",{staticClass:"el-upload__text"},[e._v("\n                            将文件拖到此处，或"),a("em",[e._v("点击上传")]),e._v(" "),a("p",[e._v("只能上传.xlsx文件")])])])],1)],1),e._v(" "),e.cashFlowStatementVisible?a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"下载关联方现流表对账导入模板",placement:"top-start"}},[a("el-button",{staticClass:"downloadBtnCol",attrs:{size:"small",type:"text",icon:"el-icon-bottom normalWeight"},on:{click:function(t){return e.downCashFlowMerchantFileTemp()}}},[e._v("\n                    下载关联方现流表对账导入模板\n                ")])],1):e._e()],1),e._v(" "),a("div",{staticClass:"buttonList"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.dialogTable}},[e._v("确定")]),e._v(" "),a("el-button",{attrs:{type:"info",size:"small"},on:{click:e.uploadCashFlowStatementClose}},[e._v("取消")])],1)]),e._v(" "),a("el-dialog",{attrs:{title:"下列已确认完成的关联方列表，请选择哪些需要保存当前数据，哪些需要删除！(勾选为保留当前数据)",visible:e.dialogTableVisible},on:{"update:visible":function(t){e.dialogTableVisible=t}}},[a("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.tableData1,"tooltip-effect":"dark"},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),a("el-table-column",{attrs:{label:"客户",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.date))]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:"项目",width:"120"}})],1),e._v(" "),a("div",{staticStyle:{"margin-top":"20px"}},[a("el-button",{on:{click:function(t){return e.toggleSelection([e.tableData[1],e.tableData[2]])}}},[e._v("确定")]),e._v(" "),a("el-button",{on:{click:function(t){return e.toggleSelection()}}},[e._v("取消")])],1)],1),e._v(" "),a("el-dialog",{staticClass:"internalTransaction",attrs:{width:"80%",title:"关联方交易汇总 : "+this.mergeProjectName,visible:e.transactionDialogVisible,"before-close":e.handleClose},on:{"update:visible":function(t){e.transactionDialogVisible=t}}},[a("table-type",{ref:"tableType"})],1),e._v(" "),a("auto-generation-offset",{ref:"autoGenerationOffsetTable"}),e._v(" "),a("el-dialog",{staticClass:"internalTransaction",attrs:{width:"80%",title:"关联方现流表对账 : "+this.mergeProjectName,visible:e.viewCashFlowMerchantVisible,"before-close":e.handLeviewCashFlowMerchantClose},on:{"update:visible":function(t){e.viewCashFlowMerchantVisible=t}}},[a("bdo-table",{attrs:{columns:e.viewCashFlowMerchantColumns,"enable-filter":!1,"enable-toolbox":!1,"enable-view-type":!1,data:e.viewCashFlowMerchantData,"page-total":e.viewCashFlowMerchantDataLength,"responsive-height-gap":e.bodyHeight,showIndexColumn:!1,showCheckBox:!1,tableLoding:e.tableLoding,queryConfig:e.queryViewCashFlowMerchant,setBorder:e.setBorder,exportReport:!1,"cell-style":{"white-space":"pre !important"}}})],1),e._v(" "),a("el-dialog",{attrs:{title:"查看差异详情",width:"75%",visible:e.diffFlag,"destroy-on-close":!0,"before-close":e.closeDiffDialog},on:{"update:visible":function(t){e.diffFlag=t}}},[a("vxe-table",{ref:"diffTable",attrs:{border:"",resizable:"","row-key":"","show-overflow":"","highlight-hover-row":"",height:"480",data:e.diffDetailData,"cell-class-name":e.cellClassName,"edit-config":{trigger:"click",mode:"row"}}},[a("vxe-table-column",{attrs:{field:"subjectId",fixed:"left",width:"100",title:"科目编号"}}),e._v(" "),a("vxe-table-column",{attrs:{field:"subjectName",fixed:"left",width:"100",title:"科目名称"}}),e._v(" "),a("vxe-table-column",{attrs:{field:"auditAmount","min-width":"100",formatter:e.commafyFn,title:"本期金额"}}),e._v(" "),a("vxe-table-column",{attrs:{field:"auditAmountDiff","min-width":"100",formatter:e.commafyFn,title:"本期差异额"}}),e._v(" "),a("vxe-table-column",{attrs:{field:"auditAmountPreVer","min-width":"100",formatter:e.commafyFn,title:"本期金额(旧)"}}),e._v(" "),a("vxe-table-column",{attrs:{field:"preAuditAmount","min-width":"100",formatter:e.commafyFn,title:"上期金额"}}),e._v(" "),a("vxe-table-column",{attrs:{"min-width":"100",field:"preAuditAmountDiff",formatter:e.commafyFn,title:"上期差异额"}}),e._v(" "),a("vxe-table-column",{attrs:{field:"preAuditAmountPreVer","min-width":"100",formatter:e.commafyFn,title:"上期金额(旧)"}})],1)],1)],1)},staticRenderFns:[]};var w=a("VU/8")(C,D,!1,function(e){a("3+Il"),a("I7wC")},"data-v-5eb68aea",null).exports,x={name:"mergeScopeOut",components:{BdoTable:c.a},mixins:[v.a],data:function(){var e=this,t=function(e,t,a){""==t||isNaN(t)?a(new Error("请输入正确的数值")):!isNaN(t)&&(parseFloat(t).toFixed(2)<0||parseFloat(t).toFixed(2)>100)?a(new Error("请输入正确的数值")):a()};return{flag:"HB002-MC002",mergeUploadDialogVisible:!1,excelName:"",mergeScopeEditDialogTableVisible:!1,formLabelWidth:"120px",mergeScopeEditFormData:{autoId:0,checkStatus:"",customerId:"",stockBreakRate:null,isUnitChildProject:"",mergeCustomerId:"",mergeCustomerName:"",mergeFinanceReportType:"",mergeProjectId:"",mergeProjectName:"",mergeScope:"",noteStatus:"",projectId:"",projectSource:"",reportStatus:"",shortName:"",trialBalanceStatus:"",equityRatio:null,preMergeProportion:null,curMergeProportion:null,causeDescription:"",uscc:"",incomeTaxRate:null},mergeProjectNameList:[],mergeScopedEditFormRule:{mergeCustomerName:[{required:!0,message:"公司不能为空",trigger:"blur"}],stockBreakRate:[{required:!0,message:"认缴比例不能为空",trigger:"blur"},{validator:t,trigger:"change"}],equityRatio:[{required:!0,message:"权益比例不能为空",trigger:"blur"},{validator:t,trigger:"change"}],curMergeProportion:[{required:!0,message:"合并比例(本期)不能为空",trigger:"blur"},{validator:t,trigger:"change"}],preMergeProportion:[{required:!0,message:"合并比例(上期)不能为空",trigger:"blur"},{validator:t,trigger:"change"}],mergeProjectName:[{required:!0,message:"项目不能为空",trigger:"change"}],uscc:[{required:!0,message:"统一社会信用代码不能为空",trigger:"blur"}],incomeTaxRate:[{validator:t,trigger:"change"}]},bodyHeight:230,customerId:"",projectId:"",columnsList:[{prop:"autoId",label:"操作",width:"170px",filterOptions:{disabled:!0}},{prop:"mergeCustomerName",label:"客户名称",width:"200px",filterOptions:{disabled:!0}},{prop:"shortName",label:"项目简称",width:"180px",filterOptions:{disabled:!0}},{prop:"uscc",label:"统一社会信用代码",filterOptions:{disabled:!0}},{prop:"incomeTaxRate",label:"所得税税率",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtEquity}},{prop:"stockBreakRate",label:"认缴比例",width:"120px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtEquity}},{prop:"equityRatio",label:"权益比例",width:"120px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtEquity}},{prop:"extractionRatio",label:"母公司投资比例",filterOptions:{disabled:!0}},{prop:"extractionRatio",label:"提取比例",filterOptions:{disabled:!0}},{prop:"curMergeProportion",label:"合并比例(本期)",width:"120px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtEquity}},{prop:"preMergeProportion",label:"合并比例(上期)",width:"120px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtEquity}},{prop:"mergeScope",label:"合并范围",miniWidth:"120px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtMergeScope}},{prop:"causeDescription",label:"原因说明",width:"120px",filterOptions:{disabled:!0}},{prop:"mergeProjectName",label:"项目名称",width:"180px",filterOptions:{disabled:!0}},{prop:"projectSource",label:"项目来源",width:"120px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtSource}},{prop:"trialBalanceStatus",label:"是否导入试算平衡表",width:"160px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtCheckStatus},fixed:"right"},{prop:"reportStatus",label:"是否导入报表",width:"160px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtCheckStatus},fixed:"right"},{prop:"noteStatus",label:"是否导入附注",width:"160px",flag:"a",disableToolbox:!0,filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtCheckStatus},fixed:"right"}],tableDataList:[],mergeScope:1,uploadedCBData:{mergeProjectId:"",fileId:"",isParentNoteInfo:!1,fileType:""},dataLength:0,tableLoding:!1,fullscreenLoading:!1,queryConfig:function(t,a,r){e.fullscreenLoading=!0,e.$sacpApis.enterpriseList({customerId:e.curCustomerId,projectId:e.curProjectId,mergeScope:e.activeName,type:e.$constantVar.API_SACP_QUERY_COMPANY,pageNum:t,pageSize:a}).then(function(t){t.success?t.data?(t.data.map(function(e){e.extractionRatio=parseFloat(100*e.extractionRatio).toFixed(2)+"%",e.incomeTaxRate=e.incomeTaxRate+"%"}),e.tableDataList=t.data,e.dataLength=e.tableDataList,e.handleValidTotal()):e.dataLength=0:e.$message.error(t.resultInfo.statusText)}).finally(function(){return e.fullscreenLoading=!1})},mergeScopeOptions:this.$DIC("合并范围"),projectSouce:this.$DIC("合并报表项目来源"),uploadFileList:[],filedata:new FormData,setBorder:!0,validProjectTotal:0,passValid:0,failedValid:0,isShowProjectPanorama:!1,curCustomerId:"",curProjectId:"",curAccYear:"",menuId:"HB002-MC001",activeLabel:"",isInit:!0,auditAjustmnetData:[],adjustTableData:[],selList:[],userDefined:"",oldTableData:{},showDebLabel:"",activeName:"0",oldActieRowData:{},firstCreate:!0,changeMergeScopeReason:"",haschangeMergeScope:!1,uploadFileListDialogTableVisible:!1,fileListColumns:[{prop:"autoId",label:"处理",fixed:!0,width:"170px",filterOptions:{disabled:!0}},{prop:"fileName",label:"文件名称",fixed:!0,filterOptions:{disabled:!0}},{prop:"uploadDate",label:"上传时间",fixed:!0,formatter:{type:"function",value:this.formatterDate},filterOptions:{disabled:!0}},{prop:"userName",label:"上传人",fixed:!0,filterOptions:{disabled:!0}}],fileList:[],causeDescription:"",causeDescriptionCache:""}},methods:{fillChangeMergeScopeReason:function(){return this.mergeScopeEditFormData.curMergeProportion<=50&&"1"===this.mergeScopeEditFormData.mergeScope?(this.haschangeMergeScope=!0,this.mergeUploadDialogVisible=!0,!1):this.mergeScopeEditFormData.curMergeProportion&&this.mergeScopeEditFormData.curMergeProportion>50&&"0"===this.mergeScopeEditFormData.mergeScope?(this.haschangeMergeScope=!0,this.mergeUploadDialogVisible=!0,!1):(this.haschangeMergeScope=!1,this.mergeUploadDialogVisible=!1,!0)},handleReviewUploadFile:function(e){var t=this;this.uploadFileListDialogTableVisible=!0,this.fullscreenLoading=!0,this.$sacpApis.hbMergeProjectQueryHbFile({jsonData:o()({mergeProjectId:e.row.mergeProjectId})}).then(function(e){e.success?t.fileList=e.data||[]:t.$message.error(e.resultInfo.statusText)}).catch(function(e){return t.$message.error(e)}).finally(function(){t.fullscreenLoading=!1})},reviewFile:function(e){if(!e.row.fileName||e.row.fileName.indexOf(".xlsx")>-1||e.row.fileName.indexOf(".zip")>-1)return this.$message.error("预览功能仅支持图片和PDF类型文件!");var t=this.$router.resolve({name:"PreviewPdf",query:{randomNum:e.row.autoId}}).href;window.open(t,"_blank")},deleteFile:function(e){var t=this;this.fullscreenLoading=!0,this.$sacpApis.deleteAttachment(e.row.autoId).then(function(a){a.success?t.$message.success("删除成功!")&&t.handleReviewUploadFile(e):t.$message.error(a.resultInfo.statusText)}).catch(function(e){return t.$message.error(e)}).finally(function(){t.fullscreenLoading=!1})},downloadFile:function(e){var t=window.location.origin+"/Faith/dgCenter/HbMergeProject.downloadAttachment.json?param1="+e.row.autoId;window.open(t,"_blank")},handleInitData:function(e){var t=this,a="";a=e.row.hasChildAdjust?"初始化子公司数据会删除子公司的试算平衡表、审定报表，确认要初始化吗？":"初始化子公司数据会删除子公司的试算平衡表、审定报表、子公司审计调整数据，确认要初始化吗？",this.$confirm(a,"确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.row.hasChildAdjust?t.$confirm("是否保留分录","确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.confirmInitData(e,!0)}).catch(function(){return t.confirmInitData(e,!1)}):t.confirmInitData(e,!1)}).catch(function(e){})},confirmInitData:function(e,t){var a=this;this.fullscreenLoading=!0;var r={mergeProjectId:e.row.mergeProjectId,retainChildAdjust:t};this.$sacpApis.getInitSingleCompanyData(r).then(function(e){e.success?(a.$message.success("初始化数据成功!"),a.mergeScopeInit(),a.$eventBus.$emit("page-refresh",e.resultInfo.refreshIndexes)):a.$message.error(e.resultInfo.statusText)}).catch(function(e){return a.$message.error(e)}).finally(function(){return a.fullscreenLoading=!1})},uploadChange:function(e,t){if(this.uploadFileList.some(function(t){return t.name==e.name}))return this.$message.warning("不可以重复上传相同文件名文件,请删除!");this.uploadFileList.push(e.raw)},causeDescriptionChange:function(e){this.causeDescriptionCache=this.causeDescription},confirUpload:function(){var e=this;if(!this.uploadFileList||!this.uploadFileList.length)return this.$message.error("请上传文件!");if(this.uploadFileList.map(function(t,a){e.filedata.append("file"+a,t)}),this.haschangeMergeScope){if(!this.causeDescription.trim())return this.$message.error("请填写说明原因!");this.handleUplaodReasonFile()}else this.handleUploadSuccess()},handleUplaodReasonFile:function(){var e=this;this.fullscreenLoading=!0,this.filedata.append("mergeProjectId",this.mergeScopeEditFormData.mergeProjectId),this.$sacpApis.hbMergeProjectBatchUploadbulkUpload(this.filedata).then(function(t){if(t.success)e.$message.success("上传成功!");else{var a=t.resultInfo.statusText;e.$message.error(a)}}).catch(function(t){return e.$message.error(t)}).finally(function(){e.clearUploadData(),e.mergeUploadDialogVisible=!1,e.dialogVisible=!1,e.fullscreenLoading=!1,e.haschangeMergeScope=!1})},clearUploadData:function(){this.$refs.uploadExcel;this.excelFile="",this.excelName="",this.uploadFileList=[],this.causeDescription="",this.filedata=new FormData},handleUploadSuccess:function(){var e=this;this.$sacpApis.bulkUpload(this.filedata).then(function(t){if(t.success)e.clearUploadData(),e.uploadSuccessCB(t.data);else{var a=t.resultInfo.statusText;e.$message.error(a)}}).catch(function(t){return e.$message.error(t)}).finally(function(){e.mergeUploadDialogVisible=!1,e.dialogVisible=!1})},uploadSuccessCB:function(e){var t=this;this.uploadedCBData.fileId=e,this.$sacpApis.mergeScopeUploadCB(this.uploadedCBData).then(function(e){e.success?(t.$message.success("上传成功"),t.mergeScopeInit(),t.$eventBus.$emit("page-refresh",e.resultInfo.refreshIndexes)):t.$message.error(e.resultInfo.statusText)}).catch(function(e){t.$message.error(e)})},beforeRemove:function(e,t){this.uploadFileList=this.uploadFileList.filter(function(t){return t.name!=e.name})},cancelUpload:function(){this.mergeUploadDialogVisible=!1,this.uploadFileList=[],this.causeDescription="",this.causeDescriptionCache=""},handleMergeScopeProject:function(e){if(e){var t=this.mergeProjectNameList.filter(function(t){return t.projectid==e});this.mergeScopeEditFormData.mergeProjectId=t[0].projectid,this.mergeScopeEditFormData.mergeProjectName=t[0].projectname}},clearMergeProjectName:function(){this.$set(this.mergeScopeEditFormData,"mergeProjectName",""),this.$set(this.mergeScopeEditFormData,"mergeProjectId","")},submitEditDialogForm:function(e){var t=this;if(this.haschangeMergeScope&&!this.causeDescriptionCache)return this.fillChangeMergeScopeReason();this.mergeScopeEditFormData.causeDescription=this.causeDescriptionCache?this.causeDescriptionCache:this.mergeScopeEditFormData.causeDescription,this.$refs[e].validate(function(a){a?t.$sacpApis.mergeScopeEditSave(t.mergeScopeEditFormData).then(function(a){a.success?(t.oldActieRowData.mergeScope!=t.mergeScopeEditFormData.mergeScope&&t.$store.commit("setRemoveAliveList","mergeScopeIn"),t.$eventBus.$emit("page-refresh",a.resultInfo.refreshIndexes),t.$message.success("编辑成功"),t.$refs[e].resetFields(),t.mergeScopeEditDialogTableVisible=!1,t.mergeScopeInit()):t.$message.error(a.resultInfo.statusText)}).catch(function(e){t.$message.error(e)}):t.$message.error("校验未过!")})},fmtProject:function(e,t){return e.mergeProjectId||e.mergeProjectName?-1!=e.mergeProjectName.indexOf("-")?e.mergeProjectName:e.mergeProjectId+"-"+e.mergeProjectName:"-"},fmtCheckStatus:function(e,t){switch(t){case"1":return"√";default:return"×"}},fmtEquity:function(e,t){return t+"%"},fmtMergeScope:function(e,t){switch(t){case"1":return"合并范围内";default:return"合并范围外且是关联方"}},fmtSource:function(e,t){switch(t){case"1":return"SACP";case"2":return"PM";case"3":return"非SACP报表审计";case"4":return"非SACP的BDO境外审计";case"5":return"非SACP其他事务所审计"}},editProject:function(e){this.oldActieRowData=e,this.mergeProjectNameList=[],this.mergeScopeEditDialogTableVisible=!0;var t=this.mergeScopeEditFormData;t.autoId=e.autoId,t.checkStatus=e.checkStatus,t.customerId=e.customerId,t.stockBreakRate=e.stockBreakRate,t.mergeCustomerId=e.mergeCustomerId,t.mergeCustomerName=e.mergeCustomerName,t.mergeFinanceReportType=e.mergeFinanceReportType,t.mergeProjectId=e.mergeProjectId,t.mergeProjectName=e.mergeProjectName,t.isUnitChildProject=e.isUnitChildProject,t.mergeScope=e.mergeScope,t.noteStatus=e.noteStatus,t.projectSource=e.projectSource,t.reportStatus=e.reportStatus,t.shortName=e.shortName,t.trialBalanceStatus=e.trialBalanceStatus,t.equityRatio=e.equityRatio,t.curMergeProportion=e.curMergeProportion,t.preMergeProportion=e.preMergeProportion,t.incomeTaxRate=e.incomeTaxRate,t.uscc=e.uscc,t.projectId=this.curProjectId,this.getProjectNameList(t.mergeCustomerId)},delProject:function(e,t,a){var r=this,o={autoIds:e};this.$sacpApis.mergeScopeDelete(o).then(function(e){e.success?(r.$message.success("删除成功"),r.mergeScopeInit()):r.$message.error(e.resultInfo.statusText)}).catch(function(e){r.$message.error(e)})},openView:function(e,t){switch(t){case"QUERY_TB":if("1"!==e.trialBalanceStatus)return void this.$message("试算平衡表未导入！");var a="";a=-1!=e.mergeProjectName.indexOf("-")?e.mergeProjectName:e.mergeProjectId+"-"+e.mergeProjectName;var r={customerId:e.customerId,mergeCustomerName:e.mergeCustomerName,projectId:a,type:t,curYear:this.curAccYear,mergeCustomerId:e.mergeCustomerId};sessionStorage.setItem("projectItem",o()(r)),this.checkTb(r);break;case"QUERY_REPORT":if("1"!==e.reportStatus)return void this.$message("审定报表未导入！");a="";a=-1!=e.mergeProjectName.indexOf("-")?e.mergeProjectName:e.mergeProjectId+"-"+e.mergeProjectName;r={customerId:e.customerId,mergeCustomerName:e.mergeCustomerName,projectId:a,type:t,curYear:this.curAccYear,mergeCustomerId:e.mergeCustomerId};sessionStorage.setItem("projectItem",o()(r)),this.checkReport(r);break;case"note":if("0"===e.noteStatus)return void this.$parent.$message("附注未导入！");a="";a=-1!=e.mergeProjectName.indexOf("-")?e.mergeProjectName:e.mergeProjectId+"-"+e.mergeProjectName;r={customerId:e.customerId,mergeCustomerName:e.mergeCustomerName,projectId:a,type:"",mergeCustomerId:e.mergeCustomerId};sessionStorage.setItem("projectItem",o()(r)),this.checkNote(r)}},checkTb:function(e){var t=this.$router.resolve({path:"/checkTb",query:{curYear:e.curYear,menuID:"HB002-MC004-0001"}}).href;window.open(t,"_blank")},checkReport:function(e){var t=this.$router.resolve({path:"/checkReport",query:{curYear:e.curYear,menuID:"HB002-MC005-001"}}).href;window.open(t,"_blank")},checkNote:function(e){var t=this.$router.resolve({path:"/checkNote",query:{curYear:e.curYear}}).href;window.open(t,"_blank")},calcTaskProgress:function(e,t){return t?Math.round(e/t*100):0},importFile:function(e,t,a){this.uploadedCBData.mergeProjectId=a.row.mergeProjectId,this.mergeUploadDialogVisible=!0},reload:function(){this.$refs.table.reload()},getProjectNameList:function(e){var t=this,a={customerId:e};this.$sacpApis.reachProjectInfo(a).then(function(e){e.success?e.data&&e.data.find(function(e){var a={projectid:e.projectId,projectname:e.ProjectName};t.mergeProjectNameList.push(a)}):t.$message.error(e.resultInfo.statusText)}).catch(function(e){t.$message.error(e)})},isRefreshDataLength:function(e){this.dataLength=e},handleValidTotal:function(){var e=this;this.$sacpApis.mergeScopeValidTotal({activeName:this.activeName}).then(function(t){t.success?(e.passValid=t.data[0].checkPassNumber,e.failedValid=t.data[0].checkFailureNumber,e.validProjectTotal=t.data[0].projectSize):e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)}).finally()},offsetEntryInit:function(){var e=this;this.singleProjectId,this.$sacpApis.queryOffsetList({customerId:this.curCustomerId,projectId:this.curProjectId,year:"",offsetType:1,value:null,mergeProject:null}).then(function(t){e.auditAjustmnetData=t.data}).catch(function(t){return e.$message.error(t)})},handleCurstomerId:function(){var e=JSON.parse(sessionStorage.getItem("curCustomerData"));this.curCustomerId=e.curCustomerId,this.curProjectId=e.curProjectId,this.curAccYear=e.curYear,this.isInit=!1},mergeScopeInit:function(){var e=this;this.fullscreenLoading=!0;this.$sacpApis.enterpriseList({customerId:this.curCustomerId,projectId:this.curProjectId,mergeScope:this.activeName}).then(function(t){t.success?t.data?(e.tableDataList=t.data,e.dataLength=e.tableDataList,e.handleValidTotal()):e.dataLength=0:e.$message.error(t.resultInfo.statusText)}).catch(function(t){e.$message.error(t)}).finally(function(){e.fullscreenLoading=!1,e.isInit=!0,e.$store.commit("setMergeScopeRefresh",!1)})},formatterDate:function(e,t){return m.a.toDateString(t,"yyyy-MM-dd HH:mm:ss")},hasChildAdjust:function(){if(this.tableDataList&&this.tableDataList.length)return this.tableDataList.some(function(e){return e.hasChildAdjust})},exportFile:function(){var e={columns:this.columnsList,params:{param1:this.curCustomerId,param2:this.curProjectId,param3:this.activeName},url:"dgCenter/HbMergeProject.enterpriseList.json",fileName:"合并范围外且是关联方"};this.exportExcel(e)}},activated:function(){var e=this;this.$eventBus.$off("click-tab").$on("click-tab",function(t){t&&t.indexId===e.flag&&t.isMark&&e.mergeScopeInit()})},created:function(){this.handleCurstomerId(),this.selList=this.$DIC("借贷"),this.mergeScopeOptions=this.$DIC("合并范围"),this.firstCreate=!1}},y={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"mergeScopeOut"},[a("bdo-table",{ref:"table",attrs:{columns:e.columnsList,"enable-filter":!1,"enable-toolbox":!1,"enable-view-type":!1,data:e.tableDataList,"page-total":e.tableDataList.length||0,"responsive-height-gap":e.bodyHeight,showIndexColumn:!1,showCheckBox:!1,tableLoding:e.tableLoding,queryConfig:e.queryConfig,setBorder:e.setBorder,exportReport:!1},on:{isRefreshDataLength:e.isRefreshDataLength,exportFile:e.exportFile},scopedSlots:e._u([{key:"col-mergeCustomerName",fn:function(t){return[e._v("\n            "+e._s(t.row.mergeCustomerName)+"\n            "),"1"==t.row.isUnitChildProject?a("span",{staticStyle:{color:"rgb(230 162 60)",display:"inline-block",padding:"0px 5px",background:"rgb(253 246 236)",border:"1px solid #ccc","border-radius":"5px"}},[e._v("\n                母公司\n            ")]):e._e()]}},{key:"col-autoId",fn:function(t){return[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"编辑",placement:"top-start"}},[a("el-button",{staticClass:"editBtnCol",attrs:{size:"small",type:"text",icon:"el-icon-edit-outline normalWeight"},on:{click:function(a){return e.editProject(t.row)}}})],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"导入",placement:"top-start"}},[a("el-button",{staticClass:"uploadBtnCol",attrs:{size:"small",type:"text",disabled:!t.row.mergeProjectName,icon:"el-icon-upload normalWeight"},on:{click:function(a){return e.importFile(t.row.autoId,t.row.customerId,t)}}})],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"初始化数据",placement:"top-start"}},[a("el-button",{staticClass:"activeBtnCol",attrs:{size:"small",type:"text",icon:"el-icon-switch-button"},on:{click:function(a){return e.handleInitData(t)}}})],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"查看上传文件",placement:"top-start"}},[a("el-button",{staticClass:"activeBtnCol",attrs:{size:"small",type:"text",icon:"el-icon-document-copy normalWeight"},on:{click:function(a){return e.handleReviewUploadFile(t)}}})],1)]}},{key:"col-trialBalanceStatus",fn:function(t){return["1"===t.row.trialBalanceStatus?a("el-button",{attrs:{size:"small",type:"text"},on:{click:function(a){return e.openView(t.row,"QUERY_TB")}}},[e._v("查看"),t.row.checkTb?e._e():a("span",{staticClass:"errorInfo"},[e._v("(校验失败)")])]):e._e(),e._v(" "),"1"!==t.row.trialBalanceStatus?a("span",[e._v("未导入")]):e._e()]}},{key:"col-reportStatus",fn:function(t){return["1"===t.row.reportStatus?a("el-button",{attrs:{size:"small",type:"text"},on:{click:function(a){return e.openView(t.row,"QUERY_REPORT")}}},[e._v("查看"),t.row.checkReport?e._e():a("span",{staticClass:"errorInfo"},[e._v("(校验失败)")])]):e._e(),e._v(" "),"1"!==t.row.reportStatus?a("span",[e._v("未导入")]):e._e()]}},{key:"col-noteStatus",fn:function(t){return["1"===t.row.noteStatus||"2"===t.row.noteStatus?a("el-button",{attrs:{size:"small",type:"text"},on:{click:function(a){return e.openView(t.row,"note")}}},[e._v("查看\n                "),"2"===t.row.noteStatus&&"0"===t.row.checkStatus?a("span",{staticClass:"errorInfo"},[e._v("(校验失败)")]):e._e(),e._v(" "),"1"===t.row.noteStatus&&"1"===t.row.checkStatus?a("span",{staticClass:"errorInfo"},[e._v("(未校验)")]):e._e()]):e._e(),e._v(" "),"0"!==t.row.noteStatus||"0"!==t.row.checkStatus&&"1"!==t.row.checkStatus?e._e():a("span",[e._v("未导入")])]}}])},[e._v(" "),a("template",{slot:"text"},[a("div",{staticClass:"totalValidMessage"},[e._v("\n                项目数:"+e._s(e.validProjectTotal)+"件 校验通过:"+e._s(e.passValid)+"件\n                "),a("span",{class:e.failedValid?"errorInfo":""},[e._v("校验失败:"+e._s(e.failedValid)+"件")])])])],2),e._v(" "),a("el-dialog",{attrs:{title:e.haschangeMergeScope?"原因说明":"导入",visible:e.mergeUploadDialogVisible,"destroy-on-close":!0,"before-close":e.cancelUpload,width:"40%"},on:{"update:visible":function(t){e.mergeUploadDialogVisible=t}}},[a("div",[e.haschangeMergeScope?a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:5}},[a("span",{staticStyle:{color:"red"}},[e._v("* ")]),a("span",[e._v("原因说明:")])]),e._v(" "),a("el-col",{attrs:{span:19}},[a("el-input",{attrs:{type:"textarea",maxlength:"60","show-word-limit":""},on:{blur:e.causeDescriptionChange},model:{value:e.causeDescription,callback:function(t){e.causeDescription=t},expression:"causeDescription"}})],1)],1):e._e(),e._v(" "),a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:5}},[e.haschangeMergeScope?a("span",{staticStyle:{color:"red"}},[e._v("*\n                    ")]):e._e()]),e._v(" "),a("el-col",{staticClass:"reasonUpload",attrs:{span:e.haschangeMergeScope?19:24}},[a("el-upload",{ref:"uploadFile",staticClass:"uploadTool",attrs:{drag:"",action:"",multiple:"","file-list":e.uploadFileList,accept:e.haschangeMergeScope?".xlsx,.zip,.jpg,.pdf,.png,.jpeg":".xlsx,.zip","auto-upload":!1,"on-change":e.uploadChange,"on-remove":e.beforeRemove}},[a("i",{staticClass:"el-icon-upload"}),e._v(" "),a("div",{staticClass:"el-upload__text"},[e._v("\n                            将文件拖到此处，或"),a("em",[e._v("点击上传")]),e._v(" "),e.haschangeMergeScope?e._e():a("p",[e._v("\n                                只能上传excel或zip文件\n                            ")])])])],1)],1)],1),e._v(" "),a("div",{staticClass:"buttonList"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.confirUpload}},[e._v("确定")]),e._v(" "),a("el-button",{attrs:{type:"info",size:"small"},on:{click:e.cancelUpload}},[e._v("取消")])],1)]),e._v(" "),a("el-dialog",{attrs:{title:"编辑",visible:e.mergeScopeEditDialogTableVisible,"destroy-on-close":!0,width:"40%"},on:{"update:visible":function(t){e.mergeScopeEditDialogTableVisible=t}}},[a("el-form",{ref:"mergeScopeEditFormData",attrs:{model:e.mergeScopeEditFormData,rules:e.mergeScopedEditFormRule}},[a("el-form-item",{attrs:{label:"公司名称","label-width":e.formLabelWidth,prop:"mergeCustomerName"}},[a("el-input",{attrs:{disabled:""},model:{value:e.mergeScopeEditFormData.mergeCustomerName,callback:function(t){e.$set(e.mergeScopeEditFormData,"mergeCustomerName","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.mergeCustomerName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"项目简称","label-width":e.formLabelWidth,prop:"shortName"}},[a("el-input",{attrs:{type:"text"},model:{value:e.mergeScopeEditFormData.shortName,callback:function(t){e.$set(e.mergeScopeEditFormData,"shortName","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.shortName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"统一社会信用代码","label-width":e.formLabelWidth,prop:"uscc"}},[a("el-input",{attrs:{maxlength:"25"},model:{value:e.mergeScopeEditFormData.uscc,callback:function(t){e.$set(e.mergeScopeEditFormData,"uscc","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.uscc"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"认缴比例","label-width":e.formLabelWidth,prop:"stockBreakRate"}},[a("el-input",{model:{value:e.mergeScopeEditFormData.stockBreakRate,callback:function(t){e.$set(e.mergeScopeEditFormData,"stockBreakRate","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.stockBreakRate"}},[a("i",{staticClass:"percent",staticStyle:{"font-style":"normal"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("%")])])],1),e._v(" "),a("el-form-item",{attrs:{label:"权益比例","label-width":e.formLabelWidth,prop:"equityRatio"}},[a("el-input",{model:{value:e.mergeScopeEditFormData.equityRatio,callback:function(t){e.$set(e.mergeScopeEditFormData,"equityRatio","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.equityRatio"}},[a("i",{staticClass:"percent",staticStyle:{"font-style":"normal"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("%")])])],1),e._v(" "),a("el-form-item",{attrs:{label:"合并比例（本期）","label-width":e.formLabelWidth,prop:"curMergeProportion"}},[a("el-input",{on:{blur:e.fillChangeMergeScopeReason},model:{value:e.mergeScopeEditFormData.curMergeProportion,callback:function(t){e.$set(e.mergeScopeEditFormData,"curMergeProportion","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.curMergeProportion"}},[a("i",{staticClass:"percent",staticStyle:{"font-style":"normal"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("%")])])],1),e._v(" "),a("el-form-item",{attrs:{label:"合并比例（上期）","label-width":e.formLabelWidth,prop:"preMergeProportion"}},[a("el-input",{model:{value:e.mergeScopeEditFormData.preMergeProportion,callback:function(t){e.$set(e.mergeScopeEditFormData,"preMergeProportion","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.preMergeProportion"}},[a("i",{staticClass:"percent",staticStyle:{"font-style":"normal"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("%")])])],1),e._v(" "),a("el-form-item",{attrs:{label:" 所得税税率 %","label-width":e.formLabelWidth,prop:"incomeTaxRate"}},[a("el-input",{model:{value:e.mergeScopeEditFormData.incomeTaxRate,callback:function(t){e.$set(e.mergeScopeEditFormData,"incomeTaxRate","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.incomeTaxRate"}})],1),e._v(" "),a("el-form-item",{staticClass:"mergeScopeSelect",attrs:{label:"合并范围","label-width":e.formLabelWidth,prop:"mergeScope"}},[a("el-select",{attrs:{placeholder:"请选择合并范围"},on:{change:e.fillChangeMergeScopeReason},model:{value:e.mergeScopeEditFormData.mergeScope,callback:function(t){e.$set(e.mergeScopeEditFormData,"mergeScope","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.mergeScope"}},e._l(e.mergeScopeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1),e._v(" "),e.haschangeMergeScope?a("div",{staticClass:"resetBtn",on:{click:function(t){e.mergeUploadDialogVisible=!0}}},[a("el-button",{attrs:{circle:"",size:"small",type:"primary",icon:"el-icon-edit-outline",title:"原因说明"}})],1):e._e()],1),e._v(" "),a("el-form-item",{staticClass:"projectSource",attrs:{label:"项目来源","label-width":e.formLabelWidth,prop:"projectSource"}},[a("el-select",{attrs:{placeholder:"请选择项目来源"},model:{value:e.mergeScopeEditFormData.projectSource,callback:function(t){e.$set(e.mergeScopeEditFormData,"projectSource","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.projectSource"}},e._l(e.projectSouce,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{staticClass:"projectName",attrs:{label:"项目名称","label-width":e.formLabelWidth,prop:"mergeProjectName"}},[a("el-select",{staticClass:"projectList",attrs:{placeholder:"请选择项目名称",clearable:"",filterable:""},on:{clear:e.clearMergeProjectName,change:e.handleMergeScopeProject},model:{value:e.mergeScopeEditFormData.mergeProjectName,callback:function(t){e.$set(e.mergeScopeEditFormData,"mergeProjectName","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.mergeProjectName"}},e._l(e.mergeProjectNameList,function(e,t){return a("el-option",{key:t,attrs:{label:e.projectname,value:e.projectid}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"是否母公司单体项目:"}},[a("el-radio-group",{staticClass:"isUnitChildProject",model:{value:e.mergeScopeEditFormData.isUnitChildProject,callback:function(t){e.$set(e.mergeScopeEditFormData,"isUnitChildProject",t)},expression:"mergeScopeEditFormData.isUnitChildProject"}},[a("el-radio",{attrs:{label:"0"}},[e._v("否")]),e._v(" "),a("el-radio",{attrs:{label:"1"}},[e._v("是")])],1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"info",size:"small"},on:{click:function(t){e.mergeScopeEditDialogTableVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.submitEditDialogForm("mergeScopeEditFormData")}}},[e._v("确 定")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"上传文件列表",visible:e.uploadFileListDialogTableVisible,"destroy-on-close":!0,width:"75%"},on:{"update:visible":function(t){e.uploadFileListDialogTableVisible=t}}},[a("bdo-table",{ref:"uploadFileTable",attrs:{columns:e.fileListColumns,"enable-filter":!1,"enable-toolbox":!1,"enable-view-type":!1,data:e.fileList,"page-total":e.fileList.length||0,"responsive-height-gap":e.bodyHeight,showIndexColumn:!0,enableHeadConfig:!1,headerListConfig:!0,enableRefresh:!1,showCheckBox:!1,setBorder:e.setBorder},scopedSlots:e._u([{key:"col-autoId",fn:function(t){return[a("el-button",{attrs:{title:"预览",size:"small",type:"text",icon:"el-icon-view normalWeight selfGreen"},on:{click:function(a){return e.reviewFile(t)}}}),e._v(" "),a("el-button",{attrs:{title:"删除文件",size:"small",type:"text",icon:"el-icon-delete normalWeight delBtnCol"},on:{click:function(a){return e.deleteFile(t)}}}),e._v(" "),a("el-button",{attrs:{title:"下载",size:"small",type:"text",icon:"el-icon-download normalWeight selfBlue"},on:{click:function(a){return e.downloadFile(t)}}})]}}])})],1)],1)},staticRenderFns:[]};var j=a("VU/8")(x,y,!1,function(e){a("9VHK"),a("+dOl")},"data-v-13733568",null).exports,F=a("Dd8w"),P=a.n(F),_=a("NYxO"),$={name:"unimportRelate",components:{BdoTable:c.a},computed:P()({},Object(_.b)(["refreshUnImportRelate"]),{refreshUnImportRelate:function(){return this.$store.state.refreshUnImportRelate}}),watch:{refreshUnImportRelate:{handler:function(e){if(e){if(!this.curCustomerId||!this.curProjectId){var t=JSON.parse(sessionStorage.getItem("curCustomerData"));this.curCustomerId=t.curCustomerId,this.curProjectId=t.curProjectId,this.curAccYear=t.curYear}this.mergeScopeInit()}},immediate:!0}},mixins:[v.a],data:function(){var e=this,t=function(e,t,a){""==t||isNaN(t)?a(new Error("请输入正确的数值")):!isNaN(t)&&(parseFloat(t).toFixed(2)<0||parseFloat(t).toFixed(2)>100)?a(new Error("请输入正确的数值")):a()};return{flag:"HB002-MC003",mergeUploadDialogVisible:!1,excelName:"",mergeScopeEditDialogTableVisible:!1,formLabelWidth:"120px",mergeScopeEditFormData:{autoId:0,checkStatus:"",customerId:"",stockBreakRate:null,isUnitChildProject:"",mergeCustomerId:"",mergeCustomerName:"",mergeFinanceReportType:"",mergeProjectId:"",mergeProjectName:"",mergeScope:"",noteStatus:"",projectId:"",projectSource:"",reportStatus:"",shortName:"",trialBalanceStatus:"",equityRatio:null,preMergeProportion:null,curMergeProportion:null,causeDescription:"",uscc:"",incomeTaxRate:null},mergeProjectNameList:[],mergeScopedEditFormRule:{mergeCustomerName:[{required:!0,message:"公司不能为空",trigger:"blur"}],stockBreakRate:[{required:!0,message:"认缴比例不能为空",trigger:"blur"},{validator:t,trigger:"change"}],equityRatio:[{required:!0,message:"权益比例不能为空",trigger:"blur"},{validator:t,trigger:"change"}],curMergeProportion:[{required:!0,message:"合并比例(本期)不能为空",trigger:"blur"},{validator:t,trigger:"change"}],preMergeProportion:[{required:!0,message:"合并比例(上期)不能为空",trigger:"blur"},{validator:t,trigger:"change"}],mergeProjectName:[{required:!0,message:"项目不能为空",trigger:"change"}],uscc:[{required:!0,message:"统一社会信用代码不能为空",trigger:"blur"}],incomeTaxRate:[{validator:t,trigger:"change"}]},bodyHeight:230,customerId:"",projectId:"",columnsList:[{prop:"autoId",label:"操作",width:"220px"},{prop:"mergeCustomerName",label:"客户名称",width:"200px",filterOptions:{disabled:!0}},{prop:"shortName",label:"项目简称",width:"180px",filterOptions:{disabled:!0}},{prop:"uscc",label:"统一社会信用代码",filterOptions:{disabled:!0}},{prop:"incomeTaxRate",label:"所得税税率",filterOptions:{disabled:!0}},{prop:"stockBreakRate",label:"认缴比例",width:"120px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtEquity}},{prop:"equityRatio",label:"权益比例",width:"120px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtEquity}},{prop:"extractionRatio",label:"母公司投资比例",filterOptions:{disabled:!0}},{prop:"extractionRatio",label:"提取比例",filterOptions:{disabled:!0}},{prop:"curMergeProportion",label:"合并比例(本期)",width:"120px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtEquity}},{prop:"preMergeProportion",label:"合并比例(上期)",width:"120px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtEquity}},{prop:"remark",label:"作废理由",width:"120px",filterOptions:{disabled:!0}},{prop:"mergeScope",label:"合并范围",miniWidth:"120px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtMergeScope}},{prop:"causeDescription",label:"原因说明",width:"120px",filterOptions:{disabled:!0}},{prop:"mergeProjectName",label:"项目名称",width:"180px",filterOptions:{disabled:!0}},{prop:"projectSource",label:"项目来源",width:"120px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtSource}},{prop:"trialBalanceStatus",label:"是否导入试算平衡表",width:"160px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtCheckStatus},fixed:"right"},{prop:"reportStatus",label:"是否导入报表",width:"160px",filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtCheckStatus},fixed:"right"},{prop:"noteStatus",label:"是否导入附注",width:"160px",flag:"a",disableToolbox:!0,filterOptions:{disabled:!0},formatter:{type:"function",value:this.fmtCheckStatus},fixed:"right"}],tableDataList:[],mergeScope:1,uploadedCBData:{mergeProjectId:"",fileId:"",isParentNoteInfo:!1,fileType:""},dataLength:0,tableLoding:!1,fullscreenLoading:!1,queryConfig:function(t,a,r){e.fullscreenLoading=!0,e.$sacpApis.enterpriseList({customerId:e.curCustomerId,projectId:e.curProjectId,mergeScope:e.activeName,type:e.$constantVar.API_SACP_QUERY_COMPANY,pageNum:t,pageSize:a}).then(function(t){t.success?t.data?(t.data.map(function(e){e.extractionRatio=parseFloat(100*e.extractionRatio).toFixed(2)+"%",e.incomeTaxRate=e.incomeTaxRate+"%"}),e.tableDataList=t.data,e.dataLength=e.tableDataList,e.handleValidTotal()):e.dataLength=0:e.$message.error(t.resultInfo.statusText)}).finally(function(){return e.fullscreenLoading=!1})},mergeScopeOptions:this.$DIC("合并范围"),projectSouce:this.$DIC("合并报表项目来源"),uploadFileList:[],filedata:new FormData,setBorder:!0,validProjectTotal:0,passValid:0,failedValid:0,isShowProjectPanorama:!1,curCustomerId:"",curProjectId:"",curAccYear:"",menuId:"HB002-MC001",activeLabel:"",isInit:!0,auditAjustmnetData:[],adjustTableData:[],selList:[],userDefined:"",oldTableData:{},showDebLabel:"",activeName:"2",oldActieRowData:{},changeMergeScopeReason:"",haschangeMergeScope:!1,uploadFileListDialogTableVisible:!1,fileListColumns:[{prop:"autoId",label:"处理",fixed:!0,width:"170px",filterOptions:{disabled:!0}},{prop:"fileName",label:"文件名称",fixed:!0,filterOptions:{disabled:!0}},{prop:"uploadDate",label:"上传时间",fixed:!0,formatter:{type:"function",value:this.formatterDate},filterOptions:{disabled:!0}},{prop:"userName",label:"上传人",fixed:!0,filterOptions:{disabled:!0}}],fileList:[],causeDescription:"",causeDescriptionCache:""}},methods:{fillChangeMergeScopeReason:function(){return this.mergeScopeEditFormData.curMergeProportion<=50&&"1"===this.mergeScopeEditFormData.mergeScope?(this.haschangeMergeScope=!0,this.mergeUploadDialogVisible=!0,!1):this.mergeScopeEditFormData.curMergeProportion&&this.mergeScopeEditFormData.curMergeProportion>50&&"0"===this.mergeScopeEditFormData.mergeScope?(this.haschangeMergeScope=!0,this.mergeUploadDialogVisible=!0,!1):(this.haschangeMergeScope=!1,this.mergeUploadDialogVisible=!1,!0)},handleReviewUploadFile:function(e){var t=this;this.uploadFileListDialogTableVisible=!0,this.fullscreenLoading=!0,this.$sacpApis.hbMergeProjectQueryHbFile({jsonData:o()({mergeProjectId:e.row.mergeProjectId})}).then(function(e){e.success?t.fileList=e.data||[]:t.$message.error(e.resultInfo.statusText)}).catch(function(e){return t.$message.error(e)}).finally(function(){t.fullscreenLoading=!1})},reviewFile:function(e){if(!e.row.fileName||e.row.fileName.indexOf(".xlsx")>-1||e.row.fileName.indexOf(".zip")>-1)return this.$message.error("预览功能仅支持图片和PDF类型文件!");var t=this.$router.resolve({name:"PreviewPdf",query:{randomNum:e.row.autoId}}).href;window.open(t,"_blank")},deleteFile:function(e){var t=this;this.fullscreenLoading=!0,this.$sacpApis.deleteAttachment(e.row.autoId).then(function(a){a.success?t.$message.success("删除成功!")&&t.handleReviewUploadFile(e):t.$message.error(a.resultInfo.statusText)}).catch(function(e){return t.$message.error(e)}).finally(function(){t.fullscreenLoading=!1})},downloadFile:function(e){var t=window.location.origin+"/Faith/dgCenter/HbMergeProject.downloadAttachment.json?param1="+e.row.autoId;window.open(t,"_blank")},handleInitData:function(e){var t=this,a="";a=e.row.hasChildAdjust?"初始化子公司数据会删除子公司的试算平衡表、审定报表，确认要初始化吗？":"初始化子公司数据会删除子公司的试算平衡表、审定报表、子公司审计调整数据，确认要初始化吗？",this.$confirm(a,"确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.row.hasChildAdjust?t.$confirm("是否保留分录","确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.confirmInitData(e,!0)}).catch(function(){return t.confirmInitData(e,!1)}):t.confirmInitData(e,!1)}).catch(function(e){})},confirmInitData:function(e,t){var a=this;this.fullscreenLoading=!0;var r={mergeProjectId:e.row.mergeProjectId,retainChildAdjust:t};this.$sacpApis.getInitSingleCompanyData(r).then(function(e){e.success?(a.$message.success("初始化数据成功!"),a.mergeScopeInit(),a.$eventBus.$emit("page-refresh",e.resultInfo.refreshIndexes)):a.$message.error(e.resultInfo.statusText)}).catch(function(e){return a.$message.error(e)}).finally(function(){return a.fullscreenLoading=!1})},uploadChange:function(e,t){if(this.uploadFileList.some(function(t){return t.name==e.name}))return this.$message.warning("不可以重复上传相同文件名文件,请删除!");this.uploadFileList.push(e.raw)},causeDescriptionChange:function(e){this.causeDescriptionCache=this.causeDescription},confirUpload:function(){var e=this;if(!this.uploadFileList||!this.uploadFileList.length)return this.$message.error("请上传文件!");if(this.uploadFileList.map(function(t,a){e.filedata.append("file"+a,t)}),this.haschangeMergeScope){if(!this.causeDescription.trim())return this.$message.error("请填写说明原因!");this.handleUplaodReasonFile()}else this.handleUploadSuccess()},handleUplaodReasonFile:function(){var e=this;this.fullscreenLoading=!0,this.filedata.append("mergeProjectId",this.mergeScopeEditFormData.mergeProjectId),this.$sacpApis.hbMergeProjectBatchUploadbulkUpload(this.filedata).then(function(t){if(t.success)e.$message.success("上传成功!");else{var a=t.resultInfo.statusText;e.$message.error(a)}}).catch(function(t){return e.$message.error(t)}).finally(function(){e.clearUploadData(),e.mergeUploadDialogVisible=!1,e.dialogVisible=!1,e.fullscreenLoading=!1,e.haschangeMergeScope=!1})},clearUploadData:function(){this.$refs.uploadExcel;this.excelFile="",this.excelName="",this.uploadFileList=[],this.causeDescription="",this.filedata=new FormData},handleUploadSuccess:function(){var e=this;this.$sacpApis.bulkUpload(this.filedata).then(function(t){if(t.success)e.clearUploadData(),e.uploadSuccessCB(t.data);else{var a=t.resultInfo.statusText;e.$message.error(a)}}).catch(function(t){return e.$message.error(t)}).finally(function(){e.mergeUploadDialogVisible=!1,e.dialogVisible=!1})},uploadSuccessCB:function(e){var t=this;this.uploadedCBData.fileId=e,this.$sacpApis.mergeScopeUploadCB(this.uploadedCBData).then(function(e){e.success?(t.$message.success("上传成功"),t.mergeScopeInit(),t.$eventBus.$emit("page-refresh",e.resultInfo.refreshIndexes)):t.$message.error(e.resultInfo.statusText)}).catch(function(e){t.$message.error(e)})},beforeRemove:function(e,t){this.uploadFileList=this.uploadFileList.filter(function(t){return t.name!=e.name})},cancelUpload:function(){this.mergeUploadDialogVisible=!1,this.uploadFileList=[],this.causeDescription="",this.causeDescriptionCache=""},handleActive:function(e){var t=this,a={autoId:e};this.$sacpApis.deleteActive(a).then(function(e){e.success?(t.$store.commit("setRefreshUnImportRelate",!1),t.activedFlage&&t.$store.commit("setRemoveAliveList","mergeScopeIn"),t.mergeScopeInit()):t.$message.error(e.resultInfo.statusText)}).catch(function(e){return t.$message.error(e)})},handleMergeScopeProject:function(e){if(e){var t=this.mergeProjectNameList.filter(function(t){return t.projectid==e});this.mergeScopeEditFormData.mergeProjectId=t[0].projectid,this.mergeScopeEditFormData.mergeProjectName=t[0].projectname}},clearMergeProjectName:function(){this.$set(this.mergeScopeEditFormData,"mergeProjectName",""),this.$set(this.mergeScopeEditFormData,"mergeProjectId","")},submitEditDialogForm:function(e){var t=this;if(this.haschangeMergeScope&&!this.causeDescriptionCache)return this.fillChangeMergeScopeReason();this.mergeScopeEditFormData.causeDescription=this.causeDescriptionCache?this.causeDescriptionCache:this.mergeScopeEditFormData.causeDescription,this.$refs[e].validate(function(a){a?t.$sacpApis.mergeScopeEditSave(t.mergeScopeEditFormData).then(function(a){a.success?(t.oldActieRowData.mergeScope!=t.mergeScopeEditFormData.mergeScope&&(0==t.mergeScopeEditFormData.mergeScope?t.$store.commit("setRemoveAliveList","mergeScopeOut"):1==t.mergeScopeEditFormData.mergeScope&&t.$store.commit("setRemoveAliveList","mergeScopeIn")),t.$eventBus.$emit("page-refresh",a.resultInfo.refreshIndexes),t.$message.success("编辑成功"),t.$refs[e].resetFields(),t.mergeScopeEditDialogTableVisible=!1,t.mergeScopeInit()):t.$message.error(a.resultInfo.statusText)}).catch(function(e){t.$message.error(e)}):t.$message.error("校验未过!")})},fmtProject:function(e,t){return e.mergeProjectId||e.mergeProjectName?-1!=e.mergeProjectName.indexOf("-")?e.mergeProjectName:e.mergeProjectId+"-"+e.mergeProjectName:"-"},fmtCheckStatus:function(e,t){switch(t){case"1":return"√";default:return"×"}},fmtEquity:function(e,t){return t+"%"},fmtMergeScope:function(e,t){switch(t){case"1":return"合并范围内";default:return"合并范围外且是关联方"}},fmtSource:function(e,t){switch(t){case"1":return"SACP";case"2":return"PM";case"3":return"非SACP报表审计";case"4":return"非SACP的BDO境外审计";case"5":return"非SACP其他事务所审计"}},editProject:function(e){this.oldActieRowData=e,this.mergeProjectNameList=[],this.mergeScopeEditDialogTableVisible=!0;var t=this.mergeScopeEditFormData;t.autoId=e.autoId,t.checkStatus=e.checkStatus,t.customerId=e.customerId,t.stockBreakRate=e.stockBreakRate,t.mergeCustomerId=e.mergeCustomerId,t.mergeCustomerName=e.mergeCustomerName,t.mergeFinanceReportType=e.mergeFinanceReportType,t.mergeProjectId=e.mergeProjectId,t.mergeProjectName=e.mergeProjectName,t.isUnitChildProject=e.isUnitChildProject,t.mergeScope=e.mergeScope,t.noteStatus=e.noteStatus,t.projectSource=e.projectSource,t.reportStatus=e.reportStatus,t.shortName=e.shortName,t.trialBalanceStatus=e.trialBalanceStatus,t.equityRatio=e.equityRatio,t.curMergeProportion=e.curMergeProportion,t.preMergeProportion=e.preMergeProportion,t.incomeTaxRate=e.incomeTaxRate,t.uscc=e.uscc,t.projectId=this.curProjectId,this.getProjectNameList(t.mergeCustomerId)},delProject:function(e,t,a){var r=this,o={autoIds:e};this.$sacpApis.mergeScopeDelete(o).then(function(e){e.success?(r.$message.success("删除成功"),r.mergeScopeInit()):r.$message.error(e.resultInfo.statusText)}).catch(function(e){r.$message.error(e)})},openView:function(e,t){switch(t){case"QUERY_TB":if("1"!==e.trialBalanceStatus)return void this.$message("试算平衡表未导入！");var a="";a=-1!=e.mergeProjectName.indexOf("-")?e.mergeProjectName:e.mergeProjectId+"-"+e.mergeProjectName;var r={customerId:e.customerId,mergeCustomerName:e.mergeCustomerName,projectId:a,type:t,curYear:this.curAccYear,mergeCustomerId:e.mergeCustomerId};sessionStorage.setItem("projectItem",o()(r)),this.checkTb(r);break;case"QUERY_REPORT":if("1"!==e.reportStatus)return void this.$message("审定报表未导入！");a="";a=-1!=e.mergeProjectName.indexOf("-")?e.mergeProjectName:e.mergeProjectId+"-"+e.mergeProjectName;r={customerId:e.customerId,mergeCustomerName:e.mergeCustomerName,projectId:a,type:t,curYear:this.curAccYear,mergeCustomerId:e.mergeCustomerId};sessionStorage.setItem("projectItem",o()(r)),this.checkReport(r);break;case"note":if("0"===e.noteStatus)return void this.$parent.$message("附注未导入！");a="";a=-1!=e.mergeProjectName.indexOf("-")?e.mergeProjectName:e.mergeProjectId+"-"+e.mergeProjectName;r={customerId:e.customerId,mergeCustomerName:e.mergeCustomerName,projectId:a,type:"",mergeCustomerId:e.mergeCustomerId};sessionStorage.setItem("projectItem",o()(r)),this.checkNote(r)}},checkTb:function(e){var t=this.$router.resolve({path:"/checkTb",query:{curYear:e.curYear,menuID:"HB002-MC004-0001"}}).href;window.open(t,"_blank")},checkReport:function(e){var t=this.$router.resolve({path:"/checkReport",query:{curYear:e.curYear,menuID:"HB002-MC005-001"}}).href;window.open(t,"_blank")},checkNote:function(e){var t=this.$router.resolve({path:"/checkNote",query:{curYear:e.curYear}}).href;window.open(t,"_blank")},calcTaskProgress:function(e,t){return t?Math.round(e/t*100):0},importFile:function(e,t,a){this.uploadedCBData.mergeProjectId=a.row.mergeProjectId,this.mergeUploadDialogVisible=!0},getProjectNameList:function(e){var t=this,a={customerId:e};this.$sacpApis.reachProjectInfo(a).then(function(e){e.success?e.data&&e.data.find(function(e){var a={projectid:e.projectId,projectname:e.ProjectName};t.mergeProjectNameList.push(a)}):t.$message.error(e.resultInfo.statusText)}).catch(function(e){t.$message.error(e)})},isRefreshDataLength:function(e){this.dataLength=e},handleValidTotal:function(){var e=this;this.$sacpApis.mergeScopeValidTotal({activeName:this.activeName}).then(function(t){t.success?(e.passValid=t.data[0].checkPassNumber,e.failedValid=t.data[0].checkFailureNumber,e.validProjectTotal=t.data[0].projectSize):e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)}).finally()},handleCurstomerId:function(){var e=JSON.parse(sessionStorage.getItem("curCustomerData"));this.curCustomerId=e.curCustomerId,this.curProjectId=e.curProjectId,this.curAccYear=e.curYear,this.isInit=!1},mergeScopeInit:function(){var e=this;this.fullscreenLoading=!0;this.$sacpApis.enterpriseList({customerId:this.curCustomerId,projectId:this.curProjectId,mergeScope:this.activeName}).then(function(t){t.success?t.data?(e.tableDataList=t.data,e.dataLength=t.totalCount,e.handleValidTotal()):e.dataLength=0:e.$message.error(t.resultInfo.statusText)}).catch(function(t){e.$message.error(t)}).finally(function(){e.fullscreenLoading=!1,e.isInit=!0,e.$store.commit("setMergeScopeRefresh",!1)})},formatterDate:function(e,t){return m.a.toDateString(t,"yyyy-MM-dd HH:mm:ss")},hasChildAdjust:function(){if(this.tableDataList&&this.tableDataList.length)return this.tableDataList.some(function(e){return e.hasChildAdjust})},exportFile:function(){var e={columns:this.columnsList,params:{param1:this.curCustomerId,param2:this.curProjectId,param3:this.activeName},url:"dgCenter/HbMergeProject.enterpriseList.json",fileName:"非关联方"};this.exportExcel(e)}},activated:function(){var e=this;this.$eventBus.$off("click-tab").$on("click-tab",function(t){t&&t.indexId===e.flag&&t.isMark&&e.mergeScopeInit()})},created:function(){this.handleCurstomerId(),this.selList=this.$DIC("借贷"),this.mergeScopeOptions=this.$DIC("合并范围")}},k={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"unimportRelate"},[a("bdo-table",{ref:"table",attrs:{columns:e.columnsList,"enable-filter":!1,"enable-toolbox":!1,"enable-view-type":!1,data:e.tableDataList,"page-total":e.tableDataList.length,"responsive-height-gap":e.bodyHeight,showIndexColumn:!1,showCheckBox:!1,tableLoding:e.tableLoding,queryConfig:e.queryConfig,setBorder:e.setBorder,exportReport:!1},on:{isRefreshDataLength:e.isRefreshDataLength,exportFile:e.exportFile},scopedSlots:e._u([{key:"col-autoId",fn:function(t){return[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"编辑",placement:"top-start"}},[a("el-button",{staticClass:"editBtnCol",attrs:{size:"small",type:"text",icon:"el-icon-edit-outline normalWeight"},on:{click:function(a){return e.editProject(t.row)}}})],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"导入",placement:"top-start"}},[a("el-button",{staticClass:"uploadBtnCol",attrs:{size:"small",type:"text",disabled:!t.row.mergeProjectName,icon:"el-icon-upload normalWeight"},on:{click:function(a){return e.importFile(t.row.autoId,t.row.customerId,t)}}})],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"激活",placement:"top-start"}},[a("el-button",{staticClass:"activeBtnCol",attrs:{size:"small",type:"text",icon:"el-icon-s-opportunity normalWeight"},on:{click:function(a){return e.handleActive(t.row.autoId)}}})],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"初始化数据",placement:"top-start"}},[a("el-button",{staticClass:"activeBtnCol",attrs:{size:"small",type:"text",icon:"el-icon-switch-button"},on:{click:function(a){return e.handleInitData(t)}}})],1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"查看上传文件",placement:"top-start"}},[a("el-button",{staticClass:"activeBtnCol",attrs:{size:"small",type:"text",icon:"el-icon-document-copy normalWeight"},on:{click:function(a){return e.handleReviewUploadFile(t)}}})],1)]}},{key:"col-trialBalanceStatus",fn:function(t){return["1"===t.row.trialBalanceStatus?a("el-button",{attrs:{size:"small",type:"text"},on:{click:function(a){return e.openView(t.row,"QUERY_TB")}}},[e._v("查看"),t.row.checkTb?e._e():a("span",{staticClass:"errorInfo"},[e._v("(校验失败)")])]):e._e(),e._v(" "),"1"!==t.row.trialBalanceStatus?a("span",[e._v("未导入")]):e._e()]}},{key:"col-reportStatus",fn:function(t){return["1"===t.row.reportStatus?a("el-button",{attrs:{size:"small",type:"text"},on:{click:function(a){return e.openView(t.row,"QUERY_REPORT")}}},[e._v("查看"),t.row.checkReport?e._e():a("span",{staticClass:"errorInfo"},[e._v("(校验失败)")])]):e._e(),e._v(" "),"1"!==t.row.reportStatus?a("span",[e._v("未导入")]):e._e()]}},{key:"col-noteStatus",fn:function(t){return["1"===t.row.noteStatus||"2"===t.row.noteStatus?a("el-button",{attrs:{size:"small",type:"text"},on:{click:function(a){return e.openView(t.row,"note")}}},[e._v("查看\n                "),"2"===t.row.noteStatus&&"0"===t.row.checkStatus?a("span",{staticClass:"errorInfo"},[e._v("(校验失败)")]):e._e(),e._v(" "),"1"===t.row.noteStatus&&"1"===t.row.checkStatus?a("span",{staticClass:"errorInfo"},[e._v("(未校验)")]):e._e()]):e._e(),e._v(" "),"0"!==t.row.noteStatus||"0"!==t.row.checkStatus&&"1"!==t.row.checkStatus?e._e():a("span",[e._v("未导入")])]}}])},[a("template",{slot:"text"},[a("div",{staticClass:"totalValidMessage"},[e._v("\n                项目数:"+e._s(e.validProjectTotal)+"件 校验通过:"+e._s(e.passValid)+"件\n                "),a("span",{class:e.failedValid?"errorInfo":""},[e._v("校验失败:"+e._s(e.failedValid)+"件")])])])],2),e._v(" "),a("el-dialog",{attrs:{title:e.haschangeMergeScope?"原因说明":"导入",visible:e.mergeUploadDialogVisible,"destroy-on-close":!0,"before-close":e.cancelUpload,width:"40%"},on:{"update:visible":function(t){e.mergeUploadDialogVisible=t}}},[a("div",[e.haschangeMergeScope?a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:5}},[a("span",{staticStyle:{color:"red"}},[e._v("* ")]),a("span",[e._v("原因说明:")])]),e._v(" "),a("el-col",{attrs:{span:19}},[a("el-input",{attrs:{type:"textarea",maxlength:"60","show-word-limit":""},on:{blur:e.causeDescriptionChange},model:{value:e.causeDescription,callback:function(t){e.causeDescription=t},expression:"causeDescription"}})],1)],1):e._e(),e._v(" "),a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:5}},[e.haschangeMergeScope?a("span",{staticStyle:{color:"red"}},[e._v("*\n                    ")]):e._e()]),e._v(" "),a("el-col",{staticClass:"reasonUpload",attrs:{span:e.haschangeMergeScope?19:24}},[a("el-upload",{ref:"uploadFile",staticClass:"uploadTool",attrs:{drag:"",action:"",multiple:"","file-list":e.uploadFileList,accept:e.haschangeMergeScope?".xlsx,.zip,.jpg,.pdf,.png,.jpeg":".xlsx,.zip","auto-upload":!1,"on-change":e.uploadChange,"on-remove":e.beforeRemove}},[a("i",{staticClass:"el-icon-upload"}),e._v(" "),a("div",{staticClass:"el-upload__text"},[e._v("\n                            将文件拖到此处，或"),a("em",[e._v("点击上传")]),e._v(" "),e.haschangeMergeScope?e._e():a("p",[e._v("\n                                只能上传excel或zip文件\n                            ")])])])],1)],1)],1),e._v(" "),a("div",{staticClass:"buttonList"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.confirUpload}},[e._v("确定")]),e._v(" "),a("el-button",{attrs:{type:"info",size:"small"},on:{click:e.cancelUpload}},[e._v("取消")])],1)]),e._v(" "),a("el-dialog",{attrs:{title:"编辑",visible:e.mergeScopeEditDialogTableVisible,"destroy-on-close":!0,width:"40%"},on:{"update:visible":function(t){e.mergeScopeEditDialogTableVisible=t}}},[a("el-form",{ref:"mergeScopeEditFormData",attrs:{model:e.mergeScopeEditFormData,rules:e.mergeScopedEditFormRule}},[a("el-form-item",{attrs:{label:"公司名称","label-width":e.formLabelWidth,prop:"mergeCustomerName"}},[a("el-input",{attrs:{disabled:""},model:{value:e.mergeScopeEditFormData.mergeCustomerName,callback:function(t){e.$set(e.mergeScopeEditFormData,"mergeCustomerName","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.mergeCustomerName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"项目简称","label-width":e.formLabelWidth,prop:"shortName"}},[a("el-input",{attrs:{type:"text"},model:{value:e.mergeScopeEditFormData.shortName,callback:function(t){e.$set(e.mergeScopeEditFormData,"shortName","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.shortName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"统一社会信用代码","label-width":e.formLabelWidth,prop:"uscc"}},[a("el-input",{attrs:{maxlength:"25"},model:{value:e.mergeScopeEditFormData.uscc,callback:function(t){e.$set(e.mergeScopeEditFormData,"uscc","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.uscc"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"认缴比例","label-width":e.formLabelWidth,prop:"stockBreakRate"}},[a("el-input",{model:{value:e.mergeScopeEditFormData.stockBreakRate,callback:function(t){e.$set(e.mergeScopeEditFormData,"stockBreakRate","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.stockBreakRate"}},[a("i",{staticClass:"percent",staticStyle:{"font-style":"normal"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("%")])])],1),e._v(" "),a("el-form-item",{attrs:{label:"权益比例","label-width":e.formLabelWidth,prop:"equityRatio"}},[a("el-input",{model:{value:e.mergeScopeEditFormData.equityRatio,callback:function(t){e.$set(e.mergeScopeEditFormData,"equityRatio","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.equityRatio"}},[a("i",{staticClass:"percent",staticStyle:{"font-style":"normal"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("%")])])],1),e._v(" "),a("el-form-item",{attrs:{label:"合并比例（本期）","label-width":e.formLabelWidth,prop:"curMergeProportion"}},[a("el-input",{on:{blur:e.fillChangeMergeScopeReason},model:{value:e.mergeScopeEditFormData.curMergeProportion,callback:function(t){e.$set(e.mergeScopeEditFormData,"curMergeProportion","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.curMergeProportion"}},[a("i",{staticClass:"percent",staticStyle:{"font-style":"normal"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("%")])])],1),e._v(" "),a("el-form-item",{attrs:{label:"合并比例（上期）","label-width":e.formLabelWidth,prop:"preMergeProportion"}},[a("el-input",{model:{value:e.mergeScopeEditFormData.preMergeProportion,callback:function(t){e.$set(e.mergeScopeEditFormData,"preMergeProportion","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.preMergeProportion"}},[a("i",{staticClass:"percent",staticStyle:{"font-style":"normal"},attrs:{slot:"suffix"},slot:"suffix"},[e._v("%")])])],1),e._v(" "),a("el-form-item",{attrs:{label:" 所得税税率 %","label-width":e.formLabelWidth,prop:"incomeTaxRate"}},[a("el-input",{model:{value:e.mergeScopeEditFormData.incomeTaxRate,callback:function(t){e.$set(e.mergeScopeEditFormData,"incomeTaxRate","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.incomeTaxRate"}})],1),e._v(" "),a("el-form-item",{staticClass:"mergeScopeSelect",attrs:{label:"合并范围","label-width":e.formLabelWidth,prop:"mergeScope"}},[a("el-select",{attrs:{placeholder:"请选择合并范围"},model:{value:e.mergeScopeEditFormData.mergeScope,callback:function(t){e.$set(e.mergeScopeEditFormData,"mergeScope","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.mergeScope"}},e._l(e.mergeScopeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1),e._v(" "),e.haschangeMergeScope?a("div",{staticClass:"resetBtn",on:{click:function(t){e.mergeUploadDialogVisible=!0}}},[a("el-button",{attrs:{circle:"",size:"small",type:"primary",icon:"el-icon-edit-outline",title:"原因说明"}})],1):e._e()],1),e._v(" "),a("el-form-item",{staticClass:"projectSource",attrs:{label:"项目来源","label-width":e.formLabelWidth,prop:"projectSource"}},[a("el-select",{attrs:{placeholder:"请选择项目来源"},model:{value:e.mergeScopeEditFormData.projectSource,callback:function(t){e.$set(e.mergeScopeEditFormData,"projectSource","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.projectSource"}},e._l(e.projectSouce,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{staticClass:"projectName",attrs:{label:"项目名称","label-width":e.formLabelWidth,prop:"mergeProjectName"}},[a("el-select",{staticClass:"projectList",attrs:{placeholder:"请选择项目名称",clearable:"",filterable:""},on:{clear:e.clearMergeProjectName,change:e.handleMergeScopeProject},model:{value:e.mergeScopeEditFormData.mergeProjectName,callback:function(t){e.$set(e.mergeScopeEditFormData,"mergeProjectName","string"==typeof t?t.trim():t)},expression:"mergeScopeEditFormData.mergeProjectName"}},e._l(e.mergeProjectNameList,function(e,t){return a("el-option",{key:t,attrs:{label:e.projectname,value:e.projectid}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"是否母公司单体项目:"}},[a("el-radio-group",{staticClass:"isUnitChildProject",model:{value:e.mergeScopeEditFormData.isUnitChildProject,callback:function(t){e.$set(e.mergeScopeEditFormData,"isUnitChildProject",t)},expression:"mergeScopeEditFormData.isUnitChildProject"}},[a("el-radio",{attrs:{label:"0"}},[e._v("否")]),e._v(" "),a("el-radio",{attrs:{label:"1"}},[e._v("是")])],1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"info",size:"small"},on:{click:function(t){e.mergeScopeEditDialogTableVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.submitEditDialogForm("mergeScopeEditFormData")}}},[e._v("确 定")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"上传文件列表",visible:e.uploadFileListDialogTableVisible,"destroy-on-close":!0,width:"75%"},on:{"update:visible":function(t){e.uploadFileListDialogTableVisible=t}}},[a("bdo-table",{ref:"uploadFileTable",attrs:{columns:e.fileListColumns,"enable-filter":!1,"enable-toolbox":!1,"enable-view-type":!1,data:e.fileList,"page-total":e.fileList.length||0,"responsive-height-gap":e.bodyHeight,showIndexColumn:!0,enableHeadConfig:!1,headerListConfig:!0,enableRefresh:!1,showCheckBox:!1,setBorder:e.setBorder},scopedSlots:e._u([{key:"col-autoId",fn:function(t){return[a("el-button",{attrs:{title:"预览",size:"small",type:"text",icon:"el-icon-view normalWeight selfGreen"},on:{click:function(a){return e.reviewFile(t)}}}),e._v(" "),a("el-button",{attrs:{title:"删除文件",size:"small",type:"text",icon:"el-icon-delete normalWeight delBtnCol"},on:{click:function(a){return e.deleteFile(t)}}}),e._v(" "),a("el-button",{attrs:{title:"下载",size:"small",type:"text",icon:"el-icon-download normalWeight selfBlue"},on:{click:function(a){return e.downloadFile(t)}}})]}}])})],1)],1)},staticRenderFns:[]};var T=a("VU/8")($,k,!1,function(e){a("kJUT"),a("0CTG")},"data-v-2fd37217",null).exports,L=(a("30bX"),{name:"mergeScope",mixins:[v.a],components:{BdoTable:c.a,aduitAjustment:g,mergeScopeIn:w,mergeScopeOut:j,unimportRelate:T},props:{customerData:Array},computed:{openAdjust:function(){return this.$store.state.openAdjustDialog},getRefreshPagesId:function(){return this.$store.state.addBagdeScope},refreshImportRelate:function(){return this.$store.state.refreshPagesMenuId},initAllSubsidiaryData:function(){return this.$store.state.initMergeScope}},watch:{getRefreshPagesId:{handler:function(e){if(e){var t=window.location.hash.split("=");this.mergeScopeTabs.forEach(function(t){t.isMark=!(!("string"==typeof e&&e.indexOf(t.indexId)>-1||"object"===(void 0===e?"undefined":l()(e))&&e.refreshIndexes&&e.refreshIndexes.indexOf(t.indexId)>-1)||"HB002-MC007"==t.indexId||"HB002-MC003"==t.indexId)});var a=this.mergeScopeTabs.filter(function(e){return e.name===t[t.length-1]})[0],r=a?a.label:"";window.location.hash.indexOf("/MergeScope")>-1&&a&&!0===a.isMark&&this.handleClick({name:t[t.length-1],label:r})}},immediate:!0,deep:!0},refreshImportRelate:{handler:function(e){e===this.flag&&this.offsetEntryInit()}},openAdjust:{handler:function(e){this.adjustDebDialog=e.flage,this.active=e.active,e&&this.adjustDebTableInit()},immediate:!0,deep:!0},initAllSubsidiaryData:{handler:function(e){e&&this.initSonCompanyData()},immediate:!0}},data:function(){return{blackList:"",currentTabComponent:"mergeScopeIn",active:0,adjustDebDialog:!1,isAduitAjustment:!1,activeName:"1",mergeScopeTabs:[{label:"合并范围内",name:"1",indexId:"HB002-MC001",routeName:"mergeScopeIn",isMark:!1},{label:"合并范围外且是关联方",name:"0",indexId:"HB002-MC002",routeName:"mergeScopeOut",isMark:!1},{label:"非关联方",name:"2",indexId:"HB002-MC003",routeName:"unimportRelate",isMark:!1},{label:"审计调整汇总",name:"3",indexId:"HB002-MC007",routeName:"aduitAjustment",isMark:!1}],customerId:"",projectId:"",tableData:[],mergeScope:1,uploadedCBData:{mergeProjectId:"",fileId:"",isParentNoteInfo:!1,fileType:""},dataLength:0,fullscreenLoading:!1,curCustomerId:"",curProjectId:"",curAccYear:"",menuId:"HB002-MC001",activeLabel:"",isInit:!0,isShowRemark:!1,auditAjustmnetData:[],adjustTableData:[],selList:[],userDefined:"",oldTableData:{},showDebLabel:"",activeTabCollection:[],isInitAll:!1,fullScreen:!1}},methods:{fullScreenChange:function(){this.fullScreen=!this.fullScreen},initSonCompanyData:function(){var e,t=this,a=window.location.hash.split("="),r=!1;if(a&&a.length)switch(a[a.length-1]){case"0":r=this.$refs.mergeScopeOut.hasChildAdjust();break;case"1":r=this.$refs.mergeScopeIn.hasChildAdjust();break;case"2":r=this.$refs.unimportRelate.hasChildAdjust();break;default:r=!1}e=(r=!1)?"初始化子公司数据会删除子公司的试算平衡表、审定报表，确认要初始化吗？":"初始化子公司数据会删除子公司的试算平衡表、审定报表、子公司审计调整数据，确认要初始化吗？",this.$confirm(e,"确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){r?t.$confirm("是否保留分录","确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.confirmInitData(!0)}).catch(function(){return t.confirmInitData(!1)}):t.confirmInitData(!1)}).catch(function(e){})},confirmInitData:function(e){var t=this;this.fullscreenLoading=!0,this.$sacpApis.getInitDataForMergeScope({retainChildAdjust:e}).then(function(e){if(e.success){t.$message.success("初始化子公司数据成功!"),t.$eventBus.$emit("page-refresh",e.resultInfo.refreshIndexes);var a={flage:!0,active:t.active};t.$store.commit("setOpenAdjust",a)}else t.$message.error(e.resultInfo.statusText)}).catch(function(e){return t.$message.error(e)}).finally(function(){t.fullscreenLoading=!1,t.$store.commit("setInitMergeScope",!1)})},filterAgeMethod:function(e){var t=e.value,a=e.row;e.column;return a.direction==t},closeAdjustDebDialog:function(){return this.adjustDebDialog=!1,this.$store.commit("setOpenAdjust",!1),!1},saveOldRow:function(e){this.oldTableData=s()({},e)},roleChangeEvent:function(e){var t=this;e&&"贷"==e.showDebLabel?e.direction=-1:e&&"借"==e.showDebLabel&&(e.direction=1),this.active>=3?this.$confirm("节点试算平衡表已完成,修改借贷方向提示 修改科目借贷方向会初始化试算平衡表，确认修改？","确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.handleAdjustDebTab(e)}).catch(function(a){e.showDebLabel=t.oldTableData.showDebLabel}):this.handleAdjustDebTab(e)},handleAdjustDebTab:function(e){var t=this;this.fullscreenLoading=!0;var a={autoId:e.autoId,direction:e.direction,tbSubjectCode:e.tbSubjectId};this.$sacpApis.updateProjectTb(a).then(function(a){a.success?(t.$message.success("修改借贷方向成功!"),e.userDefined=3):t.$message.error(a.resultInfo.statusText)}).catch(function(e){return t.$message.error(e)}).finally(function(){return t.fullscreenLoading=!1}),3==e.userDefined&&this.active<3?this.$refs.adjuctXTable.reloadData(this.adjustTableData):this.$refs.adjuctXTable.reloadRow(e,null,null)},rowClassName:function(e){var t=e.row;e.rowIndex;return 1==t.userDefined?"row-green":2==t.userDefined?"row-lightBlue":3==t.userDefined?"row-white":void 0},adjustDebTableInit:function(){var e=this;this.$sacpApis.queryProjectTb().then(function(t){t.success?(e.adjustTableData=t.data,e.adjustTableData.map(function(e){1==e.direction?e.showDebLabel="借":-1==e.direction&&(e.showDebLabel="贷")})):e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)})},handleClick:function(e){var t=this;switch(this.mergeScopeTabs.forEach(function(a){a.label==e.label&&a.name==e.name&&(t.currentTabComponent=a.routeName,!0===a.isMark&&(a.isMark=!1,"mergeScopeIn"===a.routeName?t.$nextTick(function(){t.$refs.mergeScopeIn.mergeScopeInit()}):"mergeScopeOut"===a.routeName?t.$nextTick(function(){t.$refs.mergeScopeOut.mergeScopeInit()}):"unimportRelate"===a.routeName&&t.$nextTick(function(){t.$refs.unimportRelate.mergeScopeInit()}),t.removeClickedMenuId(t.getRefreshPagesId,a.indexId)))}),e.name){case"0":this.menuId="HB002-MC002",this.activeLabel="合并范围外且是关联方",this.isShowRemark=!1,this.isAduitAjustment=!1;break;case"1":this.menuId="HB002-MC001",this.activeLabel="合并范围内",this.isShowRemark=!1,this.isAduitAjustment=!1;break;case"2":this.menuId="HB002-MC003",this.activeLabel="非关联方",this.isShowRemark=!0,this.isAduitAjustment=!1;break;case"3":this.menuId="HB002-MC007",this.activeLabel="审计调整汇总",this.isShowRemark=!1,this.isAduitAjustment=!0,this.offsetEntryInit()}this.$router.push({name:"MergeScope",query:{tab:e.name}}),this.$store.commit("setClosePostill",!1),this.$store.commit("setMenuId",this.menuId),this.$store.commit("setActiveLabel",this.activeLabel),this.$store.commit("setMergeScopeActiveTab",e.name);this.activeTabCollection.some(function(t){return t==e.name});this.activeTabCollection.push(e.name),this.mergeScopeTabs.every(function(e){return 0==e.isMark})&&(this.$store.commit("setRemoveBagdeScope","MergeScope"),this.deleteLocalStorage("HB002"))},deleteLocalStorage:function(e){var t=JSON.parse(localStorage.getItem("refreshIndexes"));if(t&&t.refreshIndexes&&t.refreshIndexes.length){var a="string"==typeof t.refreshIndexes&&t.refreshIndexes.split(",")||t.refreshIndexes;a=a.filter(function(t){return-1===t.indexOf(e)});var r={key:t.key,refreshIndexes:a.join()};localStorage.setItem("refreshIndexes",o()(r))}},removeClickedMenuId:function(e,t){if(e&&"string"==typeof e){var a=e.split(",").filter(function(e){return e!=t}).join();this.$eventBus.$emit("page-refresh",a)}},mergeScopeInit:function(){var e=this;this.fullscreenLoading=!0;this.$sacpApis.enterpriseList({customerId:this.curCustomerId,projectId:this.curProjectId,mergeScope:this.activeName}).then(function(t){t.success?t.data?(e.tableData=t.data,e.dataLength=t.totalCount,e.handleValidTotal()):e.dataLength=0:e.$message.error(t.resultInfo.statusText)}).catch(function(t){e.$message.error(t)}).finally(function(){e.fullscreenLoading=!1,e.isInit=!0,e.$store.commit("setMergeScopeRefresh",!1)})},handleValidTotal:function(){var e=this;this.$sacpApis.mergeScopeValidTotal({activeName:this.activeName}).then(function(t){if(t.success){var a=t.data[0],r=a.checkPassNumber,o=a.checkFailureNumber,i=a.projectSize;a.directionStatusCheck;e.passValid=r,e.failedValid=o,e.validProjectTotal=i}else e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)}).finally()},offsetEntryInit:function(){var e=this;this.singleProjectId,this.$sacpApis.queryOffsetList({customerId:this.curCustomerId,projectId:this.curProjectId,year:"",offsetType:1,value:null,mergeProject:null}).then(function(t){e.auditAjustmnetData=t.data}).catch(function(t){return e.$message.error(t)})},handleCurstomerId:function(){var e=JSON.parse(sessionStorage.getItem("curCustomerData"));this.curCustomerId=e.curCustomerId,this.curProjectId=e.curProjectId,this.curAccYear=e.curYear,this.intoPageHandleData()},showComponent:function(e){this.currentTabComponent=this.mergeScopeTabs.filter(function(t){return t.name===e})[0].routeName},intoPageHandleData:function(){var e=this;this.$route.query.tab?(this.showComponent(this.$route.query.tab),"1"==this.activeName?this.activeName=this.$route.query.tab:this.$router.push({name:"MergeScope",tab:this.$route.query.tab})):this.activeName=this.activeName,this.isInit=!1;var t=this.mergeScopeTabs.filter(function(t){return t.name===e.activeName})[0].label;this.handleClick({name:this.activeName,label:t})},dialogState:function(e){this.adjustDebTableInit(),this.adjustDebDialog=e}},activated:function(){var e=this,t=this.mergeScopeTabs.filter(function(t){return t.routeName===e.currentTabComponent&&!0===t.isMark})[0],a=t&&t.indexId?t.indexId:"";this.$eventBus.$emit("click-tab",t),this.mergeScopeTabs.map(function(t){return t.isMark=t.routeName!==e.currentTabComponent&&t.isMark}),this.mergeScopeTabs.every(function(e){return 0==e.isMark})&&this.$store.commit("setRemoveBagdeScope","MergeScope"),this.removeClickedMenuId(this.getRefreshPagesId,a)},created:function(){this.handleCurstomerId(),this.selList=this.$DIC("借贷")}}),N={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"mergeScope"},[r("div",{class:{fullScreen:e.fullScreen?"fullScreen":"",fullScreenBox:!0}},[r("el-tooltip",{attrs:{effect:"dark",content:e.fullScreen?"取消全屏":"全屏",placement:"top-start"}},[r("el-button",{class:{fullScreenBtn:!0},attrs:{type:"primary",circle:"",size:"small"},on:{click:e.fullScreenChange}},[e.fullScreen?e._e():r("img",{attrs:{src:a("/Dxn"),alt:""}}),e._v(" "),e.fullScreen?r("img",{attrs:{src:a("W+0t"),alt:""}}):e._e()])],1),e._v(" "),r("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(e.mergeScopeTabs,function(t){return r("el-tab-pane",{key:t.index,attrs:{label:t.label,name:t.name}},[r("span",{attrs:{slot:"label",id:"extendEl"},slot:"label"},[t.isMark?r("el-badge",{staticClass:"item",attrs:{"is-dot":""}}):e._e(),e._v("\n                    "+e._s(t.label)+"\n                ")],1)])}),1),e._v(" "),r("keep-alive",{attrs:{exclude:e.blackList}},["mergeScopeIn"===e.currentTabComponent?r("mergeScopeIn",{ref:"mergeScopeIn",on:{dialogState:e.dialogState}}):e._e(),e._v(" "),"mergeScopeOut"===e.currentTabComponent?r("mergeScopeOut",{ref:"mergeScopeOut"}):e._e(),e._v(" "),"unimportRelate"===e.currentTabComponent?r("unimportRelate",{ref:"unimportRelate"}):e._e(),e._v(" "),"aduitAjustment"===e.currentTabComponent?r("aduitAjustment",{ref:"aduitAjustment",attrs:{auditAjustmnetData:e.auditAjustmnetData}}):e._e()],1),e._v(" "),r("el-dialog",{attrs:{title:"设置TB借贷方向(*绿色:母公司单体带入,紫色:默认规则带入)",visible:e.adjustDebDialog,"destroy-on-close":!0,"before-close":e.closeAdjustDebDialog},on:{"update:visible":function(t){e.adjustDebDialog=t}}},[r("vxe-table",{ref:"adjuctXTable",attrs:{border:"",resizable:"","row-key":"","show-overflow":"","highlight-hover-row":"",height:"500",data:e.adjustTableData,"edit-config":{trigger:"click",mode:"row"},"row-class-name":e.rowClassName,"filter-config":{iconNone:"vxe-icon--funnel",iconMatch:"vxe-icon--funnel"}}},[r("vxe-table-column",{attrs:{field:"tbSubjectId",title:"TB科目编号"}}),e._v(" "),r("vxe-table-column",{attrs:{field:"tbSubjectName",title:"TB科目名称"}}),e._v(" "),r("vxe-table-column",{attrs:{field:"showDebLabel",title:"借贷方向(下拉选)",filters:[{label:"借",value:"1"},{label:"贷",value:"-1"},{label:"无",value:null}],"filter-method":e.filterAgeMethod},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return t.rowIndex,[r("el-select",{attrs:{clearable:"",filterable:""},on:{change:function(t){return e.roleChangeEvent(a)}},nativeOn:{click:function(t){return e.saveOldRow(a)}},model:{value:a.showDebLabel,callback:function(t){e.$set(a,"showDebLabel",t)},expression:"row.showDebLabel"}},e._l(e.selList,function(e){return r("el-option",{key:e.value,attrs:{value:e.label,label:e.label}})}),1)]}}])})],1)],1)],1)])},staticRenderFns:[]};var R=a("VU/8")(L,N,!1,function(e){a("5kUB")},"data-v-74ad1def",null);t.default=R.exports},yoIW:function(e,t){}});