var vueCompMap={},timeo;function createForm(e){var t,a;return vueCompMap[e.id+"Comp"]=Vue.extend(new FormComp(e)),vueCompMap[e.id+"Form"]&&vueCompMap[e.id+"Form"].$destroy(),a=$.extend(!0,{},e.options),(t=new(0,vueCompMap[e.id+"Comp"])(a)).$mount("#"+e.id),vueCompMap[e.id+"Form"]=t,t}function downloadFile(e,t){let a=$("<form>");a.attr("style","display:none"),a.attr("target","body"),a.attr("method","post"),a.attr("action",e),$.each(t,function(e,t){let r=$("<input>");r.attr("type","hidden"),r.attr("name",e),$.isPlainObject(t)?r.attr("value",JSON.stringify(t)):r.attr("value",t),a.append(r)}),$("body").append(a),a.submit(),a.remove()}function tplLoader(e,t){if(window.tplMap[e])return t&&t(window.tplMap[e]),window.tplMap[e];var a='<div style="height: 100%;width: 100%;"></div>';return $.ajax({url:e,type:"GET",dataType:"text",async:!1,success:function(e){a=e,t&&t(a)}}),window.tplMap[e]=a,a}function getIndustryData(){let e;return $.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",data:{menuId:window.sys_menuId,sqlId:"DG00002"},dataType:"json",async:!1,success:function(t){e=t.data}}),e}window.tplMap=window.tplMap?window.tplMap:{};var ev=function(e){let t=$(document),a=e.data.eventEl;"false"!==a.$dropWrap.attr("data-bdo-drop-state")||timeo?timeo&&(clearTimeout(timeo),timeo=void 0):timeo=setTimeout(()=>{clearTimeout(timeo),a.$dropWrap.hide(),t.undelegate(".bdo-drop-menu-model","click",ev),t.undelegate(".bdo-drop-menu-model","mousewheel",ev),t.undelegate(".bdo-drop-menu-model","mousemove",ev),$(".bdo-drop-menu-model").removeClass("bdo-drop-menu-model"),timeo=void 0},1500)};function bdoDropdoIt(e){let t=$(document),a=e.data.eventData;a.$dropWrap.empty().append(a.$dropMenu);let r=$(e.currentTarget),l=a.$dropMenu.find(".bdo-drop-ul"),s={};l.empty(),$.each(a.options.buttons,(e,t)=>{let a='<li class="list-group-item"><a href="#"  id="'+t.id+'" data-bdo-dropmenu="'+t.id+'"><i class="'+t.icon+'"></i> '+t.text+"</a></li>";l.append(a),s[t.id]=t.handler}),l.on("click","li a[data-bdo-dropmenu]",{eventEl:a},e=>{let t=$(e.currentTarget);s[t.attr("id")]&&s[t.attr("id")].apply(a.options.scope,[r,e]),a.$dropWrap.hide(),a.$dropWrap.empty(),a.$dropWrap.attr("data-bdo-drop-state"),ev(e)});let o=!0;a.$dropWrap.attr("data-bdo-drop-state",!1),a.$dropWrap.on("focusout",e=>{o||a.$dropWrap.hide()}),a.$dropWrap.on("blur",e=>{o||a.$dropWrap.hide()}),a.$dropWrap.on("mouseleave",e=>{o=!1,a.$dropWrap.attr("data-bdo-drop-state",!1)}),a.$dropWrap.on("mouseenter",e=>{o=!0,a.$dropWrap.attr("data-bdo-drop-state",!0)});let n=r.offset(),i=n.top,d=n.left,c=r.height(),u=r.width(),m=a.$dropMenu.width();a.$dropWrap.css({top:i+c+2+"px",left:d-m/2+u/2+"px","z-index":1e4}),a.options.beforeShow&&a.options.beforeShow(r,a.$dropMenu),a.$dropWrap.show(),a.$dropWrap.focus(),a.options.afterShow&&a.options.afterShow(r,a.$dropMenu),$("body").addClass("bdo-drop-menu-model"),t.undelegate(".bdo-drop-menu-model","click",ev),t.undelegate(".bdo-drop-menu-model","mousewheel",ev),t.undelegate(".bdo-drop-menu-model","mousemove",ev),t.delegate(".bdo-drop-menu-model","click",{eventEl:a},ev),t.delegate(".bdo-drop-menu-model","mousewheel",{eventEl:a},ev),t.delegate(".bdo-drop-menu-model","mousemove",{eventEl:a},ev)}function bdoDropMenu(e){let t=e,a='<div class="bdo-drop" tabindex="-200"></div>',r='<div class="bdo-drop-menu text-left">\t<ul class="bdo-drop-ul list-group">\t</ul></div>',l=$(a),s=$(r),o=$("body");$("body .bdo-drop").length>0&&$("body .bdo-drop").remove(),$("body").append(l);let n={$dropWrap:l,$dropMenu:s,$body:o,dropMenuTpl:a,template:r,options:t};o.off("click",e.el),o.on("click",e.el,{eventData:n},bdoDropdoIt)}function getSubjecttree(e,t){$.ajax({url:"dgCenter/DgMain.getSubjecttree.json",type:"post",data:e,dataType:"json",bdolxLoader:!1,success(e){e.success?$.sessionStorage("subjecttree",JSON.stringify(e.data[0].treeData)):bdoErrorBox("失败",e.resultInfo.statusText),e.data&&t&&t(e)}})}function searchSubjecttreeNode(e,t){let a;return function(e,t){if(a)return a;if(t(e))return a=e;if(e.nodes)for(let a=0;a<e.nodes.length;a++)arguments.callee(e.nodes[a],t);return a}(e,t)}function unAuditProjectInfo(){if(!(window.CUR_PROJECTID&&window.CUR_CUSTOMERID&&window.CUR_CUSTOMERID>""&&window.CUR_PROJECTID>""))return $.sessionStorage("projectManager",0),void $.sessionStorage("mergeType",0);$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",data:{menuId:window.sys_menuId,sqlId:"DG00061",param1:window.CUR_PROJECTID,param2:window.CUR_CUSTOMERID},dataType:"json",success(e){e.success&&(null!=e&&void 0!=e&&null!=e.data[0]&&void 0!=e.data[0]?($.sessionStorage("projectManager",null==e.data[0].manager||void 0==e.data[0].manager?"0":e.data[0].manager),$.sessionStorage("mergeType",e.data[0].mergeType)):($.sessionStorage("projectManager",0),$.sessionStorage("mergeType",0)))}})}function initPostilContentsEditor(e,t){let a=e,r=$("#postilContent",$(t.region)),l={toolbar:[["style",["bold","italic","underline","clear"]],["font",["strikethrough","superscript","subscript"]],["fontsize",["fontsize"]],["color",["color"]],["para",["ul","ol","paragraph"]],["height",["height"]],["view",["fullscreen"]]],codeviewFilter:!1,codeviewIframeFilter:!0,codeviewIframeWhitelistSrc:["localhost","127.0.0.1","sacpdemo.bdo.com.cn","sacp.bdo.com.cn","sacpuat.bdo.com.cn"],callbacks:{onPaste:function(e){},onChange:$.proxy(function(e,t){this.postilContent=e},a),onFocusin:$.proxy(function(e){e.preventDefault(),e.stopPropagation(),r.trigger("focusin")},a),onFocusout:$.proxy(function(e){e.preventDefault(),e.stopPropagation(),r.trigger("focusout")},a),onKeyup:$.proxy(function(e){this.postilContent=r.summernote("code")},a),onKeydown:$.proxy(function(e,t){this.postilContent=r.summernote("code")},a),onInit:$.proxy(function(e,t){r.summernote("lineHeight",1.2)},a)}};$("#postilContent",$(t.region)).off("summernote"),a.$postilContentEl=$("#postilContent",$(t.region)).summernote(l),$(t.region).on("click",".postil-content-html img",function(e){let t=$(e.currentTarget).attr("src"),a=getQueryString(t,"img");window.open(t,"_blank,name="+a)}),$(t.region).on("mouseenter ",".postil-content-html img",function(e){let t=$(e.currentTarget).attr("src");if($('[data-img-id="'+t+'"]').length>0)return;let a=$('<span class="postil-content-img-hover-tip" data-img-id="'+t+'">点击打开图片</span>');a.css({top:e.pageY+"px",left:e.pageX+"px"}),a.appendTo($(document.body))}),$(t.region).on("mouseleave  ",".postil-content-html img",function(e){let t=$(e.currentTarget).attr("src");$('[data-img-id="'+t+'"]').length>0&&$('[data-img-id="'+t+'"]').remove()})}function getQueryString(e,t){var a=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),r=e.substr(1).match(a);return null!=r?decodeURIComponent(r[2]):null}function updateUsedRange(e){try{for(var t in e.sheets){var a=e.sheets[t],r=a&&a.data&&a.data.dataTable,l=0,s=0;if(r){var o=Object.keys(r).length;for(var n in o>0&&(l=parseInt(Object.keys(r)[o-1])),r){var i=r[n],d=Object.keys(i).length;if(d>0){var c=parseInt(Object.keys(i)[d-1]);s<c&&(s=c)}}}l>0&&a&&a.rowCount&&(a.rowCount=l+5),s>0&&a&&a.columnCount&&(a.columnCount=s+5)}}catch(e){}return e}unAuditProjectInfo();var DG_CONST_UNAUDITREPORT_BEGINNING="R001",DG_CONST_UNAUDITREPORT_ENDING="R002",PostilPage=e=>{let t,a,r,l,s,o;o=(()=>{let e={localParam:{url:"dgCenter/DgGeneral.query.json",urlparam:{menuId:window.sys_menuId,sqlId:"DG00082",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param4:designer.workpaperId,param5:"dg",start:-1,limit:-1},tabNum:!0},tableParam:{pageLength:30,scrollX:!0,scrollY:"370px",select:!0,ordering:!1,order:[1,"asc"],serverSide:!0,fixedThead:!0,fixedHeight:"460px",columnDefs:[{targets:1,orderable:!0,title:"标签名",name:"tagName",data:"tagName",width:"100px"},{targets:2,orderable:!0,title:"标签位置",name:"tagPosition",data:"tagPosition",width:"100px",render:function(e,t,a,r){return'<a href="#">'+e.substring(e.indexOf(":")+1)+"</a>"}},{targets:3,orderable:!0,className:"text-right",title:"标签值",name:"tagValue",data:"tagValue",width:"80px",render:function(e,t,a,r){return formatMoney(e)}},{targets:4,orderable:!0,title:"操作",className:"text-center",name:"operate",data:"tagName",width:"40px",render:function(e,t,a,r){return'<button class="btn btn-xs btn-default" type="button" title="删除标签"><i class="fa fa-close"></i><input type="text" value="'+e+'" style="display: none;"></button>'}}]}};BdoDataTable("cellTagTable",e),$("#postilTitle a").click(function(e){e.preventDefault(),jQuery(this).tab("show")}),$("#postilTitle a").on("show.bs.tab",function(e){var t=e.target.href,a=t.lastIndexOf("#");switch(t.substring(a+1)){case"cellLinkTab":!function e(){var t=[];for(let e of designer.ShowSingleLinkCacheMap){let a=parseInt(e[0].substring(0,e[0].indexOf(":"))),r=parseInt(e[0].substring(e[0].indexOf(":")+1,e[0].lastIndexOf(":"))),l=parseInt(e[0].substring(e[0].lastIndexOf(":")+1)),s=new GC.Spread.Sheets.Range(r,l,1,1),o=GC.Spread.Sheets.CalcEngine.rangeToFormula(s,0,0,GC.Spread.Sheets.CalcEngine.RangeReferenceRelative.allAbsolute,!1).toString().replace(/\$/g,""),n=designer.Spread.getSheet(a).name();for(let a of e[1]){let e,r;a.isFile?(r=a.fileName,e=a.isPaper?a.paperLink.substring(a.paperLink.indexOf(":")+1):a.attachmentLink.substring(a.attachmentLink.indexOf(":")+1)):(r=a.displayText,e=a.sheetName+a.link.substring(a.link.indexOf(":"))),t.push(["",n+":"+o,e,r])}}$("#cellLinkTable").dataTable({data:t,pageLength:30,ordering:!1,scrollX:!0,scrollY:"350px",columns:[{title:"序号",class:"text-center",width:"40px",render:function(e,t,a,r){return r.settings._iDisplayStart+r.row+1}},{title:"位置",width:"180px",render:function(e,t,a,r){return'<a href="#">'+e+"</a>"}},{title:"链接",width:"180px"},{title:"提示内容",width:"180px"}]}),$("#cellLinkTable td a").on("click",function(){var e=this.text.substring(0,this.text.indexOf(":")),t=designer.Spread.getSheetIndex(e);designer.Spread.setActiveSheetIndex(parseInt(t));var a=designer.Spread.getActiveSheet(),r=GC.Spread.Sheets.CalcEngine.formulaToRange(a,this.text.substring(this.text.indexOf(":")+1),0,0);a.setActiveCell(r.row,r.col);var l=GC.Spread.Sheets.VerticalPosition.top;a.showRow(r.row,l)}),$("#cellLinkTable_wrapper .tableRefresh").click(t=>{e()})}();break;case"cellTagTab":$("#cellTagTable").DataTable().ajax.reload(),$("#cellTagTable tbody").on("click","td button",function(){var e=this.lastElementChild.value;$.ajax({type:"post",url:"dgCenter/DgCheck.deleteTag.json",data:{menuId:window.sys_menuId,param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:e,start:-1,limit:-1},dataType:"json",success(e){e.success&&($("#cellTagTable").DataTable().ajax.reload(),bdoSuccessBox("成功","删除标签成功！"))}})}),$("#cellTagTable tbody").on("click","td a",function(){var e=this.text.substring(0,this.text.indexOf(":")),t=designer.Spread.getSheetIndex(e);designer.Spread.setActiveSheetIndex(parseInt(t));var a=designer.Spread.getActiveSheet(),r=GC.Spread.Sheets.CalcEngine.formulaToRange(a,this.text.substring(this.text.indexOf(":")+1),0,0);a.setActiveCell(r.row,r.col);var l=GC.Spread.Sheets.VerticalPosition.top;a.showRow(r.row,l)})}}),$('#postilTab [data-toggle="tabs"] a').on("show.bs.tab",function(e){var t=e.target.href,a=t.lastIndexOf("#"),r=t.substring(a+1);switch(s.newPostilBtnShow=!1,s.onPostilClose(),r){case"postilTab1":(16&s.userAuditState)>>4==1&&(s.newPostilBtnShow=!0),s.auditState=400;break;case"postilTab2":(2&s.userAuditState)>>1==1&&(s.newPostilBtnShow=!0),s.auditState=100;break;case"postilTab3":(4&s.userAuditState)>>2==1&&(s.newPostilBtnShow=!0),s.auditState=200;break;case"postilTab4":(32&s.userAuditState)>>5==1&&(s.newPostilBtnShow=!0),s.auditState=500;break;case"postilTab5":(64&s.userAuditState)>>6==1&&(s.newPostilBtnShow=!0),s.auditState=600;break;case"postilTab6":(8&s.userAuditState)>>3==1&&(s.newPostilBtnShow=!0),s.auditState=300;break;case"postilTab7":(128&s.userAuditState)>>7==1&&(s.newPostilBtnShow=!0),s.auditState=700}})}),s=new Vue({el:"#vmpostilPage",data:{postils1:[],postils2:[],postils3:[],postils4:[],postils5:[],postils6:[],postils7:[],postils:[],newContent:!1,postilContent:"",cellContent:"",type:"",auditState:0,threadParam:{},customerId:e.customerId,projectId:e.projectId,isSingle:!1,userAuditState:0,newPostilBtnShow:!1,postilLevel:2},watch:{newContent(e,t){1==e?$(".postil-content").css({bottom:"190px"}):$(".postil-content").css({bottom:"0px"}),this.type==r?($("#postilFormBlock").find("table").find("td:eq(2)").show(),$("#postilFormBlock").find("table").find("td:eq(3)").show()):($("#postilFormBlock").find("table").find("td:eq(2)").hide(),$("#postilFormBlock").find("table").find("td:eq(3)").hide())},auditState(t,a){let s=this;this.getPostils();this.fetch({menuId:window.sys_menuId,sqlId:"DG00077",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:(()=>e.isSingle?e.data.autoId:null)(),param4:t,param5:l,param6:r,start:-1,limit:-1},e=>{e.success&&s.buildData(e.data)})},postilContent(e,t){if(this.$postilContentEl){e!=this.$postilContentEl.summernote("code")&&this.$postilContentEl.summernote("code",e)}}},methods:{fetchProjectInfo(){let e=$.Deferred();return CUR_PROJECTID&&CUR_CUSTOMERID&&CUR_CUSTOMERID>""&&CUR_PROJECTID>""?($.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",data:{menuId:window.sys_menuId,sqlId:"DG00061",param1:window.CUR_PROJECTID,param2:window.CUR_CUSTOMERID},dataType:"json",success(t){t.success&&e.resolve(t)}}),e):(e.resolve({}),e)},getPostils(){switch(this.auditState){case 100:return this.postils2;case 200:return this.postils3;case 300:return this.postils6;case 400:return this.postils1;case 500:return this.postils4;case 600:return this.postils5;case 700:return this.postils7}},buildData(t){let a=[],l={};if($.each(t,(e,t)=>{if(t.type==r)l[t.autoId]=t,a.push(l[t.autoId]);else{let e=l[t.annotationId];e&&!e.comments&&(e.comments=[]),e&&e.comments.push(t)}}),e.isSingle)this.postils=a;else switch(this.auditState){case 100:return void(this.postils2=a);case 200:return void(this.postils3=a);case 300:return void(this.postils6=a);case 400:return void(this.postils1=a);case 500:return void(this.postils4=a);case 600:return void(this.postils5=a);case 700:return void(this.postils7=a)}},submitPostil(e,t){$.ajax({type:"post",url:"dgCenter/DgPostil.savePostil.json",data:e,dataType:"json",success(e){t&&t(e)}})},fetch(t,a){e.isSingle&&(t.param4=void 0),$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",data:t,dataType:"json",success(e){a&&a(e)}})},onSubmitPostil(e){var t=this,s=this.getPostils();let o=$("<div>"+this.postilContent+"</div>").text();if(this.type==r){if(this.postilContent&&""!=this.postilContent){let e={param1:t.type,jsonData:JSON.stringify({customerId:t.customerId,projectId:t.projectId,content:$.base64.encode(encodeURIComponent(t.postilContent)),contentText:o,cellContent:t.cellContent,type:r,auditState:t.auditState,foreignId:l,postilLevel:t.postilLevel})};this.submitPostil(e,e=>{if(e.success){let a=e.data[0].data;t.fetch({menuId:window.sys_menuId,sqlId:"DG00077",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:a.autoId,param4:t.auditState,param5:l,param6:r},e=>{e.success&&s.push(e.data[0])}),t.onPostilClose()}else a.autoHide=!1,bdoErrorBox("失败",e.resultInfo.statusText)})}}else if("C001"==this.type){let e=this.threadParam.postilActionAgrs[1];if(this.postilContent&&""!=this.postilContent){let s={param1:t.type,jsonData:JSON.stringify({customerId:window.CUR_CUSTOMERID,projectId:window.CUR_PROJECTID,content:$.base64.encode(encodeURIComponent(t.postilContent)),contentText:o,cellContent:t.cellContent,type:t.type,annotationId:e.autoId,commentedUser:e.__ucreateUser.userId})};this.submitPostil(s,s=>{if(s.success){let a=s.data[0].data;t.fetch({menuId:window.sys_menuId,sqlId:"DG00152",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:a.annotationId,param4:t.auditState,param5:l,param6:r,param7:a.autoId},t=>{t.success&&(e.comments||(e.comments=[]),e.comments.push(t.data[0]))}),t.onPostilClose()}else a.autoHide=!1,bdoErrorBox("失败",s.resultInfo.statusText)})}}else if("C002"==this.type){let e=this.threadParam.postilActionAgrs[1],s=this.threadParam.postilActionAgrs[2];if(this.postilContent&&""!=this.postilContent){let n={param1:t.type,jsonData:JSON.stringify({customerId:window.CUR_CUSTOMERID,projectId:window.CUR_PROJECTID,content:$.base64.encode(encodeURIComponent(t.postilContent)),contentText:o,cellContent:t.cellContent,type:t.type,annotationId:s.annotationId,commentedUser:s.__ucreateUser.userId,commentId:s.autoId})};this.submitPostil(n,s=>{if(s.success){let a=s.data[0].data;t.fetch({menuId:window.sys_menuId,sqlId:"DG00152",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:a.annotationId,param4:t.auditState,param5:l,param6:r,param7:a.autoId},t=>{t.success&&e.comments.push(t.data[0])}),t.onPostilClose()}else a.autoHide=!1,bdoErrorBox("失败",s.resultInfo.statusText)})}}},onNewPostilBtnClick(e){this.newContent=!0,this.postilContent="",this.cellContent="",this.type=r,this.postilLevel=2},getCellRange(e){var t=designer.Spread.getActiveSheet().name(),a=designer.Spread.getActiveSheet().getActiveRowIndex();if(isNaN(a))bdoErrorBox("失败","未选择单元格！");else{var r=designer.Spread.getActiveSheet().getActiveColumnIndex(),l=new GC.Spread.Sheets.Range(a,r,1,1),s=GC.Spread.Sheets.CalcEngine.rangeToFormula(l,0,0,GC.Spread.Sheets.CalcEngine.RangeReferenceRelative.allAbsolute,!1).toString().replace(/\$/g,"");this.cellContent=t+":"+s,$("#cellContent").attr("title",this.cellContent)}},setActiveCell(e){var t=e.toElement.text,a=t.substring(0,t.indexOf(":")),r=designer.Spread.getSheetIndex(a);designer.Spread.setActiveSheetIndex(r);var l=designer.Spread.getActiveSheet(),s=GC.Spread.Sheets.CalcEngine.formulaToRange(l,t.substring(t.indexOf(":")+1),0,0);l.setActiveCell(s.row,s.col);var o=GC.Spread.Sheets.VerticalPosition.top;l.showRow(s.row,o);var n=$(e.currentTarget).parent().parent().prev().children(":first").text(),i=$(e.currentTarget).parent().parent().next().text();l.comments.add(s.row,s.col,n+":"+i),l.comments.get(s.row,s.col).displayMode(GC.Spread.Sheets.Comments.DisplayMode.alwaysShown)},onPostilClose(e){this.newContent=!1,this.type="",this.postilContent="",this.cellContent="",this.postilLevel=2},closePostil(){var e=this.threadParam.postilActionAgrs[1];bdoConfirmBox("提示","确定要关闭这条批注吗？",t=>{$.ajax({type:"post",url:"dgCenter/DgPostil.closePostil.json",data:{param1:e.autoId,param2:e.customerId},dataType:"json",success(t){if(t.success){e.activeFlag=0,bdoSuccessBox("成功",t.resultInfo.statusText);var a=designer.Spread.getSheetIndex(0,e.cellContent.indexOf(":"));designer.Spread.setActiveSheetIndex(a);var r=e.cellContent.substring(e.cellContent.indexOf(":")+1),l=designer.Spread.getActiveSheet(),s=GC.Spread.Sheets.CalcEngine.formulaToRange(l,r,0,0);l.comments.remove(s.row,s.col)}else bdoErrorBox("失败",t.resultInfo.statusText)}})})},openPostil(){var e=this.threadParam.postilActionAgrs[1];bdoConfirmBox("提示","确定要重新开启这条批注吗？",t=>{$.ajax({type:"post",url:"dgCenter/DgPostil.openPostil.json",data:{param1:e.autoId,param2:e.customerId},dataType:"json",success(t){t.success?(e.activeFlag=1,bdoSuccessBox("成功",t.resultInfo.statusText)):bdoErrorBox("失败",t.resultInfo.statusText)}})})},deletePostil(){let e=this.threadParam.postilActionAgrs[1],t=this,a=t.postils.indexOf(e);bdoConfirmBox("提示","确定要删除这条批注吗？",r=>{$.ajax({type:"post",url:"dgCenter/DgPostil.deletePostil.json",data:{param1:e.autoId,param2:window.CUR_CUSTOMERID,param3:window.CUR_PROJECTID},dataType:"json",success(r){if(r.success){t.postils.splice(a,1);t.threadParam.postilActionAgrs.indexOf(e);t.threadParam.postilActionAgrs.splice(a,1),$("#"+e.autoId).remove(),bdoSuccessBox("成功",r.resultInfo.statusText);var l=designer.Spread.getSheetIndex(0,e.cellContent.indexOf(":"));designer.Spread.setActiveSheetIndex(l);var s=e.cellContent.substring(e.cellContent.indexOf(":")+1),o=designer.Spread.getActiveSheet(),n=GC.Spread.Sheets.CalcEngine.formulaToRange(o,s,0,0);o.comments.remove(n.row,n.col)}else bdoErrorBox("失败",r.resultInfo.statusText)}})})},postilAction(e,t){let a=t[0];switch(this.threadParam.postilActionAgrs=t,a){case"C001":case"C002":this.type=a,this.newContent=!0,this.postilContent="",this.cellContent="";break;case"005":this.closePostil();break;case"006":this.openPostil();break;case"007":this.deletePostil()}}},mounted(){let t=this;a=side({el:"#postilPage",autoHide:!1}),this.auditState=400,this.fetchProjectInfo().done(function(e){if(e.success&&e.data&&e.data[0]){let a=e.data[0],r=0;a.manager==sys_userId&&(r+=1),a.signAccountant2!=sys_userId&&a.signAccountant3!=sys_userId||(r+=16),a.audit1==sys_userId&&(r+=2),a.audit2==sys_userId&&(r+=4),a.reaReviewer==sys_userId&&(r+=32),a.signUser==sys_userId&&(r+=64),a.reviewPartner==sys_userId&&(r+=8),a.issuedPeople==sys_userId&&(r+=128),t.userAuditState=r}(16&t.userAuditState)>>4==1&&(t.newPostilBtnShow=!0)}),o(),OneUI.initHelper("slimscroll"),a.show(),initPostilContentsEditor(this,e)},beforeCreate(){t=e.isSingle?e.template||tplLoader("dgCenter/html/dg/pageSinglePostil.html"):e.template||tplLoader("dgCenter/html/dg/postil.html"),e.template=t,r=e.type,l=e.foreignId,$(e.region).empty().append(t)}})},DgAttachPage=e=>{var t,a,r,l,s,o,n,i;t=e.template||tplLoader("dgCenter/html/dg/dgAttach.html"),e.template=t,a=e.data,$("#dgtitle").empty().text(e.data.nodeName),n=(()=>{$("#uploadDgAttachBtn").click(e=>{o.jsonData.subjecttreeId=a.extraOptions.autoId,o.jsonData.autoId=a.programInfo.autoId,o.jsonData.projectId=a.programInfo.projectId,o.jsonData.customerId=a.programInfo.customerId,o.jsonData.workpaperId=a.programInfo.workpaperId,o.jsonData.subjectId=a.programInfo.subjectId,o.jsonData.subjectName=a.programInfo.subjectName,o.jsonData.indexId=a.programInfo.indexId,o.jsonData.dgAttachAutoId=null,o.uploadMode="STD",$("#uploadAttachFormModal").modal("show")}),$("#refreshDgAttachTableBtn").click(e=>{$("#dgAttachTable").DataTable().ajax.reload()}),$("#dgAttachTable").on("click",'button.table-btn-operate[name="reUploadFile"]',e=>{let t=$("#dgAttachTable").dataTable().fnGetData($(e.currentTarget).attr("data-row"));o.jsonData.subjecttreeId=a.extraOptions.autoId,o.jsonData.autoId=a.programInfo.autoId,o.jsonData.projectId=a.programInfo.projectId,o.jsonData.customerId=a.programInfo.customerId,o.jsonData.workpaperId=a.programInfo.workpaperId,o.jsonData.subjectId=a.programInfo.subjectId,o.jsonData.subjectName=a.programInfo.subjectName,o.jsonData.indexId=a.programInfo.indexId,o.jsonData.dgAttachAutoId=t.autoId,o.uploadMode="RE",$("#uploadAttachFormModal").modal("show")}),$("#dgAttachTable").on("click",'button.table-btn-operate[name="downloadDgAttach"]',e=>{a.parent.dgAttachSider.autoHide=!1;var t=$("#dgAttachTable").dataTable().fnGetData($(e.currentTarget).attr("data-row"));downloadFile("dgCenter/DgDownload.downloadAttach.json",{param1:t.autoId,param2:t.customerId}),a.parent.dgAttachSider.autoHide=!0}),$("#dgAttachTable").on("click",'button.table-btn-operate[name="onlinepreview"]',e=>{a.parent.dgAttachSider.autoHide=!1;var t=$("#dgAttachTable").dataTable().fnGetData($(e.currentTarget).attr("data-row"));$.ajax({url:"dgCenter/DgMain.queryAttachFileExistence.json",type:"post",data:{param1:t.autoId,param2:t.customerId},dataType:"json",success:function(e){if(e.success){var r=t.fileName.substring(t.fileName.lastIndexOf(".")+1).toLowerCase();if("pdf"===r||"jpg"===r||"png"===r||"jpeg"===r)window.open("dgCenter/DgPaper.previewFile.json?param1="+t.autoId+"&param2=type1&param3="+t.fileName,t.fileName,"location=no");else if("xlsx"===r){t.pageType=1;var l={extraOptions:t,currentNode:{extraOptions:t}};$.sessionStorage("fileNode",JSON.stringify(l)),window.open("/Faith/dgcenter.do?m=previewFile")}}else bdoErrorBox("失败",e.resultInfo.statusText);a.parent.dgAttachSider.autoHide=!0}})}),$("#dgAttachTable").on("click",'button.table-btn-operate[name="delDgAttach"]',e=>{a.parent.dgAttachSider.autoHide=!1;var t=$("#dgAttachTable").dataTable().fnGetData($(e.currentTarget).attr("data-row"));bdoConfirmBox("提示","确认删除底稿附件【"+t.fileName+"】?",function(){a.parent.dgAttachSider.autoHide=!1,$.ajax({url:"dgCenter/DgMain.deleteAttach.json",type:"post",data:{param1:t.autoId,param2:t.customerId,param3:t.auditprogramId},dataType:"json",success:function(e){e.success?($("#dgAttachTable").DataTable().ajax.reload(),a.parent.dgAttachSider.show(),bdoSuccessBox("成功",e.resultInfo.statusText)):(bdoErrorBox("失败",e.resultInfo.statusText),a.parent.dgAttachSider.show()),a.parent.dgAttachSider.autoHide=!0}})})}),$("#uploadAttachFormModal").on("show.bs.modal",e=>{a.parent.dgAttachSider.autoHide=!1}),$("#uploadAttachFormModal").on("hidden.bs.modal",e=>{a.parent.dgAttachSider.autoHide=!0})}),r=(()=>{$(e.region).empty().append(t),o=createForm(s),BdoDataTable("dgAttachTable",i),n()}),i={localParam:{url:"dgCenter/DgGeneral.query.json",urlparam:{menuId:window.sys_menuId,sqlId:"DG00012",param1:a.programInfo.autoId,param2:a.programInfo.customerId},tabNum:!0},tableParam:{scrollX:!0,scrollY:"250px",scrollCollapse:!0,pageLength:30,select:!0,serverSide:!0,fixedThead:!0,fixedHeight:"480px",columnDefs:[{targets:(()=>(l=0,++l))(),orderable:!1,className:"text-center",title:"处理",data:null,width:"100px",render:function(e,t,a,r){var l=e.suffix.toLowerCase(),s="";return s+='<button class="btn btn-xs table-btn-operate btn-primary" type="button" name="downloadDgAttach" data-placement="top" title="下载" data-toggle="tooltip" data-row="'+r.row+'">\t<i class="fa fa-download"></i></button>',"pdf"!=l&&"jpg"!=l&&"png"!=l&&"jpeg"!=l&&"xlsx"!=l||(s+='<button class="btn btn-xs table-btn-operate btn-primary" type="button" name="onlinepreview" data-placement="top" title="在线预览" data-toggle="tooltip" data-row="'+r.row+'">\t<i class="fa fa-eye"></i></button>'),s+='<button class="btn btn-xs table-btn-operate btn-danger" type="button" name="delDgAttach" data-placement="top" title="删除" data-toggle="tooltip" data-row="'+r.row+'">\t<i class="fa fa-times-circle-o"></i></button>'}},{targets:++l,orderable:!0,title:"索引号",name:"fileIndexId",data:"fileIndexId",width:"100px"},{targets:++l,orderable:!0,title:"底稿名称",name:"dgName",data:"dgName",width:"150px"},{targets:++l,orderable:!0,title:"文件名称",name:"fileName",data:"fileName",width:"150px"},{targets:++l,orderable:!0,className:"text-center",title:"是否被关联",name:"referredFlg",data:"referredFlg",width:"80px",render:function(e,t,a,r){return 1==e?"是":"否"}},{targets:++l,orderable:!0,title:"上传时间",name:"uploadDate",data:"uploadDate",width:"150px",render:function(e,t,a,r){return function(e){var t=e.getFullYear(),a=e.getMonth()+1;a=a<10?"0"+a:a;var r=e.getDate();r=r<10?"0"+r:r;var l=e.getHours();l=l<10?"0"+l:l;var s=e.getMinutes();s=s<10?"0"+s:s;var o=e.getSeconds();return t+"-"+a+"-"+r+" "+l+":"+s+":"+(o=o<10?"0"+o:o)}(new Date(e))}},{targets:++l,orderable:!0,title:"上传人",name:"__uuploadUserName",data:"__uuploadUserName",width:"150px"}]}},s={options:{propsData:{jsonData:{attach:[],autoId:null,projectId:null,customerId:null,workpaperId:null,subjecttreeId:null,subjectId:null,subjectName:null,indexId:null,dgAttachAutoId:null}}},props:{jsonData:Object},display:"tableform-one",column:1,id:"uploadAttachForm",data:()=>({ajaxConfig:{type:"POST",url:"dgCenter/DgDownload.uploadAttach.json",dataType:"json",success:function(e){e.success?(bdoSuccessBox("成功",e.resultInfo.statusText),$("#uploadAttachFormModal").modal("hide"),$("#dgAttachTable").DataTable().ajax.reload()):bdoErrorBox("失败",e.resultInfo.statusText)}},uploadMode:"STD"}),methods:{onUploadAttachFileClick(e){$("#attach").fileinput("getFilesCount")<=0?bdoErrorBox("失败","当前无任何文件！"):this.uploadFile(!0)},resetFileClick(e){$("#attach").fileinput("refresh"),$("#attach").fileinput("clear"),$("#attach").fileinput("reset")}},buttons:[{id:"resetFileBtn",icon:"fa fa-refresh",style:"btn-primary",text:"重置",typeAttr:{"v-on:click":"resetFileClick"}},{id:"uploadAttachFileBtn",icon:"fa fa-upload",style:"btn-primary",text:"上传",typeAttr:{"v-on:click":"onUploadAttachFileClick"}},{id:"cancelUploadAttachFileBtn",icon:"fa-arrow-left",style:"btn-warning",text:"取消",typeAttr:{"data-dismiss":"modal"}}],items:[{id:"attach",type:"file",label:"附件",rowspan:1,colspan:2,validate:{rules:{}},typeAttr:{multiple:!0},show:!0,plugin:{name:"fileinput",options:{allowedFileExtensions:["xls","xlsx","xltx","xlsm","xltm","xlsb","xlam","jpg","png","doc","docx","zip","rar","pdf"],uploadUrl:"dgCenter/DgDownload.uploadTempFile.json",uploadExtraData:function(){return{}}}}}]},r()},modalInitMethod={modal1(e){$("#programParamModal").modal("show"),$("#programParamForm").formview({display:"tableform-one",column:4,buttons:[{id:"dg_generate",icon:"fa-save",style:"btn-primary",text:"&nbsp;生成"},{id:"dg_close",icon:"fa-sign-out",style:"btn-warning",text:"&nbsp;关闭"}],items:[{id:"td_data",type:"",label:"",html:'<div class="form-material input-group"><input class="form-control selectDate" type="text" id="startdate"value=""><span class="input-group-addon">~</span><input class="form-control selectDate" type="text" id="enddate"value=""><label for="startdate">选取标准:起止日期</label></div>'}]});JSON.parse(e.rowData.dgparam);$(".selectDate").datepicker_({autoclose:!0,beforeShowDay:$.noop,calendarWeeks:!1,clearBtn:!1,daysOfWeekDisabled:[],endDate:1/0,forceParse:!0,format:"yyyy-mm-dd",keyboardNavigation:!0,language:"cn",minViewMode:0,orientation:"auto",rtl:!1,startDate:-1/0,startView:0,todayBtn:!1,todayHighlight:!1,weekStart:0}),$.fn.datepicker_.dates.cn={days:["周日","周一","周二","周三","周四","周五","周六","周日"],daysShort:["日","一","二","三","四","五","六","七"],daysMin:["日","一","二","三","四","五","六","七"],months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],monthsShort:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],today:"今天",clear:"清除"};var t=new Date,a=t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate();$("#startdate").datepicker_("setDate",a),$("#enddate").datepicker_("setDate",a),$("#modalHideBtn").click(function(){$("#programParamModal").modal("hide")}),$("#dg_close").click(function(){$("#programParamModal").modal("hide")}),$("#dg_generate").click(function(){var t={};t.startdate=$("#startdate").val(),t.enddate=$("#enddate").val(),e.generateDg(t)})},modal2(e){$("#programParamModal").modal("show"),$("#programParamForm").formview({display:"tableform-one",column:4,buttons:[{id:"tb_generate",icon:"fa-save",style:"btn-primary",text:"&nbsp;生成"},{id:"tb_close",icon:"fa-sign-out",style:"btn-warning",text:"&nbsp;关闭"}],items:[{id:"tb_autoid",type:"input",typeAttr:{type:"hidden"}},{id:"generate_rule",type:"",label:"生成规则",html:'<label class="css-input css-radio css-radio-primary">银行账户来源：<input type="radio" name="mater_use" data-result="1" checked="checked"><span></span></label>科目编号<label class="css-input css-radio css-radio-primary" style="margin-left:30px;"><input type="radio" name="mater_use" data-result="3"><span></span></label>科目下辅助核算'},{id:"accountass_assitemid",type:"input",label:"核算类型",typeAttr:{normal:!0,hidden:!0},validate:{rules:{required:!0}},rowspan:1}]}),$("[for=accountass_assitemid]").hide(),$("#accountass_assitemid").hide();var t=JSON.parse(e.rowData.dgparam);null!=t&&(1==t.accountSource?$("[name='mater_use'][data-result=1]").attr("checked","checked"):3==t.accountSource&&$("[name='mater_use'][data-result=3]").attr("checked","checked")),$("#modalHideBtn").click(function(){$("#programParamModal").modal("hide")}),$("#tb_close").click(function(){$("#programParamModal").modal("hide")}),$("[name='mater_use']").change(function(){"1"==$(this).attr("data-result")||"3"==$(this).attr("data-result")?($("#accountass_assitemid").hide(),$("[for=accountass_assitemid]").hide(),$("#caret_accountass_assitemid").hide()):($("#accountass_assitemid").show(),$("[for=accountass_assitemid]").show(),$("#caret_accountass_assitemid").show())}),$("#tb_generate").click(function(){var t={};t.accountSource=$("[name='mater_use']:checked").attr("data-result"),("2"!=t.accountSource||$("#programParamForm").valid())&&("2"==t.accountSource&&(t.accountingType=$("#accountass_assitemid").attr("data-result")),bdoInProcessingBox("生成中"),e.generateDg(t))}),$("#modal_assitem_sure").click(function(){$("[name='mater_use']:checked").attr("data-result");var e=$("#assitem_z_tree").treeview(!0).getChecked(),t="",a="";for(var r of e)t=t+","+r.label,a=a+","+r.value;$("#accountass_assitemid").val(t.substring(1)),$("#accountass_assitemid").attr("data-content",t.substring(1)),$("#accountass_assitemid").attr("data-result",a.substring(1)),$("#modal_assitemid").modal("hide"),$("#assitem_z_tree").tree2("reset")}),$("#modal_assitem_reset").click(function(){$("#modal_assitemid").modal("hide"),$("#assitem_z_tree").tree2("reset")}),$("#accountass_assitemid").focus(function(){$("#modal_assitemid").modal("show"),$("#assitem_z_tree").tree2({url:"finCenter/FinTreeCommon.findSubjectAssitem.json",params:{lockCustomerId:e.rowData.customerId,lockYyyy:e.rowData.year,searchInputId:"searchInput3",param11:e.rowData.subjectId,param19:$("#searchInput3").val()},view:{leafIcon:"fa fa-building text-flat",nodeIcon:"fa fa-bank text-primary-light",folderSelectable:!1,multiSelect:!0,showCheckbox:!0,selectedColor:"",selectedBackColor:""}})})},modal3(e){$("#programParamModal").modal("show"),$("#programParamForm").formview({display:"tableform-one",column:4,buttons:[{id:"dg_generate",icon:"fa-save",style:"btn-primary",text:"&nbsp;生成"},{id:"dg_close",icon:"fa-sign-out",style:"btn-warning",text:"&nbsp;关闭"}],items:[{id:"generate_rule",type:"",label:"生成规则",html:'<label>会计科目级数：</label><label class="css-input css-radio css-radio-primary"><input type="radio" name="mater_use" data-result="1" checked="checked"><span></span></label>一级科目<label class="css-input css-radio css-radio-primary" style="margin-left:30px;"><input type="radio" name="mater_use" data-result="2"><span></span></label>二级科目<label class="css-input css-radio css-radio-primary" style="margin-left:30px;"><input type="radio" name="mater_use" data-result="3"><span></span></label>三级科目<label class="css-input css-radio css-radio-primary" style="margin-left:30px;"><input type="radio" name="mater_use" data-result="4"><span></span></label>末级科目'}]}),$("#dg_close").click(function(){$("#programParamModal").modal("hide")}),$("#dg_generate").click(function(){var t={};t.subjectLevel=$("[name='mater_use']:checked").attr("data-result"),bdoInProcessingBox("生成中"),e.generateDg(t)})},modal4(e){$("#programParamForm").formview({display:"tableform-one",column:4,buttons:[{id:"dg_generate",icon:"fa-save",style:"btn-primary",text:"&nbsp;生成"},{id:"dg_close",icon:"fa-sign-out",style:"btn-warning",text:"&nbsp;关闭"}],items:[{id:"generate_rule",type:"",label:"生成规则",html:'<div class="form-material"><label for="customer_subjectId">其他业务成本：</label><input type="text" class="form-control" style="width: 200px;" id="customer_subjectId"></div>'}]}),$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",async:!1,data:{menuId:window.sys_menuId,sqlId:"DG00435",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:window.CUR_PROJECT_ACC_YEAR,param4:"其他业务成本",start:-1,limit:-1},dataType:"json",success(e){e.success&&(e.data&&e.data[0].userSubjectId&&""!=e.data[0].userSubjectId&&$("#customer_subjectId").val(e.data[0].userSubjectId),$("#programParamModal").modal("show"))}}),$("#customer_subjectId").click(function(){$("#modal_customer_subjectid").modal("show"),$("#customer_subject_tree").hasClass("treeview")||$("#customer_subject_tree").tree({url:"finCenter/FinTreeCommon.findAccSubjectType.json",params:{lockCustomerId:window.CUR_CUSTOMERID,lockYyyy:window.CUR_PROJECT_ACC_YEAR},singleSelect:!0,lazyLoad:!1,onceLoad:!0,view:{leafIcon:"fa fa-building text-flat",nodeIcon:"fa fa-bank text-primary-light",folderSelectable:!1,multiSelect:!1,showCheckbox:!0,selectedColor:"",selectedBackColor:""}})}),$("#modal_customer_subject_sure").click(function(){var e=$("#customer_subject_tree").tree("getTreeMultiValue");"object"==typeof e?$("#customer_subjectId").val(""):$("#customer_subjectId").val(e),$("#modal_customer_subjectid").modal("hide"),$("#customer_subject_tree").tree("reset")}),$("#modal_customer_subject_reset").click(function(){$("#modal_customer_subjectid").modal("hide"),$("#customer_subject_tree").tree("reset")}),$("#dg_close").click(function(){$("#programParamModal").modal("hide")});JSON.parse(e.rowData.dgparam);$("#dg_generate").click(function(){var t={};null!=$("#customer_subjectId").val()&&""!=$("#customer_subjectId").val()?(t.subjectId=$("#customer_subjectId").val(),bdoInProcessingBox("生成中"),e.generateDg(t)):bdoInfoBox("请选择其他业务成本")})},modal5(e){$("#programParamForm").formview({display:"tableform-one",column:4,buttons:[{id:"dg_generate",icon:"fa-save",style:"btn-primary",text:"&nbsp;生成"},{id:"dg_close",icon:"fa-sign-out",style:"btn-warning",text:"&nbsp;关闭"}],items:[{id:"generate_rule",type:"",label:"生成规则",html:'<div class="form-material"><label for="customer_subjectId">主营业务成本：</label><input type="text" class="form-control" style="width: 200px;" id="customer_subjectId"></div>'}]}),$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",async:!1,data:{menuId:window.sys_menuId,sqlId:"DG00435",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:window.CUR_PROJECT_ACC_YEAR,param4:"主营业务成本",start:-1,limit:-1},dataType:"json",success(e){e.success&&(e.data&&e.data[0].userSubjectId&&""!=e.data[0].userSubjectId&&$("#customer_subjectId").val(e.data[0].userSubjectId),$("#programParamModal").modal("show"))}}),$("#customer_subjectId").click(function(){$("#modal_customer_subjectid").modal("show"),$("#customer_subject_tree").hasClass("treeview")||$("#customer_subject_tree").tree({url:"finCenter/FinTreeCommon.findAccSubjectType.json",params:{lockCustomerId:window.CUR_CUSTOMERID,lockYyyy:window.CUR_PROJECT_ACC_YEAR,searchInputId:"searchInput2"},singleSelect:!0,lazyLoad:!1,onceLoad:!0,view:{leafIcon:"fa fa-building text-flat",nodeIcon:"fa fa-bank text-primary-light",folderSelectable:!1,multiSelect:!1,showCheckbox:!0,selectedColor:"",selectedBackColor:""}})}),$("#modal_customer_subject_sure").click(function(){var e=$("#customer_subject_tree").tree("getTreeMultiValue");"object"==typeof e?$("#customer_subjectId").val(""):$("#customer_subjectId").val(e),$("#modal_customer_subjectid").modal("hide"),$("#customer_subject_tree").tree("reset")}),$("#modal_customer_subject_reset").click(function(){$("#modal_customer_subjectid").modal("hide"),$("#customer_subject_tree").tree("reset")}),$("#dg_close").click(function(){$("#programParamModal").modal("hide")});JSON.parse(e.rowData.dgparam);$("#dg_generate").click(function(){var t={};null!=$("#customer_subjectId").val()&&""!=$("#customer_subjectId").val()?(t.subjectId=$("#customer_subjectId").val(),bdoInProcessingBox("生成中"),e.generateDg(t)):bdoInfoBox("请选择主营业务成本")})},modal6(e){$("#programParamForm").formview({display:"tableform-one",column:4,buttons:[{id:"dg_generate",icon:"fa-save",style:"btn-primary",text:"&nbsp;生成"},{id:"dg_close",icon:"fa-sign-out",style:"btn-warning",text:"&nbsp;关闭"}],items:[{id:"generate_rule",type:"",label:"生成规则",html:'<div class="form-material"><label for="customer_subjectId">递延所得税负债：</label><input type="text" class="form-control" style="width: 200px;" id="customer_subjectId"></div>'}]}),$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",async:!1,data:{menuId:window.sys_menuId,sqlId:"DG00435",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:window.CUR_PROJECT_ACC_YEAR,param4:"递延所得税负债",start:-1,limit:-1},dataType:"json",success(e){e.success&&(e.data&&e.data[0].userSubjectId&&""!=e.data[0].userSubjectId&&$("#customer_subjectId").val(e.data[0].userSubjectId),$("#programParamModal").modal("show"))}}),$("#customer_subjectId").click(function(){$("#modal_customer_subjectid").modal("show"),$("#customer_subject_tree").hasClass("treeview")||$("#customer_subject_tree").tree({url:"finCenter/FinTreeCommon.findAccSubjectType.json",params:{lockCustomerId:window.CUR_CUSTOMERID,lockYyyy:window.CUR_PROJECT_ACC_YEAR,searchInputId:"searchInput2"},singleSelect:!0,lazyLoad:!1,onceLoad:!0,view:{leafIcon:"fa fa-building text-flat",nodeIcon:"fa fa-bank text-primary-light",folderSelectable:!1,multiSelect:!1,showCheckbox:!0,selectedColor:"",selectedBackColor:""}})}),$("#modal_customer_subject_sure").click(function(){var e=$("#customer_subject_tree").tree("getTreeMultiValue");"object"==typeof e?$("#customer_subjectId").val(""):$("#customer_subjectId").val(e),$("#modal_customer_subjectid").modal("hide")}),$("#modal_customer_subject_reset").click(function(){$("#modal_customer_subjectid").modal("hide"),$("#customer_subject_tree").tree("reset")}),$("#dg_close").click(function(){$("#programParamModal").modal("hide")});JSON.parse(e.rowData.dgparam);$("#dg_generate").click(function(){var t={};null!=$("#customer_subjectId").val()&&""!=$("#customer_subjectId").val()?(t.subjectId=$("#customer_subjectId").val(),bdoInProcessingBox("生成中"),e.generateDg(t)):bdoInfoBox("请选择递延所得税负债")})},modal7(e){$("#programParamForm").formview({display:"tableform-one",column:4,buttons:[{id:"dg_generate",icon:"fa-save",style:"btn-primary",text:"&nbsp;生成"},{id:"dg_close",icon:"fa-sign-out",style:"btn-warning",text:"&nbsp;关闭"}],items:[{id:"generate_rule",type:"",label:"生成规则",html:'<div class="form-material"><label for="customer_subjectId">递延所得税资产：</label><input type="text" class="form-control" style="width: 200px;" id="customer_subjectId"></div>'}]}),$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",async:!1,data:{menuId:window.sys_menuId,sqlId:"DG00435",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:window.CUR_PROJECT_ACC_YEAR,param4:"递延所得税资产",start:-1,limit:-1},dataType:"json",success(e){e.success&&(e.data&&e.data[0].userSubjectId&&""!=e.data[0].userSubjectId&&$("#customer_subjectId").val(e.data[0].userSubjectId),$("#programParamModal").modal("show"))}}),$("#customer_subjectId").click(function(){$("#modal_customer_subjectid").modal("show"),$("#customer_subject_tree").hasClass("treeview")||$("#customer_subject_tree").tree({url:"finCenter/FinTreeCommon.findAccSubjectType.json",params:{lockCustomerId:window.CUR_CUSTOMERID,lockYyyy:window.CUR_PROJECT_ACC_YEAR,searchInputId:"searchInput2"},singleSelect:!0,lazyLoad:!1,onceLoad:!0,view:{leafIcon:"fa fa-building text-flat",nodeIcon:"fa fa-bank text-primary-light",folderSelectable:!1,multiSelect:!1,showCheckbox:!0,selectedColor:"",selectedBackColor:""}})}),$("#modal_customer_subject_sure").click(function(){var e=$("#customer_subject_tree").tree("getTreeMultiValue");"object"==typeof e?$("#customer_subjectId").val(""):$("#customer_subjectId").val(e),$("#modal_customer_subjectid").modal("hide"),$("#customer_subject_tree").tree("reset")}),$("#modal_customer_subject_reset").click(function(){$("#modal_customer_subjectid").modal("hide"),$("#customer_subject_tree").tree("reset")}),$("#dg_close").click(function(){$("#programParamModal").modal("hide")});JSON.parse(e.rowData.dgparam);$("#dg_generate").click(function(){var t={};null!=$("#customer_subjectId").val()&&""!=$("#customer_subjectId").val()?(t.subjectId=$("#customer_subjectId").val(),bdoInProcessingBox("生成中"),e.generateDg(t)):bdoInfoBox("请选择递延所得税资产")})},modal8(e){$("#programParamModal").modal("show"),$("#programParamForm").formview({display:"tableform-one",column:4,buttons:[{id:"tb_generate",icon:"fa-save",style:"btn-primary",text:"&nbsp;生成"},{id:"tb_close",icon:"fa-sign-out",style:"btn-warning",text:"&nbsp;关闭"}],items:[{id:"tb_autoid",type:"input",typeAttr:{type:"hidden"}},{id:"generate_rule",type:"",label:"生成规则",html:'<label class="css-input css-radio css-radio-primary">数据来源：<input type="radio" name="mater_use" data-result="1" checked="checked"><span></span></label>科目下辅助核算<label class="css-input css-radio css-radio-primary" style="margin-left:30px;"><input type="radio" name="mater_use" data-result="2"><span></span></label>辅助核算类型'},{id:"accountass_assitemid",type:"input",label:"核算类型",typeAttr:{normal:!0,hidden:!0},validate:{rules:{required:!0}},rowspan:1}]}),$("[for=accountass_assitemid]").hide(),$("#accountass_assitemid").hide();var t=JSON.parse(e.rowData.dgparam);null!=t&&(1==t.accountSource?$("[name='mater_use'][data-result=1]").attr("checked","checked"):($("[name='mater_use'][data-result=2]").attr("checked","checked"),$("[for=accountass_assitemid]").show(),$("#accountass_assitemid").val(t.accountingType),$("#accountass_assitemid").show())),$("#modalHideBtn").click(function(){$("#programParamModal").modal("hide")}),$("#tb_close").click(function(){$("#programParamModal").modal("hide")}),$("[name='mater_use']").change(function(){"1"==$(this).attr("data-result")?($("#accountass_assitemid").hide(),$("[for=accountass_assitemid]").hide(),$("#caret_accountass_assitemid").hide()):($("#accountass_assitemid").show(),$("[for=accountass_assitemid]").show(),$("#caret_accountass_assitemid").show())}),$("#tb_generate").click(function(){var t={};t.accountSource=$("[name='mater_use']:checked").attr("data-result"),("2"!=t.accountSource||$("#programParamForm").valid())&&("2"==t.accountSource&&(t.accountingType=$("#accountass_assitemid").val()),bdoInProcessingBox("生成中"),e.generateDg(t))}),$("#modal_assitem_sure").click(function(){$("[name='mater_use']:checked").attr("data-result");var e=$("#assitem_z_tree").treeview(!0).getChecked(),t="",a="";for(var r of e)t=t+","+r.label,a=a+","+r.value;$("#accountass_assitemid").val(t.substring(1)),$("#accountass_assitemid").attr("data-content",t.substring(1)),$("#accountass_assitemid").attr("data-result",a.substring(1)),$("#modal_assitemid").modal("hide"),$("#assitem_z_tree").tree2("reset")}),$("#modal_assitem_reset").click(function(){$("#modal_assitemid").modal("hide"),$("#assitem_z_tree").tree2("reset")}),$("#accountass_assitemid").focus(function(){$("#modal_assitemid").modal("show"),$("#assitem_z_tree").tree2({url:"finCenter/FinTreeCommon.findSubjectAssitem.json",params:{lockCustomerId:e.rowData.customerId,lockYyyy:e.rowData.year,searchInputId:"searchInput3",param11:e.rowData.subjectId,param19:$("#searchInput3").val()},view:{leafIcon:"fa fa-building text-flat",nodeIcon:"fa fa-bank text-primary-light",folderSelectable:!1,multiSelect:!0,showCheckbox:!0,selectedColor:"",selectedBackColor:""}})})}};function programParamInit(e){var t=tplLoader(e.rowData.paramHtmlPath);$("#programParamModalWrap").html(t);let a=$("#programParamModalWrap").find("[data-dgparam-method]").attr("data-dgparam-method");modalInitMethod[a](e)}function AuditProgramPage(e){let t,a,r=e.data,l=e.template||tplLoader("dgCenter/html/dg/auditProgram.html"),s={props:{programInfo:Object,rownum:Number,currentValue:String,datas:Array},data(){return{editMan:this.currentValue}},watch:{editMan(e){this.programInfo.workpaperEditor=e,this.currentValue!=e&&this.updateProgramEditor()}},computed:{editManDisabled:()=>CUR_USERID!=JSON.parse($.sessionStorage("projectManager"))&&void 0!=JSON.parse($.sessionStorage("projectManager"))},methods:{updateProgramEditor(){if(CUR_USERID!=JSON.parse($.sessionStorage("projectManager"))&&void 0!=JSON.parse($.sessionStorage("projectManager")))bdoInfoBox("","只有当前项目负责人才能编辑底稿编制人!");else{let e,t=this.editMan;this.datas.map(function(a){t==a.id&&(e=""==a.value?a.text:a.value)}),$.ajax({type:"post",url:"dgCenter/DgMain.updateProgramEditor.json",data:{param1:this.programInfo.autoId,param2:this.programInfo.customerId,param3:this.programInfo.projectId,param4:this.editMan,param5:this.programInfo.dgName,param6:e},dataType:"json",bdolxLoader:!1}).done(e=>{e.success?(OneUI.notifySuccess("保存成功！"),this.currentValue=this.editMan):OneUI.notifyError(e.resultInfo.statusText)})}}},template:'<div>\t<div class="form-material">\t\t<select class="form-control" v-model="editMan" style="margin-left:5px" :disabled="editManDisabled">\t\t\t<option v-for="(data, index) in datas" :value="data.id">{{ data.text }}</option>\t\t</select>\t</div></div>'},o={props:{labelName:String,groupReadonly:Boolean,ecsVal:String,esVal:String,prefixed:String},data:()=>({ecavpcomp_cs:"",ecavpcomp_s:0,esValRequired:!1,esValMin:0,esValCache:{}}),computed:{checkboxGroupClass(){return 1==this.groupReadonly?"css-input css-input-disabled css-checkbox css-checkbox-primary control-label":"css-input css-checkbox css-checkbox-primary control-label"},esValDisabled(){return"1"!=this.ecsVal&&!0!==this.ecsVal},elName(){return this.prefixed+"s"+this.labelName}},watch:{esVal(e){if(1==this.esValCache[e])return void(this.$parent.jsonData[this.prefixed+"s"+this.labelName]=e);let t=e;(t=String(t).replace(/[^\d.]/g,"").replace(/\.{2,}/g,".").replace(".","$#$").replace(/\./g,"").replace("$#$",".").replace(/^(\-)*(\d+)\.(\d\d).*$/,"$1$2.$3")).indexOf(".")<0&&""!=t&&(t=parseFloat(t)),parseFloat(t)>3&&(t=3),this.esVal=t,this.$parent.jsonData[this.prefixed+"s"+this.labelName]=this.esVal,this.esValCache[this.esVal]||(this.esValCache[this.esVal]=1)},ecsVal(e,t){!0===e?(this.esVal&&""!=this.esVal||(this.esVal=0),this.esValMin=.01):(this.esVal="",this.esValMin=0),this.esValRequired=e,this.$parent.jsonData[this.prefixed+"cs"+this.labelName]=e}},template:'\n\t\t\t\t\t\x3c!--<div class="row" style="padding: 10px 0;">--\x3e\n\t\t\t\t\t\t<div class="col-md-2">\n\t\t\t\t\t\t\t<label  :class="checkboxGroupClass">\n\t\t\t\t\t\t\t\t<input type="checkbox"  v-model="ecsVal" value="1">\n\t\t\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t\t\t{{labelName}}\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\x3c!--<label class="col-md-2 control-label" for="ecavpcomp_cs">分数</label>\n\t\t\t\t\t\t<div class="col-md-6">\n\t\t\t\t\t\t\t<input :name="elName" class="form-control" type="number" v-model="esVal" :required="esValRequired" :min="esValMin" :disabled="esValDisabled">\n\t\t\t\t\t\t</div>--\x3e\n\t\t\t\t\t\x3c!--</div>--\x3e\n\t\t'},n={el:"#auditProgramTable tbody",components:{"edit-man-edit":s},data:{rowData:[],editMans:[]},methods:{}};Vue.component("ecavp-comp",o),t=((e,t,a,r,l)=>{let s="css-checkbox-primary",o="";return 1==l&&(e!=a&&(s="css-checkbox-danger"),t!=r&&(o="score-red")),'<label class="css-input css-checkbox '+s+' control-label" >\t\t\t<input type="checkbox" '+("1"==e?"checked":"")+" disabled>\t\t\t<span></span>\t\t</label>"}),e.template=l,$(e.region).html(l);let i=0,d=1,c=[],u={},m=new Page({random:(new Date).getTime()+parseInt(1e3*Math.random()),container:e.region,events:(()=>{let e={"#newAuditprogramBtn":"click,onNewAuditprogramClick","#addOtherProgramBtn":"click,onAddOtherProgramClick","#selectOkBtn":"click,onSelectOkClick","#selectCancelBtn":"click,onSelectCancelClick","#editButtonAll":"click,onEditAllClick","#refreshButtonAll":"click,onRefreshAllClick","#auditProgramTopBtn":"click,onAuditProgramTopClick","#searchBtn":"click,onSearchClick","#filter":"change,onFilterChange","#filterEditor2":"change,onFilterEditorChange"};return"SUBJECT"==r.type?e:{"#filter":"change,onFilterChange","#filterEditor2":"change,onFilterEditorChange","#editButtonAll":"click,onEditAllClick","#refreshButtonAll":"click,onRefreshAllClick","#auditProgramTopBtn":"click,onAuditProgramTopClick"}})(),_template:e.template||tplLoader("dgCenter/html/dg/auditProgram.html"),_data:e.data,bindTableOptEvents(){$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",data:{menuId:window.sys_menuId,sqlId:"DG00061",param1:window.CUR_PROJECTID,param2:window.CUR_CUSTOMERID},dataType:"json",success:function(e){e.success?"1"==e.data[0].mergeType&&($("#auditProgramEcavpTableBlock").remove(),$("#auditProgramTopBtn").remove()):bdoErrorBox("提示",e.resultInfo.statusText)}}),$("#auditProgramTable").on("click",'button.table-btn-operate[name="optNewSubProgramBtn"]',e=>{let t=m,a=$("#auditProgramTable").dataTable().fnGetData($(e.currentTarget).attr("data-row"));t.editSubProgramForm.jsonData={autoId:null,customerId:a.customerId,projectId:a.projectId,subjecttreeId:a.subjecttreeId,parentId:a.autoId,level:a.level+1,required:a.required,pindexId:a.indexId,es_indexId:"",es_dgName:a.dgName,es_programNameAft:a.programNameAft,es_csE:t.booleanTranslate(a.csE),es_csC:t.booleanTranslate(a.csC),es_csA:t.booleanTranslate(a.csA),es_csV:t.booleanTranslate(a.csV),es_csP:t.booleanTranslate(a.csP),es_sE:"",es_sC:"",es_sA:"",es_sV:"",es_sP:""},t.editSubProgramForm.process="add",t.editSubProgramSider.show()}),$("#auditProgramTable").on("click",'button.table-btn-operate[name="optEditBtn"]',e=>{let t=m,a=$("#auditProgramTable").dataTable().fnGetData($(e.currentTarget).attr("data-row")),l=a.programNameAft;a.programNameAftCache&&(l=a.programNameAftCache),1!=a.level?"1"!=a.customizeFlag?(t.editAuditprogramForm.jsonData={autoId:a.autoId,customerId:a.customerId,eindexId:a.indexId,edgName:a.dgName,eprogramName:a.programNameAft,econfirmStatus:a.confirmStatusAft,programNameAft:l,confirmStatusAft:a.confirmStatusAft,ecsE:t.booleanTranslate(a.csE),ecsC:t.booleanTranslate(a.csC),ecsA:t.booleanTranslate(a.csA),ecsV:t.booleanTranslate(a.csV),ecsP:t.booleanTranslate(a.csP),esE:a.sE,esC:a.sC,esA:a.sA,esV:a.sV,esP:a.sP,workpaperId:a.workpaperId},t.editAuditprogramFormSider.show()):(t.cusAuditprogramForm.jsonData={autoId:a.autoId,dgName:a.dgName,indexId:a.indexId,required:a.required,confirmStatusAft:a.confirmStatusAft,programNameAft:l,delTemplates:[],draftTemplate:[],draftTemplateName:[],customerId:r.extraOptions.customerId,projectId:r.extraOptions.projectId,subjecttreeId:r.extraOptions.autoId,csE:t.booleanTranslate(a.csE),csC:t.booleanTranslate(a.csC),csA:t.booleanTranslate(a.csA),csV:t.booleanTranslate(a.csV),csP:t.booleanTranslate(a.csP),sE:a.sE,sC:a.sC,sA:a.sA,sV:a.sV,sP:a.sP,workpaperId:a.workpaperId},t.cusAuditprogramForm.process="edit",t.cusAuditprogramFormSider.show()):(t.editSubProgramForm.jsonData={autoId:a.autoId,customerId:a.customerId,projectId:a.projectId,subjecttreeId:a.subjecttreeId,parentId:a.parentId,level:a.level,required:a.required,pindexId:"",es_indexId:a.indexId,es_dgName:a.dgName,es_programNameAft:l,es_csE:t.booleanTranslate(a.csE),es_csC:t.booleanTranslate(a.csC),es_csA:t.booleanTranslate(a.csA),es_csV:t.booleanTranslate(a.csV),es_csP:t.booleanTranslate(a.csP),es_sE:a.sE,es_sC:a.sC,es_sA:a.sA,es_sV:a.sV,es_sP:a.sP,workpaperId:a.workpaperId},t.editSubProgramForm.process="edit",t.editSubProgramSider.show())}),$("#auditProgramTable").on("click",'button.table-btn-operate[name="optOpenExcelBtn"]',e=>{let t,a=$("#auditProgramTable").dataTable().fnGetData($(e.currentTarget).attr("data-row")),l=e=>{if(e.extraOptions&&"FILE"==e.extraOptions.nodeType&&e.extraOptions.workpaperId==a.workpaperId)t=e;else if(!t&&e.nodes)for(let a=0;a<e.nodes.length&&(l(e.nodes[a]),!t);a++);};l(r),t&&(t.currentNode=$.extend(!1,{},t),t.currentNode.currentNode=null,t.workpagerId=t.extraOptions.workpagerId,t.menuId=window.sys_menuId,$.sessionStorage("subjecttreeNode",JSON.stringify(t)),window.open("/Faith/dgcenter.do?m=openWorkpaper&index="+t.extraOptions.indexId+"&projectId="+t.extraOptions.projectId))}),$("#unexecuteprogamTable").on("click",'button.table-btn-operate[name="optToExcProgramBtn"]',e=>{let t=$("#unexecuteprogamTable").dataTable().fnGetData($(e.currentTarget).attr("data-row"));bdoConfirmBox("提示","确定重新执行该程序吗？",()=>{$.ajax({type:"post",url:"dgCenter/DgMain.setExcuteProgram.json",data:{param1:t.autoId,param2:t.customerId},dataType:"json",success(e){e.success?(bdoSuccessBox("成功",e.resultInfo.statusText),$("#auditProgramTable").DataTable().ajax.reload(),$("#unexecuteprogamTable").DataTable().ajax.reload()):bdoErrorBox("失败",e.resultInfo.statusText)}})})}),$("#auditProgramTable").on("click","i.btn.program-level-0opt",e=>{$(e.currentTarget).toggleClass("fa-plus-circle"),$(e.currentTarget).toggleClass("fa-minus-circle");let t=$(e.currentTarget).attr("data-program-id");$("#auditProgramTable").find('tr.program-level-1[data-program-parent-id="'+t+'"]').toggle()}),$("#auditProgramTable").unbind("initEditVm"),$("#auditProgramTable").bind("initEditVm",((e,t)=>{e.preventDefault(),(n=$.extend(!1,{},n)).data.editMans=m.selectEditors,n.data.rowData=$.extend(!1,{},t),a=new Vue(n)}).bind(this)),this.initDropMenu()},initDropMenu(){let t=this;bdoDropMenu.bind(t)({el:'#auditProgramTable button.table-btn-operate[name="operate"]',scope:t,beforeShow(e,t){let a=$("#auditProgramTable").dataTable().fnGetData(e.attr("data-row"));0==a.level?(t.find("#audit").closest("li").hide(),t.find("#createDg").closest("li").hide(),t.find("#createEmptyDg").closest("li").hide(),t.find("#uploadDg").closest("li").hide(),t.find("#dgAttachBtn").closest("li").hide(),t.find("#downloadDg").closest("li").hide(),t.find("#delProgram").closest("li").hide(),t.find("#openPostilBtn").closest("li").hide(),t.find("#unExecute").closest("li").show(),t.find("#addProgram").closest("li").show(),t.find("#refreshDgCover").closest("li").hide()):1==a.level&&(t.find("#audit").closest("li").show(),t.find("#createDg").closest("li").show(),t.find("#createEmptyDg").closest("li").show(),t.find("#uploadDg").closest("li").show(),t.find("#dgAttachBtn").closest("li").show(),t.find("#downloadDg").closest("li").show(),t.find("#delProgram").closest("li").show(),t.find("#openPostilBtn").closest("li").show(),t.find("#unExecute").closest("li").hide(),t.find("#addProgram").closest("li").hide(),t.find("#refreshDgCover").closest("li").show())},buttons:[{id:"unExecute",text:"不执行",icon:"fa fa-minus-circle",handler(e,a){m.unexecuteFormSider.show();let r=$("#auditProgramTable").dataTable().fnGetData(e.attr("data-row"));t.unexecuteForm.jsonData.autoId=r.autoId,t.unexecuteForm.jsonData.customerId=r.customerId,t.unexecuteForm.jsonData.reason=""}},{id:"delProgram",text:"删除",icon:"fa fa-close",handler(t,a){let l=$("#auditProgramTable").dataTable().fnGetData(t.attr("data-row"));$.ajax({type:"post",url:"dgCenter/DgMain.checkProgramStatus.json",data:{param1:l.autoId,param2:l.customerId,param3:l.subjectId},success(t){t.success?bdoConfirmBox("提示","确定要删除该条程序吗？",t=>{$.ajax({type:"post",url:"dgCenter/DgMain.delSubProgram.json",data:{param1:l.autoId,param2:l.customerId,refreshFlg:1},dataType:"json",success(t){t.success?(bdoSuccessBox("成功",t.resultInfo.statusText),getSubjecttree({param1:window.CUR_PROJECTID,param2:$("#onlyMyselfCheckBox").get(0).checked?"1":""},t=>{$(".js-tree-collapsed").trigger("rebuild",[{data:[t.data[0].treeData],levels:r.deep+2,callback(t){t.expandNode(r.nodeId,{levels:r.deep+2,silent:!0}),t.selectNode(r.nodeId,{silent:!0}),r=e.data=t.getNode(r.nodeId)}}]),$("#auditProgramTable").DataTable().ajax.reload()})):bdoErrorBox("失败",t.resultInfo.statusText)}})}):bdoErrorBox("失败",t.resultInfo.statusText)}})}},{id:"createDg",text:"生成底稿",icon:"fa fa-newspaper-o",handler(t,a){let l=$("#auditProgramTable").dataTable().fnGetData(t.attr("data-row")),s=()=>{programParamInit({rowData:l,generateDg(t){$("#programParamModal").modal("hide"),$.ajax({type:"post",url:"dgCenter/DgMain.createDg.json",data:{param1:l.autoId,param2:l.customerId,param3:JSON.stringify(t),param4:l.year,param5:l.projectId,param6:l.subjectId,param7:l.subjectName},dataType:"json",success(t){t.success?getSubjecttree({param1:window.CUR_PROJECTID,param2:$("#onlyMyselfCheckBox").get(0).checked?"1":""},t=>{$(".js-tree-collapsed").trigger("rebuild",[{data:[t.data[0].treeData],levels:r.deep+2,callback(t){t.expandNode(r.nodeId,{levels:r.deep+2,silent:!0}),t.selectNode(r.nodeId,{silent:!0}),r=e.data=t.getNode(r.nodeId)}}]),$("#auditProgramTable").DataTable().ajax.reload(),bdoSuccessBox("成功",t.resultInfo.statusText);var a=window.localStorage;storageId="BDO"+t.data[0].workpaperId,storageStatus="BDO"+t.data[0].workpaperId+"Status",storageTime="BDO"+t.data[0].workpaperId+"Time",a.removeItem(storageId),a.removeItem(storageStatus),a.removeItem(storageTime)}):bdoErrorBox("失败",t.resultInfo.statusText)}})}})};if(null!=l.workpaperId&&""!=l.workpaperId){var o='<div style="height: 150px;overflow-y: auto">底稿已生成，是否重新生成？<br>';o+='<font color="red">重新生成底稿会删除<br>',o+="单向链接<br>",o+="交叉索引<br>",o+="抽凭链接<br>",o+="底稿取值</div>",bdoConfirmBox("提示",o,t=>{null!=l.paramHtmlPath?s():($("#programParamModal").modal("hide"),bdoInProcessingBox("生成中"),$.ajax({type:"post",url:"dgCenter/DgMain.createDg.json",data:{param1:l.autoId,param2:l.customerId,param4:l.year,param5:l.projectId,param6:l.subjectId,param7:l.subjectName},dataType:"json",success(t){t.success?getSubjecttree({param1:window.CUR_PROJECTID,param2:$("#onlyMyselfCheckBox").get(0).checked?"1":""},t=>{$(".js-tree-collapsed").trigger("rebuild",[{data:[t.data[0].treeData],levels:r.deep+2,callback(t){t.expandNode(r.nodeId,{levels:r.deep+2,silent:!0}),t.selectNode(r.nodeId,{silent:!0}),r=e.data=t.getNode(r.nodeId)}}]),$("#auditProgramTable").DataTable().ajax.reload(),bdoSuccessBox("成功",t.resultInfo.statusText);var a=window.localStorage;storageId="BDO"+t.data[0].workpaperId,storageStatus="BDO"+t.data[0].workpaperId+"Status",storageTime="BDO"+t.data[0].workpaperId+"Time",a.removeItem(storageId),a.removeItem(storageStatus),a.removeItem(storageTime)}):bdoErrorBox("失败",t.resultInfo.statusText)}}))})}else null!=l.paramHtmlPath?s():($("#programParamModal").modal("hide"),bdoInProcessingBox("生成中"),$.ajax({type:"post",url:"dgCenter/DgMain.createDg.json",data:{param1:l.autoId,param2:l.customerId,param4:l.year,param5:l.projectId,param6:l.subjectId,param7:l.subjectName},dataType:"json",success(t){t.success?getSubjecttree({param1:window.CUR_PROJECTID,param2:$("#onlyMyselfCheckBox").get(0).checked?"1":""},t=>{$(".js-tree-collapsed").trigger("rebuild",[{data:[t.data[0].treeData],levels:r.deep+2,callback(t){t.expandNode(r.nodeId,{levels:r.deep+2,silent:!0}),t.selectNode(r.nodeId,{silent:!0}),r=e.data=t.getNode(r.nodeId)}}]),$("#auditProgramTable").DataTable().ajax.reload(),bdoSuccessBox("成功",t.resultInfo.statusText);var a=window.localStorage;storageId="BDO"+t.data[0].workpaperId,storageStatus="BDO"+t.data[0].workpaperId+"Status",storageTime="BDO"+t.data[0].workpaperId+"Time",a.removeItem(storageId),a.removeItem(storageStatus),a.removeItem(storageTime)}):bdoErrorBox("失败",t.resultInfo.statusText)}}))}},{id:"createEmptyDg",text:"生成无数据底稿",icon:"fa fa-newspaper-o",handler(t,a){let l=$("#auditProgramTable").dataTable().fnGetData(t.attr("data-row")),s=()=>{programParamInit({rowData:l,generateDg(t){$("#programParamModal").modal("hide"),$.ajax({type:"post",url:"dgCenter/DgMain.createDg.json",data:{param1:l.autoId,param2:l.customerId,param3:JSON.stringify(t),param4:l.year,param5:l.projectId,param6:l.subjectId,param7:l.subjectName,param8:"false"},dataType:"json",success(t){t.success?getSubjecttree({param1:window.CUR_PROJECTID,param2:$("#onlyMyselfCheckBox").get(0).checked?"1":""},t=>{$(".js-tree-collapsed").trigger("rebuild",[{data:[t.data[0].treeData],levels:r.deep+2,callback(t){t.expandNode(r.nodeId,{levels:r.deep+2,silent:!0}),t.selectNode(r.nodeId,{silent:!0}),r=e.data=t.getNode(r.nodeId)}}]),$("#auditProgramTable").DataTable().ajax.reload(),bdoSuccessBox("成功",t.resultInfo.statusText);var a=window.localStorage;storageId="BDO"+t.data[0].workpaperId,storageStatus="BDO"+t.data[0].workpaperId+"Status",storageTime="BDO"+t.data[0].workpaperId+"Time",a.removeItem(storageId),a.removeItem(storageStatus),a.removeItem(storageTime)}):bdoErrorBox("失败",t.resultInfo.statusText)}})}})};if(null!=l.workpaperId&&""!=l.workpaperId){var o='<div style="height: 150px;overflow-y: auto">底稿已生成，是否重新生成？<br>';o+='<font color="red">重新生成底稿会删除<br>',o+="单向链接<br>",o+="交叉索引<br>",o+="抽凭链接<br>",o+="底稿取值</div>",bdoConfirmBox("提示",o,t=>{null!=l.paramHtmlPath?s():($("#programParamModal").modal("hide"),bdoInProcessingBox("生成中"),$.ajax({type:"post",url:"dgCenter/DgMain.createDg.json",data:{param1:l.autoId,param2:l.customerId,param4:l.year,param5:l.projectId,param6:l.subjectId,param7:l.subjectName,param8:"false"},dataType:"json",success(t){t.success?getSubjecttree({param1:window.CUR_PROJECTID,param2:$("#onlyMyselfCheckBox").get(0).checked?"1":""},t=>{$(".js-tree-collapsed").trigger("rebuild",[{data:[t.data[0].treeData],levels:r.deep+2,callback(t){t.expandNode(r.nodeId,{levels:r.deep+2,silent:!0}),t.selectNode(r.nodeId,{silent:!0}),r=e.data=t.getNode(r.nodeId)}}]),$("#auditProgramTable").DataTable().ajax.reload(),bdoSuccessBox("成功",t.resultInfo.statusText);var a=window.localStorage;storageId="BDO"+t.data[0].workpaperId,storageStatus="BDO"+t.data[0].workpaperId+"Status",storageTime="BDO"+t.data[0].workpaperId+"Time",a.removeItem(storageId),a.removeItem(storageStatus),a.removeItem(storageTime)}):bdoErrorBox("失败",t.resultInfo.statusText)}}))})}else null!=l.paramHtmlPath?s():($("#programParamModal").modal("hide"),bdoInProcessingBox("生成中"),$.ajax({type:"post",url:"dgCenter/DgMain.createDg.json",data:{param1:l.autoId,param2:l.customerId,param4:l.year,param5:l.projectId,param6:l.subjectId,param7:l.subjectName,param8:"false"},dataType:"json",success(t){t.success?getSubjecttree({param1:window.CUR_PROJECTID,param2:$("#onlyMyselfCheckBox").get(0).checked?"1":""},t=>{$(".js-tree-collapsed").trigger("rebuild",[{data:[t.data[0].treeData],levels:r.deep+2,callback(t){t.expandNode(r.nodeId,{levels:r.deep+2,silent:!0}),t.selectNode(r.nodeId,{silent:!0}),r=e.data=t.getNode(r.nodeId)}}]),$("#auditProgramTable").DataTable().ajax.reload(),bdoSuccessBox("成功",t.resultInfo.statusText);var a=window.localStorage;storageId="BDO"+t.data[0].workpaperId,storageStatus="BDO"+t.data[0].workpaperId+"Status",storageTime="BDO"+t.data[0].workpaperId+"Time",a.removeItem(storageId),a.removeItem(storageStatus),a.removeItem(storageTime)}):bdoErrorBox("失败",t.resultInfo.statusText)}}))}},{id:"uploadDg",text:"上传底稿",icon:"fa fa-upload",handler(e,a){let l=$("#auditProgramTable").dataTable().fnGetData(e.attr("data-row")),s=()=>{$("#uploadTplFormModal").modal("show"),t.uploadWorkpagerPage.jsonData.subjecttreeId=l.subjecttreeId,t.uploadWorkpagerPage.jsonData.autoId=l.autoId,t.uploadWorkpagerPage.jsonData.customerId=r.extraOptions.customerId};null!=l.workpaperId&&""!=l.workpaperId?bdoConfirmBox("提示","该程序已有底稿文件，上传的底稿将会覆盖原来的底稿文件！",e=>{s()}):s()}},{id:"dgAttachBtn",text:"底稿附件",icon:"fa fa-file",handler(e,a){let l=$("#auditProgramTable").dataTable().fnGetData(e.attr("data-row"));if(!l.workpaperId||""==l.workpaperId)return void bdoErrorBox("","该程序还未生成底稿！");let s=r;s.programInfo=l,s.parent=t,t.dgAttachSider.show(),s.nodeName=l.indexId+"-"+l.dgName,DgAttachPage({region:"#dgAttachRegion",data:s})}},{id:"downloadDg",text:"下载底稿",icon:"fa fa-download",handler(e,t){let a=$("#auditProgramTable").dataTable().fnGetData(e.attr("data-row"));a.workpaperId&&""!=a.workpaperId?$.ajax({type:"post",url:"dgCenter/DgWapper.havePermission.json",data:{param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:a.workpaperId},dataType:"json",success(e){e.success?downloadFile("dgCenter/DgDownload.downloadWorkpaper.json",{param1:a.workpaperId,param2:a.customerId}):bdoErrorBox("失败",e.resultInfo.statusText)}}):bdoErrorBox("","该程序还未生成底稿！")}},{id:"downloadDgTpl",text:"下载底稿模板",icon:"fa fa-download",handler(e,t){let a=$("#auditProgramTable").dataTable().fnGetData(e.attr("data-row"));downloadFile("dgCenter/DgDownload.downloadTemplate.json",{param1:a.autoId,param2:a.customerId,param3:a.projectId})}},{id:"openPostilBtn",text:"批注",icon:"fa fa-bookmark-o",handler(e,t){let a=$("#auditProgramTable").dataTable().fnGetData(e.attr("data-row"));DgPostilPage({region:"#sideRegin",data:a,type:a.indexId,foreignId:a.subjecttreeId,isSingle:!1,customerId:a.customerId,projectId:a.projectId})}},{id:"refreshDgCover",text:"刷新底稿封面",icon:"fa fa-file-excel-o",handler(e,t){let a=$("#auditProgramTable").dataTable().fnGetData(e.attr("data-row"));null!=a.workpaperId&&""!=a.workpaperId&&$.ajax({url:"dgCenter/DgWapper.refreshDgCover.json",type:"post",data:{menuId:window.sys_menuId,param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:a.workpaperId},dataType:"json",success:function(e){e.success?bdoSuccessBox("成功",e.resultInfo.statusText):bdoErrorBox("失败",e.resultInfo.statusText)}})}}]})},onRefreshAllClick(e){var t=null;"SUBJECT"==r.type&&(t=r.extraOptions.autoId),"TBSUBJECT"==r.type&&(t=r.extraOptions.autoId),"PROJECT"==r.type&&(t=r.extraOptions.projectId),$.ajax({type:"post",url:"dgCenter/DgWapper.batchRefreshDgCover.json",data:{param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:r.type,param4:t},bdolxLoader:!1,dataType:"json",success(e){e.success?bdoSuccessBox("成功",e.resultInfo.statusText):bdoErrorBox("失败",e.resultInfo.statusText)}}),bdoInfoBox("请稍后，正在刷新底稿封面")},onEditAllClick(t){$("#programParamModal1").modal("show"),$("#programParamForm1").modal("show"),$("#programParamForm1").formview({display:"tableform-one",column:4,buttons:[{id:"tb_batchGenerate",icon:"fa-save",style:"btn-primary",text:"&nbsp;生成"},{id:"tb_batchclose",icon:"fa-sign-out",style:"btn-warning",text:"&nbsp;关闭"}],items:[{id:"tb_autoid",type:"input",typeAttr:{type:"hidden"}},{id:"generate_rule",type:"",label:"生成规则",html:'<label class="css-input css-radio css-radio-primary">生成底稿*：</label><label><input type="radio" name="batch_mater_use" id=have checked="checked">含财务数据<input type="radio" name="batch_mater_use" >不含财务数据</label>'}]}),$("#tb_batchclose").click(function(){$("#programParamModal1").modal("hide")}),$("#tb_batchGenerate").click(function(){var t={};t.accountSource=$("#have").prop("checked");var a=null;"SUBJECT"==r.type&&(a=r.extraOptions.autoId),"TBSUBJECT"==r.type&&(a=r.extraOptions.autoId),"PROJECT"==r.type&&(a=r.extraOptions.projectId),$.ajax({type:"post",url:"dgCenter/DgMain.batchGenerateProgram.json",data:{param1:r.type,param2:a,param3:t.accountSource},bdolxLoader:!1,dataType:"json",success(t){t.success?($("#auditProgramTable").DataTable().ajax.reload(),getSubjecttree({param1:window.CUR_PROJECTID,param2:$("#onlyMyselfCheckBox").get(0).checked?"1":""},t=>{$(".js-tree-collapsed").trigger("rebuild",[{data:[t.data[0].treeData],levels:r.deep+2,callback(t){t.expandNode(r.nodeId,{levels:r.deep+2,silent:!0}),t.selectNode(r.nodeId,{silent:!0}),r=e.data=t.getNode(r.nodeId)}}])}),bdoInfoBox("成功",t.resultInfo.statusText)):bdoErrorBox("失败",t.resultInfo.statusText)}}),bdoInfoBox("请稍后，正在生成实施程序和底稿"),$("#programParamModal1").modal("hide")}),$("#modalHideBtn").click(function(){$("#programParamModal1").modal("hide")}),$("#tb_close").click(function(){$("#programParamModal1").modal("hide")})},onAuditProgramTopClick(e){let t=$(e.currentTarget),a=$("i",t);a.toggleClass("si-arrow-up"),a.toggleClass("si-arrow-down"),$("#auditProgramEcavpTableBlock").toggle()},onNewAuditprogramClick(e){m.cusAuditprogramForm.jsonData={programNameAft:"",indexId:"",dgName:"",confirmStatusAft:"",draftTemplateName:[],draftTemplate:[],delTemplates:[],required:"0",customerId:r.extraOptions.customerId,projectId:r.extraOptions.projectId,subjecttreeId:r.extraOptions.autoId,autoId:null,csE:!1,csC:!1,csA:!1,csV:!1,csP:!1,sE:"",sC:"",sA:"",sV:"",sP:""},m.cusAuditprogramForm.process="add",m.cusAuditprogramFormSider.show()},onAddOtherProgramClick(e){m.searchForm.jsonData={s_departmentId:"",s_programName:"",s_subjectName:"",s_confirmStatus:"",s_stage:"",s_industry:"",s_dgName:"",s_indexId:"",s_confirmStatus:""},m.selectProgramSider.show(),m.selectProgramTableCfg.localParam.urlparam=m.getDefaultFilter(),BdoDataTable("selectProgramTable",m.selectProgramTableCfg)},onSelectOkClick(e){let t=$('input[name="apCheckbox"]:checked'),a=[];$.each(t,(e,t)=>{a.push(t.value)}),a.length<1?bdoErrorBox("","未选择数据！"):$.ajax({type:"post",url:"dgCenter/DgMain.addOtherProgram.json",data:{param1:a.join(","),param2:r.extraOptions.autoId,param3:r.extraOptions.customerId},dataType:"json",success(e){e.success?(bdoSuccessBox("成功",e.resultInfo.statusText),selectProgramSider.hide(),$("#auditProgramTable").DataTable().ajax.reload()):bdoErrorBox("失败",e.resultInfo.statusText)}})},onSelectCancelClick(e){m.selectProgramSider.hide()},onSearchClick(e){let t=searchForm.jsonData,a=[];$.each(t,(e,t)=>{if(t&&""!=t){let r=e.replace("s_",""),l={field:r,sqlIndex:"a."+r,type:"string",value:t,operate:"like"};switch(r){case"departmentId":l.operate="eq",l.type="number";break;default:l.operate="like"}a.push(l)}});let r=JSON.stringify(a);m.selectProgramTableCfg.localParam.urlparam.filter=r,$("#selectProgramTable").DataTable().ajax.reload()},onSearchResetClick(e){m.searchForm.jsonData={s_departmentId:"",s_programName:"",s_subjectName:"",s_confirmStatus:"",s_stage:"",s_industry:"",s_dgName:"",s_indexId:"",s_confirmStatus:""},m.selectProgramTableCfg.localParam.urlparam=m.getDefaultFilter(),$("#selectProgramTable").DataTable().ajax.reload()},onFilterChange(e){let t=null;switch($("#filter").val()){case"all":t=null;break;case"std":t=0;break;case"sub":t=1}m.auditProgramTableCfg.localParam.urlparam.param5=t,$("#auditProgramTable").DataTable().ajax.reload()},onFilterEditorChange(e){let t=$("#filterEditor2 option:selected").val();m.auditProgramTableCfg.localParam.urlparam.param8=t,$("#auditProgramTable").DataTable().ajax.reload()},queryGroupMembers(){$.ajax({type:"post",url:"dgCenter/DgProject.getProjectMember.json",data:{param1:window.CUR_PROJECTID,param2:window.CUR_CUSTOMERID},dataType:"json",success(e){if(e.success){var t="";m.selectEditors=e.data.map(e=>({id:e.id,text:e.name,value:e.name})),t='<option value="" selected="selected"></option>',$.each(e.data,function(e,a){t+='<option value="'+a.id+'" style="color: #000">'+a.name+"</option>"}),$("#filterEditor2").html(t)}}})},init(e){(new Date).getTime();let t=this;var a;"SUBJECT"==r.type?($("#newAuditprogramBtn").show(),$("#addOtherProgramBtn").show()):($("#newAuditprogramBtn").hide(),$("#addOtherProgramBtn").hide()),BdoDataTable("auditProgramTable",this.auditProgramTableCfg),BdoDataTable("unexecuteprogamTable",this.unexecuteprogamTableCfg),$("#auditProgramTable").on("xhr.dt",function(e,a,l){i=0,d=0,c=new Array(l.recordsTotal),u={},Promise.resolve().then(()=>{t.getECAVPSummery(r,t.getECAVPCallback.bind(t)),t.getProgramCount(r,t.getProgramCountCallback.bind(t))})}),$("#auditProgramTable_wrapper").on("click",'a[class="tableRefresh"]',function(){var e=r.nodeId,t=r.parentId,l=r.extraOptions.autoId;$.ajax({url:"dgCenter/DgMain.getSubjecttree.json",type:"post",data:{param1:window.CUR_PROJECTID},dataType:"json",success(s){s.success&&(!function e(t,r){if(t.extraOptions.autoId==r&&(a=t),null!=t.nodes)for(var l=0;l<t.nodes.length;l++)e(t.nodes[l],r)}(s.data[0].treeData.nodes[3],l),a&&((r=a).nodeId=e,r.parentId=t))}})}),this.bindTableOptEvents(),this.unexecuteFormSider=side({el:"#unexecuteFormSider"}),this.auditFormSider=side({el:"#auditFormSider"}),this.viewProgramSider=side({el:"#viewProgramSider"}),this.cusAuditprogramFormSider=side({el:"#cusAuditprogramFormSider",afterHide(){t.cusAuditprogramForm.process}}),this.selectProgramSider=side({el:"#selectProgramSider"}),this.unexecuteForm=createForm(this.unexecuteFormCfg),this.auditForm=createForm(this.auditFormCfg),this.cusAuditprogramForm=createForm(this.cusAuditprogramFormCfg),this.uploadWorkpagerPage=createForm(this.uploadWorkpagerPageCfg),this.editAuditprogramFormSider=side({el:"#editAuditprogramFormSider"}),this.editAuditprogramForm=createForm(this.editAuditprogramFormCfg),this.editSubProgramForm=createForm(this.editSubProgramFormCfg),$("#saveSubProgramClickBtn").text("保存"),$("#cancelSubProgramClicktBtn").text("关闭"),this.editSubProgramSider=side({el:"#editSubProgramSider",afterHide(){t.editSubProgramForm.process=""}}),this.dgAttachSider=side({el:"#dgAttachSider"}),this.searchForm=createForm(this.searchFormCfg),OneUI.initHelper("slimscroll"),this.queryGroupMembers()},getECAVPCallback(e){let t={pplansE:0,pplansC:0,pplansA:0,pplansV:0,pplansP:0,splansE:0,splansC:0,splansA:0,splansV:0,splansP:0,implE:0,implC:0,implA:0,implV:0,implP:0};e.data&&$.each(e.data,(e,a)=>{"PROGRAMP"==a.type&&(t.pplansE+=a.plansE,t.pplansC+=a.plansC,t.pplansA+=a.plansA,t.pplansV+=a.plansV,t.pplansP+=a.plansP,t.implE+=a.sE,t.implC+=a.sC,t.implA+=a.sA,t.implV+=a.sV,t.implP+=a.sP),"SUBJECTP"==a.type&&(t.splansE+=a.plansE,t.splansC+=a.plansC,t.splansA+=a.plansA,t.splansV+=a.plansV,t.splansP+=a.plansP)}),this.setSummery(t)},getECAVPSummery(e,t){let a={menuId:window.sys_menuId,sqlId:"DG00028",start:-1,limit:-1};a.param1=e.extraOptions.autoId,a.param2=e.extraOptions.nodeType,a.param3=e.extraOptions.customerId,a.param4=e.extraOptions.projectId,a.param8=window.CUR_PROJECT_ACC_YEAR,"TBSUBJECT"!=e.extraOptions.nodeType&&"SUBJECT"!=e.extraOptions.nodeType||(a.param9=e.extraOptions.tbSubjectCode),"SUBJECT"==e.extraOptions.nodeType&&(a.param6=e.extraOptions.userSubjectId,a.param7=e.extraOptions.userSubjectName),$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",data:a,dataType:"json",success(e){t&&t(e)}})},getProgramCountCallback(e){let t=e.data[0];$.each(t,(e,t)=>$("#"+e).text((e=>e||0)(t)))},getProgramCount(e,t){let a={menuId:window.sys_menuId,sqlId:"DG00065",param1:e.extraOptions.customerId,param2:e.extraOptions.projectId,param3:"1",param8:$("#filterEditor2 option:selected").val(),page:0,start:-1,limit:-1};"SUBJECT"==e.extraOptions.nodeType&&(a.param4=e.extraOptions.autoId),"TBSUBJECT"==e.extraOptions.nodeType&&(a.param5=e.extraOptions.autoId),"PROJECT"==e.extraOptions.nodeType&&(a.param6=e.extraOptions.autoId),$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",data:a,dataType:"json",success(e){t&&t(e)}})},dgAttachSider:null,auditProgramTable:null,bgColerMap:{},auditProgramTableCfg:{localParam:{url:"dgCenter/DgGeneral.query.json",urlparam:(()=>{let e={menuId:window.sys_menuId,sqlId:"DG00005",param3:"1",param6:r.extraOptions.customerId,param8:$("#filterEditor2 option:selected").val()};return"SUBJECT"==r.type&&(e.param1=r.extraOptions.autoId),"TBSUBJECT"==r.type&&(e.param2=r.extraOptions.autoId),"PROJECT"==r.type&&(e.param4=r.extraOptions.projectId),e})(),tabNum:!1},tableParam:{select:!0,ordering:!1,serverSide:!0,autoWidth:!0,scrollY:500,scrollX:!0,paging:!0,fixedColumns:!0,bdoCustomizeColumns:!0,drawCallback(e){let t=this;$.each(c,(e,t)=>{t?$('.ribbon-box[data-ribbon-row="'+e+'"]',this).text(t):$('.ribbon-box[data-ribbon-row="'+e+'"]',this).hide()}),t.drawDtTimer&&clearTimeout(t.drawDtTimer),this.drawDtTimer=setTimeout(function(){let a=t.fnGetData();$("#auditProgramTable tbody").replaceWith(e.nTBody),$("#auditProgramTable").trigger("initEditVm",[a]),clearTimeout(t.drawDtTimer),t.drawDtTimer=!1},1e3)},createdRow(e,t,a){let r="";0==a&&(m.bgColerMap={}),t.level<1?(m.bgColerMap[t.autoId]={level:t.level,departmentId:t.departmentId,customizeFlag:t.customizeFlag},r="1"==t.customizeFlag?"bg-warning":t.departmentId==BdoFaithConsts.DEPARTMENT_BDO?"bg-info":"bg-success"):r="bg-standard",$(e).find("td:eq(3)").addClass(r),$(e).find("td:eq(4)").addClass(r),0==t.level?$(e).addClass("program-level-0"):1==t.level&&($(e).addClass("program-level-1").show(),$(e).attr("data-program-parent-id",t.parentId))},columnDefs:[{targets:(()=>(i=0,++i))(),orderable:!1,title:"序号",width:"80px",data:null,className:"text-center font-16 ribbon ribbon-right",render(e,t,a,r){let l="";return 0==a.level?l=(l=++d)+'<div class="ribbon-box bg-standard" data-ribbon-row="'+(l-1)+'" style="top: 0;padding: 0 3px;height: 16px;line-height: 16px;"></div><i class="program-level-0opt btn fa fa-minus-circle" data-program-id="'+a.autoId+'"></i>':(c[d-1]?c[d-1]++:c[d-1]=1,l=d+"-"+c[d-1]),l}},{targets:++i,orderable:!1,className:"text-center",title:"处理",data:null,width:"150px",render(e,t,a,r){let l="";return l+='<div class="">',0==a.level?l+='<button class="btn btn-xs btn-success table-btn-operate bdo-drop-btn" type="button" name="optNewSubProgramBtn" data-placement="top" title="添加实施程序" data-toggle="tooltip" data-row="'+r.row+'">\t<i class="fa fa-plus-square"></i>\t</button>':(l+='<button class="btn btn-xs btn-warning table-btn-operate bdo-drop-btn" type="button" name="optEditBtn" data-placement="top" title="编辑" data-toggle="tooltip" data-row="'+r.row+'">\t<i class="fa fa-edit"></i>\t</button>',a.workpaperId&&""!=a.workpaperId&&(l+='<button class="btn btn-xs btn-success table-btn-operate" type="button" name="optOpenExcelBtn" data-placement="top" title="底稿" data-toggle="tooltip" data-row="'+r.row+'">\t<i class="fa fa-file-excel-o"></i>\t</button>')),l+='<button class="btn btn-xs btn-info table-btn-operate bdo-drop-btn" type="button" name="operate" data-placement="top" title="更多操作" data-toggle="tooltip" data-row="'+r.row+'">\t<i class="fa fa-gear"></i>\t</button>',l+="</div>"}},{targets:++i,orderable:!1,title:"索引号",name:"indexId",data:"indexId",width:"50px",className:"dg-ap"},{targets:++i,orderable:!1,title:"程序名称",name:"dgName",data:"dgName",width:"150px",className:"dg-ap"},{targets:++i,orderable:!1,title:"程序内容",name:"programNameAft",data:"programNameAft",width:"300px",className:"dg-ap",render(e,t,a,r){let l="";if("1"==a.updateFlag&&e!=a.programNamePre&&(l="red"),a.programNameAft&&a.programNameAft.length>0&&(a.programNameAft=a.programNameAft.replace(/<span class=\"ap-name-color\" style=\"color: white;background-color: #AACD97;\">/g,"").replace(/<\/span>/g,"")),a.programNameAftCache=a.programNameAft,0==a.level)u[""+a.autoId]=a;else{let t=u[""+a.parentId];if(t&&t.programNameAft&&t.programNameAft.length>0&&a.programNameAft&&a.programNameAft.length>0){let r=a.programNameAft.split("\n");$.each(r,(e,a)=>{-1==t.programNameAft.indexOf(a)&&(r[e]='<span class="ap-name-color" style="color: white;background-color: #AACD97;">'+a+"</span>")}),e=a.programNameAft=r.join("\n")}}return'<pre class="dg" style="color: '+l+';height: 100%; width: 300px;">'+e+"</pre>"}},{targets:++i,orderable:!1,title:"审计结论",name:"auditConclusion",data:"auditConclusion",width:"300px",className:"dg-ap"},{targets:++i,title:"E",name:"E",data:"csE",width:"30px",className:"text-center",render:(e,a,r,l)=>t(e,r.sE,r.csEOriginal,r.sEOriginal,r.updateFlag)},{targets:++i,title:"C",name:"C",data:"csC",width:"30px",className:"text-center",render:(e,a,r,l)=>t(e,r.sC,r.csCOriginal,r.sCOriginal,r.updateFlag)},{targets:++i,title:"A",name:"A",data:"csA",width:"30px",className:"text-center",render:(e,a,r,l)=>t(e,r.sA,r.csAOriginal,r.sAOriginal,r.updateFlag)},{targets:++i,title:"V",name:"V",data:"csV",width:"30px",className:"text-center",render:(e,a,r,l)=>t(e,r.sV,r.csVOriginal,r.sVOriginal,r.updateFlag)},{targets:++i,title:"P",name:"P",data:"csP",width:"30px",className:"text-center",render:(e,a,r,l)=>t(e,r.sP,r.csPOriginal,r.sPOriginal,r.updateFlag)},{targets:++i,orderable:!1,title:"部门",name:"__ddepartmentIdName",data:"__ddepartmentIdName",width:"100px",className:"dg-ap"},{targets:++i,orderable:!1,className:"text-center",title:"底稿编制人",name:"__uworkpaperEditor",data:"__uworkpaperEditor",width:"90px",className:"dg-ap",render(e,t,a,r){let l;return $.isPlainObject(a.__uworkpaperEditor)&&(l=a.__uworkpaperEditor.userId),function(e,t){return'<edit-man-edit :datas="editMans" :program-info="rowData['+t+']" :rownum="'+t+'" :current-value="\''+e+"'\"></edit-man-edit>"}(l,r.row)}},{targets:++i,orderable:!1,className:"text-center",title:"复核人",name:"__urecheckUserName",data:"__urecheckUserName",width:"90px",className:"dg-ap"}]}},unexecuteprogamTable:null,unexecuteprogamTableCfg:{localParam:{url:"dgCenter/DgGeneral.query.json",urlparam:(()=>{let e={menuId:window.sys_menuId,sqlId:"DG00005",param3:"0",param6:r.extraOptions.customerId};return"SUBJECT"==r.type&&(e.param1=r.extraOptions.autoId),"TBSUBJECT"==r.type&&(e.param2=r.extraOptions.autoId),"PROJECT"==r.type&&(e.param4=r.extraOptions.projectId),e})(),tabNum:!0},tableParam:{select:!0,ordering:!1,serverSide:!0,autoWidth:!0,scrollY:500,scrollX:!0,scrollCollapse:!0,paging:!0,fixedColumns:!0,columnDefs:[{targets:(()=>(i=0,++i))(),orderable:!1,className:"text-center",title:"处理",data:null,width:"30px",render(e,t,a,r){let l="";return l+='<div class="">',l+='<button class="btn btn-xs btn-success table-btn-operate bdo-drop-btn" type="button" name="optToExcProgramBtn" data-placement="top" title="执行" data-toggle="tooltip" data-row="'+r.row+'">\t<i class="fa fa-share-square-o"></i>\t</button>',l+="</div>"}},{targets:++i,orderable:!0,title:"索引号",name:"indexId",data:"indexId",width:"50px",className:"dg-ap"},{targets:++i,orderable:!0,title:"程序名称",name:"dgName",data:"dgName",width:"150px",className:"dg-ap"},{targets:++i,orderable:!0,title:"程序内容",name:"programNameAft",data:"programNameAft",width:"300px",className:"dg-ap",render:(e,t,a,r)=>'<pre class="dg" style="height:100%">'+e+"</pre>"},{targets:++i,orderable:!0,title:"不执行理由",name:"reason",data:"reason",width:"300px",className:"dg-ap"},{targets:++i,title:"E",name:"E",data:"csE",width:"30px",className:"text-center",render:(e,a,r,l)=>t(e,r.sE,r.csEOriginal,r.sEOriginal,r.updateFlag)},{targets:++i,title:"C",name:"C",data:"csC",width:"30px",className:"text-center",render:(e,a,r,l)=>t(e,r.sC,r.csCOriginal,r.sCOriginal,r.updateFlag)},{targets:++i,title:"A",name:"A",data:"csA",width:"30px",className:"text-center",render:(e,a,r,l)=>t(e,r.sA,r.csAOriginal,r.sAOriginal,r.updateFlag)},{targets:++i,title:"V",name:"V",data:"csV",width:"30px",className:"text-center",render:(e,a,r,l)=>t(e,r.sV,r.csVOriginal,r.sVOriginal,r.updateFlag)},{targets:++i,title:"P",name:"P",data:"csP",width:"30px",className:"text-center",render:(e,a,r,l)=>t(e,r.sP,r.csPOriginal,r.sPOriginal,r.updateFlag)},{targets:++i,orderable:!0,title:"部门",name:"__ddepartmentIdName",data:"__ddepartmentIdName",width:"200px",className:"dg-ap"},{targets:++i,orderable:!0,className:"text-center",title:"创建人",name:"__ucreateUserName",data:"__ucreateUserName",width:"90px",className:"dg-ap"},{targets:++i,orderable:!0,className:"text-center",title:"复核人",name:"recheckUser",data:"recheckUser",width:"90px",className:"dg-ap"}]}},unexecuteFormSider:null,auditFormSider:null,viewProgramSider:null,unexecuteFormCfg:{options:{propsData:{jsonData:{autoId:null,customerId:null,reason:""}}},props:{jsonData:Object},display:"tableform-one",column:1,id:"unexecuteForm",data:()=>({ajaxConfig:{type:"POST",url:"dgCenter/DgMain.setUnexecuteProgram.json",dataType:"json",success(e){e.success?(bdoSuccessBox("成功",e.resultInfo.statusText),m.unexecuteFormSider.hide(),$("#auditProgramTable").DataTable().ajax.reload(),$("#unexecuteprogamTable").DataTable().ajax.reload()):bdoErrorBox("失败",e.resultInfo.statusText)}}}),methods:{onSetUnexecuteProgramClick(e){this.submit(!0)},onCancelClick(){m.unexecuteFormSider.hide()}},buttons:[{id:"setUnexecuteProgramBtn",icon:"fa-floppy-o",style:"btn-primary",text:"提交",typeAttr:{"v-on:click":"onSetUnexecuteProgramClick"}},{id:"cancelSetUnexecuteProgramBtn",icon:"fa-arrow-left",style:"btn-warning",text:"取消",typeAttr:{"v-on:click":"onCancelClick"}}],items:[{id:"reason",type:"textarea",label:"不执行理由",rowspan:1,colspan:1,validate:{rules:{required:!0}},typeAttr:{rows:5},show:!0}]},unexecuteForm:null,auditFormCfg:{options:{propsData:{jsonData:{remark:""}}},props:{jsonData:Object},display:"tableform-one",column:1,id:"auditForm",data:()=>({ajaxConfig:{type:"POST",url:"demo/Spread.setUnexecuteProgram.json",dataType:"json",success(e){e.success?(bdoSuccessBox("成功",e.resultInfo.statusText),m.auditFormSider.hide()):bdoErrorBox("失败",e.resultInfo.statusText)}}}),methods:{onAuditAcceptClick(e){this.submit(!0)},onAuditFailedClick(e){this.submit(!0)},onCancelClick(){m.auditFormSider.hide()}},buttons:[{id:"auditAcceptBtn",icon:"fa-check-square-o",style:"btn-success",text:"通过",typeAttr:{"v-on:click":"onAuditAcceptClick"}},{id:"auditFailedBtn",icon:"fa-window-close-o",style:"btn-danger",text:"不通过",typeAttr:{"v-on:click":"onAuditFailedClick"}},{id:"cancelAuditBtn",icon:"fa-arrow-left",style:"btn-warning",text:"取消",typeAttr:{"v-on:click":"onCancelClick"}}],items:[{id:"remark",type:"textarea",label:"备注",rowspan:1,colspan:1,validate:{rules:{}},typeAttr:{rows:5},show:!0}]},auditForm:null,uploadWorkpagerPageCfg:{options:{propsData:{jsonData:{workpager:[],subjecttreeId:"",autoId:null,subjecttreeId:null,customerId:null}}},props:{jsonData:Object},display:"tableform-one",column:1,id:"uploadTplForm",data:()=>({ajaxConfig:{type:"POST",url:"dgCenter/DgWapper.queryTagOrLinkExistence.json",dataType:"json",success(t){if(t.success){let d=()=>{var a=t.data[0].paramMap,l=t.data[0].keyListMap;$.ajax({url:"dgCenter/DgWapper.uploadWorkpaper.json",type:"POST",data:{param1:JSON.stringify(a),param2:JSON.stringify(l)},dataType:"json",success(t){if(t.success){bdoSuccessBox("成功",t.resultInfo.statusText),$("#uploadTplFormModal").modal("hide"),getSubjecttree({param1:window.CUR_PROJECTID,param2:$("#onlyMyselfCheckBox").get(0).checked?"1":""},t=>{$(".js-tree-collapsed").trigger("rebuild",[{data:[t.data[0].treeData],levels:r.deep+2,callback(t){t.expandNode(r.nodeId,{levels:r.deep+2,silent:!0}),t.selectNode(r.nodeId,{silent:!0}),r=e.data=t.getNode(r.nodeId)}}])}),$("#auditProgramTable").DataTable().ajax.reload();var a=window.localStorage;storageId="BDO"+t.data[0].workpaperId,storageStatus="BDO"+t.data[0].workpaperId+"Status",storageTime="BDO"+t.data[0].workpaperId+"Time",a.removeItem(storageId),a.removeItem(storageStatus),a.removeItem(storageTime),$.ajax({url:"dgCenter/DgWapper.checkDgFormula.json",type:"post",data:{param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:"DG",param4:t.data[0].workpaperId},dataType:"json",success(e){e.success||bdoErrorBox(e.resultInfo.statusText)}})}else if(t.data&&t.data[0]&&t.data[0].extraLinkList){var l='上传的文件中，存在&nbsp;<font color="red">'+t.data[0].extraLinkList.length+"</font>&nbsp;处外部文件链接！";for(var s of t.data[0].extraLinkList)l=(l=l+'<br>sheet名称：<font color="red">'+s.substring(0,s.indexOf(":"))+"</font>")+'&nbsp;&nbsp;单元格位置：<font color="red">'+s.substring(s.indexOf(":")+1)+"</font>";bdoErrorBox("失败",l)}else bdoErrorBox("失败",t.resultInfo.statusText)}})};var a=t.data[0].dataListMap;if(a){var l=[],s='<div style="height: 250px;overflow-y: auto"><font color="red">';for(var o in a){var n=a[o];if(-1!=o.indexOf("标签:")){s+="标签:"+n+"<br>";var i='"'+n.substring(11,n.indexOf("单元格位置")-1)+'"sheet';-1==l.indexOf(i)&&l.push(i)}else{s+="单向链接:"+n+"<br>";var i="第"+n.substring(12,n.indexOf("单元格位置")-1)+"个sheet";-1==l.indexOf(i)&&l.push(i)}}s=(i="<div>该上传底稿文件对比原底稿文件,缺少原底稿文件中的"+l.join("、")+"</div><br>")+"此次上传底稿将会删除以下标签或单向链接 <br>"+(s+="</font></div>")+"<br>是否确定上传？",bdoConfirmBox("提示",s,e=>{d()})}else d()}else bdoErrorBox("失败",t.resultInfo.statusText)}}}),methods:{onUploadDraftFileClick(e){let t=$("#workpager").fileinput("getFileStack");if(!t||t.length<1)return void bdoInfoBox("提示","请选择导入文件");let a=!0;$.each(t,function(e,t){/.xlsx/.test(t.name)||(a=!1)}),a?this.uploadFile(!0):bdoInfoBox("提示","不正确的文件扩展名.只支持'xlsx'的文件扩展名.")}},buttons:[{id:"uploadDraftFileBtn",icon:"fa-floppy-o",style:"btn-primary",text:"上传",typeAttr:{"v-on:click":"onUploadDraftFileClick"}},{id:"cancelUploadDraftFileBtn",icon:"fa-arrow-left",style:"btn-warning",text:"取消",typeAttr:{"data-dismiss":"modal"}}],items:[{id:"workpager",type:"file",label:"底稿",rowspan:1,colspan:2,validate:{rules:{}},show:!0,plugin:{name:"fileinput",options:{uploadUrl:"dgCenter/DgDownload.uploadTempFile.json",allowedFileExtensions:["xlsx"],maxFilesNum:1,uploadExtraData:()=>({})}}}]},uploadWorkpagerPage:null,tplEditComp:{el:"#draftTemplateName",template:'<ul class="list-group" style="padding: 10px 5px;">\t\t\t<li class="list-group-item"\t\t\t\tv-for="(file, index) in fileList"\t\t\t\t:fileId="file.autoId"\t\t\t>\t\t\t\t<span class="icon fa fa-file-excel-o text-primary-light"></span>\t\t\t\t{{file.fileName}}\t\t\t\t<span class="fa fa-close text-danger pull-right" @click="onDelTplFileClick" :data-index="index" v-show="delBtnShow"></span>\t\t\t</li>\t\t</ul>',data:()=>({fileList:[],delBtnShow:!1}),methods:{onDelTplFileClick(e){let t=this,a=$(e.currentTarget).attr("data-index");bdoConfirmBox("提示","确定删除该模板文件吗？",e=>{m.cusAuditprogramForm.jsonData.delTemplates.push(t.fileList[a].autoId),t.fileList.splice(a,1)})}}},cusAuditprogramFormSider:null,cusAuditprogramFormCfg:{options:{propsData:{jsonData:{programNameAft:"",indexId:"",dgName:"",confirmStatusAft:"",confirmStatusAftName:"",draftTemplateName:[],draftTemplate:[],delTemplates:[],required:"",customerId:r.extraOptions.customerId,projectId:r.extraOptions.projectId,subjecttreeId:r.extraOptions.autoId,autoId:null,customerId:null,csE:!1,csC:!1,csA:!1,csV:!1,csP:!1,sE:"",sC:"",sA:"",sV:"",sP:""}}},computed:{"jsonData.programNamePre"(){return this.jsonData.programNameAft},"jsonData.confirmStatusPre"(){return this.jsonData.confirmStatusAft}},props:{jsonData:Object},display:"tableform-one",column:2,id:"cusAuditprogramForm",data:()=>({ajaxConfig:{type:"POST",url:"dgCenter/DgMain.addCusAuditProgram.json",dataType:"json",success(e){e.success?(m.cusAuditprogramFormSider.hide(),bdoSuccessBox("成功",e.resultInfo.statusText),$("#auditProgramTable").DataTable().ajax.reload(),this.process=""):bdoErrorBox("失败",e.resultInfo.statusText)}},process:"add"}),computed:{checkboxGroupClass(){return 1==this.formItem.confirmGrop.readonly?"css-input css-input-disabled css-checkbox css-checkbox-primary control-label":"css-input css-checkbox css-checkbox-primary control-label"},scoreReadonly(){return this.formItem.confirmGrop.readonly}},watch:{process(e,t){let a=this;!1===e?(this.setAllReadonly(!0),this.formItem.draftTemplateName.show=!0,this.formItem.draftTemplate.show=!1,this.formItem.confirmGrop.readonly=!0):(this.setAllReadonly(!1),this.formItem.draftTemplateName.show=!1,this.formItem.draftTemplate.show=!0,this.formItem.confirmGrop.readonly=!1),"edit"!=e&&!1!==e||(null==this.tplEditComp&&(this.tplEditComp=new Vue(tplEditComp)),this.tplEditComp.delBtnShow="edit"==e,this.jsonData.delTemplates=[],this.$nextTick(()=>{this.formItem.draftTemplateName.show=!0,$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",data:{menuId:window.sys_menuId,sqlId:"DG00010",param1:this.jsonData.autoId},dataType:"json",success(e){e.success&&(a.tplEditComp.fileList=e.data)}})}))}},tplEditComp:null,methods:{onSaveAudtiprogramClick(e){if(!this.$form.valid())return;"add"==this.process?this.ajaxConfig.url="dgCenter/DgMain.addCusAuditProgram.json":"edit"==this.process&&(this.ajaxConfig.url="dgCenter/DgMain.updateCusAuditProgram.json");let t={};$.each(this.jsonData,(e,a)=>{let r=e;t[r]=a,r.startsWith("cs")&&(t[r]=m.booleanTranslate(a,!0))}),["E","C","A","V","P"].map(e=>1==t["cs"+e]?t["s"+e]&&""!=t["s"+e]&&t["s"+e]>0:!t["s"+e]||""==t["s"+e]||t["s"+e]>0||t["s"+e]<0).filter(e=>!1===e).length>0?this.$form.vail():this.uploadFile(!0,{jsonData:JSON.stringify(t)})},onCancelClick(e){m.cusAuditprogramFormSider.hide()},openEditPage(){null==this.tplEditComp&&(this.tplEditComp=new Vue(tplEditComp)),this.tplEditComp.delBtnShow="edit"==this.process,this.jsonData.delTemplates=[],this.$nextTick(()=>{this.formItem.draftTemplateName.show=!0,$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",data:{menuId:window.sys_menuId,sqlId:"DG00010",param1:this.jsonData.autoId},dataType:"json",success(e){e.success&&(pvm.tplEditComp.fileList=e.data)}})})}},buttons:[{id:"saveCusAudtiprogramBtn",icon:"fa-floppy-o",style:"btn-primary",text:"保存",typeAttr:{"v-on:click":"onSaveAudtiprogramClick","v-show":"process"}},{id:"cancelCusFormBtn",icon:"fa-arrow-left",style:"btn-warning",text:"取消",typeAttr:{"v-on:click":"onCancelClick"}}],items:[{id:"dgName",type:"input",label:"程序名称",rowspan:1,colspan:2,validate:{rules:{required:!0}}},{id:"indexId",type:"input",label:"索引号",rowspan:1,colspan:1,validate:{rules:{required:!0}}},{id:"required",type:"combo",label:"是否必须",colspan:1,value:"0",validate:{rules:{required:!0}},plugin:{name:"combo",options:{noneSelectedText:"请选择",width:"250px"},stores:()=>ComboLabelValueDicData(!1,"boolean")}},{id:"confirmGrop",html:'\n\t\t\t\t\t<div class="form-material"><label>认定</label></div>\n\t\t\t\t\t<div class="row">\n\t\t\t\t\t<ecavp-comp :prefixed="\'\'" :label-name="\'E\'" :ecs-val="jsonData.csV" :es-val="jsonData.sE" :group-readonly="true"></ecavp-comp>\n\t\t\t\t\t<ecavp-comp :prefixed="\'\'" :label-name="\'C\'" :ecs-val="jsonData.csC" :es-val="jsonData.sC" :group-readonly="true"></ecavp-comp>\n\t\t\t\t\t<ecavp-comp :prefixed="\'\'" :label-name="\'A\'" :ecs-val="jsonData.csA" :es-val="jsonData.sA" :group-readonly="true"></ecavp-comp>\n\t\t\t\t\t<ecavp-comp :prefixed="\'\'" :label-name="\'V\'" :ecs-val="jsonData.csV" :es-val="jsonData.sV" :group-readonly="true"></ecavp-comp>\n\t\t\t\t\t<ecavp-comp :prefixed="\'\'" :label-name="\'P\'" :ecs-val="jsonData.csP" :es-val="jsonData.sP" :group-readonly="true"></ecavp-comp>\n\t\t\t\t\t</div></div>\n\t\t\t\t',rowspan:1,colspan:2,readonly:!1},{id:"programNameAft",type:"textarea",label:"程序内容",rowspan:1,colspan:2,typeAttr:{rows:5},validate:{rules:{required:!0}}},{id:"draftTemplateName",type:"div",label:"已上传底稿模板",rowspan:1,colspan:2,validate:{rules:{}},show:!1},{id:"draftTemplate",type:"file",label:"底稿模板",rowspan:1,colspan:2,validate:{rules:{}},show:!0,plugin:{name:"fileinput",options:{uploadUrl:"dgCenter/DgDownload.uploadTempFile.json",allowedFileExtensions:["xlsx"],maxFilesNum:1,uploadExtraData:()=>({})}}}]},cusAuditprogramForm:null,selectProgramSider:null,selectProgramTable:null,selectProgramTableCfg:{localParam:{url:"dgCenter/DgGeneral.query.json",urlparam:{menuId:window.sys_menuId,sqlId:"DG00009"},tabNum:!0},tableParam:{scrollX:!0,select:!0,ordering:!0,order:[2,"asc"],serverSide:!0,fixedThead:!0,fixedHeight:"480px",columnDefs:[{targets:(()=>(i=0,++i))(),orderable:!1,className:"text-center",title:"处理",data:null,width:"100px",render(e,t,a,r){let l="";return l+='<label class="css-input css-checkbox css-checkbox-primary">\t<input type="checkbox" id="apCheckbox" name="apCheckbox" value="'+a.autoId+'" data-row="'+r.row+'">\t<span></span></label>'}},{targets:++i,orderable:!0,title:"机构部门",name:"departmentId",data:"departmentId",width:"200px",render:(e,t,a,r)=>a.__ddepartmentIdName},{targets:++i,orderable:!0,title:"索引号",name:"indexId",data:"indexId",width:"150px"},{targets:++i,orderable:!0,title:"程序名称",name:"dgName",data:"dgName",width:"300px"},{targets:++i,orderable:!0,title:"程序内容",name:"programName",data:"programName",width:"300px"},{targets:++i,orderable:!0,title:"标准科目",name:"subject",width:"90px",render:(e,t,a,r)=>a.subjectId+"-"+a.subjectName},{targets:++i,orderable:!0,title:"阶段",name:"stage",data:"stage",width:"90px",render:(e,t,a,r)=>DicVal2Nm(e,"审计程序阶段")},{targets:++i,orderable:!0,title:"潜在风险说明",name:"potentialRisk",data:"potentialRisk",width:"200px"},{targets:++i,title:"E",name:"E",data:"csE",width:"30px",className:"text-center",render:(e,a,r,l)=>t(e,r.sE,r.csEOriginal,r.sEOriginal,r.updateFlag)},{targets:++i,title:"C",name:"C",data:"csC",width:"30px",className:"text-center",render:(e,a,r,l)=>t(e,r.sC,r.csCOriginal,r.sCOriginal,r.updateFlag)},{targets:++i,title:"A",name:"A",data:"csA",width:"30px",className:"text-center",render:(e,a,r,l)=>t(e,r.sA,r.csAOriginal,r.sAOriginal,r.updateFlag)},{targets:++i,title:"V",name:"V",data:"csV",width:"30px",className:"text-center",render:(e,a,r,l)=>t(e,r.sV,r.csVOriginal,r.sVOriginal,r.updateFlag)},{targets:++i,title:"P",name:"P",data:"csP",width:"30px",className:"text-center",render:(e,a,r,l)=>t(e,r.sP,r.csPOriginal,r.sPOriginal,r.updateFlag)},{targets:++i,orderable:!0,title:"行业",name:"industry",data:"industry",width:"150px",render(e,t,a,r){if("1"==a.allIndustryFlag)return e;var l=[],s=e&&e.split(",");return $.each(s,(e,t)=>{$.each(industryData,(e,a)=>{a.value==t&&l.push(a.label)})}),l}},{targets:++i,orderable:!0,title:"具体事项说明",name:"description",data:"description",width:"150px"},{targets:++i,orderable:!0,title:"是否必须",name:"required",data:"required",render:(e,t,a,r)=>DicVal2Nm(e,"boolean"),width:"150px"},{targets:++i,orderable:!0,title:"创建人",name:"createUser",data:"createUser",render:(e,t,a,r)=>a.__ucreateUser.userName,width:"150px"}]}},editAuditprogramFormSider:null,editAuditprogramFormCfg:{component:{"ecavp-comp":o},options:{propsData:{jsonData:{autoId:null,customerId:null,eindexId:"",edgName:"",eprogramName:"",econfirmStatus:"",programNameAft:"",confirmationAft:"",ecsE:!1,ecsC:!1,ecsA:!1,ecsV:!1,ecsP:!1,esE:"",esC:"",esA:"",esV:"",esP:""}}},props:{jsonData:Object},display:"tableform-one",column:2,id:"editAuditprogramForm",data:()=>({ajaxConfig:{type:"POST",url:"dgCenter/DgMain.editProgram.json",dataType:"json",success(e){e.success?(bdoSuccessBox("成功",e.resultInfo.statusText),$("#auditProgramTable").DataTable().ajax.reload(),m.editAuditprogramFormSider.hide()):bdoErrorBox("失败",e.resultInfo.statusText)}}}),computed:{checkboxGroupClass(){return 1==this.formItem.econfirmGrop.readonly?"css-input css-input-disabled css-checkbox css-checkbox-primary control-label":"css-input css-checkbox css-checkbox-primary control-label"},scoreReadonly(){return this.formItem.econfirmGrop.readonly}},methods:{onSaveAudtiprogramClick(e){let t=this.jsonData;this.ajaxConfig.url="dgCenter/DgMain.editProgram.json",t.programNameAft=this.jsonData.eprogramName,t.confirmStatusAft=this.jsonData.econfirmStatus,t.confirmStatusAftName=$("#econfirmStatus").val(),t.csE=m.booleanTranslate(this.jsonData.ecsE,!0),t.csC=m.booleanTranslate(this.jsonData.ecsC,!0),t.csA=m.booleanTranslate(this.jsonData.ecsA,!0),t.csV=m.booleanTranslate(this.jsonData.ecsV,!0),t.csP=m.booleanTranslate(this.jsonData.ecsP,!0),t.sE=this.jsonData.esE,t.sC=this.jsonData.esC,t.sA=this.jsonData.esA,t.sV=this.jsonData.esV,t.sP=this.jsonData.esP,["E","C","A","V","P"].map(e=>1==t["cs"+e]?t["s"+e]&&""!=t["s"+e]&&t["s"+e]>0:!t["s"+e]||""==t["s"+e]||t["s"+e]>0||t["s"+e]<0).filter(e=>!1===e).length>0?this.$form.vail():this.submit(!0,{jsonData:JSON.stringify(t)})},onCancelClick(e){m.editAuditprogramFormSider.hide()}},buttons:[{id:"saveAudtiprogramBtn",icon:"fa-floppy-o",style:"btn-primary",text:"保存",typeAttr:{"v-on:click":"onSaveAudtiprogramClick"}},{id:"cancelEditProgramtBtn",icon:"fa-arrow-left",style:"btn-warning",text:"取消",typeAttr:{"v-on:click":"onCancelClick"}}],items:[{id:"edgName",type:"input",label:"程序名称",rowspan:1,colspan:1,typeAttr:{readonly:!0}},{id:"eindexId",type:"input",label:"索引号",colspan:1,typeAttr:{readonly:!0}},{id:"eprogramName",type:"textarea",label:"程序内容",rowspan:1,colspan:2,typeAttr:{rows:5},validate:{rules:{required:!0}}},{id:"econfirmGrop",html:'\n\t\t\t\t\t<div class="form-material"><label>认定</label></div>\n\t\t\t\t\t<div class="row">\n\t\t\t\t\t<ecavp-comp :prefixed="\'e\'" :label-name="\'E\'" :ecs-val="jsonData.ecsE" :es-val="jsonData.esE" :group-readonly="formItem.econfirmGrop.readonly"></ecavp-comp>\n\t\t\t\t\t<ecavp-comp :prefixed="\'e\'" :label-name="\'C\'" :ecs-val="jsonData.ecsC" :es-val="jsonData.esC" :group-readonly="formItem.econfirmGrop.readonly"></ecavp-comp>\n\t\t\t\t\t<ecavp-comp :prefixed="\'e\'" :label-name="\'A\'" :ecs-val="jsonData.ecsA" :es-val="jsonData.esA" :group-readonly="formItem.econfirmGrop.readonly"></ecavp-comp>\n\t\t\t\t\t<ecavp-comp :prefixed="\'e\'" :label-name="\'V\'" :ecs-val="jsonData.ecsV" :es-val="jsonData.esV" :group-readonly="formItem.econfirmGrop.readonly"></ecavp-comp>\n\t\t\t\t\t<ecavp-comp :prefixed="\'e\'" :label-name="\'P\'" :ecs-val="jsonData.ecsP" :es-val="jsonData.esP" :group-readonly="formItem.econfirmGrop.readonly"></ecavp-comp>\n\t\t\t\t\t</div></div>\n\t\t\t\t',rowspan:1,colspan:2,readonly:!1}]},editAuditprogramForm:null,editSubProgramSider:null,editSubProgramForm:null,editSubProgramFormCfg:{options:{propsData:{jsonData:{autoId:null,customerId:null,projectId:null,subjecttreeId:null,parentId:null,level:1,pindexId:"",es_indexId:"",es_dgName:"",es_programNameAft:"",es_csE:!1,es_csC:!1,es_csA:!1,es_csV:!1,es_csP:!1,es_sE:"",es_sC:"",es_sA:"",es_sV:"",es_sP:"",workpaperId:null}}},props:{jsonData:Object},display:"tableform-one",column:2,id:"editSubProgramForm",data:()=>({ajaxConfig:{type:"POST",dataType:"json",success(e){}},process:""}),computed:{checkboxGroupClass(){return 1==this.formItem.es_confirmGrop.readonly?"css-input css-input-disabled css-checkbox css-checkbox-primary control-label":"css-input css-checkbox css-checkbox-primary control-label"},scoreReadonly(){return this.formItem.es_confirmGrop.readonly},indexIdStyle(){return"edit"==this.process?"display: inline-block;width: 100%;float: right;":"display: inline-block;width: 50%;float: right;"},pindexIdShow(){return"add"==this.process}},methods:{onSaveSubProgramClick(e){if(!this.$form.valid())return;"add"==this.process?(this.ajaxConfig.url="dgCenter/DgMain.addCusAuditProgram.json",this.jsonData.es_indexId=this.jsonData.pindexId+"-"+this.jsonData.es_indexId):"edit"==this.process&&(this.ajaxConfig.url="dgCenter/DgMain.updateCusAuditProgram.json");var t={};$.each(this.jsonData,(e,a)=>{let r=e.replace("es_","");t[r]=a,r.startsWith("cs")&&(t[r]=m.booleanTranslate(a,!0))}),["E","C","A","V","P"].map(e=>1==t["cs"+e]?t["s"+e]&&""!=t["s"+e]&&t["s"+e]>0:!t["s"+e]||""==t["s"+e]||t["s"+e]>0||t["s"+e]<0).filter(e=>!1===e).length>0?this.$form.vail():$.ajax({type:"post",url:this.ajaxConfig.url,data:{jsonData:JSON.stringify(t),param1:r.extraOptions.tbSubjectId},dataType:"json",success(e){e.success?(bdoSuccessBox("成功",e.resultInfo.statusText),m.editSubProgramSider.hide(),$("#auditProgramTable").DataTable().ajax.reload()):bdoErrorBox("失败",e.resultInfo.statusText)}})},onCancelClick(e){m.editSubProgramSider.hide()}},items:[{id:"saveSubProgramClickBtn",type:"button",rowspan:1,colspan:2,typeAttr:{"v-on:click":"onSaveSubProgramClick",style:"float: right; margin-top: 5px;color: #fff; background-color: #5c90d2; border-color: #3675c5;border-radius: 2px;"}},{id:"cancelSubProgramClicktBtn",type:"button",colspan:2,typeAttr:{"v-on:click":"onCancelClick",style:"float: right; margin-top: 5px;color: #fff; background-color: #f3b760; border-color: #f3b760;border-radius: 2px;"}},{id:"es_dgName",rowspan:1,colspan:1,html:'<div class="has-success"><div class="form-material"><input type="text" v-model="jsonData.es_dgName" :readonly="formItem.es_dgName.readonly"data-toggle="tooltip" data-placement="top" title="" autocomplete="off" id="es_dgName" name="es_dgName"class="form-control valid" aria-invalid="false"><label for="es_dgName">程序名称<span class="necessary">*</span></label></div></div>',validate:{rules:{required:!0}}},{id:"es_indexId",colspan:1,html:'<div class="has-success"><div class="form-material">\t<input type="text"\t\tv-model="jsonData.es_indexId"\t\tdata-toggle="tooltip"\t\tdata-placement="top"\t\ttitle="" autocomplete="off"\t\tid="es_indexId" name="es_indexId"\t\t:readonly="formItem.es_indexId.readonly"\t\tclass="form-control valid"\t\taria-invalid="false"\t\tv-bind:style="indexIdStyle"\t\tplaceholder="自动生成"\t>\t<span v-show="pindexIdShow" style="display: inline-block;float: right;padding: 6px 0px;line-height: 22px;text-align: right;">\t{{jsonData.pindexId}}-</span>\t<label for="es_indexId">索引号<span class="necessary">*</span></label></div></div>',typeAttr:{readonly:!0},validate:{rules:{}},readonly:!0},{id:"es_programNameAft",type:"textarea",label:"程序内容",rowspan:1,colspan:2,typeAttr:{rows:5},validate:{rules:{required:!0}}},{id:"es_confirmGrop",html:'\n\t\t\t\t\t<div class="form-material"><label>认定</label></div>\n\t\t\t\t\t<ecavp-comp :prefixed="\'es_\'" :label-name="\'E\'" :ecs-val="jsonData.es_csE" :es-val="jsonData.es_sE" :group-readonly="formItem.es_confirmGrop.readonly"></ecavp-comp>\n\t\t\t\t\t<ecavp-comp :prefixed="\'es_\'" :label-name="\'C\'" :ecs-val="jsonData.es_csC" :es-val="jsonData.es_sC" :group-readonly="formItem.es_confirmGrop.readonly"></ecavp-comp>\n\t\t\t\t\t<ecavp-comp :prefixed="\'es_\'" :label-name="\'A\'" :ecs-val="jsonData.es_csA" :es-val="jsonData.es_sA" :group-readonly="formItem.es_confirmGrop.readonly"></ecavp-comp>\n\t\t\t\t\t<ecavp-comp :prefixed="\'es_\'" :label-name="\'V\'" :ecs-val="jsonData.es_csV" :es-val="jsonData.es_sV" :group-readonly="formItem.es_confirmGrop.readonly"></ecavp-comp>\n\t\t\t\t\t<ecavp-comp :prefixed="\'es_\'" :label-name="\'P\'" :ecs-val="jsonData.es_csP" :es-val="jsonData.es_sP" :group-readonly="formItem.es_confirmGrop.readonly"></ecavp-comp>\n\t\t\t\t\t</div>\n\t\t\t\t',rowspan:1,colspan:2,readonly:!1}],watch:{process(e,t){this.formItem.es_dgName.readonly=!1,""==t&&void 0!=this.jsonData.workpaperId&&""!=this.jsonData.workpaperId&&(this.formItem.es_dgName.readonly=!0)}}},searchFormCfg:{options:{propsData:{jsonData:{s_departmentId:"",s_programName:"",s_subjectName:"",s_confirmStatus:"",s_stage:"",s_industry:"",s_dgName:"",s_indexId:"",s_confirmStatus:""}}},props:{jsonData:Object},display:"tableform-one",column:4,id:"searchForm",data:()=>({ajaxConfig:{type:"POST",url:"",dataType:"json",success(e){}}}),items:[{id:"s_departmentId",type:"treecombo",label:"机构部门",rowspan:1,colspan:1,plugin:{name:"treecombo",options:{url:"./base/TreeCommon.findDepartTree.json",params:{},view:{leafIcon:"fa fa-building text-flat",nodeIcon:"fa fa-bank text-primary-light",folderSelectable:!0,multiSelect:!1}}}},{id:"s_dgName",type:"input",label:"程序名称",colspan:1},{id:"s_programName",type:"input",label:"程序内容",colspan:1},{id:"s_indexId",type:"input",label:"索引号",colspan:1},{id:"s_subjectName",type:"input",label:"标准科目",rowspan:1,colspan:1},{id:"s_industry",type:"input",label:"行业",colspan:1},{id:"s_stage",type:"input",label:"阶段",colspan:1},{id:"s_confirmStatus",type:"input",label:"认定",colspan:1}]},searchForm:null,getDefaultFilter:()=>({menuId:window.sys_menuId,sqlId:"DG00009"}),booleanTranslate:(e,t)=>t?1==e?"1":"0":"1"==e,setSummery(e){$("#summeryE").empty().text(this.getNullVal(e.pplansE,0)),$("#summeryC").empty().text(this.getNullVal(e.pplansC,0)),$("#summeryA").empty().text(this.getNullVal(e.pplansA,0)),$("#summeryV").empty().text(this.getNullVal(e.pplansV,0)),$("#summeryP").empty().text(this.getNullVal(e.pplansP,0)),$("#subjectE").empty().text(this.getNullVal(e.splansE,0)),$("#subjectC").empty().text(this.getNullVal(e.splansC,0)),$("#subjectA").empty().text(this.getNullVal(e.splansA,0)),$("#subjectV").empty().text(this.getNullVal(e.splansV,0)),$("#subjectP").empty().text(this.getNullVal(e.splansP,0)),$("#implE").empty().text(this.getNullVal(e.implE,0)),$("#implC").empty().text(this.getNullVal(e.implC,0)),$("#implA").empty().text(this.getNullVal(e.implA,0)),$("#implV").empty().text(this.getNullVal(e.implV,0)),$("#implP").empty().text(this.getNullVal(e.implP,0));var t=(e,t,a)=>{let r=$("#"+a);e!=t?r.addClass("ecavp-different"):(r.removeClass("lightpink"),r.removeClass("ecavp-different"))};t(e.pplansE,e.splansE,"summeryE"),t(e.pplansC,e.splansC,"summeryC"),t(e.pplansA,e.splansA,"summeryA"),t(e.pplansV,e.splansV,"summeryV"),t(e.pplansP,e.splansP,"summeryP"),t(e.pplansE,e.implE,"implE"),t(e.pplansC,e.implC,"implC"),t(e.pplansA,e.implA,"implA"),t(e.pplansV,e.implV,"implV"),t(e.pplansP,e.implP,"implP")},apply(e,t){$.each(t,(t,a)=>{e[t]=a})},getNullVal:(e,t)=>null==e||void 0==e||""==e?t:e});return m}var GuidePage=e=>{var t,a,r,l,s,o;function n(e){e=e.replace("%","");return isNaN(e)?e+"%":"0.00"==e?"0.00%":e/100>0?'<span style="color:red;align=right;">'+e+"% ↑ </span>":e/100<0?'<span style="color:green;align=right;">'+e+"% ↓ </span>":e+"%"}t=e.template||tplLoader("dgCenter/html/dg/guide.html"),e.template=t,o=(()=>{$(".modal").draggable(),$("#guideTable").on("click","td",function(){if("subjectId"===$("#guideTable").DataTable().context[0].aoColumns[$(this).index()+1].name){var e=$("#guideTable").DataTable().row($(this).parents("tr")).data();$("#formulaMainSubjectId").val(e.subjectId),$("#formulaMainSubjectName").val(e.subjectId+"-"+e.subjectName),jQuery($('#formulaMainModal [data-toggle="tabs"] a:eq(0)')).tab("show"),$("#formulaMainModal").modal("show")}}),$("#refreshGuideTableBtn").click(e=>{$("#guideTable").DataTable().ajax.reload()}),$("#guideTable tbody").on("click","td button",function(){var t=$("#guideTable").dataTable().fnGetData($(this).attr("data-row")),a=t.subjectId,r=t.subjectName,l=this.parentElement.lastElementChild.textContent.replace(/,/g,""),s=$(this).parents("td").index()+1,o=$("#guideTable").DataTable().context[0].aoColumns[s],n=o.title;$("#aliasPosition").val(a+"-"+r+":"+n.replace(/[\+\-\=]/g,"")),$("#aliasValue").val(l),$("#subjectId").val(a),$("#subjectName").val(a+"-"+r),$("#baseSubjectId").val(e.data.extraOptions.tbSubjectCode),$("#tagType").val(o.name),$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",data:{menuId:window.sys_menuId,sqlId:"DG00082",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:$("#aliasPosition").val(),start:-1,limit:-1},dataType:"json",success(e){e.success&&0!==e.data.length?$("#customAlias").val(e.data[0].tagName):$("#customAlias").val($("#aliasPosition").val().substring(0,4)+$("#aliasPosition").val().substring($("#aliasPosition").val().indexOf(":")+1)),$("#tagSetModal").modal("show")}})}),$("#setTagBtn").click(e=>{if(""==$("#customAlias").val())return $("#customAlias").focus(),void bdoInfoBox("提示","请输入标签名");if(-1!=$("#customAlias").val().indexOf("+")||-1!=$("#customAlias").val().indexOf("-")||-1!=$("#customAlias").val().indexOf("="))return $("#customAlias").focus(),void bdoInfoBox("提示","标签名不能含有+、-、=");let t=[];t.push({type:"function",className:"cn.com.bdo.dgCenter.service.DgCommonService",methodName:"getTagValueFunction",customerId:window.CUR_CUSTOMERID,projectId:window.CUR_PROJECTID,yyyy:window.CUR_PROJECT_ACC_YEAR,subjectId:$("#subjectId").val(),subjectName:$("#subjectName").val(),baseSubjectId:$("#baseSubjectId").val(),field:$("#tagType").val()}),$.ajax({type:"post",url:"dgCenter/DgCheck.setTag.json",data:{menuId:window.sys_menuId,param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:$("#customAlias").val(),param4:$("#aliasValue").val(),param5:$("#aliasPosition").val(),param6:JSON.stringify(t),param8:"function",start:-1,limit:-1},dataType:"json",success(e){e.success?(bdoSuccessBox("成功",e.resultInfo.statusText),$("#tagSetModal").modal("hide")):($("#customAlias").focus(),bdoErrorBox("失败",e.resultInfo.statusText))}})}),$("#exportGuideTableBtn").click(t=>{var a=!0;$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",async:!1,data:{menuId:window.sys_menuId,sqlId:"DG00197",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,start:-1,limit:-1},dataType:"json",success(e){e.success&&sys_userId!=e.data[0].manager&&(a=!1)}}),a?"TBSUBJECT"==e.data.type&&$.ajax({url:"dgCenter/ExportOtherDg.exportGuideTbl.json",type:"post",data:{param1:e.data.extraOptions.customerId,param2:e.data.extraOptions.projectId,param3:e.data.extraOptions.autoId},dataType:"json",success:function(t){if(t.success){if(t.data&&t.data.length>0){let a=t.data[0].fileData,r=t.data[0].fileName,l=t.data[0].isNew;if(bdoInfoBox("成功",r+"导出成功！"),saveAs(dataURLtoFile(a,r),r),!l)return;getSubjecttree({param1:window.CUR_PROJECTID,param2:$("#onlyMyselfCheckBox").get(0).checked?"1":""},t=>{$(".js-tree-collapsed").trigger("rebuild",[{data:[t.data[0].treeData],levels:e.data.deep+2,callback(t){t.expandNode(e.data.nodeId,{levels:e.data.deep+2,silent:!0}),t.selectNode(e.data.nodeId,{silent:!0}),e.data=t.getNode(e.data.nodeId)}}])})}}else bdoErrorBox("失败",t.resultInfo&&t.resultInfo.statusText)}}):bdoInfoBox("提示","非项目负责人无权限导出导引表！")})}),l=window.CUR_PROJECT_END_YEAR,$.ajax({url:"dgCenter/DgAdjust.findProjectInfo.json",type:"post",data:{param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID},dataType:"json",success:function(e){e.data&&e.data[0].year&&(l=e.data[0].year)}}),s=(()=>{$(e.region).empty().append(t),"PROJECT"==e.data.type?BdoDataTable("guideTable",a):BdoDataTable("guideTable",r),o(),"TBSUBJECT"==e.data.type?$("#exportGuideTableBtn").show():$("#exportGuideTableBtn").hide()}),a={localParam:{url:"dgCenter/DgGeneral.query.json",urlparam:(()=>{let t={menuId:window.sys_menuId,sqlId:"DG00013",param1:e.data.extraOptions.projectId,param2:e.data.extraOptions.customerId,param5:window.CUR_PROJECT_ACC_YEAR};return"SUBJECT"==e.data.type&&(t.param3=e.data.extraOptions.userSubjectId,t.param4=e.data.extraOptions.tbSubjectName),"TBSUBJECT"==e.data.type&&(t.param4=e.data.extraOptions.tbSubjectName),t})(),tabNum:!0},tableParam:{select:!0,lengthChange:!1,ordering:!0,order:[],serverSide:!0,dom:'<"row"<"col-sm-12"tr>>',fixedThead:!0,fixedHeight:"500px",columnDefs:[{targets:1,orderable:!0,title:"科目编号",name:"userSubjectId",data:"userSubjectId",width:"60px"},{targets:2,orderable:!0,title:"科目名称",name:"userSubjectName",data:"userSubjectName",width:"100px"},{targets:3,className:"text-right",orderable:!0,title:"期初余额",name:"remain",data:"remain",width:"100px",render:function(e,t,a,r){return void 0==e?0:formatMoney(e)}},{targets:4,orderable:!0,className:"text-right",title:"借方发生额",name:"debitTotalOcc",data:"debitTotalOcc",width:"100px",render:function(e,t,a,r){return void 0==e?0:formatMoney(e)}},{targets:5,className:"text-right",orderable:!0,title:"贷方发生额",name:"creditTotalOcc",data:"creditTotalOcc",width:"100px",render:function(e,t,a,r){return void 0==e?0:formatMoney(e)}},{targets:6,className:"text-right",orderable:!0,title:"期末余额",name:"balance",data:"balance",width:"100px",render:function(e,t,a,r){return void 0==e?0:formatMoney(e)}},{targets:7,orderable:!0,title:"变化率",name:"rate",data:"rate",width:"50px",render:function(e,t,a,r){return n(e)}}],drawCallback(e){var t=$("#guideTable").dataTable().api(),a={remain:0,debitOcc:0,creditOcc:0,balance:0},r=t.rows().data();t.rows().every((e,t,l)=>{a.debitOcc+=parseFloat(r[e].debitTotalOcc),a.creditOcc+=parseFloat(r[e].creditTotalOcc),a.balance+=parseFloat(r[e].balance),a.remain+=parseFloat(r[e].remain)}),$("#guideTable").find("tbody");var l=$('<tr role="row" style=""></tr>'),s=$('<td class="text-center"></td>');s.text("汇总"),s.attr("colSpan",3),l.append(s);var o=$('<td class="text-right" >');o.html(formatMoney(a.remain.toFixed(2))),l.append(o);var i=$('<td class="text-right" >');i.html(formatMoney(a.debitOcc.toFixed(2))),l.append(i);var d=$('<td class="text-right">');d.html(formatMoney(a.creditOcc.toFixed(2))),l.append(d);var c=$('<td class="text-right">');c.html(formatMoney(a.balance.toFixed(2))),l.append(c);var u,m,p=$('<td class="text-left">');p.html(n((u=a.balance,m=a.remain,u=parseFloat(u),m=parseFloat(m),isNaN(u)||isNaN(m)?"-":u===m?"0.00%":m<=0?'<span style="color:red;align=right;">1000% ↑ </span>':n(Math.round((u-m)/m*1e4)/100..toFixed(2)+"%")))),l.append(p),$("#guideTable").find("tbody").append(l)}}},r={localParam:{url:"dgCenter/DgAdjust.findGuide.json",urlparam:{param1:e.data.extraOptions.userSubjectId,param2:e.data.extraOptions.tbSubjectCode,param3:e.data.type,param4:window.CUR_PROJECT_ACC_YEAR},tabNum:!1},tableParam:{select:!0,lengthChange:!1,dom:'<"row"<"col-sm-12"tr>>',serverSide:!0,fixedThead:!0,fixedHeight:"480px",columnDefs:[{targets:1,orderable:!1,title:"科目编号",name:"subjectId",data:"subjectId",width:"60px"},{targets:2,orderable:!1,title:"科目名称",name:"subjectName",data:"subjectName",width:"100px"},{targets:3,className:"text-right",orderable:!1,title:l-1+"年未审数",name:"preBefore",data:"preBefore",width:"100px",render:function(e,t,a,r){var l=void 0==e?0:formatMoney(e);return'<button class="btn btn-xs btn-default table-btn-operate bdo-drop-btn" type="button" style="float: left;" data-placement="top" title="设置标签" data-row="'+r.row+'" data-col="3"><i class="fa fa-edit"></i></button>&nbsp;&nbsp;&nbsp;<label>'+l+"</label>"}},{targets:4,className:"text-right",orderable:!1,title:l-1+"年调整数",name:"preAdjust",data:"preAdjust",width:"100px",render:function(e,t,a,r){var l=void 0==e?0:formatMoney(e);return'<button class="btn btn-xs btn-default table-btn-operate bdo-drop-btn" type="button" style="float: left;" data-placement="top" title="设置标签" data-row="'+r.row+'" data-col="4">\t<i class="fa fa-edit"></i>\t</button>&nbsp;&nbsp;&nbsp;<label>'+l+"</label>"}},{targets:5,className:"text-right",orderable:!1,title:l-1+"审定数",name:"preAfter",data:"preAfter",width:"100px",render:function(e,t,a,r){var l=void 0==e?0:formatMoney(e);return'<button class="btn btn-xs btn-default table-btn-operate bdo-drop-btn" type="button" style="float: left;" data-placement="top" title="设置标签" data-row="'+r.row+'" data-col="5">\t<i class="fa fa-edit"></i>\t</button>&nbsp;&nbsp;&nbsp;<label>'+l+"</label>"}},{targets:6,className:"text-right",orderable:!1,title:l+"年未审数",name:"currentBefore",data:"currentBefore",width:"100px",render:function(e,t,a,r){var l=void 0==e?0:formatMoney(e);return'<button class="btn btn-xs btn-default table-btn-operate bdo-drop-btn" type="button" style="float: left;" data-placement="top" title="设置标签" data-row="'+r.row+'" data-col="6">\t<i class="fa fa-edit"></i>\t</button>&nbsp;&nbsp;&nbsp;<label>'+l+"</label>"}},{targets:7,className:"text-right",orderable:!1,title:l+"年调整数",name:"currentAdjust",data:"currentAdjust",width:"100px",render:function(e,t,a,r){var l=void 0==e?0:formatMoney(e);return'<button class="btn btn-xs btn-default table-btn-operate bdo-drop-btn" type="button" style="float: left;" data-placement="top" title="设置标签" data-row="'+r.row+'" data-col="7">\t<i class="fa fa-edit"></i>\t</button>&nbsp;&nbsp;&nbsp;<label>'+l+"</label>"}},{targets:8,className:"text-right",orderable:!1,title:l+"审定数",name:"currentAfter",data:"currentAfter",width:"100px",render:function(e,t,a,r){var l=void 0==e?0:formatMoney(e);return'<button class="btn btn-xs btn-default table-btn-operate bdo-drop-btn" type="button" style="float: left;" data-placement="top" title="设置标签" data-row="'+r.row+'" data-col="8">\t<i class="fa fa-edit"></i>\t</button>&nbsp;&nbsp;&nbsp;<label>'+l+"</label>"}}],drawCallback:function(e){}}},s()},AttachPage=e=>{var t,a,r,l,s;t=e.template||tplLoader("dgCenter/html/dg/attach.html");let o,n=e.data.extraOptions.autoId;const i={options:{propsData:{jsonData:{batchWPattach:[],customerId:"",projectId:""}}},props:{jsonData:Object},display:"tableform-one",column:1,id:"batchUploadWPAttachForm",data:()=>({ajaxConfig:{type:"POST",url:"dgCenter/BatchUploadDgAttach.batchUploadTempFiles.json",dataType:"json",success(e){if(e.success){$("#batchUploadWPAttachFormModal").modal("hide");let t=e.data;if($("#batchWPAttachTable").dataTable({data:t,paging:!1,ordering:!1,scrollX:!0,scrollY:"300px",columns:[{title:"序号",class:"text-center",width:"60px",render:function(e,t,a,r){return r.settings._iDisplayStart+r.row+1}},{title:"上传文件名称",width:"300px",render:function(e,t,a,r){return`<div class="form-material">${a.name}</div>`}},{title:"底稿文件名称",width:"300px",render:function(e,t,a,r){return`<div class="form-material"><input class="js-match-dg-attach" row="${r.settings._iDisplayStart+r.row+1}" attach-name="${a.name}" attach-path="${a.path}"></div>`}},{title:"操作",width:"60px",render:function(e,t,a,r){return`<div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button class="btn btn-xs btn-warning js-match-dg-attach-del" type="button" data-placement="top" title="删除" data-toggle="tooltip" data-row="${r.row}">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class="fa fa-close"></i>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>`}},{visible:!1}]}),1==o.length){let e=$(".js-match-dg-attach");e.attr("dg-id",o[0].data),e.attr("dg-name",o[0].value),e.val(o[0].value)}$(".js-match-dg-attach").devbridgeAutocomplete({noCache:!0,minChars:0,autoSelectFirst:!0,orientation:"auto",maxHeight:270,lookup:o,onSelect:function(e){let t=$(this);t.attr("dg-id",e.data),t.attr("dg-name",e.value)}}),$("#tmpDgAttachModal").modal("show"),$("#tmpDgAttachModal .js-match-dg-attach-del").click(function(){let e=$(this).parents("tr").index();$("#batchWPAttachTable").DataTable().row(e).remove().draw()})}else bdoErrorBox("失败",e.resultInfo.statusText)}}}),methods:{onBatchUploadWPBtn(e){let t=$("#batchWPattach").fileinput("getFileStack");!t||t.length<1?bdoInfoBox("提示","请先选择文件"):this.uploadFile(!0)}},buttons:[{id:"batchUploadWPAttachBtn",icon:"fa-floppy-o",style:"btn-primary",text:"上传",typeAttr:{"v-on:click":"onBatchUploadWPBtn"}},{id:"cancelUploadWPAttachModelBtn",icon:"fa-arrow-left",style:"btn-warning",text:"取消",typeAttr:{"data-dismiss":"modal"}}],items:[{id:"batchWPattach",type:"file",label:"底稿附件",rowspan:1,colspan:2,validate:{rules:{}},show:!0,typeAttr:{multiple:!0},plugin:{name:"fileinput",options:{allowedFileExtensions:["xls","xlsx","xltx","xlsm","xltm","xlsb","xlam","jpg","png","doc","docx","zip","rar","pdf"],uploadUrl:"dgCenter/DgDownload.uploadTempFile.json",uploadExtraData:()=>({})}}}]};e.template=t,_data=e.data,s=(()=>{function e(e){var t;return $.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",async:!1,data:{menuId:window.sys_menuId,sqlId:"DG00078",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:e,start:-1,limit:-1},dataType:"json",success(e){e.success&&((t={extraOptions:e.data[0],currentNode:{extraOptions:e.data[0]}}).autoId=t.extraOptions.autoId,t.workpaperId=t.extraOptions.workpaperId,t.menuId=window.sys_menuId)}}),t}$("#btn_search").click(function(){for(var e=[],t=0;t<$("#search-condition .form-material").length;t++){var r=$("#search-condition .form-material")[t].children[0].value;if(r&&""!=r){var l=$("#search-condition .form-material")[t].children[0].id,s={field:l.substring(l.indexOf("_")+1),sqlIndex:"a."+l.substring(l.indexOf("_")+1),type:"string",value:r,operate:"like"};"detail_tbSubject"==l&&(s={field:"tbSubject",sqlIndex:"CONCAT(c.tbSubjectId,'-',c.tbSubjectName )",type:"string",value:r,operate:"like"}),"detail_dgName"==l&&(s={field:"dgName",sqlIndex:"b.fileName",type:"string",value:r,operate:"like"}),"detail_isReferred"==l&&(s={field:"referredFlg",sqlIndex:"a.isReferred",type:"string",value:r,operate:"eq"}),e.push(s)}}var o=JSON.stringify(e);a.localParam.urlparam.filter=o,BdoDataTable("attachTable",a)}),$("#btn_clear").click(function(){$("#detail_tbSubject").val(""),$("#detail_fileIndexId").val(""),$("#detail_dgName").val(""),$("#detail_fileName").val("")}),$("#attachTable").on("click",'button.table-btn-operate[name="downloadDgAttach"]',e=>{var t=$("#attachTable").dataTable().fnGetData($(e.currentTarget).attr("data-row"));downloadFile("dgCenter/DgDownload.downloadAttach.json",{param1:t.autoId,param2:t.customerId})}),$("#attachTable").on("click",'button.table-btn-operate[name="onlinepreview"]',e=>{var t=$("#attachTable").dataTable().fnGetData($(e.currentTarget).attr("data-row"));$.ajax({url:"dgCenter/DgMain.queryAttachFileExistence.json",type:"post",data:{param1:t.autoId,param2:t.customerId},dataType:"json",success:function(e){if(e.success){var a=t.fileName.substring(t.fileName.lastIndexOf(".")+1).toLowerCase();if("pdf"===a||"jpg"===a||"png"===a||"jpeg"===a)window.open("dgCenter/DgPaper.previewFile.json?param1="+t.autoId+"&param2=type1&param3="+t.fileName,t.fileName,"location=no");else if("xlsx"===a){t.pageType=1;var r={extraOptions:t,currentNode:{extraOptions:t}};$.sessionStorage("fileNode",JSON.stringify(r)),window.open("/Faith/dgcenter.do?m=previewFile")}}else bdoErrorBox("失败",e.resultInfo.statusText)}})}),$("#attachTable").on("click",'button.table-btn-operate[name="viewReferredDgBtn"]',e=>{var t=$("#attachTable").dataTable().fnGetData($(e.currentTarget).attr("data-row"));$("#attachAutoId").val(t.autoId),$("#referredDgId").val(t.referredDgId),$("#dgModal").modal("show")}),$("#dgModal").on("show.bs.modal",function(){r.localParam.urlparam.param3=$("#referredDgId").val(),BdoDataTable("dgTable",r)}),$("#dgTable").on("click",'button.table-btn-operate[name="viewWorkpaperBtn"]',t=>{var a=e($("#dgTable").dataTable().fnGetData($(t.currentTarget).attr("data-row")).autoId);$.sessionStorage("subjecttreeNode",JSON.stringify(a)),window.open("/Faith/dgcenter.do?m=openWorkpaper&index="+a.extraOptions.indexId+"&projectId="+a.extraOptions.projectId)}),$("#dgTable").on("click","tbody td a",t=>{$(t.currentTarget).parents("td").index();var a=$(t.currentTarget).parents("tr").index(),r=($("#dgTable").dataTable(),$("#dgTable").DataTable().row(a).data()),l=t.currentTarget.text,s=e(r.autoId);$.sessionStorage("subjecttreeNode",JSON.stringify(s)),$.sessionStorage("cellLinkFormulaBySheetName",JSON.stringify(l)),window.open("/Faith/dgcenter.do?m=openWorkpaper&index="+s.extraOptions.indexId+"&projectId="+s.extraOptions.projectId)}),$("#batchUploadAttachBtn").click(function(){o=[];$.ajax({type:"post",async:!1,url:"dgCenter/BatchUploadDgAttach.getWorkpaperList.json",data:{menuId:window.sys_menuId,param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:n},dataType:"json",success(e){e.success?(o=e.data,$("#batchUploadWPAttachFormModal").modal("show")):bdoErrorBox("失败",e.resultInfo.statusText)},error(e){bdoErrorBox("失败","底稿查找失败")}})})}),l=(()=>{$(e.region).empty().append(t),$("#toggleBtn").click(),""!=_data.extraOptions.tbSubjectCode&&(a.localParam.urlparam.param3=_data.extraOptions.tbSubjectCode),""!=_data.extraOptions.userSubjectId&&(a.localParam.urlparam.param4=_data.extraOptions.userSubjectId),BdoDataTable("attachTable",a),createForm(i),s(),$("#dgAttachMatchAllBtn").click(function(e){let t=$(".js-match-dg-attach"),a={};for(let e,r=0;r<t.length;r++){let l=(e=$(t[r])).attr("row"),s=e.attr("attach-name"),o=e.attr("attach-path"),n=e.attr("dg-id"),i=e.attr("dg-name"),d=e.val();if(!n||i!=d)return void bdoInfoBox("提示",`第 ${l} 行尚未匹配，请先全部匹配完`);a[r+""]={attachName:s,attachPath:o,dgId:n,dgName:i}}let r=JSON.stringify(a);"{}"!==r?$.ajax({type:"post",url:"dgCenter/BatchUploadDgAttach.matchDgAttachFiles.json",data:{param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:r},dataType:"json",success(e){e.success?($("#tmpDgAttachModal").modal("hide"),bdoSuccessBox("成功"),$("#attachTable").DataTable().ajax.reload()):bdoErrorBox("失败","批量上传底稿附件失败")}}):$("#tmpDgAttachModal").modal("hide")})}),a={localParam:{url:"dgCenter/DgGeneral.query.json",urlparam:{menuId:window.sys_menuId,sqlId:"DG00116",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:_data.extraOptions.tbSubjectCode,limit:-1,start:-1},tabNum:!0},tableParam:{scrollX:!0,scrollY:"205px",select:!1,ordering:!1,order:[3,"asc"],serverSide:!0,fixedThead:!0,fixedHeight:"400px",pageLength:30,scrollCollapse:!0,columnDefs:[{targets:1,orderable:!1,className:"text-center",title:"处理",data:null,width:"100px",render:function(e,t,a,r){var l=e.suffix.toLowerCase(),s="";return s+='<button class="btn btn-xs table-btn-operate btn-primary" type="button" name="downloadDgAttach" data-placement="top" title="下载" data-toggle="tooltip" data-row="'+r.row+'">\t<i class="fa fa-download"></i></button>',"pdf"!=l&&"jpg"!=l&&"png"!=l&&"jpeg"!=l&&"xlsx"!=l||(s+='<button class="btn btn-xs table-btn-operate btn-primary" type="button" name="onlinepreview" data-placement="top" title="在线预览" data-toggle="tooltip" data-row="'+r.row+'">\t<i class="fa fa-eye"></i></button>'),1==e.referredFlg&&(s+='<button class="btn btn-xs table-btn-operate btn-primary" type="button" name="viewReferredDgBtn" data-placement="top" title="查看所有被关联的底稿" data-toggle="tooltip" data-row="'+r.row+'">\t<i class="fa fa-file-excel-o"></i></button>'),s}},{targets:2,orderable:!0,className:"text-center",title:"TB科目",name:"tbSubject",data:"tbSubject",width:"100px"},{targets:3,orderable:!0,className:"text-center",title:"索引号",name:"fileIndexId",data:"fileIndexId",width:"150px"},{targets:4,orderable:!0,className:"text-center",title:"底稿名称",name:"dgName",data:"dgName",width:"250px"},{targets:5,orderable:!0,className:"text-center",title:"文件名称",name:"fileName",data:"fileName",width:"150px"},{targets:6,orderable:!0,className:"text-center",title:"是否被关联",name:"referredFlg",data:"referredFlg",width:"100px",render:function(e,t,a,r){return 1==e?"是":"否"}},{targets:7,orderable:!0,className:"text-center",title:"上传时间",name:"uploadDate",data:"uploadDate",width:"120px",render:function(e,t,a,r){return function(e){var t=e.getFullYear(),a=e.getMonth()+1;a=a<10?"0"+a:a;var r=e.getDate();r=r<10?"0"+r:r;var l=e.getHours();l=l<10?"0"+l:l;var s=e.getMinutes();s=s<10?"0"+s:s;var o=e.getSeconds();return t+"-"+a+"-"+r+" "+l+":"+s+":"+(o=o<10?"0"+o:o)}(new Date(e))}},{targets:8,orderable:!0,className:"text-center",title:"上传人",name:"__uuploadUserName",data:"__uuploadUserName",width:"60px"},{targets:9,name:"referredDgId",data:"referredDgId",visible:!1},{targets:10,name:"autoId",data:"autoId",visible:!1}]}},r={localParam:{url:"dgCenter/DgGeneral.query.json",urlparam:{menuId:window.sys_menuId,sqlId:"DG00154",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:$("#referredDgId").val(),limit:-1,start:-1},tabNum:!0},tableParam:{scrollX:!0,scrollY:"285px",select:!0,ordering:!1,order:[3,"asc"],serverSide:!0,fixedThead:!0,fixedHeight:"400px",pageLength:30,columnDefs:[{targets:1,className:"text-center",title:"处理",data:null,width:"50px",render:function(e,t,a,r){return'<button class="btn btn-xs table-btn-operate btn-primary" type="button" name="viewWorkpaperBtn" data-placement="top" title="查看底稿" data-toggle="tooltip" data-row="'+r.row+'">\t<i class="fa fa-eye"></i></button>'}},{targets:2,className:"text-center",title:"TB科目",name:"subjectId",data:null,width:"100px",render:function(e,t,a,r){return e.subjectId+"-"+e.subjectName}},{targets:3,className:"text-center",title:"底稿名称",name:"fileName",data:"fileName",width:"250px"},{targets:4,className:"text-left",title:"单元格位置",name:"customizeStyle",data:"customizeStyle",width:"200px",render:function(e,t,a,r){var l=JSON.parse(e).ShowSingleLinkCacheMap;if(void 0===l)return"";var s=new Map;for(let e of Object.keys(l))s.set(e,l[e]);var o="",n=[];for(var i of s)for(var d of i[1]){if(d.attachmentLink)d.attachmentLink.substring(0,d.attachmentLink.indexOf(":"))==$("#attachAutoId").val()&&n.push(d.cellPosition)}for(var c=[],u=0;u<n.length;u++)-1==c.indexOf(n[u])&&c.push(n[u]);for(u=0;u<c.length;u++)o+='<a href="#">'+c[u]+"</a><br>";return o}},{targets:5,name:"subjectTreeId",data:"subjectTreeId",visible:!1}]}},l()},AdjustPage=function(e){var t=e.template||tplLoader("dgCenter/html/dg/adjustTab.html");e.template=t;var a=window.CUR_PROJECT_ACC_YEAR,r=a-1;let l=function(){$.ajax({type:"post",async:!1,url:"dgCenter/AuditAdjust.queryAdjustEffect.json",data:{menuId:window.sys_menuId,sqlId:"DG00202",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID},dataType:"json",success(e){e.success&&($("#adjustEffect").html("期初：审计调整对净资产影响："+formatMoney2(e.data[0].impactLastYearSAssetAudit)+" 元；   审计调整对净利润影响："+formatMoney2(e.data[0].impactLastYearSProfitAudit)+"元；<br/> 期末：审计调整对净资产影响："+formatMoney2(e.data[0].impactCurrentYearAssetAudit)+" 元；   审计调整对净利润影响："+formatMoney2(e.data[0].impactCurrentYearProfitAudit)+"元；"),$("#adjustTableTitle").html($("#adjustEffect").html()))}})};var s;$(e.region).empty().append(t),(s=DgAdjustPage({handleFlag:"1",data:{extraOptions:{}}}).tableModel).localParam.urlparam={menuId:window.sys_menuId,sqlId:"FA10064",param1:window.CUR_CUSTOMERID,param2:r,param3:"2",param4:e.data.extraOptions.userSubjectId?e.data.extraOptions.userSubjectId:e.data.extraOptions.tbSubjectCode,param5:window.CUR_PROJECTID,param6:a},window.CUR_CUSTOMERID,window.CUR_PROJECTID,e.data.extraOptions.nodeType,e.data.extraOptions.autoId,e.data.extraOptions.autoId,BdoDataTable("adjustTable",s),l(),$("#refreshAdjustTableBtn").on("click",function(){$("#adjustTable").DataTable().ajax.reload(),l()})},PostilsPage=e=>{let t,a,r,l,s,o=0;t=e.template||tplLoader("dgCenter/html/dg/postils.html"),e.template=t,a=e.data,s=(()=>{$("#btn_search").click(function(){for(var e=[],t=0;t<$("#search-condition .form-material").length;t++){var a=$("#search-condition .form-material")[t].children[0].value;if(a&&""!=a){var l=$("#search-condition .form-material")[t].children[0].id,s={field:l.substring(l.indexOf("_")+1),sqlIndex:"a."+l.substring(l.indexOf("_")+1),type:"string",value:a,operate:"like"};switch(l){case"detail_auditState":s.operate="eq",s.type="number";break;case"detail_activeFlag":s.sqlIndex="a.activeFlag",s.operate="eq";break;case"detail_fileName":s.sqlIndex="a.fileName";break;case"detail_subjectName":s.sqlIndex="a.userSubjectName";break;default:s.operate="like"}e.push(s)}}var o=JSON.stringify(e);r.localParam.urlparam.filter=o,BdoDataTable("postilsTable",r)}),$("#btn_clear").click(function(){$("#detail_fileName").val(""),$("#detail_content").val(""),$("#detail_indexId").val(""),$("#detail_auditState").val(""),$("#detail_activeFlag").val("")}),$("#postilsTable").on("click",'button.table-btn-operate[name="viewPostilBtn"]',e=>{var t=$("#postilsTable").dataTable().fnGetData($(e.currentTarget).attr("data-row"));DgPostilPage({region:"#sideRegin",data:t,type:t.type,foreignId:t.foreignId,isSingle:!0,customerId:t.customerId,projectId:t.projectId})}),$("#postilsTable ").on("click",'a[name="gotoPosition"]',e=>{var t=$(e.currentTarget).attr("data-row");$("#postilsTable_rownum").val(t);var a=$("#postilsTable").dataTable().fnGetData(t);"DG-"==a.type.substring(0,3)?$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",async:!1,data:{menuId:window.sys_menuId,sqlId:"DG00143",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:a.foreignId,start:-1,limit:-1},dataType:"json",success(e){if(e.success){if(0==e.data.length)return void bdoErrorBox("失败","批注索引号关联的文件不存在。");var t={extraOptions:e.data[0],currentNode:{extraOptions:e.data[0]}};t.autoId=t.extraOptions.autoId,t.workpaperId=t.extraOptions.workpaperId,t.menuId=window.sys_menuId,$.sessionStorage("subjecttreeNode",JSON.stringify(t)),$.sessionStorage("cellLinkFormulaBySheetName",JSON.stringify(a.cellContent)),window.open("/Faith/dgcenter.do?m=openWorkpaper&index="+t.extraOptions.indexId+"&projectId="+t.extraOptions.projectId)}}}):"QYXJ-"==a.type.substring(0,5)?$.ajax({type:"post",url:"dgCenter/DgPostil.queryWorkpaper.json",async:!1,data:{param1:a.foreignId},dataType:"json",success(e){if(e.success){if(0==e.data.length)return void bdoErrorBox("失败","批注索引号关联的文件不存在。");var t={extraOptions:e.data[0],currentNode:{extraOptions:e.data[0]}};t.extraOptions.workpaperId=t.extraOptions.autoId,t.menuId=window.sys_menuId,$.sessionStorage("subjecttreeNode",JSON.stringify(t)),$.sessionStorage("cellLinkFormulaBySheetName",JSON.stringify(a.cellContent)),window.open("/Faith/dgcenter.do?m=openQYXJFile&customerId="+CUR_CUSTOMERID+"&projectId="+CUR_PROJECTID+"&fileType=2")}}}):"HB"==a.type.substring(0,2)?$.ajax({type:"post",url:"dgCenter/HbMergePostil.getUrlByIndexId.json",async:!1,data:{param1:a.type},dataType:"json",success(e){if(e.success){var t=e.data[0].url,r=e.data[0].type;if(void 0!=t&&""!=t){let e={curCustomerName:window.CUR_CUSTOMERID+"-"+window.CUR_CUSTOMERNAME,curProjectName:window.CUR_PROJECTNAME,curYear:window.CUR_PROJECT_ACC_YEAR,curCustomerId:window.CUR_CUSTOMERID,curProjectId:window.CUR_PROJECTID,departmentIdr:departIdrSession,userId:sys_userId},l={curYear:window.CUR_PROJECT_ACC_YEAR,customerId:window.CUR_CUSTOMERID,mergeCustomerId:a.mergeCustomerId,mergeCustomerName:a.mergeCustomerName,projectId:a.mergeProjectId+"-"+a.mergeProjectName,type:r};sessionStorage.setItem("curCustomerData",JSON.stringify(e)),sessionStorage.setItem("projectItem",JSON.stringify(l)),sessionStorage.setItem("menuID",a.type),window.open("/Faith/merge/index.html#/"+t)}else window.open("/Faith/merge/index.html")}}}):"NOTE"==a.type.substring(0,4)?$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",async:!1,data:{menuId:window.sys_menuId,sqlId:"DG00092",param1:a.foreignId,param2:a.customerId,param3:a.projectId,start:-1,limit:-1},dataType:"json",success(e){if(e.success){if(0==e.data.length)return void bdoErrorBox("失败","批注索引号关联的文件不存在。");var t={extraOptions:e.data[0],currentNode:{extraOptions:e.data[0]}};t.autoId=t.extraOptions.autoId,t.menuId=window.sys_menuId,$.sessionStorage("noteInfoNode",JSON.stringify(t)),window.open("/Faith/dgcenter.do?m=openDgNoteInfo&noteNo="+t.extraOptions.noteNo+"&projectId="+t.extraOptions.projectId)}else bdoErrorBox("失败",e.resultInfo.statusText)}}):"MERGENOTE2"==a.type.substring(0,10)?$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",async:!1,data:{menuId:window.sys_menuId,sqlId:"DG00310",param1:a.foreignId,param2:a.customerId,param3:a.projectId,param4:a.mergeProjectId,start:-1,limit:-1},dataType:"json",success(e){if(e.success){if(0==e.data.length)return void bdoErrorBox("失败","批注索引号关联的文件不存在。");var t={extraOptions:e.data[0],currentNode:{extraOptions:e.data[0]}};t.autoId=t.extraOptions.autoId,t.menuId=window.sys_menuId,t.type=2,$.sessionStorage("excelnode",JSON.stringify(t)),window.open("/Faith/dgcenter.do?m=openMergeNoteInfoSecond&noteNo="+t.extraOptions.noteNo)}}}):"MERGENOTE"==a.type.substring(0,9)?$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",async:!1,data:{menuId:window.sys_menuId,sqlId:"DG00310",param1:a.foreignId,param2:a.customerId,param3:a.projectId,param4:a.mergeProjectId,start:-1,limit:-1},dataType:"json",success(e){if(e.success){if(0==e.data.length)return void bdoErrorBox("失败","批注索引号关联的文件不存在。");var t={extraOptions:e.data[0],currentNode:{extraOptions:e.data[0]}};t.autoId=t.extraOptions.autoId,t.menuId=window.sys_menuId,sessionStorage.setItem("mergeNoteInfoNode",JSON.stringify(t)),window.open("/Faith/dgcenter.do?m=openMergeNoteInfo&noteNo="+t.extraOptions.noteNo)}}}):window.open("/Faith/bdologin.do?m=gotoDesktop&menuId=40000022&type="+a.type)}),$("#postilsTable").on("click",'button.table-btn-operate[name="viewExcelBtn"]',e=>{var t=$("#postilsTable").dataTable().fnGetData($(e.currentTarget).attr("data-row"));$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",data:{sqlId:"DG00031",param1:t.autoId,param2:t.foreignId,param3:t.type,param4:a.extraOptions.customerId},dataType:"json",success(e){if(e.success){var t={text:e.data[0].nodeName,nodeType:e.data[0].nodeType,extraOptions:e.data[0],currentNode:{text:e.data[0].nodeName,nodeType:e.data[0].nodeType,extraOptions:e.data[0]}};t.workpagerId=t.extraOptions.workpagerId,t.menuId=window.sys_menuId,$.sessionStorage("subjecttreeNode",JSON.stringify(t)),window.open("/Faith/dgcenter.do?m=openWorkpaper&index="+t.extraOptions.indexId+"&projectId="+t.extraOptions.projectId)}else bdoErrorBox("失败",e.resultInfo.statusText)}})}),$("#postilsExportBtn").click(function(e){downloadFile("dgCenter/ExportOtherDg.exportPostilExcel.json",{})})}),init=(()=>{"PROJECT"==a.type?$("#postilsExportBtn").show():$("#postilsExportBtn").hide()}),l=(()=>{$(e.region).empty().append(t),$("#toggleBtn").click(),BdoDataTable("postilsTable",r),s(),init()}),r={localParam:{url:"dgCenter/DgGeneral.query.json",urlparam:(()=>{let e={menuId:window.sys_menuId,param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,start:-1,limit:-1,sort:JSON.stringify([{property:"createDate",direction:"desc"}])};return"SUBJECT"==a.type&&(e.sqlId="DG00144",e.param3=a.extraOptions.subjectId),"TBSUBJECT"==a.type&&(e.sqlId="DG00145",e.param3=window.CUR_PROJECT_ACC_YEAR,e.param4=a.extraOptions.tbSubjectCode),"PROJECT"==a.type&&(e.sqlId="DG00146"),e})(),tabNum:!0},tableParam:{pageLength:30,scrollX:!0,scrollY:"490px",select:!0,ordering:!1,order:[11,"desc"],serverSide:!0,fixedThead:!0,fixedHeight:"290px",scrollCollapse:!0,columnDefs:[{targets:(()=>(o=0,++o))(),orderable:!1,className:"text-center",title:"处理",data:null,width:"70px",render(e,t,a,r){var l="";return l+='<button class="btn btn-xs btn-success table-btn-operate bdo-drop-btn" type="button" name="viewPostilBtn" data-placement="top" title="详细" data-toggle="tooltip" data-row="'+r.row+'">\t<i class="fa fa-eye"></i>\t</button>'}},{targets:++o,orderable:!0,title:"科目名称",className:"text-center",name:"userSubjectName",data:"userSubjectName",width:"100px"},{targets:++o,orderable:!0,title:"节点名称",name:"fileName",data:"fileName",width:"220px",render:function(e,t,a,r){return'<p style="word-wrap: break-word;word-break: normal;width: 220px;">'+e+"</p>"}},{targets:++o,orderable:!0,title:"批注",name:"postilContentText",data:"postilContentText",width:"200px",render:function(e,t,a,r){return'<p style="word-wrap: break-word;word-break: normal;width: 200px;">'+e+"</p>"}},{targets:++o,title:"位置",name:"cellContent",data:"cellContent",width:"100px"},{targets:++o,orderable:!0,title:"索引号",name:"indexId",data:"indexId",width:"180px",render:function(e,t,a,r){return'<p style="word-wrap: break-word;word-break: normal;width: 150px;"><a name="gotoPosition" class="postil-list-username" style="cursor: pointer;" data-row="'+r.row+'">'+e+"</a></p>"}},{targets:++o,orderable:!0,title:"质控阶段",className:"text-center",name:"auditState",data:"auditState",renderer:"getDicLabelByVal|审计阶段",width:"70px",render:e=>DicVal2Nm(e,"审计阶段")},{targets:++o,orderable:!0,title:"优先级",className:"text-center",name:"postilLevel",data:"postilLevel",renderer:"getDicLabelByVal|优先级",width:"70px",render:e=>DicVal2Nm(e,"优先级")},{targets:++o,orderable:!0,title:"状态",className:"text-center",name:"activeFlag",data:"activeFlag",renderer:"getDicLabelByVal|批注状态",width:"50px",render:e=>DicVal2Nm(e,"批注状态")},{targets:++o,orderable:!0,title:"创建人",className:"text-center",name:"__ucreateUserName",data:"__ucreateUserName",width:"60px"},{targets:++o,orderable:!0,title:"创建时间",name:"createDate",data:"createDate",width:"120px",render:e=>new Date(e).format("yyyy-MM-dd HH:mm:ss")}]}},l()},SubjectPage=e=>{var t,a;t=e.template||tplLoader("dgCenter/html/dg/subject.html"),e.template=t,$("#headtitle").empty().text(e.data.text),a=(()=>{$('#subPageRight [data-toggle="tabs"] a, .js-tabs a').on("show.bs.tab",function(t){window.xxrPageKey=$(t.currentTarget).text();var a=t.target.href,r=a.lastIndexOf("#");switch(a.substring(r+1)){case"guidePageTab":GuidePage({region:"#guidePageTab",data:e.data});break;case"auditProgramPageTab":AuditProgramPage({region:"#auditProgramPageTab",data:e.data});break;case"postilsPageTab":PostilsPage({region:"#postilsPageTab",data:e.data});break;case"adjustPageTab":AdjustPage({region:"#adjustPageTab",data:e.data});break;case"batchWPPageTab":BatchUploadWorkpaperPage({region:"#batchWPPageTab",data:e.data});break;case"dgAttachPageTab":AttachPage({region:"#dgAttachPageTab",data:e.data});break;case"samplingCountPageTab":SamplingCountPage({region:"#samplingCountPageTab",data:e.data})}})}),(()=>{$(e.region).empty().append(t),window.xxrPageKey=$('#subPageRight [data-toggle="tabs"] li.active a').text(),a(),AuditProgramPage({region:"#auditProgramPageTab",data:e.data}),OneUI.initHelper("slimscroll")})()},DgAdjustPage=function(e){var t="",a="",r=[{showAdd:"1",autoId:"",subjectId:"",indexId:"",subjectName:"",assitemId:"",assitemContent:"",oppSubjectId:"",oppSubjectName:"",subjectContent:"",adjustSubjectTB:"",adjustSubjectCodeReport:"",adjustSubjectReport:"",workpaperId:0,yyyy:"",summary:"",currency:"",currValue:"",dirction:"",occurValue:"",reason:""},{autoId:"",subjectId:"",indexId:"",subjectName:"",assitemId:"",assitemContent:"",subjectContent:"",adjustSubjectTB:"",adjustSubjectCodeReport:"",adjustSubjectReport:"",yyyy:"",summary:"",currency:"",currValue:"",dirction:"",occurValue:"",reason:""}];let l=ComboDicOption(!1,"错报类型");var s='&nbsp;<button class="btn btn-xs btn-warning" type="button" name="dfEdit" data-placement="top" title="填充金额" data-toggle="tooltip"><i class="fa fa-edit"></i></button>',o='&nbsp;<button class="btn btn-xs btn-info" type="button" name="dfClear" data-placement="top" title="清空" data-toggle="tooltip"><i class="fa fa-eraser"></i></button>',n='&nbsp;<button class="btn btn-xs btn-success" type="button" name="dfAdd" data-placement="top" title="增加一行" data-toggle="tooltip"><i class="fa fa-plus"></i></button>',i='&nbsp;<button class="btn btn-xs btn-danger" type="button" name="dfDel" data-placement="top" title="移除" data-toggle="tooltip"><i class="fa fa-times"></i></button>',d="",c=window.CUR_PROJECT_ACC_YEAR,u=function(){$("#adjustTable").DataTable().ajax.reload()},m=function(t,a){return e.data.extraOptions.workpaperId&&(t[a]=e.data.extraOptions.workpaperId),t},p={localParam:{tabNum:!1,url:"dgCenter/DgGeneral.query.json",urlparam:{}},tableParam:{select:!0,lengthChange:!1,dom:'<"row"<"col-sm-12"tr>><"row"<"col-sm-6"i><"col-sm-6">>',ordering:!1,order:[],fixedThead:!0,fixedHeight:"480px",rowGroup:{dataSrc:"indexId",startRender:null,endRender:function(e,t){$(e.nodes()).css("background","white"),$(e.nodes()).each(function(t,a){t?($(this).find("td").eq(0).hide(),$(this).find("td").eq(1).hide()):($(this).find("td").eq(0).attr("rowspan",e[0].length),$(this).find("td").eq(1).attr("rowspan",e[0].length)),""==$(this).find("td").eq(0).html()&&$(this).css("background-color","rgb(255, 255, 120)")});var a=$(e.nodes()).last().next();1==a.children().length&&a.remove();var r=$("#"+$(e.nodes()).eq(0).closest("table").attr("id")+"_info b"),l=$(e.nodes()).eq(0).closest("table");e[0][0]||r.html(0),r.html(parseInt(r.html())+1),l.find("td").css("border-width","1px")}},serverSide:!0,columnDefs:[{targets:1,orderable:!1,className:1==e.handleFlag?"hidden":"text-center",title:"处理",width:"100px",render:function(t,a,r,l){var s="";if(e.handleFlag&&1==e.handleFlag)return"<div></div>";if(e.handleFlag&&0!=e.handleFlag)return s;if(e.handleFlag&&0==e.handleFlag){var o="";return"1"==r.status&&(s+='<button class="btn btn-xs btn-success" type="button" name="adEdit" data-placement="top" title="修改" data-toggle="tooltip" '+o+'><i class="fa fa-edit"></i></button>&nbsp;'),s+='<button class="btn btn-xs btn-danger" type="button" name="adDelete" data-placement="top" title="删除" data-toggle="tooltip" '+o+'><i class="fa fa-times"></i></button>&nbsp;',s+='<button style="display : none">'+r.autoId+"</button>",0==r.ACTIVE_FLAG?s+='<button class="btn btn-xs btn-success" type="button" name="adBan" data-placement="top" title="调整" data-toggle="tooltip" '+o+'><i class="fa fa-openid"></i></button>&nbsp;':s+='<button class="btn btn-xs btn-danger" type="button" name="adBan" data-placement="top" title="不调整" data-toggle="tooltip" '+o+'><i class="fa fa-ban"></i></button>&nbsp;',s+='<button name="accpackYear" style="display : none">'+r.subjectYear+"</button>"}if(e.data.extraOptions.workpaperId!=r.workpaperId)return s;if(r.__ufillUserName&&CUR_USERID!=r.__ufillUserName.userId&&CUR_USERID!=d)return s;o="";return"1"==r.status&&(s+='<button class="btn btn-xs btn-success" type="button" name="adEdit" data-placement="top" title="修改" data-toggle="tooltip" '+o+'><i class="fa fa-edit"></i></button>&nbsp;'),s+='<button class="btn btn-xs btn-danger" type="button" name="adDelete" data-placement="top" title="删除" data-toggle="tooltip" '+o+'><i class="fa fa-times"></i></button>&nbsp;',s+='<button style="display : none">'+r.autoId+"</button>",0==r.ACTIVE_FLAG?s+='<button class="btn btn-xs btn-success" type="button" name="adBan" data-placement="top" title="调整" data-toggle="tooltip" '+o+'><i class="fa fa-openid"></i></button>&nbsp;':s+='<button class="btn btn-xs btn-danger" type="button" name="adBan" data-placement="top" title="不调整" data-toggle="tooltip" '+o+'><i class="fa fa-ban"></i></button>&nbsp;',s+='<button name="accpackYear" style="display : none">'+r.subjectYear+"</button>"}},{targets:2,className:"text-left adjust-row-text",title:"索引号",name:"indexId",data:"indexId",width:"100px",render:function(e,t,a,r){return"<span title="+e+">"+e+"</span>"}},{targets:3,className:"text-left adjust-row-text",title:"摘要",name:"summary",data:"summary",width:"200px",render:function(e,t,a,r){return"<span title="+e+">"+e+"</span>"}},{targets:4,className:"text-left adjust-row-text",title:"TB科目名称",name:"adjustSubjectTB",data:"adjustSubjectTB",width:"100px",render:function(e,t,a,r){return"<span title="+e+">"+e+"</span>"}},{targets:5,className:"text-left adjust-row-text",title:"科目编号",name:"subjectId",data:"subjectId",width:"60px",render:function(e,t,a,r){return"<span title="+e+">"+e+"</span>"}},{targets:6,className:"text-left adjust-row-text",title:"科目名称",name:"fullName",data:"fullName",width:"100px",render:function(e,t,a,r){return"<span title="+e+">"+e+"</span>"}},{targets:7,className:"text-left adjust-row-text",title:"辅助核算",name:"assItemName",data:"assItemName",width:"80px",render:function(e,t,a,r){return e?"<span title="+e+">"+e+"</span>":""}},{targets:8,className:"text-right adjust-row-text",title:"借方金额",name:"plusOccurValue",data:"plusOccurValue",width:"80px",render:function(e,t,a,r){return a.dirction>0?formatMoney(a.occurValue):""}},{targets:9,className:"text-right adjust-row-text",title:"贷方金额",name:"minusOccurValue",data:"minusOccurValue",width:"80px",render:function(e,t,a,r){return a.dirction<0?formatMoney(a.occurValue):""}},{targets:10,className:"text-center",title:"状态",name:"status",data:"status",renderer:"getDicLabelByVal|调整状态",width:"45px",render:function(e,t,a,r){return DicVal2Nm(e,"调整状态")}},{targets:11,className:"text-center",title:"未调整原因",name:"reason",data:"reason",width:"100px",render:function(e,t,a,r){return"<span title="+e+">"+e+"</span>"}},{targets:12,className:"text-center",title:"调整年份",name:"subjectYear",data:"subjectYear",width:"100px",render:function(e,t,a,r){return"<span title="+e+">"+e+"</span>"}},{targets:13,className:"text-center",title:"对税务影响",name:"taxEffect",data:"taxEffect",renderer:"getDicLabelByVal|税务影响",width:"100px",render:function(e,t,a,r){return DicVal2Nm(e,"税务影响")}},{targets:14,className:"text-center",title:"错报类型",name:"cbType",data:"cbType",renderer:"getDicLabelByVal|错报类型",width:"100px",render:function(e,t,a,r){return DicVal2Nm(e,"错报类型")}},{targets:15,className:"text-center",title:"制单人",name:"__ufillUserName",data:"__ufillUserName",width:"100px",render:function(e,t,a,r){return"<span title="+a.__ufillUserNameName+">"+a.__ufillUserNameName+"</span>"}},{targets:16,className:"text-center",title:"最后更新时间",name:"lastUpdateDate",data:"lastUpdateDate",width:"130px",render:function(e,t,a,r){return'<span title="'+e+'">'+e+"</span>"}}]}},b=function(){$("#refreshGuideTableBtn").click(function(e){u()}),$("#adjustBtn, #addAdjustBtn").on("click",function(){window.editId=1,$("#adjust_show").show(),$("#jnadjust_dgYear2").parent().hide(),$("#adjustYear").parent().parent().show(),$("#heavy_classification").show(),window.adjustPageId=!0,f(c,function(){var t=0;if(0==$("#adjustTable").size())return e.findMaxIndex(),e.maxIndex;var a=$("#adjustTable").DataTable().data();for(var r in a){var l=""+a[r].indexId,s=parseInt(l.split("-").pop());t<s&&(t=s)}return t}(),"",e.adjustTyle?"1":"2",!1,u),0==$("#adjustYear").length&&$("#adjust_title > span").prepend('<span style="color: white">调整年份: <select id="adjustYear" style="color: #0000009e; border: 0;"><option value="'+c+'" selected>'+c+'</option><option value="'+(c-1)+'">'+(c-1)+"</option></select> </span>")}),$("#adjustTable").on("click",'button[name="adEdit"]',function(){window.editId=0,$("#jnadjust_dgYear2").show(),$("#heavy_classification").hide();let t=$(this),a={param1:window.CUR_CUSTOMERID,param2:t.nextAll().eq(3).html(),param3:t.parent().next().children().html(),param4:window.CUR_PROJECTID},r={param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID};e.data.extraOptions.workpaperId&&(r.param11=!0),$.ajax({url:"dgCenter/DgAdjust.checkWorkpaperEditor.json",type:"post",data:m(r,"param3"),dataType:"json",success:function(r){null!=r.data?$.ajax({url:"dgCenter/DgAdjust.getVoucher.json",type:"post",data:m(a,"param5"),dataType:"json",success:function(a){$("#adjust_show").show(),window.adjustPageId=!0,f(t.nextAll().eq(3).html(),0,a.data,e.adjustTyle?"1":"2",!0,u),3==a.data[0].adjustType&&$("#jnadjust_type3").text("3"),$("#jnadjust_table_id tbody tr td:nth-child(1) button").hide(),$('#jnadjust_table_id tbody tr td:nth-child(1) input[name="jnadjust_check"]').attr("disabled",!0),$('#jnadjust_table_id tbody tr td:nth-child(1) input[name="jnadjust_check"]').parent().css("cursor","not-allowed");for(var r=0;r<a.data.length;r++)"0"==a.data[r].isEliminate?$($('#jnadjust_table_id tbody tr td:nth-child(1) input[name="jnadjust_check"]')[r]).attr("checked",!1):$($('#jnadjust_table_id tbody tr td:nth-child(1) input[name="jnadjust_check"]')[r]).attr("checked",!0);$("#jnadjust_table_id tbody tr.odd input").each(function(){!$(this).prop("disabled")||"injnvalue"!=$(this).prop("name")&&"outjnvalue"!=$(this).prop("name")||$(this).hide(),"jnsubject"==$(this).prop("name")&&$(this).prop("disabled",!0)}),$("#jnadjust_table_id tbody tr.even input").each(function(){!$(this).prop("disabled")||"injnvalue"!=$(this).prop("name")&&"outjnvalue"!=$(this).prop("name")||$(this).hide(),"jnsubject"==$(this).prop("name")&&$(this).prop("disabled",!0)}),$("#jnadjust_dgYear2").text(a.data[0].yyyy),$("#adjustYear").val(a.data[0].yyyy),$("#adjustYear").parent().hide(),E($($("#jnadjust_table_id tbody tr td input")[0])),function(){for(let e=0;e<$('select[name="dfSubject"]').length;e++){let t=$($('select[name="dfSubject"]')[e]),a=t.closest("table").DataTable().data()[$(t).closest("tr").index()];if(a.hasOwnProperty("oppSubjectJson")&&""!=a.oppSubjectJson){let e=JSON.parse(a.oppSubjectJson);for(let a of Object.keys(e))if(formatMoney2(e[a])==t.parent().find('input[name="dfValue"]').val()){t.val(a);break}}}}()}}):bdoErrorBox("提示","您不是该审计程序的底稿编制人，无法修改！")}})}),$("#invalid-select").append(l);var t={};$("#invalid_save").click(function(){bdoInProcessingBox("修改中");let e={param1:window.CUR_CUSTOMERID,param2:t.next().html(),param3:t.parent().next().children().html(),param4:window.CUR_PROJECTID,param5:$("#disabledReason").val(),param7:$("#radio-div-id input:checked").val(),param8:$("#invalid-select").val()};$.ajax({url:"dgCenter/DgAdjust.journalBolish.json",type:"post",data:m(e,"param6"),dataType:"json",success:function(e){u(),e.success?(bdoSuccessBox("成功",e.resultInfo.statusText),document.getElementById("invalid_form").reset()):bdoErrorBox("失败",e.resultInfo.statusText)}})}),$("#adjustTable").on("click",'button[name="adBan"]',function(){t=$(this),"调整"==$(this).attr("title")?$("#invalid_save").click():$("#modal_invalid").modal("show")}),$("#adjustTable").on("click",'button[name="adDelete"]',function(){var e=$(this);bdoConfirmBox("删除","是否删除该笔调整？",function(){bdoInProcessingBox("删除中！"),$.ajax({url:"dgCenter/DgAdjust.journalDelete.json",type:"post",data:{param1:e.next().html()},dataType:"json",success:function(e){e.success?(u(),h(),bdoSuccessBox("成功",e.resultInfo.statusText)):bdoErrorBox("失败",e.resultInfo.statusText)}})})}),$("#ast_save").bind("generate",function(){!function(e){let t=$("#ast_account_table").DataTable().rows().data(),a=[];for(let r=0;r<t.length;r++){let l=t[r],s=l.hasOwnProperty("children");e&&(s&&!l.children||!s)?a.push(l):e||!s||l.children||a.push(l)}let r=2*a.length;if(a.length>1){let e=$('#allTableContent2 button[name="jnadjust_plus_row"]').closest("tr").find("[name=jnvoucherId2]").val(),t=$("#jnadjust_table_id > tbody > tr:nth-child(1) > td:nth-child(2) > input").val();t=t.substring(-1,t.length-5),$('#allTableContent2 button[name="jnadjust_plus_row"]').closest("table").DataTable().clear(),$('#allTableContent2 button[name="jnadjust_plus_row"]').closest("table").DataTable().row.add({autoId:"",subjectId:"",indexId:e,indexKey:t,subjectName:"",subjectContent:"",adjustSubjectTB:"",adjustSubjectCodeReport:"",adjustSubjectReport:"",yyyy:"",summary:"",currency:"",currValue:"",workpaperId:0,dirction:"",occurValue:"",reason:""},{autoId:"",subjectId:"",indexId:e,subjectName:"",subjectContent:"",adjustSubjectTB:"",adjustSubjectCodeReport:"",adjustSubjectReport:"",yyyy:"",indexKey:t,summary:"",workpaperId:0,currency:"",currValue:"",dirction:"",occurValue:"",reason:""});for(let a=1;a<r;a++)window.editId=0,$('#allTableContent2 button[name="jnadjust_plus_row"]').closest("table").DataTable().row.add({autoId:"",subjectId:"",indexId:e,indexKey:t,subjectName:"",subjectContent:"",adjustSubjectTB:"",adjustSubjectCodeReport:"",adjustSubjectReport:"",yyyy:"",summary:"",currency:"",workpaperId:0,currValue:"",dirction:"",occurValue:"",reason:""})}r<20?($('#allTableContent2 button[name="jnadjust_plus_row"]').closest("table").DataTable().draw(),function(e,t){let a=0,r=new Map,l=new Set;for(let s=0;s<e;s++){let e=t[a];y(s,e,e.direction,!1),r.set(s,e.subjectId),y(++s,e,-1*e.direction,!0),a++,r.set(s,e.oppositeSubject),l.add(e.subjectId),l.add(e.oppositeSubject)}let s,o=JSON.stringify(Array.from(l));s="2"==window.showType?window.CUR_PROJECT_ACC_YEAR-1:window.CUR_PROJECT_ACC_YEAR;$.ajax({url:"dgCenter/DgAdjust.findTbSubjectByUserSubject.json",type:"post",data:{param14:window.CUR_CUSTOMERID,param15:departIdSession,param16:o,param17:window.CUR_PROJECTID,param18:s},dataType:"json",success:function(e){if(e.data&&0!=e.data.length){let t=e.data[0];for(let[e,a]of r){let r=$("#jnadjust_table_id > tbody > tr:nth-child("+(e+1)+") > td:nth-child(5) > input"),l=r.closest("tr").find("[name=jnadjust]"),s=t[a];l.val(s),l.attr("data-result",s),l.attr("data-content",s)}}}}),$("#jnadjust_type3").text("3")}(r,a)):function(e,t){let a=0,r=new Map,l=new Set,s=$('#allTableContent2 button[name="jnadjust_plus_row"]').closest("table").DataTable().rows().data();for(let o=0;o<e;o++){let e=t[a];I(o,e,e.direction,s,!1),r.set(o,e.subjectId),I(++o,e,-1*e.direction,s,!0),a++,r.set(o,e.oppositeSubject),l.add(e.subjectId),l.add(e.oppositeSubject)}let o,n=JSON.stringify(Array.from(l));o="2"==window.showType?window.CUR_PROJECT_ACC_YEAR-1:window.CUR_PROJECT_ACC_YEAR;$.ajax({url:"dgCenter/DgAdjust.findTbSubjectByUserSubject.json",type:"post",data:{param14:window.CUR_CUSTOMERID,param15:departIdSession,param16:n,param17:window.CUR_PROJECTID,param18:o},dataType:"json",success:function(e){if(e.data&&0!=e.data.length){let t=e.data[0];for(let[e,a]of r){let r=s[e];r.adjustSubjectTB=t[a]}!function(e){let t=$("#jnadjust_type3").text()?1:0,a=$("#adjustYear").val();$("#jnadjust_type2").text()&&"1"==$("#jnadjust_type2").text()&&(a=$("#jnadjust_dgYear2").text());a||(a=$("#jnadjust_dgYear2").text());let r=[];for(let t=0;t<e.length;t++)e[t].sortNo=t,r[t]=e[t];$("#vch_account_table").treegrid("clearChecked");let l=$('#allTableContent2 button[name="jnadjust_plus_row"]').closest("tr").find("[name=jnvoucherId2]").val(),s=$("#jnadjust_table_id > tbody > tr:nth-child(1) > td:nth-child(2) > input").val();s=s.substring(-1,s.length-5),$('#allTableContent2 button[name="jnadjust_plus_row"]').closest("table").DataTable().clear(),$('#allTableContent2 button[name="jnadjust_plus_row"]').closest("table").DataTable().row.add({autoId:"",subjectId:"",indexId:l,indexKey:s,subjectName:"",subjectContent:"",adjustSubjectTB:"",adjustSubjectCodeReport:"",adjustSubjectReport:"",yyyy:"",summary:"",currency:"",currValue:"",workpaperId:0,dirction:"",occurValue:"",reason:""},{autoId:"",subjectId:"",indexId:l,indexKey:s,subjectName:"",subjectContent:"",adjustSubjectTB:"",adjustSubjectCodeReport:"",adjustSubjectReport:"",yyyy:"",summary:"",workpaperId:0,currency:"",currValue:"",dirction:"",occurValue:"",reason:""}),$.ajax({url:"dgCenter/DgAdjust.mulvoucherAdjust.json",type:"post",data:{param1:JSON.stringify(r),param2:window.CUR_CUSTOMERID,param3:a,param4:$("#jnadjust_type2").text(),param5:window.CUR_PROJECTID,param6:window.showType,param10:t},dataType:"json",success:function(e){window.hasSubmit=!1,$("#searchInput3").val(""),e.success?($("#jnadjust_type3").text(""),bdoSuccessBox("成功",e.resultInfo.statusText),$("#jnadjust_table_id").closest(".dataTables_wrapper").closest(".row").nextAll().remove(),$("#"+$("table[id^=jnadjust_table_id]")[0].id).closest(".dataTables_wrapper").closest(".row").parent().children().remove(),$("#jnadjust_dgYear2").text(c),$("#modal_jnadjustform2").hide(),u(),$("#jnadjust_type2").text()&&"1"==$("#jnadjust_type2").text()&&$("#rpt_search").click()):bdoErrorBox("失败",e.resultInfo.statusText)}}),$("#jnadjust_type3").text("")}(s)}}}),$("#jnadjust_type3").text("3")}(r,a);swal.close()}(!0)}),$("#ast_save").click(function(){bdoInProcessingBox("正在生成负值重分类!"),setTimeout(()=>{$("#ast_save").trigger("generate")},1e3)}),$("#go_to_contacts").click(function(){null!=window.sys_menuId&&""!=window.sys_menuId&&void 0!==window.sys_menuId&&localStorage.setItem("menuId",window.sys_menuId),window.open("./contacts/index.html")}),$("#vch_save").click(function(){let e=[];$("#vch_account_table").treegrid("getCheckedNodes").forEach(t=>{t&&t.hasOwnProperty("children")&&!t.children&&e.push(t)}),e.sort(function(e,t){return e.subjectId>t.subjectId?1:t.subjectId>e.subjectId?-1:0}),C.localParam.data=e,$("#account_subject_table").modal("show"),BdoDataTable("ast_account_table",C),$('input[name="checkSubjectAll"]').off("click"),$('input[name="checkSubjectAll"]').on("click",v)}),$("#ast_account_table").on("focus","tbody > tr > td > div > input",function(){if($("#modal_vch_opp_subjectid").modal("show"),$("#opp_subject_tree").hasClass("treeview"))return void(x=$("#ast_account_table").DataTable().row($(this).parent().parent()).data());let e=$("#adjustYear").val();$("#jnadjust_type2").text()&&"1"==$("#jnadjust_type2").text()&&(e=$("#jnadjust_dgYear2").text()),$("#opp_subject_tree").tree4({url:"finCenter/FinTreeCommon.findAccSubjectType.json",params:{lockCustomerId:window.CUR_CUSTOMERID,lockYyyy:e,searchInputId:"opp_searchInput"},singleSelect:!0,view:{leafIcon:"fa fa-building text-flat",nodeIcon:"fa fa-bank text-primary-light",folderSelectable:!1,multiSelect:!1,showCheckbox:!1,selectedColor:"",selectedBackColor:""}}),x=$("#ast_account_table").DataTable().row($(this).parent().parent()).data()}),$("#allTableContent2").on("click","button[name=dfAdd]",function(){P(this)}),$("#allTableContent2").on("click","button[name=dfEdit]",function(){let e=$(this).closest("div"),t=e.find("select > option:selected").val(),a=e.find('input[name="dfValue"]'),r=e.closest("table").find('tbody > tr > td > input[name="jnsubject"]');for(let e=0;e<r.length;e++){let l=$(r[e]);if(t===l.attr("data-result")){let e=l.closest("tr").find('td > input[name="outjnvalue"]');if(e.prop("disabled")){let e=l.closest("tr").find('td > input[name="injnvalue"]');a.val(e.val()),a.text(e.val())}else a.val(e.val()),a.text(e.val());break}}}),$("#allTableContent2").on("click","button[name=dfClear]",function(){$(this).closest("tr").attr("data-change","1"),$(this).closest("div").find('input[name="dfValue"]').val("")}),$("#allTableContent2").on("click","button[name=dfDel]",function(){1!=$(this).closest("td").find("div").length?($(this).closest("tr").attr("data-change","1"),$(this).closest("div").remove()):bdoInfoBox("提示","至少需要保留一行",1e3)}),$("#allTableContent2").on("change",'select[name="dfSubject"]',function(){let e=$(this).val();$(this).parent().find("option").attr("selected",!1),$(this).find('option[value="'+e+'"]').attr("selected",!0),$(this).val(e)})},g={localParam:{tabNum:!1},tableParam:{pageLength:1e3,data:r,dom:'<"row"<"col-sm-12"tr>>',ordering:!1,lengthChange:!1,select:!1,scrollY:!1,createdRow:function(e,t,a){$(e).find('[name="jncurrency"]').val(t.currency),$(e).find('[name="jndirection"]').val(t.dirction)},drawCallback(){},columns:[{title:"处理",width:"80px",className:"text-center",render:function(e,t,a,r){var l='style="visibility:hidden" disabled',s='<input class="form-control" type="hidden" name="jnautoId" value="'+a.autoId+'">';return s+='<input class="form-control" type="hidden" name="jnautoReason" value="'+a.reason+'">',a.showAdd&&(l=""),s+='<button class="btn btn-xs btn-success" type="button" name="jnadjust_plus_row" data-placement="top" title="添加一行" '+l+'><i class="fa fa-plus""></i></button>&nbsp;',s+='<button class="btn btn-xs btn-danger" type="button" name="jnDelete" data-placement="top" title="删除" data-toggle="tooltip " ><i class="fa fa-times"></i></button>',s+='<div style="float:right;">',s+='\t<label class="css-input css-checkbox css-checkbox-primary control-label" title="是否受限">',s+='\t\t<input type="checkbox" name="jnadjust_check">',s+="\t\t<span></span>",s+="\t</label>",s+="</div>"}},{title:"索引号",className:"text-center",width:"100px",data:"indexId",render:function(e,t,a,r){var l,s,o="",n=0;if(0==window.editId)o+='<input class="form-control" type="hidden" name="jnvoucherId2" value="'+a.indexId+'">'+a.indexId;else if(1==window.editId){var i=$.fn.dataTable.tables(!0).length-1;for(let e=0;e<i;e++)n=e;var d=window.adjustDgNO+"-"+(l=n,s=4,(Array(s).join(0)+l).slice(-s));o+='<input class="form-control" type="hidden" name="jnvoucherId2" value="'+d+'">'+d}return o}},{title:"摘要",className:"text-left",width:"200px",data:"summary",render:function(e,t,a,r){var l="";return l+='<input class="form-control" type="text" name="jnsummary" value="'+e+'">'}},{title:"TB科目",className:"text-left",width:"100px",data:"adjustSubjectTB",render:function(e,t,a,r){var l="";return l+='<input class="form-control" disabled type="text" data-result="'+a.adjustSubjectCodeReport+":"+a.adjustSubjectReport+'" data-content="'+a.adjustSubjectTB+'" id="jnadjust'+window.tabindex+++'" name="jnadjust" value="'+a.adjustSubjectTB+'">'}},{title:"科目",className:"text-left",width:"100px",data:"subjectId",render:function(e,t,a,r){var l="";return l+='<input class="form-control" type="text" data-result="'+a.subjectId+'" data-content="'+a.subjectContent+'" id="jnsubject'+window.tabindex+++'" name="jnsubject" value="'+a.subjectContent+'">'}},{title:"辅助核算",className:"text-left",width:"100px",data:"assitemType",render:function(e,t,a,r){var l="";return l+='<input class="form-control" type="text" data-result="'+(a.assItemId?a.assItemId:"")+'" data-content="'+(a.assItemName?a.assItemName:"")+'" id="assitemType'+window.tabindex+++'" name="assitemType" value="'+(a.assItemName?a.assItemName:"")+'">'}},{title:"方向",className:"hidden",width:"50px",data:"dirction",render:function(e,t,a,r){var l="";return l+='<select class="form-control" name="jndirection"><option></option><option value="1">借</option><option value="-1">贷</option></select>'}},{title:"借方金额",className:"text-right",width:"100px",data:"outOccurValue",render:function(e,t,a,r){return e="",t="",a.dirction>0?e=a.occurValue:a.dirction<0&&(t="disabled"),'<input class="form-control" type="text" name="outjnvalue" value="'+e+'" style="text-align:right" '+t+">"}},{title:"贷方金额",className:"text-right",width:"100px",data:"inOccurValue",render:function(e,t,a,r){return e="",t="",a.dirction<0?e=a.occurValue:a.dirction>0&&(t="disabled"),'<input class="form-control" type="text" name="injnvalue" value="'+e+'" style="text-align:right" '+t+">"}},{title:"对方科目",className:"text-left",width:"350px",data:"oppSubjectJson",render:function(e,t,a,r){let l=$('<span class="row-input"></span>'),d=$('<span class="row-btn"></span>'),c='&nbsp;<input name="dfValue" style="width:120px;" class="text-right"/>',u='<select style="width:120px;" name="dfSubject">';if(a.oppSubjectJson){let e=a.oppSubjectJson.replace(",}","}"),t=JSON.parse(e),r=1===a.dirction?"贷：":"借：",m=!0;if(Object.keys(t).length>1){let e="";for(let a in t){let p=t[a];l=$('<span class="row-input"></span>'),d=$('<span class="row-btn"></span>'),u='<select style="width:120px;" name="dfSubject">',u+='<option value="'+a+'">'+r+a+" </option>",u+="</select>",c='&nbsp;<input name="dfValue" style="width:120px;" value="'+formatMoney2(p)+'" class="text-right"/>',l.append(u).append(c),m?d.append(s).append(o).append(n):d.append(s).append(o).append(i),e+="<div>"+l.prop("outerHTML")+d.prop("outerHTML")+"</div>",m=!1}return e}for(let e in t){let a=t[e];u+='<option value="'+e+'">'+r+e+" </option>",c='&nbsp;<input name="dfValue" style="width:120px;" value="'+formatMoney2(a)+'" class="text-right"/>'}return u+="</select>",l.append(u).append(c),d.append(s).append(o).append(n),"<div>"+l.prop("outerHTML")+d.prop("outerHTML")+"</div>"}return u+="</select>",l.append(u).append(c),d.append(s).append(o).append(n),"<div>"+l.prop("outerHTML")+d.prop("outerHTML")+"</div>"}},{title:"币种",className:"hidden",width:"80px",data:"currency",render:function(e,t,a,r){var l="";return l+='<select class="form-control" name="jncurrency"><option></option><option value="人民币">人民币</option><option value="美元">美元</option><option value="欧元">欧元</option></select>',l+=(a.active_flag,a.active_flag)}},{title:"原币金额",className:"hidden",width:"100px",data:"currValue",render:function(e,t,a,r){var l="";return l+='<input class="form-control" type="text" name="jncurrvalue" value="'+e+'" style="text-align:right">'}}]}},f=function(t,l,s,o,n,i){if($("#vch_filter_subject").val(""),$("#vch_filter_accItem").val(""),window.tabindex=0,window.minNum=l,window.maxNum=++l,$("#jnadjust_dgName2").text(e.data.extraOptions.nodeName),$("#jnadjust_type2").text(o),$("#jnadjust_dgYear2").text(t),s&&s.length>0?(s[0].showAdd="1",g.tableParam.data=s):(g.tableParam.data=r,g.tableParam.data[0].num=window.maxNum,g.tableParam.data[1].num=window.maxNum),n?$("#jnadjust_plus2").css("visibility","hidden"):$("#jnadjust_plus2").css("visibility","visible"),$("#modal_jnadjustform2").css("display","block"),delete g.tableParam.aaData,window.adjustPageId){if(0==$("#jnadjust_table_id").length){let e="jnadjust_table_id";var d="";d+='<div class="row" style="position: relative; left: 64%; width: 40%;"><div class="col-sm-4" style="font-size: 14px;padding-left: 11px;">差额(借-贷) : <br/><span data-name="jnadjust_balance2" id="jnadjust_balance2">'+parseFloat(0).toFixed(2)+"</span></div>",d+='<div class="col-sm-4" style="font-size: 14px;padding-left: 3px;">借方金额(合计) : <br/><span data-name="jnadjust_debit2" id="jnadjust_debit2">'+parseFloat(0).toFixed(2)+"</span></div>",d+='<div class="col-sm-4" style="font-size: 14px;padding-left: 0px;">贷方金额(合计) : <br/><span data-name="jnadjust_credit2" id="jnadjust_credit2">'+parseFloat(0).toFixed(2)+"</span></div></div>",d+='<div class="row"><table id="'+e+'" class="table table-bordered table-striped table-hover"></table></div>',$("#allTableContent2").append(d)}BdoDataTable("jnadjust_table_id",g),h("jnadjust_table_id")}else{$("#jnadjust_balance2").text("0"),$("#jnadjust_credit2").text("0"),$("#jnadjust_debit2").text("0");let e=$("table[id^=jnadjust_table_id]")[0].id;BdoDataTable(e,g),h(e)}window.editId=1,$("#adjust_close").click(function(){$("#modal_jnadjustform2").css("display","none"),delete window.maxNum,delete window.tabindex,delete window.minNum,$("#allTableContent2").html(a),window.editId=-1,u()})},h=function(e){var t=0,a=0;$("#"+e+" tbody tr").each(function(){var e=$(this).find('[name="injnvalue"]').val();e=e.replace(/,| |\t/g,"");var r=$(this).find('[name="outjnvalue"]').val();r=r.replace(/,| |\t/g,""),t+=parseFloat(parseFloat(e||0).toFixed(2)),a+=parseFloat(parseFloat(r||0).toFixed(2))});var r=$("#"+e).closest(".dataTables_wrapper").closest(".row").prev();r.find('[data-name="jnadjust_debit2"]').text(formatMoney2(a)),r.find('[data-name="jnadjust_credit2"]').text(formatMoney2(t)),r.find('[data-name="jnadjust_balance2"]').text(formatMoney2(a-t))};let x;function w(e,t,a,r){let l=$("#ast_account_table").DataTable().rows(".selected").data();0==l.length&&l.push(e);for(let e=0;e<t.length;e++){let s=t[e];for(let t=0;t<l.length;t++){if(l[t].assItemId===s.assItemId){s.oppositeSubject=a,s.oppositeSubjectLabel=r;let t=$($("#ast_account_table > tbody > tr > td > div > input")[e]);t.val(r),t.closest("tr").removeClass("selected")}}}$('input[name="checkSubjectAll"]').prop("checked",!1)}function I(t,a,r,l,s){let o,n,i=a.subjectId,d=a.subjectName,c=l[t],u={result:a.subjectId},m={};s?(i=a.oppositeSubject,o=a.oppositeSubjectLabel,u.result=a.oppositeSubject,m[a.subjectId]=String(-1*a.balance)):m[a.oppositeSubject]=String(-1*a.balance),c.oppSubjectJson=JSON.stringify(m),c.indexLength=4,c.isEliminate=!1,c.workpaperId=e.data.extraOptions.workpaperId?e.data.extraOptions.workpaperId:0,n="2"==window.showType?window.CUR_PROJECT_ACC_YEAR-1:window.CUR_PROJECT_ACC_YEAR,c.summary="负值重分类",c.subjectId=i,c.subjectName=o||i+"-"+d,1==r?c.inValue=String(-1*a.balance):c.outValue=String(-1*a.balance),c.year=n,a.assItemName&&(c.assItem=a.assItemId,c.assItemName=a.assItemName,c.assItemId=a.assItemId),l[t]=c}function y(e,t,a,r){let l,s=t.subjectId,o=t.subjectName,n={result:t.subjectId};r&&(s=t.oppositeSubject,l=t.oppositeSubjectLabel,n.result=t.oppositeSubject),$("#jnadjust_table_id > tbody > tr:nth-child("+(e+1)+") > td:nth-child(3) > input").val("负值重分类"),$("#jnadjust_table_id > tbody > tr:nth-child("+(e+1)+") > td:nth-child(5) > input").attr("data-result",s),$("#jnadjust_table_id > tbody > tr:nth-child("+(e+1)+") > td:nth-child(5) > input").attr("data-content",l||s+"-"+o),$("#jnadjust_table_id > tbody > tr:nth-child("+(e+1)+") > td:nth-child(5) > input").attr("data-contentdata",l||s+"-"+o),$("#jnadjust_table_id > tbody > tr:nth-child("+(e+1)+") > td:nth-child(5) > input").val(l||s+"-"+o),1==a?($("#jnadjust_table_id > tbody > tr:nth-child("+(e+1)+") > td:nth-child(8) > input").val(formatMoney2(-1*t.balance)),$("#jnadjust_table_id > tbody > tr:nth-child("+(e+1)+") > td:nth-child(9) > input").val(""),$("#jnadjust_table_id > tbody > tr:nth-child("+(e+1)+") > td:nth-child(8) > input").trigger("change"),$("#jnadjust_table_id > tbody > tr:nth-child("+(e+1)+") > td:nth-child(9) > input").trigger("change")):($("#jnadjust_table_id > tbody > tr:nth-child("+(e+1)+") > td:nth-child(9) > input").val(formatMoney2(-1*t.balance)),$("#jnadjust_table_id > tbody > tr:nth-child("+(e+1)+") > td:nth-child(8) > input").val(""),$("#jnadjust_table_id > tbody > tr:nth-child("+(e+1)+") > td:nth-child(8) > input").trigger("change"),$("#jnadjust_table_id > tbody > tr:nth-child("+(e+1)+") > td:nth-child(9) > input").trigger("change")),t.assItemName&&($("#jnadjust_table_id > tbody > tr:nth-child("+(e+1)+") > td:nth-child(6) > input").attr("data-content",t.assItemName),$("#jnadjust_table_id > tbody > tr:nth-child("+(e+1)+") > td:nth-child(6) > input").attr("data-result",t.assItemId),$("#jnadjust_table_id > tbody > tr:nth-child("+(e+1)+") > td:nth-child(6) > input").val(t.assItemName))}function v(){1==$('input[name="checkSubjectAll"]').is(":checked")?$("#ast_account_table tr").addClass("selected"):$("#ast_account_table tr").removeClass("selected")}var _=function(){var t,a=0;let l;var s;$("#jnadjust_plus2").click(function(){var e=$("table[id^=jnadjust_table_id]");window.maxNum++,g.tableParam.data=r,g.tableParam.data[0].num=window.maxNum,g.tableParam.data[1].num=window.maxNum;var t='style="position: relative; left: 64%; width: 40%;"';let l="jnadjust_table_id"+a++;if(e.length>0){t='style="float: right;width: 40%;top:3rem;"',g.tableParam.initComplete=function(e,t){1!=$("table[id^=jnadjust_table_id]").length&&$(this).parent().prev().css("display","none")};var s="";s+='<div class="row" '+t+'><div class="col-sm-4" style="font-size: 14px;padding-left: 25px;">差额(借-贷) : <br/><span data-name="jnadjust_balance2" id="jnadjust_balance2">'+parseFloat(0).toFixed(2)+"</span></div>",s+='<div class="col-sm-4" style="font-size: 14px;padding-left: 18px;">借方金额(合计) : <br/><span data-name="jnadjust_debit2" id="jnadjust_debit2">'+parseFloat(0).toFixed(2)+"</span></div>",s+='<div class="col-sm-4" style="font-size: 14px;padding-left: 12px;">贷方金额(合计) : <br/><span data-name="jnadjust_credit2" id="jnadjust_credit2">'+parseFloat(0).toFixed(2)+"</span></div></div>",s+='<div class="row"><table id="'+l+'" class="table table-bordered table-striped table-hover"></table></div>',$("#allTableContent2").append(s)}if(window.editId=1,0==e.length){s="";s+='<div class="row" '+t+'><div class="col-sm-4" style="font-size: 14px;padding-left: 11px;">差额(借-贷) : <br/><span data-name="jnadjust_balance2" id="jnadjust_balance2">'+parseFloat(0).toFixed(2)+"</span></div>",s+='<div class="col-sm-4" style="font-size: 14px;padding-left: 5px;">借方金额(合计) : <br/><span data-name="jnadjust_debit2" id="jnadjust_debit2">'+parseFloat(0).toFixed(2)+"</span></div>",s+='<div class="col-sm-4" style="font-size: 14px;padding-left: 0px;">贷方金额(合计) : <br/><span data-name="jnadjust_credit2" id="jnadjust_credit2">'+parseFloat(0).toFixed(2)+"</span></div></div>",s+='<div class="row"><table id="'+l+'" class="table table-bordered table-striped table-hover"></table></div>',$("#allTableContent2").append(s)}window.adjustPageId=!1,BdoDataTable(l,g)}),$("#allTableContent2").on("click",'button[name="jnadjust_plus_row"]',function(e){window.editId=0;var t=$(this).closest("tr").find("[name=jnvoucherId2]").val();$(this).closest("table").DataTable().row.add({autoId:"",subjectId:"",indexId:t,subjectName:"",subjectContent:"",adjustSubjectTB:"",adjustSubjectCodeReport:"",adjustSubjectReport:"",yyyy:"",summary:"",currency:"",currValue:"",dirction:"",occurValue:"",reason:""}).draw()}),$("#allTableContent2").on("change",'input[name="jnadjust_check"]',function(e){var t=this;if($(t).is(":checked")){var a=$(t).closest("table").attr("id"),r=($("#"+a),$(this).parents("tr").find('[name="jnsubject"]').attr("data-result"));void 0!=r&&null!=r&&""!=r?$.ajax({url:"dgCenter/DgAdjust.checkAdjustSubject.json",type:"post",data:{param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:window.CUR_PROJECT_ACC_YEAR,param4:r},dataType:"json",success:function(e){e.success&&e.data&&e.data[0]&&e.data[0].isChecked||$(t).attr("checked",!1)}}):$(t).attr("checked",!1)}}),$("#jnadjust_save2").click(function(){$("#jnadjust_table_id > tbody > tr > td > div > span.row-input > input");E($("#jnadjust_table_id tbody tr td input").first()),function(){$("#jnadjust_table_id > tbody > tr > td > div > span.row-btn > button.btn.btn-xs.btn-danger").click();let e=new Map,t=new Map,a=$('#jnadjust_table_id > tbody > tr > td input:not([disabled])[name="outjnvalue"]');for(let t=0;t<a.length;t++){let r=$(a[t]),l=r.closest("tr").find('input[name="jnsubject"]');e.set(l,r.val())}let r=$('#jnadjust_table_id > tbody > tr > td input:not([disabled])[name="injnvalue"]');for(let e=0;e<r.length;e++){let a=$(r[e]),l=a.closest("tr").find('input[name="jnsubject"]');t.set(l,a.val())}for(let a of e){let r=a[0],l=a[1];for(let a of t){let s=a[0],o=a[1];if(l===o){let a=s.attr("data-result"),n=r.attr("data-result"),i=r.closest("tr");i.find('select[name="dfSubject"]').val(a),i.find('input[name="dfValue"]').val(o);let d=s.closest("tr");d.find('select[name="dfSubject"]').val(n),d.find('input[name="dfValue"]').val(l),t.delete(s),e.delete(r);break}}}let l=e.keys();for(let a of l){let r=a,l=r.closest("tr"),s=e.get(r).replace(/,/g,""),o=Math.sign(s)<0;for(let a of t){let n=a[0],i=n.closest("tr"),d=r.attr("data-result"),c=t.get(n).replace(/,/g,""),u=Math.sign(c)<0;if(Math.max(s,c)!=s){if(o&&u){""!=i.find("input[name=dfValue]").last().val()&&P(i.find("button[name=dfAdd]").last()),i.find('select[name="dfSubject"]').last().val(d),i.find('input[name="dfValue"]').last().val(c),t.delete(n);let a=n.attr("data-result");""!=l.find("input[name=dfValue]").last().val()&&P(l.find("button[name=dfAdd]").last()),l.find('select[name="dfSubject"]').last().val(a),l.find('input[name="dfValue"]').last().val(s),s=k(s,c),e.set(r,s+""),t.delete(n);continue}let a=n.attr("data-result");""!=l.find("input[name=dfValue]").last().val()&&P(l.find("button[name=dfAdd]").last()),l.find('select[name="dfSubject"]').last().val(a),l.find('input[name="dfValue"]').last().val(s),""!=i.find("input[name=dfValue]").last().val()&&P(i.find("button[name=dfAdd]").last()),i.find('select[name="dfSubject"]').last().val(d),i.find('input[name="dfValue"]').last().val(s),c=k(c,s),e.delete(r),t.set(n,c+"");break}{if(o&&u&&s!=c){let a=n.attr("data-result");""!=l.find("input[name=dfValue]").last().val()&&P(l.find("button[name=dfAdd]").last()),l.find('select[name="dfSubject"]').last().val(a),l.find('input[name="dfValue"]').last().val(s),""!=i.find("input[name=dfValue]").last().val()&&P(i.find("button[name=dfAdd]").last()),i.find('select[name="dfSubject"]').last().val(d),i.find('input[name="dfValue"]').last().val(s),c=k(c,s),e.delete(r),t.set(n,c+"");break}""!=i.find("input[name=dfValue]").last().val()&&P(i.find("button[name=dfAdd]").last()),i.find('select[name="dfSubject"]').last().val(d),i.find('input[name="dfValue"]').last().val(c),t.delete(n);let a=n.attr("data-result");""!=l.find("input[name=dfValue]").last().val()&&P(l.find("button[name=dfAdd]").last()),l.find('select[name="dfSubject"]').last().val(a),l.find('input[name="dfValue"]').last().val(c),s=k(s,c),t.delete(n),e.set(r,s+"")}}}R(e,e),R(t,t),$('select[name="dfSubject"]').each(function(){let e=$(this).parent().next().find("button").last().attr("name");""==$(this).next().val()&&"dfAdd"!=e&&$(this).parent().parent().remove()})}()}),$("#adjust_close").click(function(){$("#heavy_classification").show()}),$("#jnadjust_save2").bind("commit",function(){var t=[],a=!0,r=!0,l=!0;let s=!0;if(!function(){let e=$("#jnadjust_table_id > tbody > tr "),t=0,a=0;for(let r=0;r<e.length;r++){let l=$(e[r]),s=1,o=$(l.find("input")[8]).val();""!=$(l.find("input")[9]).val()&&(s=-1,o=$(l.find("input")[9]).val());let n=$(l.find("td")[9]),i=n.find("div span.row-input input"),d=n.find("div span.row-input select option:selected"),c=0;for(let e=0;e<d.length;e++){let r,l=$(d[e]).text(),s=$(i[e]).val();s=s.replace(/,| |\t/g,""),(l+"").startsWith("借：")?t+=r=parseFloat(parseFloat(s||0).toFixed(2)):a+=r=parseFloat(parseFloat(s||0).toFixed(2)),c+=r}if(String(parseFloat(c).toFixed(2))!=String(parseFloat(o.replace(/,/g,"")).toFixed(2)))return!1}return String(parseFloat(a).toFixed(2))===String(parseFloat(t).toFixed(2))}())return void bdoErrorBox("失败","对方科目分析金额借贷不平。");if($(".row").find('[data-name="jnadjust_balance2"]').each(function(){0!=$(this).html()&&(a=!1)}),!a)return void bdoErrorBox("失败","借贷额不平。");var o=[],n=1;if($("#allTableContent2 table").each(function(){if(!$(this).attr("id"))return;var i=!1,d=!1;let c=!1;$(this).find("tbody tr").size()>2&&(c=!0);let u=0,m=0;$(this).find("tbody tr").each(function(){var r=$(this).find('[name="jnadjust"]').val(),l=$(this).find('[name="jnadjust"]').attr("data-content")?$(this).find('[name="jnadjust"]').attr("data-content"):"",s=$(this).find('[name="jnsummary"]').val(),c=$(this).find('[name="assitemType"]').attr("data-result");let p=$(this).find('[name="assitemType"]').attr("data-content");var b=$(this).find('[name="jnsubject"]').attr("data-result"),g=$(this).find('[name="jnsubject"]').attr("data-content");":"!==r&&""!==l||(o.push(g),a=!1),!d&&b.startsWith(e.data.extraOptions.userSubjectId)&&(d=!0),!i&&s&&(i=!0);var f=$(this).find('[name="jnvoucherId2"]').val(),h=f.substring(-1,f.length-5);let x=$(this).find("td:nth-child(10) > div"),w={};for(let e=0;e<x.length;e++){let t=$(x[e]),a=t.find('select[name="dfSubject"]').val(),r=t.find('input[name="dfValue"]').val().replace(/,/g,"");w[a]?w[a]=parseFloat(w[a])+parseFloat(r):w[a]=r}t.push({autoId:$(this).find('[name="jnautoId"]').val(),reason:$(this).find('[name="jnautoReason"]').val(),voucherId:$(this).index()+1,indexId:$(this).find('[name="jnvoucherId2"]').val(),adjustSubjectTB:r,subjectId:b,subjectName:g,summary:s,activeFlag:$(this).find('[name="active_flag"]').val()?$(this).find('[name="active_flag"]').val():"",outValue:$(this).find('[name="injnvalue"]').val().replace(/,| |\t/g,""),inValue:$(this).find('[name="outjnvalue"]').val().replace(/,| |\t/g,""),assItem:c,assItemName:p,assItemId:c,rownum:n++,workpaperId:e.data.extraOptions.workpaperId?e.data.extraOptions.workpaperId:0,indexKey:h,oppSubjectJson:w,sortNo:m,indexLength:4,isEliminate:$(this).find('[name="jnadjust_check"]').is(":checked")}),m++,""!==s&&u++}),c&&u!==$(this).find("tbody tr").size()?s=!1:i?d||(l=!1):r=!1}),e.data.extraOptions.userSubjectId&&!l)return void bdoErrorBox("失败","请重新选择科目，每一笔调整必须包含【"+e.data.extraOptions.userSubjectName+"】科目");if(!r)return void bdoErrorBox("失败","每一笔至少一条摘要。");if(2===t.length){let e=t[0].summary,a=t[1].summary;""===e&&""!==a?t[0].summary=a:""!==e&&""===a&&(t[1].summary=e)}if(!s)return void bdoErrorBox("失败","一借多贷或一贷多贷调整摘要必须全部填写！");if(!a)return void bdoErrorBox("失败","【"+o.toString()+"】科目未对照， 请先添加科目对照。");if(window.hasSubmit)return!1;window.hasSubmit=!0;let i=$("#adjustYear").val();if($("#jnadjust_type2").text()&&"1"==$("#jnadjust_type2").text()&&(i=$("#jnadjust_dgYear2").text()),i||(i=$("#jnadjust_dgYear2").text()),0==$("table[id^=jnadjust_table_id]").length)return window.hasSubmit=!1,$("#modal_jnadjustform2").hide(),!1;bdoInProcessingBox("正在保存调整分录!");let d=$("#jnadjust_type3").text()?1:0;$.ajax({url:"dgCenter/DgAdjust.mulvoucherAdjust.json",type:"post",data:{param1:JSON.stringify(t),param2:window.CUR_CUSTOMERID,param3:i,param4:$("#jnadjust_type2").text(),param5:window.CUR_PROJECTID,param6:window.showType,param10:d},dataType:"json",success:function(e){window.hasSubmit=!1,$("#searchInput3").val(""),e.success?($("#jnadjust_type3").text(""),bdoSuccessBox("成功",e.resultInfo.statusText),$("#jnadjust_table_id").closest(".dataTables_wrapper").closest(".row").nextAll().remove(),$("#"+$("table[id^=jnadjust_table_id]")[0].id).closest(".dataTables_wrapper").closest(".row").parent().children().remove(),$("#jnadjust_dgYear2").text(c),$("#modal_jnadjustform2").hide(),u(),$("#jnadjust_type2").text()&&"1"==$("#jnadjust_type2").text()&&$("#rpt_search").click()):bdoErrorBox("失败",e.resultInfo.statusText)}}),$("#jnadjust_type3").text("")}),$("#allTableContent2").on("click",'button[name="jnDelete"]',function(e){var t=$(this).closest("table").attr("id"),a=$("#"+t),r=$(this),l=a.DataTable().row([r.closest("tr").index()]),s=a.DataTable().data()[r.closest("tr").index()];a.DataTable().rows()[0].length<3?s.autoId?bdoConfirmBox("删除","是否删除此项凭证下所有分录?",function(){$.ajax({url:"dgCenter/DgAdjust.journalDelete.json",type:"post",data:{param1:s.autoId},dataType:"json",success:function(e){e.success?($("#modal_jnadjustform2").hide(),u(),bdoSuccessBox("成功",e.resultInfo.statusText)):bdoErrorBox("失败",e.resultInfo.statusText)}})}):bdoConfirmBox("删除","是否删除此凭证?",function(e){window.maxNum--;var r=$($.fn.dataTable.tables(!0)),l=a.closest(".dataTables_wrapper").closest(".row");r.eq(1).attr("id")==t&&r.length>2&&(l.next().css({top:"0px"}),r.eq(2).parents(".row").eq(1).prev().css({float:"none",position:"relative",left:"64%",top:"0px"}),r.eq(2).parents(".row").eq(1).prev().children().eq(0).css({"padding-left":"11px"}),r.eq(2).parents(".row").eq(1).prev().children().eq(1).css({"padding-left":"3px"}),r.eq(2).parents(".row").eq(1).prev().children().eq(2).css({"padding-left":"0px"}),r.eq(2).parent().prev().css("display","block")),l.prev().remove(),l.remove(),window.editId=1;let s=$.fn.dataTable.tables(!0).length-1;$(s).each(function(e,t){var a=$(this).closest("tr").find("[name=jnvoucherId2]").val();a.val(a),a.parent().html(a+1)}),$($("table[id^=jnadjust_table_id]")[0]).DataTable().ajax.reload()}):(l.remove().draw(),a.find("[name=jnadjust_plus_row]").eq(0).css("visibility","visible").prop("disabled",!1),h(t))}),$("#allTableContent2").on("focus",'input[name="jnsubject"]',function(){t=this,l=$(this).parent().parent().find('input[name="jnadjust"]');$(this).attr("data-result"),$(this).attr("data-content"),$(this);let e;$(this).unbind(),$("#modal_subjectid").modal("show"),e="2"==window.showType?c-1:c,$("#adsubject_tree").tree4({url:"dgCenter/DgAdjustTree.findAccSubjectType.json",params:{param9:window.CUR_CUSTOMERID,param10:e,param11:window.CUR_PROJECTID,param12:window.showType,searchInputId:"searchInput2"},singleSelect:!0,view:{leafIcon:"fa fa-building text-flat",nodeIcon:"fa fa-bank text-primary-light",folderSelectable:!1,multiSelect:!1,showCheckbox:!0,selectedColor:"",selectedBackColor:""}})}),$("#modal_subject_sure").click(function(){if(dt=$("#adsubject_tree").treeview(!0).getSelected()[0],void 0==dt)$(t).val(""),$(l).val("");else{$(t).attr("data-result",dt.id),$(t).attr("data-content",dt.text),$(t).attr("data-contentdata",dt.label);var e={result:$(t).attr("data-result"),content:$(t).attr("data-content"),contentdata:$(t).attr("data-contentdata")};$(t).val(dt.text),function(e,t,a){var r=a.result,l=e.closest("tr").find("[name=assitemType]");if(l.val(""),l.attr("data-result",""),l.attr("data-content",""),!r){var s=e.closest("tr").find("[name=jnadjust]");return s.val(""),s.attr("data-result",":"),void s.attr("data-content","")}let o;o="2"==window.showType?window.CUR_PROJECT_ACC_YEAR-1:window.CUR_PROJECT_ACC_YEAR;$.ajax({url:"dgCenter/DgAdjust.findTBSubjectType.json",type:"post",data:{param14:window.CUR_CUSTOMERID,param15:departIdSession,param16:r,param17:window.CUR_PROJECTID,param18:o},dataType:"json",success:function(t){var a=e.closest("tr").find("[name=jnadjust]");if(t.data&&0!=t.data.length){var r=t.data[0];a.val(r.label),a.attr("data-result",r.label),a.attr("data-content",r.label)}else a.val(""),a.attr("data-result",""),a.attr("data-content","")}})}($(t),0,e)}$("#modal_subjectid").modal("hide"),$("#adsubject_tree").tree4("reset")}),$("#modal_subject_reset").click(function(){$("#adsubject_tree").tree4("reset")}),$("#allTableContent2").on("focus",'input[name="assitemType"]',function(){t=this;var e=$(this).closest("tr").find("[name=jnsubject]").attr("data-result");e&&($("#modal_assitem").modal("show"),$("#assitem_tree").tree2({url:"finCenter/FinTreeCommon.findSubjectAssitem.json",params:{lockCustomerId:window.CUR_CUSTOMERID,lockYyyy:c,param11:e,searchInputId:"searchInput3",param19:$("#searchInput3").val()},singleSelect:!0,view:{leafIcon:"fa fa-building text-flat",nodeIcon:"fa fa-bank text-primary-light",folderSelectable:!0,multiSelect:!1,showCheckbox:!0,selectedColor:"",selectedBackColor:""}}),$("#searchInput3").attr("placeholder","搜索客户"))}),$("#modal_assitem_reset").click(function(){$("#modal_assitem").modal("hide"),$("#assitem_tree").tree2("reset"),$("#searchInputAssitem").keyup()}),$("#modal_assitem_sure").click(function(){void 0==(s=$("#assitem_tree").treeview(!0).getSelected()[0])?$(t).val(""):($(t).attr("data-result",s.id),$(t).attr("data-content",s.qtip),$(t).attr("data-contentdata",s.label),$(t).val(s.text)),$("#modal_assitem").modal("hide"),$("#assitem_tree").tree2("reset")}),$("#modal_subjectid_reset").click(function(){$("#adsubject_tree").tree4("reset")}),$("#allTableContent2").on("change",'[name="injnvalue"]',function(e){var t=!$(this).val();$(this).parent().prev().children().prop("disabled",!t),h($(this).closest("table").attr("id")),E($(this));let a=$("#jnadjust_table_id > tbody > tr > td > div > span.row-input > input");for(let e=0;e<a.length;e++)""!=a[e].value&&$(a[e]).val("")}),$("#allTableContent2").on("change",'[name="outjnvalue"]',function(e){var t=!$(this).val();$(this).parent().next().children().prop("disabled",!t),h($(this).closest("table").attr("id")),E($(this));let a=$("#jnadjust_table_id > tbody > tr > td > div > span.row-input > input");for(let e=0;e<a.length;e++)""!=a[e].value&&$(a[e]).val("")}),$("#heavy_classification").click(D),$("#ast_account_table").on("click","tbody tr",function(){$(this).toggleClass("selected")}),$("#ast_account_table").on("click","tbody > tr > td:nth-child(6)",function(){$(this).closest("tr").toggleClass("selected")}),$("#vch_account_table").on("click","tbody tr",function(){$(this).find('input[name="checkrow"]').prop("checked",$(this).hasClass("selected")),$(this).toggleClass("selected")}),$("#vch_filter_subject").focus(function(){if($("#modal_vch_subjectid").modal("show"),$("#subject_tree").hasClass("treeview"))return;let e=$("#adjustYear").val();$("#jnadjust_type2").text()&&"1"==$("#jnadjust_type2").text()&&(e=$("#jnadjust_dgYear2").text()),$("#subject_tree").tree({url:"finCenter/FinTreeCommon.findAccSubjectType.json",params:{lockCustomerId:window.CUR_CUSTOMERID,lockYyyy:e,searchInputId:"searchInput1"},singleSelect:!0,lazyLoad:!1,onceLoad:!0,view:{leafIcon:"fa fa-building text-flat",nodeIcon:"fa fa-bank text-primary-light",folderSelectable:!1,multiSelect:!1,showCheckbox:!0,selectedColor:"",selectedBackColor:""}})}),$("#modal_vch_subjectid_sure").click(function(){let e=$("#subject_tree").tree("getTreeMultiValue"),t=$("#subject_tree").tree("getCheckedData")[0];t&&t.parentId?function e(t,a){let r=$("#"+t).treeview(!0).getNode(a);r&&r.parentId?e(t,r.parentId):$("#vch_filter_subject").val(r.id)}("subject_tree",t.parentId):"object"==typeof e?$("#vch_filter_subject").val(""):$("#vch_filter_subject").val(e),"object"==typeof e?$("#vch_filter_subject").val(""):$("#vch_filter_subject").val(e),T.localParam.urlparam.param2=$("#vch_filter_subject").val(),$("#modal_vch_subjectid").modal("hide");let a=$("#adjustYear").val();$("#jnadjust_type2").text()&&"1"==$("#jnadjust_type2").text()&&(a=$("#jnadjust_dgYear2").text()),T.localParam.urlparam.param1=a,S()}),$("#modal_vch_subjectid_reset").click(function(){$("#subject_tree").tree("reset"),$("#vch_filter_subject").val("")}),$("#vch_filter_accItem").focus(function(){$("#modal_assitemid").modal("show");let e=$("#adjustYear").val();$("#jnadjust_type2").text()&&"1"==$("#jnadjust_type2").text()&&(e=$("#jnadjust_dgYear2").text()),$("#modal_vch_assItem").tree2({url:"finCenter/FinTreeCommon.findSubjectAssitem.json",params:{lockCustomerId:window.CUR_CUSTOMERID,lockYyyy:e,searchInputId:"searchInputVchAcc",param11:$("#vch_filter_subject").val()},view:{leafIcon:"fa fa-building text-flat",nodeIcon:"fa fa-bank text-primary-light",folderSelectable:!1,multiSelect:!0,showCheckbox:!0,selectedColor:"",selectedBackColor:""}})}),$("#modal_assitemid_sure").click(function(){let e=$("#modal_vch_assItem").tree2("getTreeMultiValue");"object"==typeof e||void 0==e||"undefined"==e?$("#vch_filter_accItem").val(""):$("#vch_filter_accItem").val(e),T.localParam.urlparam.param4=$("#vch_filter_accItem").val(),S(),$("#modal_assitemid").modal("hide")}),$("#modal_assitemid_reset").click(function(){$("#modal_vch_assItem").tree2("reset"),$("#searchInputVchAcc").keyup()}),$("#modal_jnadjustform2").on("click","#vch_checkall",function(){let e=$(this).prop("checked");$('#vch_account_table input[name="checkrow"]').each(function(){$(this).prop("checked",e),e?$(this).closest("tr").addClass("selected"):$(this).closest("tr").removeClass("selected")})}),$("#modal_vch_opp_subjectid_sure").click(function(){let e=$("#opp_subject_tree").treeview(!0).getSelected()[0],t=$("#ast_account_table").DataTable().rows().data();if(void 0==typeof e)return w(x,t,"",""),void $("#modal_vch_opp_subjectid").modal("hide");let a=e.label,r=e.value;r?w(x,t,r,a):w(x,t,"",""),$("#modal_vch_opp_subjectid").modal("hide")}),$("#modal_vch_opp_subjectid_reset").click(function(){$("#opp_subject_tree").tree4("reset")})};let j=1,C={localParam:{tabNum:!1,urlparam:{}},tableParam:{select:!1,lengthChange:!1,dom:'<"row"<"col-sm-6"i><"col-sm-6">><"row"<"col-sm-12"tr>><"row"<"col-sm-6"i><"col-sm-6">>',ordering:!1,serverSide:!0,fixedThead:!0,columnDefs:[{targets:j++,className:"text-left",title:'<label class="css-input css-checkbox css-checkbox-primary"><input type="checkbox" name="checkSubjectAll"/><span></span></label>科目编号',name:"subjectId",data:"subjectId",width:"60px"},{targets:j++,className:"text-left",title:"科目名称",name:"subjectName",data:"subjectName",width:"100px"},{targets:j++,className:"text-left",title:"核算编号",name:"assItemId",data:"assItemId",width:"60px"},{targets:j++,className:"text-left",title:"核算名称",name:"assItemName",data:"assItemName",width:"100px"},{targets:j++,className:"text-right",title:"金额",name:"balance",data:"balance",width:"80px",render:function(e,t,a,r){return formatMoney(e)}},{targets:j++,className:"text-left",title:"对方科目",width:"100px",name:"oppositeSubject",data:"oppositeSubject",render:function(){return'<div class="form-material col-xs-8 col-sm-8 col-lg-8 bg-success-light" style="width: 100%;height: 22px;padding-right: 0px;margin-bottom: 0px;padding-left: 0px;margin-top: 0px;">\n<input name="oppositeSubject" class="form-control" style="\n    padding-bottom: 0px;\n    padding-top: 0px;\n    height: 20px;\n"></div>'}}]}},T={localParam:{tabNum:!1,url:"dgCenter/DgAdjust.queryAmountSubject.json",urlparam:{menuId:window.sys_menuId}},tableParam:{select:!1,lengthChange:!1,dom:"tr",fixedThead:!0,ordering:!1,serverSide:!0,createdRow(e,t,a){$(e).children("td").eq(0).html('<label class="css-input css-checkbox css-checkbox-sm css-checkbox-primary"><input type="checkbox" name="checkrow"><span></span></label>')},columns:[{className:"treegrid-control",data:function(e){return null!=e.children&&e.children.length>0?"<span> + </span>":""}},{data:"assItemId"},{data:"assItemName"},{data:"subjectId"},{data:"subjectName"},{data:"balance"}],columnDefs:[{defaultContent:"",targets:"_all"}]}};function D(){$("#vch_adjust_modal").modal("show"),$("#vch_filter_subject").val(""),$("#vch_filter_accItem").val("");let e=$("#adjustYear").val();$("#jnadjust_type2").text()&&"1"==$("#jnadjust_type2").text()&&(e=$("#jnadjust_dgYear2").text()),T.localParam.urlparam.param1=e,JSON.parse($.sessionStorage("subjecttreeNode"))&&$("#jnadjust_type2").text()&&"1"!=$("#jnadjust_type2").text()?(T.localParam.urlparam.param2=JSON.parse($.sessionStorage("subjecttreeNode")).extraOptions.userSubjectId,T.localParam.urlparam.param3=1,$("#vch_filter_subject").val(T.localParam.urlparam.param2),$("#vch_filter_subject").prop("disabled","disabled"),S(!0)):(T.localParam.urlparam.param2="",T.localParam.urlparam.param4="",S(!1))}function S(e){var t=$("#vch_account_table");t.hasInited?$("#vch_account_table").treegrid("load",T.localParam.urlparam):(e?easyloader.load(["treegrid"],function(){t.treegrid({height:600,width:"100%",idField:"autoId",treeField:"subjectId",border:"none",singleSelect:!0,animate:!0,checkbox:!0,expanderExpandedClass:"glyphicon glyphicon-minus",expanderCollapsedClass:"glyphicon glyphicon-plus",queryParams:T.localParam.urlparam,columns:[[{title:"科目编号",field:"subjectId",width:150},{field:"assItemId",title:"核算编号",width:135},{field:"assItemName",title:"核算名称",width:360},{field:"balance",title:"金额",align:"right",width:175,formatter:function(e,t,a){return formatMoney(e)}}]],loader:function(e,t,a){$.ajax({url:"dgCenter/DgAdjust.queryAmountSubject.json",type:"post",data:e,dataType:"json",success:function(e){e.success?(t({rows:e.data,total:e.data.length}),$("#vch_account_table").treegrid("resize")):bdoErrorBox("查询科目信息异常",e.resultInfo.statusText)}})},onBeforeExpand:function(e){},onLoadSuccess:function(e,t){$("#vch_account_table").treegrid("collapseAll"),$("#vch_account_table").treegrid("clearChecked")},onDblClickRow:function(e){t.treegrid("toggle",e.id)}}),t.hasInited=!0}):easyloader.load(["treegrid"],function(){t.treegrid({height:600,width:"100%",idField:"autoId",treeField:"subjectId",border:"none",singleSelect:!0,animate:!0,checkbox:!0,expanderExpandedClass:"glyphicon glyphicon-minus",expanderCollapsedClass:"glyphicon glyphicon-plus",queryParams:T.localParam.urlparam,columns:[[{title:"科目编号",field:"subjectId",width:165},{field:"subjectName",title:"科目名称",width:190,align:"left"},{field:"assItemId",title:"核算编号",width:130},{field:"assItemName",title:"核算名称",width:160},{field:"balance",title:"金额",width:200,align:"right",width:175,formatter:function(e,t,a){return formatMoney(e)}}]],loader:function(e,t,a){$.ajax({url:"dgCenter/DgAdjust.queryAmountSubject.json",type:"post",data:e,dataType:"json",success:function(e){e.success?(t({rows:e.data,total:e.data.length}),$("#vch_account_table").treegrid("resize")):bdoErrorBox("查询科目信息异常",e.resultInfo.statusText)}})},onBeforeExpand:function(e){},onLoadSuccess:function(e,t){$("#vch_account_table").treegrid("collapseAll"),$("#vch_account_table").treegrid("clearChecked")},onDblClickRow:function(e){t.treegrid("toggle",e.id)}}),t.hasInited=!0}),setTimeout("$('#vch_account_table').treegrid('resize');",500))}function P(e){let t=$(e).closest("div").find(".row-input"),a=$('<span class="row-btn"></span>').append(s).append(o).append(i);$(e).closest("tr").attr("data-change","1");let r=$("<div>"+t.prop("outerHTML")+a.prop("outerHTML")+"</div>");r.find("input").val(),$(e).closest("td").append(r)}function R(e,t){let a=e.keys();for(let r of a){let a=r,l=a.closest("tr"),s=e.get(a).replace(/,/g,""),o=Math.sign(s)<0;for(let r of t){let n=r[0];if(a==n)break;let i=n.closest("tr"),d=a.attr("data-result"),c=t.get(n).replace(/,/g,""),u=Math.sign(c)<0;if(Math.max(s,c)!=s){if(o&&u)continue;if(o){let r=n.attr("data-result");""!=l.find("input[name=dfValue]").last().val()&&P(l.find("button[name=dfAdd]").last()),l.find('select[name="dfSubject"]').last().val(r),l.find('input[name="dfValue"]').last().val(s),""!=i.find("input[name=dfValue]").last().val()&&P(i.find("button[name=dfAdd]").last()),c=k(c,s),s=(s+="").replace("-",""),i.find('select[name="dfSubject"]').last().val(d),i.find('input[name="dfValue"]').last().val(s),e.delete(a),t.set(n,c+"");break}{let r=n.attr("data-result");""!=l.find("input[name=dfValue]").last().val()&&P(l.find("button[name=dfAdd]").last()),l.find('select[name="dfSubject"]').last().val(r),l.find('input[name="dfValue"]').last().val(s),""!=i.find("input[name=dfValue]").last().val()&&P(i.find("button[name=dfAdd]").last()),i.find('select[name="dfSubject"]').last().val(d),i.find('input[name="dfValue"]').last().val(s),c=N(c,s),e.delete(a),t.set(n,c+"");break}}if(!o||!u||s==c)if(u){""!=i.find("input[name=dfValue]").last().val()&&P(i.find("button[name=dfAdd]").last()),i.find('select[name="dfSubject"]').last().val(d),i.find('input[name="dfValue"]').last().val(c);let r=n.attr("data-result");""!=l.find("input[name=dfValue]").last().val()&&P(l.find("button[name=dfAdd]").last()),l.find('select[name="dfSubject"]').last().val(r),c+="",l.find('input[name="dfValue"]').last().val(c.replace("-","")),s=N(s,c),t.delete(n),e.set(a,s+"")}else{""!=i.find("input[name=dfValue]").last().val()&&P(i.find("button[name=dfAdd]").last()),i.find('select[name="dfSubject"]').last().val(d),i.find('input[name="dfValue"]').last().val(c);let r=n.attr("data-result");""!=l.find("input[name=dfValue]").last().val()&&P(l.find("button[name=dfAdd]").last()),l.find('select[name="dfSubject"]').last().val(r),l.find('input[name="dfValue"]').last().val(c),s=N(s,c),t.delete(n),e.set(a,s+"")}}}}function k(e,t){let a,r,l,s;try{l=e.toString().split(".")[1].length}catch(e){l=0}try{s=t.toString().split(".")[1].length}catch(e){s=0}return a=l>=s?l:s,r=((e*Math.pow(10,a)-t*Math.pow(10,a))/Math.pow(10,a)).toFixed(a)}function N(e,t){let a,r,l,s;try{l=e.toString().split(".")[1].length}catch(e){l=0}try{s=t.toString().split(".")[1].length}catch(e){s=0}return a=l>=s?l:s,r=((e*Math.pow(10,a)+t*Math.pow(10,a))/Math.pow(10,a)).toFixed(a)}function E(e){let t=$('<select style="width:120px;" name="dfSubject"></select>');e.closest("table").find("tr[class]").each(function(){let e=$(this),a=$("<option/>");e.find("td > input[name]").each(function(){let e=$(this);switch(e.prop("name")){case"jnsubject":let t=e.attr("data-result");t&&a.attr("value",t);break;case"outjnvalue":e.prop("disabled")?(a.prop("value"),a.text("贷："+a.prop("value"))):a.text("借："+a.prop("value"))}}),a.attr("value")&&t.append(a),t.find("option:contains("+a.attr("value")+")").length>1&&t.find("option:contains("+a.attr("value")+"):gt(0)").remove()}),$('select[name="dfSubject"]').each(function(){let e=$(this);e.find("option:selected")&&t.find('option[value="'+e.find("option:selected").attr("value")+'"]').attr("selected",!0),e.html(t.html()),t.find("option:selected").attr("selected",!1)})}var A={};return A.mount=function(){t=e.template||tplLoader("dgCenter/html/dg/adjust.html"),e.template=t,window.adjustDgNO=e.data.extraOptions.indexId,$(e.region).empty().append(t),function(){a=$("#allTableContent2").html();var t={menuId:window.sys_menuId,sqlId:"FA10064",param1:window.CUR_CUSTOMERID,param2:c,param3:"2",param4:e.data.extraOptions.userSubjectId?e.data.extraOptions.userSubjectId:e.data.extraOptions.tbSubjectCode,param5:window.CUR_PROJECTID,param6:c};e.data.extraOptions.userSubjectId&&""!=e.data.extraOptions.userSubjectId&&(t.param2=c-1),p.localParam.urlparam=t,BdoDataTable("adjustTable",p)}(),b(),_()},$("adjustTable_processing").hide(200),A.tableModel=p,A.journal=f,A.setIndexId=function(t){window.adjustDgNO=t,e.data.extraOptions.indexId=t},$.ajax({url:"dgCenter/DgProject.getProjectInfo.json",type:"post",data:{param1:CUR_PROJECTID,param2:CUR_CUSTOMERID},dataType:"json",success:function(e){e.success&&e.data[0]&&e.data[0].projectInfo&&(d=e.data[0].projectInfo.manager)}}),A},DgPostilPage=e=>{let t,a,r,l,s,o,n;n=(()=>{e.isSingle&&$("#closePostilSide").on("click",e=>{$("#postilmodal").modal("hide")}),$('#postilTab [data-toggle="tabs"] a').on("show.bs.tab",function(e){var t=e.target.href,a=t.lastIndexOf("#"),r=t.substring(a+1);switch(o.newPostilBtnShow=!1,o.onPostilClose(),r){case"postilTab2":(2&o.userAuditState)>>1==1&&(o.newPostilBtnShow=!0),o.auditState=100;break;case"postilTab3":(4&o.userAuditState)>>2==1&&(o.newPostilBtnShow=!0),o.auditState=200;break;case"postilTab6":(8&o.userAuditState)>>3==1&&(o.newPostilBtnShow=!0),o.auditState=300;break;case"postilTab1":(16&o.userAuditState)>>4==1&&(o.newPostilBtnShow=!0),o.auditState=400;break;case"postilTab4":(32&o.userAuditState)>>5==1&&(o.newPostilBtnShow=!0),o.auditState=500;break;case"postilTab5":(64&o.userAuditState)>>6==1&&(o.newPostilBtnShow=!0),o.auditState=600;break;case"postilTab7":(128&o.userAuditState)>>7==1&&(o.newPostilBtnShow=!0),o.auditState=700}})}),o=new Vue({el:"#vmpostilPage",data:{postils1:[],postils2:[],postils3:[],postils4:[],postils5:[],postils6:[],postils7:[],postils:[],newContent:!1,postilContent:"",cellContent:l,type:"",auditState:0,threadParam:{},customerId:e.customerId,projectId:e.projectId,isSingle:!1,userAuditState:0,newPostilBtnShow:!1,postilLevel:2},watch:{newContent(e,t){1==e?$(".postil-content").css({bottom:"190px"}):$(".postil-content").css({bottom:"0px"}),this.type==r?($("#postilFormBlock").find("table").find("td:eq(2)").show(),$("#postilFormBlock").find("table").find("td:eq(3)").show()):($("#postilFormBlock").find("table").find("td:eq(2)").hide(),$("#postilFormBlock").find("table").find("td:eq(3)").hide())},auditState(t,a){let l=this,o=(this.getPostils(),"DG00077");"HB"!=r.substring(0,2)&&"MERGENOTE"!=r.substring(0,9)||(o="DG20011"),this.fetch({menuId:window.sys_menuId,sqlId:o,param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:(()=>e.isSingle?e.data.autoId:null)(),param4:t,param5:s,param6:r,start:-1,limit:-1},e=>{e.success&&l.buildData(e.data)})},postilContent(e,t){if(this.$postilContentEl){e!=this.$postilContentEl.summernote("code")&&this.$postilContentEl.summernote("code",e)}}},methods:{fetchProjectInfo(){let e=$.Deferred();return window.CUR_PROJECTID&&window.CUR_CUSTOMERID&&window.CUR_CUSTOMERID>""&&window.CUR_PROJECTID>""?($.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",data:{menuId:window.sys_menuId,sqlId:"DG00061",param1:window.CUR_PROJECTID,param2:window.CUR_CUSTOMERID},dataType:"json",success(t){t.success&&e.resolve(t)}}),e):(e.resolve({}),e)},getPostils(){switch(this.auditState){case 100:return this.postils2;case 200:return this.postils3;case 300:return this.postils6;case 400:return this.postils1;case 500:return this.postils4;case 600:return this.postils5;case 700:return this.postils7}},buildData(t){let a=[],l={};if($.each(t,(e,t)=>{if(t.type==r)l[t.autoId]=t,a.push(l[t.autoId]);else{let e=l[t.annotationId];e&&!e.comments&&(e.comments=[]),e&&e.comments.push(t)}}),e.isSingle)this.postils=a;else switch(this.auditState){case 100:return void(this.postils2=a);case 200:return void(this.postils3=a);case 300:return void(this.postils6=a);case 400:return void(this.postils1=a);case 500:return void(this.postils4=a);case 600:return void(this.postils5=a);case 700:return void(this.postils7=a)}},submitPostil(e,t){var a="dgCenter/DgPostil.savePostil.json";"HB"!=r.substring(0,2)&&"MERGENOTE"!=r.substring(0,9)&&"MERGENOTE2"!=r.substring(0,10)||(a="dgCenter/HbMergePostil.savePostil.json"),$.ajax({type:"post",url:a,data:e,dataType:"json",success(e){t&&t(e)}})},fetch(t,a){e.isSingle&&(t.param4=void 0),$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",data:t,dataType:"json",success(e){a&&a(e)}})},onSubmitPostil(e){var t=this,l=this.getPostils();let o=$("<div>"+this.postilContent+"</div>").text();if(this.type==r){if(this.postilContent&&""!=this.postilContent){let e={param1:t.type,jsonData:JSON.stringify({customerId:t.customerId,projectId:t.projectId,content:$.base64.encode(encodeURIComponent(t.postilContent)),contentText:o,cellContent:t.cellContent,type:r,auditState:t.auditState,foreignId:s,postilLevel:t.postilLevel})};this.submitPostil(e,e=>{if(e.success){let a=e.data[0].data,o="DG00077";"HB"!=r.substring(0,2)&&"MERGENOTE"!=r.substring(0,9)||(o="DG20011"),t.fetch({menuId:window.sys_menuId,sqlId:o,param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:a.autoId,param4:t.auditState,param5:s,param6:r,start:-1,limit:-1},e=>{e.success&&l.push(e.data[0])}),t.onPostilClose()}else a.autoHide=!1,bdoErrorBox("失败",e.resultInfo.statusText)})}}else if("C001"==this.type){let e=this.threadParam.postilActionAgrs[1];if(this.postilContent&&""!=this.postilContent){let a={param1:t.type,jsonData:JSON.stringify({customerId:window.CUR_CUSTOMERID,projectId:window.CUR_PROJECTID,content:$.base64.encode(encodeURIComponent(t.postilContent)),contentText:o,cellContent:t.cellContent,type:t.type,annotationId:e.autoId,commentedUser:e.__ucreateUser.userId})};this.submitPostil(a,a=>{if(a.success){let l=a.data[0].data,o="DG00152";"HB"!=r.substring(0,2)&&"MERGENOTE"!=r.substring(0,9)||(o="DG00332"),t.fetch({menuId:window.sys_menuId,sqlId:o,param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:l.annotationId,param4:t.auditState,param5:s,param6:r,param7:l.autoId},t=>{t.success&&(e.comments||(e.comments=[]),e.comments.push(t.data[0]))}),t.onPostilClose()}else postilPage.autoHide=!1,bdoErrorBox("失败",a.resultInfo.statusText)})}}else if("C002"==this.type){let e=this.threadParam.postilActionAgrs[1],a=this.threadParam.postilActionAgrs[2];if(this.postilContent&&""!=this.postilContent){let l={param1:t.type,jsonData:JSON.stringify({customerId:window.CUR_CUSTOMERID,projectId:window.CUR_PROJECTID,content:$.base64.encode(encodeURIComponent(t.postilContent)),contentText:o,cellContent:t.cellContent,type:t.type,annotationId:a.annotationId,commentedUser:a.__ucreateUser.userId,commentId:a.autoId})};this.submitPostil(l,a=>{if(a.success){let l=a.data[0].data,o="DG00152";"HB"!=r.substring(0,2)&&"MERGENOTE"!=r.substring(0,9)||(o="DG00332"),t.fetch({menuId:window.sys_menuId,sqlId:o,param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:l.annotationId,param4:t.auditState,param5:s,param6:r,param7:l.autoId},t=>{t.success&&e.comments.push(t.data[0])}),t.onPostilClose()}else postilPage.autoHide=!1,bdoErrorBox("失败",a.resultInfo.statusText)})}}},onNewPostilBtnClick(e){this.newContent=!0,this.postilContent="",this.cellContent=l,this.type=r,this.postilLevel=2},gotoPosition(t){"DG-"==e.type.substring(0,3)?$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",async:!1,data:{menuId:window.sys_menuId,sqlId:"DG00143",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:e.data.foreignId,start:-1,limit:-1},dataType:"json",success(t){if(t.success){if(0==t.data.length)return void bdoErrorBox("失败","批注索引号关联的文件不存在。");var a={extraOptions:t.data[0],currentNode:{extraOptions:t.data[0]}};a.autoId=a.extraOptions.autoId,a.workpaperId=a.extraOptions.workpaperId,a.menuId=window.sys_menuId,$.sessionStorage("subjecttreeNode",JSON.stringify(a)),$.sessionStorage("cellLinkFormulaBySheetName",JSON.stringify(e.data.cellContent)),window.open("/Faith/dgcenter.do?m=openWorkpaper&index="+a.extraOptions.indexId+"&projectId="+a.extraOptions.projectId)}}}):"QYXJ-"==e.type.substring(0,5)?$.ajax({type:"post",url:"dgCenter/DgPostil.queryWorkpaper.json",async:!1,data:{param1:e.data.foreignId},dataType:"json",success(t){if(t.success){if(0==t.data.length)return void bdoErrorBox("失败","批注索引号关联的文件不存在。");var a={extraOptions:t.data[0],currentNode:{extraOptions:t.data[0]}};a.extraOptions.workpaperId=a.extraOptions.autoId,a.menuId=window.sys_menuId,$.sessionStorage("subjecttreeNode",JSON.stringify(a)),$.sessionStorage("cellLinkFormulaBySheetName",JSON.stringify(e.data.cellContent)),window.open("/Faith/dgcenter.do?m=openQYXJFile&customerId="+window.CUR_CUSTOMERID+"&projectId="+window.CUR_PROJECTID+"&fileType=2")}}}):"HB"==e.type.substring(0,2)?$.ajax({type:"post",url:"dgCenter/HbMergePostil.getUrlByIndexId.json",async:!1,data:{param1:e.type},dataType:"json",success(t){if(t.success){var a=t.data[0].url,r=t.data[0].type;if(void 0!=a&&""!=a){let t={curCustomerName:window.CUR_CUSTOMERID+"-"+window.CUR_CUSTOMERNAME,curProjectName:window.CUR_PROJECTNAME,curYear:window.CUR_PROJECT_ACC_YEAR,curCustomerId:window.CUR_CUSTOMERID,curProjectId:window.CUR_PROJECTID,departmentIdr:departIdrSession,userId:sys_userId},l={curYear:window.CUR_PROJECT_ACC_YEAR,customerId:window.CUR_CUSTOMERID,mergeCustomerId:e.data.mergeCustomerId,mergeCustomerName:e.data.mergeCustomerName,projectId:e.data.mergeProjectId+"-"+e.data.mergeProjectName,type:r};sessionStorage.setItem("curCustomerData",JSON.stringify(t)),sessionStorage.setItem("projectItem",JSON.stringify(l)),sessionStorage.setItem("menuID",e.type),window.open("/Faith/merge/index.html#/"+a)}else window.open("/Faith/merge/index.html")}}}):"NOTE"==e.type.substring(0,4)?$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",async:!1,data:{menuId:window.sys_menuId,sqlId:"DG00092",param1:e.data.foreignId,param2:e.data.customerId,param3:e.data.projectId,start:-1,limit:-1},dataType:"json",success(e){if(e.success){if(0==e.data.length)return void bdoErrorBox("失败","批注索引号关联的文件不存在。");var t={extraOptions:e.data[0],currentNode:{extraOptions:e.data[0]}};t.autoId=t.extraOptions.autoId,t.menuId=window.sys_menuId,$.sessionStorage("noteInfoNode",JSON.stringify(t)),window.open("/Faith/dgcenter.do?m=openDgNoteInfo&noteNo="+t.extraOptions.noteNo+"&projectId="+t.extraOptions.projectId)}else bdoErrorBox("失败",e.resultInfo.statusText)}}):"MERGENOTE2"==e.type.substring(0,10)?$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",async:!1,data:{menuId:window.sys_menuId,sqlId:"DG00310",param1:e.data.foreignId,param2:e.data.customerId,param3:e.data.projectId,param4:e.data.mergeProjectId,start:-1,limit:-1},dataType:"json",success(e){if(e.success){if(0==e.data.length)return void bdoErrorBox("失败","批注索引号关联的文件不存在。");var t={extraOptions:e.data[0],currentNode:{extraOptions:e.data[0]}};t.autoId=t.extraOptions.autoId,t.menuId=window.sys_menuId,t.type=2,$.sessionStorage("excelnode",JSON.stringify(t)),window.open("/Faith/dgcenter.do?m=openMergeNoteInfoSecond&noteNo="+t.extraOptions.noteNo)}}}):"MERGENOTE"==e.type.substring(0,9)?$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",async:!1,data:{menuId:window.sys_menuId,sqlId:"DG00310",param1:e.data.foreignId,param2:e.data.customerId,param3:e.data.projectId,param4:e.data.mergeProjectId,start:-1,limit:-1},dataType:"json",success(e){if(e.success){if(0==e.data.length)return void bdoErrorBox("失败","批注索引号关联的文件不存在。");var t={extraOptions:e.data[0],currentNode:{extraOptions:e.data[0]}};t.autoId=t.extraOptions.autoId,t.menuId=window.sys_menuId,sessionStorage.setItem("mergeNoteInfoNode",JSON.stringify(t)),window.open("/Faith/dgcenter.do?m=openMergeNoteInfo&noteNo="+t.extraOptions.noteNo)}}}):(e.isSingle&&$("#postilmodal").modal("hide"),window.open("/Faith/bdologin.do?m=gotoDesktop&menuId=40000022&type="+e.type))},onPostilClose(e){this.newContent=!1,this.type="",this.postilContent="",this.cellContent="",this.postilLevel=2},countInfoInit(){var e=$("#postilsTitle"),t=$("#postilCount1",e),a=$("#postilCount2",e),r=$("#postilCount3",e),l=$("#postilCount4",e),s=$("#postilCount5",e),o=$("#postilCount6",e),n=$("#postilCount7",e);$.ajax({url:"dgCenter/DgPostil.countInfoInit.json",data:{menuId:window.sys_menuId,param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,start:-1,limit:-1},type:"POST",dataType:"json"}).done(function(e){if(e.success){let i=e.data[0];t.text(i.postil1+" / "+i.postilTotal1),a.text(i.postil2+" / "+i.postilTotal2),r.text(i.postil3+" / "+i.postilTotal3),l.text(i.postil4+" / "+i.postilTotal4),s.text(i.postil5+" / "+i.postilTotal5),o.text(i.postil6+" / "+i.postilTotal6),n.text(i.postil7+" / "+i.postilTotal7)}})},closePostil(){var e=this,t=this.threadParam.postilActionAgrs[1],a="dgCenter/DgPostil.closePostil.json";"HB"!=t.type.substring(0,2)&&"MERGENOTE"!=t.type.substring(0,9)&&"MERGENOTE2"!=t.type.substring(0,10)||(a="dgCenter/HbMergePostil.closePostil.json");bdoConfirmBox("提示","确定要关闭这条批注吗？",r=>{$.ajax({type:"post",url:a,data:{param1:t.autoId,param2:t.customerId},dataType:"json",success(a){a.success?(t.activeFlag=0,$("#postilsPage").length>0&&($("#postilsPage").find("#postilsTable").DataTable().ajax.reload(),e.countInfoInit()),bdoSuccessBox("成功",a.resultInfo.statusText)):bdoErrorBox("失败",a.resultInfo.statusText)}})})},openPostil(){var e=this,t=this.threadParam.postilActionAgrs[1],a="dgCenter/DgPostil.openPostil.json";"HB"!=t.type.substring(0,2)&&"MERGENOTE"!=t.type.substring(0,9)&&"MERGENOTE2"!=t.type.substring(0,10)||(a="dgCenter/HbMergePostil.openPostil.json");bdoConfirmBox("提示","确定要重新开启这条批注吗？",r=>{$.ajax({type:"post",url:a,data:{param1:t.autoId,param2:t.customerId},dataType:"json",success(a){a.success?(t.activeFlag=1,$("#postilsPage").length>0&&($("#postilsPage").find("#postilsTable").DataTable().ajax.reload(),e.countInfoInit()),bdoSuccessBox("成功",a.resultInfo.statusText)):bdoErrorBox("失败",a.resultInfo.statusText)}})})},deletePostil(){var t=this;let a=this.threadParam.postilActionAgrs[1],r=this,l=r.postils.indexOf(a);var s="dgCenter/DgPostil.deletePostil.json";"HB"!=a.type.substring(0,2)&&"MERGENOTE"!=a.type.substring(0,9)&&"MERGENOTE2"!=a.type.substring(0,10)||(s="dgCenter/HbMergePostil.deletePostil.json"),bdoConfirmBox("提示","确定要删除这条批注吗？",o=>{$.ajax({type:"post",url:s,data:{param1:a.autoId,param2:window.CUR_CUSTOMERID,param3:window.CUR_PROJECTID},dataType:"json",success(s){if(s.success){r.postils.splice(l,1);r.threadParam.postilActionAgrs.indexOf(a);r.threadParam.postilActionAgrs.splice(l,1),$("#"+a.autoId).remove(),e.isSingle&&($("#postilmodal").modal("hide"),$("#postilsTable").DataTable().ajax.reload()),$("#postilsPage").length>0&&($("#postilsPage").find("#postilsTable").DataTable().ajax.reload(),t.countInfoInit()),bdoSuccessBox("成功",s.resultInfo.statusText)}else bdoErrorBox("失败",s.resultInfo.statusText)}})})},postilAction(e,t){let a=t[0];switch(this.threadParam.postilActionAgrs=t,a){case"C001":case"C002":this.type=a,this.newContent=!0,this.postilContent="",this.cellContent=l;break;case"005":this.closePostil();break;case"006":this.openPostil();break;case"007":this.deletePostil()}}},mounted(){let t=this;a=side({el:"#dgPostilPage",autoHide:!1}),this.auditState=400,this.fetchProjectInfo().done(function(e){if(e.success&&e.data&&e.data[0]){let a=e.data[0],r=0;a.manager==sys_userId&&(r+=1),a.signAccountant2!=sys_userId&&a.signAccountant3!=sys_userId||(r+=16),a.audit1==sys_userId&&(r+=2),a.audit2==sys_userId&&(r+=4),a.reaReviewer==sys_userId&&(r+=32),a.signUser==sys_userId&&(r+=64),a.reviewPartner==sys_userId&&(r+=8),a.issuedPeople==sys_userId&&(r+=128),t.userAuditState=r}(16&t.userAuditState)>>4==1&&(t.newPostilBtnShow=!0)}),n(),OneUI.initHelper("slimscroll"),"1"==$.sessionStorage("mergeType")&&$("#sideRegin").removeAttr("style",""),a.show(),initPostilContentsEditor(this,e)},beforeCreate(){t=e.isSingle?e.template||tplLoader("dgCenter/html/dg/pageSinglePostil.html"):e.template||tplLoader("dgCenter/html/dg/pagePostil.html"),e.template=t,r=e.type,s=e.foreignId,l=void 0!=e.data.extraOptions&&"PROJECT"==e.data.extraOptions.nodeType?"项目":void 0!=e.data.extraOptions?e.data.extraOptions.nodeName:void 0!=e.data.nodeName?e.data.nodeName:e.data.dgName,$(e.region).empty().append(t)}})},task=function(e){var t=function(){return this.taskId="",this.taskName="",this.intro="",this.files=[],this.newFiles=[],this.parentDirId="",this.groupId=this.groupId||"",this.folderId=this.folderId||"",this.folderName=this.folderName||"",this},a={height:0,groupId:e?e.groupId:"",taskForm:t.apply({})};a=e=$.extend(!0,a,e);var r=function(){return this.taskId="",this.groupId="",this.folderId="",this.commentId=null,this.comment="",this.commentFiles=[],this},l=r.apply({}),s=new FormComp({props:{jsonData:Object,task:Object},display:"tableform-one",column:4,id:"commentForm",data:function(){return{ajaxConfig:{type:"POST",url:"cusBase/CusRc.addComment.json",dataType:"json",success:function(e){e.success?(bdoSuccessBox("成功",e.resultInfo.statusText),this.onCancelCommentBtnClick(null),b.fetchTaskList()):bdoErrorBox("失败",e.resultInfo.statusText)}}}},activated(){this.resetPluginComponet(),this.jsonData.taskId=this.task.taskId,this.jsonData.groupId=this.task.groupId,this.jsonData.folderId=b.jsonData.folderId,this.task.comment?this.jsonData.commentId=this.task.comment.commentId:this.jsonData.commentId=null},deactivated(){l=r.apply(this.jsonData),this.resetPluginComponet()},methods:{onSaveCommentBtnClick(e){this.uploadFile(!0)},onCancelCommentBtnClick(e){this.task.commentForm="",this.task.commentFormShow=!1}},buttons:[{id:"saveCommentBtn",icon:"fa-floppy-o",style:"btn-primary",text:"保存",typeAttr:{"v-on:click":"onSaveCommentBtnClick"}},{id:"cancelCommentBtn",icon:"fa-arrow-left",style:"btn-warning",text:"取消",typeAttr:{"v-on:click":"onCancelCommentBtnClick"}}],items:[{id:"comment",type:"textarea",label:"内容",rowspan:1,colspan:1,validate:{rules:{required:!0,maxlength:2500}},typeAttr:{rows:3},plugin:{name:"summernote",options:{}}},{id:"commentFiles",type:"file",label:"选择附件",rowspan:1,colspan:4,typeAttr:{},plugin:{name:"fileinput",options:{allowedFileExtensions:["xls","xlsx","xltx","xlsm","xltm","xlsb","xlam","jpg","png","doc","docx","zip","rar","pdf"],uploadUrl:"cusBase/CusRc.uploadFile.json",uploadExtraData:function(){return{parentId:l.folderId,customerId:b.jsonData.groupId}}}}},{id:"folderId",type:"treecombo",label:"附件保存目录",rowspan:1,colspan:4,typeAttr:{},validate:{rules:{required:!0}},plugin:{name:"treecombo",options:{url:"./cpBase/TreeCommon.findCusFileSystemTree.json",params:function(){return{param13:"1",param12:"01",param10:b.jsonData.groupId}},view:{leafIcon:"fa fa-folder text-primary",nodeIcon:"fa fa-folder text-primary",folderSelectable:!0,multiSelect:!1,showBorder:0,borderColor:"#000",selectColor:"#fff"}}}}]}),o=tplLoader("cpCustomer/tpl/taskList.html"),n={props:{taskList:Array,pageModel:Object},data:function(){return{commentFormModel:l}},template:o,components:{"comment-form":s},methods:{formatDate:e=>new Date(e).format("yyyy-MM-dd HH:mm:ss")}},i={props:{tasks:Array,pageModel:Object},data:function(){return{styleObject:{height:a.height+"px","overflow-y":"auto"}}},components:{"task-list":n},template:'<div class="block-content bg-gray-lighter" :style="styleObject" ><task-list :taskList="tasks" :page-model="pageModel" @edit-task="$emit(\'edit-task\', $event)" @del-task="$emit(\'del-task\', $event)" @comment-task="$emit(\'comment-task\', $event)" @download-file="$emit(\'download-file\', $event)" @del-file="$emit(\'del-file\', $event)" @reply-comment="$emit(\'reply-comment\', $event)" @del-comment="$emit(\'del-comment\', $event)" @task-list-loadmore="$emit(\'task-list-loadmore\', $event)"></task-list></div>'},d={param13:"1",param10:a.groupId},c=new FormComp({display:"tableform-one",column:4,id:"selectFileForm",props:{jsonData:Object},data:function(){return{selectFileResult:"",selectFiletreecomboOptions:{}}},computed:{result:()=>({value:$("#selectFile").attr("data-result"),label:$("#selectFile").attr("data-content")})},watch:{"jsonData.selectFile":function(e,t){}},activated(){this.jsonData.selectFile="",$("#selectFile").treecombo(!0).options.params.param10=a.groupId},buttons:[{id:"comfirmSelectFileBtn",icon:"fa-floppy-o",style:"btn-primary",text:"确认",typeAttr:{"v-on:click":"$emit('select-file-comfirm',result)"}},{id:"closeSelectFileBtn",icon:"fa-sign-out",style:"btn-css1 btn-warning",text:"关闭",typeAttr:{"v-on:click":"$emit('select-file-close')"}}],items:[{id:"selectFile",type:"input",label:"文件",rowspan:1,colspan:4,validate:{rules:{required:!0}},typeAttr:{"v-bind:data-result":"selectFileResult"},plugin:{name:"treecombo",options:{url:"./cpBase/TreeCommon.findCusFileSystemTree.json",params:d,view:{leafIcon:"fa fa-folder text-primary",nodeIcon:"fa fa-folder text-primary",folderSelectable:!1,multiSelect:!1}}}}]}),u={props:{selectFileData:Object},data:function(){return{styleObject:{height:a.height+"px"}}},components:{"select-file-form":c},template:'<div class="block-content" :style="styleObject"><select-file-form :json-data="selectFileData" @select-file-comfirm="$emit(\'select-file-comfirm\', $event)" @select-file-close="$emit(\'select-file-close\')""></select-file-form></div>'},m=new FormComp({display:"tableform-one",column:4,id:"taskForm",data:function(){return{ajaxConfig:{type:"POST",url:"cusBase/CusRc.addTask.json",dataType:"json",success:function(e){e.success?(bdoSuccessBox("成功",e.resultInfo.statusText),this.$parent.$parent.changeSubPage("tasklist")):bdoErrorBox("失败",e.resultInfo.statusText)}}}},activated(){"edit"==b.editProccess?this.formItem.files.show=!0:(this.formItem.files.show=!1,this.resetPluginComponet()),this.jsonData.parentDirId=this.jsonData.folderId},methods:{onSaveTaskBtnClick:function(e){$.isNumeric(a.groupId)?("add"==b.editProccess?this.ajaxConfig.url="cusBase/CusRc.addTask.json":"edit"==b.editProccess&&(this.ajaxConfig.url="cusBase/CusRc.updateTask.json"),this.uploadFile(!0)):bdoErrorBox("","请选择一个具体的客户。")},onAddFileBtnClick:function(e){this.$emit("add-file")}},buttons:[{id:"saveTaskBtn",icon:"fa-floppy-o",style:"btn-primary",text:"保存",typeAttr:{"v-on:click":"onSaveTaskBtnClick"}}],items:[{id:"taskName",type:"input",label:"主题",rowspan:1,colspan:4,validate:{rules:{required:!0,maxlength:100}}},{id:"intro",type:"textarea",label:"内容",rowspan:1,colspan:4,validate:{rules:{required:!0,maxlength:2500}},typeAttr:{rows:3},plugin:{name:"summernote",options:{}}},{id:"newFiles",label:"上传附件",type:"file",rowspan:1,colspan:4,typeAttr:{multiple:!0},plugin:{name:"fileinput",options:{allowedFileExtensions:["xls","xlsx","xltx","xlsm","xltm","xlsb","xlam","jpg","png","doc","docx","zip","rar","pdf"],uploadUrl:"cusBase/CusRc.uploadFile.json",uploadExtraData:function(){return{parentId:a.taskForm.parentDirId,customerId:b.jsonData.groupId}}}}},{id:"parentDirId",type:"treecombo",label:"附件保存目录",rowspan:1,colspan:4,typeAttr:{},validate:{rules:{required:!0}},plugin:{name:"treecombo",options:{url:"./cpBase/TreeCommon.findCusFileSystemTree.json",params:function(){return{param13:"1",param12:"01",param10:b.jsonData.groupId}},view:{leafIcon:"fa fa-folder text-primary",nodeIcon:"fa fa-folder text-primary",folderSelectable:!0,multiSelect:!1,showBorder:0,borderColor:"#000",selectColor:"#fff"}}}},{id:"files",label:"已关联附件",rowspan:1,colspan:4,show:!1,html:tplLoader("cpCustomer/tpl/taskEditFileTpl.html")}]}),p={props:{jsonData:Object},data:function(){return{styleObject:{height:a.height+"px",overflow:"auto"}}},components:{"task-edit-form":m},template:'<div class="block-content" :style="styleObject"><task-edit-form :json-data="jsonData" @add-file="$emit(\'add-file\')" @del-edit-file="$emit(\'del-edit-file\', $event)""></task-edit-form></div>'},b=new Vue({el:a.$el,components:{tasklist:i,taskedit:p,selectfile:u},data:{title:"讨论区",newTaskBtnLable:"新建话题",turnBackTasksBtnLable:"返回",refreshBtnLabel:"刷新",subComponent:"",editComponent:"selectfile",editShow:!1,selectFileData:{selectFile:""},show:!1,tasks:[],pageModel:{total:0,state:"",limit:0,currentPage:0,previou:-1,next:-1},queryTaskListParam:{menuId:window.sys_menuId,sqlId:"RC10005",param1:a.groupId,page:0,start:0,limit:a.pageSize,sort:JSON.stringify([{property:"taskId",direction:"desc"}])},jsonData:a.taskForm,classObject:{"block-opt-refresh":!0},editProccess:"",currentCommentForm:{},history:[],historyLength:20,historyCurrentIndex:0},watch:{subComponent:function(e,t){""!=e&&(this.history.push(e),parseInt(this.history.length/this.historyLength)>0&&this.history.splice(0,this.history.length%this.historyLength)),this.onChangeSubPage(e,t)},"jsonData.groupId":function(e,t){null!=e&&(a.groupId=e,this.fetchTaskList())},"queryTaskListParam.page":function(e,t){},"pageModel.total":function(e,t){this.pageModel.limit=this.queryTaskListParam.limit,this.pageModel.currentPage=this.queryTaskListParam.page;var a=this.tasks.length,r=parseInt(this.pageModel.total/this.pageModel.limit)+(this.pageModel.total%this.pageModel.limit==0?0:1),l=parseInt(a/this.pageModel.limit)+(a%this.pageModel.limit==0?0:1);"pre"==this.pageModel.state?(this.pageModel.currentPage>0?this.pageModel.previou=this.pageModel.currentPage-1:this.pageModel.previou=-1,this.pageModel.currentPage+l<=r-1?this.pageModel.next=this.pageModel.currentPage+l:this.pageModel.next=-1):(this.pageModel.currentPage<r-1?this.pageModel.next=this.pageModel.currentPage+1:this.pageModel.next=-1,this.pageModel.currentPage-l>=0?this.pageModel.previou=this.pageModel.currentPage-l:this.pageModel.previou=-1)}},mounted(){this.subComponent="tasklist"},methods:{beforChangeSubPage(e,r){switch(e){case"tasklist":break;case"taskedit":a.taskForm=t.apply(this.jsonData),this.jsonData=a.taskForm}},changeSubPage(e){this.transition(),this.beforChangeSubPage(this.subComponent,e),this.subComponent=e},onAddTaskClick:function(e){$.isNumeric(a.groupId)?(this.editProccess="add",this.changeSubPage("taskedit")):bdoErrorBox("","请选择一个具体的客户。")},onTurnBackTasksClick:function(e){this.changeSubPage("tasklist")},onRefreshClick:function(e){var t=this.subComponent,a=this;a.classObject["block-opt-refresh"]=!0,this.subComponent="",setTimeout(function(){a.classObject["block-opt-refresh"]=!1,a.changeSubPage(t)},500)},fetch(e,t,a,r){(t=t||{}).menuId=window.sys_menuId,$.ajax({url:e,type:"post",data:t,dataType:"json",success:function(e){a(e)}})},update(e,t,a,r){t=t||{},$.ajax({url:e,type:"post",data:t,dataType:"json",success:function(e){a(e)}})},fetchTaskSuccess(e){e.success?($.each(e.data,(e,t)=>{t.commentFormShow=!1,t.commentForm=""}),"pre"==b.pageModel.state?(b.tasks=e.data.concat(b.tasks),b.tasks.length>3*b.pageModel.limit&&b.tasks.splice(3*b.pageModel.limit,b.tasks.length-(3*b.pageModel.limit-1))):(b.pageModel.state="next")?(b.tasks=b.tasks.concat(e.data),b.tasks.length>3*b.pageModel.limit&&b.tasks.splice(0,b.pageModel.limit)):b.tasks=e.data,b.pageModel.total=e.totalCount):bdoErrorBox("",e.resultInfo.statusText)},fetchTaskList(e){e?("pre"==this.pageModel.state&&(this.queryTaskListParam.page=this.pageModel.previou),"next"==this.pageModel.state&&(this.queryTaskListParam.page=this.pageModel.next)):(this.tasks=[],this.pageModel.state="",this.pageModel.total=0,this.queryTaskListParam.page=0),this.queryTaskListParam.param1=a.groupId,this.queryTaskListParam.start=this.queryTaskListParam.limit*this.queryTaskListParam.page;this.fetch("cpBase/General.queryCusTaskList.json",this.queryTaskListParam,this.fetchTaskSuccess.bind(this)),"tasklist"!=this.subComponent&&this.changeSubPage("tasklist")},transition(){var e=this;e.classObject["block-opt-refresh"]=!0,setTimeout(function(){e.classObject["block-opt-refresh"]=!1},500)},onChangeSubPage(e,r){switch(this.transition(),e){case"tasklist":$.isNumeric(a.groupId)&&this.fetchTaskList();break;case"taskedit":(this.editProccess="add")&&(a.taskForm=t.apply(this.jsonData),this.jsonData=a.taskForm)}},doAddFileBtnClick(e){this.changeSubPage("selectfile")},onSelectFileComfirm(e){var t=!1;$.each(this.jsonData.files,function(a,r){e.value==r.value&&(t=!0)}),t?bdoErrorBox("","该文件已在附件列表中，请勿重复关联！"):(this.jsonData.files.push(e),this.changeSubPage("taskedit"))},doDelEditFileBtnClick(e){$.each(this.jsonData.files,function(t,a){e.value==a.value&&this.jsonData.files.splice(t,1)}.bind(this))},onSelectFileClose(e){this.changeSubPage("taskedit")},doReplyComment(e){this.doComment(e[0],e[1])},doComment(e,t){if(e.comment=t,this.currentCommentForm.taskId){if(this.currentCommentForm.taskId==e.taskId)return""==this.currentCommentForm.commentForm?this.currentCommentForm.commentForm="comment-form":this.currentCommentForm.commentForm="",this.currentCommentForm.commentFormShow=!this.currentCommentForm.commentFormShow,e.commentForm=this.currentCommentForm.commentForm,e.commentFormShow=this.currentCommentForm.commentFormShow,void(this.currentCommentForm=e);this.currentCommentForm.commentForm="",this.currentCommentForm.commentFormShow=!1}e.commentForm="comment-form",e.commentFormShow=!0,this.currentCommentForm=e},downloadFile(t){var a,r,l;a="cusBase/CusRc.downloadFile.json",r={param1:t.fileSystemId},(l=$("<form>")).attr("style","display:none"),l.attr("target","body"),l.attr("method","post"),l.attr("action",a),$.each(r,function(e,t){var a=$("<input>");a.attr("type","hidden"),a.attr("name",e),$.isPlainObject(t)?a.attr("value",JSON.stringify(t)):a.attr("value",t),l.append(a)}),$(e.$el).append(l),l.submit(),l.remove()},deleteFile(e){var t=this;bdoConfirmBox("系统提示","确定要从当前内容中取消该附件链接吗？",()=>{t.update("cusBase/CusRc.deleteLinkFile.json",{param1:e.resId},e=>{e.success?(t.fetchTaskList(),bdoSuccessBox("成功",e.resultInfo.statusText)):bdoErrorBox("",e.resultInfo.statusText)})})},doDeleteComment(e){var t=this;bdoConfirmBox("系统提示","确定删除这条评论吗？",()=>{t.update("cusBase/CusRc.deleteComment.json",{param1:e.commentId},e=>{e.success?(t.fetchTaskList(),bdoSuccessBox("成功",e.resultInfo.statusText)):bdoErrorBox("",e.resultInfo.statusText)})})},doDeleteTask(e){var t=this;bdoConfirmBox("系统提示","确定删除该主题吗？",a=>{t.update("cusBase/CusRc.deleteTask.json",{param1:e.taskId},e=>{e.success?(t.fetchTaskList(),bdoSuccessBox("成功",e.resultInfo.statusText)):bdoErrorBox("",e.resultInfo.statusText)})})},doEditTask(e){this.jsonData.taskId=e.taskId,this.jsonData.taskName=e.taskName,this.jsonData.intro=e.intro;var t=[];$.each(e.files,(e,a)=>{t.push({value:a.fileSystemId,label:a.fileName})}),this.jsonData.files=t,this.editProccess="edit",this.changeSubPage("taskedit")},formatDate:e=>new Date(value).format("yyyy-MM-dd HH:mm:ss"),loadmore(e){this.transition(),this.pageModel.state=e,this.pageModel.total=0,this.fetchTaskList(!0)}}});return b};function RcsPage(e){let t=e.template||tplLoader("dgCenter/html/dg/dgRcs.html"),a=e.data.customerId,r=e.data.projectId;$(e.region).html(t);var l=new Page({container:"#subPageRight",events:{"#turnBack":"click,onTurnBackClick","#fsRefresh":"click,onFsRefreshClick","#uploadFileBtn":"click,onUploadFileBtnClick","#addFolderBtn":"click,onAddFolderBtnClick","#addSaveBtn":"click,onAddSaveBtnClick","#fileUploadFileName":"change,onFileUploadChange","#editSaveBtn":"click,onEditSaveBtnClick"},height:0,data:{folderId:0,customerId:a},init:function(e){this.height=this.mainHeight-this.contentBlockTopOffset-120,this.cmp.folderTreeWrap.height(this.height+"px"),this.createFolderTree(),this.cmp.turnBack.hide(),this.uploadWorkpagerPage=createForm(this.uploadWorkpagerPageCfg)},uploadWorkpagerPageCfg:{options:{propsData:{jsonData:{workpager:[],customerId:window.CUR_CUSTOMERID,projectId:window.CUR_PROJECTID,parentId:null,file:null}}},props:{jsonData:Object},display:"tableform-one",column:1,id:"rcsuploadFileForm",data:()=>({ajaxConfig:{type:"POST",url:"dgCenter/DgDownload.uploadResFile.json",dataType:"json",success(e){e.success?(bdoSuccessBox("成功",e.resultInfo.statusText),$("#rcsuploadTplFormModal").modal("hide"),l.reflashFolderTree()):bdoErrorBox("失败",e.resultInfo.statusText)}}}),methods:{onUploadDraftFileClick(e){if($("#workpager").fileinput("getFilesCount")<=0)bdoErrorBox("失败","当前无任何文件！");else{var t=l.cmp.folderTree.treeview(!0).getSelected();this.jsonData.parentId=t[0].id,this.uploadFile(!0)}},resetFileClick(e){$("#workpager").fileinput("refresh"),$("#workpager").fileinput("clear"),$("#workpager").fileinput("reset")}},buttons:[{id:"resetFileBtn",icon:"fa fa-refresh",style:"btn-primary",text:"重置",typeAttr:{"v-on:click":"resetFileClick"}},{id:"uploadDraftFileBtn",icon:"fa fa-upload",style:"btn-primary",text:"上传",typeAttr:{"v-on:click":"onUploadDraftFileClick"}},{id:"cancelUploadDraftFileBtn",icon:"fa-arrow-left",style:"btn-warning",text:"取消",typeAttr:{"data-dismiss":"modal"}}],items:[{id:"workpager",type:"file",label:"文件",rowspan:1,colspan:2,validate:{rules:{required:!0}},typeAttr:{multiple:!0},show:!0,plugin:{name:"fileinput",options:{allowedFileExtensions:["xls","xlsx","xltx","xlsm","xltm","xlsb","xlam","jpg","png","doc","docx","zip","rar","pdf"],uploadUrl:"dgCenter/DgDownload.uploadTempFile.json",uploadExtraData:()=>({})}}}]},folderTreeOptions:{url:"./cpBase/TreeCommon.findDgRcsFileSystemTree.json",params:{param13:"1",param12:"01",param22:a,param23:r},view:{leafIcon:"fa fa-folder text-primary",nodeIcon:"fa fa-folder text-primary",folderSelectable:!0,multiSelect:!1,showBorder:0,borderColor:"#000",selectColor:"#fff"},opts:{updateNode:!0}},createFolderTree:function(e){this.cmp.folderTree.tree(this.folderTreeOptions),this.cmp.folderTree.on("nodeSelected",this.onFolderTreeNodeSelected.bind(this)),this.cmp.folderTree.on("nodeUnselected",this.onFolderTreeNodeUnSelected.bind(this)),"function"==typeof this.cmp.folderTree.treeview(!0).selectNode&&this.cmp.folderTree.treeview(!0).selectNode(0)},reflashFolderTree:function(){var e=this,t=e.cmp.folderTree.treeview(!0);t instanceof jQuery&&(e.createFolderTree(),t=e.cmp.folderTree.treeview(!0));var a=t.getSelected()[0];if(0!=a.nodeId){var r=e.searchPath(a.value)[1];t.toggleNodeExpanded(r.nodeId),t.expandNode(r.nodeId),t.toggleNodeExpanded(a.nodeId),t.toggleNodeSelected(a.nodeId),t.expandNode(a.nodeId),t.selectNode(a.nodeId)}else e.createFolderTree()},onFolderTreeNodeSelected:function(e,t){var a=this;if(a.data.folderId=t.value,(void 0==a.selectCount||a.selectCount>2)&&(a.selectCount=0),a.selectCount++,1==a.selectCount&&(a.currentNode=t),2==a.selectCount&&(a.newNode=t),1!=a.unselectFlag){var r=a.cmp.folderTree.treeview(!0);a.loadFolderTreeTable({param1:t.value}),t.leaf||r.expandNode(t.nodeId),this.setPath(t.value),2==a.selectCount&&a.currentNode.nodeId!=a.newNode.nodeId&&(a.selectFlag=!0,r.unselectNode(a.currentNode.nodeId))}else a.unselectFlag=!1},onFolderTreeNodeUnSelected:function(e,t){var a=this;if(a.selectCount=0,1!=a.selectFlag){var r=a.cmp.folderTree.treeview(!0);a.unselectFlag=!0,r.selectNode(t.nodeId)}else a.selectFlag=!1},loadFolderTreeTable:function(e){var t=this,l=t.cmp.folderTreeTable;l.hasInited?l.datagrid("load",{menuId:window.sys_menuId,sqlId:"DG00034",param1:e.param1,param2:a,param3:r,start:-1,limit:-1}):easyloader.load(["datagrid"],function(){l.datagrid({height:t.height-10,border:"none",singleSelect:!0,animate:!0,queryParams:{menuId:window.sys_menuId,sqlId:"DG00034",param1:e.param1,param2:a,param3:r,start:-1,limit:-1},idField:"autoId",treeField:"label",rowStyler:function(e){},columns:[[{title:"目录序号",field:"autoId",hidden:!0},{title:"索引号",field:"fileIndexId",width:100},{title:"文件名",field:"fileName",width:300,formatter:function(e,t,a){return'<div class="row"><div class="col-xs-8">\t\t\t<i class="'+("01"==t.fileType?"fa fa-folder text-primary":"fa fa-file text-primary")+'"></i>'+e+'\t\t\t</div><div class="col-xs-2">\t\t</div></div>'}},{title:"处理",field:"operate",width:150,align:"center",formatter(e,t,a){var r="";if(r+='<a data-edit="'+t.autoId+'" data-placement="top" title="修改" data-toggle="tooltip" style="cursor: pointer"><i class="fa fa-edit" data-edit="'+t.autoId+'"></i></a>&nbsp;&nbsp;',r+='<a data-del="'+t.autoId+'" data-placement="top" title="删除" data-toggle="tooltip" style="cursor: pointer"><i class="fa fa-times" data-del="'+t.autoId+'"></i></a>&nbsp;&nbsp;',"02"==t.fileType){r+='<a data-download="'+t.autoId+'" data-placement="top" title="下载" data-toggle="tooltip" style="cursor: pointer"><i class="fa fa-download" data-download="'+t.autoId+'"></i></a>&nbsp;&nbsp;';var l=t.suffix.toLowerCase();"pdf"!=l&&"jpg"!=l&&"png"!=l&&"jpeg"!=l||(r+='<a data-watch="'+t.autoId+'" data-placement="top" title="预览" data-toggle="tooltip" style="cursor: pointer"><i class="fa fa-file-text-o" data-watch="'+t.autoId+'"></i></a>&nbsp;&nbsp;')}return'<div class="row">\t\t\t'+r+"\t\t</div>"}},{title:"修改时间",field:"lastUpdateDate",width:150,formatter:function(e,t,a){return new Date(e).format("yyyy-MM-dd HH:mm:ss")}},{title:"最近修改人",field:"lastUpdateUser",width:100,formatter:function(e,t,a){return t.__ulastUpdateUser.userName}}]],loading(){},loadMsg:"",loader:function(e,t,a){e.param1?$.ajax({url:"dgCenter/DgGeneral.General.query.json",type:"post",data:e,dataType:"json",success:function(e){t(e.data)}}):t([])},onDblClickRow:function(e,a){if("01"==a.fileType){var r=t.cmp.folderTree.treeview(!0).getAllNodes();$(r).each(function(e){a.autoId==this.value&&t.cmp.folderTree.treeview(!0).selectNode(this)})}}}),l.hasInited=!0,l.datagrid("getPanel").on("click","a[data-del]",t.onDeleteFileClick.bind(t)),l.datagrid("getPanel").on("click","a[data-edit]",t.onEditFileClick.bind(t)),l.datagrid("getPanel").on("click","a[data-download]",t.onDownloadFileClick.bind(t)),l.datagrid("getPanel").on("click","a[data-watch]",t.onWatchFileClick.bind(t))})},setPath:function(e){var t=this;"1"==e?t.cmp.turnBack.hide():t.cmp.turnBack.show();for(var a=t.searchPath(e),r="",l=a.length-1;l>=0;l--){var s=a[l].label,o=a[l].value,n=a[l].nodeId;r+=o!=e?'<li style="text-transform: lowercase;"><a class="link-effect" data-fsid="'+o+'" data-ftnodeid="'+n+'" style="cursor: pointer;">'+s+"</a></li>":'<li style="text-transform: lowercase;">'+s+"</li>"}t.cmp.fsPath.empty(),t.cmp.fsPath.append(r),t.cmp.fsPath.on("click","a.link-effect",t.onFsPathClick.bind(t))},searchPath:function(e){var t=this,a=t.cmp.folderTree.treeview(!0),r=a.getAllNodes(),l=[];return $(r).each(function(a){e==this.value&&(l.push(this),this._bdoParentId&&"0"!=this._bdoParentId&&(l=l.concat(t.searchPath(this._bdoParentId))))}),0==l.length&&l.push(a.getSelected()[0]),l},onFsPathClick:function(e){var t=$(e.target).data("ftnodeid");this.cmp.folderTree.treeview(!0).selectNode(t)},onTurnBackClick:function(e){this.cmp.folderTree.treeview(!0).selectNode(0)},onFsRefreshClick:function(e){this.loadFolderTreeTable({param1:this.data.folderId})},onEditFileClick:function(e){e.preventDefault();var t=this,a=$(e.target).attr("data-edit");if(a){var r=t.cmp.folderTreeTable.datagrid("getSelected");r&&t.cmp.folderTreeTable.datagrid("unselectRow",r.autoId),t.cmp.folderTreeTable.datagrid("selectRecord",a),r=t.cmp.folderTreeTable.datagrid("getSelected",a),t.cmp.modalEditFolder.modal("show"),t.cmp.e_parentId.val(r.parentId),t.cmp.e_fileName.val(r.fileName),t.cmp.e_fileSystemId.val(r.autoId);var l=t.searchPath(a),s=l.length>1?l[1].label:l[0].label;t.cmp.e_path.treecombo(!0).options.params.param11=a,t.cmp.e_path.treecombo("setTreeComboValue",[r.parentId,s])}},onWatchFileClick:function(e){e.preventDefault();var t=$(e.target);t.attr("data-watch")&&$.ajax({url:"dgCenter/DgMain.queryResFileExistence.json",type:"post",data:{param1:t.attr("data-watch"),param2:a},dataType:"json",success:function(e){"3"==e.resultInfo.status?bdoErrorBox("失败",e.resultInfo.statusText):window.open("dgCenter/DgMain.previewResFile.json?param1="+t.attr("data-watch")+"&param2="+a,"预览","location=no")}})},onDeleteFileClick:function(e){e.preventDefault();var t=$(e.target),a=this;t.attr("data-del")&&bdoConfirmBox("系统提示","确定要删除该文件吗？",function(){a.deleteFile(t.attr("data-del"))})},deleteFile:function(e){var t=this;t.cmp.folderTree.treeview(!0);$.ajax({url:"dgCenter/DgMain.deleteResFolder.json",type:"post",data:{param1:e,param2:a},dataType:"json",success:function(e){e.success?(t.reflashFolderTree(),bdoSuccessBox("成功",e.resultInfo.statusText)):bdoErrorBox("失败",e.resultInfo.statusText)}})},onDownloadFileClick:function(e){e.preventDefault();var t=$(e.target);t.attr("data-download")&&this.downloadFile("dgCenter/DgDownload.downloadResFile.json",{param1:t.attr("data-download"),param2:a})},onUploadFileBtnClick:function(e){$("#rcsuploadTplFormModal").modal("show")},onAddFolderBtnClick:function(e){e.preventDefault(),this.cmp.modalNewFolder.modal("show"),$("body").attr("style","")},onAddSaveBtnClick:function(e){e.preventDefault();var t=this,l=t.cmp.folderTree.treeview(!0),s=0;"function"==typeof l.getSelected&&(s=l.getSelected());var o=s?s[0]:null;o&&o.nodeId;s=s?s[0].value:0;var n={jsonData:JSON.stringify({projectId:r,parentId:s,customerId:a,fileName:t.cmp.n_fileName.val()})};t.cmp.newFolderForm.formview("setAjaxConf",["dgCenter/DgMain.addRcsFolder.json",n,"json",!0,function(e){e.success?(t.reflashFolderTree(),bdoSuccessBox("成功",e.resultInfo.statusText)):bdoErrorBox("失败",e.resultInfo.statusText),t.cmp.modalNewFolder.modal("hide")}]),t.cmp.newFolderForm.submit()},onEditSaveBtnClick:function(e){e.preventDefault();var t=this,r=t.cmp.e_path.treecombo(!0).getTreeComboValue(),l={jsonData:JSON.stringify({parentId:parseInt(r),autoId:parseInt(t.cmp.e_fileSystemId.val()),customerId:a,fileName:t.cmp.e_fileName.val()})};t.cmp.editFolderForm.formview("setAjaxConf",["dgCenter/DgMain.updateResFolder.json",l,"json",!0,function(e){e.success?(t.reflashFolderTree(),bdoSuccessBox("成功",e.resultInfo.statusText)):bdoErrorBox("失败",e.resultInfo.statusText),t.cmp.modalEditFolder.modal("hide")}]),t.cmp.editFolderForm.submit()},onFileUploadChange:function(e){var t=$(e.target),l=this,s=l.cmp.folderTree.treeview(!0).getSelected();if(s=s?s[0]:{nodeId:0,value:0},t.val()&&""!=t.val()){var o=new FormData;o.append("parentId",s.value),o.append("customerId",a),o.append("projectId",r),o.append("file",l.cmp.fileUploadFileName.get(0).files[0]),t.val(""),$.ajax({url:"dgCenter/DgDownload.uploadResFile.json",type:"POST",data:o,contentType:!1,processData:!1,success:function(e){e.success?(l.reflashFolderTree(),bdoSuccessBox("成功",e.resultInfo.statusText)):bdoErrorBox("失败",e.resultInfo.statusText)}})}},subPages:[{id:"modalNewFolder",type:"modal",title:"新建文件夹",modalBody:[{id:"newFolderForm",type:"form",options:{display:"tableform-one",column:4,buttons:[{id:"addSaveBtn",icon:"fa-floppy-o",style:"btn-primary",text:"确认"},{id:"add_close",icon:"fa-sign-out",style:"btn-css1 btn-warning",typeAttr:{"data-dismiss":"modal"},text:"关闭"}],items:[{id:"n_parentId",type:"input",label:"",typeAttr:{type:"hidden"}},{id:"n_fileName",type:"input",label:"新建文件夹名称",rowspan:1,colspan:1,validate:{rules:{required:!0,maxlength:100}}}]}}]},{id:"modalEditFolder",type:"modal",title:"修改文件",modalBody:[{id:"editFolderForm",type:"form",options:{display:"tableform-one",column:4,buttons:[{id:"editSaveBtn",icon:"fa-floppy-o",style:"btn-primary",text:"确认"},{id:"add_close",icon:"fa-sign-out",style:"btn-css1 btn-warning",text:"关闭"}],items:[{id:"e_parentId",type:"input",label:"",typeAttr:{type:"hidden"}},{id:"e_fileSystemId",type:"input",label:"",typeAttr:{type:"hidden"}},{id:"e_path",type:"input",label:"目录",rowspan:1,colspan:1,validate:{rules:{required:!0,maxlength:100}},plugin:{name:"treecombo",options:{url:"./cpBase/TreeCommon.findDgRcsFileSystemTree.json",params:{param22:a,param23:r},view:{leafIcon:"fa fa-folder text-primary",nodeIcon:"fa fa-folder text-primary",folderSelectable:!0,multiSelect:!1}}}},{id:"e_fileName",type:"input",label:"文件名称",rowspan:1,colspan:1,validate:{rules:{required:!0,maxlength:100}}}]}}]}]})}function MaterialityPage(e){let t=e.template||tplLoader("dgCenter/html/dg/materiality.html");e.data.customerId,e.data.projectId;$(e.region).html(t)}function MaterialitySetting(e){let t,a=e.template||tplLoader("dgCenter/html/dg/materialitySetting.html");e.data.customerId,e.data.projectId;function r(e){if(!d(e)){for(var t=(e=e.toFixed(2)).split(".")[0],a=e.split(".")[1],r=t.toString(),l="",s="",o=r.length-1;o>=0;o--)s++,l=r.charAt(o)+l,s%3||0==o||(l=","+l);return","==l[0]&&(l=l.replace(",","")),t<0&&","==l[1]&&(l=l.replace(",","")),l+"."+a}return e}function l(e){if(e){var t=new RegExp(",","g");e=e.replace(t,"")}return e}function s(e){var t=l($('input[type="text"][name="mater_number"][data-result="'+e+'"]').val()),a=$('input[type="number"][name="mater_rate"][data-result="'+e+'"]').val();$('input[type="radio"][name="mater_use"]:checked').attr("data-result")==e?(""!=t&&""!=a?($('#mater_surenum, input[type="text"][name="mater_ratenum"][data-result="'+e+'"]').val(r(t*a/100)),$('input[type="text"][name="mater_sureratenum"]').each(function(){""!=$('input[type="number"][name="mater_surerate"][data-result="'+$(this).attr("data-result")+'"]').val()?$(this).val(r(l($("#mater_surenum").val())*$('input[type="number"][name="mater_surerate"][data-result="'+$(this).attr("data-result")+'"]').val()/100)):$(this).val("")})):$('#mater_surenum, input[type="text"][name="mater_sureratenum"], input[type="text"][name="mater_ratenum"][data-result="'+e+'"]').val(""),i(e)):""!=t&&""!=a?$('input[type="text"][name="mater_ratenum"][data-result="'+e+'"]').val(r(t*a/100)):$('input[type="text"][name="mater_ratenum"][data-result="'+e+'"]').val("")}function o(){var e=new Date,t=e.getMonth()+1,a=e.getDate();t<10&&(t="0"+t),a<10&&(a="0"+a);e.getHours(),e.getMinutes(),e.getSeconds();return e.getFullYear()+"-"+t+"-"+a}function n(e){$.ajax({type:"post",url:"dgCenter/MaterialitySetting.getMateriality.json",async:!1,data:{menuId:window.sys_menuId,param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:window.CUR_PROJECT_ACC_YEAR,param4:e,start:-1,limit:-1},dataType:"json",success:function(e){e.success?e.data&&e.data.length>0&&""!=e.data[0].materiality?$("#mater_profit").val(r(e.data[0].materiality)):$("#mater_profit").val(0):bdoErrorBox("失败",e.resultInfo.statusText)}})}function i(e){var t=$('input[type="number"][name="mater_rate"][data-result="'+e+'"]').val(),a=$("#mater_profit").val();if($("#mater_profit_label").html($("#mater_label_"+e).html()),$("#mater_procent").val(t),""!=a&&""!=t){var s=l($("#mater_profit").val())*t/100;$("#mater_num").val(r(s));var o=$('input[type="text"][name="mater_ratenum"][data-result="'+e+'"]').val();parseFloat(s.toFixed(2))>parseFloat(l(o))?($("#mater_result").val("高于计划阶段的重要性水平！"),$("#mater_result").css({color:"red"})):parseFloat(s.toFixed(2))<parseFloat(l(o))?($("#mater_result").val("低于计划阶段的重要性水平！"),$("#mater_result").css({color:"#646464"})):($("#mater_result").val("等于计划阶段的重要性水平！"),$("#mater_result").css({color:"#646464"}))}else $("#mater_num").val(""),$("#mater_result").val("")}$(e.region).html(a),$("#mergerReport").hide(),$("#mergeMateriality").hide(),$("#headtitle").empty().text(e.data.htmlstr),$(".date-picker").datepicker({autoclose:!0,todayHighlight:!0,language:"zh-CN",format:"yyyy-MM-dd"}),$("#mater_form").find(".form-group").eq(7).find(".has-success").find("input").on("keyup",function(){$(this).parents(".form-group").find(".error").remove(),($(this).val()<50||$(this).val()>90||NaN==Number($(this).val()))&&$(this).parents(".form-group").find("#add").append('<div class="error btn btn-warning push-5-r push-10" style="min-width: 100px;"><i class="fa fa-exclamation-triangle"></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不在范围内</font></font></div>'),$(this).parents(".form-group").find(".different").remove();var e=$('input[type="radio"][name="mater_use"]:checked').attr("data-result");null!=t&&t.settingType==e&&$(this).val()!=t["settingRateOne"+e]&&$(this).parents(".form-group").find(".different_reason").append('<div class="different btn btn-warning push-5-r push-10" style="min-width: 10px;" title="与合并项目不一致，请填写原因！" data-toggle="tooltip"><i class="fa fa-exclamation-triangle"></i></div>')}),$("#mater_form").find(".form-group").eq(8).find(".has-success").find("input").on("keyup",function(){$(this).parents(".form-group").find(".error").remove(),($(this).val()<1||$(this).val()>5||NaN==Number($(this).val()))&&$(this).parents(".form-group").find("#add").append('<div class="error btn btn-warning push-5-r push-10" style="min-width: 100px;"><i class="fa fa-exclamation-triangle"></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不在范围内</font></font></div>'),$(this).parents(".form-group").find(".different").remove();var e=$('input[type="radio"][name="mater_use"]:checked').attr("data-result");null!=t&&t.settingType==e&&$(this).val()!=t["settingRateTwo"+e]&&$(this).parents(".form-group").find(".different_reason").append('<div class="different btn btn-warning push-5-r push-10" style="min-width: 10px;" title="与合并项目不一致，请填写原因！" data-toggle="tooltip"><i class="fa fa-exclamation-triangle"></i></div>')}),$('input[type="radio"][name="mater_use"]').click(function(){n($(this).attr("data-result")),s($(this).attr("data-result"));var e=$(this).parent().parent();e.parent().parent().find(".has-success").find("input").attr("disabled","disabled"),e.next().find("input").removeAttr("disabled"),e.parent().find(".has-success").find("input").removeAttr("disabled"),$("#mater_form").find(".form-group").eq(7).find(".has-success").find("input").removeAttr("disabled"),$("#mater_form").find(".form-group").eq(8).find(".has-success").find("input").removeAttr("disabled");var a=function(e,a,r){$(".form-group").eq(1).find(".error").remove(),$(".form-group").eq(2).find(".error").remove(),$(".form-group").eq(3).find(".error").remove(),$(".form-group").eq(4).find(".error").remove(),$(".form-group").eq(5).find(".error").remove(),$(".form-group").eq(6).find(".error").remove(),$(".form-group").eq(1).find(".different").remove(),$(".form-group").eq(2).find(".different").remove(),$(".form-group").eq(3).find(".different").remove(),$(".form-group").eq(4).find(".different").remove(),$(".form-group").eq(5).find(".different").remove(),$(".form-group").eq(6).find(".different").remove(),$("#different_reason_1").find(".different").remove(),$("#different_reason_2").find(".different").remove(),$("#different_reason_3").find(".different").remove(),$("#different_reason_4").find(".different").remove(),$("#different_reason_5").find(".different").remove(),$("#different_reason_6").find(".different").remove(),$("#mater_form").find(".form-group").eq(e).find(".has-success").find('input[name="mater_rate"]').on("keyup",function(){$(this).parents(".form-group").find(".error").remove(),($(this).val()<a||$(this).val()>r||NaN==Number($(this).val()))&&$(this).parents(".form-group").find("#add").append('<div class="error btn btn-warning push-5-r push-10" style="min-width: 100px;"><i class="fa fa-exclamation-triangle"></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不在范围内</font></font></div>'),$(this).parents(".form-group").find(".different").remove(),null!=t&&t.settingType==e&&$(this).val()!=t["settingRate"+e]&&$(this).parents(".form-material").find(".different_reason").append('<div class="different btn btn-warning push-5-r push-10" style="min-width: 10px;" title="与合并项目不一致，请填写原因！" data-toggle="tooltip"><i class="fa fa-exclamation-triangle"></i></div>'),$("#different_reason_"+e).find(".different").remove(),null!=t&&t.settingType!=e&&$("#different_reason_"+e).append('<div class="different btn btn-warning push-5-r push-10" style="min-width: 10px;" title="与合并项目不一致，请填写原因！" data-toggle="tooltip"><i class="fa fa-exclamation-triangle"></i></div>')})};1==$(this).attr("data-result")?a(1,.5,3):2==$(this).attr("data-result")?a(2,3,10):3==$(this).attr("data-result")?a(3,1,2):4==$(this).attr("data-result")?a(4,.5,2):5==$(this).attr("data-result")?a(5,2,5):6==$(this).attr("data-result")&&a(6,.5,2),e.parent().find(".has-success").find("input").keyup(),$("#mater_form").find(".form-group").eq(7).find(".has-success").find("input").keyup(),$("#mater_form").find(".form-group").eq(8).find(".has-success").find("input").keyup()}),$('input[type="number"][name="mater_surerate"]').mousewheel(function(e){var t=$(this);function a(a,r){-1==e.deltaY&&t.val()>r?t.parents(".form-group").find(".error").remove():1==e.deltaY&&t.val()<a&&t.parents(".form-group").find(".error").remove()}$(this).keyup(),1==$(this).attr("data-result")?a(50,90):2==$(this).attr("data-result")&&a(1,5)}),$('input[type="text"][name="mater_number"], input[type="number"][name="mater_rate"]').mousewheel(function(e){var t=$(this);function a(a,r){-1==e.deltaY&&t.val()>r?t.parents(".form-group").find(".error").remove():1==e.deltaY&&t.val()<a&&t.parents(".form-group").find(".error").remove()}$(this).keyup(),1==$(this).attr("data-result")?a(.5,2):2==$(this).attr("data-result")?a(3,10):3==$(this).attr("data-result")?a(1,2):5==$(this).attr("data-result")?a(2,5):4!=$(this).attr("data-result")&&6!=$(this).attr("data-result")||a(.5,2)}),$('input[type="text"][name="mater_number"], input[type="number"][name="mater_rate"]').change(function(e){if("mater_number"==$(this).attr("name")){var t=l($(this).val());isNaN(1*t)?($(this).val(""),$(this).attr("placeholder","请输入正确的金额")):($(this).val(r(1*t)),s($(this).attr("data-result")))}else s($(this).attr("data-result"))}),$('input[type="number"][name="mater_surerate"]').change(function(){""!=$("#mater_surenum").val()&&""!=$(this).val()?$('input[type="text"][name="mater_sureratenum"][data-result="'+$(this).attr("data-result")+'"]').val(r(l($("#mater_surenum").val())*$(this).val()/100)):$('input[type="text"][name="mater_sureratenum"][data-result="'+$(this).attr("data-result")+'"]').val("")}),$("#finalSettingTypeValue1").change(function(){if(""!=$("#finalSettingTypeValue1").val()&&""!=$(this).val()){var e=l($(this).val());$("#finalSettingTypeValue1").val(r(1*e))}else $("#finalSettingTypeValue1").val(0)}),$("#finalSettingTypeValue2").change(function(){var e=l($(this).val());""!=$("#finalSettingTypeValue2").val()&&""!=$(this).val()?$("#finalSettingTypeValue2").val(r(1*e)):$("#finalSettingTypeValue2").val(0)}),$("#mater_set").click(function(){var e=$('input[type="radio"][name="mater_use"]:checked').attr("data-result");if($('input[type="text"][name="mater_number"][data-result="1"]').closest(".form-group").removeClass("has-error"),$('input[type="text"][name="mater_number"][data-result="2"]').closest(".form-group").removeClass("has-error"),$('input[type="text"][name="mater_number"][data-result="3"]').closest(".form-group").removeClass("has-error"),$('input[type="text"][name="mater_number"][data-result="4"]').closest(".form-group").removeClass("has-error"),$('input[type="number"][name="mater_rate"][data-result="1"]').closest(".form-group").removeClass("has-error"),$('input[type="number"][name="mater_rate"][data-result="2"]').closest(".form-group").removeClass("has-error"),$('input[type="number"][name="mater_rate"][data-result="3"]').closest(".form-group").removeClass("has-error"),$('input[type="number"][name="mater_rate"][data-result="4"]').closest(".form-group").removeClass("has-error"),$('input[type="number"][name="mater_surerate"][data-result="1"]').closest(".form-group").removeClass("has-error"),$('input[type="number"][name="mater_surerate"][data-result="2"]').closest(".form-group").removeClass("has-error"),$("textarea").closest(".form-group").removeClass("has-error"),$("#warnInfo").remove(),"1"==e){var t=l($('input[type="text"][name="mater_number"][data-result="1"]').val()),a=$('input[type="number"][name="mater_rate"][data-result="1"]').val();if(null==t||""==t)return $("#warnInfo").remove(),$('input[type="text"][name="mater_number"][data-result="1"]').closest(".form-group").removeClass("has-error").addClass("has-error"),void $('input[type="text"][name="mater_number"][data-result="1"]').parents(".form-group > div").append('<div id="warnInfo" class="help-block text-right animated fadeInDown">请输入</div>');if(null==a||""==a)return $('input[type="number"][name="mater_rate"][data-result="1"]').closest(".form-group").removeClass("has-error").addClass("has-error"),void $('input[type="number"][name="mater_rate"][data-result="1"]').parents(".form-group > div").append('<div id="warnInfo" class="help-block text-right animated fadeInDown">请输入</div>')}else if("2"==e){t=l($('input[type="text"][name="mater_number"][data-result="2"]').val()),a=$('input[type="number"][name="mater_rate"][data-result="2"]').val();if(null==t||""==t)return $("#warnInfo").remove(),$('input[type="text"][name="mater_number"][data-result="2"]').closest(".form-group").removeClass("has-error").addClass("has-error"),void $('input[type="text"][name="mater_number"][data-result="2"]').parents(".form-group > div").append('<div id="warnInfo" class="help-block text-right animated fadeInDown">请输入</div>');if(null==a||""==a)return $('input[type="number"][name="mater_rate"][data-result="2"]').closest(".form-group").removeClass("has-error").addClass("has-error"),void $('input[type="number"][name="mater_rate"][data-result="2"]').parents(".form-group > div").append('<div id="warnInfo" class="help-block text-right animated fadeInDown">请输入</div>')}else if("3"==e){t=l($('input[type="text"][name="mater_number"][data-result="3"]').val()),a=$('input[type="number"][name="mater_rate"][data-result="3"]').val();if(null==t||""==t)return $("#warnInfo").remove(),$('input[type="text"][name="mater_number"][data-result="3"]').closest(".form-group").removeClass("has-error").addClass("has-error"),void $('input[type="text"][name="mater_number"][data-result="3"]').parents(".form-group > div").append('<div id="warnInfo" class="help-block text-right animated fadeInDown">请输入</div>');if(null==a||""==a)return $('input[type="number"][name="mater_rate"][data-result="3"]').closest(".form-group").removeClass("has-error").addClass("has-error"),void $('input[type="number"][name="mater_rate"][data-result="3"]').parents(".form-group > div").append('<div id="warnInfo" class="help-block text-right animated fadeInDown">请输入</div>')}else if("4"==e){t=l($('input[type="text"][name="mater_number"][data-result="4"]').val()),a=$('input[type="number"][name="mater_rate"][data-result="4"]').val();if(null==t||""==t)return $("#warnInfo").remove(),$('input[type="text"][name="mater_number"][data-result="4"]').closest(".form-group").removeClass("has-error").addClass("has-error"),void $('input[type="text"][name="mater_number"][data-result="4"]').parents(".form-group > div").append('<div id="warnInfo" class="help-block text-right animated fadeInDown">请输入</div>');if(null==a||""==a)return $('input[type="number"][name="mater_rate"][data-result="4"]').closest(".form-group").removeClass("has-error").addClass("has-error"),void $('input[type="number"][name="mater_rate"][data-result="4"]').parents(".form-group > div").append('<div id="warnInfo" class="help-block text-right animated fadeInDown">请输入</div>')}var r=$('input[type="number"][name="mater_surerate"][data-result="1"]').val(),s=$('input[type="number"][name="mater_surerate"][data-result="2"]').val();if(null==r||""==r)return $('input[type="number"][name="mater_surerate"][data-result="1"]').closest(".form-group").removeClass("has-error").addClass("has-error"),void $('input[type="number"][name="mater_surerate"][data-result="1"]').parents(".form-group > div").append('<div id="warnInfo" class="help-block text-right animated fadeInDown">请输入</div>');if(null==s||""==s)return $('input[type="number"][name="mater_surerate"][data-result="2"]').closest(".form-group").removeClass("has-error").addClass("has-error"),void $('input[type="number"][name="mater_surerate"][data-result="2"]').parents(".form-group > div").append('<div id="warnInfo" class="help-block text-right animated fadeInDown">请输入</div>');var o=$('textarea[name="mater_reason"]').val();if(null==o||""==o)return $("textarea").closest(".form-group").removeClass("has-error").addClass("has-error"),void $("textarea").parents(".form-group > div").append('<div id="warnInfo" class="help-block text-right animated fadeInDown">请输入</div>');if($("#mater_form .error").length>0)$("#mater_form .error").hide().fadeIn(500);else{var n=parseFloat(l($('input[type="text"][name="mater_sureratenum"][data-result="1"]').val())),i=parseFloat(l($('input[type="text"][name="mater_sureratenum"][data-result="2"]').val())),c=0,u=0;d($("#mergeSettingTypeValue1").val())||(c=parseFloat(l($("#mergeSettingTypeValue1").val()))),d($("#mergeSettingTypeValue2").val())||(u=parseFloat(l($("#mergeSettingTypeValue2").val())));var m=0,p=0;if(c>0||u>0){if(d($("#finalSettingTypeValue1").val())||d($("#finalSettingTypeValue2").val()))return bdoInfoBox("提示","请输入最终实施的重要性水平"),!1;if(m=parseFloat(l($("#finalSettingTypeValue1").val())),p=parseFloat(l($("#finalSettingTypeValue2").val())),m>c||m>n||p>u||p>i)return bdoInfoBox("提示","最终实施的重要性水平不能大于集团分配的的重要性水平和选择的重要性水平!"),!1}else m=n,p=i;var b={projectId:window.CUR_PROJECTID,customerId:window.CUR_CUSTOMERID,materIndex:$('input[name="mater_index"]').val(),editUser:window.sys_userId,editDate:$('input[name="mater_editdate"]').val(),reason:$('textarea[name="mater_reason"]').val(),settingType:e,settingTypeValue1:l($('input[type="text"][name="mater_sureratenum"][data-result="1"]').val()),settingTypeValue2:l($('input[type="text"][name="mater_sureratenum"][data-result="2"]').val()),settingValue1:l($('input[type="text"][name="mater_number"][data-result="1"]').val()),settingRate1:$('input[type="number"][name="mater_rate"][data-result="1"]').val(),settingImportValue1:l($('input[type="text"][name="mater_ratenum"][data-result="1"]').val()),settingRateOne1:$('input[type="number"][name="mater_surerate"][data-result="1"]').val(),settingRateTwo1:$('input[type="number"][name="mater_surerate"][data-result="2"]').val(),settingValue2:l($('input[type="text"][name="mater_number"][data-result="2"]').val()),settingRate2:$('input[type="number"][name="mater_rate"][data-result="2"]').val(),settingImportValue2:l($('input[type="text"][name="mater_ratenum"][data-result="2"]').val()),settingRateOne2:$('input[type="number"][name="mater_surerate"][data-result="1"]').val(),settingRateTwo2:$('input[type="number"][name="mater_surerate"][data-result="2"]').val(),settingValue3:l($('input[type="text"][name="mater_number"][data-result="3"]').val()),settingRate3:$('input[type="number"][name="mater_rate"][data-result="3"]').val(),settingImportValue3:l($('input[type="text"][name="mater_ratenum"][data-result="3"]').val()),settingRateOne3:$('input[type="number"][name="mater_surerate"][data-result="1"]').val(),settingRateTwo3:$('input[type="number"][name="mater_surerate"][data-result="2"]').val(),settingValue4:l($('input[type="text"][name="mater_number"][data-result="4"]').val()),settingRate4:$('input[type="number"][name="mater_rate"][data-result="4"]').val(),settingImportValue4:l($('input[type="text"][name="mater_ratenum"][data-result="4"]').val()),settingRateOne4:$('input[type="number"][name="mater_surerate"][data-result="1"]').val(),settingRateTwo4:$('input[type="number"][name="mater_surerate"][data-result="2"]').val(),settingValue5:l($('input[type="text"][name="mater_number"][data-result="5"]').val()),settingRate5:$('input[type="number"][name="mater_rate"][data-result="5"]').val(),settingImportValue5:l($('input[type="text"][name="mater_ratenum"][data-result="5"]').val()),settingRateOne5:$('input[type="number"][name="mater_surerate"][data-result="1"]').val(),settingRateTwo5:$('input[type="number"][name="mater_surerate"][data-result="2"]').val(),settingValue6:l($('input[type="text"][name="mater_number"][data-result="6"]').val()),settingRate6:$('input[type="number"][name="mater_rate"][data-result="6"]').val(),settingImportValue6:l($('input[type="text"][name="mater_ratenum"][data-result="6"]').val()),settingRateOne6:$('input[type="number"][name="mater_surerate"][data-result="1"]').val(),settingRateTwo6:$('input[type="number"][name="mater_surerate"][data-result="2"]').val(),finalSettingTypeValue1:m,finalSettingTypeValue2:p};$.ajax({type:"post",url:"dgCenter/MaterialitySetting.materSetting.json",dataType:"json",data:{param1:JSON.stringify(b)},success:function(e){e.success?bdoSuccessBox("成功",e.resultInfo.statusText):bdoErrorBox("失败",e.resultInfo.statusText)}})}}),$("#openMaterModal").on("click",function(){void 0!=$('input[type="radio"][name="mater_use"]:checked').attr("data-result")?$("#materialityModal").modal("show"):bdoInfoBox("提示","请先在重要性水平计算选择一个科目！")});function d(e){return void 0===e||null==e||""==e}$("#exportLevel").click(function(){var t=!0;if($.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",async:!1,data:{menuId:window.sys_menuId,sqlId:"DG00197",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,start:-1,limit:-1},dataType:"json",success(e){e.success&&sys_userId!=e.data[0].manager&&(t=!1)}}),t){$.sessionStorage("autoId",e.data.autoId);var a=parseFloat(l($('input[type="text"][name="mater_sureratenum"][data-result="1"]').val())),r=parseFloat(l($('input[type="text"][name="mater_sureratenum"][data-result="2"]').val())),s=0,o=0;d($("#mergeSettingTypeValue1").val())||(s=parseFloat(l($("#mergeSettingTypeValue1").val()))),d($("#mergeSettingTypeValue2").val())||(o=parseFloat(l($("#mergeSettingTypeValue2").val())));var n=0,i=0;if(s>0||o>0){if(d($("#finalSettingTypeValue1").val())||d($("#finalSettingTypeValue2").val()))return bdoInfoBox("提示","请输入最终实施的重要性水平"),!1;if(n=parseFloat(l($("#finalSettingTypeValue1").val())),i=parseFloat(l($("#finalSettingTypeValue2").val())),n>s||n>a||i>o||i>r)return bdoInfoBox("提示","最终实施的重要性水平不能大于集团分配的的重要性水平和选择的重要性水平!"),!1}else n=a,i=r;var c,u=$('input[type="radio"][name="mater_use"]:checked').attr("data-result");if(null==u||void 0==u||""==u)bdoInfoBox("","请先在重要性水平计算选择一个科目！");else{var m={projectId:window.CUR_PROJECTID,customerId:window.CUR_CUSTOMERID,autoId:JSON.parse($.sessionStorage("autoId")),materIndex:$('input[name="mater_index"]').val(),editUser:window.sys_userId,editDate:$('input[name="mater_editdate"]').val(),reason:(c=$('textarea[name="mater_reason"]').val(),c.replace(/\r\n/g,"<br/>").replace(/\n/g,"<br/>").replace(/\s/g," ")),settingType:u,settingTypeValue1:l($('input[type="text"][name="mater_sureratenum"][data-result="1"]').val()),settingTypeValue2:l($('input[type="text"][name="mater_sureratenum"][data-result="2"]').val()),mergeSettingTypeValue1:l($("#mergeSettingTypeValue1").val()),mergeSettingTypeValue2:l($("#mergeSettingTypeValue2").val()),finalSettingTypeValue1:l($("#finalSettingTypeValue1").val()),finalSettingTypeValue2:l($("#finalSettingTypeValue2").val()),settingValue1:l($('input[type="text"][name="mater_number"][data-result="1"]').val()),settingRate1:$('input[type="number"][name="mater_rate"][data-result="1"]').val(),settingImportValue1:l($('input[type="text"][name="mater_ratenum"][data-result="1"]').val()),settingRateOne1:$('input[type="number"][name="mater_surerate"][data-result="1"]').val(),settingRateTwo1:$('input[type="number"][name="mater_surerate"][data-result="2"]').val(),settingValue2:l($('input[type="text"][name="mater_number"][data-result="2"]').val()),settingRate2:$('input[type="number"][name="mater_rate"][data-result="2"]').val(),settingImportValue2:l($('input[type="text"][name="mater_ratenum"][data-result="2"]').val()),settingRateOne2:$('input[type="number"][name="mater_surerate"][data-result="1"]').val(),settingRateTwo2:$('input[type="number"][name="mater_surerate"][data-result="2"]').val(),settingValue3:l($('input[type="text"][name="mater_number"][data-result="3"]').val()),settingRate3:$('input[type="number"][name="mater_rate"][data-result="3"]').val(),settingImportValue3:l($('input[type="text"][name="mater_ratenum"][data-result="3"]').val()),settingRateOne3:$('input[type="number"][name="mater_surerate"][data-result="1"]').val(),settingRateTwo3:$('input[type="number"][name="mater_surerate"][data-result="2"]').val(),settingValue4:l($('input[type="text"][name="mater_number"][data-result="4"]').val()),settingRate4:$('input[type="number"][name="mater_rate"][data-result="4"]').val(),settingImportValue4:l($('input[type="text"][name="mater_ratenum"][data-result="4"]').val()),settingRateOne4:$('input[type="number"][name="mater_surerate"][data-result="1"]').val(),settingRateTwo4:$('input[type="number"][name="mater_surerate"][data-result="2"]').val(),settingValue5:l($('input[type="text"][name="mater_number"][data-result="5"]').val()),settingRate5:$('input[type="number"][name="mater_rate"][data-result="5"]').val(),settingImportValue5:l($('input[type="text"][name="mater_ratenum"][data-result="5"]').val()),settingRateOne5:$('input[type="number"][name="mater_surerate"][data-result="1"]').val(),settingRateTwo5:$('input[type="number"][name="mater_surerate"][data-result="2"]').val(),settingValue6:l($('input[type="text"][name="mater_number"][data-result="6"]').val()),settingRate6:$('input[type="number"][name="mater_rate"][data-result="6"]').val(),settingImportValue6:l($('input[type="text"][name="mater_ratenum"][data-result="6"]').val()),settingRateOne6:$('input[type="number"][name="mater_surerate"][data-result="1"]').val(),settingRateTwo6:$('input[type="number"][name="mater_surerate"][data-result="2"]').val()};if("1"==u){if(d(m.settingImportValue1)||d(m.settingRateOne1)||d(m.settingRateTwo1)||d(m.settingTypeValue1)||d(m.settingTypeValue2)||d(m.reason)||d(m.settingRate1))return bdoInfoBox("提示","请先保存数据再导出!"),!1}else if("2"==u){if(d(m.settingImportValue2)||d(m.settingRateOne2)||d(m.settingRateTwo2)||d(m.settingTypeValue1)||d(m.settingTypeValue2)||d(m.reason)||d(m.settingRate2))return bdoInfoBox("提示","请先保存数据再导出!"),!1}else if("3"==u){if(d(m.settingImportValue3)||d(m.settingRateOne3)||d(m.settingRateTwo3)||d(m.settingTypeValue1)||d(m.settingTypeValue2)||d(m.reason)||d(m.settingRate3))return bdoInfoBox("提示","请先保存数据再导出!"),!1}else if("4"==u){if(d(m.settingImportValue4)||d(m.settingRateOne4)||d(m.settingRateTwo4)||d(m.settingTypeValue1)||d(m.settingTypeValue2)||d(m.reason)||d(m.settingRate4))return bdoInfoBox("提示","请先保存数据再导出!"),!1}else if("5"==u){if(d(m.settingImportValue5)||d(m.settingRateOne5)||d(m.settingRateTwo5)||d(m.settingTypeValue1)||d(m.settingTypeValue2)||d(m.reason)||d(m.settingRate5))return bdoInfoBox("提示","请先保存数据再导出!"),!1}else if("6"==u&&(d(m.settingImportValue6)||d(m.settingRateOne6)||d(m.settingRateTwo6)||d(m.settingTypeValue1)||d(m.settingTypeValue2)||d(m.reason)||d(m.settingRate6)))return bdoInfoBox("提示","请先保存数据再导出!"),!1;$.ajax({type:"post",url:"dgCenter/ExportOtherDg.materSettingExport.json",data:{param1:JSON.stringify(m)},dataType:"json",success:function(t){if(t.success){if(t.data&&t.data.length>0){let a=t.data[0].fileData,r=t.data[0].fileName,l=t.data[0].isNew;if(bdoInfoBox("成功",r+"导出成功！"),saveAs(dataURLtoFile(a,r),r),!l)return;getSubjecttree({param1:window.CUR_PROJECTID,param2:$("#onlyMyselfCheckBox").get(0).checked?"1":""},t=>{$(".js-tree-collapsed").trigger("rebuild",[{data:[t.data[0].treeData],levels:3,callback(t){t.expandNode(e.data.nodeId,{levels:e.data.deep+2,silent:!0}),t.selectNode(e.data.nodeId,{silent:!0}),e.data=t.getNode(e.data.nodeId)}}])})}}else bdoErrorBox("失败",t.resultInfo&&t.resultInfo.statusText)}})}}else bdoInfoBox("提示","非项目负责人无权限导出重要性水平设置！")}),$("#mergeMateriality").click(function(){var e=$('input[type="text"][name="mater_sureratenum"][data-result="1"]').val(),t=$('input[type="text"][name="mater_sureratenum"][data-result="2"]').val();if(d(e)||d(t))return bdoInfoBox("提示","请先输入重要性水平"),!1;this.mergeMaterialitySider=side({el:"#mergeMaterialitySider"}),this.mergeMaterialitySider.show(),this.mergeMaterialitySider.autoHide=!1;MergeMaterialityPage({region:"#mergeMaterialityRegion",data:{settingTypeValue1:e,settingTypeValue2:t}})}),$("#materialityModal").on("show.bs.modal",function(){$("#mater_type").get(0).selectedIndex=0,$("#mater_subject_1").get(0).selectedIndex=0,$("#mater_subject_2").get(0).selectedIndex=0,$("#mater_subject_text_1").css({display:"block"}),$("#mater_subject_text_2").css({display:"none"}),$("#mater_subjectId").val(""),$("#mater_subjectName").val(""),$("#mater_auditAmount").val(""),$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",async:!1,data:{menuId:window.sys_menuId,sqlId:"DG00111",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,start:-1,limit:-1},dataType:"json",success(e){if(e.success){var t,a=$('input[type="radio"][name="mater_use"]:checked').attr("data-result");if("1"==a&&e.data[0]&&e.data[0].constitute1?t=e.data[0].constitute1:"2"==a&&e.data[0]&&e.data[0].constitute2?t=e.data[0].constitute2:"3"==a&&e.data[0]&&e.data[0].constitute3?t=e.data[0].constitute3:"4"==a&&e.data[0]&&e.data[0].constitute4&&(t=e.data[0].constitute4),null!=t&&""!=t){t=t.replace(new RegExp(/"/g),""),$("#itemGroup").html("");for(var l=t.split(","),s=0;s<l.length;s++){let e,t=l[s],a=$("#itemGroup .col-sm-2 input").length;e=a>0?$('<div class="col-sm-1"><div class="form-material"><select class="form-control"><option value="+">+</option></select></div></div><div class="col-sm-2"><div class="form-material input-group"><input class="form-control" type="text" readonly></div></div>'):$('<div class="col-sm-2"><div class="form-material input-group"><input class="form-control" type="text" readonly></div></div>'),$("#itemGroup").append(e),$("#itemGroup .col-sm-2 input")[a].value=t;for(let e of tbList)if(e.tbSubjectId==t)return $("#itemGroup .col-sm-2 input")[a].title=e.tbSubjectId+"-"+e.tbSubjectName+":"+r(parseFloat(e.auditAmount)),void(s==l.length-1&&($("#mater_subject_1").val(e.tbSubjectId),$("#mater_subject_text_1").val(e.tbSubjectId+":"+e.tbSubjectName),$("#mater_subjectId").val(e.tbSubjectId),$("#mater_subjectName").val(e.tbSubjectName),$("#mater_auditAmount").val(r(parseFloat(e.auditAmount)))));for(let e of reportList)if(e.colCode==t)return $("#itemGroup .col-sm-2 input")[a].title=e.colCode+"-"+e.colDisp+":"+r(parseFloat(e.auditedAmount)),void(s==l.length-1&&($("#mater_subject_2").val(e.colCode),$("#mater_subject_text_2").val(e.colCode+":"+e.colDisp),$("#mater_subjectId").val(e.colCode),$("#mater_subjectName").val(e.colDisp),$("#mater_auditAmount").val(r(parseFloat(e.auditedAmount)))))}}else $("#itemGroup").html("")}}})}),$("#mater_type").change(function(){"1"===$(this).val()?($("#mater_subject_text_1").css({display:"block"}),$("#mater_subject_text_2").css({display:"none"}),$("#mater_subject_1").get(0).selectedIndex=0):"2"===$(this).val()&&($("#mater_subject_text_1").css({display:"none"}),$("#mater_subject_text_2").css({display:"block"}),$("#mater_subject_2").get(0).selectedIndex=0)}),$(document).bind("click",function(e){for(var t=(e=e||window.event).target||e.srcElement;t;){if(t.id&&("mater_subject_text_1"==t.id||"mater_subject_1"==t.id))return;t=t.parentNode}$("#mater_subject_1").css("display","none")}),$("#mater_subject_text_1").on("focus",function(){$("#mater_subject_1").empty(),$("#mater_subject_1").css({display:""});for(let e of tbList)-1!=(e.tbSubjectId+":"+e.tbSubjectName).indexOf(this.value)&&$("#mater_subject_1").append("<option value='"+e.tbSubjectId+"' title='"+e.tbSubjectName+"' data-amount='"+e.auditAmount+"' data-name='"+e.tbSubjectName+"'>"+e.tbSubjectId+":"+e.tbSubjectName+"</option>")}),$("#mater_subject_text_1").on("input",function(){$("#mater_subject_1").empty(),$("#mater_subject_1").css({display:""});for(let e of tbList)-1!=(e.tbSubjectId+":"+e.tbSubjectName).indexOf(this.value)&&$("#mater_subject_1").append("<option value='"+e.tbSubjectId+"' title='"+e.tbSubjectName+"' data-amount='"+e.auditAmount+"' data-name='"+e.tbSubjectName+"'>"+e.tbSubjectId+":"+e.tbSubjectName+"</option>")}),$("#mater_subject_1").change(function(){var e=$("#mater_subject_1").val(),t=$("#mater_subject_1 option:selected").attr("data-name"),a=$("#mater_subject_1 option:selected").attr("data-amount");$("#mater_subjectId").val(e),$("#mater_subjectName").val(t),$("#mater_auditAmount").val(a),$("#mater_subject_1").css({display:"none"})}),$(document).bind("click",function(e){for(var t=(e=e||window.event).target||e.srcElement;t;){if(t.id&&("mater_subject_text_2"==t.id||"mater_subject_2"==t.id))return;t=t.parentNode}$("#mater_subject_2").css("display","none")}),$("#mater_subject_text_2").on("focus",function(){$("#mater_subject_2").empty(),$("#mater_subject_2").css({display:""});for(let e of reportList)-1!=(e.colCode+":"+e.colDisp).indexOf(this.value)&&$("#mater_subject_2").append("<option value='"+e.colCode+"' title='"+e.colDisp+"' data-amount='"+e.auditedAmount+"' data-name='"+e.colDisp+"'>"+e.colCode+":"+e.colDisp+"</option>")}),$("#mater_subject_text_2").on("input",function(){$("#mater_subject_2").empty(),$("#mater_subject_2").css({display:""});for(let e of reportList)-1!=(e.colCode+":"+e.colDisp).indexOf(this.value)&&$("#mater_subject_2").append("<option value='"+e.colCode+"' title='"+e.colDisp+"' data-amount='"+e.auditedAmount+"' data-name='"+e.colDisp+"'>"+e.colCode+":"+e.colDisp+"</option>")}),$("#mater_subject_2").change(function(){var e=$("#mater_subject_2").val(),t=$("#mater_subject_2 option:selected").attr("data-name"),a=$("#mater_subject_2 option:selected").attr("data-amount");$("#mater_subjectId").val(e),$("#mater_subjectName").val(t),$("#mater_auditAmount").val(a),$("#mater_subject_2").css({display:"none"})}),$("#undoItemBtn").click(function(){let e=$("#itemGroup .col-sm-2 input").length;e>0&&$("#itemGroup .col-sm-2")[e-1].remove();let t=$("#itemGroup .col-sm-1 select").length;t>0&&$("#itemGroup .col-sm-1")[t-1].remove()}),$("#addItemBtn").click(function(){if(""!=$("#mater_subjectId").val()){let e,t=$("#itemGroup .col-sm-2 input").length;e=t>0?$('<div class="col-sm-1"><div class="form-material"><select class="form-control"><option value="+">+</option></select></div></div><div class="col-sm-2"><div class="form-material input-group"><input class="form-control" type="text" readonly></div></div>'):$('<div class="col-sm-2"><div class="form-material input-group"><input class="form-control" type="text" readonly></div></div>'),$("#itemGroup").append(e),$("#itemGroup .col-sm-2 input")[t].value=$("#mater_subjectId").val(),$("#itemGroup .col-sm-2 input")[t].title=$("#mater_subjectId").val()+"-"+$("#mater_subjectName").val()+":"+r(parseFloat($("#mater_auditAmount").val()))}else bdoInfoBox("提示","请选择科目！")}),$("#setMaterBtn").click(function(){var e=$("#itemGroup .col-sm-2 input").length;if(e>0){for(var t='"'+$("#itemGroup .col-sm-2 input")[0].value+'"',a=1;a<e;a++)t=t+',"'+$("#itemGroup .col-sm-2 input")[a].value+'"';var r=$('input[type="radio"][name="mater_use"]:checked').attr("data-result");$.ajax({url:"dgCenter/MaterialitySetting.setMaterNum.json",type:"post",data:{param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:t,param4:r},dataType:"json",success:function(e){e.success&&(n(r),i(r),bdoSuccessBox("成功","设置成功！"),$("#materialityModal").modal("hide"))}})}else bdoErrorBox("失败","请添加TB或报表科目！")}),$.ajax({url:"dgCenter/MaterialitySetting.initMaterNum.json",type:"post",data:{},dataType:"json",success:function(e){e.success?e.data&&e.data.length>0&&(1==e.data[0].hasMergerReport&&($("#mergerReport").show(),$("#mergeSettingTypeValue1").val(r(e.data[0].settingTypeValue1)),$("#mergeSettingTypeValue2").val(r(e.data[0].settingTypeValue2))),1==e.data[0].isMergerReport?$("#mergeMateriality").show():t=e.data[0].mergerMateriality):bdoErrorBox("失败",e.resultInfo.statusText)}}),$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",dataType:"json",data:{menuId:window.sys_menuId,sqlId:"DG00085",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,start:-1,limit:-1},success:function(e){if(e.success){var t=e.data[0];if(!t||0==e.data.length){var a=$(".js-tree-collapsed").treeview(!0).getSelected()[0];return $('input[name="mater_index"]').val(a.extraOptions.indexId),$('input[name="mater_editer"]').val(window.selfNm),void $('input[name="mater_editdate"]').val(o())}if(null==t.materIndex||""==t.materIndex){a=$(".js-tree-collapsed").treeview(!0).getSelected()[0];$('input[name="mater_index"]').val(a.extraOptions.indexId)}else $('input[name="mater_index"]').val(t.materIndex);null==t.__ueditUserName||""==t.__ueditUserName?$('input[name="mater_editer"]').val(window.selfNm):$('input[name="mater_editer"]').val(t.__ueditUserName),null==t.editDate||""==t.editDate?$('input[name="mater_editdate"]').val(o()):$('input[name="mater_editdate"]').val(t.editDate),$('textarea[name="mater_reason"]').val(t.reason),$('input[type="text"][name="mater_number"][data-result="1"]').val(r(1*t.settingValue1)),$('input[type="number"][name="mater_rate"][data-result="1"]').val(t.settingRate1),$('input[type="number"][name="mater_surerate"][data-result="1"]').val(t.settingRateOne1),$('input[type="number"][name="mater_surerate"][data-result="2"]').val(t.settingRateTwo1),$('input[type="text"][name="mater_number"][data-result="2"]').val(r(1*t.settingValue2)),$('input[type="number"][name="mater_rate"][data-result="2"]').val(t.settingRate2),$('input[type="number"][name="mater_surerate"][data-result="1"]').val(t.settingRateOne2),$('input[type="number"][name="mater_surerate"][data-result="2"]').val(t.settingRateTwo2),$('input[type="text"][name="mater_number"][data-result="3"]').val(r(1*t.settingValue3)),$('input[type="number"][name="mater_rate"][data-result="3"]').val(t.settingRate3),$('input[type="number"][name="mater_surerate"][data-result="1"]').val(t.settingRateOne3),$('input[type="number"][name="mater_surerate"][data-result="2"]').val(t.settingRateTwo3),$('input[type="text"][name="mater_number"][data-result="4"]').val(r(1*t.settingValue4)),$('input[type="number"][name="mater_rate"][data-result="4"]').val(t.settingRate4),$('input[type="number"][name="mater_surerate"][data-result="1"]').val(t.settingRateOne4),$('input[type="number"][name="mater_surerate"][data-result="2"]').val(t.settingRateTwo4),$('input[type="text"][name="mater_number"][data-result="5"]').val(r(1*t.settingValue5)),$('input[type="number"][name="mater_rate"][data-result="5"]').val(t.settingRate5),$('input[type="number"][name="mater_surerate"][data-result="1"]').val(t.settingRateOne5),$('input[type="number"][name="mater_surerate"][data-result="2"]').val(t.settingRateTwo5),$('input[type="text"][name="mater_number"][data-result="6"]').val(r(1*t.settingValue6)),$('input[type="number"][name="mater_rate"][data-result="6"]').val(t.settingRate6),$('input[type="number"][name="mater_surerate"][data-result="1"]').val(t.settingRateOne6),$('input[type="number"][name="mater_surerate"][data-result="2"]').val(t.settingRateTwo6),$('input[type="radio"][name="mater_use"][data-result="'+t.settingType+'"]').attr("checked","checked"),$('input[type="radio"][name="mater_use"][data-result="'+t.settingType+'"]').click(),$("#mater_form").find(".form-group").eq(5).find(".has-success").find("input").keyup(),$("#mater_form").find(".form-group").eq(6).find(".has-success").find("input").keyup();for(var l=["1","2","3","4"],n=0;n<l.length;n++)l[n]!=t.settingType&&s(l[n]);$("#finalSettingTypeValue1").val(r(t.finalSettingTypeValue1)),$("#finalSettingTypeValue2").val(r(t.finalSettingTypeValue2))}}}),listener=(()=>{}),mount=(()=>{listener(),OneUI.initHelper("slimscroll")}),mount()}var MergeMaterialityPage=e=>{var t,a,r,l,s,o;function n(e){if(d(e))return"0";for(var t=(e=e.toFixed(2)).split(".")[0],a=e.split(".")[1],r=t.toString(),l="",s="",o=r.length-1;o>=0;o--)s++,l=r.charAt(o)+l,s%3||0==o||(l=","+l);return","==l[0]&&(l=l.replace(",","")),t<0&&","==l[1]&&(l=l.replace(",","")),l+"."+a}function i(e){if(e){var t=new RegExp(",","g");e=e.replace(t,"")}return e}function d(e){return void 0===e||null==e||""==e}function c(){$.ajax({url:"cpBase/General.query.json",type:"post",data:{sqlId:"DG20008",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID},dataType:"json",success:function(e){if(e.success&&e.data.length>0){e=e.data[0];var t=i(a.settingTypeValue1)-e.settingTypeValue1Total,r=i(a.settingTypeValue2)-e.settingTypeValue2Total;$("#surplusSettingTypeValue1Total").val("0.00"),$("#surplusSettingTypeValue2Total").val("0.00"),t>0&&$("#surplusSettingTypeValue1Total").val(n(t)),r>0&&$("#surplusSettingTypeValue2Total").val(n(r))}}})}t=e.template||tplLoader("dgCenter/html/dg/mergeMateriality.html"),e.template=t,a=e.data,s=(()=>{$("#mergeMaterialityTable").on("click",'button[name="editMateriality"]',function(){var e=$("#mergeMaterialityTable").DataTable().data()[$(this).closest("tr").index()];$("#distributionMaterialityModal").modal("show"),$("#mergeAutoId").val(e.autoId),$("#shortName").val(e.shortName),$("#stockBreakRate").val(e.stockBreakRate),$("#distributionMaterialityValue1").val(n(e.settingTypeValue1)),$("#distributionMaterialityValue2").val(n(e.settingTypeValue2)),$("#settingTypeValue1").val(a.settingTypeValue1),$("#settingTypeValue2").val(a.settingTypeValue2)}),$("#distributionMaterialityValue1").change(function(){if(""!=$("#distributionMaterialityValue1").val()&&""!=$(this).val()){var e=i($(this).val());$("#distributionMaterialityValue1").val(n(1*e))}else $("#distributionMaterialityValue1").val(0)}),$("#distributionMaterialityValue2").change(function(){var e=i($(this).val());""!=$("#distributionMaterialityValue2").val()&&""!=$(this).val()?$("#distributionMaterialityValue2").val(n(1*e)):$("#distributionMaterialityValue2").val(0)}),$("#materiality_save").click(function(){if(d($("#distributionMaterialityValue1").val())||d($("#distributionMaterialityValue2").val()))return bdoInfoBox("提示","请给子项目分配重要性水平!"),!1;var e=parseFloat(i($("#distributionMaterialityValue1").val())),t=parseFloat(i($("#distributionMaterialityValue2").val())),a=parseFloat(i($("#settingTypeValue1").val())),r=parseFloat(i($("#settingTypeValue2").val()));if(e>a||t>r)return bdoInfoBox("提示","分配的重要性水平不能大于集团的重要性水平!"),!1;$.ajax({url:"dgCenter/MaterialitySetting.updateMaterNum.json",type:"post",data:{param1:e,param2:t,param3:$("#mergeAutoId").val()},dataType:"json",success:function(e){e.success?(bdoSuccessBox("成功",e.resultInfo.statusText),$("#distributionMaterialityModal").modal("hide"),$("#mergeMaterialityTable").DataTable().ajax.reload(),c()):bdoErrorBox("失败",e.resultInfo.statusText)}})})}),r=(()=>{$(e.region).empty().append(t),BdoDataTable("mergeMaterialityTable",o),$("#settingTypeValue1Total").val(a.settingTypeValue1),$("#settingTypeValue2Total").val(a.settingTypeValue2),s(),c(),$(".col-sm-6").attr("style","display:none")}),o={localParam:{url:"dgCenter/DgGeneral.query.json",urlparam:{menuId:window.sys_menuId,sqlId:"DG00322",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID},tabNum:!0},tableParam:{select:!0,lengthChange:!0,serverSide:!0,scrollY:!1,columnDefs:[{targets:(()=>(l=0,++l))(),orderable:!1,className:"text-center",title:"处理",data:null,width:"100px",render:function(e,t,a,r){e.suffix;return'<button class="btn btn-xs table-btn-operate btn-primary" type="button" name="editMateriality" data-placement="top" title="修改" data-toggle="tooltip" data-row="'+r.row+'">\t<i class="fa fa-edit"></i></button>'}},{targets:++l,orderable:!0,title:"子企业名称",name:"mergeCustomerName",data:"mergeCustomerName",width:"100px"},{targets:++l,orderable:!0,title:"项目简称",name:"shortName",data:"shortName",width:"100px"},{targets:++l,orderable:!0,className:"text-center",title:"股权比例",name:"stockBreakRate",data:"stockBreakRate",width:"50px"},{targets:++l,orderable:!0,className:"text-center",title:"合并范围",name:"mergeScope",data:"mergeScope",width:"80px",render:e=>DicVal2Nm(e,"合并范围")},{targets:++l,orderable:!0,className:"text-right width-je",title:"重要性水平",name:"settingTypeValue1",data:"settingTypeValue1",width:"100px",render:function(e,t,a,r){return formatMoney(e)}},{targets:++l,orderable:!0,className:"text-right width-je",title:"明显微小错报",name:"settingTypeValue2",data:"settingTypeValue2",width:"100px",render:function(e,t,a,r){return formatMoney(e)}},{targets:++l,orderable:!0,className:"text-left",title:"项目名称",name:"mergeProjectName",data:"mergeProjectName",width:"200px"},{targets:++l,orderable:!0,className:"text-center",title:"项目来源",name:"projectSource",data:"projectSource",width:"50px",render:function(e,t,a,r){return 1==e?"SACP":"非SACP"}}]}},r(),$('input[type="text"][name="distributionMaterialityValue"]').change(function(e){if("distributionMaterialityValue"==$(this).attr("name")){var t=i($(this).val());(isNaN(1*t)||t<=0)&&($(this).val(""),$(this).attr("placeholder","请输入正确的金额"))}})};function EditProgramPage(e){let t,a,r,l,s,o=e.data,n=e.template||tplLoader("dgCenter/html/dg/editProgram.html");s={props:{programInfo:Object,rownum:Number,currentValue:String,datas:Array},data(){return{editMan:this.currentValue}},watch:{editMan(e){this.programInfo.workpaperEditor=e,this.currentValue!=e&&this.updateProgramEditor()}},computed:{editManDisabled:()=>CUR_USERID!=JSON.parse($.sessionStorage("projectManager"))&&void 0!=JSON.parse($.sessionStorage("projectManager"))},methods:{updateProgramEditor(){let e,t=this.datas,a=this.editMan;t.map(function(t){a==t.id&&(e=""==t.value?t.text:t.value)}),$.ajax({type:"post",url:"dgCenter/DgMain.updateProgramEditor.json",data:{param1:this.programInfo.autoId,param2:this.programInfo.customerId,param3:this.programInfo.projectId,param4:this.editMan,param5:this.programInfo.dgName,param6:e},dataType:"json",bdolxLoader:!1}).done(e=>{e.success?(OneUI.notifySuccess("保存成功！"),this.currentValue=this.editMan):OneUI.notifyError(e.resultInfo.statusText)})}},template:'<div>\t<div class="form-material">\t\t<select class="form-control" v-model="editMan" style="margin-left:5px" :disabled="editManDisabled">\t\t\t<option v-for="(data, index) in datas" :value="data.id">{{ data.text }}</option>\t\t</select>\t</div></div>'},t=((e,t,a,r,l)=>{var s="css-checkbox-primary";return 1==l&&(e!=a&&(s="css-checkbox-danger"),t!=r&&"score-red"),'<label class="css-input css-checkbox '+s+' control-label" >\t\t\t<input type="checkbox" '+("1"==e?"checked":"")+" disabled>\t\t\t<span></span>\t\t</label>"}),l={components:{"score-edit":r={props:{programInfo:Object,ecavp:String,rownum:Number},data:()=>({ecavpVal:!1,score:"",originalScore:"",originalVal:!1,esValCache:{},checkValCache:!1,scoreValCache:"",canSubmit:!1}),watch:{ecavpVal(e){this.programInfo["cs"+this.ecavp]=e?1:0,this.score=1!=e&&1!=e?"":this.score?this.score:0,this.originalVal!=e?this.$parent.updateRowMark[this.rownum]+=1:this.$parent.updateRowMark[this.rownum]-=1,this.$parent.updateRowMark[this.rownum]<0&&(this.$parent.updateRowMark[this.rownum]=0)},score(e){if(this.esValCache[e]>0)return;let t=e,a=!1;1!=this.ecavpVal&&1!=this.ecavpVal?t="":(t=t||0,a=!0),(t=(t=(t=(t=String(t).replace(/[^\d.]/g,"")).replace(/\.{2,}/g,".")).replace(".","$#$").replace(/\./g,"").replace("$#$",".")).replace(/^(\-)*(\d+)\.(\d\d).*$/,"$1$2.$3")).indexOf(".")<0&&""!=t&&(t=parseFloat(t)),parseFloat(t)>3&&(t=3),this.score=t,this.programInfo["s"+this.ecavp]=t,this.originalScore!=t?this.$parent.updateRowMark[this.rownum]+=1:this.$parent.updateRowMark[this.rownum]-=1,this.$parent.updateRowMark[this.rownum]<0&&(this.$parent.updateRowMark[this.rownum]=0),this.esValCache[this.score]||(this.esValCache[this.score]=1)}},computed:{labelClass(){let e=["css-input","css-checkbox","control-label","css-checkbox-primary"];return 1!=this.programInfo.customizeFlag&&this.programInfo["cs"+this.ecavp]!=this.programInfo["cs"+this.ecavp+"Original"]?e[3]="css-checkbox-danger":e[3]="css-checkbox-primary",e},scoreClass(){let e=["form-control text-center"];return 1!=this.programInfo.customizeFlag&&this.cmpScoreVal()?e.push("score-red"):e=["form-control text-center"],e},editScore(){return!this.ecavpVal}},mounted(){this.initEcavp()},methods:{initEcavp(){this.scoreValCache=this.programInfo["s"+this.ecavp],this.checkValCache=1==this.programInfo["cs"+this.ecavp],this.ecavpVal=this.checkValCache,this.score=this.scoreValCache,this.originalScore=this.score,this.originalVal=this.ecavpVal,this.canSubmit=!0},cmpScoreVal(){return(this.score?""==this.score?0:this.score:0)!=(this.originalScore?""==this.originalScore?0:this.originalScore:0)},saveScore(){if(!this.canSubmit)return;if(this.checkValCache===this.ecavpVal&&(!this.ecavpVal&&this.score==this.scoreValCache||this.ecavpVal&&parseFloat(this.score)===this.scoreValCache))return;if(this.ecavpVal&&""===this.score)return;let e=this.programInfo.autoId,t=this.score,a="1",r=this.ecavp,l=this;this.ecavpVal||(a="0",t=""),this.timer&&(clearTimeout(this.timer),this.timer=null),this.timer=setTimeout(function(){l=this,$.ajax({url:"dgCenter/DgMain.updateAuditAPECAVP.json",dataType:"json",data:{param1:e,param2:r,param3:t,param4:a},bdolxLoader:!1}).done(function(e){e.success?(l.scoreValCache=t,l.checkValCache=a,OneUI.notifySuccess("保存成功！")):(OneUI.notifyError(e.resultInfo.statusText),l.ecavpVal=l.checkValCache,l.score=l.scoreValCache)}),clearTimeout(this.timer),this.timer=null}.bind(this),1e3)}},template:'<div>\t<label :class="labelClass" >\t\t<input type="checkbox" v-model="ecavpVal" readonly="readonly" disabled="disabled">\t\t<span></span>\t</label></div>'},"edit-man-edit":s},data:()=>({rowData:[],updateRowMark:[],random:0,editMans:[]}),mounted(){this.random=(new Date).getTime()+parseInt(1e3*Math.random())},methods:{getUpateData(){let e=this,t=[];return $.each(this.updateRowMark,(a,r)=>{r>0&&t.push(e.rowData[a])}),t},reset(){let e=this;$.each(this.$children,(e,t)=>{t.originalVal=1==t.programInfo["cs"+t.ecavp],t.originalScore=t.programInfo["s"+t.ecavp]}),$.each(this.updateRowMark,(t,a)=>{e.updateRowMark[t]=0})}}};var i=Vue.extend(l);a=((e,t)=>{return'<score-edit v-if="rowData['+t+']" :ecavp="\''+e+'\'" :program-info="rowData['+t+']" :rownum="'+t+'"></score-edit>'});let d={props:{labelName:String,groupReadonly:Boolean,ecsVal:String,esVal:String,prefixed:String},data:()=>({ecavpcomp_cs:"",ecavpcomp_s:0,esValRequired:!1,esValMin:0,esValCache:{}}),computed:{checkboxGroupClass(){return 1==this.groupReadonly?"css-input css-input-disabled css-checkbox css-checkbox-primary control-label":"css-input css-checkbox css-checkbox-primary control-label"},esValDisabled(){return"1"!=this.ecsVal&&!0!==this.ecsVal},elName(){return this.prefixed+"s"+this.labelName}},watch:{esVal(e){if(1==this.esValCache[e])return void(this.$parent.jsonData[this.prefixed+"s"+this.labelName]=e);let t=e;(t=String(t).replace(/[^\d.]/g,"").replace(/\.{2,}/g,".").replace(".","$#$").replace(/\./g,"").replace("$#$",".").replace(/^(\-)*(\d+)\.(\d\d).*$/,"$1$2.$3")).indexOf(".")<0&&""!=t&&(t=parseFloat(t)),parseFloat(t)>3&&(t=3),this.esVal=t,this.$parent.jsonData[this.prefixed+"s"+this.labelName]=this.esVal,this.esValCache[this.esVal]||(this.esValCache[this.esVal]=1)},ecsVal(e,t){!0===e?(this.esVal&&""!=this.esVal||(this.esVal=0),this.esValMin=.01):(this.esVal="",this.esValMin=0),this.esValRequired=e,this.$parent.jsonData[this.prefixed+"cs"+this.labelName]=e}},template:'\n\t\t\t\t\t\x3c!--<div class="row" style="padding: 10px 0;">--\x3e\n\t\t\t\t\t\t<div class="col-md-2">\n\t\t\t\t\t\t\t<label  :class="checkboxGroupClass">\n\t\t\t\t\t\t\t\t<input type="checkbox"  v-model="ecsVal" value="1">\n\t\t\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t\t\t{{labelName}}\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\x3c!--<label class="col-md-2 control-label" for="ecavpcomp_cs">分数</label>\n\t\t\t\t\t\t<div class="col-md-6">\n\t\t\t\t\t\t\t<input :name="elName" class="form-control" type="number" v-model="esVal" :required="esValRequired" :min="esValMin" :disabled="esValDisabled">\n\t\t\t\t\t\t</div>--\x3e\n\t\t\t\t\t\x3c!--</div>--\x3e\n\t\t'};if(Vue.component("ecavp-comp",d),e.template=n,$(e.region).empty(),o.extraOptions){$(e.region).html(n);var c=0,u=new Page({random:(new Date).getTime()+parseInt(1e3*Math.random()),ecavpEditVm:null,container:e.region,events:(()=>{let e={"#newAuditprogramBtn":"click,onNewAuditprogramClick","#addOtherProgramBtn":"click,onAddOtherProgramClick","#selectOkBtn":"click,onSelectOkClick","#searchBtn":"click,onSearchClick","#filterEditor3":"change,onFilterChange","#submitTableVal":"click,onSubmitTableValClick","#searchResetBtn":"click,onSearchResetClick","#newAuditprogramAllBtn":"click,onNewAuditprogramAllClick"};return"SUBJECT"==o.type?e:{}})(),_template:e.template||tplLoader("dgCenter/html/dg/auditProgram.html"),_data:e.data,selectEditors:null,queryGroupMembers(){$.ajax({type:"post",url:"dgCenter/DgProject.getProjectMember.json",data:{param1:window.CUR_PROJECTID,param2:window.CUR_CUSTOMERID},dataType:"json",success(e){if(e.success){var t="";u.selectEditors=e.data.map(e=>({id:e.id,text:e.name,value:e.name})),t='<option value="" selected="selected"></option>',$.each(e.data,function(e,a){t+='<option value="'+a.id+'" style="color: #000">'+a.name+"</option>"}),$("#filterEditor3").html(t)}}})},getConfirmStatusOptions(){var e="";for(var t in DicJsonlData.responseJSON.审计程序认定)e+='<option value="'+t+'">'+DicJsonlData.responseJSON.审计程序认定[t]+"</option>";return e},getUserablePlateOptions(){var e="";for(let t in DicJsonlData.responseJSON.适用板块)e+='<option value="'+t+'">'+DicJsonlData.responseJSON.适用板块[t]+"</option>";return e},init(e){var t=this;this.tbRowData=o.tbRowData,$("#editProgranPageTbSubjectInfo").text("【"+this.tbRowData.tbSubject+"】【"+this.tbRowData.userSubject+"】"),"SUBJECT"==o.type?($("#newAuditprogramBtn").show(),$("#addOtherProgramBtn").show()):($("#newAuditprogramBtn").hide(),$("#addOtherProgramBtn").hide()),BdoDataTable("editProgramTable",this.editProgramTableCfg),BdoDataTable("unexecuteprogamTable",this.unexecuteprogamTableCfg),$("#editProgramTable").on("xhr.dt",()=>{t.getECAVPSummery(o,t.getECAVPCallback.bind(t)),t.getProgramCount(o,t.getProgramCountCallback.bind(t))}),this.bindTableOptEvents(),this.unexecuteFormSider=side({el:"#unexecuteFormSider"}),this.cusAuditprogramFormSider=side({el:"#cusAuditprogramFormSider",autoHide:!1}),this.selectProgramSider=side({el:"#selectProgramSider",autoHide:!1}),this.unexecuteForm=createForm(this.unexecuteFormCfg),this.cusAuditprogramForm=createForm(this.cusAuditprogramFormCfg),this.editAuditprogramFormSider=side({el:"#editAuditprogramFormSider"}),this.editAuditprogramForm=createForm(this.editAuditprogramFormCfg),this.searchForm=createForm(this.searchFormCfg),OneUI.initHelper("slimscroll"),this.searchForm.jsonData.s_departmentId=window.departNmSession,$(".js-select2").select2(),$(".select2").addClass("form-control"),$(".select2-selection").addClass("form-control"),$(".select2-selection").attr("style","border-bottom: 0px"),$("#s_userablePlate").on("select2:select",function(e){if("全部"==e.params.data.text)$("#s_userablePlate").val("全部").trigger("change");else{let t=$("#s_userablePlate").val();for(let a=0,r=t.length;a<r;a++)"全部"==t[a]&&$("#s_userablePlate").val(e.params.data.id).trigger("change")}}),$("#s_confirmStatus").append(this.getConfirmStatusOptions()),$("#s_userablePlate").append(this.getUserablePlateOptions()),this.queryGroupMembers(),$('input[type="radio"][name="s_radio"]').off("click"),$('input[type="radio"][name="s_radio"]').on("click",function(){0==$('input[name="s_radio"]:checked').val()?($("#s_departmentId").attr("disabled",!0),$("#caret_s_departmentId").attr("disabled",!0)):1==$('input[name="s_radio"]:checked').val()?($("#s_departmentId").attr("disabled",!0),$("#caret_s_departmentId").attr("disabled",!0)):2==$('input[name="s_radio"]:checked').val()&&($("#s_departmentId").attr("disabled",!1),$("#caret_s_departmentId").attr("disabled",!1))})},getECAVPCallback(e){let t={pplansE:0,pplansC:0,pplansA:0,pplansV:0,pplansP:0,splansE:0,splansC:0,splansA:0,splansV:0,splansP:0};e.data&&$.each(e.data,(e,a)=>{"PROGRAMP"==a.type&&(t.pplansE+=a.plansE,t.pplansC+=a.plansC,t.pplansA+=a.plansA,t.pplansV+=a.plansV,t.pplansP+=a.plansP),"SUBJECTP"==a.type&&(t.splansE+=a.plansE,t.splansC+=a.plansC,t.splansA+=a.plansA,t.splansV+=a.plansV,t.splansP+=a.plansP)}),this.setSummery(t)},bindTableOptEvents(){let e=this;$("#editProgramTable").unbind("initEditVm"),$("#editProgramTable").bind("initEditVm",((t,a)=>{t.preventDefault(),e.ecavpEditVm=new i,e.ecavpEditVm.editMans=u.selectEditors,e.ecavpEditVm.rowData=a,e.ecavpEditVm.updateRowMark=(()=>{let e=[];for(let t=0,r=a.length;t<r;t++)e.push(0);return e})(),e.ecavpEditVm.$mount("#editProgramTable tbody"),e.ecavpEditVm.reset()}).bind(e)),$("#unexecuteprogamTable").on("click",'button.table-btn-operate[name="execute"]',this.onEcuteProgam),this.initDropMenu()},initDropMenu(){var e=this;bdoDropMenu.bind(e)({el:'#editProgramTable button.table-btn-operate[name="operate"]',scope:e,beforeShow(e,t){var a=$("#editProgramTable").dataTable().fnGetData(e.attr("data-row"));0==a.level?(t.find("#audit").closest("li").hide(),t.find("#createDg").closest("li").hide(),t.find("#uploadDg").closest("li").hide(),t.find("#dgAttachBtn").closest("li").hide(),t.find("#downloadDg").closest("li").hide(),t.find("#delProgram").closest("li").hide(),t.find("#unExecute").closest("li").show(),t.find("#addProgram").closest("li").show(),t.find("#deleteProgram").closest("li").show()):1==a.level&&(t.find("#audit").closest("li").show(),t.find("#createDg").closest("li").show(),t.find("#uploadDg").closest("li").show(),t.find("#dgAttachBtn").closest("li").show(),t.find("#downloadDg").closest("li").show(),t.find("#delProgram").closest("li").show(),t.find("#unExecute").closest("li").hide(),t.find("#addProgram").closest("li").hide(),t.find("#deleteProgram").closest("li").hide())},buttons:[{id:"deleteProgram",text:"删除",icon:"fa fa-times",handler(e,t){var a=$("#editProgramTable").dataTable().fnGetData(e.attr("data-row"));let r=a.indexId;r=r.substr(5,4),bdoConfirmBox("提示","确定删除该审计程序吗？",e=>{$.ajax({type:"post",url:"dgCenter/DgMain.deleteAuditProgram.json",data:{param1:a.autoId,param2:a.customerId,param3:a.projectId,param4:a.subjectId,param5:departIdSession,param6:r,param7:a.updateFlag,param8:a.dgName},dataType:"json",success(e){e.success?(bdoSuccessBox("成功",e.resultInfo.statusText),$("#editProgramTable").DataTable().ajax.reload()):bdoErrorBox("失败",e.resultInfo.statusText)}})})}},{id:"unExecute",text:"不执行",icon:"fa fa-minus-circle",handler(t,a){u.unexecuteFormSider.show();var r=$("#editProgramTable").dataTable().fnGetData(t.attr("data-row"));e.unexecuteForm.jsonData.autoId=r.autoId,e.unexecuteForm.jsonData.customerId=r.customerId,e.unexecuteForm.jsonData.reason="",e.unexecuteForm.rownum=t.attr("data-row")}},{id:"edit",text:"编辑",icon:"fa fa-edit",handler(t,a){var r=$("#editProgramTable").dataTable().fnGetData(t.attr("data-row"));1!=r.level&&("1"!=r.customizeFlag?(e.editAuditprogramForm.jsonData={autoId:r.autoId,customerId:r.customerId,eindexId:r.indexId,edgName:r.dgName,eprogramName:r.programNameAft,econfirmStatus:r.confirmStatusAft,programNameAft:r.programNameAft,confirmStatusAft:r.confirmStatusAft,ecsE:e.booleanTranslate(r.csE),ecsC:e.booleanTranslate(r.csC),ecsA:e.booleanTranslate(r.csA),ecsV:e.booleanTranslate(r.csV),ecsP:e.booleanTranslate(r.csP),esE:r.sE,esC:r.sC,esA:r.sA,esV:r.sV,esP:r.sP},e.editAuditprogramFormSider.show()):(e.cusAuditprogramForm.jsonData={autoId:r.autoId,dgName:r.dgName,indexId:r.indexId,required:r.required,confirmStatusAft:r.confirmStatusAft,programNameAft:r.programNameAft,delTemplates:[],draftTemplate:[],draftTemplateName:[],customerId:o.extraOptions.customerId,projectId:o.extraOptions.projectId,subjecttreeId:o.extraOptions.autoId,level:r.level,csE:e.booleanTranslate(r.csE),csC:e.booleanTranslate(r.csC),csA:e.booleanTranslate(r.csA),csV:e.booleanTranslate(r.csV),csP:e.booleanTranslate(r.csP),sE:r.sE,sC:r.sC,sA:r.sA,sV:r.sV,sP:r.sP},e.cusAuditprogramForm.process="edit",e.cusAuditprogramFormSider.show()))}},{id:"downloadDgTpl",text:"下载底稿模板",icon:"fa fa-download",handler(e,t){var a=$("#editProgramTable").dataTable().fnGetData(e.attr("data-row"));downloadFile("dgCenter/DgDownload.downloadTemplate.json",{param1:(()=>0==a.level?a.autoId:a.parentId)(),param2:o.extraOptions.customerId})}},{id:"openPostilBtn",text:"批注",icon:"fa fa-download",handler(e,t){let a=$("#editProgramTable").dataTable().fnGetData(e.attr("data-row"));DgPostilPage({region:"#sideRegin",data:a,type:a.indexId,foreignId:a.subjecttreeId,isSingle:!1,customerId:a.customerId,projectId:a.projectId})}}]})},onNewAuditprogramClick(e){$("#cusAuditprogramFormSider .bdo-side-block h3.block-title").empty().text("新增自定义程序"),u.cusAuditprogramForm.jsonData={programNameAft:"",indexId:"",dgName:"",confirmStatusAft:"",draftTemplateName:[],draftTemplate:[],delTemplates:[],required:"0",level:0,customerId:o.extraOptions.customerId,projectId:o.extraOptions.projectId,subjecttreeId:o.extraOptions.autoId,autoId:null,csE:!1,csC:!1,csA:!1,csV:!1,csP:!1,sE:"",sC:"",sA:"",sV:"",sP:""},u.cusAuditprogramForm.process="add",u.cusAuditprogramFormSider.show()},onNewAuditprogramAllClick(e){bdoConfirmBox("提示",'确认批量不执行审计程序吗<div><label style="width: 80%;text-align: left;">请输入不执行理由</label><div><textarea id="auditprogramReason" style="width: 80%;min-height: 80px;"></textarea></div></div>',function(){let e,t=$("#auditprogramReason").val();"SUBJECT"==o.type&&(e=o.extraOptions.autoId),bdoInProcessingBox("请稍后!");let a=$("#editProgramPageTabLink").data("rowData");$.ajax({type:"POST",url:"dgCenter/DgMain.setUnexecuteProgramAll.json",data:{param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:e,param4:t,param5:a.autoId},dataType:"json",success(e){e.success?(bdoSuccessBox("成功",e.resultInfo.statusText),$("#editProgramTable").DataTable().ajax.reload(),$("#unexecuteprogamTable").DataTable().ajax.reload()):bdoErrorBox("失败",e.resultInfo.statusText)}})})},onAddOtherProgramClick(e){u.searchForm.jsonData={s_radio:"2",s_departmentId:"",s_programName:"",s_subjectName:$.sessionStorage("baseSubjectName"),s_confirmStatus:"",s_userablePlate:"",s_stage:"",s_industry:"",s_dgName:"",s_indexId:"",s_csE:"",s_csC:"",s_csA:"",s_csV:"",s_csP:""},u.selectProgramSider.show(),u.selectProgramTableCfg.localParam.urlparam=u.getDefaultFilter(),u.selectProgramTableCfg.localParam.urlparam.param10=BdoFaithConsts.DEPARTMENT_BDO,u.selectProgramTableCfg.localParam.urlparam.param15=$.sessionStorage("userSubjectId"),$("#s_subjectName").attr("disabled","disabled"),BdoDataTable("selectProgramTable",u.selectProgramTableCfg)},onSelectOkClick(e){var t=$('input[name="apCheckbox"]:checked'),a=[];$.each(t,(e,t)=>{a.push(t.value)}),a.length<1?bdoErrorBox("","未选择数据！"):$.ajax({type:"post",url:"dgCenter/DgMain.addOtherProgram.json",data:{param1:a.join(","),param2:o.extraOptions.autoId,param3:o.extraOptions.customerId,param4:$.sessionStorage("subjectEditors")},dataType:"json",success(e){e.success?(bdoSuccessBox("成功",e.resultInfo.statusText),u.selectProgramSider.hide(),$("#editProgramTable").DataTable().ajax.reload()):bdoErrorBox("失败",e.resultInfo.statusText)}})},onSearchClick(e){let t=!0,a=this.searchForm.jsonData;null==$("#s_confirmStatus").val()?a.s_confirmStatus="":a.s_confirmStatus=$("#s_confirmStatus").val(),0==$('input[name="s_radio"]:checked').val()?(a.s_departmentId=BdoFaithConsts.DEPARTMENT_BDO,u.selectProgramTableCfg.localParam.urlparam.param10=""):1==$('input[name="s_radio"]:checked').val()?(a.s_departmentId=window.departIdSession,u.selectProgramTableCfg.localParam.urlparam.param10=""):2==$('input[name="s_radio"]:checked').val()&&(u.selectProgramTableCfg.localParam.urlparam.param10="",""!=a.s_departmentId&&""!=$("#s_departmentId").val()||(u.selectProgramTableCfg.localParam.urlparam.param10=BdoFaithConsts.DEPARTMENT_BDO,t=!1));let r=[];if($.each(a,(e,a)=>{var l=e.replace("s_",""),s={field:l,sqlIndex:"a."+l,type:"string",value:a,operate:"like"};switch("s_industry"==e&&(s.value=$("#s_industry").val()),l){case"departmentId":t&&(s.value==BdoFaithConsts.DEPARTMENT_BDO?s.operate="eq":s.operate="IN",s.type="number");break;case"csE":case"csC":case"csA":case"csV":case"csP":s.operate="eq";break;default:s.operate="like"}r.push(s)}),""!=r[4].value&&null!=r[4].value){for(var l=0;l<r[4].value.length;l++)"E"==r[4].value[l]&&(r[9].value=1),"C"==r[4].value[l]&&(r[10].value=1),"A"==r[4].value[l]&&(r[11].value=1),"V"==r[4].value[l]&&(r[12].value=1),"P"==r[4].value[l]&&(r[13].value=1);r[4].value=""}if(a.s_departmentId&&""!=a.s_departmentId&&a.s_departmentId!=BdoFaithConsts.DEPARTMENT_BDO?(r=r.slice(2),u.selectProgramTableCfg.localParam.urlparam.param11=a.s_departmentId):(r=a.s_departmentId==BdoFaithConsts.DEPARTMENT_BDO?r.slice(1):r.slice(2),u.selectProgramTableCfg.localParam.urlparam.param11=null),$("#s_userablePlate").val()){let e=$("#s_userablePlate").val().join(",");u.selectProgramTableCfg.localParam.urlparam.param16=$("#s_userablePlate").val().join(",");for(let t=0,a=e.length;t<a;t++)"全部"==e[t]&&(u.selectProgramTableCfg.localParam.urlparam.param16="all")}else u.selectProgramTableCfg.localParam.urlparam.param16="";let s=JSON.stringify(r);u.selectProgramTableCfg.localParam.urlparam.filter=s,$("#selectProgramTable").DataTable().ajax.reload()},onSearchResetClick(e){u.searchForm.jsonData={s_departmentId:BdoFaithConsts.DEPARTMENT_BDO,s_programName:"",s_subjectName:"",s_confirmStatus:"",s_stage:"",s_industry:"",s_dgName:"",s_indexId:""},$("#choice").addClass("checked","checked"),u.selectProgramTableCfg.localParam.urlparam=u.getDefaultFilter();var t='[{"field":"departmentId","sqlIndex":"a.departmentId","type":"number","value":"'+BdoFaithConsts.DEPARTMENT_BDO+'","operate":"eq"}]';u.selectProgramTableCfg.localParam.urlparam.filter=t,$("#selectProgramTable").DataTable().ajax.reload()},onFilterChange(e){var t=$("#filterEditor3 option:selected").val();u.editProgramTableCfg.localParam.urlparam.param8=t,$("#editProgramTable").DataTable().ajax.reload()},onSubmitTableValClick(){let e=u.ecavpEditVm.getUpateData();if(e.length>0){let t=e.map(e=>({autoId:e.autoId,projectId:e.projectId,customerId:e.customerId,sE:e.sE,sC:e.sC,sA:e.sA,sV:e.sV,sP:e.sP,csE:e.csE,csC:e.csC,csA:e.csA,csV:e.csV,csP:e.csP}));$.ajax({type:"post",url:"dgCenter/DgMain.saveECAVP.json",data:{param1:JSON.stringify(t),param2:window.CUR_CUSTOMERID,param3:window.CUR_PROJECTID,param4:window.CUR_PROJECT_ACC_YEAR},dataType:"json",success(e){e.success?($("#editProgramTable").DataTable().ajax.reload(),bdoSuccessBox("成功",e.resultInfo.statusText)):bdoErrorBox("失败",e.resultInfo.statusText)}})}else bdoErrorBox("","未修改数据！")},getECAVPSummery(e,t){let a={menuId:window.sys_menuId,sqlId:"DG00028",start:-1,limit:-1};if(a.param1=e.extraOptions.autoId,a.param2=e.extraOptions.nodeType,a.param3=e.extraOptions.customerId,a.param4=e.extraOptions.projectId,a.param8=window.CUR_PROJECT_ACC_YEAR,"TBSUBJECT"!=e.extraOptions.nodeType&&"SUBJECT"!=e.extraOptions.nodeType||(a.param9=e.extraOptions.tbSubjectCode),"SUBJECT"==e.extraOptions.nodeType){a.param6=e.extraOptions.userSubjectId,a.param7=e.extraOptions.userSubjectName,$.sessionStorage("userSubjectName",e.extraOptions.userSubjectName),$.sessionStorage("userSubjectId",e.extraOptions.userSubjectId);var r=e.tbRowData.baseSubject.indexOf("-"),l=e.tbRowData.baseSubject.substring(r+1);$.sessionStorage("baseSubjectName",l)}$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",data:a,dataType:"json",success(e){t&&t(e)}})},getProgramCountCallback(e){let t=e.data[0];$.each(t,(e,t)=>$("#"+e).text((e=>e||0)(t)))},getProgramCount(e,t){let a={menuId:window.sys_menuId,sqlId:"DG00065",param1:e.extraOptions.customerId,param2:e.extraOptions.projectId,param3:"1",param8:$("#filterEditor3 option:selected").val(),page:0,start:-1,limit:-1};"SUBJECT"==e.extraOptions.nodeType&&(a.param4=e.extraOptions.autoId),"TBSUBJECT"==e.extraOptions.nodeType&&(a.param5=e.extraOptions.autoId),"PROJECT"==e.extraOptions.nodeType&&(a.param6=e.extraOptions.userSubjectName),$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",data:a,dataType:"json",success(e){t&&t(e)}})},editProgramTable:null,bgColerMap:{},editProgramTableCfg:{localParam:{url:"dgCenter/DgGeneral.query.json",urlparam:(()=>{let e={menuId:window.sys_menuId,sqlId:"DG00005",param3:"1",param4:o.extraOptions.projectId,param5:0,param6:o.extraOptions.customerId};return"SUBJECT"==o.type&&(e.param1=o.extraOptions.autoId),"TBSUBJECT"==o.type&&(e.param2=o.extraOptions.autoId),"PROJECT"==o.type&&(e.param4=o.extraOptions.projectId),e})(),tabNum:!0},tableParam:{scrollX:!0,scrollY:"500px",fixedThead:!0,select:!0,ordering:!1,pageLength:10,serverSide:!0,autoWidth:!1,select:!1,preDrawCallback(e){u&&u.ecavpEditVm&&u.ecavpEditVm.$destroy()},drawCallback(e){let t=this;t.drawDtTimer&&clearTimeout(t.drawDtTimer),this.drawDtTimer=setTimeout(function(){$("#editProgramTable tbody").replaceWith(e.nTBody);let a=t.fnGetData();$("#editProgramTable").trigger("initEditVm",[a]),clearTimeout(t.drawDtTimer),t.drawDtTimer=!1},1e3)},createdRow(e,t,a){var r="";1==e&&(u.bgColerMap={}),t.level<1?(u.bgColerMap[t.autoId]={level:t.level,departmentId:t.departmentId,customizeFlag:t.customizeFlag},r="1"==t.customizeFlag?"bg-warning":t.departmentId==BdoFaithConsts.DEPARTMENT_BDO?"bg-info":"bg-success"):r="bg-standard",$(e).find("td:eq(2)").addClass(r),$(e).find("td:eq(3)").addClass(r),$(e).attr("v-if","rowData["+a+"]")},fixedThead:!0,fixedHeight:"500px",columnDefs:[{targets:(()=>(c=0,++c))(),orderable:!1,className:"text-center",title:"处理",data:null,width:"50px",render(e,t,a,r){var l="";return l+='<div class="">',l+='<button class="btn btn-xs btn-info table-btn-operate bdo-drop-btn" type="button" name="operate" data-placement="top" title="更多操作" data-toggle="tooltip" data-row="'+r.row+'">\t<i class="fa fa-gear"></i>\t</button>',l+="</div>"}},{targets:++c,orderable:!1,title:"索引号",name:"indexId",data:"indexId",width:"50px",className:"dg-ap"},{targets:++c,orderable:!1,title:"程序名称",name:"dgName",data:"dgName",width:"150px",className:"dg-ap"},{targets:++c,orderable:!1,title:"程序内容",name:"programNameAft",data:"programNameAft",width:"300px",className:"dg-ap",render(e,t,a,r){var l="";return"1"==a.updateFlag&&e!=a.programNamePre&&(l="red"),'<pre class="dg" style="color: '+l+';height: 100%">'+e+"</pre>"}},{targets:++c,orderable:!1,title:"E",name:"E",data:"csE",width:"30px",className:"text-center",render:(e,t,r,l)=>a("E",l.row)},{targets:++c,orderable:!1,title:"C",name:"C",data:"csC",width:"30px",className:"text-center",render:(e,t,r,l)=>a("C",l.row)},{targets:++c,orderable:!1,title:"A",name:"A",data:"csA",width:"30px",className:"text-center",render:(e,t,r,l)=>a("A",l.row)},{targets:++c,orderable:!1,title:"V",name:"V",data:"csV",width:"30px",className:"text-center",render:(e,t,r,l)=>a("V",l.row)},{targets:++c,orderable:!1,title:"P",name:"P",data:"csP",width:"30px",className:"text-center",render:(e,t,r,l)=>a("P",l.row)},{targets:++c,orderable:!1,title:"部门",name:"__ddepartmentIdName",data:"__ddepartmentIdName",width:"200px",className:"dg-ap"},{targets:++c,orderable:!1,className:"text-center",title:"底稿编制人",name:"__uworkpaperEditor",data:"__uworkpaperEditor",width:"90px",className:"dg-ap",render(e,t,a,r){let l;return $.isPlainObject(a.__uworkpaperEditor)&&(l=a.__uworkpaperEditor.userId),function(e,t){return'<edit-man-edit :datas="editMans" :program-info="rowData['+t+']" :rownum="'+t+'" :current-value="\''+e+"'\"></edit-man-edit>"}(l,r.row)}}]}},unexecuteprogamTable:null,onEcuteProgam(e){var t=$("#unexecuteprogamTable").dataTable().fnGetData($(e.currentTarget).attr("data-row"));bdoConfirmBox("提示","确定重新执行该程序吗？",()=>{$.ajax({type:"post",url:"dgCenter/DgMain.setExcuteProgram.json",data:{param1:t.autoId,param2:t.customerId},dataType:"json",success(e){e.success?(bdoSuccessBox("成功",e.resultInfo.statusText),$("#editProgramTable").DataTable().ajax.reload(),$("#unexecuteprogamTable").DataTable().ajax.reload()):bdoErrorBox("失败",e.resultInfo.statusText)}})})},unexecuteprogamTableCfg:{localParam:{url:"dgCenter/DgGeneral.query.json",urlparam:(()=>{let e={menuId:window.sys_menuId,sqlId:"DG00005",param3:"0",param5:0,param6:o.extraOptions.customerId};return"SUBJECT"==o.type&&(e.param1=o.extraOptions.autoId),"TBSUBJECT"==o.type&&(e.param2=o.extraOptions.autoId),"PROJECT"==o.type&&(e.param4=o.extraOptions.projectId),e})(),tabNum:!0},tableParam:{scrollX:!0,scrollY:"500px",fixedThead:!0,select:!0,ordering:!1,serverSide:!0,pageLength:10,displayIcon:!1,fixedThead:!0,fixedHeight:"500px",columnDefs:[{targets:(()=>(c=0,++c))(),orderable:!1,className:"text-center",title:"处理",data:null,width:"30px",render(e,t,a,r){var l="";return l+='<div class="">',l+='<button class="btn btn-xs btn-info table-btn-operate bdo-drop-btn" type="button" name="execute" data-placement="top" title="执行" data-toggle="tooltip" data-row="'+r.row+'">\t<i class="fa fa-external-link"></i>\t</button>',l+="</div>"}},{targets:++c,orderable:!1,title:"索引号",name:"indexId",data:"indexId",width:"50px",className:"dg-ap"},{targets:++c,orderable:!1,title:"程序名称",name:"dgName",data:"dgName",width:"150px",className:"dg-ap"},{targets:++c,orderable:!1,title:"程序内容",name:"programNameAft",data:"programNameAft",width:"300px",className:"dg-ap",render:(e,t,a,r)=>'<pre class="dg" style="height:100%">'+e+"</pre>"},{targets:++c,orderable:!1,title:"不执行理由",name:"reason",data:"reason",width:"300px",className:"dg-ap"},{targets:++c,orderable:!1,title:"E",name:"E",data:"csE",width:"30px",className:"text-center",render:(e,a,r,l)=>t(e,r.sE,r.csEOriginal,r.sEOriginal,r.updateFlag)},{targets:++c,orderable:!1,title:"C",name:"C",data:"csC",width:"30px",className:"text-center",render:(e,a,r,l)=>t(e,r.sC,r.csCOriginal,r.sCOriginal,r.updateFlag)},{targets:++c,orderable:!1,title:"A",name:"A",data:"csA",width:"30px",className:"text-center",render:(e,a,r,l)=>t(e,r.sA,r.csAOriginal,r.sAOriginal,r.updateFlag)},{targets:++c,orderable:!1,title:"V",name:"V",data:"csV",width:"30px",className:"text-center",render:(e,a,r,l)=>t(e,r.sV,r.csVOriginal,r.sVOriginal,r.updateFlag)},{targets:++c,orderable:!1,title:"P",name:"P",data:"csP",width:"30px",className:"text-center",render:(e,a,r,l)=>t(e,r.sP,r.csPOriginal,r.sPOriginal,r.updateFlag)},{targets:++c,orderable:!1,title:"部门",name:"__ddepartmentIdName",data:"__ddepartmentIdName",width:"200px",className:"dg-ap"},{targets:++c,orderable:!1,className:"text-center",title:"创建人",name:"__ucreateUserName",data:"__ucreateUserName",width:"90px",className:"dg-ap"},{targets:++c,orderable:!1,className:"text-center",title:"复核人",name:"recheckUser",data:"recheckUser",width:"90px",className:"dg-ap"}]}},unexecuteFormSider:null,auditFormSider:null,unexecuteFormCfg:{options:{propsData:{jsonData:{autoId:null,customerId:null,reason:""}}},props:{jsonData:Object},display:"tableform-one",column:1,id:"unexecuteForm",data:()=>({ajaxConfig:{type:"POST",url:"dgCenter/DgMain.setUnexecuteProgram.json",dataType:"json",success(e){e.success?(bdoSuccessBox("成功",e.resultInfo.statusText),u.unexecuteFormSider.hide(),$("#editProgramTable").DataTable().ajax.reload(),$("#unexecuteprogamTable").DataTable().ajax.reload()):bdoErrorBox("失败",e.resultInfo.statusText)}},rownum:-1}),methods:{onSetUnexecuteProgramClick(e){this.submit(!0)},onCancelClick(){u.unexecuteFormSider.hide()}},buttons:[{id:"setUnexecuteProgramBtn",icon:"fa-floppy-o",style:"btn-primary",text:"提交",typeAttr:{"v-on:click":"onSetUnexecuteProgramClick"}},{id:"cancelSetUnexecuteProgramBtn",icon:"fa-arrow-left",style:"btn-warning",text:"取消",typeAttr:{"v-on:click":"onCancelClick"}}],items:[{id:"reason",type:"textarea",label:"不执行理由",rowspan:1,colspan:1,validate:{rules:{required:!0}},typeAttr:{rows:5},show:!0}]},unexecuteForm:null,tplEditComp:{el:"#draftTemplateName",template:'<ul class="list-group" style="padding: 10px 5px;">\t\t\t<li class="list-group-item"\t\t\t\tv-for="(file, index) in fileList"\t\t\t\t:fileId="file.autoId"\t\t\t>\t\t\t\t<span class="icon fa fa-file-excel-o text-primary-light"></span>\t\t\t\t{{file.fileName}}\t\t\t\t<span class="fa fa-close text-danger pull-right" @click="onDelTplFileClick" :data-index="index" v-show="delBtnShow"></span>\t\t\t</li>\t\t</ul>',data:()=>({fileList:[],delBtnShow:!1}),methods:{onDelTplFileClick(e){var t=this,a=$(e.currentTarget).attr("data-index");bdoConfirmBox("提示","确定删除该模板文件吗？",e=>{u.cusAuditprogramForm.jsonData.delTemplates.push(t.fileList[a].autoId),t.fileList.splice(a,1),t.fileList&&t.fileList.length<1?(u.cusAuditprogramForm.formItem.draftTemplateName.show=!1,u.cusAuditprogramForm.formItem.draftTemplate.show=!0):(u.cusAuditprogramForm.formItem.draftTemplateName.show=!0,u.cusAuditprogramForm.formItem.draftTemplate.show=!1)})}}},cusAuditprogramFormSider:null,cusAuditprogramFormCfg:{options:{propsData:{jsonData:{programNameAft:"",indexId:"",dgName:"",confirmStatusAft:"",confirmStatusAftName:"",draftTemplateName:[],draftTemplate:[],delTemplates:[],required:"",customerId:o.extraOptions.customerId,projectId:o.extraOptions.projectId,subjecttreeId:o.extraOptions.autoId,subjectEditorId:null,autoId:null,level:0,csE:!1,csC:!1,csA:!1,csV:!1,csP:!1,sE:"",sC:"",sA:"",sV:"",sP:"",workpaperEditor:""}}},props:{jsonData:Object},display:"tableform-one",column:2,id:"cusAuditprogramForm",data:()=>({ajaxConfig:{type:"POST",url:"dgCenter/DgMain.addCusAuditProgram.json",dataType:"json",success(e){e.success?(u.cusAuditprogramFormSider.hide(),bdoSuccessBox("成功",e.resultInfo.statusText),$("#editProgramTable").DataTable().ajax.reload(),this.process=""):bdoErrorBox("失败",e.resultInfo.statusText)}},process:"add"}),computed:{checkboxGroupClass(){return 1==this.formItem.confirmGrop.readonly?"css-input css-input-disabled css-checkbox css-checkbox-primary control-label":"css-input css-checkbox css-checkbox-primary control-label"},scoreReadonly(){return this.formItem.confirmGrop.readonly},"jsonData.programNamePre"(){return this.jsonData.programNameAft},"jsonData.confirmStatusPre"(){return this.jsonData.confirmStatusAft}},watch:{process(e,t){var a=this;!1===e?(this.setAllReadonly(!0),this.formItem.draftTemplateName.show=!0,this.formItem.draftTemplate.show=!1,this.formItem.confirmGrop.readonly=!0):(this.setAllReadonly(!1),this.formItem.draftTemplateName.show=!1,this.formItem.draftTemplate.show=!0,this.formItem.confirmGrop.readonly=!1),"edit"!=e&&!1!==e||(null==this.tplEditComp&&(this.tplEditComp=new Vue(u.tplEditComp)),this.tplEditComp.delBtnShow="edit"==e,this.jsonData.delTemplates=[],this.$nextTick(()=>{$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",data:{menuId:window.sys_menuId,sqlId:"DG00010",param1:this.jsonData.autoId},dataType:"json",success(e){e.success&&(a.tplEditComp.fileList=e.data)}}),a.tplEditComp.fileList&&a.tplEditComp.fileList.length>0?(this.formItem.draftTemplateName.show=!0,this.formItem.draftTemplate.show=!1):(this.formItem.draftTemplateName.show=!1,this.formItem.draftTemplate.show=!0)}))}},tplEditComp:null,methods:{onSaveAudtiprogramClick(e){if(!this.$form.valid())return;"add"==this.process?this.ajaxConfig.url="dgCenter/DgMain.addCusAuditProgram.json":"edit"==this.process&&(this.ajaxConfig.url="dgCenter/DgMain.updateCusAuditProgram.json");let t={};$.each(this.jsonData,(e,a)=>{t[e]=a,e.startsWith("cs")&&(t[e]=u.booleanTranslate(a,!0))}),t.subjectEditorId=$.sessionStorage("subjectEditors"),t.workpaperEditor=$.sessionStorage("subjectEditors"),this.uploadFile(!0,{jsonData:JSON.stringify(t)})},onCancelClick(e){u.cusAuditprogramFormSider.hide()},openEditPage(){null==this.tplEditComp&&(this.tplEditComp=new Vue(u.tplEditComp)),this.tplEditComp.delBtnShow="edit"==this.process,this.jsonData.delTemplates=[],this.$nextTick(()=>{$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",data:{menuId:window.sys_menuId,sqlId:"DG00010",param1:this.jsonData.autoId},dataType:"json",success(e){e.success&&(pvm.tplEditComp.fileList=e.data)}}),pvm.tplEditComp.fileList&&pvm.tplEditComp.fileList.length>0?(this.formItem.draftTemplateName.show=!0,this.formItem.draftTemplate.show=!1):(this.formItem.draftTemplateName.show=!1,this.formItem.draftTemplate.show=!0)})}},buttons:[{id:"saveCusAudtiprogramBtn",icon:"fa-floppy-o",style:"btn-primary",text:"保存",typeAttr:{"v-on:click":"onSaveAudtiprogramClick","v-show":"process"}},{id:"cancelCusFormBtn",icon:"fa-arrow-left",style:"btn-warning",text:"取消",typeAttr:{"v-on:click":"onCancelClick"}}],items:[{id:"dgName",type:"input",label:"程序名称",rowspan:1,colspan:1,validate:{rules:{required:!0}}},{id:"indexId",type:"input",label:"索引号",colspan:1,typeAttr:{disabled:"disabled",value:"0000-0000"},validate:{rules:{required:!0}},value:"0000-0000"},{id:"confirmGrop",html:'\n\t\t\t\t\t<div class="form-material"><label>认定</label></div>\n\t\t\t\t\t<div class="row">\n\t\t\t\t\t<ecavp-comp :prefixed="\'\'" :label-name="\'E\'" :ecs-val="jsonData.csE" :es-val="jsonData.sE" :group-readonly="formItem.confirmGrop.readonly"></ecavp-comp>\n\t\t\t\t\t<ecavp-comp :prefixed="\'\'" :label-name="\'C\'" :ecs-val="jsonData.csC" :es-val="jsonData.sC" :group-readonly="formItem.confirmGrop.readonly"></ecavp-comp>\n\t\t\t\t\t<ecavp-comp :prefixed="\'\'" :label-name="\'A\'" :ecs-val="jsonData.csA" :es-val="jsonData.sA" :group-readonly="formItem.confirmGrop.readonly"></ecavp-comp>\n\t\t\t\t\t<ecavp-comp :prefixed="\'\'" :label-name="\'V\'" :ecs-val="jsonData.csV" :es-val="jsonData.sV" :group-readonly="formItem.confirmGrop.readonly"></ecavp-comp>\n\t\t\t\t\t<ecavp-comp :prefixed="\'\'" :label-name="\'P\'" :ecs-val="jsonData.csP" :es-val="jsonData.sP" :group-readonly="formItem.confirmGrop.readonly"></ecavp-comp>\n\t\t\t\t\t</div></div>\n\t\t\t\t',rowspan:1,colspan:2,readonly:!1},{id:"programNameAft",type:"textarea",label:"程序内容",rowspan:1,colspan:2,typeAttr:{rows:5},validate:{rules:{required:!0}}},{id:"draftTemplateName",type:"div",label:"已上传底稿模板",rowspan:1,colspan:2,validate:{rules:{}},show:!1},{id:"draftTemplate",type:"file",label:"底稿模板",rowspan:1,colspan:2,validate:{rules:{}},show:!0,plugin:{name:"fileinput",options:{uploadUrl:"dgCenter/DgDownload.uploadTempFile.json",allowedFileExtensions:["xlsx"],maxFilesNum:1,uploadExtraData:()=>({})}}}]},cusAuditprogramForm:null,selectProgramSider:null,selectProgramTable:null,selectProgramTableCfg:{localParam:{url:"dgCenter/DgGeneral.query.json",urlparam:{menuId:window.sys_menuId,sqlId:"DG00003"},tabNum:!0},tableParam:{scrollX:!0,select:!0,ordering:!0,order:[2,"asc"],pageLength:10,serverSide:!0,fixedThead:!0,fixedHeight:"500px",columnDefs:[{targets:(()=>(c=0,++c))(),orderable:!1,className:"text-center",title:"处理",data:null,width:"100px",render(e,t,a,r){var l="";return l+='<label class="css-input css-checkbox css-checkbox-primary">\t<input type="checkbox" id="apCheckbox" name="apCheckbox" value="'+a.autoId+'" data-row="'+r.row+'">\t<span></span></label>'}},{targets:++c,orderable:!0,title:"机构部门",name:"departmentId",data:"departmentId",width:"200px",render:(e,t,a,r)=>void 0==a.__ddepartmentIdName?a.name:a.__ddepartmentIdName},{targets:++c,orderable:!0,title:"索引号",name:"indexId",data:"indexId",width:"150px"},{targets:++c,orderable:!0,title:"程序名称",name:"dgName",data:"dgName",width:"300px"},{targets:++c,orderable:!0,title:"程序内容",name:"programName",data:"programName",width:"300px"},{targets:++c,orderable:!0,title:"标准科目",name:"subject",width:"90px",render:(e,t,a,r)=>a.subjectId+"-"+a.subjectName},{targets:++c,orderable:!0,title:"阶段",name:"stage",data:"stage",width:"90px",render:(e,t,a,r)=>DicVal2Nm(e,"审计程序阶段")},{targets:++c,orderable:!0,title:"潜在风险说明",name:"potentialRisk",data:"potentialRisk",width:"200px"},{targets:++c,title:"E",name:"E",data:"csE",width:"30px",className:"text-center",render:(e,a,r,l)=>t(e,r.sE,r.csEOriginal,r.sEOriginal,r.updateFlag)},{targets:++c,title:"C",name:"C",data:"csC",width:"30px",className:"text-center",render:(e,a,r,l)=>t(e,r.sC,r.csEOriginal,r.sEOriginal,r.updateFlag)},{targets:++c,title:"A",name:"A",data:"csA",width:"30px",className:"text-center",render:(e,a,r,l)=>t(e,r.sA,r.csEOriginal,r.sEOriginal,r.updateFlag)},{targets:++c,title:"V",name:"V",data:"csV",width:"30px",className:"text-center",render:(e,a,r,l)=>t(e,r.sV,r.csEOriginal,r.sEOriginal,r.updateFlag)},{targets:++c,title:"P",name:"P",data:"csP",width:"30px",className:"text-center",render:(e,a,r,l)=>t(e,r.sP,r.csEOriginal,r.sEOriginal,r.updateFlag)},{targets:++c,orderable:!0,title:"行业",name:"industry",data:"industry",width:"150px",render(e,t,a,r){if("1"==a.allIndustryFlag)return e;var l=[],s=e&&e.split(",");return $.each(s,(e,t)=>{$.each(industryData,(e,a)=>{a.value==t&&l.push(a.label)})}),l}},{targets:++c,orderable:!0,title:"具体事项说明",name:"description",data:"description",width:"150px"},{targets:++c,orderable:!0,title:"是否必须",name:"required",data:"required",render:(e,t,a,r)=>DicVal2Nm(e,"boolean"),width:"150px"},{targets:++c,orderable:!0,title:"适用板块",name:"userablePlate",data:"userablePlate",width:"150px"},{targets:++c,orderable:!0,title:"创建人",name:"createUser",data:"createUser",render:(e,t,a,r)=>a.__ucreateUser.userName,width:"150px"}]}},editAuditprogramFormSider:null,editAuditprogramFormCfg:{options:{propsData:{jsonData:{autoId:null,customerId:null,eindexId:"",edgName:"",eprogramName:"",econfirmStatus:"",programNameAft:"",confirmationAft:"",ecsE:!1,ecsC:!1,ecsA:!1,ecsV:!1,ecsP:!1,esE:"",esC:"",esA:"",esV:"",esP:""}}},props:{jsonData:Object},display:"tableform-one",column:2,id:"editAuditprogramForm",data:()=>({ajaxConfig:{type:"POST",url:"dgCenter/DgMain.editProgram.json",dataType:"json",success(e){e.success?(bdoSuccessBox("成功",e.resultInfo.statusText),$("#editProgramTable").DataTable().ajax.reload(),u.editAuditprogramFormSider.hide()):bdoErrorBox("失败",e.resultInfo.statusText)}}}),computed:{checkboxGroupClass(){return 1==this.formItem.econfirmGrop.readonly?"css-input css-input-disabled css-checkbox css-checkbox-primary control-label":"css-input css-checkbox css-checkbox-primary control-label"},scoreReadonly(){return this.formItem.econfirmGrop.readonly}},methods:{onSaveAudtiprogramClick(e){let t={};for(let e in this.jsonData)e.startsWith("e")?t[e.substring(1)]=this.jsonData[e]:t[e]=this.jsonData[e];this.ajaxConfig.url="dgCenter/DgMain.editProgram.json",t.programNameAft=this.jsonData.eprogramName,t.confirmStatusAft=this.jsonData.econfirmStatus,t.confirmStatusAftName=$("#econfirmStatus").val(),t.csE=u.booleanTranslate(this.jsonData.ecsE,!0),t.csC=u.booleanTranslate(this.jsonData.ecsC,!0),t.csA=u.booleanTranslate(this.jsonData.ecsA,!0),t.csV=u.booleanTranslate(this.jsonData.ecsV,!0),t.csP=u.booleanTranslate(this.jsonData.ecsP,!0),this.submit(!0,{jsonData:JSON.stringify(t)})},onCancelClick(e){u.editAuditprogramFormSider.hide()}},buttons:[{id:"saveAudtiprogramBtn",icon:"fa-floppy-o",style:"btn-primary",text:"保存",typeAttr:{"v-on:click":"onSaveAudtiprogramClick"}},{id:"cancelEditProgramtBtn",icon:"fa-arrow-left",style:"btn-warning",text:"取消",typeAttr:{"v-on:click":"onCancelClick"}}],items:[{id:"edgName",type:"input",label:"程序名称",rowspan:1,colspan:1,typeAttr:{}},{id:"eindexId",type:"input",label:"索引号",colspan:1,typeAttr:{readonly:!0}},{id:"eprogramName",type:"textarea",label:"程序内容",rowspan:1,colspan:2,typeAttr:{rows:5},validate:{rules:{required:!0}}},{id:"econfirmGrop",html:'\n\t\t\t\t\t<div class="form-material"><label>认定</label></div>\n\t\t\t\t\t<div class="row">\n\t\t\t\t\t<ecavp-comp :prefixed="\'e\'" :label-name="\'E\'" :ecs-val="jsonData.ecsE" :es-val="jsonData.esE" :group-readonly="formItem.econfirmGrop.readonly"></ecavp-comp>\n\t\t\t\t\t<ecavp-comp :prefixed="\'e\'" :label-name="\'C\'" :ecs-val="jsonData.ecsC" :es-val="jsonData.esC" :group-readonly="formItem.econfirmGrop.readonly"></ecavp-comp>\n\t\t\t\t\t<ecavp-comp :prefixed="\'e\'" :label-name="\'A\'" :ecs-val="jsonData.ecsA" :es-val="jsonData.esA" :group-readonly="formItem.econfirmGrop.readonly"></ecavp-comp>\n\t\t\t\t\t<ecavp-comp :prefixed="\'e\'" :label-name="\'V\'" :ecs-val="jsonData.ecsV" :es-val="jsonData.esV" :group-readonly="formItem.econfirmGrop.readonly"></ecavp-comp>\n\t\t\t\t\t<ecavp-comp :prefixed="\'e\'" :label-name="\'P\'" :ecs-val="jsonData.ecsP" :es-val="jsonData.esP" :group-readonly="formItem.econfirmGrop.readonly"></ecavp-comp>\n\t\t\t\t\t</div></div>\n\t\t\t\t',rowspan:1,colspan:2,readonly:!1}]},editAuditprogramForm:null,searchFormCfg:{options:{propsData:{jsonData:{s_departmentId:"",s_programName:"",s_subjectName:"",s_confirmStatus:"",s_stage:"",s_industry:"",s_dgName:"",s_indexId:"",s_userablePlate:""}}},props:{jsonData:Object},display:"tableform-one",column:4,id:"searchForm",data:()=>({ajaxConfig:{type:"POST",url:"",dataType:"json",success(e){}}}),items:[{html:'<div class="form-material"><label>模式</label><lable class="form-control"><div style="display:inline-block"><label class="css-input css-radio css-radio-warning push-10-r"><input type="radio" id="choice" value="1" name="s_radio"><span></span> 本部门</label></div><div style="display:inline-block"><label class="css-input css-radio css-radio-warning push-10-r"><input type="radio" value="2" name="s_radio" checked><span></span> 其他部门</label></div></lable></div>',colspan:1,rowspan:1,validate:{rules:{required:!1}}},{id:"s_departmentId",type:"treecombo",label:"机构部门",colspan:1,plugin:{name:"treecombo",options:{url:"./base/TreeCommon.findDepartTree.json",params:{},view:{leafIcon:"fa fa-building text-flat",nodeIcon:"fa fa-bank text-primary-light",folderSelectable:!0,multiSelect:!1}}}},{id:"s_dgName",type:"input",label:"程序名称",colspan:1},{id:"s_programName",type:"input",label:"程序内容",colspan:1},{id:"s_subjectName",type:"input",label:"标准科目",rowspan:1,colspan:1},{id:"s_industry",type:"input",label:"行业",colspan:1},{id:"s_indexId",type:"input",label:"索引号",colspan:1},{id:"s_confirmStatus",label:"认定",html:'<div class="form-material"><label for="example2-select2-multiple">认定</label><select class="js-select2" id="s_confirmStatus" name="example2-select2-multiple" style="width: 100%;" data-placeholder="请选择" multiple><option></option>\x3c!-- Required for data-placeholder attribute to work with Select2 plugin --\x3e</select></div>',colspan:1,validate:{rules:{required:!1}},typeAttr:{multiple:!0}},{id:"s_userablePlate",label:"适用板块",html:'<div class="form-material bdo-ap-select2"><label for="suserablePlate-select2-multi">适用板块</label><select class="js-select2" id="s_userablePlate" name="suserablePlate-select2-multi" style="width: 100%;" data-placeholder="请选择" multiple ><option></option> </select></div>',rowspan:1,colspan:1,validate:{rules:{required:!1}},typeAttr:{multiple:!0}}]},searchForm:null,getDefaultFilter:()=>({menuId:window.sys_menuId,sqlId:"DG00001"}),booleanTranslate:(e,t)=>t?1==e?"1":"0":"1"==e,setSummery(e){$("#summeryE").empty().text(this.getNullVal(e.pplansE,0)),$("#summeryC").empty().text(this.getNullVal(e.pplansC,0)),$("#summeryA").empty().text(this.getNullVal(e.pplansA,0)),$("#summeryV").empty().text(this.getNullVal(e.pplansV,0)),$("#summeryP").empty().text(this.getNullVal(e.pplansP,0)),$("#subjectE").empty().text(this.getNullVal(e.splansE,0)),$("#subjectC").empty().text(this.getNullVal(e.splansC,0)),$("#subjectA").empty().text(this.getNullVal(e.splansA,0)),$("#subjectV").empty().text(this.getNullVal(e.splansV,0)),$("#subjectP").empty().text(this.getNullVal(e.splansP,0));var t=(e,t,a)=>{e!=t?$("#summery"+a).addClass("ecavp-different"):$("#summery"+a).removeClass("ecavp-different")};t(e.pplansE,e.splansE,"E"),t(e.pplansC,e.splansC,"C"),t(e.pplansA,e.splansA,"A"),t(e.pplansV,e.splansV,"V"),t(e.pplansP,e.splansP,"P")},apply(e,t){$.each(t,(t,a)=>{e[t]=a})},getNullVal:(e,t)=>null==e||void 0==e||""==e?t:e});return u}}function AuditProgramPagePlan(e){let t,a,r,l,s,o,n,i=e.data,d=e.template||tplLoader("dgCenter/html/dg/auditProgramPlan.html");function c(e){return e?(e=e.toFixed(2),(e+="").includes(".")||(e+="."),e.replace(/(\d)(?=(\d{3})+\.)/g,function(e,t){return t+","})):""}function u(){let e=window.CUR_CUSTOMERID,t=window.CUR_PROJECTID;null!=$("#s_customerId option:checked").val()&&""!=$("#s_customerId option:checked").val()&&(e=$("#s_customerId option:checked").val()),null!=$("#s_projectId option:checked").val()&&""!=$("#s_projectId option:checked").val()&&(t=$("#s_projectId option:checked").val()),$("#selectProjectProgramTable_length").find("label:first").nextAll().remove(),$.ajax({type:"post",url:"cpBase/General.query.json",data:{sqlId:"DG00065",menuId:window.sys_menuId,start:-1,limit:-1,param1:e,param2:t,param10:$("#s_customerSubjectId").val()},dataType:"json",success(e){if(e.success){var t='<label style="position: relative;left: 20px;">标准审计程序:<b style="color: red;">'+(null==e.data[0].companyCount?0:e.data[0].companyCount)+'</b></label><label style="position: relative;left: 20px;">&nbsp;&nbsp;部门审计程序:<b style="color: red;">'+(null==e.data[0].depCount?0:e.data[0].depCount)+'</b></label><label style="position: relative;left: 20px;">&nbsp;&nbsp;自定义审计程序：<b style="color: red;">'+(null==e.data[0].customizeCount?0:e.data[0].customizeCount)+"</b></label>";$("#selectProjectProgramTable_length").find("label").after(t)}}})}function m(t){bdoInProcessingBox("请稍后，正在生成可选项目审计程序!"),$.ajax({type:"post",url:"dgCenter/DgMain.saveProjectProgram.json",data:{param1:$("#s_customerId option:selected").val(),param2:$("#s_projectId option:selected").val(),param3:$("#s_customerSubjectId").val()},dataType:"json",success(a){a.success?(bdoSuccessBox("操作成功",a.resultInfo.statusText),$("#spreadContentDir").trigger("rebuildTree",[{param1:window.CUR_PROJECTID,param2:window.CUR_CUSTOMERID},a=>{$(".js-tree-collapsed").trigger("rebuild",[{data:[a.data[0].treeData],levels:t.deep+2,callback(a){a.expandNode(t.nodeId,{levels:t.deep+2,silent:!0}),a.selectNode(t.nodeId,{silent:!0}),t=e.data=a.getNode(t.nodeId)}}])}]),$("#s_customerId").val("").select2({allowClear:!0,language:"zh-CN",width:"100%",placeholder:"请选择"}),$("#s_projectId").val("").select2({allowClear:!0,language:"zh-CN",width:"100%",placeholder:"请选择"}),$("#s_customerId").val("").trigger("change"),$("#s_projectId").val("").trigger("change"),$("#s_customerSubjectId").val(""),$("#subjectPlanTable").DataTable().ajax.reload()):bdoErrorBox("操作失败",a.resultInfo.statusText)}})}n=((e,t,a,r,l)=>{var s="css-checkbox-primary",o="";return 1==l&&(e!=a&&(s="css-checkbox-danger"),t!=r&&(o="score-red")),'<label class="css-input css-checkbox '+s+' control-label" >\t\t\t<input type="checkbox" '+("1"==e?"checked":"")+' disabled>\t\t\t<span></span>\t\t</label><div class="'+o+'">'+("1"==e?t||0:"")+"</div>"}),e.template=d,$(e.region).html(d),$("#initScheduleControl").remove(),a={props:{programInfo:Object,ecavp:String,rownum:Number},data:()=>({ecavpVal:!1,score:"",originalScore:0,originalVal:!1,scoreCache:{},timer:null}),watch:{ecavpVal(e){this.programInfo["plancs"+this.ecavp]=e?"1":"0",this.originalVal!=e?this.$parent.updateRowMark[this.rownum]+=1:this.$parent.updateRowMark[this.rownum]-=1,this.$parent.updateRowMark[this.rownum]<0&&(this.$parent.updateRowMark[this.rownum]=0),0==e&&(this.score=null,this.originalVal!=e&&this.saveChange())},score(e){if(!this.ecavpVal)return void(this.score=null);if(this.scoreCache[this.score]>0)return void this.saveChange();let t=e;((t=((t=((t=((t=(t+"").replace(/[^\d.]/g,""))+"").replace(/\.{2,}/g,"."))+"").replace(".","$#$").replace(/\./g,"").replace("$#$","."))+"").replace(/^(\-)*(\d+)\.(\d\d).*$/,"$1$2.$3"))+"").indexOf(".")<0&&t+""!=""&&(t=parseFloat(t)),parseFloat(t)>3&&(t=3),this.programInfo["plans"+this.ecavp]=t,this.originalScore!=(""==t?null:t)?this.$parent.updateRowMark[this.rownum]+=1:this.$parent.updateRowMark[this.rownum]-=1,this.$parent.updateRowMark[this.rownum]<0&&(this.$parent.updateRowMark[this.rownum]=0),this.score=t,this.scoreCache[this.score]||(this.scoreCache[this.score]=1),this.originalScore!=(""==t?null:t)&&this.saveChange()}},computed:{scoreCheckClass(){return this.score!=this.programInfo["subjectScore"+this.ecavp]?"subject-score-diff":""},labelClass(){let e="css-checkbox-primary";""!=this.scoreCheckClass&&(e="css-checkbox-danger");let t=["css-input","css-checkbox","control-label",e];return this.editEcavpVal&&t.push("css-input-disabled"),t},scoreClass:()=>["form-control text-center"],editScore(){return!this.ecavpVal},editEcavpVal(){return!("1"==this.programInfo.isNeedToAudit&&this.programInfo.tbSubject>""&&this.programInfo.baseSubject>"")}},mounted(){this.initEcavp()},methods:{initEcavp(){this.originalScore=this.programInfo["plans"+this.ecavp],this.originalVal=1==this.programInfo["plancs"+this.ecavp],this.ecavpVal=this.originalVal,this.score=this.originalScore},saveChange(){if(this.originalScore==this.score&&this.originalVal==this.ecavpVal)return;if(this.ecavpVal&&""===this.score)return;this.timer&&(clearTimeout(this.timer),this.timer=null);let e=this.programInfo.autoId,t=this.score,a="1",r=this.ecavp,l=this;this.ecavpVal||(a="0",t=""),this.timer=setTimeout(function(){l=this,$.ajax({url:"dgCenter/DgMain.updateIdentifiedScore.json",dataType:"json",data:{param1:e,param2:t,param3:r,param4:a},bdolxLoader:!1}).done(function(e){e.success?(l.originalScore=t,l.originalVal=a,OneUI.notifySuccess("保存成功！")):(OneUI.notifyError(e.resultInfo.statusText),l.ecavpVal=l.originalVal,l.score=l.originalScore)}),clearTimeout(this.timer),this.timer=null}.bind(this),1e3)}},template:'<div :class="scoreCheckClass">\t<label :class="labelClass" >\t\t<input type="checkbox" v-model="ecavpVal" :disabled="editEcavpVal">\t\t<span></span>\t</label>\t<div class="has-success">\t\t<div class="form-material">\t\t\t<input :class="scoreClass" type="text" v-model="score" :disabled="editScore">\t\t</div>\t</div></div>'},s={props:{programInfo:Object,rownum:Number,currentValue:String,datas:Array},data(){return{editMan:this.currentValue,editManCach:this.currentValue,timer:null}},watch:{editMan(e){let t;this.programInfo.subjectEditors=e,this.currentValue!=e?this.$parent.updateRowMark[this.rownum]+=1:this.$parent.updateRowMark[this.rownum]-=1,this.$parent.updateRowMark[this.rownum]<0&&(this.$parent.updateRowMark[this.rownum]=0),this.datas.map(function(a){e==a.id&&(t=""==a.value?a.text:a.value)}),this.saveEditMan(this.programInfo.userSubject,t)}},computed:{editManDisabled(){return!this.programInfo.tbSubject||"1"!=this.programInfo.isNeedToAudit||CUR_USERID!=JSON.parse($.sessionStorage("projectManager"))&&void 0!=JSON.parse($.sessionStorage("projectManager"))}},mounted(){},methods:{saveEditMan(e,t){this.editManCach!==this.editMan&&(this.timer&&(clearTimeout(this.timer),this.timer=null),this.timer=setTimeout(function(){let a=this;$.ajax({url:"dgCenter/DgMain.updateIdentifiedEditor.json",dataType:"json",data:{param1:a.programInfo.autoId,param2:a.editMan,param3:e,param4:t},bdolxLoader:!1}).done(function(e){e.success?(a.editManCach=a.editMan,OneUI.notifySuccess("保存成功！")):(a.editMan=a.editManCach,OneUI.notifyError(e.resultInfo.statusText))}),clearTimeout(this.timer),this.timer=null}.bind(this),1e3))}},template:'<div class="form-material">\t<select class="form-control" v-model="editMan" style="margin-left:5px" :disabled="editManDisabled">\t\t<option v-for="(data, index) in datas" :value="data.id">{{ data.text }}</option>\t</select></div>'},o={props:{programInfo:Object,isNeedToAudit:String,rownum:Number},data:()=>({isNeedToAuditVal:!1,originalVal:!1,valCache:{},timer:null}),watch:{isNeedToAuditVal(e){this.programInfo.isNeedToAudit=e?"1":"0",this.originalVal!=e?this.$parent.updateRowMark[this.rownum]+=1:this.$parent.updateRowMark[this.rownum]-=1,this.$parent.updateRowMark[this.rownum]<0&&(this.$parent.updateRowMark[this.rownum]=0),this.originalVal!=this.programInfo.isNeedToAudit&&this.saveChange()}},computed:{checkClass:()=>"",labelClass(){let e="css-checkbox-primary";""!=this.checkClass&&(e="css-checkbox-danger");let t=["css-input","css-checkbox","control-label",e];return this.editIsNeedToAuditVal&&t.push("css-input-disabled"),t},editIsNeedToAuditVal(){return 1!=this.programInfo.isEditable}},mounted(){this.initVal()},methods:{initVal(){this.originalVal=1==this.programInfo.isNeedToAudit,this.isNeedToAuditVal=this.originalVal},saveChange(){if(this.isNeedToAuditVal==this.originalVal)return;let e="0";new Promise((t,a)=>{this.isNeedToAuditVal?(e="0",t({})):bdoConfirmBox("提示","确认不编制该科目?",a=>{if(a){let a=this,r=$("#subjectPlanTable").dataTable().fnGetData(a.rownum);0!=r.remain||0!=r.debitTotalOcc||0!=r.creditTotalOcc||0!=r.balance?($("#notAuditReasonsModal_autoId").val(r.autoId),$("#notAuditReasonsModal_isNeedToAudit").val("0"),$("#notAuditReasonsText").val(r.notAuditReasons),$("#notAuditReasonsModal").find('button[data-dismiss="modal"]').parent().hide(),$("#notAuditReasonsModal").modal("show")):(e="1",t({}))}else e="0",t({})},()=>{e="0",t({})})}).then(e=>{this.timer&&(clearTimeout(this.timer),this.timer=null);let t=this.programInfo.autoId,a="1";this.isNeedToAuditVal||(a="0");let r=this;this.timer=setTimeout(function(){$.ajax({url:"dgCenter/DgSubjectIdentify.updateIdentifiedNeedAudit.json",dataType:"json",data:{param1:t,param2:a},bdolxLoader:!1}).done(function(e){e.success?(r.originalVal=r.isNeedToAuditVal,r.programInfo.isNeedToAudit=r.isNeedToAuditVal,OneUI.notifySuccess("保存成功！"),r.$parent.updateEditAble(r.rownum,"1"===a)):(OneUI.notifyError(e.resultInfo.statusText),r.isNeedToAuditVal=r.originalVal)}),clearTimeout(this.timer),this.timer=null}.bind(this),1e3)})}},template:'<div >\t<label :class="labelClass" >\t\t<input type="checkbox" v-model="isNeedToAuditVal" :disabled="editIsNeedToAuditVal">\t\t<span></span>\t</label></div>'},l={el:"#subjectPlanTable tbody",components:{"score-edit":a,"edit-man-edit":s,"edit-need-audit":o},data:{rowData:[],updateRowMark:[],editMans:[]},methods:{getUpateData(){let e=this,t=[];return $.each(this.updateRowMark,(a,r)=>{r>0&&t.push(e.rowData[a])}),t},reset(){let e=this;$.each(this.$children,(e,t)=>{t.originalVal=1==t.programInfo["cs"+t.ecavp],t.originalScore=t.programInfo["s"+t.ecavp]}),$.each(this.updateRowMark,(t,a)=>{e.updateRowMark[t]=0})},updateEditAble(e,t){t||$.each(this.$children,(t,a)=>{let r=a.$options;"score-edit"==r._componentTag&&r.propsData.rownum==e&&(a.originalScore=0,a.score=0,a.originalVal=!1,a.ecavpVal=!1),"edit-man-edit"==r._componentTag&&r.propsData.rownum==e&&(a.editManCach="",a.editMan="")})}}},t=((e,t)=>{return"<score-edit :ecavp=\"'"+e+'\'" :program-info="rowData['+t+']" :rownum="'+t+'"></score-edit>'}),getEditManEdit=((e,t)=>{return'<edit-man-edit :datas="editMans" :program-info="rowData['+t+']" :rownum="'+t+'" :current-value="\''+e+"'\"></edit-man-edit>"}),getEditNeedAudit=((e,t)=>{return"<edit-need-audit :is-need-to-audit=\"'"+e+'\'" :program-info="rowData['+t+']" :rownum="'+t+'"></edit-need-audit>'});var p=new Page({random:(new Date).getTime()+parseInt(1e3*Math.random()),container:e.region,events:{"#filter":"change,onFilterChange","#filterEditor":"change,onFilterEditorChange","#exchangeSetSubjectors":"click,onExchangeSubjectEditorsClick","#checkSubjectPlan":"click,onCheckSubjectPlanClick","#editButtonAll":"click,onEditAllClick","#resetButtonAll":"click,onResetAllClick","#createDgAllButton":"click,createDgAllClick","#projectProgram":"click,createProjectProgramClick","#searchProjectBtn":"click,selectProjectProgramClick","#deleteDgAllButton":"click,deleteDgAllButtonClick","#exportAuditProgramPlan":"click,onExportAuditProgramPlanClick","#setIdentifiedEcavpRecommendValue":"click,onSetIdentifiedEcavpRecommendValueBtnClick","#editProgramPageTabLink":"shown.bs.tab,OnEditProgramPageTabLinkShownBsTab","#insertProjectProgram":"click,onInsertProjectProgramClick","#searchResetProjectBtn":"click,onResetProjectProgramClick","#notAuditReasonsBtn":"click,onNotAuditReasonsBtnClick"},_template:e.template||tplLoader("dgCenter/html/dg/auditProgramPlan.html"),_data:e.data,selectEditors:null,bindEvents(){$("#subjectPlanTable").unbind("initEditVm"),$("#subjectPlanTable").bind("initEditVm",((e,t)=>{e.preventDefault(),(l=$.extend(!1,{},l)).data.editMans=p.selectEditors,l.data.rowData=$.extend(!1,{},t),l.data.updateRowMark=(()=>{let e=[];for(let a=0,r=t.length;a<r;a++)e.push(0);return e})(),r=new Vue(l)}).bind(this)),$("#subjectPlanTable").on("click",'button.table-btn-operate[name="createDgSub"]',this.onCreateDgSub),$("#subjectPlanTable").on("click",'button.table-btn-operate[name="editProgramPlan"]',this.onEditProgramPlan),$("#subjectPlanTable").on("click",'button.table-btn-operate[name="repeatDgSub"]',this.onRepeatDgSub),$('input[name="checkSubjectAll"]').off("click"),$('input[name="checkSubjectAll"]').on("click",this.onCheckSubjectAll),$("#subjectPlanTable").on("dblclick","tbody td",this.onEditReasons)},querySetting(){$.ajax({type:"post",url:"dgCenter/MaterialitySetting.queryMater.json",dataType:"json",data:{param1:window.CUR_PROJECTID},success:function(e){if(null!=e.data&&null!=e.data[0].data){var t=e.data[0].data;"1"==t.settingType?$("#rateA").val(c(t.settingImportValue1)):"2"==t.settingType?$("#rateA").val(c(t.settingImportValue2)):"3"==t.settingType?$("#rateA").val(c(t.settingImportValue3)):"4"==t.settingType?$("#rateA").val(c(t.settingImportValue4)):"5"==t.settingType?$("#rateA").val(c(t.settingImportValue5)):"6"==t.settingType&&$("#rateA").val(c(t.settingImportValue6)),$("#rateB").val(c(t.finalSettingTypeValue1)),$("#rateC").val(c(t.finalSettingTypeValue2))}else $("#rateA").val(0),$("#rateB").val(0),$("#rateC").val(0)}})},queryGroupMembers(){let e=this;$.ajax({type:"post",url:"dgCenter/DgProject.getProjectMember.json",async:!1,data:{param1:window.CUR_PROJECTID,param2:window.CUR_CUSTOMERID},dataType:"json",success(t){if(t.success){var a="";e.selectEditors=t.data.map(e=>({id:e.id,text:e.name,value:e.name})),e.selectEditors=[{id:"",text:"",value:""}].concat(e.selectEditors),a='<option value="" selected="selected"></option>',$.each(t.data,function(e,t){null!=t.name&&""!=t.id&&(a+='<option value="'+t.id+'" style="color: #000">'+t.name+"</option>")}),$("#filterEditor").html(a),$("#filterSubjectEditor").html(a)}}})},ECAVP_CONSTS:["E","C","A","V","P"],onSaveECAVPClick(e){if(CUR_USERID!=JSON.parse($.sessionStorage("projectManager"))&&void 0!=JSON.parse($.sessionStorage("projectManager")))bdoInfoBox("","只有当前项目负责人才能编辑科目编制人!");else{let e=r.getUpateData();if(e.length<1)return void bdoInfoBox("","没有修改数据！");let t=!0,a={},l="",s=e.map(e=>($.each(p.ECAVP_CONSTS,(r,s)=>{let o=e["plans"+s],n=e["plancs"+s];!t||1!=n||""!=o&&o&&parseFloat(o).toFixed(2)!=(0).toFixed(2)||(t=!1,a=e,l=s)}),{autoId:e.autoId,projectId:e.projectId,customerId:e.customerId,plansE:e.plansE,plansC:e.plansC,plansA:e.plansA,plansV:e.plansV,plansP:e.plansP,plancsE:e.plancsE,plancsC:e.plancsC,plancsA:e.plancsA,plancsV:e.plancsV,plancsP:e.plancsP,subjectEditors:e.subjectEditors}));if(!t)return void bdoErrorBox("保存失败","TB科目【"+a.tbSubject+"】客户科目【"+a.userSubject+"】的认定（"+l+"）没有设置分值！");$.ajax({type:"post",url:"dgCenter/dgMain.updatePlanScore.json",async:!1,data:{param1:JSON.stringify(s)},dataType:"json",success(e){e.success?($("#subjectPlanTable").DataTable().ajax.reload(),r.reset(),bdoSuccessBox("保存成功",e.resultInfo.statusText)):bdoErrorBox("保存失败",e.resultInfo.statusText)}})}},onEditAllClick(e){$("#editButtonAll").blur();var t=$("#subjectPlanTable").dataTable().fnGetData($(e.currentTarget).attr("data-row"));let a=[];for(let e=0;e<t.length;e++)t[e].tbSubject&&""!=t[e].tbSubject||a.push(t[e].userSubject);$("#auditProgramList").empty(),$.each(a,function(e,t){let r="<label>客户科目：</label><label>"+a[e]+"</label><br/>";$("#auditProgramList").append(r)}),$("#auditProgramPlanModal").modal("show")},deleteDgAllButtonClick(e){$("#auditProgramList").empty()},createDgAllClick(t){var a=$("#subjectPlanTable").dataTable().fnGetData($(t.currentTarget).attr("data-row"));let r=[],l=[];function s(){$("#spreadContentDir").trigger("rebuildTree",[{param1:window.CUR_PROJECTID,param2:window.CUR_CUSTOMERID},t=>{$(".js-tree-collapsed").trigger("rebuild",[{data:[t.data[0].treeData],levels:i.deep+1,callback(t){t.expandNode(i.nodeId,{levels:i.deep+1,silent:!0}),t.selectNode(i.nodeId,{silent:!0}),i=e.data=t.getNode(i.nodeId)}}])}]),$("#subjectPlanTable").DataTable().ajax.reload(),$("#auditProgramPlanModal").modal("hide"),swal.close()}$.each(a,function(e,t){null!=t.userSubject&&""!=t.userSubject&&null!=t.tbSubject&&""!=t.tbSubject&&null!=t.isNeedToAudit&&"1"==t.isNeedToAudit&&l.push(a[e])}),$.each(l,function(e,t){r.push({param1:"002",param2:window.CUR_PROJECTID,param3:window.CUR_CUSTOMERID,param4:l[e].tbSubjectName,param5:l[e].tbSubjectCode,param6:l[e].tbSubjectCode,param9:l[e].autoId,param10:window.CUR_PROJECT_ACC_YEAR})}),bdoInProcessingBox("请稍后，正在批量生成审计程序!");let o=!1;setTimeout(()=>{o||s()},6e4),$.ajax({type:"post",url:"dgCenter/DgMain.createDgTreeAll.json",data:{param13:JSON.stringify(r)},dataType:"json",bdolxLoader:!1,success:function(e){e.success?(bdoSuccessBox("操作成功",e.resultInfo.statusText),o=!0,s()):bdoErrorBox("操作失败",e.resultInfo.statusText)}})},createProjectProgramClick(e){function t(e,t,a){return new Promise((a,r)=>{$.ajax({type:"post",url:e,data:t,dataType:"json",success(e){e.success?a(e):r(e)}})})}t("dgCenter/DgGeneral.query.json",{menuId:window.sys_menuId,sqlId:"DG00197",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,start:-1,limit:-1}).then(e=>{if(CUR_USERID!=e.data[0].manager)return bdoErrorBox("","无权限！"),new Promise(()=>{})},e=>{bdoErrorBox("","无权限！")}).then(e=>($("#auditProgramPlanModal").modal("hide"),p.searchProjectForm.jsonData={s_customerId:"",s_projectId:"",s_customerSubjectId:""},p.selectProjectProgramTableCfg.localParam.urlparam=p.getDefaultFilter(),p.selectProjectProgramTableCfg.localParam.urlparam.param11=window.CUR_CUSTOMERID,p.selectProjectProgramTableCfg.localParam.urlparam.param12=window.CUR_PROJECTID,p.selectProjectProgramTableCfg.localParam.urlparam.param13=window.CUR_CUSTOMERID,p.selectProjectProgramTableCfg.localParam.urlparam.param14=window.CUR_PROJECTID,p.selectProjectProgramSider.show(),$("#s_customerId").val("").select2({allowClear:!0,language:"zh-CN",width:"100%",placeholder:"请选择"}),$("#s_projectId").val("").select2({allowClear:!0,language:"zh-CN",width:"100%",placeholder:"请选择"}),$("#s_customerId").val("").trigger("change"),$("#s_projectId").val("").trigger("change"),$("#s_customerSubjectId").val(""),t("cpBase/Combo.getCustomerList.json",{page:-1,start:-1}))).then(e=>{let a=e.data;$("#s_customerId").empty(),$("#s_customerId").append($("<option>",{value:"",text:""})),$.each(a,function(e,t){$("#s_customerId").append($("<option>",{value:t.value,text:t.label}))}),$("#s_customerId").change(function(){t("cpBase/Combo.getCustomerProjectList.json",{param1:$("#s_customerId option:selected").val(),page:-1,start:-1}).then(e=>{$("#s_projectId").empty(),$.each(e.data,function(e,t){$("#s_projectId").append($("<option>",{value:t.value,text:t.label}))})})}),BdoDataTable("selectProjectProgramTable",p.selectProjectProgramTableCfg),u(),uiBlocksApi($(".block .block-themed .block-opt-hidden"),"content_toggle")}).catch(e=>{bdoErrorBox("","无权限！")})},selectProjectProgramClick(e){p.selectProjectProgramTableCfg.localParam.urlparam=p.getDefaultFilter(),null==$("#s_customerId option:checked").val()||""==$("#s_customerId option:checked").val()?p.selectProjectProgramTableCfg.localParam.urlparam.param11=window.CUR_CUSTOMERID:p.selectProjectProgramTableCfg.localParam.urlparam.param11=$("#s_customerId option:checked").val(),null==$("#s_projectId option:checked").val()||""==$("#s_projectId option:checked").val()?p.selectProjectProgramTableCfg.localParam.urlparam.param12=window.CUR_PROJECTID:p.selectProjectProgramTableCfg.localParam.urlparam.param12=$("#s_projectId option:checked").val(),p.selectProjectProgramTableCfg.localParam.urlparam.param13=window.CUR_CUSTOMERID,p.selectProjectProgramTableCfg.localParam.urlparam.param14=window.CUR_PROJECTID,p.selectProjectProgramTableCfg.localParam.urlparam.param15=$("#s_customerSubjectId").val(),$("#selectProjectProgramTable").DataTable().ajax.reload(),u()},onResetProjectProgramClick(e){$("#s_customerId").val("").select2({allowClear:!0,language:"zh-CN",width:"100%",placeholder:"请选择"}),$("#s_projectId").val("").select2({allowClear:!0,language:"zh-CN",width:"100%",placeholder:"请选择"}),$("#s_customerId").val("").trigger("change"),$("#s_projectId").val("").trigger("change"),$("#s_customerSubjectId").val(""),p.selectProjectProgramTableCfg.localParam.urlparam=p.getDefaultFilter(),p.selectProjectProgramTableCfg.localParam.urlparam.param11=window.CUR_CUSTOMERID,p.selectProjectProgramTableCfg.localParam.urlparam.param12=window.CUR_PROJECTID,p.selectProjectProgramTableCfg.localParam.urlparam.param13=window.CUR_CUSTOMERID,p.selectProjectProgramTableCfg.localParam.urlparam.param14=window.CUR_PROJECTID,p.selectProjectProgramTableCfg.localParam.urlparam.param15=$("#s_customerSubjectId").val(),$("#selectProjectProgramTable").DataTable().ajax.reload(),u()},onInsertProjectProgramClick(e){let t=$("#selectProjectProgramTable").dataTable().fnGetData($(e.currentTarget).attr("data-row")),a=[],r=[];if(0==t.length)return bdoInfoBox("提示","请先选择一个有审计程序的项目!"),!1;$.each(t,function(e,l){null!=t[e].userSubjectId&&""!=t[e].userSubjectId&&t[e].subjectId===t[e].userSubjectId?a.push(t[e]):r.push(t[e])}),0!=r.length?bdoConfirmBox("提示","当前客户科目编号为空不会生成审计程序，科目编号不一致的需要手动生成审计程序，是否继续进行操作?",e=>{p.selectProjectProgramSider.hide(),m(i)}):(p.selectProjectProgramSider.hide(),m(i))},onResetAllClick(t){$("#resetButtonAll").blur(),bdoConfirmBox("提示","重置后会删除所有已生成的审计程序，是否继续重置？",a=>{var r=$("#subjectPlanTable").dataTable().fnGetData($(t.currentTarget).attr("data-row"));let l=[];$.each(r,function(e,t){let a=r[e].userSubject;a=a.substr(0,a.indexOf("-")),l.push({param1:"002",param2:window.CUR_PROJECTID,param3:window.CUR_CUSTOMERID,param4:window.CUR_PROJECT_ACC_YEAR,param5:r[e].tbSubjectName,param6:r[e].tbSubjectCode,param9:a})}),bdoInProcessingBox("请稍后，正在批量重置审计程序!"),(!l||l.length<1)&&bdoErrorBox("操作失败","没有数据，不需重置。"),new Promise((e,t)=>{$.ajax({type:"post",url:"dgCenter/DgMain.resetAuditProduresAll.json",data:{param13:JSON.stringify(l)},dataType:"json",bdolxLoader:!1,success:function(a){a.success?(bdoSuccessBox("操作成功",a.resultInfo.statusText),e(a)):(bdoErrorBox("操作失败",a.resultInfo.statusText),t(a))}})}).then(t=>{$("#spreadContentDir").trigger("rebuildTree",[{param1:window.CUR_PROJECTID,param2:window.CUR_CUSTOMERID},t=>{$(".js-tree-collapsed").trigger("rebuild",[{data:[t.data[0].treeData],levels:i.deep+1,callback(t){t.expandNode(i.nodeId,{levels:i.deep+1,silent:!0}),t.selectNode(i.nodeId,{silent:!0}),i=e.data=t.getNode(i.nodeId)}}])}])}).finally(()=>{swal.close()})})},onFilterChange(e){switch($("#filter").val()){case"all":p.auditProgramTableCfg.localParam.urlparam.param5=1,p.auditProgramTableCfg.localParam.urlparam.param6=null,p.auditProgramTableCfg.localParam.urlparam.param7=null;break;case"std":p.auditProgramTableCfg.localParam.urlparam.param6=1,p.auditProgramTableCfg.localParam.urlparam.param5=null,p.auditProgramTableCfg.localParam.urlparam.param7=null;break;case"sub":p.auditProgramTableCfg.localParam.urlparam.param7=1,p.auditProgramTableCfg.localParam.urlparam.param5=null,p.auditProgramTableCfg.localParam.urlparam.param6=null}$("#subjectPlanTable").DataTable().ajax.reload()},onFilterEditorChange(e){var t=$("#filterEditor option:selected").val();p.auditProgramTableCfg.localParam.urlparam.param10=t,$("#subjectPlanTable").DataTable().ajax.reload()},onExchangeSubjectEditorsClick(e){CUR_USERID==JSON.parse($.sessionStorage("projectManager"))||void 0==JSON.parse($.sessionStorage("projectManager"))?($('input[name="checkSubjectAll"]').prop("checked",!1),this.queryGroupMembers(),$("#selectSubjectUpdateEditor").modal("show"),$("#selectSubjectPlanTable").DataTable().ajax.reload()):bdoInfoBox("提示","只有当前项目负责人才能挑选科目!")},onCheckSubjectPlanClick(e){let t=$("#filterSubjectEditor option:selected").val(),a=$("#filterSubjectEditor option:selected").text(),r=[];$.each($('input[name="checkSubject"]:checkbox'),function(){this.checked&&r.push($(this).val())}),r.length<1?bdoInfoBox("提示","请至少选择一项科目!"):$.ajax({type:"post",url:"dgCenter/DgMain.updateSubjectEditors.json",dataType:"json",data:{param1:t,param2:JSON.stringify(r),param3:a},success:function(e){e.success?(bdoSuccessBox("提示","修改科目编制人成功"),$("#selectSubjectPlanTable").DataTable().ajax.reload(),$("#subjectPlanTable").DataTable().ajax.reload()):bdoErrorBox("提示",e.resultInfo.statusText),$('input[name="checkSubjectAll"]').prop("checked",!1)}})},onNotAuditReasonsBtnClick(e){var t=$("#notAuditReasonsText").val(),a=$("#notAuditReasonsModal_isNeedToAudit").val();"true"==a&&(a="1"),"1"==a||""!=t?$.ajax({url:"dgCenter/DgSubjectIdentify.updateIdentifiedReasons.json",dataType:"json",data:{param1:$("#notAuditReasonsModal_autoId").val(),param2:t,param3:a},bdolxLoader:!1,success(e){e.success?($("#subjectPlanTable").DataTable().draw(!1),$("#notAuditReasonsModal").modal("hide"),OneUI.notifySuccess("保存成功！")):($("#notAuditReasonsModal").modal("hide"),$("#subjectPlanTable").DataTable().draw(!1),bdoErrorBox("失败",e.resultInfo.statusText))}}):bdoInfoBox("提示","请填写不编制理由！")},exportAPPlanToDg(){let t=this.auditProgramTableCfg,a=getColumnsInfo(t.tableParam.columnDefs),r=applyIf({},t.localParam.urlparam);delete r.sort,r.page="",r.start="",r.limit="",r.queryUrl=t.localParam.url,r.columnMap=a,r=JSON.stringify(r);let l=encodeURI("计划控制表"),s={menuId:window.sys_menuId,param1:r,title:l};$.ajax({url:"dgCenter/ExportOtherDg.exportAPPlanTbl.json",data:s,type:"post",dataType:"json",success:function(t){if(t.success){if(t.data&&t.data.length>0){let a=t.data[0].fileData,r=t.data[0].fileName;t.data[0].isNew;bdoInfoBox("成功",r+"导出成功！"),saveAs(dataURLtoFile(a,r),r),getSubjecttree({param1:window.CUR_PROJECTID,param2:$("#onlyMyselfCheckBox").get(0).checked?"1":""},t=>{$(".js-tree-collapsed").trigger("rebuild",[{data:[t.data[0].treeData],levels:e.data.deep+2,callback(t){t.expandNode(e.data.nodeId,{levels:e.data.deep+2,silent:!0}),t.selectNode(e.data.nodeId,{silent:!0}),e.data=t.getNode(e.data.nodeId)}}])})}}else bdoErrorBox("失败",t.resultInfo.statusText)}})},onExportAuditProgramPlanClick(e){p.exportAPPlanToDg()},onSetIdentifiedEcavpRecommendValueBtnClick(e){$("#setIdentifiedEcavpRecommendValue").blur(),$.ajax({type:"post",url:"dgCenter/DgEcavp.setSubjectIdentifiedEcavpRecommendValue.json",dataType:"json",data:{},success:function(e){e.success?($("#subjectPlanTable").DataTable().ajax.reload(),bdoSuccessBox("成功","科目认定分值设置成功！")):bdoErrorBox("失败",e.resultInfo.statusText)}})},init(t){$("#subjectIndex").text("【"+e.data.extraOptions.indexId+"】"),this.queryGroupMembers(),BdoDataTable("subjectPlanTable",this.auditProgramTableCfg),BdoDataTable("selectSubjectPlanTable",this.selectSubjectPlanTableCfg),this.bindEvents(),OneUI.initHelper("slimscroll"),this.querySetting(),this.selectProjectProgramSider=side({el:"#selectProjectProgramSider",autoHide:!1}),this.searchProjectForm=createForm(this.searchProjectFormCfg)},searchProjectFormCfg:{options:{propsData:{jsonData:{s_customerId:"",s_projectId:"",s_customerSubjectName:""}}},props:{jsonData:Object},display:"tableform-one",column:4,id:"searchProjectForm",data:()=>({ajaxConfig:{type:"POST",url:"",dataType:"json",success(e){}}}),items:[{id:"s_customerId",label:"客户名称",colspan:1,rowspan:1,type:"select",html:""},{id:"s_projectId",label:"项目名称",colspan:1,type:"select",html:""},{id:"s_customerSubjectId",type:"input",label:"科目编号",colspan:1}]},searchProjectForm:null,selectProjectProgramSider:null,selectProjectProgramTable:null,selectProjectProgramTableCfg:{localParam:{url:"dgCenter/DgGeneral.query.json",urlparam:{menuId:window.sys_menuId,sqlId:"",start:-1,limit:-1},tabNum:!0},tableParam:{scrollX:!0,select:!0,order:[2,"asc"],pageLength:30,createdRow(e,t,a){$(e).attr("dataIndex",a)},serverSide:!0,columnDefs:[{targets:1,orderable:!0,title:"项目名称",name:"projectName",data:"projectName",width:"200px"},{targets:2,orderable:!0,title:"所选项目科目编号",name:"subjectId",data:"subjectId",className:"text-center",width:"80px"},{targets:3,orderable:!0,title:"所选项目科目名称",name:"subjectName",data:"subjectName",className:"text-center",width:"100px"},{targets:4,orderable:!0,title:"客户科目编号",name:"userSubjectId",data:"userSubjectId",className:"text-center",width:"80px",render(e,t,a,r){var l=a.subjectId,s=a.userSubjectId;return null!=s&&""!=s&&l!=s?'<label style="background-color: red;color: white">'+a.userSubjectId+"</label>":a.userSubjectId}},{targets:5,orderable:!0,title:"客户科目名称",name:"userSubjectName",data:"userSubjectName",className:"text-center",width:"100px"},{targets:6,orderable:!0,title:"索引号",name:"indexId",data:"indexId",className:"text-center",width:"100px"},{targets:7,orderable:!0,title:"程序名称",className:"text-center",name:"dgName",data:"dgName",width:"150px"},{targets:8,orderable:!0,title:"创建人",className:"text-center",name:"CREATED_BY",data:"CREATED_BY",width:"40px",render:(e,t,a,r)=>a.__ucreateUser.userName}]}},getDefaultFilter:()=>({menuId:window.sys_menuId,sqlId:"DG01005",start:-1,limit:-1}),auditProgramTable:null,bgColerMap:{},onEditProgramPlan(e){var t=$("#subjectPlanTable").dataTable().fnGetData($(e.currentTarget).attr("data-row"));if($.sessionStorage("subjectEditors",t.subjectEditors),null==t.userSubject||""==t.userSubject||null==t.tbSubject||""==t.tbSubject)return void bdoErrorBox("操作失败","请先添加关系对照！");let a;searchSubjecttreeNode(JSON.parse($.sessionStorage("subjecttree")),function(e){"SUBJECT"==e.extraOptions.nodeType&&e.extraOptions.userSubjectId==t.userSubjectId&&((a=e).workpaperId=a.extraOptions.workpaperId,a.currentNode=$.extend(!1,{},e),a.currentNode.currentNode=null)}),void 0==a||null==a?bdoInfoBox("提示","请先生成审计程序"):$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",data:{menuId:window.sys_menuId,sqlId:"DG00184",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:t.autoId},dataType:"json",success:function(e){let r=!1;e.success&&e.data&&e.data.length>0&&e.data[0].programCount>0&&(r=!0,p.editProgramPageNodeData=a,p.editProgramPageNodeData.tbRowData=t,$("#editProgramPageTabLink").data("rowData",t),$("#editProgramPageTabLink").tab("show")),r||bdoInfoBox("","没有审计程序，请先生成审计程序！",1e3)}})},editProgramPageNodeData:{},OnEditProgramPageTabLinkShownBsTab(e){let t=$("#editProgramPageTabLink").data("rowData");if(t){if(t&&t>""&&t.subjectEditors==sys_userId)return p.editProgramPageNodeData.pageType=null,void EditProgramPage({region:"#editProgramPageTab",data:p.editProgramPageNodeData});t&&(t.pageType=null),$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",async:!1,data:{menuId:window.sys_menuId,sqlId:"DG00197",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,start:-1,limit:-1},dataType:"json",success(e){if(e.success){let t=$("#editProgramPageTabLink").data("rowData");CUR_USERID==e.data[0].manager||t.subjectEditors==sys_userId?EditProgramPage({region:"#editProgramPageTab",data:p.editProgramPageNodeData}):bdoErrorBox("","无权限！")}}})}},onCreateDgSub(t){var a=$("#subjectPlanTable").dataTable().fnGetData($(t.currentTarget).attr("data-row"));"1"==a.isNeedToAudit?null!=a.userSubject&&""!=a.userSubject&&null!=a.tbSubject&&""!=a.tbSubject?$.ajax({type:"post",url:"dgCenter/DgMain.createDgTree.json",data:{param1:"002",param2:window.CUR_PROJECTID,param3:window.CUR_CUSTOMERID,param4:a.tbSubjectName,param5:a.tbSubjectCode,param6:a.tbSubjectCode,param9:a.autoId,refreshFlg:1},dataType:"json",success:function(t){t.success?(bdoSuccessBox("操作成功",t.resultInfo.statusText),$("#spreadContentDir").trigger("rebuildTree",[{param1:window.CUR_PROJECTID,param2:window.CUR_CUSTOMERID},t=>{$(".js-tree-collapsed").trigger("rebuild",[{data:[t.data[0].treeData],levels:i.deep+1,callback(t){t.expandNode(i.nodeId,{levels:i.deep+1,silent:!0}),t.selectNode(i.nodeId,{silent:!0}),i=e.data=t.getNode(i.nodeId)}}])}])):bdoErrorBox("操作失败",t.resultInfo.statusText)}}):bdoErrorBox("操作失败","客户科目：【"+a.userSubject+"】请先添加关系对照！"):bdoErrorBox("操作失败","客户科目：【"+a.userSubject+"】请先勾选是否编制！")},onRepeatDgSub(t){let a=$("#subjectPlanTable").dataTable().fnGetData($(t.currentTarget).attr("data-row"));bdoConfirmBox("提示","重置会删除原来的审计程序，确定重置吗？",t=>{let r=a.userSubject;r=r.substr(0,r.indexOf("-")),$.ajax({type:"post",url:"dgCenter/dgMain.resetAuditProdures.json",data:{param1:"002",param2:window.CUR_PROJECTID,param3:window.CUR_CUSTOMERID,param4:window.CUR_PROJECT_ACC_YEAR,param5:a.tbSubjectName,param6:a.tbSubjectCode,param9:r,param10:a.autoId},dataType:"json",success:function(t){t.success?(bdoSuccessBox("操作成功",t.resultInfo.statusText),$("#spreadContentDir").trigger("rebuildTree",[{param1:window.CUR_PROJECTID,param2:window.CUR_CUSTOMERID},t=>{$(".js-tree-collapsed").trigger("rebuild",[{data:[t.data[0].treeData],levels:i.deep+1,callback(t){t.expandNode(i.nodeId,{levels:i.deep+1,silent:!0}),t.selectNode(i.nodeId,{silent:!0}),i=e.data=t.getNode(i.nodeId)}}])}])):bdoErrorBox("操作失败",t.resultInfo.statusText)}})})},onCheckSubjectAll(e){1==$('input[name="checkSubjectAll"]').is(":checked")?$("input[name='checkSubject']").each(function(){this.checked=!0}):($('input[name="checkSubjectAll"]').prop("checked",!1),$("input[name='checkSubject']").each(function(){this.checked=!1}))},onEditReasons(e){if("notAuditReasons"===$("#subjectPlanTable").DataTable().context[0].aoColumns[$(this).index()].name){var t=$("#subjectPlanTable").DataTable().data()[$(this).closest("tr").index()];if("1"==t.isNeedToAudit){if(null==t.notAuditReasons||""==t.notAuditReasons)return;$("#notAuditReasonsModal_isNeedToAudit").val(t.isNeedToAudit)}$("#notAuditReasonsText").val(t.notAuditReasons),$("#notAuditReasonsModal_autoId").val(t.autoId),$("#notAuditReasonsModal").find('button[data-dismiss="modal"]').parent().show(),$("#notAuditReasonsModal").modal("show")}},selectSubjectPlanTableCfg:{localParam:{url:"dgCenter/DgGeneral.query.json",urlparam:{menuId:window.sys_menuId,sqlId:"DG00020",param1:i.extraOptions.customerId,param2:i.extraOptions.projectId,param3:window.CUR_PROJECT_ACC_YEAR},tabNum:!0},tableParam:{scrollX:!0,select:!1,ordering:!1,serverSide:!0,autoWidth:!1,fixedThead:!0,lengthChange:!1,paging:!1,fixedHeight:"480px",columnDefs:[{targets:1,orderable:!1,className:"text-center",width:"50px",title:'<label class="css-input css-checkbox css-checkbox-primary"><input type="checkbox" name="checkSubjectAll"/><span></span></label>',render(e,t,a,r){let l="";return null!=a.tbSubject&&""!=a.tbSubject&&(l='<label class="css-input css-checkbox css-checkbox-primary"><input type="checkbox" name="checkSubject" value="'+a.autoId+'"/><span></span></label>'),l}},{targets:2,title:"TB科目",name:"tbSubject",data:"tbSubject",className:"text-left",width:"100px"},{targets:3,title:"客户科目",name:"userSubject",data:"userSubject",className:"text-left",width:"100px"},{targets:4,title:"科目编制人",name:"__usubjectEditorUser",data:"__usubjectEditorUser",className:"text-center",width:"80px",render:(e,t,a,r)=>e?e.userName:""}]}},auditProgramTableCfg:{localParam:{url:"dgCenter/DgGeneral.query.json",urlparam:{menuId:window.sys_menuId,sqlId:"DG00020",param1:i.extraOptions.customerId,param2:i.extraOptions.projectId,param3:window.CUR_PROJECT_ACC_YEAR,param10:$("#filterEditor option:selected").val()},tabNum:!0},tableParam:{scrollX:!0,select:!1,ordering:!1,serverSide:!0,autoWidth:!1,fixedThead:!0,fixedHeight:"480px",drawCallback(e){$("#subjectPlanTable tbody").replaceWith(e.nTBody);var t=this.fnGetData();$("#subjectPlanTable").trigger("initEditVm",[t])},preDrawCallback(e){r&&r.$destroy()},columnDefs:[{targets:(()=>(cnt=0,++cnt))(),orderable:!1,className:"text-center",title:"处理",data:null,width:"100px",render(e,t,a,r){var l="";return l+='<div class="">',l+='<button class="btn btn-xs btn-info table-btn-operate bdo-drop-btn" type="button" name="createDgSub" data-placement="top" title="生成审计程序" data-toggle="tooltip" data-row="'+r.row+'">\t<i class="fa fa-send"></i>\t</button>',l+='<button class="btn btn-xs btn-info table-btn-operate bdo-drop-btn" type="button" name="editProgramPlan" data-placement="top" title="编辑审计程序" data-toggle="tooltip" data-row="'+r.row+'">\t<i class="fa fa-edit"></i>\t</button>',l+='<button class="btn btn-xs btn-danger table-btn-operate bdo-drop-btn" type="button" name="repeatDgSub" data-placement="top" title="重置审计程序" data-toggle="tooltip" data-row="'+r.row+'">\t<i class="fa fa-power-off"></i>\t</button>',l+="</div>"}},{targets:++cnt,orderable:!0,title:"TB科目名称",name:"tbSubjectName",data:"tbSubjectName",width:"90px",className:"hidden"},{targets:++cnt,orderable:!0,title:"TB科目",name:"tbSubject",data:"tbSubject",width:"90px",className:"text-left"},{targets:++cnt,orderable:!0,title:"客户科目",name:"userSubject",data:"userSubject",width:"90px",className:"text-left"},{targets:++cnt,className:"text-right",orderable:!0,title:"期初数",name:"remain",data:"remain",width:"100px",render:function(e,t,a,r){return formatMoney(e)}},{targets:++cnt,className:"text-right",orderable:!0,title:"借方发生额",name:"debitTotalOcc",data:"debitTotalOcc",width:"100px",render:function(e,t,a,r){return formatMoney(e)}},{targets:++cnt,className:"text-right",orderable:!0,title:"贷方发生额",name:"creditTotalOcc",data:"creditTotalOcc",width:"100px",render:function(e,t,a,r){return formatMoney(e)}},{targets:++cnt,className:"text-right",orderable:!0,title:"期末数",name:"balance",data:"balance",width:"100px",render:function(e,t,a,r){return formatMoney(e)}},{targets:++cnt,title:"E",name:"E",data:"plancsE",width:"30px",className:"text-center",render:(e,a,r,l)=>t("E",l.row)},{targets:++cnt,title:"C",name:"C",data:"plancsC",width:"30px",className:"text-center",render:(e,a,r,l)=>t("C",l.row)},{targets:++cnt,title:"A",name:"A",data:"plancsA",width:"30px",className:"text-center",render:(e,a,r,l)=>t("A",l.row)},{targets:++cnt,title:"V",name:"V",data:"plancsV",width:"30px",className:"text-center",render:(e,a,r,l)=>t("V",l.row)},{targets:++cnt,title:"P",name:"P",data:"plancsP",width:"30px",className:"text-center",render:(e,a,r,l)=>t("P",l.row)},{targets:++cnt,title:"科目编制人",name:"科目编制人",data:"subjectEditors",width:"120px",className:"text-center",render:(e,t,a,r)=>getEditManEdit(e,r.row)},{targets:++cnt,title:"是否编制",name:"isNeedToAudit",data:"isNeedToAudit",width:"30px",className:"text-center",render:(e,t,a,r)=>getEditNeedAudit(e,r.row)},{targets:++cnt,orderable:!0,title:"不编制理由",name:"notAuditReasons",data:"notAuditReasons",width:"120px",className:"text-left"}]}}});return p}function OtherAuditProgramPagePlan(e){let t,a,r,l,s,o,n=e.data,i=e.template||tplLoader("dgCenter/html/dg/otherAuditProgramPlan.html");function d(e){return e?"":(e=e.toFixed(2),(e+="").includes(".")||(e+="."),e.replace(/(\d)(?=(\d{3})+\.)/g,function(e,t){return t+","}))}function c(){let e=window.CUR_CUSTOMERID,t=window.CUR_PROJECTID;null!=$("#other_s_customerId option:checked").val()&&""!=$("#other_s_customerId option:checked").val()&&(e=$("#other_s_customerId option:checked").val()),null!=$("#other_s_projectId option:checked").val()&&""!=$("#other_s_projectId option:checked").val()&&(t=$("#other_s_projectId option:checked").val()),$("#selectProjectProgramTable_length").find("label:first").nextAll().remove(),$.ajax({type:"post",url:"cpBase/General.query.json",data:{sqlId:"DG00065",menuId:window.sys_menuId,start:-1,limit:-1,param1:e,param2:t,param10:$("#other_s_customerSubjectId").val()},dataType:"json",success(e){if(e.success){var t='<label style="position: relative;left: 20px;">标准审计程序:<b style="color: red;">'+(null==e.data[0].companyCount?0:e.data[0].companyCount)+'</b></label><label style="position: relative;left: 20px;">&nbsp;&nbsp;部门审计程序:<b style="color: red;">'+(null==e.data[0].depCount?0:e.data[0].depCount)+'</b></label><label style="position: relative;left: 20px;">&nbsp;&nbsp;自定义审计程序：<b style="color: red;">'+(null==e.data[0].customizeCount?0:e.data[0].customizeCount)+"</b></label>";$("#selectProjectProgramTable_length").find("label").after(t)}}})}function u(t){bdoInProcessingBox("请稍后，正在生成可选项目审计程序!"),$.ajax({type:"post",url:"dgCenter/DgMain.saveProjectProgram.json",data:{param1:$("#other_s_customerId option:selected").val(),param2:$("#other_s_projectId option:selected").val(),param3:$("#other_s_customerSubjectId").val()},dataType:"json",success(a){a.success?(bdoSuccessBox("操作成功",a.resultInfo.statusText),$("#spreadContentDir").trigger("rebuildTree",[{param1:window.CUR_PROJECTID,param2:window.CUR_CUSTOMERID},a=>{$(".js-tree-collapsed").trigger("rebuild",[{data:[a.data[0].treeData],levels:t.deep+2,callback(a){a.expandNode(t.nodeId,{levels:t.deep+2,silent:!0}),a.selectNode(t.nodeId,{silent:!0}),t=e.data=a.getNode(t.nodeId)}}])}]),$("#other_s_customerId").val("").select2({allowClear:!0,language:"zh-CN",width:"100%",placeholder:"请选择"}),$("#other_s_projectId").val("").select2({allowClear:!0,language:"zh-CN",width:"100%",placeholder:"请选择"}),$("#other_s_customerId").val("").trigger("change"),$("#other_s_projectId").val("").trigger("change"),$("#other_s_customerSubjectId").val(""),$("#other_subjectPlanTable").DataTable().ajax.reload()):bdoErrorBox("操作失败",a.resultInfo.statusText)}})}o=((e,t,a,r,l)=>{var s="css-checkbox-primary",o="";return 1==l&&(e!=a&&(s="css-checkbox-danger"),t!=r&&(o="score-red")),'<label class="css-input css-checkbox '+s+' control-label" >\t\t\t<input type="checkbox" '+("1"==e?"checked":"")+' disabled>\t\t\t<span></span>\t\t</label><div class="'+o+'">'+("1"==e?t||0:"")+"</div>"}),e.template=i,$(e.region).html(i),$("#other_initScheduleControl").remove(),a={props:{programInfo:Object,ecavp:String,rownum:Number},data:()=>({ecavpVal:!1,score:"",originalScore:0,originalVal:!1,scoreCache:{},timer:null}),watch:{ecavpVal(e){this.programInfo["plancs"+this.ecavp]=e?"1":"0",this.originalVal!=e?this.$parent.updateRowMark[this.rownum]+=1:this.$parent.updateRowMark[this.rownum]-=1,this.$parent.updateRowMark[this.rownum]<0&&(this.$parent.updateRowMark[this.rownum]=0),0==e&&(this.score=null,this.originalVal!=e&&this.saveChange())},score(e){if(!this.ecavpVal)return void(this.score=null);if(this.scoreCache[this.score]>0)return void this.saveChange();let t=e;((t=((t=((t=((t=(t+"").replace(/[^\d.]/g,""))+"").replace(/\.{2,}/g,"."))+"").replace(".","$#$").replace(/\./g,"").replace("$#$","."))+"").replace(/^(\-)*(\d+)\.(\d\d).*$/,"$1$2.$3"))+"").indexOf(".")<0&&t+""!=""&&(t=parseFloat(t)),parseFloat(t)>3&&(t=3),this.programInfo["plans"+this.ecavp]=t,this.originalScore!=(""==t?null:t)?this.$parent.updateRowMark[this.rownum]+=1:this.$parent.updateRowMark[this.rownum]-=1,this.$parent.updateRowMark[this.rownum]<0&&(this.$parent.updateRowMark[this.rownum]=0),this.score=t,this.scoreCache[this.score]||(this.scoreCache[this.score]=1),this.originalScore!=(""==t?null:t)&&this.saveChange()}},computed:{scoreCheckClass(){return this.score!=this.programInfo["subjectScore"+this.ecavp]?"subject-score-diff":""},labelClass(){let e="css-checkbox-primary";""!=this.scoreCheckClass&&(e="css-checkbox-danger");let t=["css-input","css-checkbox","control-label",e];return this.editEcavpVal&&t.push("css-input-disabled"),t},scoreClass:()=>["form-control text-center"],editScore(){return!this.ecavpVal},editEcavpVal(){return!("1"==this.programInfo.isNeedToAudit&&this.programInfo.tbSubject>""&&this.programInfo.baseSubject>"")}},mounted(){this.initEcavp()},methods:{initEcavp(){this.originalScore=this.programInfo["plans"+this.ecavp],this.originalVal=1==this.programInfo["plancs"+this.ecavp],this.ecavpVal=this.originalVal,this.score=this.originalScore},saveChange(){if(this.originalScore==this.score&&this.originalVal==this.ecavpVal)return;if(this.ecavpVal&&""===this.score)return;this.timer&&(clearTimeout(this.timer),this.timer=null);let e=this.programInfo.autoId,t=this.score,a="1",r=this.ecavp,l=this;this.ecavpVal||(a="0",t=""),this.timer=setTimeout(function(){l=this,$.ajax({url:"dgCenter/DgOtherSubjectContacts.updateIdentifiedScore.json",dataType:"json",data:{param1:e,param2:t,param3:r,param4:a},bdolxLoader:!1}).done(function(e){e.success?(l.originalScore=t,l.originalVal=a,OneUI.notifySuccess("保存成功！")):(OneUI.notifyError(e.resultInfo.statusText),l.ecavpVal=l.originalVal,l.score=l.originalScore)}),clearTimeout(this.timer),this.timer=null}.bind(this),1e3)}},template:'<div :class="scoreCheckClass">\t<label :class="labelClass" >\t\t<input type="checkbox" v-model="ecavpVal" :disabled="editEcavpVal">\t\t<span></span>\t</label>\t<div class="has-success">\t\t<div class="form-material">\t\t\t<input :class="scoreClass" type="text" v-model="score" :disabled="editScore">\t\t</div>\t</div></div>'},s={props:{programInfo:Object,rownum:Number,currentValue:String,datas:Array},data(){return{editMan:this.currentValue,editManCach:this.currentValue,timer:null}},watch:{editMan(e){let t;this.programInfo.subjectEditors=e,this.currentValue!=e?this.$parent.updateRowMark[this.rownum]+=1:this.$parent.updateRowMark[this.rownum]-=1,this.$parent.updateRowMark[this.rownum]<0&&(this.$parent.updateRowMark[this.rownum]=0),this.datas.map(function(a){e==a.id&&(t=""==a.value?a.text:a.value)}),this.saveEditMan(this.programInfo.userSubject,t)}},computed:{editManDisabled(){return!this.programInfo.tbSubject||"1"!=this.programInfo.isNeedToAudit||CUR_USERID!=JSON.parse($.sessionStorage("projectManager"))&&void 0!=JSON.parse($.sessionStorage("projectManager"))}},mounted(){},methods:{saveEditMan(e,t){this.editManCach!==this.editMan&&(this.timer&&(clearTimeout(this.timer),this.timer=null),this.timer=setTimeout(function(){let a=this;$.ajax({url:"dgCenter/DgOtherSubjectContacts.updateIdentifiedEditor.json",dataType:"json",data:{param1:a.programInfo.autoId,param2:a.editMan,param3:e,param4:t},bdolxLoader:!1}).done(function(e){e.success?(a.editManCach=a.editMan,OneUI.notifySuccess("保存成功！")):(a.editMan=a.editManCach,OneUI.notifyError(e.resultInfo.statusText))}),clearTimeout(this.timer),this.timer=null}.bind(this),1e3))}},template:'<div class="form-material">\t<select class="form-control" v-model="editMan" style="margin-left:5px" :disabled="editManDisabled">\t\t<option v-for="(data, index) in datas" :value="data.id">{{ data.text }}</option>\t</select></div>'},editNeedAuditCompOther={props:{programInfo:Object,isNeedToAudit:String,rownum:Number},data:()=>({isNeedToAuditVal:!1,originalVal:!1,valCache:{},timer:null}),watch:{isNeedToAuditVal(e){this.programInfo.isNeedToAudit=e?"1":"0",this.originalVal!=e?this.$parent.updateRowMark[this.rownum]+=1:this.$parent.updateRowMark[this.rownum]-=1,this.$parent.updateRowMark[this.rownum]<0&&(this.$parent.updateRowMark[this.rownum]=0),this.originalVal!=this.programInfo.isNeedToAudit&&this.saveChange()}},computed:{checkClass:()=>"",labelClass(){let e="css-checkbox-primary";""!=this.checkClass&&(e="css-checkbox-danger");let t=["css-input","css-checkbox","control-label",e];return this.editIsNeedToAuditVal&&t.push("css-input-disabled"),t},editIsNeedToAuditVal(){return 1!=this.programInfo.isEditable}},mounted(){this.initVal()},methods:{initVal(){this.originalVal=1==this.programInfo.isNeedToAudit,this.isNeedToAuditVal=this.originalVal},saveChange(){if(this.isNeedToAuditVal==this.originalVal)return;let e="0";new Promise((t,a)=>{this.isNeedToAuditVal?(e="0",t({})):bdoConfirmBox("提示","确认不编制该科目?",a=>{if(a){let a=this,r=$("#other_subjectPlanTable").dataTable().fnGetData(a.rownum);0!=r.remain||0!=r.debitTotalOcc||0!=r.creditTotalOcc||0!=r.balance?($("#other_notAuditReasonsModal_autoId").val(r.autoId),$("#other_notAuditReasonsModal_isNeedToAudit").val("0"),$("#other_notAuditReasonsText").val(r.notAuditReasons),$("#other_notAuditReasonsModal").find('button[data-dismiss="modal"]').parent().hide(),$("#other_notAuditReasonsModal").modal("show")):(e="1",t({}))}else e="0",t({})},()=>{e="0",t({})})}).then(e=>{this.timer&&(clearTimeout(this.timer),this.timer=null);let t=this.programInfo.autoId,a="1",r=this;this.isNeedToAuditVal||(a="0"),this.timer=setTimeout(function(){r=this,$.ajax({url:"dgCenter/DgSubjectIdentify.updateIdentifiedNeedAuditOther.json",dataType:"json",data:{param1:t,param2:a},bdolxLoader:!1}).done(function(e){e.success?(r.originalVal=r.isNeedToAuditVal,r.programInfo.isNeedToAudit=r.isNeedToAuditVal,OneUI.notifySuccess("保存成功！"),r.$parent.updateEditAble(r.rownum,"1"===a)):(OneUI.notifyError(e.resultInfo.statusText),r.isNeedToAuditVal=r.originalVal)}),clearTimeout(this.timer),this.timer=null}.bind(this),1e3)})}},template:'<div >\t<label :class="labelClass" >\t\t<input type="checkbox" v-model="isNeedToAuditVal" :disabled="editIsNeedToAuditVal">\t\t<span></span>\t</label></div>'},l={el:"#other_subjectPlanTable tbody",components:{"score-edit":a,"edit-man-edit":s,"edit-need-audit":editNeedAuditCompOther},data:{rowData:[],updateRowMark:[],editMans:[]},methods:{getUpateData(){let e=this,t=[];return $.each(this.updateRowMark,(a,r)=>{r>0&&t.push(e.rowData[a])}),t},reset(){let e=this;$.each(this.$children,(e,t)=>{t.originalVal=1==t.programInfo["cs"+t.ecavp],t.originalScore=t.programInfo["s"+t.ecavp]}),$.each(this.updateRowMark,(t,a)=>{e.updateRowMark[t]=0})},updateEditAble(e,t){t||$.each(this.$children,(t,a)=>{let r=a.$options;"score-edit"==r._componentTag&&r.propsData.rownum==e&&(a.originalScore=0,a.score=0,a.originalVal=!1,a.ecavpVal=!1),"edit-man-edit"==r._componentTag&&r.propsData.rownum==e&&(a.editManCach="",a.editMan="")})}}},t=((e,t)=>{return"<score-edit :ecavp=\"'"+e+'\'" :program-info="rowData['+t+']" :rownum="'+t+'"></score-edit>'}),getEditManEdit=((e,t)=>{return'<edit-man-edit :datas="editMans" :program-info="rowData['+t+']" :rownum="'+t+'" :current-value="\''+e+"'\"></edit-man-edit>"}),getEditNeedAudit=((e,t)=>{return"<edit-need-audit :is-need-to-audit=\"'"+e+'\'" :program-info="rowData['+t+']" :rownum="'+t+'"></edit-need-audit>'});var m=new Page({random:(new Date).getTime()+parseInt(1e3*Math.random()),container:e.region,events:{"#other_filter":"change,onFilterChange","#other_filterEditor":"change,onFilterEditorChange","#other_exchangeSetSubjectors":"click,onExchangeSubjectEditorsClick","#other_checkSubjectPlan":"click,onCheckSubjectPlanClick","#other_editButtonAll":"click,onEditAllClick","#other_resetButtonAll":"click,onResetAllClick","#other_createDgAllButton":"click,createDgAllClick","#other_projectProgram":"click,createProjectProgramClick","#other_searchProjectBtn":"click,selectProjectProgramClick","#other_deleteDgAllButton":"click,deleteDgAllButtonClick","#other_exportAuditProgramPlan":"click,onExportAuditProgramPlanClick","#other_setIdentifiedEcavpRecommendValue":"click,onSetIdentifiedEcavpRecommendValueBtnClick","#editProgramPageTabLink":"shown.bs.tab,OnEditProgramPageTabLinkShownBsOtherTab","#other_insertProjectProgram":"click,onInsertProjectProgramClick","#other_searchResetProjectBtn":"click,onResetProjectProgramClick","#other_addOtherSubject":"click,onAddOtherSubjectClick","#auditProgramView":"click,onAuditProgramViewClick","#otherAuditProgramView":"click,onOtherAuditProgramViewClick","#other_addOtherExitsSubject":"click,onAddOtherExitsSubjectClick","#other_addContractSubjectButton":"click,onAddContractSubjectClick","#other_notAuditReasonsBtn":"click,onOtherNotAuditReasonsBtnClick"},_template:e.template||tplLoader("dgCenter/html/dg/auditProgramPlan.html"),_data:e.data,selectEditors:null,bindEvents(){$("#other_subjectPlanTable").unbind("initEditVm"),$("#other_subjectPlanTable").bind("initEditVm",((e,t)=>{e.preventDefault(),(l=$.extend(!1,{},l)).data.editMans=m.selectEditors,l.data.rowData=$.extend(!1,{},t),l.data.updateRowMark=(()=>{let e=[];for(let a=0,r=t.length;a<r;a++)e.push(0);return e})(),r=new Vue(l)}).bind(this)),$("#other_subjectPlanTable").on("click",'button.table-btn-operate[name="other_createDgSub"]',this.onCreateDgSub),$("#other_subjectPlanTable").on("click",'button.table-btn-operate[name="other_editProgramPlan"]',this.onEditProgramPlan),$("#other_subjectPlanTable").on("click",'button.table-btn-operate[name="other_repeatDgSub"]',this.onRepeatDgSub),$("#other_subjectPlanTable").on("click",'button.table-btn-operate[name="other_contractSubject"]',this.onContractSubject),$('input[name="checkSubjectDataAll"]').off("click"),$('input[name="checkSubjectDataAll"]').on("click",this.onCheckSubjectAll),$('input[name="checkOtherSubjectAll"]').off("click"),$('input[name="checkOtherSubjectAll"]').on("click",this.onCheckOtherSubjectAll),$("#other_subjectPlanTable").on("dblclick","tbody td",this.onOtherEditReasons)},querySetting(){$.ajax({type:"post",url:"dgCenter/MaterialitySetting.queryMater.json",dataType:"json",data:{param1:window.CUR_PROJECTID},success:function(e){if(null!=e.data&&null!=e.data[0].data){var t=e.data[0].data;"1"==t.settingType?$("#other_rateA").val(d(t.settingImportValue1)):"2"==t.settingType?$("#other_rateA").val(d(t.settingImportValue2)):"3"==t.settingType?$("#other_rateA").val(d(t.settingImportValue3)):"4"==t.settingType?$("#other_rateA").val(d(t.settingImportValue4)):"5"==t.settingType?$("#other_rateA").val(d(t.settingImportValue5)):"6"==t.settingType&&$("#other_rateA").val(d(t.settingImportValue6)),$("#other_rateB").val(d(t.finalSettingTypeValue1)),$("#other_rateC").val(d(t.finalSettingTypeValue2))}else $("#other_rateA").val(0),$("#other_rateB").val(0),$("#other_rateC").val(0)}})},queryGroupMembers(){$.ajax({type:"post",url:"dgCenter/DgProject.getProjectMember.json",data:{param1:window.CUR_PROJECTID,param2:window.CUR_CUSTOMERID},dataType:"json",success(e){if(e.success){var t="";m.selectEditors=e.data.map(e=>({id:e.id,text:e.name,value:e.name})),t='<option value="" selected="selected"></option>',$.each(e.data,function(e,a){null!=a.name&&""!=a.id&&(t+='<option value="'+a.id+'" style="color: #000">'+a.name+"</option>")}),$("#other_filterEditor").html(t),$("#other_filterSubjectEditor").html(t)}}})},ECAVP_CONSTS:["E","C","A","V","P"],onSaveECAVPClick(e){if(CUR_USERID!=JSON.parse($.sessionStorage("projectManager"))&&void 0!=JSON.parse($.sessionStorage("projectManager")))bdoInfoBox("","只有当前项目负责人才能编辑科目编制人!");else{let e=r.getUpateData();if(e.length<1)return void bdoInfoBox("","没有修改数据！");let t=!0,a={},l="",s=e.map(e=>($.each(m.ECAVP_CONSTS,(r,s)=>{let o=e["plans"+s],n=e["plancs"+s];!t||1!=n||""!=o&&o&&parseFloat(o).toFixed(2)!=(0).toFixed(2)||(t=!1,a=e,l=s)}),{autoId:e.autoId,projectId:e.projectId,customerId:e.customerId,plansE:e.plansE,plansC:e.plansC,plansA:e.plansA,plansV:e.plansV,plansP:e.plansP,plancsE:e.plancsE,plancsC:e.plancsC,plancsA:e.plancsA,plancsV:e.plancsV,plancsP:e.plancsP,subjectEditors:e.subjectEditors}));if(!t)return void bdoErrorBox("保存失败","TB科目【"+a.tbSubject+"】客户科目【"+a.userSubject+"】的认定（"+l+"）没有设置分值！");$.ajax({type:"post",url:"dgCenter/dgMain.updatePlanScore.json",async:!1,data:{param1:JSON.stringify(s)},dataType:"json",success(e){e.success?($("#other_subjectPlanTable").DataTable().ajax.reload(),r.reset(),bdoSuccessBox("保存成功",e.resultInfo.statusText)):bdoErrorBox("保存失败",e.resultInfo.statusText)}})}},onEditAllClick(e){$("#editButtonAll").blur();var t=$("#other_subjectPlanTable").dataTable().fnGetData($(e.currentTarget).attr("data-row"));let a=[];$.each(t,function(e,r){null!=t[e].userSubject&&""!=t[e].userSubject||a.push(t[e].baseSubject)}),$("#other_auditProgramList").empty(),$.each(a,function(e,t){let r="<label>其他科目：</label><label>"+a[e]+"</label><br/>";$("#other_auditProgramList").append(r)}),$("#other_auditProgramPlanModal").modal("show")},deleteDgAllButtonClick(e){$("#other_auditProgramList").empty()},createDgAllClick(t){var a=$("#other_subjectPlanTable").dataTable().fnGetData($(t.currentTarget).attr("data-row"));let r=[],l=[];function s(){$("#spreadContentDir").trigger("rebuildTree",[{param1:window.CUR_PROJECTID,param2:window.CUR_CUSTOMERID},t=>{$(".js-tree-collapsed").trigger("rebuild",[{data:[t.data[0].treeData],levels:n.deep+1,callback(t){t.expandNode(n.nodeId,{levels:n.deep+1,silent:!0}),t.selectNode(n.nodeId,{silent:!0}),n=e.data=t.getNode(n.nodeId)}}])}]),$("#other_subjectPlanTable").DataTable().ajax.reload(),$("#other_auditProgramPlanModal").modal("hide"),swal.close()}$.each(a,function(e,t){null!=t.userSubject&&""!=t.userSubject&&null!=t.tbSubject&&""!=t.tbSubject&&null!=t.isNeedToAudit&&"1"==t.isNeedToAudit&&l.push(a[e])}),$.each(l,function(e,t){r.push({param1:"002",param2:window.CUR_PROJECTID,param3:window.CUR_CUSTOMERID,param4:l[e].tbSubjectName,param5:l[e].tbSubjectCode,param6:l[e].tbSubjectCode,param9:l[e].autoId,param10:window.CUR_PROJECT_ACC_YEAR})}),bdoInProcessingBox("请稍后，正在批量生成审计程序!");let o=!1;setTimeout(()=>{o||s()},6e4),$.ajax({type:"post",url:"dgCenter/DgMain.createDgTreeAll.json",data:{param14:"yes",param13:JSON.stringify(r)},dataType:"json",bdolxLoader:!1,success:function(e){e.success?(bdoSuccessBox("操作成功",e.resultInfo.statusText),o=!0,s()):bdoErrorBox("操作失败",e.resultInfo.statusText)}})},createProjectProgramClick(e){let t=$("#editProgramPageTabLink").data("rowData");if(t&&t>""&&t.__usubjectEditorUser&&t.__usubjectEditorUser.userId==sys_userId)return;let a=!0;$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",async:!1,data:{menuId:window.sys_menuId,sqlId:"DG00197",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,start:-1,limit:-1},dataType:"json",success(e){e.success&&CUR_USERID!=e.data[0].manager&&(bdoErrorBox("","无权限！"),a=!1)}}),$("#other_auditProgramPlanModal").modal("hide"),m.other_searchProjectForm.jsonData={other_s_customerId:"",other_s_projectId:"",other_s_customerSubjectId:""},m.selectProjectProgramSider.show(),m.selectProjectProgramTableCfg.localParam.urlparam=m.getDefaultFilter(),m.selectProjectProgramTableCfg.localParam.urlparam.param11=window.CUR_CUSTOMERID,m.selectProjectProgramTableCfg.localParam.urlparam.param12=window.CUR_PROJECTID,m.selectProjectProgramTableCfg.localParam.urlparam.param13=window.CUR_CUSTOMERID,m.selectProjectProgramTableCfg.localParam.urlparam.param14=window.CUR_PROJECTID,$("#other_s_customerId").val("").select2({allowClear:!0,language:"zh-CN",width:"100%",placeholder:"请选择"}),$("#other_s_projectId").val("").select2({allowClear:!0,language:"zh-CN",width:"100%",placeholder:"请选择"}),$("#other_s_customerId").val("").trigger("change"),$("#other_s_projectId").val("").trigger("change"),$("#other_s_customerSubjectId").val(""),$.ajax({type:"post",url:"cpBase/Combo.getCustomerList.json",data:{page:-1,start:-1},dataType:"json",async:!1,success:function(e){let t=e.data;$("#other_s_customerId").empty(),$("#other_s_customerId").append($("<option>",{value:"",text:""})),$.each(t,function(e,t){$("#other_s_customerId").append($("<option>",{value:t.value,text:t.label}))})}}),$("#other_s_customerId").change(function(){$.ajax({type:"post",url:"cpBase/Combo.getCustomerProjectList.json",data:{param1:$("#other_s_customerId option:selected").val(),page:-1,start:-1},dataType:"json",async:!1,success:function(e){$("#other_s_projectId").empty(),$.each(e.data,function(e,t){$("#other_s_projectId").append($("<option>",{value:t.value,text:t.label}))})}})}),a&&(BdoDataTable("other_selectProjectProgramTable",m.selectProjectProgramTableCfg),c(),uiBlocksApi($(".block .block-themed .block-opt-hidden"),"content_toggle"))},selectProjectProgramClick(e){m.selectProjectProgramTableCfg.localParam.urlparam=m.getDefaultFilter(),null==$("#other_s_customerId option:checked").val()||""==$("#other_s_customerId option:checked").val()?m.selectProjectProgramTableCfg.localParam.urlparam.param11=window.CUR_CUSTOMERID:m.selectProjectProgramTableCfg.localParam.urlparam.param11=$("#other_s_customerId option:checked").val(),null==$("#other_s_projectId option:checked").val()||""==$("#other_s_projectId option:checked").val()?m.selectProjectProgramTableCfg.localParam.urlparam.param12=window.CUR_PROJECTID:m.selectProjectProgramTableCfg.localParam.urlparam.param12=$("#other_s_projectId option:checked").val(),m.selectProjectProgramTableCfg.localParam.urlparam.param13=window.CUR_CUSTOMERID,m.selectProjectProgramTableCfg.localParam.urlparam.param14=window.CUR_PROJECTID,m.selectProjectProgramTableCfg.localParam.urlparam.param15=$("#other_s_customerSubjectId").val(),$("#other_selectProjectProgramTable").DataTable().ajax.reload(),c()},onResetProjectProgramClick(e){$("#other_s_customerId").val("").select2({allowClear:!0,language:"zh-CN",width:"100%",placeholder:"请选择"}),$("#other_s_projectId").val("").select2({allowClear:!0,language:"zh-CN",width:"100%",placeholder:"请选择"}),$("#other_s_customerId").val("").trigger("change"),$("#other_s_projectId").val("").trigger("change"),$("#other_s_customerSubjectId").val(""),m.selectProjectProgramTableCfg.localParam.urlparam=m.getDefaultFilter(),m.selectProjectProgramTableCfg.localParam.urlparam.param11=window.CUR_CUSTOMERID,m.selectProjectProgramTableCfg.localParam.urlparam.param12=window.CUR_PROJECTID,m.selectProjectProgramTableCfg.localParam.urlparam.param13=window.CUR_CUSTOMERID,m.selectProjectProgramTableCfg.localParam.urlparam.param14=window.CUR_PROJECTID,m.selectProjectProgramTableCfg.localParam.urlparam.param15=$("#other_s_customerSubjectId").val(),$("#other_selectProjectProgramTable").DataTable().ajax.reload(),c()},onInsertProjectProgramClick(e){let t=$("#other_selectProjectProgramTable").dataTable().fnGetData($(e.currentTarget).attr("data-row")),a=[],r=[];if(0==t.length)return bdoInfoBox("提示","请先选择一个有审计程序的项目!"),!1;$.each(t,function(e,l){null!=t[e].userSubjectId&&""!=t[e].userSubjectId&&t[e].subjectId===t[e].userSubjectId?a.push(t[e]):r.push(t[e])}),0!=r.length?bdoConfirmBox("提示","当前客户科目编号为空不会生成审计程序，科目编号不一致的需要手动生成审计程序，是否继续进行操作?",e=>{m.selectProjectProgramSider.hide(),u(n)}):(m.selectProjectProgramSider.hide(),u(n))},onResetAllClick(t){$("#resetButtonAll").blur(),bdoConfirmBox("提示","重置后会删除所有已生成的审计程序，是否继续重置？",a=>{var r=$("#other_subjectPlanTable").dataTable().fnGetData($(t.currentTarget).attr("data-row"));let l=[];function s(){$("#spreadContentDir").trigger("rebuildTree",[{param1:window.CUR_PROJECTID,param2:window.CUR_CUSTOMERID},t=>{$(".js-tree-collapsed").trigger("rebuild",[{data:[t.data[0].treeData],levels:n.deep+1,callback(t){t.expandNode(n.nodeId,{levels:n.deep+1,silent:!0}),t.selectNode(n.nodeId,{silent:!0}),n=e.data=t.getNode(n.nodeId)}}])}]),swal.close()}$.each(r,function(e,t){let a=r[e].userSubject;a=a.substr(0,a.indexOf("-")),l.push({param1:"002",param2:window.CUR_PROJECTID,param3:window.CUR_CUSTOMERID,param4:window.CUR_PROJECT_ACC_YEAR,param5:r[e].tbSubjectName,param6:r[e].tbSubjectCode,param9:a})}),bdoInProcessingBox("请稍后，正在批量重置审计程序!");let o=!1;setTimeout(()=>{!0===o||s()},6e4),(!l||l.length<1)&&bdoErrorBox("操作失败","没有数据，不需重置。"),$.ajax({type:"post",url:"dgCenter/DgMain.resetAuditProduresAll.json",data:{param13:JSON.stringify(l)},dataType:"json",bdolxLoader:!1,success:function(e){e.success?(bdoSuccessBox("操作成功",e.resultInfo.statusText),$("#other_subjectPlanTable").DataTable().ajax.reload(),o=!0,s()):bdoErrorBox("操作失败",e.resultInfo.statusText)}})})},onFilterChange(e){switch($("#other_filter").val()){case"all":m.auditProgramTableCfg.localParam.urlparam.param5=1,m.auditProgramTableCfg.localParam.urlparam.param6=null,m.auditProgramTableCfg.localParam.urlparam.param7=null;break;case"std":m.auditProgramTableCfg.localParam.urlparam.param6=1,m.auditProgramTableCfg.localParam.urlparam.param5=null,m.auditProgramTableCfg.localParam.urlparam.param7=null;break;case"sub":m.auditProgramTableCfg.localParam.urlparam.param7=1,m.auditProgramTableCfg.localParam.urlparam.param5=null,m.auditProgramTableCfg.localParam.urlparam.param6=null}$("#other_subjectPlanTable").DataTable().ajax.reload()},onFilterEditorChange(e){var t=$("#other_filterEditor option:selected").val();m.auditProgramTableCfg.localParam.urlparam.param10=t,$("#other_subjectPlanTable").DataTable().ajax.reload()},onExchangeSubjectEditorsClick(e){CUR_USERID==JSON.parse($.sessionStorage("projectManager"))||void 0==JSON.parse($.sessionStorage("projectManager"))?($('input[name="checkSubjectDataAll"]').prop("checked",!1),this.queryGroupMembers(),$("#other_selectSubjectUpdateEditor").modal("show"),$("#other_selectSubjectPlanTable").DataTable().ajax.reload()):bdoInfoBox("提示","只有当前项目负责人才能挑选科目!")},onCheckSubjectPlanClick(e){let t=$("#other_filterSubjectEditor option:selected").val(),a=$("#other_filterSubjectEditor option:selected").text(),r=[];$.each($('input[name="checkSubjectData"]:checkbox'),function(){this.checked&&r.push($(this).val())}),""!=t&&null!=t?r.length<1?bdoInfoBox("提示","请至少选择一项科目!"):$.ajax({type:"post",url:"dgCenter/DgMain.updateSubjectEditors.json",dataType:"json",data:{param1:t,param2:JSON.stringify(r),param3:a,param10:"yes"},success:function(e){e.success?(bdoSuccessBox("提示","修改科目编制人成功"),$("#other_selectSubjectPlanTable").DataTable().ajax.reload(),$("#other_subjectPlanTable").DataTable().ajax.reload()):bdoErrorBox("提示",e.resultInfo.statusText),$('input[name="checkSubjectDataAll"]').prop("checked",!1)}}):bdoInfoBox("提示","请选择科目编制人!")},onAddOtherSubjectClick(){console.log("enter the onAddOtherSubjectClick"),$("#chooseDifferentAuditModal").find("h3.block-title").text("新增其他科目(选择标准科目或者自定义科目)"),$("#otherSubjectId").val(""),$("#chooseDifferentAuditModal").modal("show")},onAuditProgramViewClick(){console.log("enter the onAuditProgramViewClick"),$("#chooseDifferentAuditModal").modal("hide"),$("#other_addOtherExitsSubjectTableModal").modal("show"),$("#other_addOtherExitsSubjectTable").DataTable().ajax.reload(),$("#other_addOtherExitsSubjectTableModal").find("h3.block-title").text("新增其他科目(标准科目)"),$("#saveOtherSubjectBtn").text("保存")},onOtherAuditProgramViewClick(){console.log("enter the onOtherAuditProgramViewClick"),this.addOtherSubjectForm=createForm(this.addOtherSubjectFormCfg),$("#chooseDifferentAuditModal").modal("hide"),$("#addOtherSubjectModal").modal("show"),$("#index").attr("disabled","disabled"),$("#index").val("99"),$("#addOtherSubjectModal").find("h3.block-title").text("新增其他科目(自定义科目)"),$("#saveOtherSubjectBtn").text("保存")},onAddOtherExitsSubjectClick(e){console.log("enter the onAddOtherExitsSubjectClick");let t=[];$.each($('input[name="checkOtherSubject"]:checkbox'),function(){this.checked&&t.push($(this).val())}),t.length<1?bdoInfoBox("提示","请至少选择一项科目!"):$.ajax({type:"post",url:"dgCenter/DgOtherSubjectContacts.addBatchOtherSubjectContacts.json",data:{param1:window.CUR_PROJECTID,param2:window.CUR_CUSTOMERID,param3:JSON.stringify(t),param4:window.CUR_PROJECT_ACC_YEAR},dataType:"json",success:function(e){e.success?(bdoSuccessBox("成功",e.resultInfo.statusText),$("#other_subjectPlanTable").DataTable().draw(!1),$("#other_addOtherExitsSubjectTableModal").modal("hide")):bdoErrorBox("失败",e.resultInfo.statusText),$('input[name="checkOtherSubjectAll"]').prop("checked",!1)}})},onAddContractSubjectClick(){console.log("enter the onAddContractSubjectClick");let e=$("#otherSubjectId").attr("data-result"),t=$("#otherSubjectId").val();if(!e||!t)return void bdoInfoBox("提示","请至少选择一项其他科目!");let a=m.contractSubjectRowData;$.ajax({type:"post",url:"dgCenter/DgOtherSubjectContacts.addContractSubjectForOther.json",data:{param1:window.CUR_PROJECTID,param2:window.CUR_CUSTOMERID,param3:e,param4:t,param5:window.CUR_PROJECT_ACC_YEAR,param6:a.autoId},dataType:"json",success:function(e){e.success?(bdoSuccessBox("成功",e.resultInfo.statusText),$("#other_subjectPlanTable").DataTable().draw(!1),$("#addContractSubjectModal").modal("hide")):bdoErrorBox("失败",e.resultInfo.statusText)}})},onOtherNotAuditReasonsBtnClick(e){var t=$("#other_notAuditReasonsText").val(),a=$("#other_notAuditReasonsModal_isNeedToAudit").val();"true"==a&&(a="1"),"1"==a||""!=t?$.ajax({url:"dgCenter/DgSubjectIdentify.updateIdentifiedReasonsOther.json",dataType:"json",data:{param1:$("#other_notAuditReasonsModal_autoId").val(),param2:t,param3:a},bdolxLoader:!1,success(e){e.success?($("#other_subjectPlanTable").DataTable().draw(!1),$("#other_notAuditReasonsModal").modal("hide"),OneUI.notifySuccess("保存成功！")):($("#other_subjectPlanTable").DataTable().draw(!1),$("#other_notAuditReasonsModal").modal("hide"),bdoErrorBox("失败",e.resultInfo.statusText))}}):bdoInfoBox("提示","请填写不编制理由！")},exportAPPlanToDg(){let t=this.auditProgramTableCfg,a=getColumnsInfo(t.tableParam.columnDefs),r=applyIf({},t.localParam.urlparam);delete r.sort,r.page="",r.start="",r.limit="",r.queryUrl=t.localParam.url,r.columnMap=a,r=JSON.stringify(r);let l=encodeURI("计划控制表"),s={menuId:window.sys_menuId,param1:r,title:l};$.ajax({url:"dgCenter/ExportOtherDg.exportAPPlanTbl.json",data:s,type:"post",dataType:"json",success:function(t){if(t.success){if(t.data&&t.data.length>0){let a=t.data[0].fileData,r=t.data[0].fileName;t.data[0].isNew;bdoInfoBox("成功",r+"导出成功！"),saveAs(dataURLtoFile(a,r),r),getSubjecttree({param1:window.CUR_PROJECTID,param2:$("#onlyMyselfCheckBox").get(0).checked?"1":""},t=>{$(".js-tree-collapsed").trigger("rebuild",[{data:[t.data[0].treeData],levels:e.data.deep+2,callback(t){t.expandNode(e.data.nodeId,{levels:e.data.deep+2,silent:!0}),t.selectNode(e.data.nodeId,{silent:!0}),e.data=t.getNode(e.data.nodeId)}}])})}}else bdoErrorBox("失败",t.resultInfo.statusText)}})},onExportAuditProgramPlanClick(e){m.exportAPPlanToDg()},onSetIdentifiedEcavpRecommendValueBtnClick(e){$("#setIdentifiedEcavpRecommendValue").blur(),$.ajax({type:"post",url:"dgCenter/DgEcavp.setSubjectIdentifiedEcavpRecommendValue.json",dataType:"json",data:{param10:"yes"},success:function(e){e.success?($("#other_subjectPlanTable").DataTable().ajax.reload(),bdoSuccessBox("成功","科目认定分值设置成功！")):bdoErrorBox("失败",e.resultInfo.statusText)}})},init(t){$("#other_subjectIndex").text("【"+e.data.extraOptions.indexId+"】"),this.queryGroupMembers(),BdoDataTable("other_subjectPlanTable",this.auditProgramTableCfg),BdoDataTable("other_selectSubjectPlanTable",this.selectSubjectPlanTableCfg),BdoDataTable("other_addOtherExitsSubjectTable",this.addOtherExitsSubjectTableCfg),this.bindEvents(),OneUI.initHelper("slimscroll"),this.querySetting(),this.selectProjectProgramSider=side({el:"#other_selectProjectProgramSider",autoHide:!1}),this.other_searchProjectForm=createForm(this.other_searchProjectFormCfg)},addContractSubjectForm:null,contractSubjectRowData:null,addContractSubjectFormCfg:{options:{propsData:{jsonData:{newSunbjectName:""}}},watch:{},props:{jsonData:Object},display:"tableform-one",column:12,id:"addContractSubjectForm",data:()=>({}),methods:{},items:[{id:"otherSubjectId",type:"treecombo",label:"其他科目",rowspan:1,colspan:6,validate:{rules:{required:!0}},plugin:{name:"treecombo",options:{url:"./cpBase/TreeCommon.findSubjectTree.json",params:{param10:"1"},view:{leafIcon:"fa fa-building text-flat",nodeIcon:"fa fa-bank text-primary-light",folderSelectable:!0,multiSelect:!1,positionValue:"initial"},nodeSelectedCallback(e,t){}}}}],methods:{onSaveOtherSubjectClick(){if(console.log("enter the onSaveOtherSubjectClick"),!this.$form.valid())return;let e=$("#index").val()+$("#userIndex").val(),t=this.jsonData.newSunbjectName;$.ajax({type:"post",url:"dgCenter/DgOtherSubjectContacts.addOtherSubjectContacts.json",data:{param1:window.CUR_PROJECTID,param2:window.CUR_CUSTOMERID,param3:e,param4:t,param5:window.CUR_PROJECT_ACC_YEAR},dataType:"json",success:function(e){e.success?(bdoSuccessBox("成功",e.resultInfo.statusText),$("#other_subjectPlanTable").DataTable().draw(!1),$("#addOtherSubjectModal").modal("hide")):bdoErrorBox("失败",e.resultInfo.statusText)}})}}},addOtherSubjectForm:null,addOtherExitsSubjectTableCfg:{localParam:{url:"dgCenter/DgGeneral.query.json",urlparam:{menuId:window.sys_menuId,sqlId:"DG00354"},tabNum:!0},tableParam:{scrollX:!0,select:!1,ordering:!1,serverSide:!0,autoWidth:!1,fixedThead:!0,lengthChange:!1,paging:!1,fixedHeight:"480px",columnDefs:[{targets:1,orderable:!1,className:"text-center",width:"50px",title:'<label class="css-input css-checkbox css-checkbox-primary"><input type="checkbox" name="checkOtherSubjectAll"/><span></span></label>',render(e,t,a,r){let l="";return null!=a.subjectId&&""!=a.subjectId&&(l='<label class="css-input css-checkbox css-checkbox-primary"><input type="checkbox" name="checkOtherSubject" value="'+a.autoId+'"/><span></span></label>'),l}},{targets:2,title:"其他科目编号",name:"subjectId",data:"subjectId",className:"text-left",width:"100px"},{targets:3,title:"其他科目名称",name:"subjectName",data:"subjectName",className:"text-left",width:"100px"}]}},addOtherSubjectFormCfg:{options:{propsData:{jsonData:{newSunbjectName:""}}},watch:{},props:{jsonData:Object},display:"tableform-one",column:12,id:"addOtherSubjectForm",data:()=>({}),methods:{},items:[{id:"newSunbjectName",type:"input",label:"自定义科目名称",rowspan:1,colspan:12,typeAttr:{":data-value":"jsonData.newSunbjectName","v-model":"jsonData.newSunbjectName"},validate:{rules:{required:!0}}},{id:"indexId",html:'<div class="form-material has-success input-group"><input maxlength="2" style="box-shadow: rgb(70, 195, 123) 0px 1px 0px;" required="required" onblur="if(this.value.length==0){return;}else{var v=this.value;while(v.length<2){v=0+v;}this.value=v;}" class="form-control" id="index" placeholder=""oninput="this.value=this.value.replace(/[^0-9]/ig,\'\')"/><span class="input-group-addon">-</span><input maxlength="2" style="box-shadow: rgb(70, 195, 123) 0px 1px 0px;" required="required" onblur="if(this.value.length==0){return;}else{var v=this.value;while(v.length<2){v=0+v;}this.value=v;}" class="form-control" id="userIndex" placeholder="自定义科目编号"oninput="this.value=this.value.replace(/[^0-9]/ig,\'\')"/><label style="color:rgb(70, 195, 123)">科目编号</label></div>',colspan:1,rowspan:1,validate:{rules:{required:!0}}},{id:"saveOtherSubjectBtn",type:"button",rowspan:1,colspan:12,typeAttr:{"v-on:click":"onSaveOtherSubjectClick",style:"float: right;margin-top: -10px;color: #fff; background-color: #5c90d2; border-color: #3675c5;border-radius: 2px;"}}],methods:{onSaveOtherSubjectClick(){if(console.log("enter the onSaveOtherSubjectClick"),!this.$form.valid())return;let e=$("#index").val()+$("#userIndex").val(),t=this.jsonData.newSunbjectName;if(/[~!@#$%^&*\\|,.<>?"'();:_+\-=\[\]{}\/]/.test(t))return bdoInfoBox("提示","科目名称不能包含特殊字符!<br/>~!@#$%^&*|,.<>?\"'();:_+-=[]{}/!"),!1;$.ajax({type:"post",url:"dgCenter/DgOtherSubjectContacts.addOtherSubjectContacts.json",data:{param1:window.CUR_PROJECTID,param2:window.CUR_CUSTOMERID,param3:e,param4:t,param5:window.CUR_PROJECT_ACC_YEAR},dataType:"json",success:function(e){e.success?(bdoSuccessBox("成功",e.resultInfo.statusText),$("#other_subjectPlanTable").DataTable().draw(!1),$("#addOtherSubjectModal").modal("hide")):bdoErrorBox("失败",e.resultInfo.statusText)}})}}},other_searchProjectFormCfg:{options:{propsData:{jsonData:{other_s_customerId:"",other_s_projectId:"",other_s_customerSubjectName:""}}},props:{jsonData:Object},display:"tableform-one",column:4,id:"other_searchProjectForm",data:()=>({ajaxConfig:{type:"POST",url:"",dataType:"json",success(e){}}}),items:[{id:"other_s_customerId",label:"客户名称",colspan:1,rowspan:1,type:"select",html:""},{id:"other_s_projectId",label:"项目名称",colspan:1,type:"select",html:""},{id:"other_s_customerSubjectId",type:"input",label:"科目编号",colspan:1}]},other_searchProjectForm:null,selectProjectProgramSider:null,selectProjectProgramTable:null,selectProjectProgramTableCfg:{localParam:{url:"dgCenter/DgGeneral.query.json",urlparam:{menuId:window.sys_menuId,sqlId:"",start:-1,limit:-1},tabNum:!0},tableParam:{scrollX:!0,select:!0,order:[2,"asc"],pageLength:30,createdRow(e,t,a){$(e).attr("dataIndex",a)},serverSide:!0,columnDefs:[{targets:1,orderable:!0,title:"项目名称",name:"projectName",data:"projectName",width:"200px"},{targets:2,orderable:!0,title:"所选项目科目编号",name:"subjectId",data:"subjectId",className:"text-center",width:"80px"},{targets:3,orderable:!0,title:"所选项目科目名称",name:"subjectName",data:"subjectName",className:"text-center",width:"100px"},{targets:4,orderable:!0,title:"基本科目编号",name:"baseSubjectId",data:"baseSubjectId",className:"text-center",width:"80px",render(e,t,a,r){var l=a.subjectId,s=a.baseSubjectId;return null!=s&&""!=s&&l!=s?'<label style="background-color: red;color: white">'+a.baseSubjectId+"</label>":a.baseSubjectId}},{targets:5,orderable:!0,title:"基本科目名称",name:"baseSubjectName",data:"baseSubjectName",className:"text-center",width:"100px"},{targets:6,orderable:!0,title:"索引号",name:"indexId",data:"indexId",className:"text-center",width:"100px"},{targets:7,orderable:!0,title:"程序名称",className:"text-center",name:"dgName",data:"dgName",width:"150px"},{targets:8,orderable:!0,title:"创建人",className:"text-center",name:"CREATED_BY",data:"CREATED_BY",width:"40px",render:(e,t,a,r)=>a.__ucreateUser.userName}]}},getDefaultFilter:()=>({menuId:window.sys_menuId,sqlId:"DG01015",start:-1,limit:-1}),auditProgramTable:null,bgColerMap:{},onEditProgramPlan(e){var t=$("#other_subjectPlanTable").dataTable().fnGetData($(e.currentTarget).attr("data-row"));if($.sessionStorage("subjectEditors",t.subjectEditors),!t.baseSubjectId)return void bdoInfoBox("操作失败","没有对照标准科目,无法编辑！");let a;searchSubjecttreeNode(JSON.parse($.sessionStorage("subjecttree")),function(e){"SUBJECT"==e.extraOptions.nodeType&&e.extraOptions.userSubjectId==t.userSubjectId&&((a=e).workpaperId=a.extraOptions.workpaperId,a.currentNode=$.extend(!1,{},e),a.currentNode.currentNode=null)}),void 0==a||null==a?bdoInfoBox("提示","请先生成审计程序"):$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",data:{menuId:window.sys_menuId,sqlId:"DG00350",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:t.autoId},dataType:"json",success:function(e){let r=!1;e.success&&e.data&&e.data.length>0&&e.data[0].programCount>0&&(r=!0,m.editProgramPageNodeData=a,t.userSubject=t.baseSubject,m.editProgramPageNodeData.tbRowData=t,$("#editProgramPageTabLink").data("rowData",t),$("#editProgramPageTabLink").tab("show")),r||bdoInfoBox("","没有审计程序，请先生成审计程序！",1e3)}})},editProgramPageNodeData:{},OnEditProgramPageTabLinkShownBsOtherTab(e){let t=$("#editProgramPageTabLink").data("rowData");if(t&&t>""&&t.__usubjectEditorUser&&t.__usubjectEditorUser.userId==sys_userId)return m.editProgramPageNodeData.pageType="otherSubject",void EditProgramPage({region:"#editProgramPageTab",data:m.editProgramPageNodeData});t&&(t.pageType="otherSubject"),$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",async:!1,data:{menuId:window.sys_menuId,sqlId:"DG00197",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,start:-1,limit:-1},dataType:"json",success(e){if(e.success){let t=$("#editProgramPageTabLink").data("rowData");CUR_USERID==e.data[0].manager||t.subjectEditors==sys_userId?EditProgramPage({region:"#editProgramPageTab",data:m.editProgramPageNodeData}):bdoErrorBox("","无权限！")}}})},onCreateDgSub(t){var a=$("#other_subjectPlanTable").dataTable().fnGetData($(t.currentTarget).attr("data-row"));a.baseSubjectId?$.ajax({type:"post",url:"dgCenter/dgMain.createDgTree.json",data:{param1:"002",param2:window.CUR_PROJECTID,param3:window.CUR_CUSTOMERID,param4:a.tbSubjectName,param5:a.tbSubjectCode,param6:a.tbSubjectCode,param9:a.autoId,param10:"yes",param11:a.userSubjectId,refreshFlg:1},dataType:"json",success:function(t){t.success?(bdoSuccessBox("操作成功",t.resultInfo.statusText),$("#spreadContentDir").trigger("rebuildTree",[{param1:window.CUR_PROJECTID,param2:window.CUR_CUSTOMERID},t=>{$(".js-tree-collapsed").trigger("rebuild",[{data:[t.data[0].treeData],levels:n.deep+1,callback(t){t.expandNode(n.nodeId,{levels:n.deep+1,silent:!0}),t.selectNode(n.nodeId,{silent:!0}),n=e.data=t.getNode(n.nodeId)}}])}])):bdoErrorBox("操作失败",t.resultInfo.statusText)}}):bdoInfoBox("操作失败","请先添加对照关系！")},onRepeatDgSub(t){let a=$("#other_subjectPlanTable").dataTable().fnGetData($(t.currentTarget).attr("data-row"));a.baseSubjectId?bdoConfirmBox("提示","重置会删除原来的审计程序，确定重置吗？",t=>{let r=a.userSubject;r=r.substr(0,r.indexOf("-")),$.ajax({type:"post",url:"dgCenter/dgMain.resetAuditProdures.json",data:{param1:"002",param2:window.CUR_PROJECTID,param3:window.CUR_CUSTOMERID,param4:window.CUR_PROJECT_ACC_YEAR,param5:a.tbSubjectName,param6:a.tbSubjectCode,param9:r,param10:a.autoId,param11:"yes"},dataType:"json",success:function(t){t.success?(bdoSuccessBox("操作成功",t.resultInfo.statusText),$("#other_subjectPlanTable").DataTable().ajax.reload(),$("#spreadContentDir").trigger("rebuildTree",[{param1:window.CUR_PROJECTID,param2:window.CUR_CUSTOMERID},t=>{$(".js-tree-collapsed").trigger("rebuild",[{data:[t.data[0].treeData],levels:n.deep+1,callback(t){t.expandNode(n.nodeId,{levels:n.deep+1,silent:!0}),t.selectNode(n.nodeId,{silent:!0}),n=e.data=t.getNode(n.nodeId)}}])}])):bdoErrorBox("操作失败",t.resultInfo.statusText)}})}):bdoInfoBox("操作失败","没有对照标准科目,不需要重置！")},onContractSubject(e){let t=$("#other_subjectPlanTable").dataTable().fnGetData($(e.currentTarget).attr("data-row"));$("#addContractSubjectModal").find("h3.block-title").text("选择其他科目进行对照"),m.addContractSubjectForm=createForm(m.addContractSubjectFormCfg),m.contractSubjectRowData=t,$("#addContractSubjectModal").modal("show")},onCheckSubjectAll(e){1==$('input[name="checkSubjectDataAll"]').is(":checked")?$("input[name='checkSubjectData']").each(function(){this.checked=!0}):($('input[name="checkSubjectDataAll"]').prop("checked",!1),$("input[name='checkSubjectData']").each(function(){this.checked=!1}))},onCheckOtherSubjectAll(e){1==$('input[name="checkOtherSubjectAll"]').is(":checked")?$("input[name='checkOtherSubject']").each(function(){this.checked=!0}):($('input[name="checkOtherSubjectAll"]').prop("checked",!1),$("input[name='checkOtherSubject']").each(function(){this.checked=!1}))},onOtherEditReasons(e){if("notAuditReasons"===$("#other_subjectPlanTable").DataTable().context[0].aoColumns[$(this).index()].name){var t=$("#other_subjectPlanTable").DataTable().data()[$(this).closest("tr").index()];if("1"==t.isNeedToAudit){if(null==t.notAuditReasons||""==t.notAuditReasons)return;$("#other_notAuditReasonsModal_isNeedToAudit").val(t.isNeedToAudit)}$("#other_notAuditReasonsText").val(t.notAuditReasons),$("#other_notAuditReasonsModal_autoId").val(t.autoId),$("#other_notAuditReasonsModal").find('button[data-dismiss="modal"]').parent().show(),$("#other_notAuditReasonsModal").modal("show")}},selectSubjectPlanTableCfg:{localParam:{url:"dgCenter/DgGeneral.query.json",urlparam:{menuId:window.sys_menuId,sqlId:"DG00351",param1:n.extraOptions.customerId,param2:n.extraOptions.projectId,param3:window.CUR_PROJECT_ACC_YEAR},tabNum:!0},tableParam:{scrollX:!0,select:!1,ordering:!1,serverSide:!0,autoWidth:!1,fixedThead:!0,lengthChange:!1,paging:!1,fixedHeight:"480px",columnDefs:[{targets:1,orderable:!1,className:"text-center",width:"50px",title:'<label class="css-input css-checkbox css-checkbox-primary"><input type="checkbox" name="checkSubjectDataAll"/><span></span></label>',render(e,t,a,r){let l="";return null!=a.tbSubject&&""!=a.tbSubject&&(l='<label class="css-input css-checkbox css-checkbox-primary"><input type="checkbox" name="checkSubjectData" value="'+a.autoId+'"/><span></span></label>'),l}},{targets:2,title:"TB科目",name:"tbSubject",data:"tbSubject",className:"text-left",width:"100px"},{targets:3,title:"其他科目",name:"baseSubject",data:"baseSubject",className:"text-left",width:"100px"},{targets:4,title:"科目编制人",name:"__usubjectEditorUser",data:"__usubjectEditorUser",className:"text-center",width:"80px",render:(e,t,a,r)=>e?e.userName:""}]}},auditProgramTableCfg:{localParam:{url:"dgCenter/DgGeneral.query.json",urlparam:{menuId:window.sys_menuId,sqlId:"DG00349",param1:n.extraOptions.customerId,param2:n.extraOptions.projectId,param3:window.CUR_PROJECT_ACC_YEAR,param10:$("#other_filterEditor option:selected").val()},tabNum:!0},tableParam:{scrollX:!0,select:!1,ordering:!1,serverSide:!0,autoWidth:!1,fixedThead:!0,fixedHeight:"480px",drawCallback(e){$("#other_subjectPlanTable tbody").replaceWith(e.nTBody);var t=this.fnGetData();$("#other_subjectPlanTable").trigger("initEditVm",[t])},preDrawCallback(e){r&&r.$destroy()},columnDefs:[{targets:(()=>(cnt=0,++cnt))(),orderable:!1,className:"text-center",title:"处理",data:null,width:"100px",render(e,t,a,r){var l="";return l+='<div class="">',l+='<button class="btn btn-xs btn-info table-btn-operate bdo-drop-btn" type="button" name="other_createDgSub" data-placement="top" title="生成审计程序" data-toggle="tooltip" data-row="'+r.row+'">\t<i class="fa fa-send"></i>\t</button>',l+='<button class="btn btn-xs btn-info table-btn-operate bdo-drop-btn" type="button" name="other_editProgramPlan" data-placement="top" title="编辑审计程序" data-toggle="tooltip" data-row="'+r.row+'">\t<i class="fa fa-edit"></i>\t</button>',l+='<button class="btn btn-xs btn-danger table-btn-operate bdo-drop-btn" type="button" name="other_repeatDgSub" data-placement="top" title="重置审计程序" data-toggle="tooltip" data-row="'+r.row+'">\t<i class="fa fa-power-off"></i>\t</button>',l+='<button class="btn btn-xs btn-info table-btn-operate bdo-drop-btn" type="button" name="other_contractSubject" data-placement="top" title="科目对照" data-toggle="tooltip" data-row="'+r.row+'">\t<i class="fa fa-indent"></i>\t</button>',l+="</div>"}},{targets:++cnt,orderable:!0,title:"TB科目名称",name:"tbSubjectName",data:"tbSubjectName",width:"90px",className:"hidden"},{targets:++cnt,orderable:!0,title:"TB科目",name:"tbSubject",data:"tbSubject",width:"90px",className:"text-left"},{targets:++cnt,orderable:!0,title:"其他科目",name:"userSubject",data:"userSubject",width:"90px",className:"text-left"},{targets:++cnt,orderable:!0,title:"标准科目",name:"baseSubject",data:"baseSubject",width:"90px",className:"text-left"},{targets:++cnt,title:"E",name:"E",data:"plancsE",width:"30px",className:"text-center",render:(e,a,r,l)=>t("E",l.row)},{targets:++cnt,title:"C",name:"C",data:"plancsC",width:"30px",className:"text-center",render:(e,a,r,l)=>t("C",l.row)},{targets:++cnt,title:"A",name:"A",data:"plancsA",width:"30px",className:"text-center",render:(e,a,r,l)=>t("A",l.row)},{targets:++cnt,title:"V",name:"V",data:"plancsV",width:"30px",className:"text-center",render:(e,a,r,l)=>t("V",l.row)},{targets:++cnt,title:"P",name:"P",data:"plancsP",width:"30px",className:"text-center",render:(e,a,r,l)=>t("P",l.row)},{targets:++cnt,title:"科目编制人",name:"科目编制人",data:"subjectEditors",width:"120px",className:"text-center",render:(e,t,a,r)=>getEditManEdit(e,r.row)},{targets:++cnt,title:"是否编制",name:"isNeedToAudit",data:"isNeedToAudit",width:"50px",className:"text-center",render:(e,t,a,r)=>getEditNeedAudit(e,r.row)},{targets:++cnt,orderable:!0,title:"不编制理由",name:"notAuditReasons",data:"notAuditReasons",width:"120px",className:"text-left"}]}}});return m}var SubjectPagePlan=e=>{var t,a;t=e.template||tplLoader("dgCenter/html/dg/subjectPlan.html"),e.template=t,a=(()=>{$('#subPageRight [data-toggle="tabs"] a, .js-tabs a').on("show.bs.tab",function(t){var a=t.target.href,r=a.lastIndexOf("#");switch(a.substring(r+1)){case"guidePageTab":break;case"auditProgramPageTab":AuditProgramPagePlan({region:"#auditProgramPageTab",data:e.data});break;case"subjectPlanPageTab":AuditProgramPagePlan({region:"#subjectPlanPageTab",data:e.data});break;case"otherSubjectPlanPageTab":$("#otherSubjectPlanPageTab").tab("show"),OtherAuditProgramPagePlan({region:"#otherSubjectPlanPageTab",data:e.data})}})}),(()=>{$(e.region).empty().append(t),a(),AuditProgramPagePlan({region:"#subjectPlanPageTab",data:e.data}),OneUI.initHelper("slimscroll")})()};function AttachListPage(e){let t=e.template||tplLoader("dgCenter/html/dg/attachList.html");e.data.extraOptions.customerId,e.data.extraOptions.projectId,e.data.nodeType;$(e.region).html(t),$("#headtitle").empty().text(e.data.text);let a=new Page({container:"#attachListPage",events:{"#refreshAttachTableBtn":"click,onRrefreshAttachTable","#upload":"click,onUpload","#customerProjectUpload":"click,onCustomerProjectUpload"},init(e){this.uploadWorkpagerPage=createForm(this.uploadWorkpagerPageCfg),BdoDataTable("attachTable",this.attachTableCfg),this.listener()},uploadWorkpagerPageCfg:{options:{propsData:{jsonData:{workpager:[],customerId:window.CUR_CUSTOMERID,projectId:window.CUR_PROJECTID,subjectTreeId:e.data.extraOptions.autoId,autoId:null}}},props:{jsonData:Object},display:"tableform-one",column:1,id:"uploadFileForm",data:()=>({ajaxConfig:{type:"POST",url:"dgCenter/DgMain.updateProjDgFile.json",dataType:"json",success(e){e.success?(bdoSuccessBox("成功",e.resultInfo.statusText),$("#uploadTplFormModal").modal("hide"),$("#attachTable").DataTable().ajax.reload()):bdoErrorBox("失败",e.resultInfo.statusText)}},uploadMode:"STD"}),methods:{onUploadDraftFileClick(t){$("#workpager").fileinput("getFilesCount")<=0?bdoErrorBox("失败","当前无任何文件！"):this.uploadFile(!0,{param1:e.data.type})},resetFileClick(e){$("#workpager").fileinput("refresh"),$("#workpager").fileinput("clear"),$("#workpager").fileinput("reset")}},buttons:[{id:"resetFileBtn",icon:"fa fa-refresh",style:"btn-primary",text:"重置",typeAttr:{"v-on:click":"resetFileClick"}},{id:"uploadDraftFileBtn",icon:"fa fa-upload",style:"btn-primary",text:"上传",typeAttr:{"v-on:click":"onUploadDraftFileClick"}},{id:"cancelUploadDraftFileBtn",icon:"fa-arrow-left",style:"btn-warning",text:"取消",typeAttr:{"data-dismiss":"modal"}}],items:[{id:"workpager",type:"file",label:"文件",rowspan:1,colspan:2,validate:{rules:{}},typeAttr:{multiple:!0},show:!0,plugin:{name:"fileinput",options:{allowedFileExtensions:["xls","xlsx","xltx","xlsm","xltm","xlsb","xlam","jpg","png","doc","docx","zip","rar","pdf"],uploadUrl:"dgCenter/DgDownload.uploadTempFile.json",uploadExtraData:()=>({})}}}]},uploadWorkpagerPage:null,attachTableCfg:{localParam:{url:"dgCenter/DgGeneral.query.json",urlparam:{menuId:window.sys_menuId,sqlId:"DG00062",param1:window.CUR_CUSTOMERID,param2:e.data.extraOptions.autoId},tabNum:!0},tableParam:{scrollX:!0,scrollCollapse:!0,select:!0,serverSide:!0,lengthChange:!0,drawCallback(e){let t=this;t.isInitSortable||$("tbody",this).sortable({helper(e,t){let a=t.children(),r=t.clone();return r.children().each(function(e){$(this).width(a.eq(e).width())}),r},stop(){let e=$("tbody tr",t),a=t.fnGetData(),r=[];e.each((e,t)=>{let l=$(t);l.find("td:eq(0)").text(e+1);let s=a[e];s.sortNum!=l.data("sortNum")&&(s.sortNum=l.data("sortNum"),$(t).data("autoId",s.autoId),$(t).data("sortNum",s.sortNum),r.push({autoId:s.autoId,customerId:s.customerId,sortNum:s.sortNum}))}),r.length>0&&$.ajax({url:"dgCenter/DgMain.updateDgFileSort.json",type:"post",data:{jsonData:JSON.stringify(r)},dataType:"json",success(e){e.success||bdoErrorBox("排序失败",e.resultInfo.statusText)}})}}),t.isInitSortable=!0},createdRow(e,t,a){$(e).data("sortNum",t.sortNum),$(e).data("dataIndex",a)},columnDefs:[{targets:(()=>(cnt=0,++cnt))(),orderable:!1,className:"text-center",title:"处理",data:null,width:"120px",render:function(e,t,a,r){var l="";return l+='<button class="btn btn-xs table-btn-operate btn-danger" type="button" name="reUploadFile" data-placement="top" title="重新上传" data-toggle="tooltip" data-row="'+r.row+'">\t<i class="fa fa-upload"></i></button>',l+='<button class="btn btn-xs table-btn-operate btn-primary" type="button" name="downloadFile" data-placement="top" title="下载" data-toggle="tooltip" data-row="'+r.row+'">\t<i class="fa fa-download"></i></button>',/^.*?\.(jpg|jpeg|bmp|gif|png|pdf|xlsx)$/.test(e.fileName.toLowerCase())&&(l+='<button class="btn btn-xs table-btn-operate btn-success" type="button" name="onlinepreview" data-placement="top" title="在线预览" data-toggle="tooltip" data-row="'+r.row+'">\t<i class="fa fa-eye"></i></button>'),l+='<button class="btn btn-xs table-btn-operate btn-danger" type="button" name="delFile" data-placement="top" title="删除" data-toggle="tooltip" data-row="'+r.row+'">\t<i class="fa fa-times-circle-o"></i></button>'}},{targets:++cnt,name:"sortNum",data:"sortNum",visible:!1},{targets:++cnt,orderable:!0,className:"edit-indexid",title:"索引号",name:"fileIndexId",data:"fileIndexId",width:"150px",render:e=>e},{targets:++cnt,orderable:!0,title:"文件名称",name:"fileName",data:"fileName",width:"150px"},{targets:++cnt,orderable:!0,title:"上传时间",name:"uploadDate",data:"uploadDate",width:"150px",render:function(e,t,a,r){return new Date(e).format("yyyy-MM-dd HH:mm:ss")}},{targets:++cnt,orderable:!0,title:"上传人",name:"__uuploadUserName",data:"__uuploadUserName",width:"150px"}]}},onRrefreshAttachTable(e){e.preventDefault(),$("#attachTable").DataTable().ajax.reload()},onUpload(e){e.preventDefault(),a.uploadWorkpagerPage.jsonData.autoId=null,a.uploadMode="STD",$("#uploadTplFormModal").modal("show")},onCustomerProjectUpload(e){$("#uploadCpFileModal").modal("show"),$("#selectFile").html('<iframe id="selectFile" height="600px" width="1000px" style="border: 1px solid #dcdcdc;"  frameborder="0" src="./transfer/index.html"></iframe>')},updateFileIndexId(e,t,a,r){let l=a.dataTable().api(!0).cell(t).data();if(l!=r&&r){let e=a.dataTable().api(!0).cell(t).row().data();$.ajax({url:"dgCenter/DgMain.updateDgIndexId.json",type:"post",data:{jsonData:JSON.stringify([{autoId:e.autoId,customerId:e.customerId,fileIndexId:r}])},dataType:"json",success(e){e.success?(t.css("padding","6px 8px"),t.html(r),a.dataTable().api(!0).cell(t).data(r)):bdoErrorBox("失败",e.resultInfo.statusText)}})}else l==r&&(t.css("padding","6px 8px"),t.html(r),a.dataTable().api(!0).cell(t).data(r))},onIndexColDbclick(e){console.log("onIndexColDbclick");let t=$("#attachTable").dataTable(),r=$(this),l=t.api(!0).cell(this).data(),s=$('<input style="width: 60%; height: 80%;    max-height: 2em; margin-top: 1px;"/>'),o=$('<button class="btn btn-success" style="font-size: 12px;width: 15%;height: 80%;max-height: 2em;margin-left: 5px;padding: 1px;margin-top: -4px;"><i class="fa fa-check"></i></button>');r.css("padding",0),s.val(l),r.html(s),r.append(o),o.click(function(e){a.updateFileIndexId(e,r,t,s.val())}),s.focus()},listener(){let e=(e,t)=>{$.ajax({url:"dgCenter/DgMain.queryProjDgFileExist.json",type:"post",async:!1,data:e,dataType:"json",success(e){e.success?t(e):bdoErrorBox("失败",e.resultInfo.statusText)}})};$("#attachTable").on("click",'button.table-btn-operate[name="reUploadFile"]',e=>{let t=$("#attachTable").dataTable().fnGetData($(e.currentTarget).attr("data-row"));a.uploadWorkpagerPage.jsonData.autoId=t.autoId,a.uploadWorkpagerPage.uploadMode="RE",$("#uploadTplFormModal").modal("show")}),$("#attachTable").on("click",'button.table-btn-operate[name="downloadFile"]',t=>{let a=$("#attachTable").dataTable().fnGetData($(t.currentTarget).attr("data-row"));e({param1:a.autoId,param2:a.customerId},e=>{downloadFile("dgCenter/DgDownload.downloadProjDgFile.json",{param1:a.autoId,param2:a.customerId})})}),$("#attachTable").on("click",'button.table-btn-operate[name="onlinepreview"]',t=>{var a=$("#attachTable").dataTable().fnGetData($(t.currentTarget).attr("data-row"));e({param1:a.autoId,param2:a.customerId},e=>{var t=a.fileName.substring(a.fileName.lastIndexOf(".")+1).toLowerCase();if("pdf"===t||"jpg"===t||"png"===t||"jpeg"===t)window.open("dgCenter/DgMain.previewProjDgFile.json?param1="+a.autoId+"&param2="+a.customerId,a.fileName,"location=no");else if("xlsx"===t){a.pageType=3;var r={extraOptions:a,currentNode:{extraOptions:a}};$.sessionStorage("fileNode",JSON.stringify(r)),window.open("/Faith/dgcenter.do?m=previewFile")}})}),$("#attachTable").on("click",'button.table-btn-operate[name="delFile"]',e=>{var t=$("#attachTable").dataTable().fnGetData($(e.currentTarget).attr("data-row"));bdoConfirmBox("提示","确认删除文件【"+t.fileName+"】?",function(){$.ajax({url:"dgCenter/DgMain.deleteProjDgFile.json",type:"post",data:{param1:t.autoId,param2:t.customerId},dataType:"json",success:function(e){e.success?($("#attachTable").DataTable().ajax.reload(),bdoSuccessBox("成功",e.resultInfo.statusText)):bdoErrorBox("失败",e.resultInfo.statusText)}})})}),$("#attachTable").on("dblclick","tbody td.edit-indexid",this.onIndexColDbclick)}})}function BatchUploadWorkpaperPage(e){let t=e.data,a=e.template||tplLoader("dgCenter/html/dg/batchUploadWorkpaper.html");$(e.region).html(a);let r=0,l="",s=new Page({random:(new Date).getTime()+parseInt(1e3*Math.random()),container:e.region,events:{"#showBatchUploadModalBtn":"click,onShowBatchUploadModal","#uploadBatchDgBtn":"click,uploadBatchDg"},_template:a,_data:e.data,init(e){this.batchUploadWPForm=createForm(this.batchUploadWPFormCfg),BdoDataTable("batchWPtempTable",this.batchWPtempTableCfg),OneUI.initHelper("slimscroll"),this.eventBind()},batchUploadWPFormCfg:{options:{propsData:{jsonData:{batchWorkpaper:[],customerId:"",projectId:""}}},props:{jsonData:Object},display:"tableform-one",column:1,id:"batchUploadWPForm",data:()=>({ajaxConfig:{type:"POST",url:"dgCenter/DgWapper.batchUploadDgFile.json",dataType:"json",success(e){if(e.success)$("#filePath").val(e.data[0].path),$("#batchUploadWPFormModal").modal("hide"),$("#tmpDgModal").modal("show");else if(e.data&&e.data[0]&&e.data[0].extraLinkList){var t='上传的所有文件中，存在&nbsp;<font color="red">'+e.data[0].extraLinkList.length+"</font>&nbsp;处外部文件链接！";for(var a of e.data[0].extraLinkList)t=(t=(t=t+'<br>文件名：<font color="red">'+a.substring(0,a.indexOf(":"))+"</font>")+'<br>sheet名称：<font color="red">'+a.substring(a.indexOf(":")+1,a.lastIndexOf(":"))+"</font>")+'&nbsp;&nbsp;单元格位置：<font color="red">'+a.substring(a.lastIndexOf(":")+1)+"</font>";bdoErrorBox("失败",t)}else bdoErrorBox("失败",e.resultInfo.statusText)}}}),methods:{onBatchUploadWPBtn(e){let a=$("#batchWorkpaper").fileinput("getFileStack");if(!a||a.length<1)return void bdoInfoBox("提示","请选择导入文件");let r=!0;$.each(a,function(e,t){/.xlsx/.test(t.name)||(r=!1)}),r?(this.jsonData.customerId=t.extraOptions.customerId,this.jsonData.projectId=t.extraOptions.projectId,this.uploadFile(!0)):bdoInfoBox("提示","不正确的文件扩展名.只支持'xlsx'的文件扩展名.")}},buttons:[{id:"batchUploadWPBtn",icon:"fa-floppy-o",style:"btn-primary",text:"上传",typeAttr:{"v-on:click":"onBatchUploadWPBtn"}},{id:"cancelUploadModelBtn",icon:"fa-arrow-left",style:"btn-warning",text:"取消",typeAttr:{"data-dismiss":"modal"}}],items:[{id:"batchWorkpaper",type:"file",label:"底稿",rowspan:1,colspan:2,validate:{rules:{}},show:!0,typeAttr:{multiple:!0},plugin:{name:"fileinput",options:{uploadUrl:"dgCenter/DgDownload.uploadTempFile.json",allowedFileExtensions:["xlsx"],uploadExtraData:()=>({})}}}]},batchWPtempTableCfg:{localParam:{url:"dgCenter/DgGeneral.query.json",urlparam:{menuId:window.sys_menuId,sqlId:"DG00070",param1:t.extraOptions.customerId,param2:t.extraOptions.projectId},tabNum:!0},tableParam:{pageLength:30,scrollX:!0,select:!1,ordering:!1,order:[1,"asc"],serverSide:!0,columnDefs:[{targets:(()=>(r=0,++r))(),orderable:!0,title:"文件名称",name:"fileName",data:"fileName",width:"150px"},{targets:++r,orderable:!0,title:"索引号",name:"indexId",data:"indexId",width:"100px"},{targets:++r,orderable:!0,title:"底稿名称",name:"tplFileName",data:"tplFileName",width:"150px",render:(e,t,a,r)=>'<a href="#">'+e+"</a>"},{targets:++r,orderable:!0,title:"上传人",name:"__uuploadUser",data:"__uuploadUser",width:"150px",render:e=>$.isPlainObject(e)?e.userName:""},{targets:++r,orderable:!0,title:"上传日期",name:"uploadDate",data:"uploadDate",width:"100px",render:e=>new Date(e).format("yyyy-MM-dd HH:mm:ss")},{targets:++r,orderable:!0,title:"状态",name:"matchState",data:"matchState",width:"50px",className:"text-center",render:(e,t,a,r)=>1==a.matchState?'<i class="si si-check fa-2x" style="color: #07ea6d"></i>':'<i class="si si-close fa-2x" style="color: red"></i>'},{targets:++r,name:"workpaperId",data:"workpaperId",visible:!1}]}},onShowBatchUploadModal(){null!=l&&""!=l?$("#batchUploadWPFormModal").modal("show"):bdoInfoBox("提示","请先生成底稿！")},onMatchWPFormModal(e){$("#batchWPtempTable").dataTable().fnGetData($(e.currentTarget).attr("data-row"));$("#matchWPFormModal").modal("show")},uploadBatchDg(){var e=$("#dgMatchTable").dataTable(),a=e.fnGetNodes();if(0!=a.length){bdoInProcessingBox("批量上传中");for(var r={},l=0;l<a.length;l++){var s,o,n,i=e.fnGetData(a[l]);""!=i[2]?(s=i[1],n=i[2],o=i[3]):(s=i[1],n=$(e.fnGetNodes(a[l])).find("option:selected").text(),o=$(e.fnGetNodes(a[l])).find("option:selected").val()),r[l]={fileName:s,label:n,value:o}}$.ajax({type:"post",url:"dgCenter/DgWapper.checkTagOrLinkExistence.json",data:{param1:t.extraOptions.customerId,param2:t.extraOptions.projectId,param3:$("#filePath").val(),param4:JSON.stringify(r)},dataType:"json",success(e){if(e.success){let o=()=>{bdoInProcessingBox("批量上传中");var a={menuId:window.sys_menuId,param1:t.extraOptions.customerId,param2:t.extraOptions.projectId,param3:e.data[0].filePath,param4:e.data[0].param,param5:JSON.stringify(e.data[0].keyListMap)};$.ajax({url:"dgCenter/DgWapper.coverDgFile.json",type:"post",data:a,dataType:"json",success(e){e.success?($("#batchWPtempTable").DataTable().ajax.reload(),$("#tmpDgModal").modal("hide"),bdoSuccessBox("成功",e.resultInfo.statusText)):bdoErrorBox("失败",e.resultInfo.statusText)}})};var a=e.data[0].dataListMap;if(a){var r="<div>批量上传底稿文件对比原底稿文件相比,不存在以下单元格</div><br>";for(var l in r+='<div style="height: 250px;overflow-y: auto"><font color="red">',a){var s=a[l];-1!=l.indexOf("标签:")?r+="标签:"+s+"<br>":r+="单向链接:"+s+"<br>"}r+="</font></div><br>是否确定上传？",bdoConfirmBox("提示",r,e=>{o()})}else o()}else bdoErrorBox("失败",e.resultInfo.statusText)}})}else bdoInfoBox("提示","上传底稿为空！")},eventBind(){$("#batchWPtempTable").on("click",'button.table-btn-operate[name="optMatchProgram"]',this.onMatchWPFormModal.bind(this)),$("#tmpDgModal").on("show.bs.modal",function(){$.ajax({type:"post",url:"dgCenter/DgWapper.matchDgFile.json",data:{param1:t.extraOptions.customerId,param2:t.extraOptions.projectId,param3:$("#filePath").val()},dataType:"json",success(e){if(e.success){var t=[];for(var a of e.data[0].data)t.push(["",a.fileName,a.auditProgramName,a.auditProgramId]);$("#dgMatchTable").dataTable({data:t,pageLength:30,ordering:!1,scrollX:!0,scrollY:"310px",columns:[{title:"序号",class:"text-center",width:"60px",render:function(e,t,a,r){return r.settings._iDisplayStart+r.row+1}},{title:"上传文件名称",width:"220px"},{title:"底稿文件名称",width:"250px",render:function(e,t,a,r){return null!=e&&""!=e?e:'<div class="form-material"><select class="js-select2 form-control">'+l+"</select></div>"}},{title:"操作",width:"60px",render:function(e,t,a,r){return'<div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button class="btn btn-xs btn-warning" type="button" name="delBtn" data-placement="top" title="删除" data-toggle="tooltip" data-row="'+r.row+'">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class="fa fa-close"></i>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>'}},{visible:!1}]})}}})}),$("#dgMatchTable").on("click",'button[name="delBtn"]',function(e){var t=$(this).parents("tr").index();$("#dgMatchTable").DataTable().row(t).remove().draw()}),$("#batchWPtempTable tbody").on("click","td a",function(){var e=$(this).parents("tr").index(),t=$("#batchWPtempTable").DataTable().row(e).data();$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",data:{menuId:window.sys_menuId,sqlId:"DG00078",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:t.workpaperId,start:-1,limit:-1},dataType:"json",success(e){if(e.success){var a={extraOptions:e.data[0],currentNode:{extraOptions:e.data[0]}};a.autoId=a.extraOptions.autoId,a.workpaperId=a.extraOptions.workpaperId,a.menuId=window.sys_menuId,$.sessionStorage("subjecttreeNode",JSON.stringify(a)),window.open("/Faith/dgcenter.do?m=openWorkpaper&index="+t.indexId+"&projectId="+t.projectId)}}})})}});return $.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",data:{menuId:window.sys_menuId,sqlId:"DG00071",param1:t.extraOptions.customerId,param2:t.extraOptions.projectId,limit:-1,start:-1},dataType:"json",success(e){if(e.success)for(let t of e.data)l=l+'<option value="'+t.value+'" title="'+t.label+'">'+t.label+"</option>"}}),s}AnalysisReview=(e=>{var t;t=e.template||tplLoader("dgCenter/html/dg/analysisReview.html"),e.template=t;let a,r,l=e.data.projectYear;var s,o;let n=[],i={localParam:{tabNum:!1,url:"dgCenter/FUnAuditReport.analysisReview.json",urlparam:{menuId:window.sys_menuId,start:-1}},tableParam:{scrollY:!1,select:!0,lengthChange:!0,dom:'<"row"<"col-sm-12"tr>>',serverSide:!0,rowReorder:{update:!1},columnDefs:[]}},d=()=>$.ajax({url:"dgCenter/FUnAuditReport.analysisReview.json",type:"post",data:{start:-1,menuId:window.sys_menuId},dataType:"json",success:function(e){if(e.success){let t=e.data[0],a=$.extend(!0,{},i);a.tableParam=(e=>{let t={select:!0,lengthChange:!0,dom:'<"row"<"col-sm-12"tr>>',serverSide:!0,ordering:!1,createdRow(e,t,a){(t.colDisp.indexOf("合计")<0||t.colDisp.indexOf("总计")<0)&&($(e).addClass("edit-able"),$(e).find("td:eq(6)").addClass("bg-gray-lighter"),$(e).find("td:eq(9)").addClass("bg-success-light"))},columnDefs:[{targets:0,orderable:!1,className:"text-center",title:"序号",width:"30px",visible:!0,render:function(e,t,a,r){return r.settings._iDisplayStart+r.row+1}},{targets:1,orderable:!1,className:"text-left",title:"科目编号",name:"colCode",data:"colCode",width:"30px",render:function(e,t,a,r){return e.replace(" ","&nbsp;&nbsp;")}},{targets:2,orderable:!1,className:"text-left",title:"科目名称",name:"colDisp",data:"colDisp",width:"150px",render:function(e,t,a,r){return e.indexOf("合计")>0||e.indexOf("总计")>0?"<b>"+e+"</b>":e.replace(/ /g,"&nbsp;")}}]};return t.columnDefs.push({targets:3,orderable:!1,className:"text-right",title:"期末数",name:"adjustedAmount"+e,data:"adjustedAmount"+e,width:"60px",render:function(e,t,a,r){return formatMoney(e)}}),t.columnDefs.push({targets:4,orderable:!1,className:"text-right",title:"期初数",name:"adjustedRemain"+e,data:"adjustedRemain"+e,width:"60px",render:function(e,t,a,r){return formatMoney(e)}}),t.columnDefs.push({targets:5,orderable:!1,className:"text-right",title:"变动比例",name:"proportion",data:"proportion",width:"60px",render:function(e,t,a,r){return a.changeThreshold<Math.abs(a.proportion)?'<span style="color: red">'+e+"%</span>":e+"%"}}),t.columnDefs.push({targets:6,orderable:!1,className:"text-right",title:"变动金额",name:"subtract",data:"subtract",width:"60px",render:function(e,t,a,r){return formatMoney(e)}}),t.columnDefs.push({targets:7,orderable:!1,className:"text-right",title:"占资产总额比重",name:"assVal",data:"assVal",width:"60px",render:function(e,t,a,r){return a.assetsValue<Math.abs(a.assVal)?'<span style="color:red;">'+e+"%</span>":e+"%"}}),t.columnDefs.push({targets:8,orderable:!1,className:"text-center",title:"是否需要分析变动原因",name:"subtract",data:"subtract",width:"60px",render:function(e,t,a,r){return a.assetsValue<Math.abs(a.assVal)&&a.changeThreshold<Math.abs(a.proportion)?'<span style="color: red">是</span>':"否"}}),t.columnDefs.push({targets:9,orderable:!1,className:"text-left",title:"变动原因",name:"changeReason",data:"changeReason",width:"300px"}),t})(l);let r=$.extend(!0,{},i);return r.tableParam=(e=>{let t={select:!0,lengthChange:!0,dom:'<"row"<"col-sm-12"tr>>',serverSide:!0,ordering:!1,createdRow(e,t,a){(t.colDisp.indexOf("合计")<0||t.colDisp.indexOf("总计")<0)&&($(e).addClass("edit-able"),$(e).find("td:eq(6)").addClass("bg-gray-lighter"),$(e).find("td:eq(9)").addClass("bg-success-light"))},columnDefs:[{targets:1,orderable:!1,className:"text-center",title:"序号",width:"30px",visible:!0,render:function(e,t,a,r){return r.settings._iDisplayStart+r.row+1}},{targets:2,orderable:!1,className:"text-left",title:"科目编号",name:"colCode",data:"colCode",width:"30px",render:function(e,t,a,r){return e.replace(" ","&nbsp;&nbsp;")}},{targets:3,orderable:!1,className:"text-left",title:"科目名称",name:"colDisp",data:"colDisp",width:"150px",render:function(e,t,a,r){return e.indexOf("合计")>0||e.indexOf("总计")>0?"<b>"+e+"</b>":e.replace(/ /g,"&nbsp;")}}]};return t.columnDefs.push({targets:4,orderable:!1,className:"text-right",title:"本年数",name:"adjustedAmount"+e,data:"adjustedAmount"+e,width:"60px",render:function(e,t,a,r){return formatMoney(e)}}),t.columnDefs.push({targets:5,orderable:!1,className:"text-right",title:"上年数",name:"adjustedRemain"+e,data:"adjustedRemain"+e,width:"60px",render:function(e,t,a,r){return formatMoney(e)}}),t.columnDefs.push({targets:6,orderable:!1,className:"text-right",title:"变动比例",name:"proportion",data:"proportion",width:"60px",render:function(e,t,a,r){return a.changeThreshold<Math.abs(a.proportion)?'<span style="color: red">'+e+"%</span>":e+"%"}}),t.columnDefs.push({targets:7,orderable:!1,className:"text-right",title:"变动金额",name:"subtract",data:"subtract",width:"60px",render:function(e,t,a,r){return formatMoney(e)}}),t.columnDefs.push({targets:8,orderable:!1,className:"text-right",title:"占利润总额比重",name:"profVal",data:"profVal",width:"60px",render:function(e,t,a,r){return a.profitsValue<Math.abs(a.profVal)?'<span style="color:red;"> '+e+"%</span>":e+"%"}}),t.columnDefs.push({targets:9,orderable:!1,className:"text-center",title:"是否需要分析变动原因",name:"subtract",data:"subtract",width:"60px",render:function(e,t,a,r){return a.profitsValue<Math.abs(a.profVal)&&a.changeThreshold<Math.abs(a.proportion)?'<span style="color: red">是</span>':"否"}}),t.columnDefs.push({targets:10,orderable:!1,className:"text-left",title:"变动原因",name:"changeReason",data:"changeReason",width:"300px"}),t})(l),a.localParam.data=t.zc,r.localParam.data=t.lr,BdoDataTable("zc_report_table",a),void BdoDataTable("lr_report_table",r)}bdoInfoBox("提示",e.resultInfo.statusText)}});(()=>{$(e.region).empty().append(t),d(),$("#reviewIndex").text("【"+e.type+"】"),OneUI.initHelper("slimscroll"),(()=>{ComboDicOptionNew($("#unusual_industry_period"),ComboLocalDicOption(!1,"WindPeriod"));(new Date).getFullYear();a=window.CUR_PROJECT_ACC_YEAR,$("#unusual_industry").treecombo({url:"cpBase/TreeCommon.findIndustry2Tree.json",params:{},view:{leafIcon:"fa fa-building text-flat",nodeIcon:"fa fa-bank text-primary-light",folderSelectable:!0,multiSelect:!1}}),$.ajax({type:"get",url:"finCenter/analysis.findIndustry.json",bdolxLoader:!1,data:{param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID},dataType:"json",success:function(e){if(e.success){var t=e.data[0].aa,a=e.data[0].aacode;$("#unusual_industry").treecombo("setTreeComboValue",[a,t]),$("#project_industry").html("未审报表中的行业指标为上年行业数据，审定报表中的行业指标为本年行业数据。&nbsp;&nbsp;行业："+t)}}})})()})(),$("#rpt_search").click(function(){d()}),$("#ar_config").click(function(){$("#ar_config_modal").modal("show"),$.ajax({url:"dgCenter/DgProject.queryAnalysisReviewConfig.json",type:"post",data:{param1:e.data.customerId},dataType:"json",success:function(e){if(e.success){let t=e.data[0];$("#assetsValue").val(t.assetsValue),$("#profitsValue").val(t.profitsValue),$("#changeThreshold").val(t.changeThreshold),$("#assets").val(t.assets),$("#profits").val(t.profits)}else console.log("获取初步分析性复核配置信息失败")}}),$("#customerId").val(e.data.customerId),$("#projectId").val(e.data.projectId)}),$("#ar_config_form").formview({display:"tableform-one",column:4,buttons:[{id:"comtemplate_save",icon:"fa-save",style:"btn-primary",text:"&nbsp;保存"},{id:"comtemplate_close",icon:"fa-sign-out",style:"btn-warning",text:"&nbsp;关闭"}],items:[{id:"customerId",type:"input",typeAttr:{type:"hidden"}},{id:"projectId",type:"input",typeAttr:{type:"hidden"}},{id:"assetsValue",label:"占资产总额阈值（默认5%）",html:'<div class="form-material "><input class="form-control" type="number" id="assetsValue" data-toggle="tooltip" data-placement="top" title="" /><label for="assetsValue">占资产总额阈值（默认5%）</label></div>',rowspan:1},{id:"changeThreshold",label:"变动幅度阈值（默认30%）",html:'<div class="form-material "><input class="form-control" type="number" id="changeThreshold" data-toggle="tooltip" data-placement="top" title="" /><label for="changeThreshold">变动幅度阈值（默认30%）</label></div>',rowspan:1},{id:"profitsValue",label:"占利润总额阈值（默认10%）",html:'<div class="form-material "><input class="form-control" type="number" id="profitsValue" data-toggle="tooltip" data-placement="top" title="" /><label for="profitsValue">占利润总额阈值（默认10%）</label></div>',rowspan:1},{id:"assets",type:"input",label:"资产总计科目编号（默认A）",rowspan:1},{id:"profits",type:"input",label:"利润总额科目编号（默认S06）",rowspan:1},{id:"methodTips",label:"判断方式",html:'<div class="form-material"><label style="color: red">占资产总额比重、占利润总额比重、变动比例>相应阈值时，需填写变动原因</label></div>',rowspan:1}]});var c={param2:"",param1:"",param3:{}};$("#zc_report_table,#lr_report_table").on("dblclick","td",function(){if(9!=$(this).closest("td").index())return;let t=$(this).closest("table"),a=t.DataTable().context[0].aoColumns[t.DataTable().cell(this).index().column],r=t.DataTable().row($(this).closest("tr")).data(),l=this.offsetHeight;$(this).html("<span><textarea type='text' style='width:100%; height: "+l+"px;align=right;'></textarea></span>");let s=$(this).find("textarea"),o=r[a.name];o&&s.val(o),s.focus(),s.on("keydown",function(e){13==e.keyCode&&s.blur()}),s.on("blur",function(){let t=$(this).closest("table").DataTable().row($(this).closest("tr")).data(),a=$(this).val();var r=$(this).closest("td");t.changeReason=a,c.param3[t.colCode]=a,$.ajax({url:"dgCenter/FUnAuditReport.saveChangeReason.json",type:"post",data:{param1:e.data.customerId,param2:1,param3:encodeURIComponent(JSON.stringify(c.param3))},dataType:"json",success:function(e){e.success?(g(),c.param3={},r.html(a),bdoSuccessBox("成功",e.resultInfo.statusText)):(c.param3={},r.html(o),bdoErrorBox("失败",e.resultInfo.statusText))}})})}),$("#comtemplate_close").click(function(){$("#ar_config_modal").modal("hide"),document.getElementById("ar_config_form").reset()}),$("#comtemplate_save").click(function(){$("#assetsValue").val()>1||$("#assetsValue").val()<0?bdoInfoBox("提示","阈值范围请设置0-1之间"):$("#profitsValue").val()>1||$("#profitsValue").val()<0?bdoInfoBox("提示","阈值范围请设置0-1之间"):$("#changeThreshold").val()>1||$("#changeThreshold").val()<0?bdoInfoBox("提示","阈值范围请设置0-1之间"):$.ajax({url:"dgCenter/FUnAuditReport.checkUnAuditReportCode.json",type:"post",data:{param1:$("#assets").val(),param2:$("#profits").val(),param3:window.CUR_CUSTOMERID},dataType:"json",success:function(t){t.success?($("#ar_config_form").formview("setAjaxConf",["dgCenter/DgProject.savaAnalysisReviewConfig.json",{param1:JSON.stringify({assetsValue:$("#assetsValue").val(),profitsValue:$("#profitsValue").val(),changeThreshold:$("#changeThreshold").val(),assets:$("#assets").val(),profits:$("#profits").val()}),param2:e.data.customerId,param3:1},"json",!0,function(e){e.success?(d(),bdoSuccessBox("成功",e.resultInfo.statusText)):bdoErrorBox("失败",e.resultInfo.statusText),$("#ar_config_modal").modal("hide")}]),$("#ar_config_form").submit()):(c.param3={},bdoInfoBox("提示",t.resultInfo.statusText))}})}),$("#zc_report_table,#lr_report_table").on("dblclick","td",function(){1==$(this).closest("td").index()&&$.ajax({url:"dgCenter/FUnAuditReport.findUserSubjectIdByColCode.json",type:"post",data:{param1:e.data.customerId,param2:$(this).text()},dataType:"json",success:function(t){let a="";t.success&&t.data&&(a="&userSubjectCode="+t.data[0].userSubjectId);let r="/Faith/bdologin.do?m=gotoDesktop&menuId=40000006&customerId="+e.data.customerId+"&endYear="+e.data.projectYear+"&startYear="+(e.data.projectYear-1)+a;window.open(r)}})}),$("#rpt_check_analysisReview").on("click",function(){$("#rpt_check_analysisReview").blur();new Date;var e=window.CUR_PROJECT_ACC_YEAR,t="2",a=e-1+"-12-31",r="";"1"==$("#unusual_industry_period").val()?(t="2",r=e+"-12-31"):"2"==$("#unusual_industry_period").val()?(t="1",r=e+"-03-31"):"3"==$("#unusual_industry_period").val()?(t="1",r=e+"-06-31"):"4"==$("#unusual_industry_period").val()&&(t="1",r=e+"-09-31"),bdoAjaxBox("系统提示","确定完成核对吗？",function(){$.ajax({url:"dgCenter/FUnAuditReport.calculateAnalysisReview.json",type:"post",data:{param20:"1",param21:t,param22:$("#unusual_industry").attr("data-result"),param23:a,param24:r,param25:a},dataType:"json",success:function(e){e.success?bdoSuccessBox("操作成功",e.resultInfo.statusText):(bdoErrorBox("操作失败",e.resultInfo.statusText),u())}})})});var u=function(){for(var e=$("#zc_report_table").DataTable().data().length,t=0;t<e;t++){if((r=$("#zc_report_table").DataTable().data()[t]).assetsValue<Math.abs(r.assVal)&&r.changeThreshold<Math.abs(r.proportion)&&(null==r.changeReason||""==r.changeReason))return $("#report_type").find("li").first().find("a").click(),!1}var a=$("#lr_report_table").DataTable().data().length;for(t=0;t<a;t++){var r;if((r=$("#lr_report_table").DataTable().data()[t]).profitsValue<Math.abs(r.profVal)&&r.changeThreshold<Math.abs(r.proportion)&&(null==r.changeReason||""==r.changeReason))return $("#report_type").find("li").first().next().find("a").click(),!1}for(t=0;t<n.length;t++){var l=n[t],s=$("#analysisReason"+l.autoId).val();if("1"==l.isError&&(null==s||""==s))return $("#report_type").find("li").last().find("a").click(),$("#unusual"+l.autoId)[0].scrollIntoView({behavior:"smooth"}),$("#analysisReason"+l.autoId).focus(),!1}};let m=new Page({container:"#analysisReview",events:{"#upload":"click,onUpload","#unusual_search":"click,unusual_search"},init(e){this.uploadWorkpagerPage=createForm(this.uploadWorkpagerPageCfg)},uploadWorkpagerPageCfg:{options:{propsData:{jsonData:{workpager:[],customerId:window.CUR_CUSTOMERID,projectId:window.CUR_PROJECTID,subjectTreeId:e.data.autoId,autoId:null}}},props:{jsonData:Object},display:"tableform-one",column:1,id:"uploadFileForm",data:()=>({ajaxConfig:{type:"POST",url:"dgCenter/DgMain.updateProjDgFile.json",dataType:"json",success(e){e.success?(g(),bdoSuccessBox("成功",e.resultInfo.statusText),$("#uploadTplFormModal").modal("hide"),b()):bdoErrorBox("失败",e.resultInfo.statusText)}},uploadMode:"STD"}),methods:{onUploadDraftFileClick(t){$("#workpager").fileinput("getFilesCount")<=0?bdoErrorBox("失败","当前无任何文件！"):this.uploadFile(!0,{param1:e.data.type,param11:"1",param12:p})},resetFileClick(e){$("#workpager").fileinput("refresh"),$("#workpager").fileinput("clear"),$("#workpager").fileinput("reset")}},buttons:[{id:"resetFileBtn",icon:"fa fa-refresh",style:"btn-primary",text:"重置",typeAttr:{"v-on:click":"resetFileClick"}},{id:"uploadDraftFileBtn",icon:"fa fa-upload",style:"btn-primary",text:"上传",typeAttr:{"v-on:click":"onUploadDraftFileClick"}},{id:"cancelUploadDraftFileBtn",icon:"fa-arrow-left",style:"btn-warning",text:"取消",typeAttr:{"data-dismiss":"modal"}}],items:[{id:"workpager",type:"file",label:"文件",rowspan:1,colspan:2,validate:{rules:{}},typeAttr:{multiple:!0},show:!0,plugin:{name:"fileinput",options:{allowedFileExtensions:["xls","xlsx","xltx","xlsm","xltm","xlsb","xlam","jpg","png","doc","docx","zip","rar","pdf"],uploadUrl:"dgCenter/DgDownload.uploadTempFile.json",uploadExtraData:()=>({})}}}]},uploadWorkpagerPage:null,onUpload(e){e.preventDefault(),m.uploadWorkpagerPage.jsonData.autoId=null,m.uploadMode="STD",$("#uploadTplFormModal").modal("show")},unusual_search(){var e=$("#unusual_industry").attr("data-result");if(null!=e&&""!=e)if("classStandard"!==e){var t=$("#stockPalteSelect").val();if(e.indexOf("GB")>0&&t<=2)bdoErrorBox("错误","抱歉,立信行业分类不支持万得板块数据!");else if(e.indexOf("GB")<0&&t>2)bdoErrorBox("错误","抱歉,非立信行业不支持立信板块数据!");else if(e.length>10&&1!=t)bdoErrorBox("错误","抱歉,万得行业分类暂时仅支持万得A股板块数据!");else{null!==a&&""!==a?($("#projectId").val(window.CUR_PROJECTID),$("#unusual_slpk").val(window.CUR_CUSTOMERID),this.createTabUnusual("unusual_chartsProfitForPeriod")):bdoErrorBox("错误","年份不能为空!")}}else bdoErrorBox("错误","请选择具体行业");else bdoErrorBox("错误","请选择行业")},findCompnays(e,t){var a=e.children("option:selected"),r=e.val();e.html(""),ComboSearch(a,r,"cpBase/combo.findCompanys.json",e,!1,{param1:t},!1)},createTabUnusual(e){o=e;var t=a;if(null!==$("#unusual_slpk").val()&&""!==$("#unusual_slpk").val())if(null!==t&&""!==t){var l="2",n=t-1+"-12-31",i="";"1"==$("#unusual_industry_period").val()?(l="2",s=[t-3+"-12-31",t-2+"-12-31",t-1+"-12-31"],i=t+"-12-31"):"2"==$("#unusual_industry_period").val()?(l="1",s=[t-3+"-12-31",t-2+"-12-31",t-1+"-03-31"],i=t+"-03-31"):"3"==$("#unusual_industry_period").val()?(l="1",s=[t-3+"-12-31",t-2+"-12-31",t-1+"-06-31"],i=t+"-06-31"):"4"==$("#unusual_industry_period").val()&&(l="1",s=[t-3+"-12-31",t-2+"-12-31",t-1+"-09-31"],i=t+"-09-31");var d=$("#projectId").val(),c=s.join(",").toString();null!=d&&""!==d&&s.push("未审报表"),f(r={lockCustomerId:$("#unusual_slpk").val(),lockProjectId:d,param2:c,param4:l,param6:$("#unusual_industry").attr("data-result"),param7:n,param8:i,param9:n,param10:"0",param12:"1"},!0)}else bdoErrorBox("错误","年份不能为空!");else bdoErrorBox("错误","请选择公司")},unusual_clear(){var e=new Date;e.getFullYear(),e.getMonth(),e.getDate();$("#unusual_industry_period").selectpicker("val","1")},updateFileIndexId(e,t,a,r){let l=a.dataTable().api(!0).cell(t).data();if(l!=r&&r){let e=a.dataTable().api(!0).cell(t).row().data();$.ajax({url:"dgCenter/DgMain.updateDgIndexId.json",type:"post",data:{jsonData:JSON.stringify([{autoId:e.autoId,customerId:e.customerId,fileIndexId:r}])},dataType:"json",success(e){e.success?(t.css("padding","6px 8px"),t.html(r),a.dataTable().api(!0).cell(t).data(r)):bdoErrorBox("失败",e.resultInfo.statusText)}})}else l==r&&(t.css("padding","6px 8px"),t.html(r),a.dataTable().api(!0).cell(t).data(r))}});var p;let b=()=>{$.ajax({url:"finCenter/Analysis.queryAnalysisReason.json",type:"post",data:{param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:"1",param4:p},dataType:"json",success(e){if(e.success){if(e.data.length>0){var t=e.data[0];t.autoId;$("#analysisReason").val(t.analysisReason);let l="";for(var a=0;a<t.fileList.length;a++){var r=t.fileList[a];l=l+'         <li class="list-group-item">             <span class="icon fa fa-file-excel-o text-primary-light"></span>             '+r.fileName+'             <span class="fa fa-close text-danger pull-right" id="file'+r.autoId+'" autoId="'+r.autoId+'" fileName="'+r.fileName+'" chartId="'+t.autoId+'" :data-index="index" v-show="delBtnShow"></span>             <span class="fa fa-download text-danger pull-right" autoId="'+r.autoId+'" :data-index="index" ></span>         </li>'}$("#analysisFile"+p).html(l)}}else bdoErrorBox("失败",e.resultInfo.statusText)}})},g=()=>{new Date;var e=window.CUR_PROJECT_ACC_YEAR,t="2",a=e-1+"-12-31",r="";"1"==$("#unusual_industry_period").val()?(t="2",r=e+"-12-31"):"2"==$("#unusual_industry_period").val()?(t="1",r=e+"-03-31"):"3"==$("#unusual_industry_period").val()?(t="1",r=e+"-06-31"):"4"==$("#unusual_industry_period").val()&&(t="1",r=e+"-09-31"),$.ajax({url:"dgCenter/FUnAuditReport.calculateAnalysisReview.json",type:"post",data:{param21:t,param22:$("#unusual_industry").attr("data-result"),param23:a,param24:r,param25:a,param26:"1"},dataType:"json",success:function(e){e.success}})};function f(e,t){$.ajax({type:"get",url:"finCenter/analysis.getErrorChartData.json",dataType:"json",data:e,success:function(e){if(e.success){var a=$("#"+o);t&&$("#unusual_chartsTabContent").find(".block-content.row").empty(),n=e.data;for(var r=0;r<e.data.length;r++){var l=[],i=s,d=[],c=[],u={},m=e.data[r],p=o+m.autoId,b="unusual"+m.autoId,g="";let t='<ul class="list-group" style="padding: 10px 5px;" id="analysisFile'+m.autoId+'">';for(var f=0;f<m.fileList.length;f++){var h=m.fileList[f];t=t+'         <li class="list-group-item">             <span class="icon fa fa-file-excel-o text-primary-light"></span>             '+h.fileName+'             <span class="fa fa-close text-danger pull-right" id="file'+h.autoId+'" autoId="'+h.autoId+'" fileName="'+h.fileName+'" chartId="'+m.autoId+'" :data-index="index" v-show="delBtnShow"></span>             <span class="fa fa-download text-danger pull-right" autoId="'+h.autoId+'" :data-index="index" ></span>         </li>'}t+="</ul>",g='<ul class="list-group" style="padding: 10px 5px;">         <li class="list-group-item" id="analysisParamsLi'+m.autoId+'">             <span class="icon fa text-primary-light">             <button class="onSaveParam" autoId="'+m.autoId+'" type="button" style="border: 0px;background-color: #f9f9f9;color: #337ab7;">                 <i class="fa"> 保存</i>             </button>             自定义参数,多个请用逗号隔开</span>             <input class="form-control" autoId="'+m.autoId+'" id="analysisParams'+m.autoId+'" value="'+m.analysisParams+'">         </li>         <li class="list-group-item" id="analysisReasonLi'+m.autoId+'">             <span class="icon fa text-primary-light">             <button class="onSaveUnusual" autoId="'+m.autoId+'" type="button" style="border: 0px;background-color: #f9f9f9;color: #337ab7;">                 <i class="fa"> 保存</i>             </button>             分析原因</span>             <textarea class="form-control" id="analysisReason'+m.autoId+'">'+m.analysisReason+'</textarea>         </li>         <li class="list-group-item">             <button class="onUploadFileUnusual" autoId="'+m.autoId+'" type="button" style="border: 0px;background-color: #f9f9f9;color: #337ab7;">                 <i class="fa fa-upload"> 上传文件</i>             </button>'+t+"         </li>",g+="</ul>",$("#div_"+p).length>0?$("#div_"+p).html('<div id="'+p+'" style="width: 500px;height: 400px" class="col-sm-3 col-xs-3"></div><div id="'+b+'" style="display:inline-block width: 300px;height: 400px" class="col-sm-4 col-xs-4"><div title="'+m.quotaRemark+'" class="si si-question '+(m.analysisParams>""?"red-light":"")+'">'+m.unusualMessage+"</div> "+g+"</div>"):a.append('<div id="div_'+p+'"><div id="'+p+'" style="width: 500px;height: 400px" class="col-sm-3 col-xs-3"></div><div id="'+b+'" style="display:inline-block width: 300px;height: 400px" class="col-sm-4 col-xs-4"><div title="'+m.quotaRemark+'" class="si si-question '+(m.analysisParams>""?"red-light":"")+'">'+m.unusualMessage+"</div> "+g+"</div></div>");for(f=0;f<m.dataList.length;f++){var x=m.dataList[f];l.push(x.field),u[x.field]=f<=2,c.push({type:"value",show:!1});for(var w=[],I=0;I<x.data.length;I++)isNaN(x.data[I])?w.push(x.data[I]):w.push(parseFloat(x.data[I]));var y=x.magicType,v={name:x.field,type:y,stack:x.stock,data:w,label:{normal:{show:!0,position:"top"}},barMaxWidth:"80",barGap:"30%"};"line"!==y&&""===x.stock||(v.label.normal.show=!1),d.push(v)}c[0].show=!0;var _={title:{text:m.chartName,textStyle:{color:"1"==m.isError?"red":"green"}},grid:{top:"20%"},tooltip:{show:!0,trigger:"axis"},legend:{x:"50",data:l,selected:u,y:"10%"},toolbox:{show:!0,feature:{restore:{show:!0}}},calculable:!0,xAxis:{type:"category",data:i,axisLabel:{interval:0,rotate:-30}},yAxis:{type:"value"},series:d};echarts.init(document.getElementById(p)).setOption(_)}}}})}$("#unusual_chartsProfitForPeriod").on("click",".fa-close",function(e){var t=$(e.currentTarget).attr("autoId"),a=$(e.currentTarget).attr("fileName"),r=$(e.currentTarget).attr("chartId");bdoConfirmBox("提示","确认删除文件【"+a+"】?",function(){$.ajax({url:"dgCenter/DgMain.deleteProjDgFile.json",type:"post",data:{param1:t,param2:window.CUR_CUSTOMERID,param11:"1",param12:r,param13:window.CUR_PROJECTID},dataType:"json",success:function(e){e.success?(g(),$("#file"+t).closest("li").remove(),bdoSuccessBox("成功",e.resultInfo.statusText)):bdoErrorBox("失败",e.resultInfo.statusText)}})})}),$("#unusual_chartsProfitForPeriod").on("click",".onUploadFileUnusual",function(e){var t=$(e.currentTarget).attr("autoId");$("#uploadTplFormModal").modal("show"),p=t}),$("#unusual_isShowAll").on("change",function(e){$(this).prop("checked")?r.param10="1":r.param10="0",r.param13="",f(r,!0)}),$("#unusual_chartsProfitForPeriod").on("click",".onSaveParam",function(e){var t=$(e.currentTarget).attr("autoId");bdoConfirmBox("保存","确认保存？",function(){$.ajax({url:"finCenter/Analysis.saveAnalysisParams.json",type:"post",data:{param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:"1",param4:t,param5:$("#analysisParams"+t).val()},dataType:"json",success:function(e){e.success?(bdoSuccessBox("成功",e.resultInfo.statusText),r.param13=t,f(r,!1)):bdoErrorBox("失败",e.resultInfo.statusText)}})})}),$("#unusual_chartsProfitForPeriod").on("click",".onSaveUnusual",function(e){var t=$(e.currentTarget).attr("autoId");bdoConfirmBox("保存","确认保存？",function(){$.ajax({url:"finCenter/Analysis.saveAnalysisReason.json",type:"post",data:{param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:"1",param4:t,param5:$("#analysisReason"+t).val()},dataType:"json",success:function(e){e.success?(bdoSuccessBox("成功",e.resultInfo.statusText),g()):bdoErrorBox("失败",e.resultInfo.statusText)}})})}),$("#unusual_chartsProfitForPeriod").on("click",".fa-download",function(e){var t,a,r=$(e.currentTarget).attr("autoId");t={param1:r,param2:window.CUR_CUSTOMERID},a=(e=>{downloadFile("dgCenter/DgDownload.downloadProjDgFile.json",{param1:r,param2:window.CUR_CUSTOMERID})}),$.ajax({url:"dgCenter/DgMain.queryProjDgFileExist.json",type:"post",data:t,dataType:"json",success(e){e.success?a(e):bdoErrorBox("失败",e.resultInfo.statusText)}})}),$("#unusual_tab").one("click",function(){m.unusual_search()}),$("#rpt_export").click(function(){$("#unusual_tab").click(),$.ajax({url:"dgCenter/ExportOtherDg.exportAnalysis.json",data:r,type:"post",dataType:"json",success:function(e){if(e.success){if(e.data&&e.data.length>0){let t=e.data[0].fileData,a=e.data[0].fileName;e.data[0].isNew,bdoInfoBox("成功",a+"导出成功！"),saveAs(dataURLtoFile(t,a),a)}getSubjecttree({param1:window.CUR_PROJECTID,param2:$("#onlyMyselfCheckBox").get(0).checked?"1":""},e=>{$(".js-tree-collapsed").trigger("rebuild",[{data:[e.data[0].treeData],levels:3,callback(e){$.each(e.findNodes(),(t,a)=>{"FAR"==a.extraOptions.nodeType&&(e.expandNode(a.nodeId,{levels:a.deep+2,silent:!0}),e.selectNode(a.nodeId,{silent:!0}))})}}])})}else bdoErrorBox("失败",e.resultInfo&&e.resultInfo.statusText)}})})}),FinalAnalyticalReview=(e=>{var t;t=e.template||tplLoader("dgCenter/html/dg/analysisReview.html"),e.template=t;let a,r;e.data.projectYear;var l,s;let o=[],n={localParam:{tabNum:!1,url:"dgCenter/FUnAuditReport.analysisReview.json",urlparam:{menuId:window.sys_menuId,start:-1}},tableParam:{scrollY:!1,select:!0,lengthChange:!0,dom:'<"row"<"col-sm-12"tr>>',serverSide:!0,rowReorder:{update:!1},columnDefs:[]}},i=()=>$.ajax({url:"dgCenter/FUnAuditReport.finalAnalyticalReview.json",type:"post",data:{start:-1,menuId:window.sys_menuId},dataType:"json",success:function(e){if(e.success){let t=e.data[0],a=$.extend(!0,{},n);a.tableParam=(e=>{let t={select:!0,lengthChange:!0,dom:'<"row"<"col-sm-12"tr>>',serverSide:!0,ordering:!1,createdRow(e,t,a){(t.colDisp.indexOf("合计")<0||t.colDisp.indexOf("总计")<0)&&($(e).addClass("edit-able"),$(e).find("td:eq(6)").addClass("bg-gray-lighter"),$(e).find("td:eq(9)").addClass("bg-success-light"))},columnDefs:[{targets:0,orderable:!1,className:"text-center",title:"序号",width:"30px",visible:!0,render:function(e,t,a,r){return r.settings._iDisplayStart+r.row+1}},{targets:1,orderable:!1,className:"text-left",title:"科目编号",name:"colCode",data:"colCode",width:"30px",render:function(e,t,a,r){return e.replace(" ","&nbsp;&nbsp;")}},{targets:2,orderable:!1,className:"text-left",title:"科目名称",name:"colDisp",data:"colDisp",width:"150px",render:function(e,t,a,r){return e.indexOf("合计")>0||e.indexOf("总计")>0?"<b>"+e+"</b>":e.replace(/ /g,"&nbsp;")}}]};return t.columnDefs.push({targets:3,orderable:!1,className:"text-right",title:"期末数",name:"auditedAmount",data:"auditedAmount",width:"60px",render:function(e,t,a,r){return formatMoney(e)}}),t.columnDefs.push({targets:4,orderable:!1,className:"text-right",title:"期初数",name:"auditedRemain",data:"auditedRemain",width:"60px",render:function(e,t,a,r){return formatMoney(e)}}),t.columnDefs.push({targets:5,orderable:!1,className:"text-right",title:"变动比例",name:"proportion",data:"proportion",width:"60px",render:function(e,t,a,r){return a.changeThreshold<Math.abs(a.proportion)?'<span style="color: red">'+e+"%</span>":e+"%"}}),t.columnDefs.push({targets:6,orderable:!1,className:"text-right",title:"变动金额",name:"subtract",data:"subtract",width:"60px",render:function(e,t,a,r){return formatMoney(e)}}),t.columnDefs.push({targets:7,orderable:!1,className:"text-right",title:"占资产总额比重",name:"assVal",data:"assVal",width:"60px",render:function(e,t,a,r){return a.assetsValue<Math.abs(a.assVal)?'<span style="color:red;">'+e+"%</span>":e+"%"}}),t.columnDefs.push({targets:8,orderable:!1,className:"text-center",title:"是否需要分析变动原因",name:"subtract",data:"subtract",width:"60px",render:function(e,t,a,r){return a.assetsValue<Math.abs(a.assVal)&&a.changeThreshold<Math.abs(a.proportion)?'<span style="color: red">是</span>':"否"}}),t.columnDefs.push({targets:9,orderable:!1,className:"text-left",title:"变动原因",name:"finallyChangeReason",data:"finallyChangeReason",width:"300px"}),t})();let r=$.extend(!0,{},n);return r.tableParam=(e=>{let t={select:!0,lengthChange:!0,dom:'<"row"<"col-sm-12"tr>>',serverSide:!0,ordering:!1,createdRow(e,t,a){(t.colDisp.indexOf("合计")<0||t.colDisp.indexOf("总计")<0)&&($(e).addClass("edit-able"),$(e).find("td:eq(6)").addClass("bg-gray-lighter"),$(e).find("td:eq(9)").addClass("bg-success-light"))},columnDefs:[{targets:1,orderable:!1,className:"text-center",title:"序号",width:"30px",visible:!0,render:function(e,t,a,r){return r.settings._iDisplayStart+r.row+1}},{targets:2,orderable:!1,className:"text-left",title:"科目编号",name:"colCode",data:"colCode",width:"30px",render:function(e,t,a,r){return e.replace(" ","&nbsp;&nbsp;")}},{targets:3,orderable:!1,className:"text-left",title:"科目名称",name:"colDisp",data:"colDisp",width:"150px",render:function(e,t,a,r){return e.indexOf("合计")>0||e.indexOf("总计")>0?"<b>"+e+"</b>":e.replace(/ /g,"&nbsp;")}}]};return t.columnDefs.push({targets:4,orderable:!1,className:"text-right",title:"本年数",name:"auditedAmount",data:"auditedAmount",width:"60px",render:function(e,t,a,r){return formatMoney(e)}}),t.columnDefs.push({targets:5,orderable:!1,className:"text-right",title:"上年数",name:"auditedRemain",data:"auditedRemain",width:"60px",render:function(e,t,a,r){return formatMoney(e)}}),t.columnDefs.push({targets:6,orderable:!1,className:"text-right",title:"变动比例",name:"proportion",data:"proportion",width:"60px",render:function(e,t,a,r){return a.changeThreshold<Math.abs(a.proportion)?'<span style="color: red">'+e+"%</span>":e+"%"}}),t.columnDefs.push({targets:7,orderable:!1,className:"text-right",title:"变动金额",name:"subtract",data:"subtract",width:"60px",render:function(e,t,a,r){return formatMoney(e)}}),t.columnDefs.push({targets:8,orderable:!1,className:"text-right",title:"占利润总额比重",name:"profVal",data:"profVal",width:"60px",render:function(e,t,a,r){return a.profitsValue<Math.abs(a.profVal)?'<span style="color:red;"> '+e+"%</span>":e+"%"}}),t.columnDefs.push({targets:9,orderable:!1,className:"text-center",title:"是否需要分析变动原因",name:"subtract",data:"subtract",width:"60px",render:function(e,t,a,r){return a.profitsValue<Math.abs(a.profVal)&&a.changeThreshold<Math.abs(a.proportion)?'<span style="color: red">是</span>':"否"}}),t.columnDefs.push({targets:10,orderable:!1,className:"text-left",title:"变动原因",name:"finallyChangeReason",data:"finallyChangeReason",width:"300px"}),t})(),a.localParam.data=t.zc,r.localParam.data=t.lr,BdoDataTable("zc_report_table",a),void BdoDataTable("lr_report_table",r)}bdoInfoBox("提示",e.resultInfo.statusText)}});(()=>{$(e.region).empty().append(t),i(),$("#ar_title").text("最终分析性复核");let r="   <span>【"+e.type+"】</span>";$("#ar_title").append(r),OneUI.initHelper("slimscroll"),(()=>{ComboDicOptionNew($("#unusual_industry_period"),ComboLocalDicOption(!1,"WindPeriod"));(new Date).getFullYear();a=window.CUR_PROJECT_ACC_YEAR,$("#unusual_industry").treecombo({url:"cpBase/TreeCommon.findIndustry2Tree.json",params:{},view:{leafIcon:"fa fa-building text-flat",nodeIcon:"fa fa-bank text-primary-light",folderSelectable:!0,multiSelect:!1}}),$.ajax({type:"get",url:"finCenter/analysis.findIndustry.json",bdolxLoader:!1,data:{param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID},dataType:"json",success:function(e){if(e.success){var t=e.data[0].aa,a=e.data[0].aacode;$("#unusual_industry").treecombo("setTreeComboValue",[a,t]),$("#project_industry").html("未审报表中的行业指标为上年行业数据，审定报表中的行业指标为本年行业数据。&nbsp;&nbsp;行业："+t)}}})})()})(),$("#rpt_search").click(function(){i()}),$("#ar_config").click(function(){$("#ar_config_modal").modal("show"),$.ajax({url:"dgCenter/DgProject.queryAnalysisReviewConfig.json",type:"post",data:{param1:e.data.customerId},dataType:"json",success:function(e){if(e.success){let t=e.data[0];$("#assetsValue").val(t.assetsValue),$("#profitsValue").val(t.profitsValue),$("#changeThreshold").val(t.changeThreshold),$("#assets").val(t.assets),$("#profits").val(t.profits)}else console.log("获取初步分析性复核配置信息失败")}}),$("#customerId").val(e.data.customerId),$("#projectId").val(e.data.projectId)}),$("#ar_config_form").formview({display:"tableform-one",column:4,buttons:[{id:"comtemplate_save",icon:"fa-save",style:"btn-primary",text:"&nbsp;保存"},{id:"comtemplate_close",icon:"fa-sign-out",style:"btn-warning",text:"&nbsp;关闭"}],items:[{id:"customerId",type:"input",typeAttr:{type:"hidden"}},{id:"projectId",type:"input",typeAttr:{type:"hidden"}},{id:"assetsValue",label:"占资产总额阈值（默认5%）",html:'<div class="form-material "><input class="form-control" type="number" id="assetsValue" data-toggle="tooltip" data-placement="top" title="" /><label for="assetsValue">占资产总额阈值（默认5%）</label></div>',rowspan:1},{id:"changeThreshold",label:"变动幅度阈值（默认30%）",html:'<div class="form-material "><input class="form-control" type="number" id="changeThreshold" data-toggle="tooltip" data-placement="top" title="" /><label for="changeThreshold">变动幅度阈值（默认30%）</label></div>',rowspan:1},{id:"profitsValue",label:"占利润总额阈值（默认10%）",html:'<div class="form-material "><input class="form-control" type="number" id="profitsValue" data-toggle="tooltip" data-placement="top" title="" /><label for="profitsValue">占利润总额阈值（默认10%）</label></div>',rowspan:1},{id:"assets",type:"input",label:"资产总计科目编号（默认A）",rowspan:1},{id:"profits",type:"input",label:"利润总额科目编号（默认S06）",rowspan:1},{id:"methodTips",label:"判断方式",html:'<div class="form-material"><label style="color: red">占资产总额比重、占利润总额比重、变动比例>相应阈值时，需填写变动原因</label></div>',rowspan:1}]});var d={param2:"",param1:"",param3:{}};$("#zc_report_table,#lr_report_table").on("dblclick","td",function(){if(9!=$(this).closest("td").index())return;let t=$(this).closest("table"),a=t.DataTable().context[0].aoColumns[t.DataTable().cell(this).index().column],r=t.DataTable().row($(this).closest("tr")).data(),l=this.offsetHeight;$(this).html("<span><textarea type='text' style='width:100%; height: "+l+"px;align=right;'></textarea></span>");let s=$(this).find("textarea"),o=r[a.name];o&&s.val(o),s.focus(),s.on("keydown",function(e){13==e.keyCode&&s.blur()}),s.on("blur",function(){let t=$(this).closest("table").DataTable().row($(this).closest("tr")).data(),a=$(this).val();var r=$(this).closest("td");t.finallyChangeReason=a,d.param3[t.colCode]=a,$.ajax({url:"dgCenter/FUnAuditReport.saveChangeReason.json",type:"post",data:{param1:e.data.customerId,param2:2,param3:encodeURIComponent(JSON.stringify(d.param3))},dataType:"json",success:function(e){e.success?(b(),d.param3={},r.html(a),bdoSuccessBox("成功",e.resultInfo.statusText)):(d.param3={},r.html(o),bdoErrorBox("失败",e.resultInfo.statusText))}})})}),$("#comtemplate_close").click(function(){$("#ar_config_modal").modal("hide"),document.getElementById("ar_config_form").reset()}),$("#comtemplate_save").click(function(){$("#assetsValue").val()>1||$("#assetsValue").val()<0?bdoInfoBox("提示","阈值范围请设置0-1之间"):$("#profitsValue").val()>1||$("#profitsValue").val()<0?bdoInfoBox("提示","阈值范围请设置0-1之间"):$("#changeThreshold").val()>1||$("#changeThreshold").val()<0?bdoInfoBox("提示","阈值范围请设置0-1之间"):$.ajax({url:"dgCenter/FUnAuditReport.checkUnAuditReportCode.json",type:"post",data:{param1:$("#assets").val(),param2:$("#profits").val(),param3:window.CUR_CUSTOMERID},dataType:"json",success:function(t){t.success?($("#ar_config_form").formview("setAjaxConf",["dgCenter/DgProject.savaAnalysisReviewConfig.json",{param1:JSON.stringify({assetsValue:$("#assetsValue").val(),profitsValue:$("#profitsValue").val(),changeThreshold:$("#changeThreshold").val(),assets:$("#assets").val(),profits:$("#profits").val()}),param2:e.data.customerId,param3:2},"json",!0,function(e){e.success?(i(),bdoSuccessBox("成功",e.resultInfo.statusText)):bdoErrorBox("失败",e.resultInfo.statusText),$("#ar_config_modal").modal("hide")}]),$("#ar_config_form").submit()):(d.param3={},bdoInfoBox("提示",t.resultInfo.statusText))}})}),$("#zc_report_table,#lr_report_table").on("dblclick","td",function(){1==$(this).closest("td").index()&&$.ajax({url:"dgCenter/FUnAuditReport.findUserSubjectIdByColCode.json",type:"post",data:{param1:e.data.customerId,param2:$(this).text()},dataType:"json",success:function(t){let a="";t.success&&t.data&&(a="&userSubjectCode="+t.data[0].userSubjectId);let r="/Faith/bdologin.do?m=gotoDesktop&menuId=40000006&customerId="+e.data.customerId+"&endYear="+e.data.projectYear+"&startYear="+(e.data.projectYear-1)+a;window.open(r)}})}),$("#rpt_check_analysisReview").on("click",function(){$("#rpt_check_analysisReview").blur();new Date;var e=window.CUR_PROJECT_ACC_YEAR,t="2",a=e-1+"-12-31",r="",l=e+"-12-31";"1"==$("#unusual_industry_period").val()?(t="2",r=e+"-12-31"):"2"==$("#unusual_industry_period").val()?(t="1",r=e+"-03-31"):"3"==$("#unusual_industry_period").val()?(t="1",r=e+"-06-31"):"4"==$("#unusual_industry_period").val()&&(t="1",r=e+"-09-31"),bdoAjaxBox("系统提示","确定完成核对吗？",function(){$.ajax({url:"dgCenter/FUnAuditReport.calculateFinalAnalyticalReview.json",type:"post",data:{param20:"2",param21:t,param22:$("#unusual_industry").attr("data-result"),param23:a,param24:r,param25:l},dataType:"json",success:function(e){e.success?bdoSuccessBox("操作成功",e.resultInfo.statusText):(bdoErrorBox("操作失败",e.resultInfo.statusText),c())}})})});var c=function(){for(var e=$("#zc_report_table").DataTable().data().length,t=0;t<e;t++){if((r=$("#zc_report_table").DataTable().data()[t]).assetsValue<Math.abs(r.assVal)&&r.changeThreshold<Math.abs(r.proportion)&&(null==r.finallyChangeReason||""==r.finallyChangeReason))return $("#report_type").find("li").first().find("a").click(),!1}var a=$("#lr_report_table").DataTable().data().length;for(t=0;t<a;t++){var r;if((r=$("#lr_report_table").DataTable().data()[t]).profitsValue<Math.abs(r.profVal)&&r.changeThreshold<Math.abs(r.proportion)&&(null==r.finallyChangeReason||""==r.finallyChangeReason))return $("#report_type").find("li").first().next().find("a").click(),!1}for(t=0;t<o.length;t++){var l=o[t],s=$("#analysisReason"+l.autoId).val();if("1"==l.isError&&(null==s||""==s))return $("#report_type").find("li").last().find("a").click(),$("#unusual"+l.autoId)[0].scrollIntoView({behavior:"smooth"}),$("#analysisReason"+l.autoId).focus(),!1}};let u=new Page({container:"#analysisReview",events:{"#upload":"click,onUpload","#unusual_search":"click,unusual_search"},init(e){this.uploadWorkpagerPage=createForm(this.uploadWorkpagerPageCfg)},uploadWorkpagerPageCfg:{options:{propsData:{jsonData:{workpager:[],customerId:window.CUR_CUSTOMERID,projectId:window.CUR_PROJECTID,subjectTreeId:e.data.autoId,autoId:null}}},props:{jsonData:Object},display:"tableform-one",column:1,id:"uploadFileForm",data:()=>({ajaxConfig:{type:"POST",url:"dgCenter/DgMain.updateProjDgFile.json",dataType:"json",success(e){e.success?(b(),bdoSuccessBox("成功",e.resultInfo.statusText),$("#uploadTplFormModal").modal("hide"),p()):bdoErrorBox("失败",e.resultInfo.statusText)}},uploadMode:"STD"}),methods:{onUploadDraftFileClick(t){$("#workpager").fileinput("getFilesCount")<=0?bdoErrorBox("失败","当前无任何文件！"):this.uploadFile(!0,{param1:e.data.type,param11:"2",param12:m})},resetFileClick(e){$("#workpager").fileinput("refresh"),$("#workpager").fileinput("clear"),$("#workpager").fileinput("reset")}},buttons:[{id:"resetFileBtn",icon:"fa fa-refresh",style:"btn-primary",text:"重置",typeAttr:{"v-on:click":"resetFileClick"}},{id:"uploadDraftFileBtn",icon:"fa fa-upload",style:"btn-primary",text:"上传",typeAttr:{"v-on:click":"onUploadDraftFileClick"}},{id:"cancelUploadDraftFileBtn",icon:"fa-arrow-left",style:"btn-warning",text:"取消",typeAttr:{"data-dismiss":"modal"}}],items:[{id:"workpager",type:"file",label:"文件",rowspan:1,colspan:2,validate:{rules:{}},typeAttr:{multiple:!0},show:!0,plugin:{name:"fileinput",options:{allowedFileExtensions:["xls","xlsx","xltx","xlsm","xltm","xlsb","xlam","jpg","png","doc","docx","zip","rar","pdf"],uploadUrl:"dgCenter/DgDownload.uploadTempFile.json",uploadExtraData:()=>({})}}}]},uploadWorkpagerPage:null,onUpload(e){e.preventDefault(),u.uploadWorkpagerPage.jsonData.autoId=null,u.uploadMode="STD",$("#uploadTplFormModal").modal("show")},unusual_search(){var e=$("#unusual_industry").attr("data-result");if(null!=e&&""!=e)if("classStandard"!==e){var t=$("#stockPalteSelect").val();if(e.indexOf("GB")>0&&t<=2)bdoErrorBox("错误","抱歉,立信行业分类不支持万得板块数据!");else if(e.indexOf("GB")<0&&t>2)bdoErrorBox("错误","抱歉,非立信行业不支持立信板块数据!");else if(e.length>10&&1!=t)bdoErrorBox("错误","抱歉,万得行业分类暂时仅支持万得A股板块数据!");else{null!==a&&""!==a?($("#projectId").val(CUR_PROJECTID),$("#unusual_slpk").val(CUR_CUSTOMERID),this.createTabUnusual("unusual_chartsProfitForPeriod")):bdoErrorBox("错误","年份不能为空!")}}else bdoErrorBox("错误","请选择具体行业");else bdoErrorBox("错误","请选择行业")},findCompnays(e,t){var a=e.children("option:selected"),r=e.val();e.html(""),ComboSearch(a,r,"cpBase/combo.findCompanys.json",e,!1,{param1:t},!1)},createTabUnusual(e){s=e;var t=a;if(null!==$("#unusual_slpk").val()&&""!==$("#unusual_slpk").val())if(null!==t&&""!==t){var o="2",n=t-1+"-12-31",i="",d=t+"-12-31";"1"==$("#unusual_industry_period").val()?(o="2",l=[t-3+"-12-31",t-2+"-12-31",t-1+"-12-31"],i=t+"-12-31"):"2"==$("#unusual_industry_period").val()?(o="1",l=[t-3+"-12-31",t-2+"-12-31",t-1+"-03-31"],i=t+"-03-31"):"3"==$("#unusual_industry_period").val()?(o="1",l=[t-3+"-12-31",t-2+"-12-31",t-1+"-06-31"],i=t+"-06-31"):"4"==$("#unusual_industry_period").val()&&(o="1",l=[t-3+"-12-31",t-2+"-12-31",t-1+"-09-31"],i=t+"-09-31");var c=$("#projectId").val(),u=l.join(",").toString();null!=c&&""!==c&&l.push("审定报表"),g(r={lockCustomerId:$("#unusual_slpk").val(),lockProjectId:c,param2:u,param4:o,param6:$("#unusual_industry").attr("data-result"),param7:n,param8:i,param9:d,param10:"0",param12:"2"},!0)}else bdoErrorBox("错误","年份不能为空!");else bdoErrorBox("错误","请选择公司")},unusual_clear(){var e=new Date;e.getFullYear(),e.getMonth(),e.getDate();$("#unusual_industry_period").selectpicker("val","1")},updateFileIndexId(e,t,a,r){let l=a.dataTable().api(!0).cell(t).data();if(l!=r&&r){let e=a.dataTable().api(!0).cell(t).row().data();$.ajax({url:"dgCenter/DgMain.updateDgIndexId.json",type:"post",data:{jsonData:JSON.stringify([{autoId:e.autoId,customerId:e.customerId,fileIndexId:r}])},dataType:"json",success(e){e.success?(t.css("padding","6px 8px"),t.html(r),a.dataTable().api(!0).cell(t).data(r)):bdoErrorBox("失败",e.resultInfo.statusText)}})}else l==r&&(t.css("padding","6px 8px"),t.html(r),a.dataTable().api(!0).cell(t).data(r))}});var m;let p=()=>{$.ajax({url:"finCenter/Analysis.queryAnalysisReason.json",type:"post",data:{param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:"2",param4:m},dataType:"json",success(e){if(e.success){if(e.data.length>0){var t=e.data[0];t.autoId;$("#analysisReason").val(t.analysisReason);let l="";for(var a=0;a<t.fileList.length;a++){var r=t.fileList[a];l=l+'         <li class="list-group-item">             <span class="icon fa fa-file-excel-o text-primary-light"></span>             '+r.fileName+'             <span class="fa fa-close text-danger pull-right" id="file'+r.autoId+'" autoId="'+r.autoId+'" fileName="'+r.fileName+'" chartId="'+t.autoId+'" :data-index="index" v-show="delBtnShow"></span>             <span class="fa fa-download text-danger pull-right" autoId="'+r.autoId+'" :data-index="index" ></span>         </li>'}$("#analysisFile"+m).html(l)}}else bdoErrorBox("失败",e.resultInfo.statusText)}})},b=()=>{new Date;var e=window.CUR_PROJECT_ACC_YEAR,t="2",a=e-1+"-12-31",r="",l=e+"-12-31";"1"==$("#unusual_industry_period").val()?(t="2",r=e+"-12-31"):"2"==$("#unusual_industry_period").val()?(t="1",r=e+"-03-31"):"3"==$("#unusual_industry_period").val()?(t="1",r=e+"-06-31"):"4"==$("#unusual_industry_period").val()&&(t="1",r=e+"-09-31"),$.ajax({url:"dgCenter/FUnAuditReport.calculateFinalAnalyticalReview.json",type:"post",data:{param21:t,param22:$("#unusual_industry").attr("data-result"),param23:a,param24:r,param25:l,param26:"2"},dataType:"json",success:function(e){e.success}})};function g(e,t){$.ajax({type:"get",url:"finCenter/analysis.getErrorChartData.json",dataType:"json",data:e,success:function(e){if(e.success){var a=$("#"+s);t&&$("#unusual_chartsTabContent").find(".block-content.row").empty(),o=e.data;for(var r=0;r<e.data.length;r++){var n=[],i=l,d=[],c=[],u={},m=e.data[r],p=s+m.autoId,b="unusual"+m.autoId,g="";let t='<ul class="list-group" style="padding: 10px 5px;" id="analysisFile'+m.autoId+'">';for(var f=0;f<m.fileList.length;f++){var h=m.fileList[f];t=t+'         <li class="list-group-item">             <span class="icon fa fa-file-excel-o text-primary-light"></span>             '+h.fileName+'             <span class="fa fa-close text-danger pull-right" id="file'+h.autoId+'" autoId="'+h.autoId+'" fileName="'+h.fileName+'" chartId="'+m.autoId+'" :data-index="index" v-show="delBtnShow"></span>             <span class="fa fa-download text-danger pull-right" autoId="'+h.autoId+'" :data-index="index" ></span>         </li>'}t+="</ul>",g='<ul class="list-group" style="padding: 10px 5px;">         <li class="list-group-item" id="analysisParamsLi'+m.autoId+'">             <span class="icon fa text-primary-light">             <button class="onSaveParam" autoId="'+m.autoId+'" type="button" style="border: 0px;background-color: #f9f9f9;color: #337ab7;">                 <i class="fa"> 保存</i>             </button>             自定义参数,多个请用逗号隔开</span>             <input class="form-control" autoId="'+m.autoId+'" id="analysisParams'+m.autoId+'" value="'+m.analysisParams+'">         </li>         <li class="list-group-item" id="analysisReasonLi'+m.autoId+'">             <span class="icon fa text-primary-light">             <button class="onSaveUnusual" autoId="'+m.autoId+'" type="button" style="border: 0px;background-color: #f9f9f9;color: #337ab7;">                 <i class="fa"> 保存</i>             </button>             分析原因</span>             <textarea class="form-control" id="analysisReason'+m.autoId+'">'+m.analysisReason+'</textarea>         </li>         <li class="list-group-item">             <button class="onUploadFileUnusual" autoId="'+m.autoId+'" type="button" style="border: 0px;background-color: #f9f9f9;color: #337ab7;">                 <i class="fa fa-upload"> 上传文件</i>             </button>'+t+"         </li>",g+="</ul>",$("#div_"+p).length>0?$("#div_"+p).html('<div id="'+p+'" style="width: 500px;height: 400px" class="col-sm-3 col-xs-3"></div><div id="'+b+'" style="display:inline-block width: 300px;height: 400px" class="col-sm-4 col-xs-4"><div title="'+m.quotaRemark+'" class="si si-question '+(m.analysisParams>""?"red-light":"")+'">'+m.unusualMessage+"</div> "+g+"</div>"):a.append('<div id="div_'+p+'"><div id="'+p+'" style="width: 500px;height: 400px" class="col-sm-3 col-xs-3"></div><div id="'+b+'" style="display:inline-block width: 300px;height: 400px" class="col-sm-4 col-xs-4"><div title="'+m.quotaRemark+'" class="si si-question '+(m.analysisParams>""?"red-light":"")+'">'+m.unusualMessage+"</div> "+g+"</div></div>");for(f=0;f<m.dataList.length;f++){var x=m.dataList[f];n.push(x.field),u[x.field]=f<=2,c.push({type:"value",show:!1});for(var w=[],I=0;I<x.data.length;I++)isNaN(x.data[I])?w.push(x.data[I]):w.push(parseFloat(x.data[I]));var y=x.magicType,v={name:x.field,type:y,stack:x.stock,data:w,label:{normal:{show:!0,position:"top"}},barMaxWidth:"80",barGap:"30%"};"line"!==y&&""===x.stock||(v.label.normal.show=!1),d.push(v)}c[0].show=!0;var _={title:{text:m.chartName,textStyle:{color:"1"==m.isError?"red":"green"}},grid:{top:"20%"},tooltip:{show:!0,trigger:"axis"},legend:{x:"50",data:n,selected:u,y:"10%"},toolbox:{show:!0,feature:{restore:{show:!0}}},calculable:!0,xAxis:{type:"category",data:i,axisLabel:{interval:0,rotate:-30}},yAxis:{type:"value"},series:d};echarts.init(document.getElementById(p)).setOption(_)}}}})}$("#unusual_chartsProfitForPeriod").on("click",".fa-close",function(e){var t=$(e.currentTarget).attr("autoId"),a=$(e.currentTarget).attr("fileName"),r=$(e.currentTarget).attr("chartId");bdoConfirmBox("提示","确认删除文件【"+a+"】?",function(){$.ajax({url:"dgCenter/DgMain.deleteProjDgFile.json",type:"post",data:{param1:t,param2:window.CUR_CUSTOMERID,param11:"2",param12:r,param13:window.CUR_PROJECTID},dataType:"json",success:function(e){e.success?(b(),$("#file"+t).closest("li").remove(),bdoSuccessBox("成功",e.resultInfo.statusText)):bdoErrorBox("失败",e.resultInfo.statusText)}})})}),$("#unusual_chartsProfitForPeriod").on("click",".onUploadFileUnusual",function(e){var t=$(e.currentTarget).attr("autoId");$("#uploadTplFormModal").modal("show"),m=t}),$("#unusual_isShowAll").on("change",function(e){$(this).prop("checked")?r.param10="1":r.param10="0",r.param13="",g(r,!0)}),$("#unusual_chartsProfitForPeriod").on("click",".onSaveParam",function(e){var t=$(e.currentTarget).attr("autoId");bdoConfirmBox("保存","确认保存？",function(){$.ajax({url:"finCenter/Analysis.saveAnalysisParams.json",type:"post",data:{param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:"2",param4:t,param5:$("#analysisParams"+t).val()},dataType:"json",success:function(e){e.success?(bdoSuccessBox("成功",e.resultInfo.statusText),r.param13=t,g(r,!1)):bdoErrorBox("失败",e.resultInfo.statusText)}})})}),$("#unusual_chartsProfitForPeriod").on("click",".onSaveUnusual",function(e){var t=$(e.currentTarget).attr("autoId");bdoConfirmBox("保存","确认保存？",function(){$.ajax({url:"finCenter/Analysis.saveAnalysisReason.json",type:"post",data:{param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:"2",param4:t,param5:$("#analysisReason"+t).val()},dataType:"json",success:function(e){e.success?(bdoSuccessBox("成功",e.resultInfo.statusText),b()):bdoErrorBox("失败",e.resultInfo.statusText)}})})}),$("#unusual_chartsProfitForPeriod").on("click",".fa-download",function(e){var t,a,r=$(e.currentTarget).attr("autoId");t={param1:r,param2:window.CUR_CUSTOMERID},a=(e=>{downloadFile("dgCenter/DgDownload.downloadProjDgFile.json",{param1:r,param2:window.CUR_CUSTOMERID})}),$.ajax({url:"dgCenter/DgMain.queryProjDgFileExist.json",type:"post",data:t,dataType:"json",success(e){e.success?a(e):bdoErrorBox("失败",e.resultInfo.statusText)}})}),$("#unusual_tab").one("click",function(){u.unusual_search()}),$("#rpt_export").click(function(){$("#unusual_tab").click(),$.ajax({url:"dgCenter/ExportOtherDg.exportAnalysis.json",data:r,type:"post",dataType:"json",success:function(e){if(e.success){if(e.data&&e.data.length>0){let t=e.data[0].fileData,a=e.data[0].fileName;e.data[0].isNew,bdoInfoBox("成功",a+"导出成功！"),saveAs(dataURLtoFile(t,a),a)}getSubjecttree({param1:window.CUR_PROJECTID,param2:$("#onlyMyselfCheckBox").get(0).checked?"1":""},e=>{$(".js-tree-collapsed").trigger("rebuild",[{data:[e.data[0].treeData],levels:3,callback(e){$.each(e.findNodes(),(t,a)=>{"PAR"==a.extraOptions.nodeType&&(e.expandNode(a.nodeId,{levels:a.deep+2,silent:!0}),e.selectNode(a.nodeId,{silent:!0}))})}}])})}else bdoErrorBox("失败",e.resultInfo&&e.resultInfo.statusText)}})})});var adjustDetailTab=function(e,t,a,r,l,s,o,n){$("#"+e+' li a[href="#tab_adjustdetail"]').css("display","block"),$("#tab_adjustdetail").empty(),$("#"+e+"_content").append('<div class="tab-pane" id="tab_adjustdetail"></div>');$("#tab_adjustdetail").append('<div class=""><div class="block block-bordered"><div class="block-header bg-primary"><ul class="block-options"><li><button id="adjustDetail_export" type="button"><i class="si si-cloud-download" style="color: white;">&nbsp;导出</i></button></li></ul><h3 class="block-title">调整明细</h3></div><div class="block-content"><table id="adjustDetail_tab" class="table table-bordered table-hover"></table>\t</div></div></div>'),$("#"+e+' a[href="#tab_adjustdetail"]').click(),"TA03"==l&&(o="FA10084");var i=DgAdjustPage({handleFlag:"1",data:{extraOptions:{}}}).tableModel;i.localParam.urlparam={menuId:window.sys_menuId,sqlId:o,param1:window.CUR_CUSTOMERID,param2:a,param3:r,param4:l,param5:window.CUR_PROJECTID,param6:a,param7:n||""},BdoDataTable("adjustDetail_tab",i),$("#adjustDetail_export").click(function(){let e=$.extend(!0,{},i);e.localParam.urlparam.sqlId="FA10082",exportExcel(this,"调整明细",e,"adjustDetail_tab")})};function MergeTB(e){var t,a;t=e.template||tplLoader("dgCenter/html/dg/mergeTB.html"),e.template=t,$(e.region).html(t),$("#headtitle").empty().text(e.data.text),e.findMaxIndex=function(){$.ajax({url:"dgCenter/DgGeneral.query.json",dataType:"json",async:!0,data:{menuId:window.sys_menuId,sqlId:"DG00038",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param4:"1"},success:function(t){t.success&&t.data&&t.data[0]&&(e.maxIndex=t.data[0].maxIndex)}})};Counteract({region:"#sideRegin",data:e,adjustTyle:"1"});let r;$("#sideRegin").hide();let l="";uiBlocksApi(!1,"init"),$("#search_customerId").val(window.CUR_CUSTOMERID+"-"+window.CUR_CUSTOMERNAME),l=window.CUR_PROJECT_ACC_YEAR;let s=$(".js-tree-collapsed").treeview(!0).getSelected()[0];$("#title_index").text("【"+s.extraOptions.indexId+"】"),$("#headtitle").empty().text("合并试算平衡表"),$("#cus_select2").text("【"+window.CUR_PROJECTNAME+"   "+l+"-"+window.CUR_PROJECT_START_MONTH+"~"+l+"-"+window.CUR_PROJECT_END_MONTH+"】"),OneUI.initHelper("slimscroll");let o="tb_tab",n="tb_tbcheck";let i={localParam:{tabNum:!1,data:[],urlparam:{menuId:window.sys_menuId}},tableParam:{scrollY:!1,select:!0,lengthChange:!0,dom:'<"row"<"col-sm-12"tr>>',serverSide:!0,rowReorder:{update:!1},columnDefs:[]}},d={localParam:{tabNum:!1,data:[],url:"dgCenter/FTBSubjectContract.tbList.json",urlparam:{menuId:window.sys_menuId}},tableParam:{scrollX:!0,scrollY:!1,select:!0,lengthChange:!0,dom:'<"row"<"col-sm-12"tr>>',serverSide:!0,rowReorder:{update:!1},columnDefs:[]}},c={localParam:{tabNum:!1,url:"dgCenter/DgGeneral.query.json",urlparam:{}},tableParam:{select:!0,lengthChange:!1,dom:'<"row"<"col-sm-12"tr>><"row"<"col-sm-6"i><"col-sm-6">>',ordering:!0,fixedThead:!0,fixedHeight:"480px",rowGroup:{dataSrc:"indexId",startRender:null,endRender:function(e,t){$(e.nodes()).css("background","white"),$(e.nodes()).each(function(t,a){t?$(this).find("td").eq(0).hide():$(this).find("td").eq(0).attr("rowspan",e[0].length)});var a=$(e.nodes()).last().next();1==a.children().length&&a.remove();var r=$("#"+$(e.nodes()).eq(0).closest("table").attr("id")+"_info b"),l=$(e.nodes()).eq(0).closest("table");e[0][0]||r.html(0),r.html(parseInt(r.html())+1),l.find("td").css("border-width","1px")}},serverSide:!0,columnDefs:[{targets:1,className:"text-left adjust-row-text",title:"索引号",orderable:!1,name:"indexId",data:"indexId",width:"100px",render:function(e,t,a,r){return"<span title="+e+">"+e+"</span>"}},{targets:2,className:"text-left adjust-row-text",orderable:!1,title:"摘要",name:"digest",data:"digest",width:"200px",render:function(e,t,a,r){return"<span title="+e+">"+e+"</span>"}},{targets:3,className:"text-left adjust-row-text",orderable:!1,title:"TB科目名称",name:"tbSubjectName",data:"tbSubjectName",width:"100px",render:function(e,t,a,r){return"<span title="+e+">"+e+"</span>"}},{targets:4,className:"text-left adjust-row-text",title:"TB科目编号",orderable:!1,name:"tbSubjectCode",data:"tbSubjectCode",width:"60px",render:function(e,t,a,r){return"<span title="+e+">"+e+"</span>"}},{targets:5,className:"text-right adjust-row-text",title:"借方金额",orderable:!1,name:"deb",data:"deb",width:"80px",render:function(e,t,a,r){return a.direction>0?formatMoney(a.occValue):""}},{targets:6,className:"text-right adjust-row-text",orderable:!1,title:"贷方金额",name:"cre",data:"cre",width:"80px",render:function(e,t,a,r){return a.direction<0?formatMoney(a.occValue):""}},{targets:7,className:"text-center",orderable:!1,title:"状态",name:"ACTIVE_FLAG",data:"ACTIVE_FLAG",renderer:"getDicLabelByVal|activeFlag",width:"45px",render:function(e,t,a,r){return DicVal2Nm(e,"activeFlag")}},{targets:8,className:"text-left adjust-row-text",orderable:!1,title:"未调整原因",name:"reason",data:"reason",width:"200px",render:function(e,t,a,r){return"<span title="+(e=e||"")+">"+e+"</span>"}},{targets:9,className:"text-center",orderable:!1,title:"调整年份",name:"yyyy",data:"yyyy",width:"100px",render:function(e,t,a,r){return"<span title="+e+">"+e+"</span>"}},{targets:10,className:"text-center",orderable:!1,title:"制单人",name:"__ufillUserName",data:"__ufillUserName",width:"100px",render:function(e,t,a,r){return"<span title="+a.__ufillUserNameName+">"+a.__ufillUserNameName+"</span>"}},{targets:11,className:"text-center",orderable:!1,title:"最后更新时间",name:"lastUpdateDate",data:"lastUpdateDate",width:"130px",render:function(e,t,a,r){return'<span title="'+e+'">'+e+"</span>"}}]}};function u(){let e=window.CUR_PROJECT_ACC_YEAR,t=$('#tb_type li[class="active"] a').prop("id");t&&"cur_tb"!==t&&(e=l-1),$.ajax({type:"post",url:"dgCenter/HbMergeTb.tbListAndCheck.json",data:{menuId:window.sys_menuId,param1:window.CUR_CUSTOMERID,param2:e,param3:e,param4:$("#showContract").val()},dataType:"json",success:function(e){if($("#"+n).hasClass("dataTable")&&($("#"+n).DataTable().clear(),$("#"+n).DataTable().destroy(),$("#"+n).empty()),$("#"+o).hasClass("dataTable")&&($("#"+o).DataTable().clear(),$("#"+o).DataTable().destroy(),$("#"+o).empty()),e.success){let t=e.data[0],a=$.extend(!0,{},d);a.tableParam=function(e){if(e){let t={select:!0,dom:'<"row"<"col-sm-12"tr>>',serverSide:!0,lengthChange:!1,ordering:!1,scrollX:!0,fixedColumns:!0,columnDefs:[{targets:1,orderable:!1,className:"text-center width-seq",title:"序号",visible:!0,render:function(e,t,a,r){return r.settings._iDisplayStart+r.row+1}},{targets:2,orderable:!1,className:"text-left width-subject-id",title:"TB科目编号",name:"colCode",data:"colCode"},{targets:3,className:"text-left width-subject-name",orderable:!1,title:"科目名称",name:"colDisp",data:"colDisp",render:function(e,t,a,r){return e.indexOf("合计")>0||e.indexOf("总计")>0?"<b>"+e+"</b>":"&nbsp;&nbsp;&nbsp;&nbsp;"+e}}]},a=4;for(let r=0;r<e.length;r++)t.columnDefs.push({targets:a+r,orderable:!1,className:"text-right width-je",title:e[r],name:e[r],data:e[r],render:function(e,t,a,r){let l;return'<label style="font-size: 10px;position: relative;top:5px;">'+(l=null!=e&&void 0!=e&&""!=e&&"Null"!=e?formatMoney(e):0==e&&"0"==e?0:"--")+"</label>"}});return t.columnDefs.push({targets:e.length+4,orderable:!1,className:"text-right width-je",title:"汇总数",name:"totalNumber",data:"totalNumber",render:function(e,t,a,r){let l;return'<label style="font-size: 10px;position: relative;top:5px;">'+(l=null!=e&&void 0!=e&&""!=e&&"Null"!=e?formatMoney(e):0==e&&"0"==e?0:"--")+"</label>"}}),t.columnDefs.push({targets:e.length+5,orderable:!1,className:"text-right width-je",title:"借方抵消",name:"debtor",data:"debtor",render:function(e,t,a,r){let l;return'<label style="font-size: 10px;position: relative;top:5px;">'+(l=null!=e&&void 0!=e&&""!=e&&"Null"!=e?formatMoney(e):0==e&&"0"==e?0:"--")+"</label>"}}),t.columnDefs.push({targets:e.length+6,orderable:!1,className:"text-right width-je",title:"贷方抵消",name:"credit",data:"credit",render:function(e,t,a,r){let l;return'<label style="font-size: 10px;position: relative;top:5px;">'+(l=null!=e&&void 0!=e&&""!=e&&"Null"!=e?formatMoney(e):0==e&&"0"==e?0:"--")+"</label>"}}),t.columnDefs.push({targets:e.length+7,orderable:!1,className:"text-right width-je",title:"合并数",name:"numberMerger",data:"numberMerger",render:function(e,t,a,r){let l;return'<label style="font-size: 10px;position: relative;top:5px;">'+(l=null!=e&&void 0!=e&&""!=e&&"Null"!=e?formatMoney(e):0==e&&"0"==e?0:"--")+"</label>"}}),t}}(t.colNames),a.localParam.data=t.tbData,BdoDataTable(o,a);let r=$.extend(!0,{},i);r.localParam.data=t.checkResult,r.tableParam=function(e){let t={scrollY:!1,select:!0,lengthChange:!1,dom:'<"row"<"col-sm-12"tr>>',serverSide:!1,columnDefs:[{targets:1,className:"text-left",title:"校验项",orderable:!1,name:"colDisp",data:"colDisp",width:"422px"}]},a=1;t.columnDefs.push({targets:++a,orderable:!1,className:"text-right",title:e+"年<br>未审数",name:"unAuditAmount",data:"unAuditAmount",width:"180px",render:function(e,t,a,r){return 0==e?'<div width="100%" style="text-align: center">平<div>':null!=e?formatMoney(e):void 0}}),t.columnDefs.push({targets:++a,orderable:!1,className:"text-right",title:e+"年<br>审计调整数",name:"adjustAmount",data:"adjustAmount",width:"180px",render:function(e,t,a,r){return 0==e?'<div width="100%" style="text-align: center">平<div>':null!=e?formatMoney(e):void 0}}),t.columnDefs.push({targets:++a,orderable:!1,className:"text-right",title:e+"年<br>审定数",name:"auditAmount",data:"auditAmount",width:"180px",render:function(e,t,a,r){return 0==e?'<div width="100%" style="text-align: center">平<div>':null!=e?formatMoney(e):void 0}});let r=e-1;return t.columnDefs.push({targets:++a,orderable:!1,className:"text-right",title:r+"年<br>未审数",name:"preUnAuditAmount",data:"preUnAuditAmount",width:"180px",render:function(e,t,a,r){return 0==e?'<div width="100%" style="text-align: center">平<div>':null!=e?formatMoney(e):void 0}}),t.columnDefs.push({targets:++a,orderable:!1,className:"text-right",title:r+"年<br>审计调整数",name:"preAdjustAmount",data:"preAdjustAmount",width:"180px",render:function(e,t,a,r){return 0==e?'<div width="100%" style="text-align: center">平<div>':null!=e?formatMoney(e):void 0}}),t.columnDefs.push({targets:++a,orderable:!1,className:"text-right",title:r+"年<br>审定数",name:"preAuditAmount",data:"preAuditAmount",width:"180px",render:function(e,t,a,r){return 0==e?'<div width="100%" style="text-align: center">平<div>':null!=e?formatMoney(e):void 0}}),t}(l),BdoDataTable(n,r)}else{if(e.data&&e.data.length>0)return void bdoConfirmBox("提示",e.resultInfo.statusText,function(){bdoInProcessingBox("生成中"),$.ajax({type:"post",url:"dgCenter/HbMergeTb.createTb.json",data:{param1:window.CUR_CUSTOMERID},dataType:"json",success:function(e){e.success?(bdoSuccessBox("操作成功",e.resultInfo.statusText),u()):bdoErrorBox("操作失败",e.resultInfo.statusText)}})});bdoInfoBox("提示",e.resultInfo.statusText)}}})}var m=function(){var e={localParam:{tabNum:!0,url:"cpBase/General.query.json",urlparam:{sqlId:"DG00057",menuId:window.sys_menuId,start:-1,limit:-1,param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID}},tableParam:{select:!0,lengthChange:!1,dom:'<"row"<"col-sm-12"tr>>',order:[1,"ASC"],setCol:!0,ordering:!1,serverSide:!0,fixedColumns:!1,rowReorder:{update:!1},columnDefs:[{targets:1,className:"text-left width-subject-id",index:1,title:"处理",data:null,render:function(e,t,a,r){var l='<button class="btn btn-xs btn-success table-btn-operate" type="button" name="user_tb_edit" data-placement="top" title="修改 " data-toggle="tooltip"><i class="fa fa-edit"></i></button>&nbsp;';return l+='<button class="btn btn-xs btn-danger table-btn-operate" type="button" name="user_tb_delete" data-placement="top" title="删除 " data-toggle="tooltip"><i class="fa fa-times"></i></button>&nbsp;',l+='<input name="autoId" value="'+a.autoId+'" hidden/>'}},{targets:2,index:2,className:"text-left width-subject-id",title:"TB科目编号",name:"tbSubjectId",data:"tbSubjectId"},{targets:3,index:3,className:"text-left width-subject-name",title:"TB科目名称",name:"tbSubjectName",data:"tbSubjectName"},{targets:4,index:4,className:"text-left width-subject-name",title:"报表科目编号",name:"reportSubjectId",data:"reportSubjectId"},{targets:5,index:5,className:"text-left width-subject-name",title:"报表科目名称",name:"reportSubjectName",data:"reportSubjectName"},{targets:6,index:6,className:"text-left width-calfun",title:"计算公式",name:"calFun",data:"calFun",render:function(e,t,a,r){if(null!=e){if(e.length>35){for(var l='<span title="'+e+'">',s=0;s<e.length/35;s++)l+=e.substring(33*s,33*(s+1))+"<br/>";return l+="</span>"}return"<span>"+e+"</span>"}return"<span></span>"}},{targets:7,index:7,className:"text-center width-subject-name",title:"是否科目",name:"isSubject",data:"isSubject",render:function(e,t,a,r){return e?"是":"否"}},{targets:8,index:8,className:"text-center width-seq",title:"排序号",name:"sortNo",data:"sortNo"}]}};BdoDataTable("user_tb_table",e)},p={localParam:{tabNum:!1,url:"cpBase/General.query.json",urlparam:{sqlId:"FA40046",menuId:window.sys_menuId,start:-1,limit:-1,param3:"0",param4:"0",param5:window.CUR_CUSTOMERID,param6:window.CUR_PROJECTID}},tableParam:{select:!0,dom:'<"row"<"col-sm-6"i><"col-sm-6">><"row"<"col-sm-12"tr>>',serverSide:!0,dom:'<"row"<"col-sm-12"tr>>',infoCallback:function(e,t,a,r,l,s){var o=$(this).attr("id"),n=$("#tbsubject_table").DataTable().data(),i=0;if(n.length>0&&(i=n[0].already),!document.getElementById(o+"_info_next"))return'<div class="dataTables_info" id="'+o+'_info" role="status" aria-live="polite">'+s+' &nbsp;已对照 ：<span class="tableRefresh" id="'+o+'_info_next">'+i+"</span></div>"},createdRow(e,t,a){$(e).find("td:eq(3)").addClass("bg-success-light")},columnDefs:[{targets:1,className:"text-left",orderable:!1,title:"报表科目编号",name:"colCode",data:"colCode",width:"50px"},{targets:2,className:"text-left",orderable:!1,title:"报表科目名称",name:"colDisp",data:"colDisp",width:"100px"},{targets:3,className:"text-left",title:"TB科目",name:"tbSubject",data:"tbSubject",width:"200px",render:function(e,t,a,r){return'<span style="width:auto; display:block; white-space:nowrap;text-overflow:ellipsis; overflow:hidden" title="'+(e=e||"")+'">'+e+"</span>"}},{targets:4,className:"text-left",orderable:!1,title:"报表计算公式",name:"cusCalFun",data:"cusCalFun",width:"100px"}]}},b=function(){$("#com_reportSubject").unbind(),$("#com_reportSubject").treecombo({url:"cpBase/TreeCommon.findReportSubject.json",params:{param9:g},view:{leafIcon:"fa fa-building text-flat",nodeIcon:"fa fa-bank text-primary-light",folderSelectable:!1,multiSelect:!1}}),$("#com_isSubject").html(ComboLocalDicOption(!1,"boolean"))},g="-1";function f(e){if(!e)return[];return e.replace(/[-+*\/()]/g," ").split(/\s+/).filter(e=>e.replace(/\d/g,"")&&e.replace(/\d+\.\d+/g,""))}l=window.CUR_PROJECT_ACC_YEAR,a=(()=>{$("#tb_search").click(function(){$("#tb_search").blur(),u()}),$("#download-offset-template").click(function(){let e={param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param4:8};exportExcelWithTemplate("./dgCenter/HbMergeTb.downloadOffsetTemplate.json",e)}),$("#tb_type li").click(function(){$("#tb_type li").removeClass("active"),$(this).addClass("active"),u()}),$("#user_tb_table").on("click",'button[name="user_tb_delete"]',function(){var e=$("#user_tb_table").DataTable().data()[$(this).closest("tr").index()];if(new RegExp("S001|S002|S003|S004|S005|S006|TA01|TA02|TA03|TB01|TB02|TB03|TB04|TB05|TB06|TB07|TB08|TB09|TB10|TB11|TB12|TB13|TC01|TC02|TC03|TC04|TC05|TC06|TC07|TC08|TC09").test(e.tbSubjectId))return void bdoInfoBox("提示信息","该科目是必须包含的科目项，禁止删除!");let t=new Map;$.ajax({url:"cpBase/General.query.json",type:"post",async:!1,data:{sqlId:"DG00216",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,start:-1,limit:-1},dataType:"json",success:function(e){e.success?e.data.forEach(e=>t.set(e.tbSubjectId,f(e.calFun))):bdoErrorBox("失败",e.resultInfo.statusText)}});let a="";t.forEach((t,r)=>{t.includes(e.tbSubjectId)&&(a=r)}),a?bdoErrorBox("提示",`该科目已被科目【${a}】中的公式引用，不能删除！`):bdoAjaxBox("系统提示","确定要删除对照吗?",function(){$.ajax({type:"post",url:"dgCenter/FTBSubjectContract.deleteTBSubject.json",data:{param1:e.autoId,param2:e.tbSubjectId,param3:e.tbSubjectName,param4:e.sortNo},dataType:"json",success:function(e){$("#user_tb_table").DataTable().ajax.reload(),e.success?bdoSuccessBox("删除成功",e.resultInfo.statusText):bdoErrorBox("删除失败",e.resultInfo.statusText)}})})}),$("#user_tb_table").on("click",'button[name="user_tb_edit"]',function(){var e=$("#user_tb_table").DataTable().data()[$(this).closest("tr").index()];$("#com_autoId").val(e.autoId),$("#com_subjectId").val(e.tbSubjectId),$("#com_subjectName").val(e.tbSubjectName),b(),$("#com_isSubject").val(e.isSubject+""),$("#com_calFun").val(e.calFun),e.isSubject?($("#com_calFun").prop("disabled",!0),$("#com_reportSubject").prop("disabled",!1)):($("#com_calFun").prop("disabled",!1),$("#com_reportSubject").prop("disabled",!0)),$("#com_reportSubject").treecombo("setTreeComboValue",[e.reportSubjectId,e.reportSubjectName]),$("#user_tb_detail").modal("show")}),$("#user_tb_add").on("click",function(){$("#com_autoId").val(""),$("#com_subjectId").val(""),$("#com_subjectName").val(""),b(),$("#com_isSubject").val(1),$("#com_calFun").val(""),$("#com_calFun").prop("disabled",!0),$("#com_reportSubject").prop("disabled",!1),$("#user_tb_detail").modal("show")}),$("#tab3").on("click",function(){m(),$("#tab_tbList").hide(),$("#tab_tb_offset").hide(),$("#tab_tb_options").show()}),$("#tab2").click(function(){$("#tab_tb_options").hide(),$("#tab_tb_offset").hide(),$("#tab_tbList").show(),$("#tb_search").click()}),$("#li_tb_offset").click(function(){$("#tab_tb_options").hide(),$("#tab_tbList").hide(),$("#tab_tb_offset").show(),c.localParam.urlparam={menuId:window.sys_menuId,sqlId:"DG00296",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:window.CUR_PROJECT_ACC_YEAR-1,param4:window.CUR_PROJECT_ACC_YEAR,param5:2},BdoDataTable("tb_offset_table",c)}),$("#user_tb_change").on("click",function(){$("#user_tb_change").blur(),"1"==$("#user_tb_change").attr("data-item-index")?($("#user_tb_change").attr("data-item-index",0),m()):($("#user_tb_change").attr("data-item-index",1),$.ajax({url:"dgCenter/DgAdjust.findProjectInfo.json",type:"post",async:!0,data:{param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:window.CUR_PROJECT_ACC_YEAR},dataType:"json",success:function(e){if(e.success){let t=e.data[0].tbTemplate,a=e.data[0].tbReportTemplate;p.localParam.urlparam.param1=t,p.localParam.urlparam.param2=a,BdoDataTable("user_tb_table",p)}else bdoErrorBox("提示",e.resultInfo.statusText)}}))});var e={param2:"",param1:"",param3:{}};$("#user_tb_table").on("dblclick","td",function(){let t=$("#user_tb_change").attr("data-item-index");if(3==$(this).closest("td").index()&&"1"===t){let t=$(".js-calfun-err"),a=t.attr("old-value")||"";t.removeClass("js-calfun-err").val(a),t.parent().html("<span style='color:green;'>"+a+"</span>");let r=$(this).closest("table"),l=r.DataTable().context[0].aoColumns[r.DataTable().cell(this).index().column],s=r.DataTable().row($(this).closest("tr")).data()[l.name]||"";$(this).html(`<span><input type='text' old-value="${s}" style='width:100%; align=right;'></span>`);let o=$(this).find("input");s&&o.val(s),o.focus(),o.on("keydown",function(e){13==e.keyCode&&o.blur()}),o.on("blur",function(){let t=$(this).closest("table").DataTable().row($(this).closest("tr")).data(),a=$(this).val();e.param1=p.localParam.urlparam.param1,e.param2=p.localParam.urlparam.param2,e.param3[t.colCode]=t;if(/[~!@#$%^&\\|,.<>?"'();:_=\[\]{}]/.test(a))bdoErrorBox("失败","公式只支持四则运算");else{if(null!=t.tbSubject&&t.tbSubject,!function(e,t){if(""===t)return!0;var a=t,r=!0,l=e;return l=l.split(","),["+","-","*","/"].find(e=>{a.indexOf(e)>-1&&(a=function(e){return e.replace(/(\+|\-|\*|\/)+/g,",")}(a))}),a.split(",").forEach(e=>{let t=e.trim();for(let e=0;e<l.length;e++){if(l[e].startsWith(t+"-")){r=!0;break}r=!1}}),r}(t.tbSubject,a))return $(o).addClass("js-calfun-err"),bdoErrorBox("失败","当前报表公式中报表科目未与TB科目对照"),!1;t.cusCalFun=a.trim(),$(this).parent().html("<span style='color:green;'>"+a+"</span>"),$.ajax({url:"dgCenter/DgAdjust.addProjectTBFun.json",type:"post",data:{param1:e.param1,param2:e.param2,param3:encodeURIComponent(JSON.stringify(e.param3))},dataType:"json",success:function(t){$("#tbsubject_table").DataTable().ajax.reload(),isSort=!1,t.success?(e.param3={},bdoSuccessBox("成功",t.resultInfo.statusText)):(e.param3={},bdoErrorBox("失败",t.resultInfo.statusText))}})}})}}),$("#user_tb_form").on("change","#com_isSubject",function(e){"是"===$("#com_isSubject option:selected").text()&&$("#com_calFun").val("")}),$("#user_tb_form").formview({display:"tableform-one",column:4,buttons:[{id:"comSubject_save",icon:"fa-save",style:"btn-primary",text:"&nbsp;保存"},{id:"comSubject_close",icon:"fa-sign-out",style:"btn-warning",text:"&nbsp;关闭"}],items:[{id:"com_autoId",type:"input",typeAttr:{type:"hidden"}},{id:"com_subjectId",type:"input",label:"科目编号",validate:{rules:{required:!0}}},{id:"com_subjectName",type:"input",label:"科目名称",validate:{rules:{required:!0}}},{id:"com_isSubject",type:"select",label:"是否科目项",validate:{rules:{required:!0}},rowspan:1,colspan:2},{id:"com_calFun",type:"input",label:"计算公式",validate:{rules:{required:!1}},rowspan:1,colspan:2},{id:"com_reportSubject",type:"input",label:"对应报表科目",validate:{rules:{required:!1}},rowspan:1,colspan:2}]}),$("#com_reportSubject").on("focus",function(){b()}),$("#comSubject_save").on("click",function(){let e=$("#com_subjectId").val(),t=$("#com_subjectName").val();if(!new RegExp(/^[A-Za-z].*/).test(e))return bdoInfoBox("提示","科目编号必须以字母开头!"),!1;if(/[~!@#$%^&*\\|,.<>?"'();:_+\-=\[\]{}\/]/.test(e))return bdoInfoBox("提示","科目编号不能包含特殊字符!<br/>~!@#$%^&*|,.<>?\"'();:_+-=[]{}/!"),!1;if(/[~!@#$%^&*\\|,.<>?"'();:_+\-=\[\]{}\/]/.test(t))return bdoInfoBox("提示","科目名称不能包含特殊字符!<br/>~!@#$%^&*|,.<>?\"'();:_+-=[]{}/!"),!1;if(new RegExp(/[A-Za-z].*[0-9]|[0-9].*[A-Za-z]/).test($("#com_subjectId").val())){let t=$("#com_calFun").val();if(t){let a=f(t);for(let t=0;t<a.length;t++)if(e===a[t])return bdoInfoBox("提示",`公式有误，不能有自身科目编号【${e}】!`),!1;let r=new Map;$.ajax({url:"cpBase/General.query.json",type:"post",async:!1,data:{sqlId:"DG00216",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,start:-1,limit:-1},dataType:"json",success:function(e){e.success?e.data.forEach(e=>r.set(e.tbSubjectId,e.calFun)):bdoErrorBox("失败",e.resultInfo.statusText)}});for(let e=0;e<a.length;e++)if(!r.has(a[e]))return bdoInfoBox("提示",`公式有误，不能有不存在的科目编号【${a[e]}】!`),!1;$("#com_reportSubject").val(""),$("#com_reportSubject").attr("data-result","")}$.ajax({url:"dgCenter/FTBSubjectContract.saveTBSubject.json",type:"post",data:{param1:$("#com_autoId").val(),param2:$("#com_subjectId").val(),param3:function(e){return e.replace(/\s/g,"")}($("#com_subjectName").val()),param4:$("#com_reportSubject").attr("data-result"),param5:$("#com_reportSubject").val(),param6:$("#com_isSubject").val(),param7:encodeURIComponent($("#com_calFun").val())},dataType:"json",success:function(e){e.success?(bdoSuccessBox("成功",e.resultInfo.statusText),$("#user_tb_table").DataTable().ajax.reload(),$("#user_tb_detail").modal("hide")):bdoErrorBox("失败",e.resultInfo.statusText)}})}else bdoInfoBox("提示","科目编号必须包含数字和字母!")}),$("#com_isSubject").on("change",function(){1==$(this).val()?($("#com_calFun").val(""),$("#com_calFun").prop("disabled",!0),$("#com_reportSubject").prop("disabled",!1)):($("#com_calFun").prop("disabled",!1),$("#com_reportSubject").prop("disabled",!0))}),$("#tbSubject_sort").on("click",function(){bdoConfirmBox("提示","是否按当前表格顺序保存",function(){var e=[];let t=$("#user_tb_table tbody tr");for(let a=0;a<t.length;a++)e.push($(t[a]).find('[name="autoId"]').val());$.ajax({url:"dgCenter/FTBSubjectContract.sortTbSubject.json",type:"post",data:{param1:e.toString()},dataType:"json",success:function(e){$("#user_tb_table").DataTable().ajax.reload(),e.success?bdoSuccessBox("成功",e.resultInfo.statusText):bdoErrorBox("失败",e.resultInfo.statusText)}})})}),$("#btn_tb_search").on("click",function(){$("#btn_tb_search").blur(),$("#user_tb_table").DataTable().ajax.reload()}),$("#tb_offset_table").on("click",'button[name="adDelete"]',function(){let e=$(this).parent().find('button[name="offset_autoId"]').text();$.ajax({url:"dgCenter/HbElimination.deleteOffset.json",type:"post",data:{param1:e},success:function(e){$("#tb_offset_table").DataTable().ajax.reload(),e.success?bdoSuccessBox("成功",e.resultInfo.statusText):bdoErrorBox("失败",e.resultInfo.statusText)}})}),$("#btn_offset_search").click(function(){$("#li_tb_offset").click()})}),(()=>{$("#tb-init-merge-template").hide(),$("#tab_tb_options").hide(),$("#tab_tb_offset").hide(),$.ajax({url:"dgCenter/DgAdjust.findProjectInfo.json",type:"post",async:!0,data:{param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID},dataType:"json",success:function(e){e.data&&e.data[0].tbTemplate&&e.data[0].tbReportTemplate&&(g=e.data[0].tbReportTemplate)}}),$('#tb_type li a[id="cur_tb"]').addClass("active"),u(),$.ajax({type:"post",url:"dgCenter/DgProject.getProjectMember.json",data:{param1:window.CUR_PROJECTID,param2:window.CUR_CUSTOMERID},dataType:"json",success(e){if(e.success){let t='<option value="" label="" />';e.data.map(e=>{r==e.id?t+='<option style="color: #000000"  value="'+e.id+'" label="'+e.name+'" selected />':t+='<option style="color: #000000"  value="'+e.id+'" label="'+e.name+'" />'}),$("#tb_editer").append(t)}else $("#tb_editer").val(""),bdoInfoBox("提示",e.resultInfo.statusText)}}),a()})()}var voucherTab=function(e,t,a,r,l,s){clearVoucherTab(e);var o={};$("#"+e).append('<li><a href="#tab_voucherdetail">凭证详细&nbsp;&nbsp;<i class="fa fa-times-circle"></i></a></li>');$("#"+e+"_content").append('<div class="tab-pane" id="tab_voucherdetail"></div><div id="tab_voucherdetail_sampling"></div><div class="modal fade" id="modal_selectProject" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static" data-keyboard="false">     <div class="modal-dialog modal-md">                                                                                                               <div class="modal-content">                                                                                                                       <div class="block block-themed block-transparent remove-margin-b">                                                                                <div class="block-header bg-info">                                                                                                                <ul class="block-options">                                                                                                                        <li>                                                                                                                                              <button class="btn btn-md btn-primary" type="button" id="modal_selectProject_sure">                                                               <i class="fa fa-hand-lizard-o" title="选择"></i>                                                                                         </button>                                                                                                                                 </li>                                                                                                                                         <li>                                                                                                                                              <button type="button" data-dismiss="modal">                                                                                                       <i class="si si-close"></i>                                                                                                               </button>                                                                                                                                 </li>                                                                                                                                     </ul>                                                                                                                                         <h3 class="block-title">选择项目</h3>                                                                                                     </div>                                                                                                                                    </div>                                                                                                                                        <div class="modal-body" style="min-height: 500px; max-height: 500px">                                                                             <div id="selectProject_tree"></div>                                                                                                       </div>                                                                                                                                    </div>                                                                                                                                    </div>                                                                                                                                    </div>                                                                                                                                        '),$("#"+e+' a[href="#tab_voucherdetail"]').find(".fa-times-circle").click(function(){$("#modal_selectProject").remove(),$(this).parents("ul").find("li").first().find("a").click(),$(this).parents("li").remove(),$("#tab_voucherdetail").remove(),$("#tab_voucherdetail_sampling").remove()}),$("#tab_voucherdetail").empty();if($("#tab_voucherdetail").html('<div class="content"><label class="css-input switch switch-sm switch-primary"><input type="checkbox" id="show_assItem" value=""><span></span></label>显示核算<div class="block block-bordered"><div class="block-header bg-primary"><ul class="block-options"><li><button id="voucherDetail_sampling" type="button"><i class="fa fa-hand-lizard-o" style="color: white;" title="抽凭"></i></button></li><li><button id="voucherDetail_setTran" type="button"><i class="fa fa-random" style="color: white;" title="设置结转"></i></button></li><li><button id="voucherDetail_cancelTran" type="button"><i class="fa fa-undo" style="color: white;" title="取消结转"></i></button></li><li><button id="voucherDetail_export" type="button"><i class="si si-cloud-download" style="color: white;" title="导出"></i></button></li></ul><h3 class="block-title"><span id="oldvoucherId"></span></h3> </div><div class="block-content"><table id="voucherDetail_tab" class="table table-bordered table-hover"></table>\t<div><br><div class="row"><div class="col-sm-3">财务主管:<span id="voucher_director"></span></div><div class="col-sm-3">记账人:<span id="voucher_keepUser"></span></div><div class="col-sm-3">审核人:<span id="voucher_auditUser"></span></div><div class="col-sm-3">制单人:<span id="voucher_fillUser"></span></div></div></div><br></div></div></div>'),$("#oldvoucherId").html("凭证日期："+l+"&emsp;&emsp;&emsp;&emsp;&emsp;凭证号："+a+r),$("#"+e+' a[href="#tab_voucherdetail"]').click(),r&&""!=r)var n=1,i={localParam:{tabNum:!0,url:"finCenter/SubjectEntry.getSubjectEntryDetailView.json",urlparam:{menuId:window.sys_menuId,jsonData:JSON.stringify({vchDate:l,voucherId:s,typeId:a,oldVoucherId:r,showAssItem:"0"}),lockCustomerId:t,lockYyyy:l.substr(0,4)}},tableParam:{param1:"jsq",select:!0,lengthChange:!1,dom:'<"row"<"col-sm-6"i><"col-sm-6">><"row"<"col-sm-12"tr>><"row"<"col-sm-6"i><"col-sm-6">>',ordering:!1,serverSide:!0,infoCallback:fnInfoCallback,rowReorder:{update:!1},fixedThead:!0,fixedHeight:"500px",columnDefs:[{targets:n++,orderable:!1,className:"text-left",title:'<label class="css-input css-checkbox css-checkbox-primary css-checkbox-sm"><input id="checkAll" onclick="checkAll(this);" type="checkbox" value=""><span></span></label>',data:null,width:"10px",render:function(e,t,a,r){var l="";return"0"==a.type&&(l+='<div align="center"><label class="css-input css-checkbox css-checkbox-primary css-checkbox-sm"><input type="checkbox" name="chkEntry" value="'+a.serail+'"><span></span></label></div>'),l}},{targets:n++,className:"hidden",title:"分录号",name:"serail",data:"serail",width:"10px"},{targets:n++,className:"text-left",title:"摘要",name:"summary",data:"summary",width:"200px",render:function(e,t,a,r){return e&&e.length>15?'<span title="'+e+'">'+e.substring(0,15)+"...</span>":e}},{targets:n++,className:"text-left",title:"科目编号",name:"subjectId",data:"subjectId",width:"60px"},{targets:n++,className:"text-left",title:"科目名称",name:"subjectFullName",data:"subjectFullName",width:"100px"},{targets:n++,className:"text-right",title:"借方金额",name:"debitOcc",data:"debitOcc",width:"80px",render:function(e,t,a,r){return formatMoney(e)}},{targets:n++,className:"text-right",title:"贷方金额",name:"creditOcc",data:"creditOcc",width:"80px",render:function(e,t,a,r){return formatMoney(e)}},{targets:n++,className:"text-left",title:"汇率",name:"currrate",data:"currrate",width:"30px"},{targets:n++,className:"text-right",title:"外币金额",name:"currValue",data:"currValue",width:"80px",render:function(e,t,a,r){return formatMoney(e)}},{targets:n++,className:"text-left",title:"外币名称",name:"currency",data:"currency",width:"30px"},{targets:n++,className:"text-left",title:"是否结转",name:"isTransferVoucher",data:"isTransferVoucher",width:"20px",render:function(e,t,a,r){var l=e;return"是"==l&&(l='<label style="font-size: 10px;position: relative;top:5px;"><span style="background-color: #53f9f9;width: 100%;position: relative;top: 0px;display: block;">'+l+"</span></label>"),l}}]}};else n=1,i={localParam:{tabNum:!0,url:"finCenter/SubjectEntry.getDetailVoucher.json",urlparam:{menuId:window.sys_menuId,param2:a,param3:s,param4:l,lockCustomerId:t,lockYyyy:l.substr(0,4)}},tableParam:{param1:"jsq",select:!0,lengthChange:!1,dom:'<"row"<"col-sm-6"i><"col-sm-6">><"row"<"col-sm-12"tr>><"row"<"col-sm-6"i><"col-sm-6">>',ordering:!1,serverSide:!0,infoCallback:fnInfoCallback,rowReorder:{update:!1},fixedThead:!0,fixedHeight:"500px",columnDefs:[{targets:n++,orderable:!1,className:"text-left",title:'<label class="css-input css-checkbox css-checkbox-primary css-checkbox-sm"><input id="checkAll" onclick="checkAll(this);" type="checkbox" value=""><span></span></label>',data:null,width:"10px",render:function(e,t,a,r){var l="";return"0"==a.type&&(l+='<div align="center"><label class="css-input css-checkbox css-checkbox-primary css-checkbox-sm"><input type="checkbox" name="chkEntry" value="'+a.serail+'"><span></span></label></div>'),l}},{targets:n++,className:"text-left",title:"分录号",name:"serail",data:"serail",width:"10px"},{targets:n++,className:"text-left",title:"摘要",name:"summary",data:"summary",width:"200px",render:function(e,t,a,r){return e&&e.length>15?'<span title="'+e+'">'+e.substring(0,15)+"...</span>":e}},{targets:n++,className:"text-left",title:"科目编号",name:"subjectId",data:"subjectId",width:"60px"},{targets:n++,className:"text-left",title:"科目名称",name:"subjectFullName",data:"subjectFullName",width:"100px"},{targets:n++,className:"text-right",title:"借方金额",name:"debitOcc",data:"debitOcc",width:"80px",render:function(e,t,a,r){return formatMoney(e)}},{targets:n++,className:"text-right",title:"贷方金额",name:"creditOcc",data:"creditOcc",width:"80px",render:function(e,t,a,r){return formatMoney(e)}},{targets:n++,className:"text-left",title:"汇率",name:"currRate",data:"currRate",width:"30px"},{targets:n++,className:"text-right",title:"外币金额",name:"currValue",data:"currValue",width:"80px",render:function(e,t,a,r){return formatMoney(e)}},{targets:n++,className:"text-left",title:"外币名称",name:"currency",data:"currency",width:"30px"},{targets:n++,className:"text-left",title:"是否结转",name:"isTransferVoucher",data:"isTransferVoucher",width:"20px"}]}};function d(){jsq(i.tableParam,"voucherDetail_tab"),BdoDataTable("voucherDetail_tab",i),$.ajax({type:"post",url:"finCenter/General.query.json",data:{sqlId:"FIN100010",param2:a,param3:r,param4:l,lockCustomerId:t,lockYyyy:l.substr(0,4)},dataType:"json",success:function(e){null!=e&&null!=e.data&&e.data.length>0&&($("#voucher_director").text(e.data[0].director),$("#voucher_keepUser").text(e.data[0].voucherKeepUser),$("#voucher_auditUser").text(e.data[0].voucherAuditUser),$("#voucher_fillUser").text(e.data[0].voucherFillUser))}})}$("#show_assItem").click(function(){$("#show_assItem").is(":checked")?i.localParam.urlparam.jsonData=JSON.stringify({vchDate:l,voucherId:s,typeId:a,oldVoucherId:r,showAssItem:"1"}):i.localParam.urlparam.jsonData=JSON.stringify({vchDate:l,voucherId:s,typeId:a,oldVoucherId:r,showAssItem:"0"}),d()}),$("#voucherDetail_setTran").click(function(){var e="";$('input[name="chkEntry"]:checked').each(function(){e=""==e?$(this).val():e+","+$(this).val()}),""!=e?(bdoInProcessingBox("正在设置结转!"),$.ajax({type:"post",url:"finCenter/SubjectEntry.setTranVoucher.json",data:{param3:s,param4:e,lockCustomerId:t,lockYyyy:l.substr(0,4)},dataType:"json",success:function(e){e.success?(BdoDataTable("voucherDetail_tab",i),bdoSuccessBox("设置成功",e.resultInfo.statusText)):bdoErrorBox("设置失败",e.resultInfo.statusText)}})):bdoInfoBox("提示","请选择分录")}),$("#voucherDetail_cancelTran").click(function(){var e="";$('input[name="chkEntry"]:checked').each(function(){e=""==e?$(this).val():e+","+$(this).val()}),""!=e?(bdoInProcessingBox("正在取消结转!"),$.ajax({type:"post",url:"finCenter/SubjectEntry.cancelTranVoucher.json",data:{param3:s,param4:e,lockCustomerId:t,lockYyyy:l.substr(0,4)},dataType:"json",success:function(e){e.success?(BdoDataTable("voucherDetail_tab",i),bdoSuccessBox("取消结转成功",e.resultInfo.statusText)):bdoErrorBox("取消结转失败",e.resultInfo.statusText)}})):bdoInfoBox("提示","请选择分录")}),$("#voucherDetail_export").click(function(){exportExcelFin(this,"凭证详细",i,"voucherDetail_tab")}),$("#voucherDetail_sampling").click(function(){!function(e,t,a){if(""==e)return void bdoInfoBox("提示","请选择客户");var r="",s=[];if($('input[name="chkEntry"]:checked').each(function(){""==r?(r=$(this).val(),s=$("#voucherDetail_tab").DataTable().data()[$(this).closest("tr").index()]):r=r+","+$(this).val()}),""==r)return void bdoInfoBox("提示","请选择分录");if(r.split(",").length>1)return void bdoInfoBox("提示","只能选择1条分录");o=s,$("#modal_selectProject").modal("show"),$("#modal_selectProject_sure").attr("disabled",!1),$("#selectProject_tree").hasClass("treeview")&&($("#selectProject_tree").tree("reset"),$("#selectProject_tree").tree("destory"));$("#selectProject_tree").tree({url:"cpBase/TreeCommon.findCustomerProject.json",params:{param1:e,param2:t,param3:l},singleSelect:!0,lazyLoad:!1,onceLoad:!0,view:{leafIcon:"fa fa-building text-flat",nodeIcon:"fa fa-bank text-primary-light",folderSelectable:!1,multiSelect:!1,showCheckbox:!1,selectedColor:"#fff",onlyLeafCheck:!0,selectedBackColor:"#4ca2e8",singleSelect:!0}}),a&&$("#modal_selectProject_sure").click(a)}(t,"")}),$("#modal_selectProject_sure").click(function(){let e=function(){$("#modal_tbsubjectid_sure").attr("disabled",!0);var e=$("#selectProject_tree").treeview(!0),t=e.getSelected()[0];if(null==t||""==t)return bdoInfoBox("提示","请选择项目"),$("#modal_selectProject_sure").attr("disabled",!1),!1;{let a={};for(;void 0!=t.parentId;)"project"==t.typeName&&(a.projectId=encodeURI(t.id)),t=e.getParent(t);return a}}();e&&($("#modal_selectProject").modal("hide"),e.samplingType="1",e.customerId=t,e.typeId=a,e.oldVoucherId=r,e.voucherDate=l,e.voucherId=s,e.serail=o.serail,e.subjectId=o.subjectId,$("#tab_voucherdetail_sampling").empty(),SamplingList({region:"#tab_voucherdetail_sampling",data:e}),$("#samplingSet_add").click(),$("#samplingList_method option[value='8']").prop("selected",!0),$("#samplingList_method").change())}),d(),$("#voucherDetail_tab").on("click","td",function(){var e=$(this).text();$(this).attr("class").indexOf("text-right")<0||e.indexOf("%")>=0||""===e||(""==$("#suanshi_voucherDetail_tab").val()?(e.indexOf("-")>=0?$("#suanshi_voucherDetail_tab").val("("+e+")"):$("#suanshi_voucherDetail_tab").val(e),$("#jieguo_voucherDetail_tab").val(e)):(value=$("#suanshi_voucherDetail_tab").val(),jieguo=$("#jieguo_voucherDetail_tab").val(),jieguo.indexOf(",")>=0?numjieguo=parseFloat(jieguo.split(",").join("")):numjieguo=parseFloat(jieguo),e.indexOf(",")>=0?numdata=parseFloat(e.split(",").join("")):numdata=parseFloat(e),e.indexOf("-")>=0?$("#suanshi_voucherDetail_tab").val(value+"+("+e+")"):$("#suanshi_voucherDetail_tab").val(value+"+"+e),$("#jieguo_voucherDetail_tab").val((numjieguo+numdata).toFixed(2).replace(/(\d{1,3})(?=(\d{3})+(?:$|\.))/g,"$1,"))))}),$("#jsq_clear_voucherDetail_tab").on("click",function(){$("#suanshi_voucherDetail_tab").val(""),$("#jieguo_voucherDetail_tab").val("")})},clearVoucherTab=function(e){0!=$("#"+e+' li a[href="#tab_voucherdetail"]').length&&($("#"+e+' a[href="#tab_voucherdetail"]').remove(),$("#tab_voucherdetail").remove(),$("#tab_voucherdetail_sampling").remove(),$("#modal_selectProject").remove())};function checkAll(e){e.checked?($(e).attr("checked","checked"),$("input[name='chkEntry']").each(function(){this.checked=!0})):($(e).removeAttr("checked"),$("input[name='chkEntry']").each(function(){this.checked=!1}))}$($("main .content")[1]).css("min-height","480px");var accountledagerTab=function(e,t,a,r){0!=$("#"+e+' li a[href="#tab_accountledger"]').length&&($("#"+e+' li a[href="#tab_accountledger"]').remove(),$("#tab_accountledger").remove()),$("#"+e).append('<li><a href="#tab_accountledger">科目分类账&nbsp;&nbsp;<i class="fa fa-times-circle"></i></a></li>'),$("#"+e+"_content").append('<div class="tab-pane" id="tab_accountledger"></div>'),$("#"+e+' a[href="#tab_accountledger"]').find(".fa-times-circle").click(function(){$(this).parents("ul").find("li").first().find("a").click(),$(this).parents("li").remove(),$("#tab_accountledger").remove()});$("#tab_accountledger").empty().html('<div class="content"><div class="block block-bordered"><div class="block-header bg-primary"><ul class="block-options"><li><button id="accountledger_export" type="button"><i class="si si-cloud-download" style="color: white;">&nbsp;导出</i></button></li></ul><h3 class="block-title">科目分类账一览</h3></div><div class="block-content"><table id="table_accountledger" class="table table-bordered table-striped table-hover"></table></div></div></div>'),$("#"+e+' a[href="#tab_accountledger"]').click();var l=1,s={localParam:{tabNum:!0,url:"finCenter/Account.getAccountLedager.json",urlparam:{menuId:window.sys_menuId,param3:r,lockCustomerId:t,lockYyyy:a}},tableParam:{param1:"jsq",select:!0,lengthChange:!1,dom:'<"row"<"col-sm-6"i><"col-sm-6">><"row"<"col-sm-12"tr>><"row"<"col-sm-6"i><"col-sm-6">>',ordering:!1,serverSide:!0,infoCallback:fnInfoCallback,fixedThead:!0,fixedHeight:"500px",columnDefs:[{targets:l++,className:"text-left",title:"科目编号",name:"subjectId",data:"subjectId",width:"80px"},{targets:l++,className:"text-left",title:"科目名称",name:"subjectFullName",data:"subjectFullName",width:"150px"},{targets:l++,className:"text-center",title:"科目方向",name:"direction",data:"direction",width:"30px"},{targets:l++,className:"text-center",title:"会计月份",name:"subMonth",data:"subMonth",width:"30px"},{targets:l++,className:"text-right",title:"借方发生金额",name:"debitOcc",data:"debitOcc",width:"150px",render:function(e,t,a,r){return formatMoney(e)}},{targets:l++,className:"text-right",title:"贷方发生金额",name:"creditOcc",data:"creditOcc",width:"150px",render:function(e,t,a,r){return formatMoney(e)}},{targets:l++,className:"text-right",title:"期末金额",name:"balance",data:"balance",width:"150px",render:function(e,t,a,r){return formatMoney(e)}},{targets:l++,className:"text-right",title:"借方结转额",name:"tranDebitOcc",data:"tranDebitOcc",width:"150px",render:function(e,t,a,r){var l=formatMoney(e);return 0!=l&&e!=a.debitOcc&&(l='<label style="font-size: 10px;position: relative;top:5px;"><span style="background-color: #53f9f9;width: 100%;position: relative;top: 0px;display: block;">'+l+"</span></label>"),l}},{targets:l++,className:"text-right",title:"贷方结转额",name:"tranCreditOcc",data:"tranCreditOcc",width:"150px",render:function(e,t,a,r){var l=formatMoney(e);return 0!=l&&e!=a.creditOcc&&(l='<label style="font-size: 10px;position: relative;top:5px;"><span style="background-color: #53f9f9;width: 100%;position: relative;top: 0px;display: block;">'+l+"</span></label>"),l}}]}};jsq(s.tableParam,"table_accountledger"),BdoDataTable("table_accountledger",s),$("#table_accountledger tbody").on("dblclick","tr",function(){var l=$("#table_accountledger").DataTable().data()[$(this).closest("tr").index()];">期初"!=l.subjectFullName&&(">合计"==l.subjectFullName&&""==l.subMonth?(startsubMonth=1,endsubMonth=12):(startsubMonth=l.subMonth,endsubMonth=l.subMonth),accountdetailTab(e,t,a,startsubMonth,a,endsubMonth,r))}),$("#accountledger_export").click(function(){exportExcelFin(this,"科目分类账一览",s,"table_accountledger")}),$("#table_accountledger").on("click","td",function(){var e=$(this).text();$(this).attr("class").indexOf("text-right")<0||e.indexOf("%")>=0||""===e||(""==$("#suanshi_table_accountledger").val()?(e.indexOf("-")>=0?$("#suanshi_table_accountledger").val("("+e+")"):$("#suanshi_table_accountledger").val(e),$("#jieguo_table_accountledger").val(e)):(value=$("#suanshi_table_accountledger").val(),jieguo=$("#jieguo_table_accountledger").val(),jieguo.indexOf(",")>=0?numjieguo=parseFloat(jieguo.split(",").join("")):numjieguo=parseFloat(jieguo),e.indexOf(",")>=0?numdata=parseFloat(e.split(",").join("")):numdata=parseFloat(e),e.indexOf("-")>=0?$("#suanshi_table_accountledger").val(value+"+("+e+")"):$("#suanshi_table_accountledger").val(value+"+"+e),$("#jieguo_table_accountledger").val((numjieguo+numdata).toFixed(2).replace(/(\d{1,3})(?=(\d{3})+(?:$|\.))/g,"$1,"))))}),$("#jsq_clear_table_accountledger").on("click",function(){$("#suanshi_table_accountledger").val(""),$("#jieguo_table_accountledger").val("")})},accountdetailTab=function(e,t,a,r,l,s,o){0!=$("#"+e+' li a[href="#tab_accountdetail"]').length&&($("#"+e+' li a[href="#tab_accountdetail"]').remove(),$("#tab_accountdetail").remove()),$("#"+e).append('<li><a href="#tab_accountdetail">科目明细账&nbsp;&nbsp;<i class="fa fa-times-circle"></i></a></li>'),$("#"+e+"_content").append('<div class="tab-pane" id="tab_accountdetail"></div>'),$("#"+e+' a[href="#tab_accountdetail"]').find(".fa-times-circle").click(function(){$(this).parents("ul").find("li").first().find("a").click(),$(this).parents("li").remove(),$("#tab_accountdetail").remove()});$("#tab_accountdetail").empty().html('<div class="content"><div class="block block-bordered"><div class="block-header bg-primary"><ul class="block-options"><li><button id="accountdetail_export" type="button"><i class="si si-cloud-download" style="color: white;">&nbsp;导出</i></button></li></ul><h3 class="block-title">科目明细账一览</h3></div><div class="block-content"><table id="table_accountdetail" class="table table-bordered table-striped table-hover"></table></div></div></div>'),$("#"+e+' a[href="#tab_accountdetail"]').click();var n=1,i={localParam:{tabNum:!0,url:"finCenter/SubjectEntry.getSubjectEntryView.json",urlparam:{menuId:window.sys_menuId,jsonData:JSON.stringify({startMonth:r,endYyyy:l,endMonth:s,subjectId:o}),lockCustomerId:t,lockYyyy:a}},tableParam:{select:!0,param1:"jsq",lengthChange:!1,dom:'<"row"<"col-sm-6"i><"col-sm-6">><"row"<"col-sm-12"tr>><"row"<"col-sm-6"i><"col-sm-6">>',ordering:!1,serverSide:!0,infoCallback:fnInfoCallback,fixedThead:!0,fixedHeight:"500px",columnDefs:[{targets:n++,className:"text-center",title:"凭证日期",name:"vchDate",data:"vchDate",width:"70px"},{targets:n++,className:"text-left",title:"字",name:"typeId",data:"typeId",width:"20px"},{targets:n++,className:"text-left",title:"系统编号",name:"voucherId",data:"voucherId",width:"20px",visible:!1},{targets:n++,className:"text-left",title:"号",name:"oldVoucherId",data:"oldVoucherId",width:"20px"},{targets:n++,orderable:!0,className:"text-left",title:"科目编号",name:"subjectId",data:"subjectId",width:"80px"},{targets:n++,orderable:!0,className:"text-left",title:"科目名称",name:"subjectFullName",data:"subjectFullName",width:"100px"},{targets:n++,className:"text-left",title:"摘要",name:"summary",data:"summary",width:"200px",render:function(e,t,a,r){return e&&e.length>15?'<span title="'+e+'">'+e.substring(0,15)+"...</span>":e}},{targets:n++,className:"text-left",title:"对方科目",name:"dfkm",data:"dfkm",width:"200px",render:function(e,t,a,r){return e&&e.length>15?'<span title="'+e+'">'+e.substring(0,15)+"...</span>":e}},{targets:n++,className:"text-center",title:"币种",name:"currency",data:"currency",width:"25px"},{targets:n++,className:"text-center",title:"汇率",name:"currRate",data:"currRate",width:"25px",render:function(e,t,a,r){return e?""==e||0==e?"1":e:""}},{targets:n++,className:"text-right",title:"借方发生额",name:"debitOcc",data:"debitOcc",width:"100px",render:function(e,t,a,r){return formatMoney(e)}},{targets:n++,className:"text-right",title:"贷方发生额",name:"creditOcc",data:"creditOcc",width:"100px",render:function(e,t,a,r){return formatMoney(e)}},{targets:n++,title:"余额",className:"text-right",name:"remain",data:"remain",width:"100px",render:function(e,t,a,r){return formatMoney(e)}},{targets:n++,className:"text-right",title:"借方结转额",name:"tranDebitOcc",data:"tranDebitOcc",width:"100px",render:function(e,t,a,r){var l=formatMoney(e);return 0!=l&&(l='<label style="font-size: 10px;position: relative;top:5px;"><span style="background-color: #53f9f9;width: 100%;position: relative;top: 0px;display: block;">'+l+"</span></label>"),l}},{targets:n++,className:"text-right",title:"贷方结转额",name:"tranCreditOcc",data:"tranCreditOcc",width:"100px",render:function(e,t,a,r){var l=formatMoney(e);return 0!=l&&(l='<label style="font-size: 10px;position: relative;top:5px;"><span style="background-color: #53f9f9;width: 100%;position: relative;top: 0px;display: block;">'+l+"</span></label>"),l}}]}};jsq(i.tableParam,"table_accountdetail"),BdoDataTable("table_accountdetail",i),$("#table_accountdetail tbody").on("dblclick","tr",function(){var a=$("#table_accountdetail").DataTable().data()[$(this).closest("tr").index()];a.voucherId&&a.voucherId>""&&voucherTab(e,t,a.typeId,a.oldVoucherId,a.vchDate,a.voucherId)}),$("#accountdetail_export").click(function(){exportExcelFin(this,"科目明细账一览",i,"table_accountdetail")}),$("#table_accountdetail").on("click","td",function(){var e=$(this).text();$(this).attr("class").indexOf("text-right")<0||e.indexOf("%")>=0||""===e||(""==$("#suanshi_table_accountdetail").val()?(e.indexOf("-")>=0?$("#suanshi_table_accountdetail").val("("+e+")"):$("#suanshi_table_accountdetail").val(e),$("#jieguo_table_accountdetail").val(e)):(value=$("#suanshi_table_accountdetail").val(),jieguo=$("#jieguo_table_accountdetail").val(),jieguo.indexOf(",")>=0?numjieguo=parseFloat(jieguo.split(",").join("")):numjieguo=parseFloat(jieguo),e.indexOf(",")>=0?numdata=parseFloat(e.split(",").join("")):numdata=parseFloat(e),e.indexOf("-")>=0?$("#suanshi_table_accountdetail").val(value+"+("+e+")"):$("#suanshi_table_accountdetail").val(value+"+"+e),$("#jieguo_table_accountdetail").val((numjieguo+numdata).toFixed(2).replace(/(\d{1,3})(?=(\d{3})+(?:$|\.))/g,"$1,"))))}),$("#jsq_clear_table_accountdetail").on("click",function(){$("#suanshi_table_accountdetail").val(""),$("#jieguo_table_accountdetail").val("")})};function ecportToDg(e,t,a,r){""!=e?($("#modal_tbsubjectid").modal("show"),$("#modal_tbsubjectid_sure").attr("disabled",!1),$("#tbsubject_tree").hasClass("treeview")&&($("#tbsubject_tree").tree("reset"),$("#tbsubject_tree").tree("destory")),$("#tbsubject_tree").tree({url:"cpBase/TreeCommon.findTbSubjectType.json",params:{param1:e,param2:t},singleSelect:!0,lazyLoad:!1,onceLoad:!0,view:{leafIcon:"fa fa-building text-flat",nodeIcon:"fa fa-bank text-primary-light",folderSelectable:!1,multiSelect:!1,showCheckbox:!1,selectedColor:"#fff",onlyLeafCheck:!0,selectedBackColor:"#4ca2e8",singleSelect:!0}}),r&&$("#modal_tbsubjectid_sure").click(r)):bdoInfoBox("提示","请选择客户")}function huoqunode(){$("#modal_tbsubjectid_sure").attr("disabled",!0);var e=$("#tbsubject_tree").treeview(!0),t=e.getSelected()[0];if(null==t||""==t)return bdoInfoBox("提示","请选择底稿附件"),$("#modal_tbsubjectid_sure").attr("disabled",!1),!1;{let a={};for(;void 0!=t.parentId;)"filesubject"==t.typeName&&(a.filesubject=encodeURI(t.qtip),a.workpaperId=encodeURI(t.value)),"shenjisubject"==t.typeName&&(a.shenjisubject=encodeURI(t.label)),"project"==t.typeName&&(a.treeproject=encodeURI(t.id)),t=e.getParent(t);return a}}function jsq(e,t){e.initComplete=function(a,r){if(e&&"jsq"==e.param1){var l='<div class="row"><div class="col-sm-8"><div class="form-material"><input id="suanshi_'+t+'"  type="text" style="width: 100%" autocomplete="off"></div></div><div class="col-sm-1"><div class="form-material">=</div></div><div class="col-sm-2"><div class="form-material input-group"><input id="jieguo_'+t+'" type="text" style=" width: 100%" autocomplete="off"></div></div><div class="col-sm-1"><div class="form-material"><input type="button" class="btn btn-md btn-primary" style="font-size:medium;padding:1px" id="jsq_clear_'+t+'" value="reset"></input></div></div></div>';$("#"+t+"_wrapper").append(l),$("#jsq_clear_"+t).unbind(),$("#jsq_clear_"+t).on("click",function(){$("#suanshi_"+t).val(""),$("#jieguo_"+t).val("")})}var s=$(this),o=s.attr("id");$("#"+o+"_info_next").off(),$("#"+o+"_info_next").on("click",function(){s.DataTable().ajax.reload()})}}function jsqcorresponding(e){var t='<div class="row"><div class="col-sm-8"><div class="form-material"><input id="suanshi_'+e+'"  type="text" style="width: 100%" autocomplete="off"></div></div><div class="col-sm-1"><div class="form-material">=</div></div><div class="col-sm-2"><div class="form-material input-group"><input id="jieguo_'+e+'" type="text" style=" width: 100%" autocomplete="off"></div></div><div class="col-sm-1"><div class="form-material"><input type="button" class="btn btn-md btn-primary" style="font-size:medium;padding:1px" id="jsq_clear_'+e+'" value="reset"></input></div></div></div>';$("#"+e).prev().html("").append(t)}function jsqsamevoucher(e){var t='<div class="row"><div class="col-sm-8"><div class="form-material"><input id="suanshi_'+e+'"  type="text" style="width: 100%" autocomplete="off"></div></div><div class="col-sm-1"><div class="form-material">=</div></div><div class="col-sm-2"><div class="form-material input-group"><input id="jieguo_'+e+'" type="text" style=" width: 100%" autocomplete="off"></div></div><div class="col-sm-1"><div class="form-material"><input type="button" class="btn btn-md btn-primary" style="font-size:medium;padding:1px" id="jsq_clear_'+e+'" value="reset"></input></div></div></div>';$("#"+e+"_count").prev().html("").append(t)}function fnInfoCallback(e,t,a,r,l,s){var o=$(this).attr("id");return $(o+"_info_next").length,'<div class="dataTables_info" id="'+o+'_info" role="status" aria-live="polite">共 <b>'+l+'</b>条 <a class="tableRefresh" id="'+o+'_info_next"><i class="fa fa-refresh" style="cursor:pointer;">刷新</i></a></div>'}function MergeUnAuditReport(e){var t,a;t=e.template||tplLoader("dgCenter/html/dg/mergeUnAuditReport.html"),e.template=t,$(e.region).html(t),$("#headtitle").empty().text(e.data.text);var r=window.CUR_PROJECT_ACC_YEAR,l="",s="";let o;pageRightTitle(pageTitleArr);var n={qy:{1:{},2:{}}};let i={localParam:{tabNum:!1,url:"dgCenter/DgGeneral.query.json",urlparam:{}},tableParam:{select:!0,lengthChange:!1,dom:'<"row"<"col-sm-12"tr>><"row"<"col-sm-6"i><"col-sm-6">>',ordering:!0,fixedThead:!0,fixedHeight:"480px",rowGroup:{dataSrc:"indexId",startRender:null,endRender:function(e,t){$(e.nodes()).css("background","white"),$(e.nodes()).each(function(t,a){t?$(this).find("td").eq(0).hide():$(this).find("td").eq(0).attr("rowspan",e[0].length)});var a=$(e.nodes()).last().next();1==a.children().length&&a.remove();var r=$("#"+$(e.nodes()).eq(0).closest("table").attr("id")+"_info b"),l=$(e.nodes()).eq(0).closest("table");e[0][0]||r.html(0),r.html(parseInt(r.html())+1),l.find("td").css("border-width","1px")}},serverSide:!0,columnDefs:[{targets:1,className:"text-left adjust-row-text",title:"索引号",orderable:!1,name:"indexId",data:"indexId",width:"100px",render:function(e,t,a,r){return"<span title="+e+">"+e+"</span>"}},{targets:2,className:"text-left adjust-row-text",orderable:!1,title:"摘要",name:"digest",data:"digest",width:"200px",render:function(e,t,a,r){return"<span title="+e+">"+e+"</span>"}},{targets:3,className:"text-left adjust-row-text",orderable:!1,title:"科目名称",name:"tbSubjectName",data:"tbSubjectName",width:"100px",render:function(e,t,a,r){return"<span title="+e+">"+e+"</span>"}},{targets:4,className:"text-left adjust-row-text",title:"科目编号",orderable:!1,name:"tbSubjectCode",data:"tbSubjectCode",width:"60px",render:function(e,t,a,r){return"<span title="+e+">"+e+"</span>"}},{targets:5,className:"text-right adjust-row-text",title:"借方金额",orderable:!1,name:"deb",data:"deb",width:"80px",render:function(e,t,a,r){return a.direction>0?formatMoney(a.occValue):""}},{targets:6,className:"text-right adjust-row-text",orderable:!1,title:"贷方金额",name:"cre",data:"cre",width:"80px",render:function(e,t,a,r){return a.direction<0?formatMoney(a.occValue):""}},{targets:7,className:"text-center",orderable:!1,title:"状态",name:"ACTIVE_FLAG",data:"ACTIVE_FLAG",renderer:"getDicLabelByVal|activeFlag",width:"45px",render:function(e,t,a,r){return DicVal2Nm(e,"activeFlag")}},{targets:8,className:"text-left adjust-row-text",orderable:!1,title:"未调整原因",name:"reason",data:"reason",width:"200px",render:function(e,t,a,r){return"<span title="+(e=e||"")+">"+e+"</span>"}},{targets:9,className:"text-center",orderable:!1,title:"调整年份",name:"yyyy",data:"yyyy",width:"100px",render:function(e,t,a,r){return"<span title="+e+">"+e+"</span>"}},{targets:10,className:"text-center",orderable:!1,title:"制单人",name:"__ufillUserName",data:"__ufillUserName",width:"100px",render:function(e,t,a,r){return"<span title="+a.__ufillUserNameName+">"+a.__ufillUserNameName+"</span>"}},{targets:11,className:"text-center",orderable:!1,title:"最后更新时间",name:"lastUpdateDate",data:"lastUpdateDate",width:"130px",render:function(e,t,a,r){return'<span title="'+e+'">'+e+"</span>"}}]}};Counteract({region:"#sideRegin",data:e,adjustTyle:"1"}),$("#sideRegin").hide();var d={id:"zc_report1_table",showType:"1",TABLE_DIV:"1",showZero:"2",rptName:{1:"资产负债表",3:"利润表",4:"现金流量表",5:"所有者权益变动表"}};uiBlocksApi(!1,"init"),$.ajax({url:"dgCenter/DgAdjust.findProjectInfo.json",type:"post",async:!0,data:{param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:window.CUR_PROJECT_ACC_YEAR},dataType:"json",success:function(e){e.success?(l=e.data[0].tbReportTemplate,s=e.data[0].tbReportTemplateName,o=e.data[0].ext.unReportEditer,CUR_USERID==o&&$("#rpt_adjustReport").show(),$.ajax({type:"post",url:"dgCenter/DgProject.getProjectMember.json",data:{param1:window.CUR_PROJECTID,param2:window.CUR_CUSTOMERID},dataType:"json",success(e){if(e.success){let t='<option value="" label="" />';e.data.map(e=>{t+='<option style="color: #000000"  value="'+e.id+'" label="'+e.name+'" />'}),$("#report_editer").append(t),$("#report_editer").val(o)}else $("#report_editer").val(""),bdoErrorBox(e.resultInfo.statusText)}})):bdoErrorBox("提示",e.resultInfo.statusText)}});let c=$(".js-tree-collapsed").treeview(!0).getSelected()[0];$("#unReportIndex").text("【"+c.extraOptions.indexId.substring(0,c.extraOptions.indexId.indexOf("-"))+"-"+DG_CONST_UNAUDITREPORT_ENDING+"】");var u={localParam:{tabNum:!1,url:"dgCenter/FUnAuditReport.unAuditReport.json",urlparam:{menuId:window.sys_menuId,start:-1,refreshFlg:"1"}},tableParam:{select:!0,lengthChange:!0,serverSide:!0,scrollY:!1,dom:'<"row"<"col-sm-12"tr>>',columnDefs:[]}};var m=function(){$.ajax({url:"dgCenter/HbMergeReport.queryCashFlowStatement.json",type:"post",data:{start:-1,menuId:window.sys_menuId},dataType:"json",success:function(e){if(e.success){let t=e.resultInfo.statusText,a=e.data[0];if(t&&bdoInfoBox("提示",t),a){let e=$.extend(!0,{},u);e.tableParam=p(a.colNames);let t=$.extend(!0,{},u);t.tableParam=p(a.colNames),e.localParam.data=a.cur,t.localParam.data=a.pre,BdoDataTable("xj_report_table_1",e),BdoDataTable("xj_report_table_2",t)}}else bdoErrorBox("失败",e.resultInfo.statusText)}})};function p(e){if(e){let t={select:!0,dom:'<"row"<"col-sm-12"tr>>',serverSide:!0,lengthChange:!1,ordering:!1,scrollX:!0,fixedColumns:!0,columnDefs:[{targets:1,orderable:!1,className:"text-center width-seq",title:"序号",visible:!0,render:function(e,t,a,r){return r.settings._iDisplayStart+r.row+1}},{targets:2,orderable:!1,className:"text-left width-subject-id",title:"科目编号",name:"colCode",data:"colCode"},{targets:3,className:"text-left width-subject-name",orderable:!1,title:"科目名称",name:"colDisp",data:"colDisp",render:function(e,t,a,r){return e.indexOf("合计")>0||e.indexOf("总计")>0?"<b>"+e+"</b>":e.replace(/ /g,"&nbsp;")}}]},a=4;for(let r=0;r<e.length;r++)t.columnDefs.push({targets:a+r,orderable:!1,className:"text-right width-je",title:e[r],name:e[r],data:e[r],render:function(e,t,a,r){let l;return'<label style="font-size: 10px;position: relative;top:5px;">'+(l=null!=e&&void 0!=e&&""!=e&&"Null"!=e?formatMoney(e):0==e&&"0"==e?0:"--")+"</label>"}});return t.columnDefs.push({targets:e.length+4,orderable:!1,className:"text-right width-je",title:"汇总数",name:"totalNumber",data:"totalNumber",render:function(e,t,a,r){let l;return'<label style="font-size: 10px;position: relative;top:5px;">'+(l=null!=e&&void 0!=e&&""!=e&&"Null"!=e?formatMoney(e):0==e&&"0"==e?0:"--")+"</label>"}}),t.columnDefs.push({targets:e.length+5,orderable:!1,className:"text-right width-je",title:"借方抵消",name:"debtor",data:"debtor",render:function(e,t,a,r){let l;return'<label style="font-size: 10px;position: relative;top:5px;">'+(l=null!=e&&void 0!=e&&""!=e&&"Null"!=e?formatMoney(e):0==e&&"0"==e?0:"--")+"</label>"}}),t.columnDefs.push({targets:e.length+6,orderable:!1,className:"text-right width-je",title:"贷方抵消",name:"credit",data:"credit",render:function(e,t,a,r){let l;return'<label style="font-size: 10px;position: relative;top:5px;">'+(l=null!=e&&void 0!=e&&""!=e&&"Null"!=e?formatMoney(e):0==e&&"0"==e?0:"--")+"</label>"}}),t.columnDefs.push({targets:e.length+7,orderable:!1,className:"text-right width-je",title:"合并数",name:"numberMerger",data:"numberMerger",render:function(e,t,a,r){let l;return'<label style="font-size: 10px;position: relative;top:5px;">'+(l=null!=e&&void 0!=e&&""!=e&&"Null"!=e?formatMoney(e):0==e&&"0"==e?0:"--")+"</label>"}}),t}}Promise.resolve().then(()=>{OneUI.initHelper("slimscroll")}),a=(()=>{$('#subPageRight  [data-toggle="tabs"]').on("click","a",function(e){e.preventDefault(),$("#abs-remain").hasClass("active")?$(this).tab("show"):("tab_unAuditReport"==$(this).closest("ul").attr("id")&&$(this).parent().index()>1?$("#tab_head_rpt").hide():$("#tab_head_rpt").show(),$(this).tab("show"))}),$('#subPageRight [data-toggle="tabs"]').on("shown.bs.tab",function(e){var t=$("#tab_unAuditReport").find("li[class=active] a");d.showType=t.attr("data-content"),window.showType=d.showType;var a=t.attr("data-result"),r=$("#"+a).find("li[class=active] a");d.id=r.attr("data-result"),d.TABLE_DIV=r.attr("data-content")}),$("#tab_unAuditReport_content").on("dblclick","table tbody tr.edit-able td",function(){let e="";if($(this).hasClass("bg-success-light"))e=1;else if($(this).hasClass("bg-gray-light"))e=2;else{if(!$(this).hasClass("bg-gray-lighter"))return;e=3}var t=$(this).closest("td"),a=(t.parent().index(),t.closest("table"));if(!(a.attr("id").indexOf("qy_report")>=0)){a.find("tr").length;for(var l=a.DataTable().context[0].aoColumns[a.DataTable().cell(this).index().column],s=a.DataTable().row($(this).closest("tr")).data(),o=t.next(),i=o.text(),c=t.prev().text(),u=0;u<c.length/3;u++)c=c.replace(",","");for(u=0;u<i.length/3;u++)i=i.replace(",","");var m=!1;if(3!=d.TABLE_DIV&&4!=d.TABLE_DIV||(l.name.indexOf("remain")>=0||l.name.indexOf("unAuditAmount")>=0)&&(m=!0),(3==e||1==e)&&(l.name.indexOf("customerAmount")>=0||l.name.indexOf("customerRemain")>=0||m)){if(1!=s.colType)return;if(s.colDisp.indexOf("合计")>0||s.colDisp.indexOf("总计")>0)return;var p=s[l.name];t.html("<span><input type='text' style='width:100%; align=right;'></span>");var b=$(this).find("input");return 0!=p&&b.val(p),b.focus(),b.on("keydown",function(e){13==e.keyCode&&b.blur()}),void b.on("blur",function(){let e=$(this).val().toString().replace(/,/g,"");function a(e){for(var t=(e=e.toFixed(2)).split(".")[0],a=e.split(".")[1],r=t.toString().replace(/,/g,""),l="",s="",o=r.length-1;o>=0;o--)s++,l=r.charAt(o)+l,s%3||0==o||(l=","+l);return t>0?"-"+l+"."+a:(","==(l=l.replace("-",""))[0]&&(l=l.replace(",","")),l+"."+a)}if(""==e)t.html(0),m||(i-p<0?o.html("<span style='color:green;'>-"+a(i-p)+"</span>"):i-p>0&&o.html("<span style='color:green;'>"+a(i-p)+"</span>"));else if(isNaN(e))t.html(p);else{var r=1*e;if(t.html(r.toFixed(2)),!m)if((u=c-r)<0){var d="<span style='color:green;'>"+(u=a(u))+"</span>";o.html(d)}else if(u>0){d="<span style='color:green;'>"+(u=a(u))+"</span>";o.html(d)}else{var u;d="<span>"+(u=a(u))+"</span>";o.html(d)}}if(t.html()!=s[l.name]){s[l.name]=t.html();var b=l.name.substring(0,l.name.length-4),g={};s.colCode in n&&(g=n[s.colCode]),g[b]=s[l.name],n[s.colCode]=g}})}2==e&&(l.name.indexOf("adjustAmount")>=0||l.name.indexOf("adjustRemain")>=0)&&("1"==d.showType?adjustDetailTab("tab_unAuditReport",window.CUR_CUSTOMERID,r,1,s.colCode,s.colCode,"FA10065",DG_CONST_UNAUDITREPORT_BEGINNING):"2"==d.showType&&adjustDetailTab("tab_unAuditReport",window.CUR_CUSTOMERID,r,1,s.colCode,s.colCode,"FA10065",DG_CONST_UNAUDITREPORT_BEGINNING))}}),$("#rpt_search").click(function(){$("#rpt_search").blur(),m(d.showType)}),$("#rpt_importCustomerReport").click(function(){$("#modal-importCustomerReport").modal("show");var e={dropZoneEnabled:!1,dropZoneTitle:"",dropZoneClickTitle:"",browseLabel:"选择文件",showCaption:!0,showRemove:!1,showUpload:!1,showBrowse:!0,showPreview:!1,required:!0,initialPreviewShowDelete:!0,language:"zh",browseOnZoneClick:!0,showClose:!1,showCancel:!1,hideThumbnailContent:!0,layoutTemplates:{actionUpload:"",actionZoom:""},fileActionSettings:{removeIcon:'<i class="glyphicon glyphicon-remove text-danger"></i>'},uploadAsync:!0,allowedFileExtensions:["xls","xlsx","xltx","xlsm","xltm","xlsb","xlam","jpg","png","doc","docx","zip","rar","pdf"],uploadUrl:"dgCenter/FUnAuditReport.uploadCustomerReport.json",uploadExtraData:function(){return{param1:"",param2:""}},uploadExtraData:function(){return{param1:window.CUR_CUSTOMERID+"-"+window.CUR_CUSTOMERNAME,param2:r,param3:r,param4:l+"-"+s}}},t=$("#fileinput").fileinput(e);t.on("fileuploaded",function(e,t){t.response.success?function(e){$.ajax({type:"post",url:"dgCenter/FUnAuditReport.importCustomerReport.json",data:{param1:e.response.data[0].id},dataType:"json",success:function(e){e.success?(bdoSuccessBox("导入成功"),$("#modal-importCustomerReport").modal("hide"),$("#fileinput").fileinput("clear"),$("#fileinput").fileinput("enable"),$("#rpt_search").click()):bdoErrorBox("失败",e.resultInfo.statusText)}})}(t):bdoErrorBox("失败",t.response.resultInfo.statusText)}),t.on("fileuploaderror",function(e,t,a){$("#fileinput").fileinput("clear"),$("#fileinput").fileinput("enable"),bdoErrorBox("系统提示",a)}),$("#import_submit").click(function(){t.fileinput("upload")})}),$("#import_dlTemplate").click(function(){if(l){var e={id:"1",menuId:"40000040",mainDatasSql:"FA40017",detailDatasSql:"FA40016",param1:window.CUR_CUSTOMERNAME,param2:r,param3:l,param4:s,param5:""};exportExcelWithTemplate("./dgCenter/FUnAuditReportTemplate.createExcelFile1.json",e)}else bdoErrorBox("提示","请先配置报表模板")}),$("#tab1").on("click","a",function(){JSON.stringify(n)!==JSON.stringify({qy:{1:{},2:{}}})&&$("#rpt_save").click(),$("#unReportIndex").text("【"+c.extraOptions.indexId.substring(0,c.extraOptions.indexId.indexOf("-"))+"-"+DG_CONST_UNAUDITREPORT_ENDING+"】"),$($("#report1_type li")[3]).show(),$("#tab_head_rpt").show(),m()}),$("#tab1").click(function(){$("#tab_report_offset").hide(),$("#tab_head_rpt").show(),$("#tab_unAuditReportser").show(),m()}),$("#li_report_offset").click(function(){$("#tab_unAuditReportser").hide(),$("#tab_head_rpt").hide(),$("#tab_report_offset").show(),i.localParam.urlparam={menuId:window.sys_menuId,sqlId:"DG00296",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:window.CUR_PROJECT_ACC_YEAR-1,param4:window.CUR_PROJECT_ACC_YEAR,param5:3},BdoDataTable("report_offset_table",i)}),$("#btn_rpt_offset_search").click(function(){$("#li_report_offset").click()})}),(()=>{a(),m()})()}function MergeTrialBalance(e){let t,a,r,l,s;a=e.data,t=e.template||tplLoader("dgCenter/html/dg/mergeproject/mergeTrialBalance.html"),e.template=t,$(e.region).html(t),$("#headtitle").empty().text(e.data.text),$("#title_index").text("【"+a.extraOptions.indexId+"】");let o=a.extraOptions.subjectId,n=window.CUR_PROJECT_ACC_YEAR-0,i=1,d={localParam:{data:[]},tableParam:{scrollX:!0,scrollCollapse:!0,pageLength:1e3,select:!0,lengthChange:!1,serverSide:!0,ordering:!1,dom:'<"row"<"col-sm-12"tr>>',paging:!1,fixedThead:!0,fixedHeight:"480px",columnDefs:[{targets:i++,className:"text-left width-jyx",title:"校验项",name:"checkCal",data:"checkCal"},{targets:i++,className:"text-right width-je",title:n+"年<br>未审数",name:"unAuditAmount",data:"unAuditAmount",render:function(e,t,a,r){return 0==e?'<div width="100%" style="text-align: center">平<div>':null!=e?u(e):void 0}},{targets:i++,className:"text-right width-je",title:n+"年<br>审计调整数",name:"adjustAmount",data:"adjustAmount",render:function(e,t,a,r){return 0==e?'<div width="100%" style="text-align: center">平<div>':null!=e?u(e):void 0}},{targets:i++,className:"text-right width-je",title:n+"年<br>审定数",name:"auditAmount",data:"auditAmount",render:function(e,t,a,r){return 0==e?'<div width="100%" style="text-align: center">平<div>':null!=e?u(e):void 0}},{targets:i++,className:"text-right width-je",title:n-1+"年<br>未审数",name:"preUnAuditAmount",data:"preUnAuditAmount",render:function(e,t,a,r){return 0==e?'<div width="100%" style="text-align: center">平<div>':null!=e?u(e):void 0}},{targets:i++,className:"text-right width-je",title:n-1+"年<br>审计调整数",name:"preAdjustAmount",data:"preAdjustAmount",render:function(e,t,a,r){return 0==e?'<div width="100%" style="text-align: center">平<div>':null!=e?u(e):void 0}},{targets:i++,className:"text-right width-je",title:n-1+"年<br>审定数",name:"preAuditAmount",data:"preAuditAmount",render:function(e,t,a,r){return 0==e?'<div width="100%" style="text-align: center">平<div>':null!=e?u(e):void 0}}]}};i=0;let c={localParam:{data:[]},tableParam:{scrollX:!0,scrollCollapse:!0,pageLength:1e3,select:!0,lengthChange:!1,serverSide:!0,ordering:!1,dom:'<"row"<"col-sm-12"tr>>',paging:!1,fixedThead:!0,fixedHeight:"480px",columnDefs:[{targets:i++,className:"text-center width-seq",title:"序号",visible:!0,render:function(e,t,a,r){return r.settings._iDisplayStart+r.row+1}},{targets:i++,className:"text-center width-subject-id",title:"TB科目编号",name:"subjectId",data:"subjectId"},{targets:i++,className:"text-left width-subject-name",title:"科目名称",name:"subjectName",data:"subjectName"},{targets:i++,className:"text-right width-je",title:n+"年<br>未审数",name:"unAuditAmount",data:"unAuditAmount",render:function(e,t,a,r){return u(e)}},{targets:i++,className:"text-right width-je",title:n+"年<br>审计调整数",name:"adjustAmount",data:"adjustAmount",render:function(e,t,a,r){return u(e)}},{targets:i++,className:"text-right width-je",title:n+"年<br>审定数",name:"auditAmount",data:"auditAmount",render:function(e,t,a,r){return u(e)}},{targets:i++,className:"text-right width-je",title:n-1+"年<br>未审数",name:"preUnAuditAmount",data:"preUnAuditAmount",render:function(e,t,a,r){return u(e)}},{targets:i++,className:"text-right width-je",title:n-1+"年<br>审计调整数",name:"preAdjustAmount",data:"preAdjustAmount",render:function(e,t,a,r){return u(e)}},{targets:i++,className:"text-right width-je",title:n-1+"年<br>审定数",name:"preAuditAmount",data:"preAuditAmount",render:function(e,t,a,r){return u(e)}}]}};function u(e){return isNaN(e)?e:""==(e+="")?"":e>0?'<span style="color:green;align=right;">'+m(e,1)+"</span>":e<0?'<span style="color:green;">'+m(e,1)+"</span>":"0"}function m(e,t){if(!$.isNumeric(e))return"0.00";if(e=formatCurrency(e),0==t){let t=e.split(".");"00"==t[1]&&(e=t[0])}return e}const p={options:{propsData:{jsonData:{dataFile:[],customerId:"",projectId:""}}},props:{jsonData:Object},display:"tableform-one",column:1,id:"uploadDataForm",data:()=>({ajaxConfig:{type:"POST",url:"dgCenter/DgMergeProject.uploadDataFile.json",dataType:"json",success(e){var t;e.success?(t=e.data[0],$.ajax({type:"post",url:"dgCenter/HbMergeProjectTrialBalance.importTbByDataFile.json",data:{menuId:window.sys_menuId,param1:o,param2:t.path,param3:t.name},dataType:"json",success:function(e){e.success?(bdoSuccessBox("成功"),$("#uploadDataModal").modal("hide"),b()):bdoErrorBox("失败",e.resultInfo.statusText)}})):bdoErrorBox("失败",e.resultInfo.statusText)}}}),methods:{onUploadDataFileBtn(){let e=$("#dataFile").fileinput("getFileStack");!e||e.length<1?bdoInfoBox("提示","请先选择文件"):this.uploadFile(!0)}},buttons:[{id:"uploadDataFileBtn",icon:"fa-floppy-o",style:"btn-primary",text:"上传",typeAttr:{"v-on:click":"onUploadDataFileBtn"}},{id:"cancelUploadBtn",icon:"fa-arrow-left",style:"btn-warning",text:"取消",typeAttr:{"data-dismiss":"modal"}}],items:[{id:"dataFile",type:"file",label:"数据文件",rowspan:1,colspan:2,validate:{rules:{}},show:!0,typeAttr:{multiple:!1},plugin:{name:"fileinput",options:{allowedFileExtensions:["xls","xlsx","xltx","xlsm","xltm","xlsb","xlam","jpg","png","doc","docx","zip","rar","pdf"],uploadUrl:"dgCenter/DgDownload.uploadTempFile.json",uploadExtraData:()=>({})}}}]};function b(){$.ajax({type:"post",url:"dgCenter/HbMergeProjectTrialBalance.findHbTbData.json",data:{menuId:window.sys_menuId,param1:window.CUR_PROJECTID,param2:window.CUR_CUSTOMERID,param3:o},dataType:"json",success:function(e){$("#tableCheck").hasClass("dataTable")&&($("#tableCheck").DataTable().clear(),$("#tableCheck").DataTable().destroy(),$("#tableCheck").empty()),$("#tableDetail").hasClass("dataTable")&&($("#tableDetail").DataTable().clear(),$("#tableDetail").DataTable().destroy(),$("#tableDetail").empty()),d.localParam.data=e.data[0].tbChecklist,c.localParam.data=e.data[0].tblist,BdoDataTable("tableCheck",d),BdoDataTable("tableDetail",c)}})}l=(()=>{$("#btnRefreshTables").click(function(){b()}),$("#tb_upload").click(function(){$("#uploadDataModal").modal("show")})}),(r=(()=>{s=createForm(p),l(),b()}))()}function MergeNoteInfo(e){let t,a,r,l,s;a=e.data;let o=e.isParentCompany;t=e.template||tplLoader("dgCenter/html/dg/mergeproject/mergeNoteInfo.html"),e.template=t,$(e.region).html(t);let n=$("#dgNoteTable");$("#headtitle").empty().text(e.data.text);let i,d=window.CUR_CUSTOMERID,c=window.CUR_PROJECTID,u="",m="";!i&&($.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",dataType:"json",data:{menuId:window.sys_menuId,sqlId:"HB00015",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,start:-1,limit:-1},success:function(e){e.success&&(m=e.data[0].mergeCustomerId,u=e.data[0].mergeProjectId,o&&(d=m,c=u))}}),i=1);let p=[];$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",dataType:"json",data:{menuId:window.sys_menuId,sqlId:"DG00198",param1:d,param2:c,param3:window.CUR_PROJECT_ACC_YEAR,start:-1,limit:-1},success:function(e){e.success&&(p=e.data)}});let b={localParam:{url:"dgCenter/HbMergeProjectNoteInfo.queryMergeNoteInfo.json",urlparam:{param1:d,param2:c,limit:-1,start:-1},tabNum:!1},tableParam:{scrollX:!1,pageLength:1e3,select:!1,ordering:!0,dom:'<"row"<"col-sm-12"tr>>',fixedHeight:"480px",columnDefs:[{targets:0,visible:!0,orderable:!0,className:"text-center width-seq",title:"序号",render:function(e,t,a,r){return r.settings._iDisplayStart+r.row+1}},{targets:1,title:"操作",className:"text-center",orderable:!1,width:"30px",render(e,t,a,r){let l='<div>\n\t\t\t\t\t\t\t\t\t\t\t<button class="btn btn-xs btn-success table-btn-operate" type="button" name="editNoteFileBtn" data-action="editNoteFileBtn" data-placement="top" title="查看文件" data-toggle="tooltip" data-row="'+r.row+'">\n\t\t\t\t\t\t\t\t\t\t\t\t<i class="fa fa-file-excel-o"></i>\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t';return l+="</div>"}},{targets:2,orderable:!0,className:"text-center width-subject-id",title:"附注编号",name:"noteNo",data:"noteNo",width:"50px"},{targets:3,orderable:!1,className:"text-left width-subject-name",title:"附注名称",name:"noteName",data:"noteName",width:"120px"},{targets:4,orderable:!1,title:"报表科目",name:"colName",data:"colName",width:"100px",render:function(e,t,a,r){return null!=e&&""!=e?e:"---"}},{targets:5,orderable:!1,title:"审定数",name:"auditedAmount",data:"auditedAmount",width:"60px",className:"text-right",render:function(e,t,a,r){return null==e?"":formatMoney(e)}},{targets:6,orderable:!1,title:"年初数",name:"preAuditAmount",data:"preAuditAmount",width:"60px",className:"text-right",render:function(e,t,a,r){return null==e?"":formatMoney(e)}},{targets:7,orderable:!1,title:"本期校验",name:"curCheck",data:"curCheck",width:"60px",className:"text-right",render:function(e,t,a,r){if(null!=e){return 0==parseFloat(e).toFixed(2)?"<span>&nbsp;"+g(e)+"</span>":'<span style="color: red;">&nbsp;'+g(e)+"</span>"}return"---"}},{targets:8,orderable:!1,title:"上期校验",name:"preCheck",data:"preCheck",width:"60px",className:"text-right",render:function(e,t,a,r){if(null!=e){return 0==parseFloat(e).toFixed(2)?"<span>&nbsp;"+g(e)+"</span>":'<span style="color: red;">&nbsp;'+g(e)+"</span>"}return"---"}},{targets:8,orderable:!1,title:"状态",renderer:"getDicLabelByVal|boolean",name:"isCompleteNow",data:"isCompleteNow",width:"50px",className:"text-center",render:function(e,t,a,r){return 1==e?'<span class="label label-success"><i class="fa fa-check"></i>&nbsp;加载完成</span>':0==e?'<span class="label label-danger"><i class="fa fa-spinner fa-pulse"></i>&nbsp;加载中</span>':void 0}},{targets:9,orderable:!1,title:"禁用",renderer:"getDicLabelByVal|boolean",name:"isForbid",data:"isForbid",width:"30px",className:"text-center",render(e,t,a,r){let l=1==e?"checked":"";return'<label class="css-input css-checkbox control-label css-checkbox-danger css-input-disabled"><input type="checkbox" class="note-table-isForbid" data-row="'+r.row+'" name="isForbid" '+l+" disabled> <span></span></label>"}},{targets:10,orderable:!1,title:"已编辑",renderer:"getDicLabelByVal|boolean",name:"isEdited",data:"isEdited",width:"40px",className:"text-center",render(e,t,a,r){let l=1==e?"checked":"";return'<label class="css-input css-checkbox control-label css-checkbox-primary css-input-disabled"><input type="checkbox" class="note-table-isEdited" data-row="'+r.row+'" name="isEdited" '+l+" disabled> <span></span></label>"}},{targets:11,orderable:!1,title:"已完成",renderer:"getDicLabelByVal|boolean",name:"isFinished",data:"isFinished",width:"40px",className:"text-center",render(e,t,a,r){let l=1==e?"checked":"";return'<label class="css-input css-checkbox control-label css-checkbox-success css-input-disabled"><input type="checkbox" class="note-table-isFinished" data-row="'+r.row+'" name="isFinished" '+l+" disabled> <span></span></label>"}},{targets:12,orderable:!1,title:"更新人",name:"__ulastUpdatedUserName",data:"__ulastUpdatedUserName",width:"50px",className:"text-center"},{targets:13,orderable:!1,title:"更新时间",name:"lastUpdateDate",data:"lastUpdateDate",width:"120px",className:"text-right"}]}};function g(e){return e&&(-1!=e.toString().indexOf(".")?e.toString().replace(/(\d)(?=(\d{3})+\.)/g,function(e,t){return t+","}):e.toString().replace(/(\d)(?=(\d{3})+\b)/g,function(e,t){return t+","}))}const f={options:{propsData:{jsonData:{dataFile:[],customerId:"",projectId:""}}},props:{jsonData:Object},display:"tableform-one",column:1,id:"uploadDataForm",data:()=>({ajaxConfig:{type:"POST",url:"dgCenter/DgMergeProject.uploadDataFile.json",dataType:"json",success(e){var t;e.success?(t=e.data[0],$.ajax({type:"post",url:"dgCenter/HbMergeProjectNoteInfo.importTbByDataFile.json",data:{menuId:window.sys_menuId,param1:u,param2:t.path,param3:t.name},dataType:"json",success:function(e){e.success?(bdoSuccessBox("成功"),$("#uploadDataModal").modal("hide"),h()):bdoErrorBox("失败",e.resultInfo.statusText)}})):bdoErrorBox("失败",e.resultInfo.statusText)}}}),methods:{onUploadDataFileBtn(){let e=$("#dataFile").fileinput("getFileStack");!e||e.length<1?bdoInfoBox("提示","请先选择文件"):this.uploadFile(!0)}},buttons:[{id:"uploadDataFileBtn",icon:"fa-floppy-o",style:"btn-primary",text:"上传",typeAttr:{"v-on:click":"onUploadDataFileBtn"}},{id:"cancelUploadBtn",icon:"fa-arrow-left",style:"btn-warning",text:"取消",typeAttr:{"data-dismiss":"modal"}}],items:[{id:"dataFile",type:"file",label:"数据文件",rowspan:1,colspan:2,validate:{rules:{}},show:!0,typeAttr:{multiple:!1},plugin:{name:"fileinput",options:{allowedFileExtensions:["xls","xlsx","xltx","xlsm","xltm","xlsb","xlam","jpg","png","doc","docx","zip","rar","pdf"],uploadUrl:"dgCenter/DgDownload.uploadTempFile.json",uploadExtraData:()=>({})}}}]};function h(){let e="dgCenter/HbMergeProjectNoteInfo.queryMergeNoteInfo.json",t={};if(o)e="dgCenter/DgNote.getAllNoteInfo.json",t={menuId:window.sys_menuId,param1:d,param2:c,param3:u,param4:$("#note_noteNo").val(),param5:$("#note_noteName").val(),param6:$("#note_colName").val(),param7:$("#note_isForbid").val(),param8:$("#note_isEdited").val(),param9:$("#note_isFinished").val(),start:-1,limit:-1};else{u=window.CUR_PROJECTID;let e={customerId:d,mergeProjectId:u,projectId:c};t={jsonData:JSON.stringify(e)}}$.ajax({type:"post",url:e,data:t,dataType:"json",success:function(e){$("#dgNoteTable").hasClass("dataTable")&&($("#dgNoteTable").DataTable().clear(),$("#dgNoteTable").DataTable().destroy(),$("#dgNoteTable").empty()),b.localParam.data=e.data,BdoDataTable("dgNoteTable",b)}})}l=(()=>{$("#btn_search").click(function(){h()}),$("#btn_clear").click(function(){!function(){for(var e=0;e<$("#search-condition .form-material").length;e++)$($("#search-condition .form-material")[e].children[0]).val("")}()}),$("#dgNoteTable").on("click",'tbody > tr > td > div > button[name="mergeNoteInfoBtn"]',function(){$.ajax({type:"post",url:"dgCenter/HbMergeProjectNoteInfo.mergeNoteInfo.json",data:{menuId:window.sys_menuId,param1:d,param2:c},dataType:"json",success:function(e){e.success?bdoSuccessBox("成功","合并成功！"):bdoErrorBox("失败",e.resultInfo.statusText)}})}),$("#note_refresh").click(function(){h()}),n.on("click",".table-btn-operate",function(e){let t=$(e.currentTarget),a=t.attr("data-row");n.dataTable().fnGetData(a);"editNoteFileBtn"===t.attr("data-action")&&function(e){let t=$(e.currentTarget).attr("data-row"),a=n.dataTable().fnGetData(t);if(0==a.isCompleteNow)return void bdoInfoBox("提示","附注尚未加载完成，请稍后查看！",1500);let r={extraOptions:a,currentNode:{extraOptions:a}};r.autoId=r.extraOptions.autoId,r.type=2,$.sessionStorage("excelnode",JSON.stringify(r)),window.open("/Faith/dgcenter.do?m=openMergeNoteInfoSecond&noteNo="+r.extraOptions.noteNo)}.call(this,e)})}),(r=(()=>{s=createForm(f),l(),h()}))()}function MergeAudited(e){let t,a,r,l,s;a=e.data,t=e.template||tplLoader("dgCenter/html/dg/mergeproject/mergeAudited.html"),e.template=t,$(e.region).html(t),$("#headtitle").empty().text(e.data.text),$("#auditedStateIndex").text("【"+a.extraOptions.indexId+"】");let o=a.extraOptions.subjectId;cnt=0;var n=window.CUR_PROJECT_ACC_YEAR;(()=>(cnt=0,++cnt))(),++cnt,++cnt,++cnt,++cnt;var i={id:"zc_report1_table",showType:"1",TABLE_DIV:"7",showZero:"2",rptName:{7:"资产负债表",9:"利润表",10:"现金流量表",11:"所有者权益变动表(本年)",12:"所有者权益变动表(上年)"}};const d={options:{propsData:{jsonData:{dataFile:[],customerId:"",projectId:""}}},props:{jsonData:Object},display:"tableform-one",column:1,id:"uploadDataForm",data:()=>({ajaxConfig:{type:"POST",url:"dgCenter/DgMergeProject.uploadDataFile.json",dataType:"json",success(e){var t;e.success?(t=e.data[0],$.ajax({type:"post",url:"dgCenter/HbMergeProjectAudited.importTbByDataFile.json",data:{menuId:window.sys_menuId,param1:o,param2:t.path,param3:t.name},dataType:"json",success:function(e){e.success?(bdoSuccessBox("成功"),$("#uploadDataModal").modal("hide"),c("1")):bdoErrorBox("失败",e.resultInfo.statusText)}})):bdoErrorBox("失败",e.resultInfo.statusText)}}}),methods:{onUploadDataFileBtn(){let e=$("#dataFile").fileinput("getFileStack");!e||e.length<1?bdoInfoBox("提示","请先选择文件"):this.uploadFile(!0)}},buttons:[{id:"uploadDataFileBtn",icon:"fa-floppy-o",style:"btn-primary",text:"上传",typeAttr:{"v-on:click":"onUploadDataFileBtn"}},{id:"cancelUploadBtn",icon:"fa-arrow-left",style:"btn-warning",text:"取消",typeAttr:{"data-dismiss":"modal"}}],items:[{id:"dataFile",type:"file",label:"数据文件",rowspan:1,colspan:2,validate:{rules:{}},show:!0,typeAttr:{multiple:!1},plugin:{name:"fileinput",options:{allowedFileExtensions:["xls","xlsx","xltx","xlsm","xltm","xlsb","xlam","jpg","png","doc","docx","zip","rar","pdf"],uploadUrl:"dgCenter/DgDownload.uploadTempFile.json",uploadExtraData:()=>({})}}}]};l=(()=>{$("#rpt_search").click(function(){c("1")}),$("#audit_report_upload").click(function(){$("#uploadDataModal").modal("show")})}),r=(()=>{s=createForm(d),l(),c("1")});var c=function(e){$.ajax({type:"post",url:"dgCenter/HbMergeProjectAudited.findXjTbData.json",data:{menuId:window.sys_menuId,param1:window.CUR_PROJECTID,param2:window.CUR_CUSTOMERID,param3:o},dataType:"json",success:function(t){t=t.data[0];var a=$.extend(!0,{},u);a.tableParam={select:!0,lengthChange:!0,dom:'<"row"<"col-sm-12"tr>>',serverSide:!0,ordering:!1,columnDefs:[{targets:(()=>(cnt=0,++cnt))(),orderable:!1,className:"text-center width-seq",title:"序号",visible:!0,render:function(e,t,a,r){return r.settings._iDisplayStart+r.row+1}},{targets:++cnt,orderable:!0,className:"text-left width-subject-id",title:"科目编号",name:"subjectId",data:"subjectId",render:function(e,t,a,r){return e}},{targets:++cnt,orderable:!0,title:"科目名称",name:"subjectName",data:"subjectName",className:"dg-ap width-subject-name",render:function(e,t,a,r){return e.indexOf("合计")>0||e.indexOf("总计")>0?"<b>"+e+"</b>":e.replace(/ /g,"&nbsp;")}},{targets:++cnt,orderable:!0,title:"未审数",name:"unAuditAmount",data:"unAuditAmount",className:"text-right width-je",render:function(e,t,a,r){return formatMoney(e)}},{targets:++cnt,orderable:!0,title:"审计调整数",name:"adjustAmount",data:"adjustAmount",className:"text-right width-je",render:function(e,t,a,r){return formatMoney(e)}},{targets:++cnt,orderable:!0,title:"审定数",name:"auditAmount",data:"auditAmount",className:"text-right width-je",render:function(e,t,a,r){return formatMoney(e)}},{targets:++cnt,orderable:!0,title:"年初数",name:"preAuditAmount",data:"preAuditAmount",className:"text-right width-je",render:function(e,t,a,r){return formatMoney(e)}}]};var r=$.extend(!0,{},u);r.tableParam={select:!0,lengthChange:!0,dom:'<"row"<"col-sm-12"tr>>',serverSide:!0,ordering:!1,createdRow(e,t,a){t.flag&&($(e).addClass("edit-able"),$(e).find("td:eq(3)").addClass("bg-success-light"))},columnDefs:[{targets:(()=>(cnt=0,++cnt))(),orderable:!1,className:"text-center width-seq",title:"序号",visible:!0,render:function(e,t,a,r){return r.settings._iDisplayStart+r.row+1}},{targets:++cnt,orderable:!0,className:"text-left width-subject-id",title:"科目编号",name:"subjectId",data:"subjectId",render:function(e,t,a,r){return e}},{targets:++cnt,orderable:!0,title:"科目名称",name:"subjectName",data:"subjectName",className:"dg-ap width-subject-name",render:function(e,t,a,r){return e.indexOf("合计")>0||e.indexOf("总计")>0?"<b>"+e+"</b>":e.replace(/ /g,"&nbsp;")}},{targets:++cnt,orderable:!0,title:"未审数",name:"unAuditAmount",data:"unAuditAmount",className:"text-right width-je",render:function(e,t,a,r){return formatMoney(e)}},{targets:++cnt,orderable:!0,title:"审计调整数",name:"adjustAmount",data:"adjustAmount",className:"text-right width-je",render:function(e,t,a,r){return formatMoney(e)}},{targets:++cnt,orderable:!0,title:"审定数",name:"auditAmount",data:"auditAmount",className:"text-right width-je",render:function(e,t,a,r){return formatMoney(e)}},{targets:++cnt,orderable:!0,title:"上年数",name:"preAuditAmount",data:"preAuditAmount",className:"text-right width-je",render:function(e,t,a,r){return formatMoney(e)}}]};var l=$.extend(!0,{},u);l.tableParam={select:!0,lengthChange:!0,dom:'<"row"<"col-sm-12"tr>>',serverSide:!0,ordering:!1,createdRow(e,t,a){t.flag&&($(e).addClass("edit-able"),$(e).find("td:eq(3)").addClass("bg-success-light"))},columnDefs:[{targets:(()=>(cnt=0,++cnt))(),orderable:!1,className:"text-center width-seq",title:"序号",visible:!0,render:function(e,t,a,r){return r.settings._iDisplayStart+r.row+1}},{targets:++cnt,orderable:!0,className:"text-left width-subject-id",title:"科目编号",name:"subjectId",data:"subjectId",render:function(e,t,a,r){return e}},{targets:++cnt,orderable:!0,title:"科目名称",name:"subjectName",data:"subjectName",className:"dg-ap width-subject-name",render:function(e,t,a,r){return e.indexOf("合计")>0||e.indexOf("总计")>0?"<b>"+e+"</b>":e.replace(/ /g,"&nbsp;")}},{targets:++cnt,orderable:!0,title:"本期金额",name:"curAmount",data:"curAmount",className:"text-right width-je",render:function(e,t,a,r){return formatMoney(e)}},{targets:++cnt,orderable:!0,title:"上期金额",name:"preAmount",data:"preAmount",className:"text-right width-je",render:function(e,t,a,r){return formatMoney(e)}}]};var s=$.extend(!0,{},m),o=$.extend(!0,{},m);a.localParam.data=t.zc,r.localParam.data=t.lr,l.localParam.data=t.xj,s.localParam.data=t.qy,o.localParam.data=t.lqy,BdoDataTable("zc_report"+e+"_table",a),BdoDataTable("lr_report"+e+"_table",r),BdoDataTable("xj_report"+e+"_table",l),BdoDataTable("qy_report"+e+"_table",s),BdoDataTable("lqy_report"+e+"_table",o),BdoDataTable("rpt_tbcheck",p)}})},u={localParam:{tabNum:!1,url:"dgCenter/FUnAuditReport.auditReport.json",urlparam:{menuId:window.sys_menuId,start:-1}},tableParam:{select:!0,lengthChange:!0,serverSide:!0,scrollY:!1,dom:'<"row"<"col-sm-12"tr>>',columnDefs:[]}},m={localParam:{tabNum:!1,url:"",urlparam:{menuId:window.sys_menuId,start:-1,limit:-1}},tableParam:{select:!0,dom:'<"row"<"col-sm-12"tr>>',serverSide:!0,lengthChange:!1,ordering:!1,createdRow(e,t,a){if("1"==t.colType){$(e).addClass("edit-able");for(let t=3;t<14;t++)$(e).find("td").eq(t).addClass("bg-success-light")}},columnDefs:[{targets:(()=>(cnt=0,++cnt))(),orderable:!1,className:"text-center width-seq",title:"序号",visible:!0,render:function(e,t,a,r){return r.settings._iDisplayStart+r.row+1}},{targets:1,orderable:!1,className:"text-left width-code",title:"编号",name:"colCode",data:"colCode",visible:!1},{targets:2,orderable:!1,className:"text-left width-subject-id",title:"科目编号",name:"colCode",data:"colCode"},{targets:3,orderable:!1,className:"text-left width-subject-name",title:"科目名称",name:"colDisp",data:"colDisp",render:function(e,t,a,r){return e.indexOf("合计")>0||e.indexOf("总计")>0?"<b>"+e+"</b>":e.replace(/ /g,"&nbsp;")}}]}};$('#subPageRight [data-toggle="tabs"]').on("shown.bs.tab",function(e){var t=$("#tab_unAuditReport").find("li[class=active] a");i.showType=t.attr("data-content");var a=t.attr("data-result"),r=$("#"+a).find("li[class=active] a");i.id=r.attr("data-result"),i.TABLE_DIV=r.attr("data-content"),function(){if("11"==i.TABLE_DIV||"12"==i.TABLE_DIV){var e=$(".js-tree-collapsed").treeview(!0).getSelected()[0];e.extraOptions.indexId,e.extraOptions.autoId,$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",async:!1,data:{menuId:window.sys_menuId,sqlId:"DG00280",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:window.CUR_PROJECT_ACC_YEAR,param4:i.TABLE_DIV,param5:o,start:-1,limit:-1},dataType:"json",success(e){if(e.success&&null!=e.data[0]){var t=[];null!=e.data[0].columnDesc1&&t.push(e.data[0].columnDesc1),null!=e.data[0].columnDesc2&&t.push(e.data[0].columnDesc2),null!=e.data[0].columnDesc3&&t.push(e.data[0].columnDesc3),null!=e.data[0].columnDesc4&&t.push(e.data[0].columnDesc4),null!=e.data[0].columnDesc5&&t.push(e.data[0].columnDesc5),null!=e.data[0].columnDesc6&&t.push(e.data[0].columnDesc6),null!=e.data[0].columnDesc7&&t.push(e.data[0].columnDesc7),null!=e.data[0].columnDesc8&&t.push(e.data[0].columnDesc8),null!=e.data[0].columnDesc9&&t.push(e.data[0].columnDesc9),null!=e.data[0].columnDesc10&&t.push(e.data[0].columnDesc10),null!=e.data[0].columnDesc11&&t.push(e.data[0].columnDesc11),null!=e.data[0].columnDesc12&&t.push(e.data[0].columnDesc12),null!=e.data[0].columnDesc13&&t.push(e.data[0].columnDesc13),null!=e.data[0].columnDesc14&&t.push(e.data[0].columnDesc14),null!=e.data[0].columnDesc15&&t.push(e.data[0].columnDesc15),m.tableParam.columnDefs=m.tableParam.columnDefs.splice(0,4);for(var a=0,r=t.length;a<r;a++)m.tableParam.columnDefs.push({targets:a+4,orderable:!1,className:"text-right width-je",title:t[a],name:"column"+(a+1),data:"column"+(a+1),render:function(e,t,a,r){return formatMoney(e)}})}}});var t=$.extend(!0,{},m);t.localParam.url="dgCenter/DgGeneral.query.json",t.localParam.urlparam.sqlId="DG00281",t.localParam.urlparam.param1=window.CUR_CUSTOMERID,t.localParam.urlparam.param2=window.CUR_PROJECTID,t.localParam.urlparam.param3=window.CUR_PROJECT_ACC_YEAR,t.localParam.urlparam.param4=i.TABLE_DIV,t.localParam.urlparam.param5=o,"11"==i.TABLE_DIV?t.localParam.urlparam.param6=2:t.localParam.urlparam.param6=1,BdoDataTable(i.id,t)}}()});var p={localParam:{tabNum:!1,url:"dgCenter/HbMergeProjectAudited.tbListCheck.json",urlparam:{menuId:window.sys_menuId,param3:o}},tableParam:{select:!0,lengthChange:!0,serverSide:!0,scrollY:!1,dom:'<"row"<"col-sm-12"tr>>',columnDefs:[{targets:1,orderable:!1,className:"text-left font-s12 width-jyx",title:"校验项",name:"colDisp",data:"colDisp"},{targets:2,orderable:!1,className:"text-right width-je",title:n+"年<br>未审数",name:"unAuditAmount"+n,data:"unAuditAmount"+n,render:function(e,t,a,r){return 0==e?'<div width="100%" style="text-align: center">平<div>':null!=e?formatMoney(e):void 0}},{targets:3,orderable:!1,className:"text-right width-je",title:n+"年<br>审计调整数",name:"adjustAmount"+n,data:"adjustAmount"+n,render:function(e,t,a,r){return 0==e?'<div width="100%" style="text-align: center">平<div>':null!=e?formatMoney(e):void 0}},{targets:4,orderable:!1,className:"text-right width-je",title:n+"年<br>审定数",name:"auditAmount"+n,data:"auditAmount"+n,render:function(e,t,a,r){return 0==e?'<div width="100%" style="text-align: center">平<div>':null!=e?formatMoney(e):void 0}},{targets:5,orderable:!1,className:"text-right width-je",title:n-1+"年<br>审定数",name:"auditAmount"+(n-1),data:"auditAmount"+(n-1),render:function(e,t,a,r){return 0==e?'<div width="100%" style="text-align: center">平<div>':null!=e?formatMoney(e):void 0}}]}};r()}function MonomerTB(e){var t,a,r;var l;t=e.template||tplLoader("dgCenter/html/dg/mergeTB.html"),e.template=t,$(e.region).html(t),$("#headtitle").empty().text(e.data.text),r={localParam:{url:"dgCenter/DgGeneral.query.json",urlparam:(()=>({menuId:window.sys_menuId,sqlId:"DG00083",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,start:-1,limit:-1}))(),tabNum:!0},tableParam:{pageLength:30,scrollX:!0,scrollY:"170px",select:!0,ordering:!1,order:[1,"asc"],serverSide:!0,fixedThead:!0,fixedHeight:"460px",columnDefs:[{targets:1,orderable:!0,title:"标签",name:"autoId",data:"autoId",width:"60px",render:function(e,t,a,r){return'<a href="#">p'+e+"</a>"}},{targets:2,orderable:!1,title:"标签名",name:"tagName",data:"tagName",width:"100px"},{targets:3,orderable:!0,title:"标签属性",className:"text-center",name:"tagProperty",data:"tagProperty",renderer:"getDicLabelByVal|标签属性",width:"60px",render:e=>DicVal2Nm(e,"标签属性")},{targets:4,orderable:!0,title:"标签类型",className:"text-center",name:"tagType",data:"tagType",renderer:"getDicLabelByVal|标签类型",width:"60px",render:e=>DicVal2Nm(e,"标签类型")},{targets:5,orderable:!0,title:"位置",name:"otherPosition",data:"otherPosition",width:"100px"},{targets:6,orderable:!1,title:"详细位置",name:"tagPosition",data:"tagPosition",width:"100px"},{targets:7,orderable:!1,className:"text-right",title:"标签值",name:"tagValue",data:"tagValue",width:"80px",render:function(e,t,a,r){return formatMoney(e)}},{targets:8,orderable:!1,title:"操作",className:"text-center",name:"operate",data:"tagName",width:"40px",render:function(e,t,a,r){return'<button class="btn btn-xs btn-default" type="button" title="删除标签"><i class="fa fa-close"></i><input type="text" value="'+e+'" style="display: none;"></button>'}},{targets:9,name:"tagDgId",data:"tagDgId",visible:!1},{targets:10,name:"tagInfo",data:"tagInfo",visible:!1}]}},l={localParam:{url:"dgCenter/DgGeneral.query.json",urlparam:{menuId:window.sys_menuId,sqlId:"DG00114",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:"",start:-1,limit:-1},tabNum:!0},tableParam:{scrollX:!0,scrollY:"270px",select:!0,ordering:!1,order:[1,"asc"],serverSide:!0,fixedThead:!0,fixedHeight:"400px",columnDefs:[{targets:1,orderable:!1,className:"text-center",title:"科目编号",name:"subjectId",data:"subjectId",width:"60px"},{targets:2,orderable:!1,className:"text-center",title:"科目名称",name:"subjectName",data:"subjectName",width:"60px",render:function(e,t,a,r){return renderStr="<label>"+e+"</label>",renderStr}},{targets:3,orderable:!1,title:"公式",name:"formula",data:"formula",width:"100px",render:function(e,t,a,r){return renderStr="<label>"+e+"</label>",renderStr}},{targets:4,orderable:!1,title:"公式信息",name:"formulaText",data:"formulaText",width:"100px",render:function(e,t,a,r){return renderStr="<label>"+e+"</label>",renderStr}},{targets:5,orderable:!1,title:"公式值",name:"formulaValue",data:"formulaValue",width:"100px",render:function(e,t,a,r){return renderStr="<label>"+e+"</label>",renderStr}},{targets:6,orderable:!1,className:"text-center",title:"公式校验结果",name:"formulaCalc",data:"formulaCalc",width:"80px",render:function(e,t,a,r){return 1==e?'<span class="label label-success"><i class="fa fa-check"></i> 通过</span>':0==e?'<span class="label label-danger"><i class="fa fa-times"></i> 未通过</span>':void 0}},{targets:7,orderable:!1,title:"校验时间",name:"updateTime",data:"updateTime",width:"100px",render:e=>new Date(e).format("yyyy-MM-dd HH:mm:ss")},{targets:8,orderable:!1,title:"操作",className:"text-center",name:"operate",data:"autoId",width:"80px",render:function(e,t,a,r){let l='<button class="btn btn-xs btn-success" name="editFormula" type="button" title="修改校验公式"><i class="fa fa-edit"></i></button>';return l+='&nbsp;<button class="btn btn-xs btn-success" name="delFormula" type="button" title="删除校验公式"><i class="fa fa-trash-o"></i></button>'}}]}};let s="";function o(e){let t=0,a=e.replace("p","");return $.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",async:!0,data:{menuId:window.sys_menuId,sqlId:"DG00235",param1:a,param2:window.CUR_CUSTOMERID,param3:window.CUR_PROJECTID,start:-1,limit:-1},dataType:"json",success(e){e.success&&(t=e.data[0].tagValue)}}),parseFloat(t).toFixed(2)}uiBlocksApi(!1,"init"),$("#search_customerId").val(window.CUR_CUSTOMERID+"-"+window.CUR_CUSTOMERNAME),s=window.CUR_PROJECT_ACC_YEAR;let n=$(".js-tree-collapsed").treeview(!0).getSelected()[0];$("#title_index").text("【"+n.extraOptions.indexId+"】"),$("#headtitle").empty().text(n.text),$("#cus_select2").text("【"+window.CUR_PROJECTNAME+"   "+s+"-"+window.CUR_PROJECT_START_MONTH+"~"+s+"-"+window.CUR_PROJECT_END_MONTH+"】"),OneUI.initHelper("slimscroll");var i="tb_tab",d="tb_tbcheck";var c={localParam:{tabNum:!1,data:[],urlparam:{menuId:window.sys_menuId}},tableParam:{scrollY:!1,select:!0,lengthChange:!0,dom:'<"row"<"col-sm-12"tr>>',serverSide:!0,rowReorder:{update:!1},columnDefs:[]}},u={localParam:{tabNum:!1,data:[],url:"dgCenter/FTBSubjectContract.tbList.json",urlparam:{menuId:window.sys_menuId}},tableParam:{scrollY:!1,select:!0,lengthChange:!0,dom:'<"row"<"col-sm-12"tr>>',serverSide:!0,rowReorder:{update:!1},columnDefs:[]}};function m(){$.ajax({type:"post",url:"dgCenter/HbMergeTb.monomerTbListAndCheck.json",data:{menuId:window.sys_menuId,param1:window.CUR_CUSTOMERID,param2:s,param3:s,param4:$("#showContract").val()},dataType:"json",success:function(e){if($("#"+d).hasClass("dataTable")&&($("#"+d).DataTable().clear(),$("#"+d).DataTable().destroy(),$("#"+d).empty()),$("#"+i).hasClass("dataTable")&&($("#"+i).DataTable().clear(),$("#"+i).DataTable().destroy(),$("#"+i).empty()),e.success){e=e.data[0];u.localParam.data=e.tbList,u.tableParam=function(e,t){for(var a={scrollY:450,scrollCollapse:!0,fixedColumns:!0,select:!0,lengthChange:!0,dom:'<"row"<"col-sm-12"tr>>',serverSide:!0,ordering:!1,columnDefs:[{targets:1,orderable:!1,className:"text-center width-seq",title:"序号",visible:!0,render:function(e,t,a,r){return r.settings._iDisplayStart+r.row+1}},{targets:2,orderable:!1,className:"text-left width-subject-id",title:"TB科目编号",name:"colCode",data:"colCode"},{targets:3,className:"text-left width-subject-name",orderable:!1,title:"科目名称",name:"colDisp",data:"colDisp",render:function(e,t,a,r){return e.indexOf("合计")>0||e.indexOf("总计")>0?"<b>"+e+"</b>":"&nbsp;&nbsp;&nbsp;&nbsp;"+e}}]},r=3,l=e;l<=t;l++)a.columnDefs.push({targets:r+1,className:"text-right width-je",orderable:!1,title:l+"年<br>未审数",name:"unAuditAmount"+l,data:"unAuditAmount"+l,render:function(e,t,a,r){let l;return'<label style="font-size: 10px;position: relative;top:5px;">'+(l=null!=e&&void 0!=e&&""!=e&&"Null"!=e?formatMoney(e):0==e&&"0"==e?0:"--")+"</label>"}}),a.columnDefs.push({targets:r+2,orderable:!1,className:"text-right width-je",title:l+"年<br>审计调整数",name:"adjustAmount"+l,data:"adjustAmount"+l,render:function(e,t,a,r){let l;l=null!=e&&void 0!=e&&""!=e&&"Null"!=e?formatMoney(e):0==e&&"0"==e?0:"--";var s=formatMoney(l);return"1"==a.colType&&"0"!=l&&"--"!=l?s='<label style="font-size: 10px;position: relative;top:5px;"><span style="background-color: #53f9f9;width: 100%;position: relative;top: 0px;display: block;">'+s+"</span></label>":'<label style="font-size: 10px;position: relative;top:5px;">'+l+"</label>"}}),a.columnDefs.push({targets:r+3,orderable:!1,className:"text-right width-je",title:l+"年<br>审定数",name:"auditAmount"+l,data:"auditAmount"+l,render:function(e,t,a,r){let l;return'<label style="font-size: 10px;position: relative;top:5px;">'+(l=null!=e&&void 0!=e&&""!=e&&"Null"!=e?formatMoney(e):0==e&&"0"==e?0:"--")+"</label>"}}),l<t&&a.columnDefs.push({targets:r+4,orderable:!1,className:"text-right",title:"",width:"20px"}),r+=4;var s=e-1;for(l=s;l<=s;l++)a.columnDefs.push({targets:r,orderable:!1,className:"text-right width-je",title:l+"年<br>未审数",name:"unAuditAmount"+l,data:"unAuditAmount"+l,render:function(e,t,a,r){return'<label style="font-size: 10px;position: relative;top:5px;">'+(null!=e&&void 0!=e&&""!=e&&"Null"!=e?formatMoney(e):0==e&&"0"==e?0:"--")+"</label>"}}),a.columnDefs.push({targets:r+1,orderable:!1,className:"text-right width-je",title:l+"年<br>审计调整数",name:"adjustAmount"+l,data:"adjustAmount"+l,render:function(e,t,a,r){let l;return l=null!=e&&void 0!=e&&""!=e&&"Null"!=e?formatMoney(e):0==e&&"0"==e?0:"--",formatMoney(l),'<label style="font-size: 10px;position: relative;top:5px;">'+l+"</label>"}}),a.columnDefs.push({targets:r+2,orderable:!1,className:"text-right width-je",title:l+"年<br>审定数",name:"auditAmount"+l,data:"auditAmount"+l,render:function(e,t,a,r){let l;return'<label style="font-size: 10px;position: relative;top:5px;">'+(l=null!=e&&void 0!=e&&""!=e&&"Null"!=e?formatMoney(e):0==e&&"0"==e?0:"--")+"</label>"}}),l<s&&a.columnDefs.push({targets:r+3,orderable:!1,className:"text-right",title:"",width:"20px"}),r+=4;return a}(s,s),BdoDataTable(i,u),c.localParam.data=e.checkResult,c.tableParam=function(e,t){for(var a={scrollY:!1,select:!0,lengthChange:!1,dom:'<"row"<"col-sm-12"tr>>',serverSide:!1,columnDefs:[{targets:1,className:"text-left font-s12 width-jyx",title:"校验项",orderable:!1,name:"colDisp",data:"colDisp"}]},r=1,l=e;l<=t;l++)a.columnDefs.push({targets:r+1,orderable:!1,className:"text-right width-je",title:l+"年<br>未审数",name:"unAuditAmount"+l,data:"unAuditAmount"+l,render:function(e,t,a,r){return 0==e?'<div width="100%" style="text-align: center">平<div>':null!=e?formatMoney(e):void 0}}),a.columnDefs.push({targets:r+2,orderable:!1,className:"text-right width-je",title:l+"年<br>审计调整数",name:"adjustAmount"+l,data:"adjustAmount"+l,render:function(e,t,a,r){return 0==e?'<div width="100%" style="text-align: center">平<div>':null!=e?formatMoney(e):void 0}}),a.columnDefs.push({targets:r+3,orderable:!1,className:"text-right width-je",title:l+"年<br>审定数",name:"auditAmount"+l,data:"auditAmount"+l,render:function(e,t,a,r){return 0==e?'<div width="100%" style="text-align: center">平<div>':null!=e?formatMoney(e):void 0}}),l<t&&a.columnDefs.push({targets:r+4,orderable:!1,className:"text-right",title:"",width:"10px"}),r+=4;var s=e-1;for(l=s;l<=s;l++)a.columnDefs.push({targets:r,orderable:!1,className:"text-right width-je",title:l+"年<br>未审数",name:"unAuditAmount"+l,data:"unAuditAmount"+l,render:function(e,t,a,r){return 0==e?'<div width="100%" style="text-align: center">平<div>':null!=e?formatMoney(e):void 0}}),a.columnDefs.push({targets:r+1,orderable:!1,className:"text-right width-je",title:l+"年<br>审计调整数",name:"adjustAmount"+l,data:"adjustAmount"+l,render:function(e,t,a,r){return 0==e?'<div width="100%" style="text-align: center">平<div>':null!=e?formatMoney(e):void 0}}),a.columnDefs.push({targets:r+2,orderable:!1,className:"text-right width-je",title:l+"年<br>审定数",name:"auditAmount"+l,data:"auditAmount"+l,render:function(e,t,a,r){return 0==e?'<div width="100%" style="text-align: center">平<div>':null!=e?formatMoney(e):void 0}}),r+=4;return a}(s,s),BdoDataTable(d,c)}else{if(e.data&&e.data.length>0)return void bdoConfirmBox("提示",e.resultInfo.statusText,function(){bdoInProcessingBox("生成中"),$.ajax({type:"post",url:"dgCenter/HbMergeTb.createTB.json",data:{param1:window.CUR_CUSTOMERID},dataType:"json",success:function(e){if(e.success)bdoSuccessBox("操作成功",e.resultInfo.statusText),m();else{var t=e.resultInfo.statusText.search("TB科目对照");t>0?bdoConfirmBox("操作失败",e.resultInfo.statusText,function(){$('a[href="#tab_tbContract"]').click()}):bdoErrorBox("操作失败",e.resultInfo.statusText)}}})});bdoInfoBox("提示",e.resultInfo.statusText)}}})}a=(()=>{$('#formulaModal [data-toggle="tabs"] a').on("show.bs.tab",function(e){var t=e.target.href,a=t.lastIndexOf("#");switch(t.substring(a+1)){case"tagTab":$("#tagsTable").DataTable().ajax.reload();break;case"formulaTab":var r;$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",async:!0,data:{menuId:window.sys_menuId,sqlId:"DG00113",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:"TB",param4:$("#formulaSubjectId").val(),start:-1,limit:-1},dataType:"json",success(e){e.success&&null!=e.data[0]&&(r=e.data[0].infoFormula)}}),""==r&&(r="0"),l.localParam.urlparam.param3=r,BdoDataTable("formulaTable",l)}}),$("#formulaModal").on("show.bs.modal",function(e){BdoDataTable("tagsTable",r),$("#tagGroup").html(""),$("#tagsTable tbody").on("click","td button",function(){var e=this.lastElementChild.value;$.ajax({type:"post",url:"dgCenter/DgCheck.deleteTag.json",data:{menuId:window.sys_menuId,param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:e,start:-1,limit:-1},dataType:"json",success(e){e.success&&($("#tagsTable").DataTable().ajax.reload(),bdoSuccessBox("成功","删除标签成功！"))}})}),$("#tagsTable tbody").on("click","td a",function(){if(1===$(this).parents("td").index()){let e,t=$("#tagGroup .col-sm-1 input").length;e=t>0?$('<div class="col-sm-1"><div class="form-material"><select class="form-control"><option value=""></option><option value="=">=</option><option value="+">+</option><option value="-">-</option></select></div></div><div class="col-sm-1"><div class="form-material input-group"><input class="form-control" type="text" readonly="readonly"></div></div>'):$('<div class="col-sm-1"><div class="form-material input-group"><input class="form-control" type="text" readonly="readonly"></div></div>'),$("#tagGroup").append(e),$("#tagMainGroup .col-sm-1 input")[t].value=$(this).text(),$("#tagMainGroup .col-sm-1 input")[t].title=$(this).parent().next().text()}})}),$("#uodoTagBtn").click(e=>{var t=$("#tagGroup .col-sm-1 input").length;t>0&&$("#tagGroup .col-sm-1")[2*t-2].remove();var a=$("#tagGroup .col-sm-1 select").length;a>0&&$("#tagGroup .col-sm-1")[2*a-1].remove()}),$("#formulaTable").on("click",'button[name="editFormula"]',function(){var e=$("#formulaTable").DataTable().data()[$(this).closest("tr").index()];$("#tagGroup").html("");for(var t,a=e.formulaText.split(/[\+\-\=]+/),r=e.formula.split(/[\+\-\=]+/),l=e.formula.split(/[^\+\-\=]+/),s=0;s<r.length;s++)t=$('<div class="col-sm-1"><div class="form-material input-group"><input class="form-control" type="text" value="'+r[s]+'" title="'+a[s]+'" readonly="readonly"></div></div>'),$("#tagGroup").append(t),s+1<l.length-1&&(t=$('<div class="col-sm-1"><div class="form-material"><select class="form-control"><option value=""></option><option value="=">=</option><option value="+">+</option><option value="-">-</option></select></div></div>'),$("#tagGroup").append(t),$("#tagGroup .col-sm-1 select")[s].value=l[s+1]);$('#formulaModal [data-toggle="tabs"] a:first').tab("show")}),$("#formulaTable").on("click",'button[name="delFormula"]',function(){var e=$("#formulaTable").DataTable().data()[$(this).closest("tr").index()];$.ajax({type:"post",url:"dgCenter/DgCheck.delFormula.json",async:!0,data:{param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:e.autoId},dataType:"json",success(e){var t;$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",async:!0,data:{menuId:window.sys_menuId,sqlId:"DG00113",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:"TB",param4:$("#formulaSubjectId").val(),start:-1,limit:-1},dataType:"json",success(e){e.success&&null!=e.data[0]&&(t=e.data[0].infoFormula)}}),""==t&&(t="0"),l.localParam.urlparam.param3=t,$("#formulaTable").DataTable().ajax.reload(),bdoSuccessBox("成功","成功删除校验公式！")}})}),$("#checkFormulaBtn").click(e=>{$.ajax({type:"post",url:"dgCenter/DgCheck.checkFormula.json",data:{menuId:window.sys_menuId,param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:"TB",param4:$("#formulaSubjectId").val(),start:-1,limit:-1},dataType:"json",success(e){e.success&&swal({title:"正在校验中...",html:"请稍后查看!",type:"info",allowOutsideClick:!1,allowEscapeKey:!1,timer:3e3}).catch(swal.noop)}})}),$("#ensureProjectTagBtn").click(e=>{var t=$("#tagGroup .col-sm-1 select").length;if(0==t)return bdoErrorBox("失败","请正确设置公式！"),void $('#formulaModal [data-toggle="tabs"] a:last').tab("show");for(var a=$("#tagGroup .col-sm-1 input")[0].value,r=$("#tagGroup .col-sm-1 input")[0].title,l=o($("#tagGroup .col-sm-1 input")[0].value),s=0;s<t;s++){var n=$("#tagGroup .col-sm-1 input")[s+1].value,i=$("#tagGroup .col-sm-1 select")[s].value;if(""==i)return $("#tagGroup .col-sm-1 select")[s].focus(),void bdoErrorBox("失败","请选择运算符号！");a=a+i+n,r=r+i+$("#tagGroup .col-sm-1 input")[s+1].title,l=l+i+o(n)}if(-1===a.indexOf("=")||a.indexOf("=")!==a.lastIndexOf("="))return void bdoErrorBox("失败","请正确设置公式！");var d=l.substring(0,l.indexOf("=")),c=d.split(/[\+\-]+/),u=d.split(/[^\+\-]+/);let m=""==c[0]?0:c[0];m.toString();if(u.length>1){let e=1;"-"==u[0]&&(e=0);for(let t=e;t<u.length-1;t++){let a=u[t],r=c[t+1-e];"+"===a?m=parseFloat(m)+parseFloat(r):"-"===a?m=parseFloat(m)-parseFloat(r):"+-"===a?m=parseFloat(m)-parseFloat(r):"--"===a&&(m=parseFloat(m)+parseFloat(r))}}var p=l.substring(l.indexOf("=")+1),b=p.split(/[\+\-]+/),g=p.split(/[^\+\-]+/);let f=""==b[0]?0:b[0];if(g.length>1){let e=1;"-"==g[0]&&(e=0);for(let t=e;t<g.length-1;t++){let a=g[t],r=b[t+1-e];"+"===a&&(f=parseFloat(f)+parseFloat(r)),"-"===a&&(f=parseFloat(f)-parseFloat(r)),"+-"===a&&(f=parseFloat(f)-parseFloat(r)),"--"===a&&(f=parseFloat(f)+parseFloat(r))}}if(parseFloat(m).toFixed(2)==parseFloat(f).toFixed(2))var h="1";else h="0";let x=a.replace(/p/g,""),w=x.replace(/=/g,",").replace(/\+/g,",").replace(/-/g,",");$.ajax({type:"post",url:"dgCenter/DgCheck.setProjectFormula.json",data:{menuId:window.sys_menuId,param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:a.replace(/\+/g,"%2B"),param4:r.replace(/\+/g,"%2B"),param5:l.replace(/\+/g,"%2B"),param6:h,param7:x.replace(/\+/g,"%2B"),param8:$("#formulaSubjectId").val(),param9:$("#formulaSubjectName").val(),param10:w,start:-1,limit:-1},dataType:"json",success(e){e.success?(bdoSuccessBox("成功","设置校验数据公式成功！"),$('#formulaModal [data-toggle="tabs"] a:last').tab("show"),$("#tagGroup .col-sm-1").remove()):bdoErrorBox("失败","设置校验数据公式失败！")}})}),$("#tb_search").click(function(){$("#tb_search").blur(),m()}),$("#showContract").change(function(){m()}),$("#tab3").on("click",function(){var e;e={localParam:{tabNum:!0,url:"cpBase/General.query.json",urlparam:{sqlId:"DG00057",menuId:window.sys_menuId,start:-1,limit:-1,param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID}},tableParam:{select:!0,lengthChange:!1,dom:'<"row"<"col-sm-12"tr>>',serverSide:!0,ordering:!1,scrollX:!0,fixedColumns:!0,columnDefs:[{targets:1,className:"text-left width-subject-id",index:1,title:"处理",data:null,render:function(e,t,a,r){var l='<button class="btn btn-xs btn-success table-btn-operate" type="button" name="user_tb_edit" data-placement="top" title="修改 " data-toggle="tooltip"><i class="fa fa-edit"></i></button>&nbsp;';return l+='<button class="btn btn-xs btn-danger table-btn-operate" type="button" name="user_tb_delete" data-placement="top" title="删除 " data-toggle="tooltip"><i class="fa fa-times"></i></button>&nbsp;',1==a.isSubject&&(l+='<button class="btn btn-xs btn-warning table-btn-operate" type="button" name="user_tb_reContract" data-placement="top" title="修改对照 " data-toggle="tooltip"><i class="fa fa-edit"></i></button>'),l+='<input name="autoId" value="'+a.autoId+'" hidden/>'}},{targets:2,index:2,className:"text-left width-subject-id",title:"TB科目编号",name:"tbSubjectId",data:"tbSubjectId"},{targets:3,index:3,className:"text-left width-subject-name",title:"TB科目名称",name:"tbSubjectName",data:"tbSubjectName"},{targets:4,index:4,className:"text-left width-subject-name",title:"报表科目编号",name:"reportSubjectId",data:"reportSubjectId"},{targets:5,index:5,className:"text-left width-subject-name",title:"报表科目名称",name:"reportSubjectName",data:"reportSubjectName"},{targets:6,index:6,className:"text-left width-calfun",title:"计算公式",name:"calFun",data:"calFun",render:function(e,t,a,r){if(null!=e){if(e.length>35){for(var l='<span title="'+e+'">',s=0;s<e.length/35;s++)l+=e.substring(33*s,33*(s+1))+"<br/>";return l+="</span>"}return"<span>"+e+"</span>"}return"<span></span>"}},{targets:7,index:7,className:"text-center width-subject-name",title:"是否科目",name:"isSubject",data:"isSubject",render:function(e,t,a,r){return e?"是":"否"}},{targets:8,index:8,className:"text-center width-seq",title:"排序号",name:"sortNo",data:"sortNo"}]}},BdoDataTable("user_tb_table",e),$("#tab_tbList").hide(),$("#tab_tb_options").show()}),$("#tab2").click(function(){$("#tab_tb_options").hide(),$("#tab_tbList").show()})}),(()=>{$("#tab_tb_options").hide(),$("#tab3").remove(),$("#tb_createReport").hide(),$("#tb_export").hide(),$("#tb_editer").parent().parent().parent().hide(),$("#tb-init-merge-template").hide(),$("#tb-import-offset").hide(),$("#showContract").hide(),$("#tb_search").hide(),$("#title_name").text("试算平衡表"),$("#tab2 > a").text("试算平衡表"),$("#tb_type").hide(),$("#li_tb_offset").hide(),$("#tab_tb_offset").hide(),m(),a()})()}function MonomerUnAuditReport(e){var t,a;t=e.template||tplLoader("dgCenter/html/dg/mergeUnAuditReport.html"),e.template=t,e.data,$(e.region).html(t),$("#headtitle").empty().text(e.data.text);var r=window.CUR_PROJECT_ACC_YEAR;pageRightTitle(pageTitleArr);var l={id:"zc_report1_table",showType:"1",TABLE_DIV:"1",showZero:"2",rptName:{1:"资产负债表",3:"利润表",4:"现金流量表",5:"所有者权益变动表"}};uiBlocksApi(!1,"init");let s=$(".js-tree-collapsed").treeview(!0).getSelected()[0];$("#unReportIndex").text("【"+s.extraOptions.indexId.substring(0,s.extraOptions.indexId.indexOf("-"))+"-"+DG_CONST_UNAUDITREPORT_ENDING+"】"),$("#headtitle").empty().text(s.text);var o=r-1;$("#selectYear").append('<option value="'+r+'" style="color: #000;">'+r+"</option>"),$("#selectYear").append('<option value="'+o+'" style="color: #000;">'+o+"</option>");var n={localParam:{tabNum:!1,url:"dgCenter/HbMergeReport.unAuditReport.json",urlparam:{menuId:window.sys_menuId,start:-1}},tableParam:{select:!0,lengthChange:!0,serverSide:!0,scrollY:!1,dom:'<"row"<"col-sm-12"tr>>',columnDefs:[]}},i={localParam:{tabNum:!1,url:"dgCenter/FUnAuditReport.unAuditReport.json",urlparam:{menuId:window.sys_menuId,refreshFlg:"1"}},tableParam:{select:!0,lengthChange:!0,serverSide:!0,scrollY:!1,dom:'<"row"<"col-sm-12"tr>>',columnDefs:[{targets:1,orderable:!1,className:"text-left font-s12 width-jyx",title:"校验项",name:"colDisp",data:"colDisp"},{targets:2,orderable:!1,className:"text-right width-je",title:r+"年<br>未审数",name:"unAuditAmount"+r,data:"unAuditAmount"+r,render:function(e,t,a,r){return 0==e?'<div width="100%" style="text-align: center">平<div>':null!=e?formatMoney(e):void 0}},{targets:3,orderable:!1,className:"text-right width-je",title:r+"年<br>审计调整数",name:"adjustAmount"+r,data:"adjustAmount"+r,render:function(e,t,a,r){return 0==e?'<div width="100%" style="text-align: center">平<div>':null!=e?formatMoney(e):void 0}},{targets:4,orderable:!1,className:"text-right width-je",title:r+"年<br>审定数",name:"auditAmount"+r,data:"auditAmount"+r,render:function(e,t,a,r){return 0==e?'<div width="100%" style="text-align: center">平<div>':null!=e?formatMoney(e):void 0}},{targets:5,orderable:!1,className:"text-right width-je",title:r-1+"年<br>未审数",name:"unAuditAmount"+(r-1),data:"unAuditAmount"+(r-1),render:function(e,t,a,r){return 0==e?'<div width="100%" style="text-align: center">平<div>':null!=e?formatMoney(e):void 0}},{targets:6,orderable:!1,className:"text-right width-je",title:r-1+"年<br>审计调整数",name:"adjustAmount"+(r-1),data:"adjustAmount"+(r-1),render:function(e,t,a,r){return 0==e?'<div width="100%" style="text-align: center">平<div>':null!=e?formatMoney(e):void 0}},{targets:7,orderable:!1,className:"text-right width-je",title:r-1+"年<br>审定数",name:"auditAmount"+(r-1),data:"auditAmount"+(r-1),render:function(e,t,a,r){return 0==e?'<div width="100%" style="text-align: center">平<div>':null!=e?formatMoney(e):void 0}}]}};var d=function(e){$.ajax({url:"dgCenter/HbMergeReport.unAuditReport.json",type:"post",data:{start:-1,menuId:window.sys_menuId,param4:"2",param5:e},dataType:"json",success:function(t){if(t.success){let a=t.resultInfo.statusText,l=t.data[0];a&&bdoInfoBox("提示",a);let s=$.extend(!0,{},n);s.tableParam=function(e,t,a){for(var r={select:!0,lengthChange:!0,dom:'<"row"<"col-sm-12"tr>>',serverSide:!0,ordering:!1,createdRow(e,t,a){},columnDefs:[{targets:0,orderable:!1,className:"text-center width-seq",title:"序号",visible:!0,render:function(e,t,a,r){return r.settings._iDisplayStart+r.row+1}},{targets:1,orderable:!1,className:"text-left width-code",title:"编号",name:"colCode",data:"colCode",visible:!1},{targets:2,orderable:!1,className:"text-left width-subject-id",title:"科目编号",name:"colCode",data:"colCode",render:function(e,t,a,r){return e.replace(/ /g,"&nbsp;")}},{targets:3,orderable:!1,className:"text-left width-subject-name",title:"科目名称",name:"colDisp",data:"colDisp",render:function(e,t,a,r){return e.indexOf("合计")>0||e.indexOf("总计")>0?"<b>"+e+"</b>":e.replace(/ /g,"&nbsp;")}}]},l=3,s=e;s<=t;s++)r.columnDefs.push({targets:l+1,orderable:!1,className:"text-right width-je",title:"2"==a?s-1+"年<br>期末数":s+"年<br>期末数",name:"2"==a?"remain"+s:"unAuditAmount"+s,data:"2"==a?"remain"+s:"unAuditAmount"+s,render:function(e,t,a,r){return formatMoney(e)}}),r.columnDefs.push({targets:l+2,orderable:!1,className:"text-right width-je",title:"2"==a?s-1+"年<br>客户调整数":s+"年<br>客户调整数",name:"2"==a?"adjustRemain"+s:"adjustAmount"+s,data:"2"==a?"adjustRemain"+s:"adjustAmount"+s,render:function(e,t,a,r){var l=formatMoney(e);return"1"==a.colType&&e&&"0"!=e?l='<label style="font-size: 10px;position: relative;top:5px;"><span style="background-color: #53f9f9;width: 100%;position: relative;top: 0px;display: block;">'+l+"</span></label>":l}}),r.columnDefs.push({targets:l+3,orderable:!1,className:"text-right width-je",title:"2"==a?s-1+"年<br>调整后金额":s+"年<br>调整后金额",name:"2"==a?"adjustedRemain"+s:"adjustedAmount"+s,data:"2"==a?"adjustedRemain"+s:"adjustedAmount"+s,render:function(e,t,a,r){return formatMoney(e)}}),r.columnDefs.push({targets:l+4,orderable:!1,className:"text-right width-je",title:"2"==a?s-1+"年<br>客户报表数字":s+"年<br>客户报表数字",name:"2"==a?"customerRemain"+s:"customerAmount"+s,data:"2"==a?"customerRemain"+s:"customerAmount"+s,render:function(e,t,a,r){return formatMoney(e)}}),r.columnDefs.push({targets:l+5,orderable:!1,className:"text-right width-je",title:"2"==a?s-1+"年<br>差异金额":s+"年<br>差异金额",name:"2"==a?"differenceRemain"+s:"differenceAmount"+s,data:"2"==a?"differenceRemain"+s:"differenceAmount"+s,render:function(e,t,a,r){return formatMoney(e)}}),r.columnDefs.push({targets:l+6,orderable:!1,className:"text-left width-calfun",title:"计算公式",name:"calFun",data:"calFun"}),s<t&&r.columnDefs.push({targets:l+7,orderable:!1,className:"text-right",title:"",width:"10px"}),l+=7;return r}(r,r,e);let o=$.extend(!0,{},n);o.tableParam=function(e,t,a){for(var r={select:!0,lengthChange:!0,dom:'<"row"<"col-sm-12"tr>>',serverSide:!0,ordering:!1,createdRow(e,t,a){},columnDefs:[{targets:0,orderable:!1,className:"text-center width-seq",title:"序号",visible:!0,render:function(e,t,a,r){return r.settings._iDisplayStart+r.row+1}},{targets:1,orderable:!1,className:"text-left width-code",title:"编号",name:"colCode",data:"colCode",visible:!1},{targets:2,orderable:!1,className:"text-left width-subject-id",title:"科目编号",name:"colCode",data:"colCode",render:function(e,t,a,r){return e.replace(/ /g,"&nbsp;")}},{targets:3,orderable:!1,className:"text-lef width-subject-name",title:"科目名称",name:"colDisp",data:"colDisp",render:function(e,t,a,r){return e.indexOf("合计")>0||e.indexOf("总计")>0?"<b>"+e+"</b>":e.replace(/ /g,"&nbsp;")}}]},l=3,s=e;s<=t;s++)r.columnDefs.push({targets:l+1,orderable:!1,className:"text-right width-je",title:"2"==a?"上年数":"本年数",name:"2"==a?"remain"+s:"unAuditAmount"+s,data:"2"==a?"remain"+s:"unAuditAmount"+s,render:function(e,t,a,r){return formatMoney(e)}}),r.columnDefs.push({targets:l+2,orderable:!1,className:"text-right width-je",title:"2"==a?s-1+"年<br>客户调整数":s+"年<br>客户调整数",name:"2"==a?"adjustRemain"+s:"adjustAmount"+s,data:"2"==a?"adjustRemain"+s:"adjustAmount"+s,render:function(e,t,a,r){var l=formatMoney(e);return"1"==a.colType&&e&&"0"!=e?l='<label style="font-size: 10px;position: relative;top:5px;"><span style="background-color: #53f9f9;width: 100%;position: relative;top: 0px;display: block;">'+l+"</span></label>":l}}),r.columnDefs.push({targets:l+3,orderable:!1,className:"text-right width-je",title:"2"==a?s-1+"年<br>调整后金额":s+"年<br>调整后金额",name:"2"==a?"adjustedRemain"+s:"adjustedAmount"+s,data:"2"==a?"adjustedRemain"+s:"adjustedAmount"+s,width:"110px",render:function(e,t,a,r){return formatMoney(e)}}),r.columnDefs.push({targets:l+4,orderable:!1,className:"text-right width-je",title:"2"==a?s-1+"年<br>客户报表数字":s+"年<br>客户报表数字",name:"2"==a?"customerRemain"+s:"customerAmount"+s,data:"2"==a?"customerRemain"+s:"customerAmount"+s,render:function(e,t,a,r){return formatMoney(e)}}),r.columnDefs.push({targets:l+5,orderable:!1,className:"text-right width-je",title:"2"==a?s-1+"年<br>差异金额":s+"年<br>差异金额",name:"2"==a?"differenceRemain"+s:"differenceAmount"+s,data:"2"==a?"differenceRemain"+s:"differenceAmount"+s,render:function(e,t,a,r){return formatMoney(e)}}),r.columnDefs.push({targets:l+6,orderable:!1,className:"text-left width-calfun",title:"计算公式",name:"calFun",data:"calFun"}),s<t&&r.columnDefs.push({targets:l+7,orderable:!1,className:"text-right",title:"",width:"10px"}),l+=7;return r}(r,r,e),s.localParam.data=l.zc,o.localParam.data=l.lr,BdoDataTable("zc_report"+e+"_table",s),BdoDataTable("lr_report"+e+"_table",o);let d=$.extend(!0,{},i);d.localParam.data=l.checkList,BdoDataTable("rpt_tbcheck",d)}else bdoInfoBox("提示",t.resultInfo.statusText)}})};function c(e){return{select:!0,lengthChange:!0,dom:'<"row"<"col-sm-12"tr>>',serverSide:!0,ordering:!1,createdRow(e,t,a){},columnDefs:[{targets:1,orderable:!1,className:"text-center",title:"序号",width:"30px",visible:!0,render:function(e,t,a,r){return r.settings._iDisplayStart+r.row+1}},{targets:2,orderable:!1,className:"text-left",title:"科目编号",name:"colCode",data:"colCode",width:"30px",render:function(e,t,a,r){return e.replace(/ /g,"&nbsp;")}},{targets:3,orderable:!1,className:"text-left",title:"科目名称",name:"colDisp",data:"colDisp",width:"150px",render:function(e,t,a,r){return e.indexOf("合计")>0||e.indexOf("总计")>0?"<b>"+e+"</b>":e.replace(/ /g,"&nbsp;")}},{targets:4,orderable:!1,className:"text-right",title:"本年客户报表数字",name:"customerAmount"+e,data:"customerAmount"+e,width:"150px",render:function(e,t,a,r){return formatMoney(e)}},{targets:5,orderable:!1,className:"text-right",title:"上年客户报表数字",name:"customerRemain"+e,data:"customerRemain"+e,width:"150px",render:function(e,t,a,r){return formatMoney(e)}},{targets:6,orderable:!1,className:"text-right",title:"本期-上期",name:"absRemain",data:"absRemain",width:"150px",render:function(e,t,a,r){return formatMoney(e)}}]}}d("1"),Promise.resolve().then(()=>{OneUI.initHelper("slimscroll")}),a=(()=>{$("#report_editer").change(function(){$.ajax({type:"post",url:"dgCenter/FTBSubjectContract.saveTbEditer.json",data:{param2:"2",param3:$(this).val(),param4:$(this).find("option:selected").attr("label")},dataType:"json",success(e){e.success?bdoSuccessBox("保存报表编制人成功！"):bdoErrorBox(e.resultInfo.statusText)}})}),$("#abs-remain").click(function(){$("#tab2_unAuditReportser").addClass("active"),$($("#report1_type li")[3]).hide(),$($("#report2_type li")[3]).hide(),$("#tab_head_rpt").hide(),$.ajax({url:"dgCenter/HbMergeReport.unAuditReport.json",type:"post",data:{start:-1,menuId:window.sys_menuId,param4:"2",param5:1},dataType:"json",success:function(e){if(e.success){var t=e.resultInfo.statusText;e=e.data[0];t&&bdoInfoBox("提示",t);let a=$.extend(!0,{},n);a.tableParam=c(r);let l=$.extend(!0,{},n);l.tableParam=c(r);let s=$.extend(!0,{},l);a.localParam.data=e.zc,l.localParam.data=e.lr,s.localParam.data=e.xj,BdoDataTable("zc_report1_table",a),BdoDataTable("lr_report1_table",l),BdoDataTable("zc_report2_table",a),BdoDataTable("lr_report2_table",l)}else bdoErrorBox("失败",e.resultInfo.statusText)}})}),$("#tab3").on("click","a",function(){$("#unReportIndex").text("【"+s.extraOptions.indexId.substring(0,s.extraOptions.indexId.indexOf("-"))+"-"+DG_CONST_UNAUDITREPORT_BEGINNING+"】"),$($("#report2_type li")[3]).show(),$("#tab_head_rpt").show(),d("2")}),$("#tab1").on("click","a",function(){$("#unReportIndex").text("【"+s.extraOptions.indexId.substring(0,s.extraOptions.indexId.indexOf("-"))+"-"+DG_CONST_UNAUDITREPORT_ENDING+"】"),$($("#report1_type li")[3]).show(),$("#tab_head_rpt").show(),d("1")}),$("#rpt_search").click(function(){$("#rpt_search").blur(),d(l.showType)}),$('#subPageRight  [data-toggle="tabs"]').on("click","a",function(e){e.preventDefault(),$("#abs-remain").hasClass("active")?$(this).tab("show"):("tab_unAuditReport"==$(this).closest("ul").attr("id")&&$(this).parent().index()>1?$("#tab_head_rpt").hide():$("#tab_head_rpt").show(),$(this).tab("show"))}),$('#subPageRight [data-toggle="tabs"]').on("shown.bs.tab",function(e){var t=$("#tab_unAuditReport").find("li[class=active] a");l.showType=t.attr("data-content"),window.showType=l.showType;var a=t.attr("data-result"),r=$("#"+a).find("li[class=active] a");l.id=r.attr("data-result"),l.TABLE_DIV=r.attr("data-content")})}),(()=>{$("#rpt_check_Report").parent().hide(),$("#rpt_createReport").parent().hide(),$("#rpt_save").parent().hide(),$("#rpt_importCustomerReport").parent().hide(),$("#rpt_export").parent().hide(),$("#report_editer").parent().parent().hide(),$("#rpt_showZero").parent().hide(),$("#rpt_adjustReport").parent().hide(),$("#report1_type > li:nth-child(1) > a > i").text("资产负债表"),$("#report2_type > li:nth-child(1) > a > i").text("资产负债表"),$("#report1_type > li:nth-child(2) > a > i").text("利润表"),$("#report2_type > li:nth-child(2) > a > i").text("利润表"),$("#tab3 > a").text("未审报表-期初/上期"),$("#tab1 > a").text("未审报表-期末/本期"),$("#unReportName").text("未审报表"),a()})()}function Counteract(e){var t,a;t=e.template||tplLoader("dgCenter/html/dg/offsetAdjustment.html"),e.template=t,$(e.region).html(t),$("#headtitle").empty().text(e.data.text),pageRightTitle(pageTitleArr);let r=[],l={companyFirst:"",companySecond:"",journalizingWay:"",journalizingType:""},s=[],o=[{label:"--请选择--",value:""}],n=[{label:"--请选择--",value:""}],i=[{label:"--请选择--",value:""}],d=[{label:"--请选择--",value:""},{label:window.CUR_PROJECT_ACC_YEAR,value:window.CUR_PROJECT_ACC_YEAR},{label:window.CUR_PROJECT_ACC_YEAR-1,value:window.CUR_PROJECT_ACC_YEAR-1}],c=function(e,t,a){let r=document.querySelectorAll(e);if(!r)return;let l=!1;for(let e=0;e<r.length;e++)r[e].innerHTML=t instanceof Array?t.map(t=>(l=a&&r[e].name+e in a,t.value instanceof Array?`<optgroup label="${t.label}">`+t.value.map(t=>`\n\t\t\t\t\t\t\t\t\t\t<option ${l&&a[r[e].name+e]==t.value?"selected":""} value="${t.value}">${t.label}</option>\n\t\t\t\t\t\t\t\t\t`).join("")+"</optgroup>":`<option ${l&&a[r[e].name+e]==t.value?"selected":""} value="${t.value}">${t.label}</option>`)).join(""):null};let u=function(e,t){let a=document.querySelector(e);a&&(a.innerHTML=t instanceof Array?t.map(e=>(function e(t){return"<li>"+`<input type="checkbox" name="${t.value}" onchange="onTreeNodeChange(this.checked, '${t.value}')"/>&nbsp;`+`<span>${t.label}</span>`+(t.children instanceof Array?"<ul>"+t.children.map(t=>e(t)).join("")+"</ul>":"")+"</li>"})(e)).join(""):null)};function m(){let e=document.getElementById("template_modal");e&&(e.style.display="none")}function p(e,t,a){e&&(l[e]=t,a&&(r=[],function(){let e=document.getElementById("template_modal");e&&(e.style.display="block")}(),function(e){e("#sel_tree",[{label:"第1组模板",value:"001",children:[{label:"借",value:"001001",children:[{label:"购买商品、接受劳务支付的现金",value:"001001001"},{label:"支付其他与经济活动有关的现金",value:"001001002"},{label:"购建固定资产、无形资产和其他长期资产支付的现金",value:"001001003"}]},{label:"贷",value:"001002",children:[{label:"处置固定资产、无形资产和其他长期资产收回的现金净额",value:"001002001"}]}]},{label:"第2组模板",value:"002",children:[{label:"借",value:"002001",children:[{label:"购建固定资产、无形资产和其他长期资产支付的现金",value:"002001001"}]},{label:"贷",value:"002002",children:[{label:"处置固定资产、无形资产和其他长期资产收回的现金净额",value:"002002001"},{label:"销售商品、提供劳务收到的现金",value:"002002002"}]}]}])}(u)))}function b(e,t){let a=t?`[name^="${t}"]`:"",r=document.querySelectorAll(`#sel_tree input${a}`);if(r)for(let t=0;t<r.length;t++)r[t].checked=e}function g(e,t,a){if(e>=s.length)return;let r=s[e];r&&(r.active=!0,r[t]=a)}function f(){let e=document.querySelector("#table_body");if(!e)return;let t={};e.innerHTML=s.map((e,a)=>(e.company&&(t[`company${a}`]=e.company),e.accountItem&&(t[`accountItem${a}`]=e.accountItem),`<tr>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<div class="action-btn">+</div>\n\t\t\t\t\t\t\t<div class="action-btn">-</div>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<input name="digest" placeholder="请输入摘要信息" value="${e.digest}"\n\t\t\t\t\t\t\t\t style="width:100%;"/>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<select name="company"  style="width:100%;"/>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<select name="accountItem" style="width:100%;"/>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<input type="number" placeholder="请输入金额" value="${e.debtorAmount}" style="width:100%;"\n\t\t\t\t\t\t\t\t name="debtorAmount"/>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<input type="number" placeholder="请输入金额" value="${e.creditorAmount}" style="width:100%;"\n\t\t\t\t\t\t\t\t name="creditorAmount"/>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>`)).join(""),function(e,t){e('select[name="company"]',i,t)}(c,t),function(e,t){e('select[name="accountItem"]',n,t)}(c,t)}function h(e){return{id:((new Date).getTime()+e||1).toString(),active:!1,digest:"",company:"",accountItem:"",debtorAmount:"",creditorAmount:""}}function x(e,t){let a=null;if(e instanceof Array)a=e;else if("number"==typeof e&&e>0){a=[];for(let t=0;t<e;t++)a.push(h(t))}else a=[e||h(2)];s.splice(t>=0?t+1:-1,0,...a),f()}function w(){!function(e){e("#company_first",i)}(c),function(e){e("#company_second",i)}(c),function(e){e("#journalizing_way",[{label:"--请选择--",value:""},{label:"抵消",value:"2"},{label:"现金流量表抵消",value:"3"}])}(c),function(e){e("#journalizing_type",[{label:"--请选择--",value:""},{label:"以现金投资或收购股权增加的投资所产生的现金流量的抵销处理",value:"1"},{label:"取得投资收益收到的现金与分配股利、利润或偿付利息支付的现金的抵销处理",value:"2"},{label:"销售商品所产生的现金流量的抵销处理",value:"3"},{label:"固定资产等收回的现金净额与购建固定资产支付的抵销处理",value:"4"},{label:"内部往来账户交易所产生的现金流量的抵销处理",value:"4"}])}(c),function(e){e("#adjust_year",d)}(c),x(4)}function I(){$("#journalizing_way").val(""),$("journalizing_type").val(""),$("#company_first").val(""),$("#company_second").val(""),$("#remark").val(""),$("#adjust_year").val(""),s=[]}function y(){let e=$('#table_body input[name="debtorAmount"]'),t=$('#table_body input[name="creditorAmount"]'),a=0,r=0;e.each(function(){let e=parseFloat($(this).val().replace(/,/g,""));isNaN(e)?a+=0:a+=e}),t.each(function(){let e=parseFloat($(this).val().replace(/,/g,""));isNaN(e)?r+=0:r+=e}),$("#deb_span").text(formatMoney2(a)),$("#cre_span").text(formatMoney2(r)),$("#diff_span").text(formatMoney2(a-r))}a=(()=>{w(),$("#table_body").on("click","tr > td > div:nth-child(1)",function(){let e=$(this).closest("tr")[0].rowIndex;x(null,e-=1)}),$("#table_body").on("click","tr > td > div:nth-child(2)",function(){if(s.length<=2)return;let e=$(this).closest("tr")[0].rowIndex;var t;(t=e-=1)>=s.length||(s.splice(t,1),f()),$(this).parent().parent().remove()}),$("#journalizing_type").change(function(){p("journalizingType",this.value,!0)}),$("#table_body").on("change","tr > td > select",function(){let e=$(this).closest("tr")[0].rowIndex;g(e-=1,this.name+"Name",$(this).find("option:selected").text()),g(e,this.name,this.value)}),$("#table_body").on("change","tr > td > input",function(){let e=$(this).closest("tr")[0].rowIndex;this.name,g(e-=1,this.name,this.value)}),$("#journalizing_way").change(function(){switch(this.value){case"1":case"2":c('select[name="accountItem"]',n,"");break;case"3":c('select[name="accountItem"]',o,"")}}),$("#table_body").on("change","input[name=creditorAmount]",function(){let e=$(this).closest("tr").find("input[name=debtorAmount]"),t=$(this).val();t||""!=t?(e.prop("placeholder",""),e.addClass("display"),e.prop("disabled",!0),$(this).prop("type","text"),$(this).text(formatMoney2(t)),$(this).val(formatMoney2(t))):(e.prop("disabled",!1),e.prop("placeholder","请输入金额"),e.removeClass("display"),$(this).prop("type","number")),y()}),$("#table_body").on("change","input[name=debtorAmount]",function(){let e=$(this).closest("tr").find("input[name=creditorAmount]"),t=$(this).val();t||""!=t?(e.addClass("display"),e.prop("placeholder",""),e.prop("disabled",!0),$(this).prop("type","text"),$(this).text(formatMoney2(t)),$(this).val(formatMoney2(t))):(e.prop("disabled",!1),e.prop("placeholder","请输入金额"),e.removeClass("display"),$(this).prop("type","number")),y()}),$("#close_adjust").click(function(){I(),w(),$("#sideRegin").hide()}),$("#adjust_close").click(function(){$("#close_adjust").click()}),$("#template_modal > div > div > section.header > span:nth-child(2)").click(()=>{m()}),$("#cancel_btn").click(()=>{m()}),$("#tree_submit").click(()=>{!function(){let e=document.querySelectorAll("#sel_tree input");if(r=[],e)for(let t=0;t<e.length;t++)e[t].checked&&r.push(e[t].name);m()}()}),$("#clean_all_btn").click(()=>{b(!1)}),$("#select_all_btn").click(()=>{b(!0)}),$("#save_adjust").click(function(){let e={},t=[];for(let e of s)e.active&&e.accountItem&&""!==e.accountItem&&t.splice(0,0,e);e.arr=t,e.adjustType=$("#journalizing_way").val(),e.templateType=$("journalizing_type").val(),e.projectId=$("#company_first").val(),e.projectName=$("#company_first option:selected").text(),e.projectId1=$("#company_second").val(),e.projectName1=$("#company_second option:selected").text(),e.description=$("#remark").val(),e.yyyy=$("#offset_dgYear2").text(),$.ajax({url:"dgCenter/HbElimination.addAdjust.json",type:"post",async:!1,data:{sqlId:"",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:JSON.stringify(e),start:-1,limit:-1},dataType:"json",success:function(e){$("#close_adjust").click(),$("#tb_type > li.active").click(),s=[],I(),w()}})})}),(()=>{$("#offset_dgName2").text(window.CUR_CUSTOMERNAME),$.ajax({url:"dgCenter/HbElimination.findSelect.json",type:"post",async:!1,data:{sqlId:"",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,start:-1,limit:-1},dataType:"json",success:function(e){if(e.success){o=[{label:"--请选择--",value:""}];let t=e.data[0];for(let e in t){let a={label:e,value:t[e]};o.splice(o.length,0,a)}n=[{label:"--请选择--",value:""}];let a=e.data[1];for(let e in a){let t={label:e,value:a[e]};n.splice(n.length,0,t)}i=[{label:"--请选择--",value:""}];let r=e.data[2];for(let e in r){let t={label:e,value:r[e]};i.splice(i.length,0,t)}}else bdoErrorBox("失败",e.resultInfo.statusText)}}),a()})()}$(".block").on("mousewheel",function(e){var t=$(".active .dataTables_scrollBody").scrollTop();if(1==e.deltaY){if(t<=0)return;t-=80,$(".active .dataTables_scrollBody").scrollTop(t)}else if(-1==e.deltaY){if($(".active .dataTables_scrollBody")[1]){if($(".active .dataTables_scrollBody")[1].scrollHeight-500<=t)return}else if($(".active .dataTables_scrollBody").scrollHeight-500<=t)return;t+=80,$(".active .dataTables_scrollBody").scrollTop(t)}}),MergeReport=function(e){var t,a;t=e.template||tplLoader("dgCenter/html/dg/mergeReport.html"),e.template=t,e.data,$(e.region).html(t),$("#headtitle").empty().text(e.data.text);let r=0;var l=window.CUR_PROJECT_ACC_YEAR;pageRightTitle(pageTitleArr);var s={id:"zc_report1_table",showType:"1",TABLE_DIV:"1",showZero:"2",rptName:{1:"合并资产负债表",3:"合并利润表",10:"合并现金流量表",5:"合并所有者权益变动表"}};uiBlocksApi(!1,"init");var o={localParam:{tabNum:!1,url:"dgCenter/HbMergeReport.auditedStatementQuery.json",urlparam:{menuId:window.sys_menuId,start:-1}},tableParam:{select:!0,lengthChange:!0,serverSide:!0,scrollY:!1,dom:'<"row"<"col-sm-12"tr>>',columnDefs:[]}},n={localParam:{tabNum:!1,url:"dgCenter/FUnAuditReport.tbListCheck.json",urlparam:{menuId:window.sys_menuId}},tableParam:{select:!0,lengthChange:!0,serverSide:!0,scrollY:!1,dom:'<"row"<"col-sm-12"tr>>',columnDefs:[{targets:1,orderable:!1,className:"text-left",title:"校验项",name:"colDisp",data:"colDisp",width:"370px"},{targets:2,orderable:!1,className:"text-right",title:l+"年<br>审定数",name:"auditAmount",data:"auditAmount",width:"100px",render:function(e,t,a,r){return 0==e?'<div width="100%" style="text-align: center">平<div>':null!=e?formatMoney(e):void 0}},{targets:3,orderable:!1,className:"text-right",title:l-1+"年<br>审定数",name:"preAuditAmount",data:"preAuditAmount",width:"100px",render:function(e,t,a,r){return 0==e?'<div width="100%" style="text-align: center">平<div>':null!=e?formatMoney(e):void 0}}]}},i={localParam:{tabNum:!1,url:"",urlparam:{menuId:window.sys_menuId,start:-1,limit:-1}},tableParam:{select:!0,dom:'<"row"<"col-sm-12"tr>>',serverSide:!0,lengthChange:!1,ordering:!1,createdRow(e,t,a){if("1"==t.colType){$(e).addClass("edit-able");for(let t=3;t<14;t++)$(e).find("td").eq(t).addClass("bg-success-light")}},columnDefs:[{targets:(()=>(r=0,++r))(),orderable:!1,className:"text-center width-seq",title:"序号",visible:!0,render:function(e,t,a,r){return r.settings._iDisplayStart+r.row+1}},{targets:1,orderable:!1,className:"text-left width-code",title:"编号",name:"colCode",data:"colCode",visible:!1},{targets:2,orderable:!1,className:"text-left width-subject-id",title:"科目编号",name:"colCode",data:"colCode"},{targets:3,orderable:!1,className:"text-left width-subject-name",title:"科目名称",name:"colDisp",data:"colDisp",render:function(e,t,a,r){return e.indexOf("合计")>0||e.indexOf("总计")>0?"<b>"+e+"</b>":e.replace(/ /g,"&nbsp;")}}]}},d={qy:{1:{},2:{}}};function c(e){let t=[];null!=e.columnDesc1&&t.push(e.columnDesc1),null!=e.columnDesc2&&t.push(e.columnDesc2),null!=e.columnDesc3&&t.push(e.columnDesc3),null!=e.columnDesc4&&t.push(e.columnDesc4),null!=e.columnDesc5&&t.push(e.columnDesc5),null!=e.columnDesc6&&t.push(e.columnDesc6),null!=e.columnDesc7&&t.push(e.columnDesc7),null!=e.columnDesc8&&t.push(e.columnDesc8),null!=e.columnDesc9&&t.push(e.columnDesc9),null!=e.columnDesc10&&t.push(e.columnDesc10),null!=e.columnDesc11&&t.push(e.columnDesc11),null!=e.columnDesc12&&t.push(e.columnDesc12),null!=e.columnDesc13&&t.push(e.columnDesc13),null!=e.columnDesc14&&t.push(e.columnDesc14),null!=e.columnDesc15&&t.push(e.columnDesc15);let a=$.extend(!0,{},i);a.tableParam.columnDefs=a.tableParam.columnDefs.splice(0,4);for(var r=0,l=t.length;r<l;r++)a.tableParam.columnDefs.push({targets:r+4,orderable:!1,className:"text-right width-je",title:t[r],name:"column"+(r+1),data:"column"+(r+1),render:function(e,t,a,r){return formatMoney(e)}});return a}function u(){m("1")}var m=function(e){$.ajax({url:"dgCenter/HbMergeReport.auditedStatementQuery.json",type:"post",data:{start:-1,menuId:window.sys_menuId,param4:"2",param5:e},dataType:"json",success:function(t){if(t.success){let l=t.resultInfo.statusText,s=t.data[0];l&&bdoInfoBox("提示",l);var a=$.extend(!0,{},o);a.tableParam={select:!0,lengthChange:!0,dom:'<"row"<"col-sm-12"tr>>',serverSide:!0,ordering:!1,columnDefs:[{targets:(()=>(r=0,++r))(),orderable:!1,className:"text-center width-seq",title:"序号",visible:!0,render:function(e,t,a,r){return r.settings._iDisplayStart+r.row+1}},{targets:++r,orderable:!0,className:"text-left width-subject-id",title:"科目编号",name:"subjectId",data:"subjectId",render:function(e,t,a,r){return e}},{targets:++r,orderable:!0,title:"科目名称",name:"subjectName",data:"subjectName",className:"dg-ap width-subject-name",render:function(e,t,a,r){return e.indexOf("合计")>0||e.indexOf("总计")>0?"<b>"+e+"</b>":e.replace(/ /g,"&nbsp;")}},{targets:++r,orderable:!0,title:"审定数",name:"auditAmount",data:"auditAmount",className:"text-right width-je",render:function(e,t,a,r){return formatMoney(e)}},{targets:++r,orderable:!0,title:"年初数",name:"preAuditAmount",data:"preAuditAmount",className:"text-right width-je",render:function(e,t,a,r){return formatMoney(e)}}]};let d=$.extend(!0,{},o);d.tableParam={select:!0,lengthChange:!0,dom:'<"row"<"col-sm-12"tr>>',serverSide:!0,ordering:!1,createdRow(e,t,a){t.flag&&($(e).addClass("edit-able"),$(e).find("td:eq(3)").addClass("bg-success-light"))},columnDefs:[{targets:(()=>(r=0,++r))(),orderable:!1,className:"text-center width-seq",title:"序号",visible:!0,render:function(e,t,a,r){return r.settings._iDisplayStart+r.row+1}},{targets:++r,orderable:!0,className:"text-left width-subject-id",title:"科目编号",name:"subjectId",data:"subjectId",render:function(e,t,a,r){return e}},{targets:++r,orderable:!0,title:"科目名称",name:"subjectName",data:"subjectName",className:"dg-ap width-subject-name",render:function(e,t,a,r){return e.indexOf("合计")>0||e.indexOf("总计")>0?"<b>"+e+"</b>":e.replace(/ /g,"&nbsp;")}},{targets:++r,orderable:!0,title:"审定数",name:"auditAmount",data:"auditAmount",className:"text-right width-je",render:function(e,t,a,r){return formatMoney(e)}},{targets:++r,orderable:!0,title:"上年数",name:"preAuditAmount",data:"preAuditAmount",className:"text-right width-je",render:function(e,t,a,r){return formatMoney(e)}}]};let u=$.extend(!0,{},o),m=$.extend(!0,{},i),p=$.extend(!0,{},i);a.localParam.data=s.zc,d.localParam.data=s.lr,u=c(s.txj[0]),m=c(s.tqy[0]),p=c(s.tlqy[0]),u.localParam.data=s.xj,m.localParam.data=s.qy,p.localParam.data=s.lqy,BdoDataTable("zc_report"+e+"_table",a),BdoDataTable("lr_report"+e+"_table",d),BdoDataTable("xj_report"+e+"_table",u),BdoDataTable("qy_report"+e+"_table",m),BdoDataTable("lqy_report"+e+"_table",p);let b=$.extend(!0,{},n);return b.localParam.data=s.checkList,void BdoDataTable("rpt_tbcheck",b)}bdoErrorBox("失败",t.resultInfo.statusText)}})};function p(e){return new Promise((t,a)=>{var r,l=$(".js-tree-collapsed").treeview(!0).getSelected()[0],s=l.extraOptions.indexId,o=l.extraOptions.autoId;4==e?r=s+"-审定报表-现金流量表.xlsx":5!=e&&6!=e||(r=s+"-审定报表-所有者权益变动表.xlsx"),$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",bdolxLoader:!1,data:{menuId:window.sys_menuId,sqlId:"DG00227",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:s,param4:r,start:-1,limit:-1},dataType:"json",success(l){l.success?null!=l.data[0]?t():$.ajax({type:"post",url:"dgCenter/DgAuditFile.auditReportFile.json",bdolxLoader:!1,data:{param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:s,param4:r,param5:o,param6:e},dataType:"json",success(e){e.success?t():a()},error(){a()}}):a()},error(){a()}})})}!function(){let e=$(".js-tree-collapsed").treeview(!0).getSelected()[0];$("#auditedStateIndex").text("【"+e.extraOptions.indexId+"】"),m("1"),OneUI.initHelper("slimscroll")}(),a=(()=>{$("#rpt_search").click(e=>{e.preventDefault(),$("#rpt_search").blur(),u()}),$('#subPageRight [data-toggle="tabs"]').on("click","a",function(e){e.preventDefault(),"tab_unAuditReport"==$(this).closest("ul").attr("id")&&$(this).parent().index()>1?$("#tab_head_rpt").hide():$("#tab_head_rpt").show(),$(this).tab("show")}),$('#subPageRight [data-toggle="tabs"]').on("shown.bs.tab",function(e){var t=$("#tab_unAuditReport").find("li[class=active] a");s.showType=t.attr("data-content");var a=t.attr("data-result"),r=$("#"+a).find("li[class=active] a");s.id=r.attr("data-result"),s.TABLE_DIV=r.attr("data-content")}),$("#rpt_check_Report").on("click",function(){$("#rpt_check_Report").blur(),bdoAjaxBox("系统提示",window.CUR_PROJECT_ACC_YEAR+"年审定报表确定完成核对吗？",function(){bdoInProcessingBox("核对中"),Promise.all([p(4),p(5)]).then(()=>{$.ajax({type:"post",url:"dgCenter/FUnAuditReport.checkAudit.json",data:{param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECT_ACC_YEAR,param3:window.CUR_PROJECT_ACC_YEAR},dataType:"json",success:function(e){e.success?bdoSuccessBox("核对成功",e.resultInfo.statusText):bdoErrorBox("核对失败",e.resultInfo.statusText)}})}).catch(()=>{bdoErrorBox("失败","审定报表数据生成失败")})})}),$("#qy_report1, #lqy_report1").on("dblclick","tbody tr.edit-able td.bg-success-light",function(){let e=$(this),t=(e.parent().index(),e.closest("table")),a=t.attr("id"),r=t.DataTable().context[0].aoColumns[$(this).index()+1],l=t.DataTable().row($(this).closest("tr")).data(),s=l[r.name],o="1";if("lqy_report1_table"==a&&(o="2"),r.name.indexOf("column12")>=0)return;e.html("<span><input type='text' style='width:100%; align=right;'></span>");let n=$(this).find("input");0!=s&&n.val(s),n.focus(),n.on("keydown",function(e){13==e.keyCode&&n.blur()}),n.on("blur",function(){let t=$(this).val().toString().replace(/,/g,"");if(""==t)e.html(0);else if(isNaN(t))e.html(s);else{let a=1*t;e.html(a.toFixed(2))}l[r.name]=e.html();let a=0;for(let e in l)e.indexOf("column")>=0&&"column12"!=e&&(a+=1*l[e]);e.nextAll().last().html(a.toFixed(2));let n={colCode:l.colCode};l.autoId in d.qy[o]&&(n=d.qy[o][l.autoId]),n[r.name]=l[r.name],n.column12=a,d.qy[o][l.autoId]=n})}),$("#xj_report1").on("dblclick","tbody tr.edit-able td.bg-success-light",function(){let e="";if($(this).hasClass("bg-success-light")){e=1;var t=$(this).closest("td"),a=t.closest("table");if(!(a.attr("id").indexOf("qy_report")>=0)){var r=a.DataTable().context[0].aoColumns[a.DataTable().cell(this).index().column],l=a.DataTable().row($(this).closest("tr")).data();if(3==e||1==e){if(1!=l.colType)return;if(l.subjectName.indexOf("合计")>0||l.subjectName.indexOf("总计")>0)return;var s=l[r.name];t.html("<span><input type='text' style='width:100%; align=right;'></span>");var o=$(this).find("input");0!=s&&o.val(s),o.focus(),o.on("keydown",function(e){13==e.keyCode&&o.blur()}),o.on("blur",function(){let e=$(this).val().toString().replace(/,/g,"");if(""==e)t.html(0);else if(isNaN(e))t.html(s);else{var a=1*e;t.html(a.toFixed(2))}if(t.html()!=l[r.name]){let e="unAuditAmount";"auditedRemain"==r.name&&(e="remain"),l[r.name]=t.html();var o={};l.subjectId in d&&(o=d[l.subjectId]),o[e]=l[r.name],d[l.subjectId]=o}})}}}}),$('button[name="openXJQYFile"]').click(function(){var e,t=$(".js-tree-collapsed").treeview(!0).getSelected()[0],a=t.extraOptions.indexId,r=t.extraOptions.autoId;"4"==s.TABLE_DIV?e=a+"-审定报表-现金流量表.xlsx":"5"!=s.TABLE_DIV&&"6"!=s.TABLE_DIV||(e=a+"-审定报表-所有者权益变动表.xlsx"),bdoInProcessingBox("加载中..."),$.ajax({type:"post",url:"dgCenter/DgAuditFile.auditReportFile.json",data:{param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:a,param4:e,param5:r,param6:s.TABLE_DIV},dataType:"json",success(e){if(e.success){var t={extraOptions:e.data[0].data[0],currentNode:{extraOptions:e.data[0].data[0]}};t.autoId=t.extraOptions.autoId,t.workpaperId=t.extraOptions.workpaperId,t.menuId=window.sys_menuId,$.sessionStorage("subjecttreeNode",JSON.stringify(t)),u(),bdoSuccessBox("加载完成"),window.open("/Faith/dgcenter.do?m=openQYXJFile&customerId="+window.CUR_CUSTOMERID+"&projectId="+window.CUR_PROJECTID+"&fileType=2")}else bdoErrorBox("失败",e.resultInfo.statusText)}})}),$("#audit_report_export").click(function(){bdoInProcessingBox("导出中"),Promise.all([p(4),p(5)]).then(()=>{!function(){let e=[{page:"",start:"",limit:"",queryUrl:"dgCenter/HbMergeReport.auditedStatementQuery.json",menuId:window.sys_menuId,param4:"2",param5:"1"},{page:"",start:"",limit:"",queryUrl:"dgCenter/FUnAuditReport.tbListCheck.json",menuId:window.sys_menuId,param3:""}],t={menuId:window.sys_menuId,param1:JSON.stringify(e),param2:"审定报表"};$.ajax({url:"dgCenter/ExportOtherDg.exportAuditReport.json",bdolxLoader:!1,data:t,type:"post",dataType:"json",success:function(e){if(e.success){if(bdoInfoBox("导出成功","审定报表导出成功！",2e3),e.data&&e.data.length>0){let t=e.data[0].fileData,a=e.data[0].fileName;e.data[0].isNew,saveAs(dataURLtoFile(t,a),a)}getSubjecttree({param1:window.CUR_PROJECTID,param2:$("#onlyMyselfCheckBox").get(0).checked?"1":""},e=>{$(".js-tree-collapsed").trigger("rebuild",[{data:[e.data[0].treeData],levels:2,callback(e){$.each(e.findNodes(),(t,a)=>{"OPINIONS"!=a.extraOptions.nodeType&&"AUDITED"!=a.extraOptions.nodeType||(e.expandNode(a.nodeId,{levels:a.deep+2,silent:!0}),e.selectNode(a.nodeId,{silent:!0}))})}}])})}else bdoErrorBox("失败",e.resultInfo&&e.resultInfo.statusText)}})}()}).catch(()=>{bdoErrorBox("失败","审定报表数据生成失败")})})}),(()=>{a()})()},MonomerReport=function(e){var t,a,r,l,s;let o;t=e.template||tplLoader("dgCenter/html/dg/mergeReport.html"),e.template=t,e.data,$(e.region).html(t),$("#headtitle").empty().text(e.data.text),!o&&($.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",dataType:"json",data:{menuId:window.sys_menuId,sqlId:"HB00015",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,start:-1,limit:-1},success:function(e){e.success&&(r=e.data[0].mergeCustomerId,a=e.data[0].mergeProjectId)}}),o=1);let n=0;pageRightTitle(pageTitleArr);var i={id:"zc_report1_table",showType:"1",TABLE_DIV:"1",showZero:"2",rptName:{1:"资产负债表",3:"利润表",4:"现金流量表",5:"所有者权益变动表"}};uiBlocksApi(!1,"init");var d={localParam:{tabNum:!1,url:"dgCenter/HbMergeReport.auditReport.json",urlparam:{menuId:window.sys_menuId,start:-1}},tableParam:{select:!0,lengthChange:!0,serverSide:!0,scrollY:!1,dom:'<"row"<"col-sm-12"tr>>',columnDefs:[]}},c={localParam:{tabNum:!1,url:"dgCenter/FUnAuditReport.tbListCheck.json",urlparam:{menuId:window.sys_menuId}},tableParam:{select:!0,lengthChange:!0,serverSide:!0,scrollY:!1,dom:'<"row"<"col-sm-12"tr>>',columnDefs:[]}},u={localParam:{tabNum:!1,url:"",urlparam:{menuId:window.sys_menuId,start:-1,limit:-1}},tableParam:{select:!0,dom:'<"row"<"col-sm-12"tr>>',serverSide:!0,lengthChange:!1,ordering:!1,createdRow(e,t,a){if("1"==t.colType){$(e).addClass("edit-able");for(let t=3;t<14;t++)$(e).find("td").eq(t).addClass("bg-success-light")}},columnDefs:[{targets:(()=>(n=0,++n))(),orderable:!1,className:"text-center width-seq",title:"序号",visible:!0,render:function(e,t,a,r){return r.settings._iDisplayStart+r.row+1}},{targets:1,orderable:!1,className:"text-left width-code",title:"编号",name:"colCode",data:"colCode",visible:!1},{targets:2,orderable:!1,className:"text-left width-subject-id",title:"科目编号",name:"colCode",data:"colCode"},{targets:3,orderable:!1,className:"text-left width-subject-name",title:"科目名称",name:"colDisp",data:"colDisp",render:function(e,t,a,r){return e.indexOf("合计")>0||e.indexOf("总计")>0?"<b>"+e+"</b>":e.replace(/ /g,"&nbsp;")}}]}};function m(){if("4"==i.TABLE_DIV||"5"==i.TABLE_DIV||"6"==i.TABLE_DIV){$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",async:!0,data:{menuId:window.sys_menuId,sqlId:"DG00225",param1:r,param2:a,param3:l,param4:i.TABLE_DIV,start:-1,limit:-1},dataType:"json",success(e){if(e.success&&null!=e.data[0]){var t=[];null!=e.data[0].columnDesc1&&t.push(e.data[0].columnDesc1),null!=e.data[0].columnDesc2&&t.push(e.data[0].columnDesc2),null!=e.data[0].columnDesc3&&t.push(e.data[0].columnDesc3),null!=e.data[0].columnDesc4&&t.push(e.data[0].columnDesc4),null!=e.data[0].columnDesc5&&t.push(e.data[0].columnDesc5),null!=e.data[0].columnDesc6&&t.push(e.data[0].columnDesc6),null!=e.data[0].columnDesc7&&t.push(e.data[0].columnDesc7),null!=e.data[0].columnDesc8&&t.push(e.data[0].columnDesc8),null!=e.data[0].columnDesc9&&t.push(e.data[0].columnDesc9),null!=e.data[0].columnDesc10&&t.push(e.data[0].columnDesc10),null!=e.data[0].columnDesc11&&t.push(e.data[0].columnDesc11),null!=e.data[0].columnDesc12&&t.push(e.data[0].columnDesc12),null!=e.data[0].columnDesc13&&t.push(e.data[0].columnDesc13),null!=e.data[0].columnDesc14&&t.push(e.data[0].columnDesc14),null!=e.data[0].columnDesc15&&t.push(e.data[0].columnDesc15),u.tableParam.columnDefs=u.tableParam.columnDefs.splice(0,4);for(var a=0,r=t.length;a<r;a++)u.tableParam.columnDefs.push({targets:a+4,orderable:!1,className:"text-right width-je",title:t[a],name:"column"+(a+1),data:"column"+(a+1),render:function(e,t,a,r){return null==e?"":formatMoney(e)}})}}});var e=$.extend(!0,{},u);e.localParam.url="dgCenter/DgGeneral.query.json",e.localParam.urlparam.sqlId="DG00226",e.localParam.urlparam.param1=r,e.localParam.urlparam.param2=a,e.localParam.urlparam.param3=l,e.localParam.urlparam.param4=i.TABLE_DIV,BdoDataTable(i.id,e)}else p(1)}var p=function(e){$.ajax({url:"dgCenter/HbMergeReport.auditReport.json",type:"post",data:{start:-1,menuId:window.sys_menuId,param4:"2",param5:e},dataType:"json",success:function(t){if(t.success){let r=t.resultInfo.statusText,s=t.data[0];r&&bdoInfoBox("提示",r),l=s.projectYear,a=s.projectId;let o=$.extend(!0,{},d);o.tableParam={select:!0,lengthChange:!0,dom:'<"row"<"col-sm-12"tr>>',serverSide:!0,ordering:!1,columnDefs:[{targets:(()=>(n=0,++n))(),orderable:!1,className:"text-center width-seq",title:"序号",visible:!0,render:function(e,t,a,r){return r.settings._iDisplayStart+r.row+1}},{targets:++n,orderable:!0,className:"text-left width-subject-id",title:"科目编号",name:"colCode",data:"colCode",render:function(e,t,a,r){return e}},{targets:++n,orderable:!0,title:"科目名称",name:"colDisp",data:"colDisp",className:"dg-ap width-subject-name",render:function(e,t,a,r){return e.indexOf("合计")>0||e.indexOf("总计")>0?"<b>"+e+"</b>":e.replace(/ /g,"&nbsp;")}},{targets:++n,orderable:!0,title:"未审数",name:"adjustedAmount",data:"adjustedAmount",className:"text-right width-je",render:function(e,t,a,r){return formatMoney(e)}},{targets:++n,orderable:!0,title:"审计调整数",name:"adjustAmount",data:"adjustAmount",className:"text-right width-je",render:function(e,t,a,r){return formatMoney(e)}},{targets:++n,orderable:!0,title:"审定数",name:"auditedAmount",data:"auditedAmount",className:"text-right width-je",render:function(e,t,a,r){return formatMoney(e)}},{targets:++n,orderable:!0,title:"年初数",name:"auditedRemain",data:"auditedRemain",className:"text-right width-je",render:function(e,t,a,r){return formatMoney(e)}}]};let i=$.extend(!0,{},d);i.tableParam={select:!0,lengthChange:!0,dom:'<"row"<"col-sm-12"tr>>',serverSide:!0,ordering:!1,createdRow(e,t,a){t.flag&&($(e).addClass("edit-able"),$(e).find("td:eq(3)").addClass("bg-success-light"))},columnDefs:[{targets:(()=>(n=0,++n))(),orderable:!1,className:"text-center width-seq",title:"序号",visible:!0,render:function(e,t,a,r){return r.settings._iDisplayStart+r.row+1}},{targets:++n,orderable:!0,className:"text-left width-subject-id",title:"科目编号",name:"colCode",data:"colCode",render:function(e,t,a,r){return e}},{targets:++n,orderable:!0,title:"科目名称",name:"colDisp",data:"colDisp",className:"dg-ap width-subject-name",render:function(e,t,a,r){return e.indexOf("合计")>0||e.indexOf("总计")>0?"<b>"+e+"</b>":e.replace(/ /g,"&nbsp;")}},{targets:++n,orderable:!0,title:"未审数",name:"adjustedAmount",data:"adjustedAmount",className:"text-right width-je",render:function(e,t,a,r){return formatMoney(e)}},{targets:++n,orderable:!0,title:"审计调整数",name:"adjustAmount",data:"adjustAmount",className:"text-right width-je",render:function(e,t,a,r){return formatMoney(e)}},{targets:++n,orderable:!0,title:"审定数",name:"auditedAmount",data:"auditedAmount",className:"text-right width-je",render:function(e,t,a,r){return formatMoney(e)}},{targets:++n,orderable:!0,title:"上年数",name:"auditedRemain",data:"auditedRemain",className:"text-right width-je",render:function(e,t,a,r){return formatMoney(e)}}]};let m=$.extend(!0,{},u),p=$.extend(!0,{},u),b=$.extend(!0,{},u);o.localParam.data=s.zc,i.localParam.data=s.lr,m.localParam.data=s.xj,p.localParam.data=s.qy,b.localParam.data=s.lqy,BdoDataTable("zc_report"+e+"_table",o),BdoDataTable("lr_report"+e+"_table",i),BdoDataTable("xj_report"+e+"_table",m),BdoDataTable("qy_report"+e+"_table",p),BdoDataTable("lqy_report"+e+"_table",b);let g=$.extend(!0,{},c);return g.localParam.data=s.checkList,g.tableParam.columnDefs=function(e){return[{targets:1,orderable:!1,className:"text-left font-s12 width-jyx",title:"校验项",name:"colDisp",data:"colDisp"},{targets:2,orderable:!1,className:"text-right width-je",title:e+"年<br>未审数",name:"unAuditAmount"+e,data:"unAuditAmount"+e,render:function(e,t,a,r){return 0==e?'<div width="100%" style="text-align: center">平<div>':null!=e?formatMoney(e):void 0}},{targets:3,orderable:!1,className:"text-right width-je",title:e+"年<br>审计调整数",name:"adjustAmount"+e,data:"adjustAmount"+e,render:function(e,t,a,r){return 0==e?'<div width="100%" style="text-align: center">平<div>':null!=e?formatMoney(e):void 0}},{targets:4,orderable:!1,className:"text-right width-je",title:e+"年<br>审定数",name:"auditAmount"+e,data:"auditAmount"+e,render:function(e,t,a,r){return 0==e?'<div width="100%" style="text-align: center">平<div>':null!=e?formatMoney(e):void 0}},{targets:5,orderable:!1,className:"text-right width-je",title:e-1+"年<br>未审数",name:"unAuditAmount"+(e-1),data:"unAuditAmount"+(e-1),render:function(e,t,a,r){return 0==e?'<div width="100%" style="text-align: center">平<div>':null!=e?formatMoney(e):void 0}},{targets:6,orderable:!1,className:"text-right width-je",title:e-1+"年<br>审计调整数",name:"adjustAmount"+(e-1),data:"adjustAmount"+(e-1),render:function(e,t,a,r){return 0==e?'<div width="100%" style="text-align: center">平<div>':null!=e?formatMoney(e):void 0}},{targets:7,orderable:!1,className:"text-right width-je",title:e-1+"年<br>审定数",name:"auditAmount"+(e-1),data:"auditAmount"+(e-1),render:function(e,t,a,r){return 0==e?'<div width="100%" style="text-align: center">平<div>':null!=e?formatMoney(e):void 0}}]}(l),void BdoDataTable("rpt_tbcheck",g)}bdoErrorBox("失败",t.resultInfo.statusText)}})};!function(){let e=$(".js-tree-collapsed").treeview(!0).getSelected()[0];$("#auditedStateIndex").text("【"+e.extraOptions.indexId+"】"),p("1"),OneUI.initHelper("slimscroll")}(),s=(()=>{$("#rpt_search").click(e=>{e.preventDefault(),$("#rpt_search").blur(),m()}),$('#subPageRight [data-toggle="tabs"]').on("click","a",function(e){e.preventDefault(),"tab_unAuditReport"==$(this).closest("ul").attr("id")&&$(this).parent().index()>1?$("#tab_head_rpt").hide():$("#tab_head_rpt").show(),$(this).tab("show")}),$('#subPageRight [data-toggle="tabs"]').on("shown.bs.tab",function(e){var t=$("#tab_unAuditReport").find("li[class=active] a");i.showType=t.attr("data-content");var a=t.attr("data-result"),r=$("#"+a).find("li[class=active] a");switch(i.id=r.attr("data-result"),i.TABLE_DIV=r.attr("data-content"),i.TABLE_DIV){case"10":i.TABLE_DIV="4";break;case"11":i.TABLE_DIV="5";break;case"12":i.TABLE_DIV="6"}m()})}),(()=>{$("#rpt_check_Report").parent().hide(),$("#audit_report_export").parent().hide(),$("#xj_report1 > button").hide(),$("#qy_report1 > button").hide(),$("#lqy_report1 > button").hide(),$("#report1_type > li:nth-child(1) > a > i").text(" 资 "),$("#report1_type > li:nth-child(2) > a > i").text(" 利 "),$("#report1_type > li:nth-child(3) > a > i").text(" 现 "),$("#report1_type > li:nth-child(4) > a > i").text(" 所(本年) "),$("#report1_type > li:nth-child(5) > a > i").text(" 所(上年) "),$("#audited_title_name").text("审定报表"),$("#tab1 > a").text("审定报表"),$("#headtitle").text(" 审定报表 "),$("#rpt_createReport").hide(),s()})()},$(document).ready(function(){var e="tb_tab",t="tb_tbcheck",a=window.CUR_PROJECT_ACC_YEAR;uiBlocksApi(!1,"init"),$("#tb_customerId").val(window.CUR_CUSTOMERID+"-"+window.CUR_CUSTOMERNAME),$("#tb_showZero").val(1);var r={localParam:{tabNum:!1,data:[],urlparam:{menuId:window.sys_menuId}},tableParam:{scrollY:!1,select:!0,lengthChange:!0,dom:'<"row"<"col-sm-12"tr>>',serverSide:!0,rowReorder:{update:!1},columnDefs:[]}},l={localParam:{tabNum:!1,data:[],url:"dgCenter/FTBSubjectContract.tbList.json",urlparam:{menuId:window.sys_menuId}},tableParam:{scrollY:!1,select:!0,lengthChange:!0,dom:'<"row"<"col-sm-12"tr>>',serverSide:!0,rowReorder:{update:!1},columnDefs:[]}};function s(){$.ajax({type:"post",url:"dgCenter/FTBSubjectContract.tbListAndCheck.json",data:{menuId:window.sys_menuId,param1:window.CUR_CUSTOMERID,param2:a,param3:a,refreshFlg:"1",param4:$("#showContract").val()},dataType:"json",success:function(s){if($("#"+t).hasClass("dataTable")&&($("#"+t).DataTable().clear(),$("#"+t).DataTable().destroy(),$("#"+t).empty()),$("#"+e).hasClass("dataTable")&&($("#"+e).DataTable().clear(),$("#"+e).DataTable().destroy(),$("#"+e).empty()),"0"!=s.resultInfo.status)return s.data&&s.data.length>0?void bdoConfirmBox("提示",s.resultInfo.statusText,function(){$('a[href="#tab_tbContract"]').click()}):void bdoInfoBox("提示",s.resultInfo.statusText);s=s.data[0];l.localParam.data=s.tbList,l.tableParam=function(e,t){for(var a={scrollY:450,scrollCollapse:!0,fixedColumns:!0,select:!0,lengthChange:!0,dom:'<"row"<"col-sm-12"tr>>',serverSide:!0,ordering:!1,columnDefs:[{targets:1,orderable:!1,className:"text-center width-seq",title:"序号",visible:!0,render:function(e,t,a,r){return r.settings._iDisplayStart+r.row+1}},{targets:1,orderable:!1,className:"hidden",title:"处理",data:null},{targets:2,orderable:!1,className:"text-left width-subject-id",title:"TB科目编号",name:"colCode",data:"colCode"},{targets:3,className:"text-left width-subject-name",orderable:!1,title:"科目名称",name:"colDisp",data:"colDisp",render:function(e,t,a,r){return e.indexOf("合计")>0||e.indexOf("总计")>0?"<b>"+e+"</b>":"&nbsp;&nbsp;&nbsp;&nbsp;"+e}}]},r=3,l=e;l<=t;l++){a.columnDefs.push({targets:r+1,className:"text-right width-je",orderable:!1,title:l+"年<br>未审数",name:"unAuditAmount"+l,data:"unAuditAmount"+l,render:function(e,t,a,r){let l;var s='<label style="font-size: 10px;position: relative;top:5px;">'+(l=null!=e&&void 0!=e&&""!=e&&"Null"!=e?formatMoney(e):0==e&&"0"==e?0:"--")+"</label>";return s}}),a.columnDefs.push({targets:r+2,orderable:!1,className:"text-right width-je",title:l+"年<br>审计调整数",name:"adjustAmount"+l,data:"adjustAmount"+l,render:function(e,t,a,r){let l;l=null!=e&&void 0!=e&&""!=e&&"Null"!=e?formatMoney(e):0==e&&"0"==e?0:"--";var s=formatMoney(l);if("1"==a.colType&&"0"!=l&&"--"!=l)return s='<label style="font-size: 10px;position: relative;top:5px;"><span style="background-color: #53f9f9;width: 100%;position: relative;top: 0px;display: block;">'+s+"</span></label>";var o='<label style="font-size: 10px;position: relative;top:5px;">'+l+"</label>";return o}}),a.columnDefs.push({targets:r+3,orderable:!1,className:"text-right width-je",title:l+"年<br>审定数",name:"auditAmount"+l,data:"auditAmount"+l,render:function(e,t,a,r){let l;var s='<label style="font-size: 10px;position: relative;top:5px;">'+(l=null!=e&&void 0!=e&&""!=e&&"Null"!=e?formatMoney(e):0==e&&"0"==e?0:"--")+"</label>";return s}}),l<t&&a.columnDefs.push({targets:r+4,orderable:!1,className:"text-right",title:"",width:"20px"}),r+=4}for(var s=e-1,l=s;l<=s;l++)a.columnDefs.push({targets:r,orderable:!1,className:"text-right width-je",title:l+"年<br>未审数",name:"unAuditAmount"+l,data:"unAuditAmount"+l,render:function(e,t,a,r){var l='<label style="font-size: 10px;position: relative;top:5px;">'+(null!=e&&void 0!=e&&""!=e&&"Null"!=e?formatMoney(e):0==e&&"0"==e?0:"--")+"</label>";return l}}),a.columnDefs.push({targets:r+1,orderable:!1,className:"text-right width-je",title:l+"年<br>审计调整数",name:"adjustAmount"+l,data:"adjustAmount"+l,render:function(e,t,a,r){let l;l=null!=e&&void 0!=e&&""!=e&&"Null"!=e?formatMoney(e):0==e&&"0"==e?0:"--";formatMoney(l);var s='<label style="font-size: 10px;position: relative;top:5px;">'+l+"</label>";return s}}),a.columnDefs.push({targets:r+2,orderable:!1,className:"text-right width-je",title:l+"年<br>审定数",name:"auditAmount"+l,data:"auditAmount"+l,render:function(e,t,a,r){let l;var s='<label style="font-size: 10px;position: relative;top:5px;">'+(l=null!=e&&void 0!=e&&""!=e&&"Null"!=e?formatMoney(e):0==e&&"0"==e?0:"--")+"</label>";return s}}),l<s&&a.columnDefs.push({targets:r+3,orderable:!1,className:"text-right",title:"",width:"20px"}),r+=4;return a}(a,a),BdoDataTable(e,l),r.localParam.data=s.checkResult,r.tableParam=function(e,t){for(var a={scrollY:!1,select:!0,lengthChange:!1,dom:'<"row"<"col-sm-12"tr>>',serverSide:!1,columnDefs:[{targets:1,className:"text-left",title:"校验项",orderable:!1,name:"colDisp",data:"colDisp",width:"350px"}]},r=1,l=e;l<=t;l++)a.columnDefs.push({targets:r+1,orderable:!1,className:"text-right",title:l+"年<br>未审数",name:"unAuditAmount"+l,data:"unAuditAmount"+l,width:"120px",render:function(e,t,a,r){return 0==e?'<div width="100%" style="text-align: center">平<div>':null!=e?formatMoney(e):void 0}}),a.columnDefs.push({targets:r+2,orderable:!1,className:"text-right",title:l+"年<br>审计调整数",name:"adjustAmount"+l,data:"adjustAmount"+l,width:"120px",render:function(e,t,a,r){return 0==e?'<div width="100%" style="text-align: center">平<div>':null!=e?formatMoney(e):void 0}}),a.columnDefs.push({targets:r+3,orderable:!1,className:"text-right",title:l+"年<br>审定数",name:"auditAmount"+l,data:"auditAmount"+l,width:"120px",render:function(e,t,a,r){return 0==e?'<div width="100%" style="text-align: center">平<div>':null!=e?formatMoney(e):void 0}}),l<t&&a.columnDefs.push({targets:r+4,orderable:!1,className:"text-right",title:"",width:"10px"}),r+=4;for(var s=e-1,l=s;l<=s;l++)a.columnDefs.push({targets:r,orderable:!1,className:"text-right",title:l+"年<br>未审数",name:"unAuditAmount"+l,data:"unAuditAmount"+l,width:"120px",render:function(e,t,a,r){return 0==e?'<div width="100%" style="text-align: center">平<div>':null!=e?formatMoney(e):void 0}}),a.columnDefs.push({targets:r+1,orderable:!1,className:"text-right",title:l+"年<br>审计调整数",name:"adjustAmount"+l,data:"adjustAmount"+l,width:"120px",render:function(e,t,a,r){return 0==e?'<div width="100%" style="text-align: center">平<div>':null!=e?formatMoney(e):void 0}}),a.columnDefs.push({targets:r+2,orderable:!1,className:"text-right",title:l+"年<br>审定数",name:"auditAmount"+l,data:"auditAmount"+l,width:"120px",render:function(e,t,a,r){return 0==e?'<div width="100%" style="text-align: center">平<div>':null!=e?formatMoney(e):void 0}}),r+=4;return a}(a,a),BdoDataTable(t,r)}})}$("#tb_search").click(function(){$("#tb_search").blur(),s()}),$("#showContract").on("change",function(){s()}),$("#"+e).on("dblclick","td",function(){var t=$("#"+e).DataTable().context[0].aoColumns[$(this).index()+1],a=$("#"+e).DataTable().row($(this).parents("tr")).data(),r="2";if(t.name&&2!=a.colType){if(t.name.indexOf("adjustAmount")>=0)r="2";else{if(!(t.name.indexOf("adjustCAmount")>=0))return t.name.indexOf("colCode")>=0||t.name.indexOf("colDisp")>=0?void(a.colCode&&window.open("/Faith/bdologin.do?m=gotoDesktop&menuId=40000022&tbSubjectId="+a.colCode)):void 0;r="1"}var l=t.name.substring(t.name.length-4,t.name.length),s=a.subjectType2;a.subjectType2==a.subjectType1+"99"&&(s=a.subjectType1),adjustDetailTab("tab_contract",window.CUR_CUSTOMERID,l,r,a.colCode,s,"FA10064")}}),$("#"+e).on("click","td button",function(){var t=$("#"+e).dataTable().fnGetData($(this).attr("data-row")),a=t.colCode,r=t.colDisp,l=this.parentElement.lastElementChild.textContent.replace(/,/g,""),s=$(this).parents("td").index(),o=this.parentElement.parentElement.parentElement.parentElement.firstElementChild.firstElementChild.children[s].textContent;switch($("#aliasPosition").val(a+"-"+r+":"+o.replace(/[\+\-\=]/g,"")),$("#aliasValue").val(l),$("#subjectId").val(a),$("#subjectName").val(r),$("#tagYyyy").val(o.substring(0,4)),s.toString()){case"4":$("#tagType").val("unAuditAmount");break;case"5":$("#tagType").val("adjustAmount");break;case"6":$("#tagType").val("auditAmount");break;case"7":$("#tagType").val("unAuditAmount");break;case"8":$("#tagType").val("adjustAmount");break;case"9":$("#tagType").val("auditAmount")}$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",data:{menuId:window.sys_menuId,sqlId:"DG00082",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:$("#aliasPosition").val(),start:-1,limit:-1},dataType:"json",success(e){e.success&&0!==e.data.length?$("#customAlias").val(e.data[0].tagName):$("#customAlias").val($("#aliasPosition").val().substring(0,4)+$("#aliasPosition").val().substring($("#aliasPosition").val().indexOf(":")+1)),$("#tagSetModal").modal("show")}})}),$("#setTagBtn").click(e=>{if(""==$("#customAlias").val())return $("#customAlias").focus(),void bdoInfoBox("提示","请输入标签名");if(-1!=$("#customAlias").val().indexOf("+")||-1!=$("#customAlias").val().indexOf("-")||-1!=$("#customAlias").val().indexOf("="))return $("#customAlias").focus(),void bdoInfoBox("提示","标签名不能含有+、-、=");let t=[];t.push({type:"db",dbName:"bdo_dg.dg_tbtable",selectParam:"unAuditAmount, adjustAmount, auditAmount",whereParam:" customerId = "+window.CUR_CUSTOMERID+" AND projectId = "+window.CUR_PROJECTID+" AND yyyy = "+$("#tagYyyy").val()+" AND tbSubjectId = '"+$("#subjectId").val()+"' AND ACTIVE_FLAG = '1'",field:$("#tagType").val(),subjectId:$("#subjectId").val(),subjectName:$("#subjectId").val()+"-"+$("#subjectName").val()}),$.ajax({type:"post",url:"dgCenter/DgCheck.setTag.json",data:{menuId:window.sys_menuId,param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:$("#customAlias").val(),param4:$("#aliasValue").val(),param5:$("#aliasPosition").val(),param6:JSON.stringify(t),param8:"db",start:-1,limit:-1},dataType:"json",success(e){e.success?(bdoSuccessBox("成功",e.resultInfo.statusText),$("#tagSetModal").modal("hide")):($("#customAlias").focus(),bdoErrorBox("失败",e.resultInfo.statusText))}})}),$("#tb_createReport").click(function(){$("#tb_createReport").blur(),bdoConfirmBox("系统提示","确定要重新生成【"+window.CUR_CUSTOMERNAME+"】<br>试算平衡表吗？<font color=red>重新生成后原来的试算平衡表将被删除！</font>",function(){bdoInProcessingBox("生成中"),$.ajax({type:"post",url:"dgCenter/FTBSubjectContract.createTB.json",data:{param1:window.CUR_CUSTOMERID},dataType:"json",success:function(e){e.success?(bdoSuccessBox("操作成功",e.resultInfo.statusText),$("#tb_search").click()):e.resultInfo.statusText.search("TB科目对照")>0?bdoConfirmBox("操作失败",e.resultInfo.statusText,function(){$('a[href="#tab_tbContract"]').click()}):bdoErrorBox("操作失败",e.resultInfo.statusText)}})})}),$("#tb_adjust").click(function(){$.ajax({type:"post",url:"dgCenter/FTBSubjectContract.checkExist.json",data:{param1:window.CUR_CUSTOMERID},dataType:"json",success:function(e){1==e.data[0].chekFlag?journalAdjust(CUR_CUSTOMERID,$("#tb_endYear").val(),"","","2",function(){s()}):bdoErrorBox("系统提示",year+"年试算平衡表不存在，不能调整！")}})}),$("#tb_clear").click(function(){$("#tb_showZero").val(1)}),$("#tb_export").click(function(){let e=$.extend({},!0,l);var t={menuId:window.sys_menuId,param1:window.CUR_CUSTOMERID,param4:$("#tb_showZero").val()};e.localParam.url="dgCenter/FTBSubjectContract.exportTbTable.json",e.localParam.urlparam=t;let r=$.extend({},!0,l);r.localParam.url="dgCenter/FTBSubjectContract.tbListAndCheck.json",r.localParam.urlparam={menuId:window.sys_menuId,param1:window.CUR_CUSTOMERID,refreshFlg:"1",param2:a,param3:a,param4:$("#showContract").val()},function(e,t){var a=getColumnsInfo(t.tableParam.columnDefs),r=applyIf({},t.localParam.urlparam);delete r.sort,r.page="",r.start="",r.limit="",r.queryUrl=t.localParam.url,r.columnMap=a,r=JSON.stringify(r),e=encodeURI(e);var l={menuId:window.sys_menuId,param1:r};$.ajax({url:"dgCenter/ExportOtherDg.exportTbTbl.json",data:l,type:"post",dataType:"json",success:function(e){if(e.success){if(e.data&&e.data.length>0){let t=e.data[0].fileData,a=e.data[0].fileName;e.data[0].isNew,bdoInfoBox("成功",a+"导出成功！"),saveAs(dataURLtoFile(t,a),a),getSubjecttree({param1:window.CUR_PROJECTID,param2:$("#onlyMyselfCheckBox").get(0).checked?"1":""},e=>{$(".js-tree-collapsed").trigger("rebuild",[{data:[e.data[0].treeData],levels:3,callback(e){$.each(e.findNodes(),(t,a)=>{"TRIALBALANCE"==a.extraOptions.nodeType&&(e.expandNode(a.nodeId,{levels:a.deep+2,silent:!0}),e.selectNode(a.nodeId,{silent:!0}))})}}])})}}else bdoErrorBox("失败",e.resultInfo&&e.resultInfo.statusText)}})}("试算平衡表",r)}),$("#tb_export_APT").click(function(){let t=$("#"+e).dataTable().fnGetBdoConfig(),r=BdoFaithUtil.getColumnsInfo(t.tableParam.columnDefs),l=$.extend({},t.localParam.urlparam);return l.sort&&delete l.sort,l.page="",l.start="",l.limit="",l.queryUrl="dgCenter/FTBSubjectContract.tbListAndCheck.json",l.urlparam={menuId:window.sys_menuId,param1:window.CUR_CUSTOMERID,param2:a,refreshFlg:"1",param3:a,param4:$("#showContract").val()},l.columnMap=r,BdoFaithUtil.saveAs("dgCenter/FTBSubjectContract.exportAPTTbTbl.json",".xlsx",{requestData:{myParams:JSON2.stringify(l),title:encodeURI("试算平衡表_APT")},method:"POST"})}),$("#tb_tab").on("click",'button.table-btn-operate[name="createDgSub"]',e=>{var t=$("#tb_tab").dataTable().fnGetData($(e.currentTarget).attr("data-row"));$.ajax({type:"post",url:"dgCenter/dgMain.createDgTree.json",data:{param1:"002",param2:window.CUR_PROJECTID,param3:window.CUR_CUSTOMERID,param4:t.colDisp,param5:t.colCode,param6:t.colCode,refreshFlg:1},dataType:"json",success:function(e){e.success?bdoSuccessBox("操作成功",e.resultInfo.statusText):bdoErrorBox("操作失败",e.resultInfo.statusText)}})}),$("#tb_search").click(),$('#tab_contract a[href="#tab_adjustdetail"]').find(".fa-times-circle").click(function(){return $('#tab_contract li a[href="#tab_adjustdetail"]').css("display","none"),$(this).parents("ul").find("li").first().find("a").click(),!1})}),window.trialbalanceMenuId=40000037,window.unauditedMenuId=40000040,window.identifiedMenuId=40000057,window.adjustsumberyMenuId=40000027,window.auditedMenuId=40000059,window.fuzhuMenuId=40000068,window.cashflowMenuId=40000092,window.reportMenuId=40000029,window.samplingMenuId=40000084,window.confirmStatusData=ComboLocalDicOption(!1,"审计程序认定"),window.booleanDicData=ComboLabelValueDicData(!1,"boolean"),window.industryData=getIndustryData(),$(document).ready(function(){function e(){pageRightTitle(pageTitleArr),uiBlocksApi(!1,"init");let e=$("body"),t=$("#main-container"),a=$("#spreadContentDir"),r=$(".js-tree-collapsed"),l=$("#subPageRight"),s=$("#toggleDir  .toggle-dir-icon"),o=$(".spread-content"),n=$("#fullscreenBtn"),i=$("#postil_btn"),d=$("#openFormulaModalBtn"),c=$("#formulaCheckModal"),u=$("#report_approval_btn"),m=$("#report_independence_btn"),p=$('#spreadContentDir [data-toggle="slimscroll"]'),b=$("#merge_report_btn"),g=!0;o.css("overflow-y","hidden");let f,h=t.height()-$("#pageHead").height()-60;a.bind("rebuildTree",(e,t,a)=>{getSubjecttree(t,a)}),a.height(h+57+"px"),l.height(h+17+"px");let x=a.height();function w(){let e=this;return this.proxis=function(t,a){e["SUBTREE_"+a.type]&&e["SUBTREE_"+a.type](a)},e}a.find(".dircontext").height(x-40);let I=new w;function y(e){$.sessionStorage("subjecttreeNode",JSON.stringify(e)),window.open("/Faith/dgcenter.do?m=openGuidepaper&index="+e.extraOptions.indexId+"&projectId="+e.extraOptions.projectId)}r.bind("rebuild",(e,t)=>{r.treeview({data:t.data,color:"#555",expandIcon:"fa fa-plus",collapseIcon:"fa fa-minus",onhoverColor:"#f9f9f9",selectedColor:"#000",selectedBackColor:"#f1f1f1",showTags:!0,levels:t.levels}),r.on("nodeSelected",(e,t)=>{let a=p[0].scrollTop;$("#dgPostilPage").hide(),window.xxrPageKey=t.text,I.proxis.bind(this)(e,t),f=t,function(){switch(f.type){case"TBSUBJECT":case"SUBJECT":$("#delSubjectTreeBtn").show();break;default:$("#delSubjectTreeBtn").hide()}}(),setTimeout(()=>{p[0].scrollTop=a})}),r.on("nodeUnselected nodeCollapsed nodeExpanded",(e,t)=>{let a=p[0].scrollTop;setTimeout(()=>{p[0].scrollTop=a})}),t.callback&&t.callback(r.treeview(!0))}),$.extend(w.prototype,{SUBTREE_RCL:function(e){RcsPage({region:"#subPageRight",data:{customerId:window.CUR_CUSTOMERID,projectId:window.CUR_PROJECTID}})},SUBTREE_FILE:function(e){$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",data:{menuId:window.sys_menuId,sqlId:"DG00078",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:e.extraOptions.workpaperId,start:-1,limit:-1},dataType:"json",success(e){if(e.success){var t={extraOptions:e.data[0],currentNode:{extraOptions:e.data[0]}};t.autoId=t.extraOptions.autoId,t.workpaperId=t.extraOptions.workpaperId,t.menuId=window.sys_menuId,$.sessionStorage("subjecttreeNode",JSON.stringify(t)),window.open("/Faith/dgcenter.do?m=openWorkpaper&index="+t.extraOptions.indexId+"&projectId="+t.extraOptions.projectId)}}})},SUBTREE_PROJECT:function(e){$("#headtitle").empty().text(e.text),SubjectPage({region:"#subPageRight",data:e}),"1"===$.sessionStorage("mergeType")&&($('#subPageRight > div > div.block-heade > ul > li> a[href="#guidePageTab"]').parent().remove(),$('#subPageRight > div > div.block-heade > ul > li> a[href="#samplingCountPageTab"]').parent().remove(),$('#subPageRight > div > div.block-heade > ul > li> a[href="#adjustPageTab"]').parent().remove())},SUBTREE_TBSUBJECT:function(e){SubjectPage({region:"#subPageRight",data:e})},SUBTREE_SUBJECT:function(e){SubjectPage({region:"#subPageRight",data:e})},SUBTREE_SCOPEDEF:function(e){$("#headtitle").empty().text(e.text),AttachListPage({region:"#subPageRight",data:e})},SUBTREE_AUDITEVIDENCE:function(e){$("#headtitle").empty().text(e.text),AttachListPage({region:"#subPageRight",data:e})},SUBTREE_OPINIONS:function(e){$("#headtitle").empty().text(e.text),AttachListPage({region:"#subPageRight",data:e})},SUBTREE_IRA:function(e){$("#headtitle").empty().text(e.text),AttachListPage({region:"#subPageRight",data:e})},SUBTREE_DESIGNAUDIT:function(e){AttachListPage({region:"#subPageRight",data:e})},SUBTREE_IMPL:function(e){MaterialitySetting({region:"#subPageRight",data:{customerId:window.CUR_CUSTOMERID,projectId:window.CUR_PROJECTID,htmlstr:e.text,autoId:e.extraOptions.autoId,nodeId:e.nodeId}})},SUBTREE_TRIALBALANCE:function(e){BdoFaithUtil.injectScripts(document,"#"+l[0].id,BdoFaithUtil.tplLoader("general.do?menuid="+trialbalanceMenuId))},SUBTREE_UNAUDITED:function(e){BdoFaithUtil.injectScripts(document,"#"+l[0].id,BdoFaithUtil.tplLoader("general.do?menuid="+unauditedMenuId)),CUR_USERID!=JSON.parse($.sessionStorage("projectManager"))&&void 0!=JSON.parse($.sessionStorage("projectManager"))&&$("#rpt_adjustReport").hide()},SUBTREE_MERGERUNAUDITED:function(e){MergeUnAuditReport({region:"#subPageRight",data:e})},SUBTREE_MERGERTRIALBALANCE:function(e){MergeTB({region:"#subPageRight",data:e})},SUBTREE_MERGEREPORT:function(e){MergeReport({region:"#subPageRight",data:e})},SUBTREE_MONOMERTRIALBALANCE:function(e){MonomerTB({region:"#subPageRight",data:e})},SUBTREE_MONOMERUNAUDITED:function(e){MonomerUnAuditReport({region:"#subPageRight",data:e})},SUBTREE_MONOMERAUDITED:function(e){MonomerReport({region:"#subPageRight",data:e})},SUBTREE_IDENTIFIED:function(e){SubjectPagePlan({region:"#subPageRight",data:e}),$("#headtitle").empty().text(e.text)},SUBTREE_ADJUSTSUMBERY:function(e){BdoFaithUtil.injectScripts(document,"#"+l[0].id,BdoFaithUtil.tplLoader("general.do?menuid="+adjustsumberyMenuId))},SUBTREE_AUDITED:function(e){BdoFaithUtil.injectScripts(document,"#"+l[0].id,BdoFaithUtil.tplLoader("general.do?menuid="+auditedMenuId)),$("#headtitle").empty().text(e.text)},SUBTREE_FUZHU:function(e){BdoFaithUtil.injectScripts(document,"#"+l[0].id,BdoFaithUtil.tplLoader("general.do?menuid="+fuzhuMenuId)),$("#headtitle").empty().text(e.text)},SUBTREE_CASHFLOW:function(e){BdoFaithUtil.injectScripts(document,"#"+l[0].id,BdoFaithUtil.tplLoader("general.do?menuid="+cashflowMenuId)),$("#headtitle").empty().text(e.text)},SUBTREE_MISSSUMMARY:function(e){var t=!0;$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",async:!1,data:{menuId:window.sys_menuId,sqlId:"DG00197",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,start:-1,limit:-1},dataType:"json",success(e){e.success&&sys_userId!=e.data[0].manager&&(t=!1)}}),t?$.ajax({type:"post",url:"dgCenter/DgWapper.createCbSummary.json",data:{param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:e.extraOptions.indexId,param4:e.extraOptions.autoId},dataType:"json",success(e){e.success?$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",data:{menuId:window.sys_menuId,sqlId:"DG00078",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:e.data[0].workpaperId,start:-1,limit:-1},dataType:"json",success(e){if(e.success){var t={extraOptions:e.data[0],currentNode:{extraOptions:e.data[0]}};t.autoId=t.extraOptions.autoId,t.workpaperId=t.extraOptions.workpaperId,t.menuId=window.sys_menuId,$.sessionStorage("subjecttreeNode",JSON.stringify(t)),window.open("/Faith/dgcenter.do?m=openCBSummary&index="+t.extraOptions.indexId+"&projectId="+t.extraOptions.projectId)}}}):bdoErrorBox("失败",e.resultInfo.statusText)}}):bdoInfoBox("提示","只有项目负责人才能生成错报汇总表！")},SUBTREE_NOTEREPORTCHECK:function(e){$.ajax({type:"post",url:"dgCenter/DgWapper.createNoteReportCheck.json",data:{param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:e.extraOptions.indexId,param4:e.extraOptions.autoId},dataType:"json",success(e){e.success?$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",data:{menuId:window.sys_menuId,sqlId:"DG00078",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:e.data[0].workpaperId,start:-1,limit:-1},dataType:"json",success(e){if(e.success){var t={extraOptions:e.data[0],currentNode:{extraOptions:e.data[0]}};t.autoId=t.extraOptions.autoId,t.workpaperId=t.extraOptions.workpaperId,t.menuId=window.sys_menuId,$.sessionStorage("subjecttreeNode",JSON.stringify(t)),window.open("/Faith/dgcenter.do?m=openNoteReportCheck&index="+t.extraOptions.indexId+"&projectId="+t.extraOptions.projectId)}}}):bdoErrorBox("失败",e.resultInfo.statusText)}})},SUBTREE_REPORT:function(e){BdoFaithUtil.injectScripts(document,"#"+l[0].id,BdoFaithUtil.tplLoader("general.do?menuid="+reportMenuId)),$("#headtitle").empty().text(e.text)},opDgFilePage:y,SUBTREE_TBSUBJECTFILE:function(e){y(e)},SUBTREE_TUNAUDITEDFILE:function(e){y(e)},SUBTREE_IDENTIFIEDFILE:function(e){y(e)},SUBTREE_FARFILE:function(e){y(e)},SUBTREE_PARFILE:function(e){y(e)},SUBTREE_AUDITEDFILE:function(e){y(e)},SUBTREE_TBGUIGE:function(e){y(e)},SUBTREE_FAR:function(e){AnalysisReview({region:"#subPageRight",data:{customerId:window.CUR_CUSTOMERID,projectId:window.CUR_PROJECTID,projectYear:window.CUR_PROJECT_ACC_YEAR,autoId:e.extraOptions.parentId,type:"IRA"},type:e.extraOptions.indexId}),$("#headtitle").empty().text(e.text)},SUBTREE_PAR:function(e){FinalAnalyticalReview({region:"#subPageRight",data:{customerId:window.CUR_CUSTOMERID,projectId:window.CUR_PROJECTID,projectYear:window.CUR_PROJECT_ACC_YEAR,autoId:e.extraOptions.parentId,type:"OPINIONS"},type:e.extraOptions.indexId}),$("#headtitle").empty().text(e.text)},SUBTREE_MERGETRIALBALANCE:function(e){MergeTrialBalance({region:"#subPageRight",data:e}),$("#headtitle").empty().text(e.text)},SUBTREE_MERGEAUDITED:function(e){MergeAudited({region:"#subPageRight",data:e}),$("#headtitle").empty().text(e.text)},SUBTREE_MERGENOTEINFO:function(e){MergeNoteInfo({region:"#subPageRight",data:e,isParentCompany:!1}),$("#headtitle").empty().text(e.text)},SUBTREE_MERGERNOTEINFO:function(e){MergeNoteInfo({region:"#subPageRight",data:e,isParentCompany:!1}),$("#headtitle").empty().text(e.text)},SUBTREE_SAMPLING:function(e){SamplingList({region:"#subPageRight",data:e}),$("#headtitle").empty().text("抽凭")},SUBTREE_CONTACTS:function(e){null!=window.sys_menuId&&""!=window.sys_menuId&&void 0!==window.sys_menuId&&localStorage.setItem("menuId",window.sys_menuId),window.open("./contacts/index.html")},SUBTREE_BANK:function(e){console.log(window.sys_menuId),null!=window.sys_menuId&&""!=window.sys_menuId&&void 0!==window.sys_menuId&&localStorage.setItem("menuId",window.sys_menuId),window.open("./bank/index.html")},SUBTREE_BBREPORT:function(e){BbReport({region:"#subPageRight",data:e}),$("#headtitle").empty().text(e.text)},SUBTREE_HBIDENTIFIED:function(e){HbSubjectPagePlan({region:"#subPageRight",data:e}),$("#headtitle").empty().text(e.text)}}),function(){let e=new RegExp("(^|&)tbSubjectId=([^&]*)(&|$)","i"),t=window.location.search.substr(1).match(e);if(null!=t){let e=unescape(t[2]),a=!0;window.getSubjecttree=function(t,l){$.ajax({url:"dgCenter/DgMain.getSubjecttree.json",type:"post",data:t,dataType:"json",bdolxLoader:!1,success(t){if(t.success&&(t.data[0].treeData.nodes=[t.data[0].treeData.nodes[3]],$.sessionStorage("subjecttree",JSON.stringify(t.data[0].treeData))),a&&e)return r.trigger("rebuild",[{data:[t.data[0].treeData],levels:3,callback(t){let a=t.getTreeData()[0].nodes[0].nodes.find(t=>e==t.extraOptions.tbSubjectCode);a&&t.selectNode(a,{silent:!1})}}]),void(a=!1);l&&l(t)}})}}}(),function(){let e=new RegExp("(^|&)type=([^&]*)(&|$)","i"),t=window.location.search.substr(1).match(e);if(null!=t){let e=unescape(t[2]),a=!0;window.getSubjecttree=function(t,l){$.ajax({url:"dgCenter/DgMain.getSubjecttree.json",type:"post",data:t,dataType:"json",bdolxLoader:!1,success(t){if(t.success&&$.sessionStorage("subjecttree",JSON.stringify(t.data[0].treeData)),a&&e)return r.trigger("rebuild",[{data:[t.data[0].treeData],levels:3,callback(t){let a=t.getAllNodes().find(t=>e==t.extraOptions.indexId);a&&t.selectNode(a,{silent:!1})}}]),void(a=!1);l&&l(t)}})}}}(),getSubjecttree({param1:window.CUR_PROJECTID,param2:$("#onlyMyselfCheckBox").get(0).checked?"1":""},e=>{r.trigger("rebuild",[{data:[e.data[0].treeData],levels:2}])}),$("#toggleDir").click(e=>{o.toggleClass("spread-content-hidedir"),s.toggleClass("si-arrow-left"),s.toggleClass("si-arrow-right")}),n.click(e=>{$.when((()=>{let e=new $.Deferred,t=n.find("i"),r=t.hasClass("si-size-actual");t.toggleClass("si-size-fullscreen"),t.toggleClass("si-size-actual"),o.toggleClass("spread-content-opt-fullscreen");let s=o.height();r?(a.height(h+57+"px"),l.height(h+17+"px")):(a.height("100%"),l.height(s-40+"px"),a.height(a.height()-3+"px"));let i=a.height();return a.find(".dircontext").height(i-40),e})()).done(()=>{l.resize(),t.resize()})});let v,_;t.off("click",".audit-program-fullscreen-btn"),t.on("click",".audit-program-fullscreen-btn",function(t){let a=$(t.currentTarget),r=a.closest("#auditProgramPageTab").closest(".block-content");$.when((()=>{let t=new $.Deferred,l=a.find("i");return l.hasClass("si-size-actual"),l.toggleClass("si-size-fullscreen"),l.toggleClass("si-size-actual"),r.toggleClass("audit-program-fullscreen"),e.toggleClass("audit-program-fullscreen-flag"),t})()).done(()=>{})}),OneUI.initHelper("slimscroll"),r[0].addEventListener("DOMSubtreeModified",function(){let e=$(this).find(".list-group-item");for(let t=1;t<e.length;t++){if(17!==e.eq(t).height())return void $(".slimScrollDiv",a).width(420);$(".slimScrollDiv",a).width("auto")}},!1),i.on("click",function(){var e=[];$.extend(e,r.treeview(!0).getSelected()[0]),void 0==e.nodeId&&$.extend(e,r.treeview(!0).getNode(0)),delete e.nodes,DgPostilPage({region:"#sideRegin",data:e,type:e.extraOptions.indexId,foreignId:e.extraOptions.autoId,isSingle:!1,customerId:e.extraOptions.customerId,projectId:e.extraOptions.projectId})}),d.on("click",function(){"1"===$.sessionStorage("mergeType")?$("#formulaCheckModalMerge").modal("show"):c.modal("show")}),v={localParam:{url:"dgCenter/DgGeneral.query.json",urlparam:{menuId:window.sys_menuId,sqlId:"DG00083",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param4:"",start:-1,limit:-1},tabNum:!0},tableParam:{pageLength:30,scrollX:!0,scrollY:"170px",select:!1,ordering:!1,order:[1,"asc"],serverSide:!0,fixedThead:!0,fixedHeight:"460px",columnDefs:[{targets:1,orderable:!0,title:"标签",name:"autoId",data:"autoId",width:"60px",render:function(e,t,a,r){return'<a href="#">p'+e+"</a>"}},{targets:2,orderable:!0,title:"标签名",name:"tagName",data:"tagName",width:"100px"},{targets:3,orderable:!0,title:"标签属性",className:"text-center",name:"tagProperty",data:"tagProperty",renderer:"getDicLabelByVal|标签属性",width:"60px",render:e=>DicVal2Nm(e,"标签属性")},{targets:4,orderable:!0,title:"标签类型",className:"text-center",name:"tagType",data:"tagType",renderer:"getDicLabelByVal|标签类型",width:"60px",render:e=>DicVal2Nm(e,"标签类型")},{targets:5,orderable:!0,title:"位置",name:"otherPosition",data:"otherPosition",width:"100px"},{targets:6,orderable:!0,title:"详细位置",name:"tagPosition",data:"tagPosition",width:"100px",render:function(e,t,a,r){let l=e;return"dg"!==a.tagType&&"note"!==a.tagType||(l='<a href="#">'+e+"</a>"),l}},{targets:7,orderable:!0,className:"text-right",title:"标签值",name:"tagValue",data:"tagValue",width:"80px",render:function(e,t,a,r){return formatMoney(e)}},{targets:8,orderable:!0,title:"操作",className:"text-center",name:"operate",data:"tagName",width:"40px",render:function(e,t,a,r){let l;return l=0==a.tagProperty?'<button class="btn btn-xs btn-default" type="button" title="删除标签" disabled><i class="fa fa-close"></i><input type="text" value="'+e+'" style="display: none;"></button>':'<button class="btn btn-xs btn-default" type="button" title="删除标签"><i class="fa fa-close"></i><input type="text" value="'+e+'" style="display: none;"></button>'}},{targets:9,name:"tagDgId",data:"tagDgId",visible:!1},{targets:10,name:"tagInfo",data:"tagInfo",visible:!1}]}},_={localParam:{url:"dgCenter/DgGeneral.query.json",urlparam:{menuId:window.sys_menuId,sqlId:"DG00114",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:"",start:-1,limit:-1},tabNum:!0},tableParam:{pageLength:30,scrollX:!0,scrollY:"240px",select:!1,ordering:!1,order:[1,"asc"],serverSide:!0,fixedThead:!0,fixedHeight:"400px",columnDefs:[{targets:1,orderable:!0,className:"text-center",title:"科目编号",name:"subjectId",data:"subjectId",width:"60px"},{targets:2,orderable:!0,className:"text-center",title:"科目名称",name:"subjectName",data:"subjectName",width:"60px",render:function(e,t,a,r){return"<label>"+e+"</label>"}},{targets:3,orderable:!0,title:"公式类型",name:"formulaType",data:"formulaType",renderer:"getDicLabelByVal|校验公式类型",width:"100px",render:e=>DicVal2Nm(e,"校验公式类型")},{targets:4,orderable:!0,className:"text-center",title:"公式属性",name:"formulaProperty",data:"formulaProperty",renderer:"getDicLabelByVal|校验公式属性",width:"60px",render:e=>DicVal2Nm(e,"校验公式属性")},{targets:5,orderable:!0,title:"公式",name:"formula",data:"formula",width:"100px",render:function(e,t,a,r){var l=e.split(/[\+\-\=]+/),s=e.split(/[^\+\-\=]+/).splice(1,e.split(/[^\+\-\=]+/).length-2),o=a.formulaText.split(/[\+\-\=]+/),n='<a name="tag" href="#" title="'+o[0]+'">'+l[0];for(let e=1;e<l.length;e++)n+="</a><label>"+s[e-1]+'</label><a name="tag" href="#" title="'+o[e]+'">'+l[e];return n+="</a>"}},{targets:6,orderable:!0,title:"公式信息",name:"formulaText",data:"formulaText",width:"100px",render:function(e,t,a,r){return renderStr="<label>"+e+"</label>",renderStr}},{targets:7,orderable:!0,title:"公式值",name:"formulaValue",data:"formulaValue",width:"100px",render:function(e,t,a,r){return renderStr="<label>"+e+"</label>",renderStr}},{targets:8,orderable:!0,className:"text-center",title:"公式校验结果",name:"formulaCalc",data:"formulaCalc",width:"80px",render:function(e,t,a,r){let l="";return 1==e?l='<span class="label label-success"><i class="fa fa-check"></i> 通过</span>':(0==e&&(l='<span class="label label-danger"><i class="fa fa-times"></i> 未通过</span>'),l)}},{targets:9,orderable:!0,title:"校验时间",name:"updateTime",data:"updateTime",width:"100px",render:e=>new Date(e).format("yyyy-MM-dd HH:mm:ss")},{targets:10,orderable:!0,title:"操作",className:"text-center",name:"operate",data:"autoId",width:"80px",render:function(e,t,a,r){let l;return 0==a.formulaProperty?(l='<button class="btn btn-xs btn-success" name="editFormula" type="button" title="修改校验公式" disabled><i class="fa fa-edit"></i></button>',l+='&nbsp;<button class="btn btn-xs btn-success" name="delFormula" type="button" title="删除校验公式" disabled><i class="fa fa-trash-o"></i></button>'):(l='<button class="btn btn-xs btn-success" name="editFormula" type="button" title="修改校验公式"><i class="fa fa-edit"></i></button>',l+='&nbsp;<button class="btn btn-xs btn-success" name="delFormula" type="button" title="删除校验公式"><i class="fa fa-trash-o"></i></button>'),l}}]}};let j={localParam:{url:"dgCenter/DgGeneral.query.json",urlparam:{menuId:window.sys_menuId,sqlId:"DG00084",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,start:-1,limit:-1},tabNum:!0},tableParam:{pageLength:30,scrollX:!0,scrollY:"320px",select:!1,ordering:!1,order:[1,"asc"],serverSide:!0,fixedThead:!0,fixedHeight:"400px",columnDefs:[{targets:1,orderable:!0,className:"text-center",title:"科目编号",name:"subjectId",data:"subjectId",width:"60px"},{targets:2,orderable:!0,className:"text-center",title:"科目名称",name:"subjectName",data:"subjectName",width:"60px",render:function(e,t,a,r){return renderStr=e?"<label>"+e+"</label>":"<label></label>",renderStr}},{targets:3,orderable:!0,className:"text-center",title:"公式类型",name:"formulaType",data:"formulaType",renderer:"getDicLabelByVal|校验公式类型",width:"100px",render:e=>DicVal2Nm(e,"校验公式类型")},{targets:4,orderable:!0,className:"text-center",title:"公式属性",name:"formulaProperty",data:"formulaProperty",renderer:"getDicLabelByVal|校验公式属性",width:"60px",render:e=>DicVal2Nm(e,"校验公式属性")},{targets:5,orderable:!0,title:"公式",name:"formula",data:"formula",width:"100px",render:function(e,t,a,r){var l=e.split(/[\+\-\=]+/),s=e.split(/[^\+\-\=]+/).splice(1,e.split(/[^\+\-\=]+/).length-2),o=a.formulaText.split(/[\+\-\=]+/),n='<a name="tag" href="#" title="'+o[0]+'">'+l[0];for(let e=1;e<l.length;e++)n+="</a><label>"+s[e-1]+'</label><a name="tag" href="#" title="'+o[e]+'">'+l[e];return n+="</a>"}},{targets:6,orderable:!0,title:"公式信息",name:"formulaText",data:"formulaText",width:"100px",render:function(e,t,a,r){return renderStr="<label>"+e+"</label>",renderStr}},{targets:7,orderable:!0,title:"公式值",name:"formulaValue",data:"formulaValue",width:"100px",render:function(e,t,a,r){return renderStr="<label>"+e+"</label>",renderStr}},{targets:8,orderable:!0,className:"text-center",title:"公式校验结果",name:"formulaCalc",data:"formulaCalc",width:"80px",render:function(e,t,a,r){if(1==e){return'<span class="label label-success"><i class="fa fa-check"></i> 通过</span>'}if(0==e){return'<span class="label label-danger"><i class="fa fa-times"></i> 未通过</span>'}}},{targets:9,orderable:!0,title:"校验时间",name:"updateTime",data:"updateTime",width:"100px",render:e=>new Date(e).format("yyyy-MM-dd HH:mm:ss")},{targets:10,orderable:!0,title:"操作",className:"text-center",name:"operate",data:"autoId",width:"40px",render:function(e,t,a,r){let l;return l=0==a.formulaProperty?'<button class="btn btn-xs btn-success" name="delFormula" type="button" title="删除校验公式" disabled><i class="fa fa-trash-o"></i></button>':'<button class="btn btn-xs btn-success" name="delFormula" type="button" title="删除校验公式"><i class="fa fa-trash-o"></i></button>'}}]}},C={localParam:{url:"dgCenter/DgGeneral.query.json",urlparam:{menuId:window.sys_menuId,sqlId:"DG00374",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:window.CUR_PROJECTID,start:-1,limit:-1},tabNum:!0},tableParam:{pageLength:30,scrollX:!0,scrollY:"320px",select:!1,ordering:!1,order:[1,"asc"],serverSide:!0,fixedThead:!0,fixedHeight:"400px",columnDefs:[{targets:1,orderable:!0,className:"text-center",title:"科目编号",name:"subjectId",data:"subjectId",width:"60px",render:function(e,t,a,r){return"MERGEAUDITREPORT"==e?"":e}},{targets:2,orderable:!0,className:"text-center",title:"科目名称",name:"subjectName",data:"subjectName",width:"60px",render:function(e,t,a,r){let l;return l=e?"<label>"+e+"</label>":"<label></label>"}},{targets:3,orderable:!0,className:"text-center",title:"公式类型",name:"formulaType",data:"formulaType",renderer:"getDicLabelByVal|校验公式类型",width:"100px",render:e=>DicVal2Nm(e,"校验公式类型")},{targets:4,orderable:!0,className:"text-center",title:"公式属性",name:"formulaProperty",data:"formulaProperty",renderer:"getDicLabelByVal|校验公式属性",width:"60px",render:e=>DicVal2Nm(e,"校验公式属性")},{targets:5,orderable:!0,title:"公式",name:"formula",data:"formula",width:"100px",render:function(e,t,a,r){var l=e.split(/[\+\-\=]+/),s=e.split(/[^\+\-\=]+/).splice(1,e.split(/[^\+\-\=]+/).length-2),o=a.formulaText.split(/[\+\-\=]+/),n='<a name="tag" href="#" title="'+o[0]+'">'+l[0];for(let e=1;e<l.length;e++)n+="</a><label>"+s[e-1]+'</label><a name="tag" href="#" title="'+o[e]+'">'+l[e];return n+="</a>"}},{targets:6,orderable:!0,title:"公式信息",name:"formulaText",data:"formulaText",width:"100px",render:function(e,t,a,r){return"<label>"+e+"</label>"}},{targets:7,orderable:!0,title:"公式值",name:"formulaValue",data:"formulaValue",width:"100px",render:function(e,t,a,r){return"<label>"+e+"</label>"}},{targets:8,orderable:!0,className:"text-center",title:"公式校验结果",name:"formulaCalc",data:"formulaCalc",width:"80px",render:function(e,t,a,r){if(1==e){return'<span class="label label-success"><i class="fa fa-check"></i> 通过</span>'}if(0==e){return'<span class="label label-danger"><i class="fa fa-times"></i> 未通过</span>'}}},{targets:9,orderable:!0,title:"校验时间",name:"updateTime",data:"updateTime",width:"100px",render:e=>new Date(e).format("yyyy-MM-dd HH:mm:ss")},{targets:10,orderable:!0,title:"操作",className:"text-center",name:"operate",data:"autoId",width:"40px",render:function(e,t,a,r){let l;return l=0==a.formulaProperty?'<button class="btn btn-xs btn-success" name="delFormula" type="button" title="删除校验公式" disabled><i class="fa fa-trash-o"></i></button>':'<button class="btn btn-xs btn-success" name="delFormula" type="button" title="删除校验公式"><i class="fa fa-trash-o"></i></button>'}}]}};c.on("show.bs.modal",function(){$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",async:!1,data:{menuId:window.sys_menuId,sqlId:"DG00228",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,start:-1,limit:-1},dataType:"json",success(e){e.success&&null!=e.data[0]&&($("#totalNumCheck").html(e.data[0].totalNum),$("#rightNumCheck").html(e.data[0].rightNum))}}),BdoDataTable("formulaCheckTable",j)}),$("#formulaCheckTable").on("click",'a[name="tag"]',function(){S($(this).text().substring(1))}),$("#formulaCheckTable").on("click",'button[name="delFormula"]',function(){var e=$("#formulaCheckTable").DataTable().data()[$(this).closest("tr").index()];bdoConfirmBox("提示","确定是否删除该校验公式？",function(){$.ajax({type:"post",url:"dgCenter/DgCheck.delFormula.json",async:!1,data:{param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:e.autoId},dataType:"json",success(e){$("#formulaCheckTable").DataTable().ajax.reload(),$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",async:!1,data:{menuId:window.sys_menuId,sqlId:"DG00228",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:$("#formulaTypeCheck").val(),start:-1,limit:-1},dataType:"json",success(e){e.success&&null!=e.data[0]&&($("#totalNumCheck").html(e.data[0].totalNum),$("#rightNumCheck").html(e.data[0].rightNum))}}),bdoSuccessBox("成功","成功删除校验公式！")}})})}),$("#formulaTypeCheck").change(e=>{$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",async:!1,data:{menuId:window.sys_menuId,sqlId:"DG00228",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:$("#formulaTypeCheck").val(),start:-1,limit:-1},dataType:"json",success(e){e.success&&null!=e.data[0]&&($("#totalNumCheck").html(e.data[0].totalNum),$("#rightNumCheck").html(e.data[0].rightNum))}}),j.localParam.urlparam.param4=$("#formulaTypeCheck").val(),$("#formulaCheckTable").DataTable().ajax.reload()}),$("#formulaCheckBtn").click(e=>{$.ajax({type:"post",url:"dgCenter/DgCheck.checkFormula.json",data:{menuId:window.sys_menuId,param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,start:-1,limit:-1},dataType:"json",success(e){e.success&&swal({title:"正在校验中...",html:"请稍后查看!",type:"info",allowOutsideClick:!1,allowEscapeKey:!1,timer:3e3}).catch(swal.noop)}})}),$("#formulaCheckModalMerge").on("show.bs.modal",function(){$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",data:{menuId:window.sys_menuId,sqlId:"DG00375",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:window.CUR_PROJECTID,start:-1,limit:-1},dataType:"json",success(e){e.success&&null!=e.data[0]&&($("#totalNumCheckMerge").html(e.data[0].totalNum),$("#rightNumCheckMerge").html(e.data[0].rightNum))}}),BdoDataTable("formulaCheckTableMerge",C)}),$("#formulaCheckTableMerge").on("click",'a[name="tag"]',function(){P($(this).text().substring(1))}),$("#formulaCheckTableMerge").on("click",'button[name="delFormula"]',function(){var e=$("#formulaCheckTableMerge").DataTable().data()[$(this).closest("tr").index()];bdoConfirmBox("提示","确定是否删除该校验公式？",function(){$.ajax({type:"post",url:"dgCenter/HbMergeFormulaCheck.delFormula.json",data:{param1:e.autoId,param2:window.CUR_CUSTOMERID,param3:window.CUR_PROJECTID,param4:window.CUR_PROJECTID,param5:$("#formulaTypeCheckMerge").val()},dataType:"json",success(e){$("#formulaCheckTableMerge").DataTable().ajax.reload(),e.success&&e.data&&null!=e.data[0]&&($("#totalNumCheckMerge").html(e.data[0].totalNum),$("#rightNumCheckMerge").html(e.data[0].rightNum)),bdoSuccessBox("成功","成功删除校验公式！")}})})}),$("#formulaTypeCheckMerge").change(e=>{$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",data:{menuId:window.sys_menuId,sqlId:"DG00375",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:window.CUR_PROJECTID,param4:$("#formulaTypeCheckMerge").val(),start:-1,limit:-1},dataType:"json",success(e){e.success&&e.data&&null!=e.data[0]&&($("#totalNumCheckMerge").html(e.data[0].totalNum),$("#rightNumCheckMerge").html(e.data[0].rightNum))}}),C.localParam.urlparam.param4=$("#formulaTypeCheckMerge").val(),$("#formulaCheckTableMerge").DataTable().ajax.reload()}),$("#formulaCheckBtnMerge").click(e=>{$.ajax({type:"post",url:"dgCenter/HbMergeFormulaCheck.checkFormula.json",data:{menuId:window.sys_menuId,param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:window.CUR_PROJECTID,start:-1,limit:-1},dataType:"json",success(e){e.success&&swal({title:"正在校验中...",html:"请稍后查看!",type:"info",allowOutsideClick:!1,allowEscapeKey:!1,timer:3e3}).catch(swal.noop)}})});let T={localParam:{url:"dgCenter/DgGeneral.query.json",urlparam:{menuId:window.sys_menuId,sqlId:"DG00368",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,start:-1,limit:-1},tabNum:!0},tableParam:{pageLength:30,scrollX:!0,scrollY:"355px",select:!1,ordering:!1,order:[1,"asc"],serverSide:!0,fixedThead:!0,fixedHeight:"400px",columnDefs:[{targets:1,orderable:!0,title:"公式",name:"formula",data:"formula",width:"100px",render:function(e,t,a,r){var l=e.split(/[\+\-\=]+/),s=e.split(/[^\+\-\=]+/).splice(1,e.split(/[^\+\-\=]+/).length-2),o=a.formulaText.split(/[\+\-\=]+/),n='<a name="tag" href="#" title="'+o[0]+'">'+l[0];for(let e=1;e<l.length;e++)n+="</a><label>"+s[e-1]+'</label><a name="tag" href="#" title="'+o[e]+'">'+l[e];return n+="</a>"}},{targets:2,orderable:!0,title:"公式信息",name:"formulaText",data:"formulaText",width:"100px",render:function(e,t,a,r){return renderStr="<label>"+e+"</label>",renderStr}},{targets:3,orderable:!0,title:"公式值",name:"formulaValue",data:"formulaValue",width:"100px",render:function(e,t,a,r){return renderStr="<label>"+e+"</label>",renderStr}},{targets:4,orderable:!0,className:"text-center",title:"公式核对结果",name:"formulaCalc",data:"formulaCalc",width:"80px",render:function(e,t,a,r){if(1==e){return'<span class="label label-success"><i class="fa fa-check"></i> 通过</span>'}if(0==e){return'<span class="label label-danger"><i class="fa fa-times"></i> 未通过</span>'}}},{targets:5,orderable:!0,title:"公式核对备注",name:"checkRemark",data:"checkRemark",width:"120px"},{targets:6,orderable:!0,title:"核对时间",name:"updateTime",data:"updateTime",width:"100px",render:e=>new Date(e).format("yyyy-MM-dd HH:mm:ss")},{targets:7,orderable:!0,title:"操作",className:"text-center",name:"operate",data:"operate",width:"40px",render:function(e,t,a,r){return'<button class="btn btn-xs btn-success" name="editRemark" type="button" title="填写备注"><i class="fa fa-edit"></i></button>'}}]}},D={localParam:{url:"dgCenter/DgGeneral.query.json",urlparam:{menuId:window.sys_menuId,sqlId:"DG00373",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:window.CUR_PROJECTID,start:-1,limit:-1},tabNum:!0},tableParam:{pageLength:30,scrollX:!0,scrollY:"355px",select:!1,ordering:!1,order:[1,"asc"],serverSide:!0,fixedThead:!0,fixedHeight:"400px",columnDefs:[{targets:1,orderable:!0,title:"公式",name:"formula",data:"formula",width:"100px",render:function(e,t,a,r){var l=e.split(/[\+\-\=]+/),s=e.split(/[^\+\-\=]+/).splice(1,e.split(/[^\+\-\=]+/).length-2),o=a.formulaText.split(/[\+\-\=]+/),n='<a name="tag" href="#" title="'+o[0]+'">'+l[0];for(let e=1;e<l.length;e++)n+="</a><label>"+s[e-1]+'</label><a name="tag" href="#" title="'+o[e]+'">'+l[e];return n+="</a>"}},{targets:2,orderable:!0,title:"公式信息",name:"formulaText",data:"formulaText",width:"100px",render:function(e,t,a,r){return renderStr="<label>"+e+"</label>",renderStr}},{targets:3,orderable:!0,title:"公式值",name:"formulaValue",data:"formulaValue",width:"100px",render:function(e,t,a,r){return renderStr="<label>"+e+"</label>",renderStr}},{targets:4,orderable:!0,className:"text-center",title:"公式核对结果",name:"formulaCalc",data:"formulaCalc",width:"80px",render:function(e,t,a,r){if(1==e){return'<span class="label label-success"><i class="fa fa-check"></i> 通过</span>'}if(0==e){return'<span class="label label-danger"><i class="fa fa-times"></i> 未通过</span>'}}},{targets:5,orderable:!0,title:"公式核对备注",name:"checkRemark",data:"checkRemark",width:"120px"},{targets:6,orderable:!0,title:"核对时间",name:"updateTime",data:"updateTime",width:"100px",render:e=>new Date(e).format("yyyy-MM-dd HH:mm:ss")},{targets:7,orderable:!0,title:"操作",className:"text-center",name:"operate",data:"operate",width:"40px",render:function(e,t,a,r){return'<button class="btn btn-xs btn-success" name="editRemark" type="button" title="填写备注"><i class="fa fa-edit"></i></button>'}}]}};function S(e){$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",data:{menuId:window.sys_menuId,sqlId:"DG00235",param1:e,param2:window.CUR_CUSTOMERID,param3:window.CUR_PROJECTID,start:-1,limit:-1},dataType:"json",success(e){if(e.success&&e.data[0]){var t=JSON.parse(e.data[0].tagInfo)[0];if("dg"==t.type)$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",data:{menuId:window.sys_menuId,sqlId:"DG00078",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:t.workpaperId,start:-1,limit:-1},dataType:"json",success(e){if(e.success){var a={extraOptions:e.data[0],currentNode:{extraOptions:e.data[0]}};a.autoId=a.extraOptions.autoId,a.workpaperId=a.extraOptions.workpaperId,a.menuId=window.sys_menuId,$.sessionStorage("subjecttreeNode",JSON.stringify(a)),$.sessionStorage("cellLinkFormulaBySheetName",JSON.stringify(t.tagPosition.substr(t.tagPosition.indexOf(":")+1))),window.open("/Faith/dgcenter.do?m=openWorkpaper&index="+a.extraOptions.indexId+"&projectId="+a.extraOptions.projectId)}}});else if("note"==t.type)$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",data:{menuId:window.sys_menuId,sqlId:"DG00092",param1:t.noteAutoId,param2:window.CUR_CUSTOMERID,param3:window.CUR_PROJECTID,start:-1,limit:-1},dataType:"json",success(e){if(e.success){var a={extraOptions:e.data[0],currentNode:{extraOptions:e.data[0]}};a.autoId=a.extraOptions.autoId,a.menuId=window.sys_menuId,$.sessionStorage("noteInfoNode",JSON.stringify(a)),$.sessionStorage("cellLinkFormulaBySheetName",JSON.stringify(t.tagPosition.substr(t.tagPosition.indexOf(":")+1))),window.open("/Faith/dgcenter.do?m=openDgNoteInfo&noteNo="+a.extraOptions.noteNo+"&projectId="+a.extraOptions.projectId)}else bdoErrorBox("失败",e.resultInfo.statusText)}});else if("db"==t.type){var a=t.whereParam.substr(t.whereParam.indexOf("yyyy")+7,4),r='该标签为试算平衡表"'+t.subjectName+'"的"'+a;"unAuditAmount"==(l=t.field)?r+="年未审数":"adjustAmount"==l?r+="年审计调整数":"auditAmount"==l&&(r+='年审定数"'),swal(r)}else if("function"==t.type){var l;a=0;a=-1!=(l=t.field).indexOf("current")?parseInt(t.yyyy):parseInt(t.yyyy)-1;r="";-1!=l.indexOf("Before")?r+='该标签为导引表"'+t.subjectName+'"的"'+a+'未审数"':-1!=l.indexOf("Adjust")?r+='该标签为导引表"'+t.subjectName+'"的"'+a+'调整数"':-1!=l.indexOf("After")&&(r+='该标签为导引表"'+t.subjectName+'"的"'+a+'审定数"'),swal(r)}else if("report"==t.type){r='该标签为报表"'+t.colName+t.colCode+'"的"'+t.reportValDesc+'"';swal(r)}else"auditReport"==t.type&&$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",data:{menuId:window.sys_menuId,sqlId:"DG00224",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:t.workpaperId,start:-1,limit:-1},dataType:"json",success(e){if(e.success){var a={extraOptions:e.data[0],currentNode:{extraOptions:e.data[0]}};a.autoId=a.extraOptions.workpaperId,a.workpaperId=a.extraOptions.workpaperId,a.menuId=window.sys_menuId,$.sessionStorage("subjecttreeNode",JSON.stringify(a)),$.sessionStorage("cellLinkFormulaBySheetName",JSON.stringify(t.tagPosition.substr(t.tagPosition.indexOf(":")+1))),window.open("/Faith/dgcenter.do?m=openQYXJFile&projectId="+a.extraOptions.projectId)}}})}}})}function P(e){$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",data:{menuId:window.sys_menuId,sqlId:"DG00376",param1:e,param2:window.CUR_CUSTOMERID,param3:window.CUR_PROJECTID,param4:window.CUR_PROJECTID,start:-1,limit:-1},dataType:"json",success(e){if(e.success&&e.data[0]){var t=JSON.parse(e.data[0].tagInfo)[0];if("mergeNote"==t.type)$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",data:{menuId:window.sys_menuId,sqlId:"DG00377",param1:t.noteAutoId,param2:window.CUR_CUSTOMERID,param3:window.CUR_PROJECTID,param4:window.CUR_PROJECTID,start:-1,limit:-1},dataType:"json",success(e){if(e.success){var t={extraOptions:e.data[0],currentNode:{extraOptions:e.data[0]}};t.autoId=t.extraOptions.autoId,t.menuId=window.sys_menuId,$.sessionStorage("mergeNoteInfoNode",JSON.stringify(t)),window.open("/Faith/dgcenter.do?m=openMergeNoteInfo&noteNo="+t.extraOptions.noteNo+"&projectId="+t.extraOptions.projectId)}else bdoErrorBox("失败",e.resultInfo.statusText)}});else if("mergeReport"==t.type){var a="",r=t.colName,l=t.reportValType;a="递延所得税资产"!=r&&"递延所得税负债"!=r||null!=l?'该标签为合并报表"'+t.colCode+"-"+t.colName+'"的"'+t.reportValDesc+'"':e.data[0].tagName,swal(a)}}}})}function R(e){let t=0,a=e.replace("p","");return $.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",async:!1,data:{menuId:window.sys_menuId,sqlId:"DG00235",param1:a,param2:window.CUR_CUSTOMERID,param3:window.CUR_PROJECTID,start:-1,limit:-1},dataType:"json",success(e){e.success&&(t=e.data[0].tagValue)}}),parseFloat(t).toFixed(2)}$("#openVerifyModalBtn").click(e=>{"1"===$.sessionStorage("mergeType")?$("#verifyModalMerge").modal("show"):$("#verifyModal").modal("show")}),$("#verifyModal").on("show.bs.modal",function(){BdoDataTable("verifyTable",T)}),$("#verifyTable").on("click",'a[name="tag"]',function(){S($(this).text().substring(1))}),$("#verifyTable").on("click",'button[name="editRemark"]',function(){var e=$("#verifyTable").DataTable().data()[$(this).closest("tr").index()],t=e.autoId;$("#formulaId").val(t);var a=e.checkRemark;$("#remark_input").val(a),$("#remarkModal").modal("show")}),$("#saveRemarkBtn").click(e=>{$.ajax({type:"post",url:"dgCenter/DgAuditFile.saveFormulaRemark.json",data:{menuId:window.sys_menuId,param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:$("#formulaId").val(),param4:$("#remark_input").val().trim(),start:-1,limit:-1},dataType:"json",success(e){e.success&&($("#remarkModal").modal("hide"),$("#verifyTable").DataTable().draw(!1),bdoSuccessBox("成功","保存备注成功！"))}})}),$("#verifyFormulaBtn").click(e=>{bdoInProcessingBox("核对中..."),$.ajax({type:"post",url:"dgCenter/DgAuditFile.checkVerifyFormula.json",data:{menuId:window.sys_menuId,param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,start:-1,limit:-1},dataType:"json",success(e){e.success&&($("#verifyTable").DataTable().draw(!1),bdoSuccessBox("成功","核对完成！"))}})}),$("#verifyModalMerge").on("show.bs.modal",function(){BdoDataTable("verifyTableMerge",D)}),$("#verifyTableMerge").on("click",'a[name="tag"]',function(){P($(this).text().substring(1))}),$("#verifyTableMerge").on("click",'button[name="editRemark"]',function(){var e=$("#verifyTableMerge").DataTable().data()[$(this).closest("tr").index()],t=e.autoId;$("#formulaIdMerge").val(t);var a=e.checkRemark;$("#remark_input_merge").val(a),$("#remarkModalMerge").modal("show")}),$("#saveRemarkBtnMerge").click(e=>{$.ajax({type:"post",url:"dgCenter/HbMergeFormulaCheck.saveFormulaRemark.json",data:{menuId:window.sys_menuId,param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:window.CUR_PROJECTID,param4:$("#formulaIdMerge").val(),param5:$("#remark_input_merge").val().trim(),start:-1,limit:-1},dataType:"json",success(e){e.success&&($("#remarkModalMerge").modal("hide"),$("#verifyTableMerge").DataTable().draw(!1),bdoSuccessBox("成功","保存备注成功！"))}})}),$("#verifyFormulaMergeBtn").click(e=>{bdoInProcessingBox("核对中..."),$.ajax({type:"post",url:"dgCenter/HbMergeFormulaCheck.checkVerifyFormula.json",data:{menuId:window.sys_menuId,param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:window.CUR_PROJECTID,start:-1,limit:-1},dataType:"json",success(e){e.success&&($("#verifyTableMerge").DataTable().draw(!1),bdoSuccessBox("成功","核对完成！"))}})}),$('#formulaMainModal [data-toggle="tabs"] a').on("show.bs.tab",function(e){let t=e.target.href,a=t.lastIndexOf("#");switch(t.substring(a+1)){case"tagMainTab":$("#tagsMainTable").DataTable().ajax.reload();break;case"formulaMainTab":var r;$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",async:!1,data:{menuId:window.sys_menuId,sqlId:"DG00113",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:"TB",param4:$("#formulaMainSubjectId").val(),start:-1,limit:-1},dataType:"json",success(e){e.success&&null!=e.data[0]&&(r=e.data[0].infoFormula)}}),""==r&&(r="0"),$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",async:!1,data:{menuId:window.sys_menuId,sqlId:"DG00229",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:r,param4:$("#formulaTypeMain").val(),start:-1,limit:-1},dataType:"json",success(e){e.success&&null!=e.data[0]&&($("#totalNumMain").html(e.data[0].totalNum),$("#rightNumMain").html(e.data[0].rightNum))}}),_.localParam.urlparam.param3=r,BdoDataTable("formulaMainTable",_)}}),$("#formulaMainModal").on("show.bs.modal",function(e){BdoDataTable("tagsMainTable",v),$("#tagMainGroup").html(""),$("#tagsMainTable tbody").on("click","td button",function(){let e=this.lastElementChild.value;$.ajax({type:"post",url:"dgCenter/DgCheck.deleteTag.json",data:{menuId:window.sys_menuId,param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:e,start:-1,limit:-1},dataType:"json",success(e){e.success&&($("#tagsMainTable").DataTable().ajax.reload(),bdoSuccessBox("成功","删除标签成功！"))}})}),$("#tagsMainTable tbody").on("click","td a",function(){let e=$(this).parents("td").index();if(6===e){let e=$(this).parents("tr").index(),t=$("#tagsMainTable").DataTable().row(e).data();if(null!=t.tagDgId){let e=JSON.parse(t.tagInfo)[0];"dg"==e.type?$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",data:{menuId:window.sys_menuId,sqlId:"DG00078",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:e.workpaperId,start:-1,limit:-1},dataType:"json",success(t){if(t.success){var a={extraOptions:t.data[0],currentNode:{extraOptions:t.data[0]}};a.autoId=a.extraOptions.autoId,a.workpaperId=a.extraOptions.workpaperId,a.menuId=window.sys_menuId,$.sessionStorage("subjecttreeNode",JSON.stringify(a)),$.sessionStorage("cellLinkFormula",""),$.sessionStorage("cellLinkFormulaBySheetName",""),$.sessionStorage("cellLinkFormulaBySheetName",JSON.stringify(e.tagPosition.substr(e.tagPosition.indexOf(":")+1))),window.open("/Faith/dgcenter.do?m=openWorkpaper&index="+a.extraOptions.indexId+"&projectId="+a.extraOptions.projectId)}}}):"note"==e.type&&$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",data:{menuId:window.sys_menuId,sqlId:"DG00092",param1:e.noteAutoId,param2:window.CUR_CUSTOMERID,param3:window.CUR_PROJECTID,start:-1,limit:-1},dataType:"json",success(t){if(t.success){var a={extraOptions:t.data[0],currentNode:{extraOptions:t.data[0]}};a.autoId=a.extraOptions.autoId,a.menuId=window.sys_menuId,$.sessionStorage("noteInfoNode",JSON.stringify(a)),$.sessionStorage("cellLinkFormula",""),$.sessionStorage("cellLinkFormulaBySheetName",""),$.sessionStorage("cellLinkFormulaBySheetName",JSON.stringify(e.tagPosition.substr(e.tagPosition.indexOf(":")+1))),window.open("/Faith/dgcenter.do?m=openDgNoteInfo&noteNo="+a.extraOptions.noteNo+"&projectId="+a.extraOptions.projectId)}else bdoErrorBox("失败",t.resultInfo.statusText)}})}}else if(1===e){let e,t=$("#tagMainGroup .col-sm-1 input").length;e=t>0?$('<div class="col-sm-1"><div class="form-material"><select class="form-control"><option value=""></option><option value="=">=</option><option value="+">+</option><option value="-">-</option></select></div></div><div class="col-sm-1"><div class="form-material input-group"><input class="form-control" type="text" readonly="readonly"></div></div>'):$('<div class="col-sm-1"><div class="form-material input-group"><input class="form-control" type="text" readonly="readonly"></div></div>'),$("#tagMainGroup").append(e),$("#tagMainGroup .col-sm-1 input")[t].value=$(this).text(),$("#tagMainGroup .col-sm-1 input")[t].title=$(this).parent().next().text()}})}),$("#formulaCheckModal").on("click",'a[class="tableRefresh"]',function(){$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",async:!1,data:{menuId:window.sys_menuId,sqlId:"DG00228",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,start:-1,limit:-1},dataType:"json",success(e){e.success&&null!=e.data[0]&&($("#totalNumCheck").html(e.data[0].totalNum),$("#rightNumCheck").html(e.data[0].rightNum))}})}),$("#formulaMainTab").on("click",'a[class="tableRefresh"]',function(){var e;$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",async:!1,data:{menuId:window.sys_menuId,sqlId:"DG00113",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:"TB",param4:$("#formulaMainSubjectId").val(),start:-1,limit:-1},dataType:"json",success(t){t.success&&null!=t.data[0]&&(e=t.data[0].infoFormula)}}),""==e&&(e="0"),$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",async:!1,data:{menuId:window.sys_menuId,sqlId:"DG00229",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:e,param4:$("#formulaTypeMain").val(),start:-1,limit:-1},dataType:"json",success(e){e.success&&null!=e.data[0]&&($("#totalNumMain").html(e.data[0].totalNum),$("#rightNumMain").html(e.data[0].rightNum))}})}),$("#uodoTagMainBtn").click(e=>{let t=$("#tagMainGroup .col-sm-1 input").length;t>0&&$("#tagMainGroup .col-sm-1")[2*t-2].remove();let a=$("#tagMainGroup .col-sm-1 select").length;a>0&&$("#tagMainGroup .col-sm-1")[2*a-1].remove()}),$("#formulaMainTable").on("click",'a[name="tag"]',function(){S($(this).text().substring(1))}),$("#formulaMainTable").on("click",'button[name="editFormula"]',function(){var e=$("#formulaMainTable").DataTable().data()[$(this).closest("tr").index()];$("#tagMainGroup").html("");for(var t,a=e.formulaText.split(/[\+\-\=]+/),r=e.formula.split(/[\+\-\=]+/),l=e.formula.split(/[^\+\-\=]+/),s=0;s<r.length;s++)t=$('<div class="col-sm-1"><div class="form-material input-group"><input class="form-control" type="text" value="'+r[s]+'" title="'+a[s]+'" readonly="readonly"></div></div>'),$("#tagMainGroup").append(t),s+1<l.length-1&&(t=$('<div class="col-sm-1"><div class="form-material"><select class="form-control"><option value=""></option><option value="=">=</option><option value="+">+</option><option value="-">-</option></select></div></div>'),$("#tagMainGroup").append(t),$("#tagMainGroup .col-sm-1 select")[s].value=l[s+1]);$("#formulaType").val(e.formulaType),$('#formulaMainModal [data-toggle="tabs"] a:first').tab("show")}),$("#formulaMainTable").on("click",'button[name="delFormula"]',function(){var e=$("#formulaMainTable").DataTable().data()[$(this).closest("tr").index()];bdoConfirmBox("提示","确定是否删除该校验公式？",function(){$.ajax({type:"post",url:"dgCenter/DgCheck.delFormula.json",async:!1,data:{param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:e.autoId},dataType:"json",success(e){var t;$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",async:!1,data:{menuId:window.sys_menuId,sqlId:"DG00113",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:"TB",param4:$("#formulaMainSubjectId").val(),start:-1,limit:-1},dataType:"json",success(e){e.success&&null!=e.data[0]&&(t=e.data[0].infoFormula)}}),""==t&&(t="0"),$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",async:!1,data:{menuId:window.sys_menuId,sqlId:"DG00229",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:t,param4:$("#formulaTypeMain").val(),start:-1,limit:-1},dataType:"json",success(e){e.success&&null!=e.data[0]&&($("#totalNumMain").html(e.data[0].totalNum),$("#rightNumMain").html(e.data[0].rightNum))}}),_.localParam.urlparam.param3=t,$("#formulaMainTable").DataTable().ajax.reload(),bdoSuccessBox("成功","成功删除校验公式！")}})})}),$("#tagTypeMain").change(e=>{v.localParam.urlparam.param4=$("#tagTypeMain").val(),$("#tagsMainTable").DataTable().ajax.reload()}),$("#formulaTypeMain").change(e=>{var t;$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",async:!1,data:{menuId:window.sys_menuId,sqlId:"DG00113",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:"TB",param4:$("#formulaMainSubjectId").val(),start:-1,limit:-1},dataType:"json",success(e){e.success&&null!=e.data[0]&&(t=e.data[0].infoFormula)}}),""==t&&(t="0"),$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",async:!1,data:{menuId:window.sys_menuId,sqlId:"DG00229",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:t,param4:$("#formulaTypeMain").val(),start:-1,limit:-1},dataType:"json",success(e){e.success&&null!=e.data[0]&&($("#totalNumMain").html(e.data[0].totalNum),$("#rightNumMain").html(e.data[0].rightNum))}}),_.localParam.urlparam.param4=$("#formulaTypeMain").val(),$("#formulaMainTable").DataTable().ajax.reload()}),$("#checkFormulaMainBtn").click(e=>{$.ajax({type:"post",url:"dgCenter/DgCheck.checkFormula.json",data:{menuId:window.sys_menuId,param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:"TB",param4:$("#formulaMainSubjectId").val(),start:-1,limit:-1},dataType:"json",success(e){e.success&&swal({title:"正在校验中...",html:"请稍后查看!",type:"info",allowOutsideClick:!1,allowEscapeKey:!1,timer:3e3}).catch(swal.noop)}})}),$("#ensureProjectTagMainBtn").click(e=>{let t=$("#tagMainGroup .col-sm-1 select"),a=$("#tagMainGroup .col-sm-1 input"),r=t.length;if(0===r)return bdoErrorBox("失败","请正确设置公式！"),void $('#formulaMainModal [data-toggle="tabs"] a:last').tab("show");let l=a.val(),s=a.attr("title"),o=R($("#tagMainGroup .col-sm-1 input")[0].value);for(let e=0;e<r;e++){let a=$("#tagMainGroup .col-sm-1 input")[e+1].value,r=t[e].value;if(""==r)return t[e].focus(),void bdoErrorBox("失败","请选择运算符号！");l=l+r+a,s=s+r+$("#tagMainGroup .col-sm-1 input")[e+1].title,o=o+r+R(a)}if(-1===l.indexOf("=")||l.indexOf("=")!==l.lastIndexOf("="))return void bdoErrorBox("失败","请正确设置公式！");let n=o.substring(0,o.indexOf("=")),i=n.split(/[\+\-]+/),d=n.split(/[^\+\-]+/),c=""==i[0]?0:i[0];c.toString();if(d.length>1){let e=1;"-"==d[0]&&(e=0);for(let t=e;t<d.length-1;t++){let a=d[t],r=i[t+1-e];"+"===a?c=parseFloat(c)+parseFloat(r):"-"===a?c=parseFloat(c)-parseFloat(r):"+-"===a?c=parseFloat(c)-parseFloat(r):"--"===a&&(c=parseFloat(c)+parseFloat(r))}}let u=o.substring(o.indexOf("=")+1),m=u.split(/[\+\-]+/),p=u.split(/[^\+\-]+/),b=""==m[0]?0:m[0];if(p.length>1){let e=1;"-"==p[0]&&(e=0);for(let t=e;t<p.length-1;t++){let a=p[t],r=m[t+1-e];"+"===a&&(b=parseFloat(b)+parseFloat(r)),"-"===a&&(b=parseFloat(b)-parseFloat(r)),"+-"===a&&(b=parseFloat(b)-parseFloat(r)),"--"===a&&(b=parseFloat(b)+parseFloat(r))}}if(parseFloat(c).toFixed(2)==parseFloat(b).toFixed(2))var g="1";else g="0";let f=l.replace(/p/g,""),h=f.replace(/=/g,",").replace(/\+/g,",").replace(/-/g,",");$.ajax({type:"post",url:"dgCenter/DgCheck.setProjectFormula.json",data:{menuId:window.sys_menuId,param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:l.replace(/\+/g,"%2B"),param4:s.replace(/\+/g,"%2B"),param5:o.replace(/\+/g,"%2B"),param6:g,param7:f.replace(/\+/g,"%2B"),param8:$("#formulaMainSubjectId").val(),param9:$("#formulaMainSubjectName").val(),param10:h,param11:$("#formulaType").val(),start:-1,limit:-1},dataType:"json",success(e){if(e.success){bdoSuccessBox("成功","设置校验数据公式成功！"),$('#formulaMainModal [data-toggle="tabs"] a:last').tab("show"),$("#tagMainGroup .col-sm-1").remove()}else bdoErrorBox("失败","设置校验数据公式失败！")}})}),$("#onlyMyselfCheckBox").change(function(){getSubjecttree({param1:window.CUR_PROJECTID,param2:$("#onlyMyselfCheckBox").get(0).checked?"1":""},e=>{r.trigger("rebuild",[{data:[e.data[0].treeData],levels:2}])})}),$("#expandSubjectTreeBtn").click(function(e){getSubjecttree({param1:window.CUR_PROJECTID,param2:$("#onlyMyselfCheckBox").get(0).checked?"1":""},e=>{r.trigger("rebuild",[{data:[e.data[0].treeData],levels:10}])})}),$("#compressSubjectTreeBtn").click(function(e){getSubjecttree({param1:window.CUR_PROJECTID,param2:$("#onlyMyselfCheckBox").get(0).checked?"1":""},e=>{r.trigger("rebuild",[{data:[e.data[0].treeData],levels:2}])})}),$("#updSubjectTreeBtn").click(function(e){var t;t=f?f.extraOptions.autoId:0,getSubjecttree({param1:window.CUR_PROJECTID,param2:$("#onlyMyselfCheckBox").get(0).checked?"1":""},e=>{$(".js-tree-collapsed").trigger("rebuild",[{data:[e.data[0].treeData],levels:2,callback(e){$.each(e.findNodes(),(a,r)=>{r.extraOptions.autoId==t&&(e.expandNode(r.nodeId,{levels:r.deep+2,silent:!0}),e.selectNode(r.nodeId,{silent:!0}))}),bdoSuccessBox("成功","更新完成。")}}])})}),$("#delSubjectTreeBtn").click(function(e){switch(f.type){case"TBSUBJECT":case"SUBJECT":f.nodes&&f.nodes.length>0&&bdoErrorBox("错误","该节点下有子节点，不能删除。"),bdoConfirmBox("提示","确定要删除节点【"+f.text+"】吗？",e=>{if(!e)return;let t=f.extraOptions.parentId;$.ajax({type:"post",url:"dgCenter/DgMain.delSubjectTree.json",data:{param1:f.extraOptions.autoId,param2:f.extraOptions.customerId,param3:f.extraOptions.projectId},dataType:"json",success(e){e&&e.success?(getSubjecttree({param1:window.CUR_PROJECTID,param2:$("#onlyMyselfCheckBox").get(0).checked?"1":""},e=>{$(".js-tree-collapsed").trigger("rebuild",[{data:[e.data[0].treeData],levels:2,callback(e){$.each(e.findNodes(),(a,r)=>{r.extraOptions.autoId==t&&(e.expandNode(r.nodeId,{levels:r.deep+2,silent:!0}),e.selectNode(r.nodeId,{silent:!0}))}),bdoInfoBox("成功","删除节点成功。")}}])}),$("#delSubjectTreeBtn").hide()):bdoErrorBox("失败",e.resultInfo.statusText)}})})}}),u.click(function(){CUR_USERID;$.ajax({url:"dgCenter/DgProject.initReportApproval.json",type:"POST",data:{param1:window.CUR_CUSTOMERID},dataType:"json",success(e){if(e.success){let t=e.data[0];$.localStorage("permissions",t),$.localStorage("projectType",e.resultInfo.statusText),t.initialized?window.open("/Faith/dgcenter.do?m=reportApproval"):bdoConfirmBox("提示","确定要以【"+e.resultInfo.statusText+"】对【对外报告审批单】进行审批么？",function(){window.open("/Faith/dgcenter.do?m=reportApproval")})}else bdoInfoBox("提示",e.resultInfo.statusText)}})}),m.click(function(){$.ajax({url:"dgCenter/DgProject.initReportIndependence.json",type:"POST",data:{param1:window.CUR_PROJECTID},dataType:"json",success(e){if(e.success){e.data[0].initialized?window.open("/Faith/dgcenter.do?m=reportIndependence"):(bdoInfoBox("正在初始化独立性声明"),window.open("/Faith/dgcenter.do?m=reportIndependence"))}else bdoInfoBox("提示",e.resultInfo.statusText)}})}),$("#searchProjectFileBtn").click(function(e){$("#searchProjectFileName").val(""),$("#searchProjectFileModal").modal("show")}),$("#searchProjectFileName").focus(function(e){g=!1}),$("#searchProjectFileName").blur(function(e){g=!0}),$("#searchProjectFileName").autocomplete({preserveInput:!0,lookup:function(e,t){$.ajax({url:"dgCenter/DgGeneral.query.json",type:"POST",data:{menuId:window.sys_menuId,sqlId:"DG00397",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:e,start:-1,limit:-1},dataType:"json",success(e){if(e.success)if(e.data&&e.data.length>0){for(var a=[],r=0;r<e.data.length;r++)a.push({value:e.data[r].fullPath,data:e.data[r]});t({suggestions:a})}else{t({suggestions:[]})}else t({suggestions:[]});g&&$("#searchProjectFileName").blur()}})},formatResult:function(e){if("0"==e.data.autoId)return'<div class="search-project-file"><div>'+e.value+"</div></div>";if("3"==e.data.fileType){if(""!=e.data.workpaperName&&null!=e.data.workpaperName){var t=e.data.workpaperName.lastIndexOf(".");return e.data.workpaperName.substring(0,t)+"/"+e.data.fileName}return e.data.fileName}return e.data.fileName},onSelect:function(e){"1"==e.data.fileType&&"0"!=e.data.autoId?k({param1:e.data.autoId,param2:e.data.customerId},t=>{var a=e.data.fileName.substring(e.data.fileName.lastIndexOf(".")+1).toLowerCase();if("pdf"===a||"jpg"===a||"png"===a||"jpeg"===a)window.open("dgCenter/DgMain.previewProjDgFile.json?param1="+e.data.autoId+"&param2="+e.data.customerId,e.data.fileName,"location=no");else if("xlsx"===a){e.data.pageType=3;var r={extraOptions:e.data,currentNode:{extraOptions:e.data}};$.sessionStorage("fileNode",JSON.stringify(r)),window.open("/Faith/dgcenter.do?m=previewFile")}else k({param1:e.data.autoId,param2:e.data.customerId},t=>{downloadFile("dgCenter/DgDownload.downloadProjDgFile.json",{param1:e.data.autoId,param2:e.data.customerId})})}):"2"==e.data.fileType&&"0"!=e.data.autoId?$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",data:{menuId:window.sys_menuId,sqlId:"DG00078",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:e.data.autoId,start:-1,limit:-1},dataType:"json",success(e){if(e.success){var t={extraOptions:e.data[0],currentNode:{extraOptions:e.data[0]}};t.autoId=e.data[0].autoId,t.workpaperId=e.data[0].workpaperId,t.menuId=window.sys_menuId,$.sessionStorage("subjecttreeNode",JSON.stringify(t)),window.open("/Faith/dgcenter.do?m=openWorkpaper&index="+e.data[0].indexId+"&projectId="+e.data[0].projectId)}}}):"3"==e.data.fileType&&"0"!=e.data.autoId?$.ajax({url:"dgCenter/DgMain.queryAttachFileExistence.json",type:"post",data:{param1:e.data.autoId,param2:e.data.customerId},dataType:"json",success:function(t){if(t.success){var a=e.data.fileName.substring(e.data.fileName.lastIndexOf(".")+1).toLowerCase();if("pdf"===a||"jpg"===a||"png"===a||"jpeg"===a)window.open("dgCenter/DgPaper.previewFile.json?param1="+e.data.autoId+"&param2=type1&param3="+e.data.fileName,e.data.fileName,"location=no");else if("xlsx"===a){e.data.pageType=1;var r={extraOptions:e.data,currentNode:{extraOptions:e.data}};$.sessionStorage("fileNode",JSON.stringify(r)),window.open("/Faith/dgcenter.do?m=previewFile")}else downloadFile("dgCenter/DgDownload.downloadAttach.json",{param1:e.data.autoId,param2:e.data.customerId})}else bdoErrorBox("失败",t.resultInfo.statusText)}}):"4"==e.data.fileType&&"0"!=e.data.autoId?$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",async:!1,data:{menuId:window.sys_menuId,sqlId:"DG00092",param1:e.data.autoId,param2:e.data.customerId,param3:e.data.projectId,start:-1,limit:-1},dataType:"json",success(e){if(e.success){var t={extraOptions:e.data[0],currentNode:{extraOptions:e.data[0]}};t.autoId=t.extraOptions.autoId,t.menuId=window.sys_menuId,$.sessionStorage("noteInfoNode",JSON.stringify(t)),window.open("/Faith/dgcenter.do?m=openDgNoteInfo&noteNo="+t.extraOptions.noteNo+"&projectId="+t.extraOptions.projectId)}else bdoErrorBox("失败",e.resultInfo.statusText)}}):"5"==e.data.fileType&&"0"!=e.data.autoId&&N({param1:e.data.autoId,param2:e.data.customerId,param3:"2"},t=>{var a=e.data.fileName.substring(e.data.fileName.lastIndexOf(".")+1).toLowerCase();if("pdf"===a||"jpg"===a||"png"===a||"jpeg"===a)null==t.data?window.open("dgCenter/DgPaper.previewFile.json?param1="+e.data.autoId+"&param2=type2&param3="+e.data.fileName,e.data.fileName,"location=no"):window.open("/Faith/dgcenter.do?m=previewAuditPolicyFileNoRight",e.data.fileName,"location=no");else if("xlsx"===a){e.data.pageType=2;var r={extraOptions:e.data,currentNode:{extraOptions:e.data}};$.sessionStorage("fileNode",JSON.stringify(r)),window.open("/Faith/dgcenter.do?m=previewFile")}else k({param1:e.data.autoId,param2:e.data.customerId,param3:"2"},t=>{downloadFile("dgCenter/DgDownload.downloadSamplingDgFile.json",{param1:e.data.autoId,param2:e.data.customerId,param3:"2"})})})}});let k=(e,t)=>{$.ajax({url:"dgCenter/DgMain.queryProjDgFileExist.json",type:"post",async:!1,data:e,dataType:"json",success(e){e.success?t(e):bdoErrorBox("失败",e.resultInfo.statusText)}})},N=(e,t)=>{$.ajax({url:"dgCenter/DgMain.querySamplingDgFileExist.json",type:"post",data:e,dataType:"json",success(e){e.success?t(e):bdoErrorBox("失败",e.resultInfo.statusText)}})};"1"===$.sessionStorage("mergeType")?b.click(e=>{null!=window.sys_menuId&&""!=window.sys_menuId&&void 0!==window.sys_menuId&&localStorage.setItem("menuId",window.sys_menuId),window.open("./merge/index.html")}):b.remove()}$.ajax({url:"dgCenter/DgCheck.checkProjectSetting.json",type:"post",async:!1,data:{param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID},dataType:"json",success(t){t.success?e():(bdoInfoBox("提示",t.resultInfo.statusText),$("#spreadContentDir").hide(),$("#contentBlock").hide())}})}),SamplingList=(e=>{var t,a;t=e.template||tplLoader("dgCenter/html/dg/samplingList.html"),e.template=t;var r,l,s,o,n,i,d,c,u="#53f9f9",m="#53f9f9",p="1",b="",g=0,f="",h="",x={};getUserCustomers("samplingList_customerId"),getUserCustomers("samplingSet_customerId"),getUserCustomers("assItemSame_customerId"),getUserCustomers("samplistResult_customerId");var w=(new Date).getFullYear(),I={localParam:{tabNum:!0,url:"cpBase/General.query.json",urlparam:{sqlId:"DG10001",menuId:window.sys_menuId,param2:$("#samplingList_name").val(),param3:x.projectId,lockCustomerId:x.customerId}},tableParam:{select:!0,scrollX:!1,scrollY:!1,lengthChange:!1,ordering:!1,serverSide:!0,bdolxLoader:!0,pageLength:30,columnDefs:[{targets:1,orderable:!1,className:"text-center",title:"处理",width:"60px",render:function(e,t,a,r){var l="";return CUR_USERID==a.__uuploadUser.userId?(l+='<button class="btn btn-xs btn-success" type="button" name="samplingSetBtn" data-placement="top" title="抽凭" data-toggle="tooltip"><i class="fa fa-pencil"></i></button>&nbsp;',l+='<button class="btn btn-xs btn-success" type="button" name="samplingResultBtn" data-placement="top" title="抽凭结果" data-toggle="tooltip"><i class="fa fa-eye"></i></button>&nbsp;',l+='<button class="btn btn-xs btn-danger" type="button" name="samplingDeleteBtn" data-placement="top" title="删除" data-toggle="tooltip"><i class="fa fa-times"></i></button>'):l+='<button class="btn btn-xs btn-success" type="button" name="samplingResultBtn" data-placement="top" title="抽凭结果" data-toggle="tooltip"><i class="fa fa-eye"></i></button>&nbsp;',l}},{targets:2,orderable:!0,className:"text-center",title:"抽凭方式",name:"sampleMethodName",data:"sampleMethodName",width:"100px"},{targets:3,orderable:!1,className:"text-center",title:"抽凭名称",name:"sampleName",data:"sampleName",width:"60px"},{targets:4,orderable:!1,className:"text-center",title:"抽凭人",name:"__uuploadUserName",data:"__uuploadUserName",width:"60px"},{targets:5,orderable:!1,className:"text-center",title:"抽凭时间",name:"sampleTime",data:"sampleTime",width:"60px",render:function(e,t,a,r){return l=new Date(e),s=l.getFullYear(),o=l.getMonth()+1,n=l.getDate(),i=l.getHours(),d=l.getMinutes(),c=l.getSeconds(),s+"-"+j(o)+"-"+j(n)+" "+j(i)+":"+j(d)+":"+j(c);var l,s,o,n,i,d,c}},{targets:6,orderable:!1,className:"text-center",title:"抽凭数量",name:"sampleCount",data:"sampleCount",width:"50px"},{targets:7,orderable:!1,className:"hidden",title:"抽凭状态",name:"sampleStatus",data:"sampleStatus",width:"100px",render:function(e,t,a,r){switch(e){case"0":return"等待抽样";case"1":return"查询范围完成";case"2":return"样本量计算完成";case"3":return"抽样完成";default:return"未知"}}}]}},y={localParam:{tabNum:!0,url:"finCenter/General.findSamplingSetData.json",urlparam:{sqlId:"FINCP100001",menuId:window.sys_menuId,param1:$("#samplingSet_startDate").val(),param2:$("#samplingSet_endDate").val(),param3:"",param4:"",param5:$("#samplingSet_typeId").val(),param6:$("#samplingSet_voucherId").val(),param7:$("#samplingSet_summery").val(),param8:$("#samplingSet_amountStart").val(),param9:$("#samplingSet_amountEnd").val(),param10:"",param11:$("#samplingSet_subjectid").val(),param12:"",param13:"",param14:b,param15:$("#samplingSet_dataResource").val(),lockCustomerId:x.customerId,lockYyyy:x.yyyy,lockProjectId:x.projectId}},tableParam:{select:!0,lengthChange:!1,ordering:!1,serverSide:!0,scrollX:!0,scrollY:!1,autoWidth:!1,pageLength:30,createdRow(e,t,r){(a!=t.oldVoucherId&&(m=m==u?"#FF8800":u,a=t.oldVoucherId),$(e).children("td").eq(1).css({"background-color":m}),$(e).children("td").eq(2).css({"background-color":m}),$(e).children("td").eq(3).css({"background-color":m}),""!=l)&&(-1!=(l.voucherId+"").split(",").indexOf(t.voucherId+"")&&$(e).css({color:"red"}))},columnDefs:[{targets:1,className:"text-left",title:"凭证日期",name:"vchDate",data:"vchDate",width:"80px",filter:{type:"date"}},{targets:2,className:"text-left",title:"字",name:"typeId",data:"typeId",width:"30px"},{targets:3,className:"text-left",title:"号",name:"oldVoucherId",data:"oldVoucherId",width:"10px"},{targets:4,className:"text-left",title:"摘要",name:"summary",data:"summary",width:"200px"},{targets:5,className:"text-left",title:"科目编号",name:"subjectId",data:"subjectId",width:"60px"},{targets:6,className:"text-left",title:"科目全路径",name:"subjectFullName",data:"subjectFullName",width:"200px"},{targets:7,className:"text-right",title:"借方发生金额",name:"debitValue",data:"debitValue",width:"100px",render:function(e,t,a,r){return formatMoney(e)}},{targets:8,className:"text-right",title:"贷方发生金额",name:"crebitValue",data:"crebitValue",width:"100px",render:function(e,t,a,r){return formatMoney(e)}}]}},v={localParam:{tabNum:!0,url:"dgCenter/DgGeneral.query.json",urlparam:{sqlId:"FA30069",menuId:window.sys_menuId,param1:"",param2:"",param3:"",param4:"",param5:"",param6:"",param7:"",param8:$("#samplingSet_amountStart").val(),param9:$("#samplingSet_amountEnd").val(),param10:"",param11:$("#samplingSet_subjectid").val(),param14:b,param15:$("#samplingSet_dataResource").val(),lockCustomerId:x.customerId,lockYyyy:x.yyyy,lockProjectId:x.projectId}},tableParam:{select:!0,lengthChange:!0,ordering:!1,serverSide:!0,pageLength:30,createdRow(e,t,a){""!=l&&(-1!=(l.assItemId+"").split(",").indexOf(t.subjectId+"-"+t.assItemId)&&$(e).css({color:"red"}))},columnDefs:[{targets:1,className:"text-center",title:"勾选",name:"id",data:"id",width:"15px",render:function(e,t,a,r){return'<input type="checkbox" name="assItemSelect" value="'+a.subjectId+","+a.assItemId+'"></input>'}},{targets:2,className:"text-left",title:"科目编号",name:"subjectId",data:"subjectId",width:"150px"},{targets:3,className:"text-left",title:"核算项目编号",name:"assItemId",data:"assItemId",width:"200px"},{targets:4,className:"text-left",title:"核算项目名称",name:"fullName",data:"fullName",width:"250px"},{targets:5,className:"text-center",title:"币种",name:"currency",data:"currency",width:"30px"},{targets:6,className:"text-center",title:"方向",name:"qcWay",data:"qcWay",width:"30px"},{targets:7,className:"text-right",title:"期初余额",name:"remainF",data:"remainF",width:"100px",render:function(e,t,a,r){return formatMoney(e)}},{targets:8,className:"text-right",title:"借方发生额",name:"debitOccF",data:"debitOccF",width:"100px",render:function(e,t,a,r){return formatMoney(e)}},{targets:9,className:"text-right",title:"贷方发生额",name:"creditOccF",data:"creditOccF",width:"100px",render:function(e,t,a,r){return formatMoney(e)}},{targets:10,className:"text-right",title:"期末余额",name:"balanceF",data:"balanceF",width:"100px",render:function(e,t,a,r){return formatMoney(e)}}]}},_={localParam:{tabNum:!0,url:"dgCenter/DgGeneral.query.json",urlparam:{sqlId:"FA30070",menuId:window.sys_menuId,param1:"",param2:"",param3:"",param4:"",param5:"",param6:"",param7:"",param8:$("#samplingSet_amountStart").val(),param9:$("#samplingSet_amountEnd").val(),param10:"",param11:$("#samplingSet_subjectid").val(),param14:b,param15:$("#samplingSet_dataResource").val(),lockCustomerId:x.customerId,lockYyyy:x.yyyy,lockProjectId:x.projectId}},tableParam:{select:!0,lengthChange:!0,ordering:!1,serverSide:!0,pageLength:30,createdRow(e,t,a){""!=l&&(-1!=(l.subjectId+"").split(",").indexOf(t.subjectId+"")&&$(e).css({color:"red"}))},columnDefs:[{targets:1,className:"text-center",title:"勾选",name:"id",data:"id",width:"15px",render:function(e,t,a,r){return'<input type="checkbox" name="accountSelect" value="'+a.subjectId+'"></input>'}},{targets:2,className:"text-left",title:"科目编号",name:"subjectId",data:"subjectId",width:"150px"},{targets:3,className:"text-left",title:"科目名称",name:"fullName",data:"fullName",width:"250px"},{targets:4,className:"text-center",title:"币种",name:"currency",data:"currency",width:"30px"},{targets:5,className:"text-center",title:"方向",name:"qcWay",data:"qcWay",width:"30px"},{targets:6,className:"text-right",title:"期初余额",name:"remainF",data:"remainF",width:"100px",render:function(e,t,a,r){return formatMoney(e)}},{targets:7,className:"text-right",title:"借方发生额",name:"debitOccF",data:"debitOccF",width:"100px",render:function(e,t,a,r){return formatMoney(e)}},{targets:8,className:"text-right",title:"贷方发生额",name:"creditOccF",data:"creditOccF",width:"100px",render:function(e,t,a,r){return formatMoney(e)}},{targets:9,className:"text-right",title:"期末余额",name:"balanceF",data:"balanceF",width:"100px",render:function(e,t,a,r){return formatMoney(e)}}]}};function j(e){return parseInt(e)<10&&(e="0"+e),e}function C(e){if(""==$("#samplingSet_dataResource").val())return $("#samplingSet_dataResource").focus(),void bdoInfoBox("提示","请选择数据来源");$.ajax({url:"dgCenter/DgGeneral.query.json",type:"post",data:{sqlId:"DG10003",menuId:window.sys_menuId,lockCustomerId:x.customerId,param1:b,param2:$("#samplingSet_dataResource").val(),param3:x.projectId,param4:"<lx2>"},dataType:"json",success:function(t){t&&t.success&&t.data?(l=t.data.length>0?t.data[0]:"",e()):bdoErrorBox("失败",t.resultInfo.statusText)}})}function T(){if(""==$("#samplingSet_endDate").val()&&""!=$("#samplingSet_startDate").val()&&$("#samplingSet_endDate").val($("#samplingSet_startDate").val()),""==$("#samplingSet_startDate").val()&&""!=$("#samplingSet_endDate").val()&&$("#samplingSet_startDate").val($("#samplingSet_endDate").val()),""==$("#samplingSet_customerId").val())return $("#samplingSet_customerId").focus(),void bdoInfoBox("提示","请选择客户");if(""==$("#samplingSet_startDate").val())return $("#samplingSet_startDate").focus(),void bdoInfoBox("提示","请选择凭证开始日期");if(""==$("#samplingSet_endDate").val())return $("#samplingSet_endDate").focus(),void bdoInfoBox("提示","请选择凭证结束日期");if($("#samplingSet_startDate").val()>$("#samplingSet_endDate").val())return $("#samplingSet_startDate").focus(),void bdoInfoBox("提示","凭证结束日期不能小于凭证开始日期");if($("#samplingSet_startDate").val().substr(0,4)==$("#samplingSet_endDate").val().substr(0,4))if(""!=$("#samplingSet_subjectid").val()){var e=0,t=0;if(""!=$("#samplingSet_amountStart").val()&&(e=parseFloat($("#samplingSet_amountStart").val())),""!=$("#samplingSet_amountEnd").val()&&(t=parseFloat($("#samplingSet_amountEnd").val())),e>t&&""!=$("#samplingSet_amountEnd").val())return $("#samplingSet_amountStart").focus(),void bdoInfoBox("提示","开始金额不能大于结束金额");var a=0,l=0;if(""!=$("#samplingSet_cullAmountStart").val()&&(a=parseFloat($("#samplingSet_cullAmountStart").val())),""!=$("#samplingSet_cullAmountEnd").val()&&(l=parseFloat($("#samplingSet_cullAmountEnd").val())),a>l&&""!=$("#samplingSet_cullAmountEnd").val())return $("#samplingSet_cullAmountStart").focus(),void bdoInfoBox("提示","开始金额不能大于结束金额");if(""==$("#samplingSet_cullReason").val()&&(""!=$("#samplingSet_cullAmountType").val()||""!=$("#samplingSet_cullAmountStart").val()||""!=$("#samplingSet_cullAmountEnd").val()||""!=$("#samplingSet_subjectid_cull").val()))return $("#samplingSet_cullReason").focus(),void bdoInfoBox("提示","请填写剔除原因");if("1"==$("#samplingSet_dataResource").val()){if(y.localParam.urlparam.lockCustomerId=$("#samplingSet_customerId").val(),y.localParam.urlparam.param1=$("#samplingSet_startDate").val().substr(0,4),y.localParam.urlparam.param2=$("#samplingSet_endDate").val().substr(0,4),"0"==$("#samplingSet_dateType").val()?(y.localParam.urlparam.param3=$("#samplingSet_startDate").val(),y.localParam.urlparam.param4=$("#samplingSet_endDate").val(),y.localParam.urlparam.param12="",y.localParam.urlparam.param13=""):"1"==$("#samplingSet_dateType").val()?(y.localParam.urlparam.param3="",y.localParam.urlparam.param4="",y.localParam.urlparam.param12=$("#samplingSet_startDate").val().substr(5,6),y.localParam.urlparam.param13=$("#samplingSet_endDate").val().substr(5,6)):(y.localParam.urlparam.param3="",y.localParam.urlparam.param4="",y.localParam.urlparam.param12="",y.localParam.urlparam.param13=""),y.localParam.urlparam.param5=$("#samplingSet_typeId").val(),y.localParam.urlparam.param6=$("#samplingSet_voucherId").val(),y.localParam.urlparam.param7=$("#samplingSet_summery").val(),y.localParam.urlparam.param8=$("#samplingSet_amountStart").val(),y.localParam.urlparam.param9=$("#samplingSet_amountEnd").val(),y.localParam.urlparam.param10=$("#samplingSet_amountType").val(),y.localParam.urlparam.param11=$("#samplingSet_subjectid").val(),""!=$("#samplingSet_subjectid_cull").val()){var s="'"+$("#samplingSet_subjectid_cull").val().replace(/,/g,"','")+"'";y.localParam.urlparam.param14=s}else y.localParam.urlparam.param14="";y.localParam.urlparam.param15=$("#samplingSet_dataResource").val(),y.localParam.urlparam.param16=$("#samplingSet_cullAmountStart").val(),y.localParam.urlparam.param17=$("#samplingSet_cullAmountEnd").val(),y.localParam.urlparam.param21=$("#samplingSet_assitemid").val(),y.localParam.urlparam.param22=$("#samplingSet_cullAmountType").val(),y.localParam.urlparam.param23=$("#samplingSet_cullReason").val(),y.localParam.urlparam.param24=x.serail,y.localParam.urlparam.lockYyyy=$("#samplingSet_startDate").val().substr(0,4),y.localParam.urlparam.sqlId="FINCP100001",BdoDataTable("samplingSetTable",y),r=H(y.localParam.urlparam)}else"2"==$("#samplingSet_dataResource").val()?(v.localParam.urlparam.lockCustomerId=$("#samplingSet_customerId").val(),v.localParam.urlparam.param2=$("#samplingSet_endDate").val().substr(0,4),v.localParam.urlparam.param3=$("#samplingSet_startDate").val().substr(5,6),v.localParam.urlparam.param4=$("#samplingSet_endDate").val().substr(5,6),v.localParam.urlparam.param8=$("#samplingSet_amountStart").val(),v.localParam.urlparam.param9=$("#samplingSet_amountEnd").val(),v.localParam.urlparam.param10=$("#samplingSet_assitemid").val(),v.localParam.urlparam.param11=$("#samplingSet_subjectid").val(),v.localParam.urlparam.param14=b,v.localParam.urlparam.param15=$("#samplingSet_dataResource").val(),v.localParam.urlparam.sqlId="FA30069",BdoDataTable("samplingSetTable",v),r=H(v.localParam.urlparam)):"3"==$("#samplingSet_dataResource").val()&&(_.localParam.urlparam.lockCustomerId=$("#samplingSet_customerId").val(),_.localParam.urlparam.param2=$("#samplingSet_endDate").val().substr(0,4),_.localParam.urlparam.param3=$("#samplingSet_startDate").val().substr(5,6),_.localParam.urlparam.param4=$("#samplingSet_endDate").val().substr(5,6),_.localParam.urlparam.param8=$("#samplingSet_amountStart").val(),_.localParam.urlparam.param9=$("#samplingSet_amountEnd").val(),_.localParam.urlparam.param11=$("#samplingSet_subjectid").val(),_.localParam.urlparam.param14=b,_.localParam.urlparam.param15=$("#samplingSet_dataResource").val(),_.localParam.urlparam.sqlId="FA30070",BdoDataTable("samplingSetTable",_),r=H(_.localParam.urlparam));p=$("#samplingSet_dataResource").val()}else bdoInfoBox("提示","请选择科目");else bdoInfoBox("提示","凭证日期必须是同一年")}function D(){$("#samplingSetTable").DataTable().ajax.reload(null,!1)}function S(){return $("#modal_samplingCaculation").modal("show"),$("#modal-samplingSet").modal("hide"),document.getElementById("samplingCaculation_totalAmount").disabled=!0,document.getElementById("samplingCaculation_cullAmount").disabled=!0,document.getElementById("samplingCaculation_amount").disabled=!0,document.getElementById("samplingCaculation_num").disabled=!0,document.getElementById("samplingCaculation_r").disabled=!0,document.getElementById("samplingCaculation_initialAmount").disabled=!0,document.getElementById("samplingCaculation_total").disabled=!0,document.getElementById("samplingCaculation_calAmount").disabled=!0,document.getElementById("samplingCaculation_actualImportant").disabled=!0,"1"==r.param15?r.sqlId="FINCP100002":"2"==r.param15?r.sqlId="FA30074":"3"==r.param15&&(r.sqlId="FA30076"),r.param14=b,$.ajax({url:"finCenter/Sampling.quertSamplingCalculation.json",type:"post",data:r,dataType:"json",success:function(e){e&&e.success&&e.data?e.data.length>0&&($("#samplingCaculation_totalAmount").val(W(e.data[0].totalAmount)),$("#samplingCaculation_cullAmount").val(W(e.data[0].cullAmount)),$("#samplingCaculation_amount").val(W(e.data[0].amount)),$("#samplingCaculation_num").val(e.data[0].samplingCount),null!=e.data[0].important&&$("#samplingCaculation_important").val(e.data[0].important),null!=e.data[0].actualImportant&&$("#samplingCaculation_actualImportant").val(W(e.data[0].actualImportant)),null!=e.data[0].risk&&$("#samplingCaculation_risk").val(e.data[0].risk),null!=e.data[0].control&&$("#samplingCaculation_control").val(e.data[0].control),null!=e.data[0].analysis&&$("#samplingCaculation_analysis").val(e.data[0].analysis),null!=e.data[0].pledge&&$("#samplingCaculation_pledge").val(e.data[0].pledge),null!=e.data[0].variable&&$("#samplingCaculation_variable").val(e.data[0].variable),null!=e.data[0].variable&&$("#samplingCaculation_variable").val(e.data[0].variable),null!=e.data[0].calRemark?$("#samplingCaculation_calRemark").val(e.data[0].calRemark):$("#samplingCaculation_calRemark").val(""),g=e.data[0].samplingCount,R(e.data[0].adjustAmount)):(bdoErrorBox("失败",e.resultInfo.statusText),$("#modal_samplingCaculation").modal("hide"))}}),!1}function P(){return $.ajax({url:"finCenter/sampling.querySamplingList.json",type:"post",data:{lockCustomerId:x.customerId,param1:b},dataType:"json",success:function(e){e.success?"7"==$("#samplingList_method").val()?($("#modal_cutoff").modal("show"),null!=e.data[0].cutoffNum&&""!=e.data[0].cutoffNum&&$("#cutoff_num").val(e.data[0].cutoffNum),null!=e.data[0].cutoffAmount&&""!=e.data[0].cutoffAmount&&$("#cutoff_amount").val(e.data[0].cutoffAmount),null!=e.data[0].subjectId&&""!=e.data[0].subjectId&&$("#cutoff_subjectid").val(e.data[0].subjectId)):(document.getElementById("samplingSet_dataResource").disabled=!0,null!=e.data[0].dataResource&&""!=e.data[0].dataResource&&($("#samplingSet_dataResource").val(e.data[0].dataResource),$("#samplingSet_dataResource").change()),document.getElementById("samplingSet_customerId").disabled=!0,$("#samplingSet_customerId").val(e.data[0].customerId),null!=e.data[0].vchDateType&&""!=e.data[0].vchDateType&&($("#samplingSet_dateType").val(e.data[0].vchDateType),$("#samplingSet_dateType").change()),$("#samplingSet_startDate").val(e.data[0].vchDateStart),$("#samplingSet_endDate").val(e.data[0].vchDateEnd),$("#samplingSet_subjectid").val(e.data[0].subjectId),$("#samplingSet_typeId").val(e.data[0].typeId),$("#samplingSet_voucherId").val(e.data[0].oldVoucherId),$("#samplingSet_summery").val(e.data[0].summary),$("#samplingSet_assitemid").val(e.data[0].assItemId),null!=e.data[0].amountType&&""!=e.data[0].amountType&&$("#samplingSet_amountType").val(e.data[0].amountType),$("#samplingSet_amountStart").val(e.data[0].amountStart),$("#samplingSet_amountEnd").val(e.data[0].amountEnd),null!=e.data[0].cullAmountType&&""!=e.data[0].cullAmountType&&$("#samplingSet_cullAmountType").val(e.data[0].cullAmountType),$("#samplingSet_cullAmountStart").val(e.data[0].cullAmountStart),$("#samplingSet_cullAmountEnd").val(e.data[0].cullAmountEnd),$("#samplingSet_cullReason").val(e.data[0].cullReason),$("#samplingSet_subjectid_cull").val(e.data[0].cullSubjectId),$("#samplingSetTable").hasClass("dataTable")&&($("#samplingSetTable").DataTable().clear(),$("#samplingSetTable").DataTable().destroy(),$("#samplingSetTable").empty()),$("#modal-samplingSet").modal("show")):bdoErrorBox("失败",e.resultInfo.statusText)}}),!1}function R(e){var t=$("#samplingCaculation_risk").val()-$("#samplingCaculation_control").val()-$("#samplingCaculation_analysis").val()-$("#samplingCaculation_pledge").val();if(t<0?$("#samplingCaculation_r").val(0):$("#samplingCaculation_r").val(t),""!=$("#samplingCaculation_actualImportant").val()&&"0.00"!=$("#samplingCaculation_actualImportant").val()){var a=X($("#samplingCaculation_amount").val())*$("#samplingCaculation_r").val()/X($("#samplingCaculation_actualImportant").val());$("#samplingCaculation_initialAmount").val(a.toFixed(2)),$("#samplingCaculation_total").val(parseInt(a));var r=$("#samplingCaculation_total").val()*$("#samplingCaculation_variable").val();$("#samplingCaculation_adjustAmount").val(r.toFixed(0));var l=parseInt($("#samplingCaculation_num").val());l<parseInt(r.toFixed(0))&&$("#samplingCaculation_adjustAmount").val(l.toFixed(0))}else $("#samplingCaculation_initialAmount").val(0),$("#samplingCaculation_total").val(0),$("#samplingCaculation_adjustAmount").val(0);$("#samplingCaculation_adjustAmount").val(),$("#samplingCaculation_calAmount").val($("#samplingCaculation_adjustAmount").val()),null!=e&&$("#samplingCaculation_adjustAmount").val(e)}function k(){return $("#modal_samplistTest").modal("show"),J(),$("#samplistTestTable").hasClass("dataTable")&&($("#samplistTestTable").DataTable().clear(),$("#samplistTestTable").DataTable().destroy(),$("#samplistTestTable").empty()),$("#samplistTestRepeatTable").hasClass("dataTable")&&($("#samplistTestRepeatTable").DataTable().clear(),$("#samplistTestRepeatTable").DataTable().destroy(),$("#samplistTestRepeatTable").empty()),N(),!1}function N(){r.param25=b,r.param24=$("#samplingList_method").val(),bdoInProcessingBox("抽凭中"),$.ajax({url:"finCenter/sampling.saveSamplingTest.json",type:"post",data:r,dataType:"json",success:function(e){e.success?(bdoSuccessBox("成功",e.resultInfo.statusText),null!=e.data||$("#voucherIdNum").html(""),"1"==r.param15||"7"==r.param24?(E.localParam.urlparam=H(y.localParam.urlparam),E.localParam.urlparam.sqlId="FINCP100007",E.localParam.urlparam.param16=$("#dgSamplingInfo_sampleMethod").val(),E.localParam.urlparam.param14=b,E.localParam.urlparam.param21="",E.localParam.urlparam.param22="",E.localParam.urlparam.param23="1",BdoDataTable("samplistTestTable",E),A.localParam.urlparam=H(y.localParam.urlparam),A.localParam.urlparam.sqlId="FINCP100007",A.localParam.urlparam.param16=$("#dgSamplingInfo_sampleMethod").val(),A.localParam.urlparam.param14=b,A.localParam.urlparam.param21="",A.localParam.urlparam.param22="1",A.localParam.urlparam.param23="",BdoDataTable("samplistTestRepeatTable",A),$("#samplistTestTable tbody").on("dblclick","tr",function(){$("#samplistTestTable").DataTable().row(this).data()})):"2"==r.param15?(O.localParam.urlparam=v.localParam.urlparam,O.localParam.urlparam.sqlId="FA30069",BdoDataTable("samplistTestTable",O)):"3"==r.param15&&(B.localParam.urlparam=_.localParam.urlparam,B.localParam.urlparam.sqlId="FA30070",BdoDataTable("samplistTestTable",B))):bdoErrorBox("失败",e.resultInfo.statusText)}})}$(".date-picker").datepicker({autoclose:!0,todayHighlight:!0,language:"zh-CN",format:"yyyy-mm-dd",minViewMode:0}),(()=>{if($(e.region).empty().append(t),$("#assItemSame_yyyy").val(w-1),$("#samplingSet_dataResource").html(ComboLocalDicOption(!1,"抽样数据来源")),$("#samplingSet_typeId").html(ComboLocalDicOption(!0,"凭证字")),$("#samplingList_method").html(ComboLocalDicOption(!1,"抽样方式")),$("#samplingSet_dataResource").val("1"),$("#samplingCaculation_risk").html(ComboLocalDicOption(!1,"错报风险等级")),$("#samplingCaculation_control").html(ComboLocalDicOption(!1,"控制测试获取的保证程度")),$("#samplingCaculation_analysis").html(ComboLocalDicOption(!1,"实质性分析程序获取的保证程度")),$("#samplingCaculation_pledge").html(ComboLocalDicOption(!1,"能否从其他实质性程序中获取该财务报表领域的相关认定的审计保证")),$("#samplingCaculation_variable").html(ComboLocalDicOption(!1,"是否能够应对样本总体的变量因素")),$("#dgSamplingInfo_sampleMethod").html(ComboLocalDicOption(!0,"抽样方式")),$("#samplingInfoEdit_auditResult").html(ComboLocalDicOption(!0,"抽凭结论")),$("#dgSamplingInfo_isRelated").html(ComboLocalDicOption(!0,"是否")),$("#dgSamplingInfo_dateType").val("2"),$("#dgSamplingInfo_startDate").datepicker({autoclose:!0,todayHighlight:!0,language:"zh-CN",format:"yyyy",minViewMode:2}),$("#dgSamplingInfo_endDate").datepicker({autoclose:!0,todayHighlight:!0,language:"zh-CN",format:"yyyy",minViewMode:2}),$("#dgSamplingInfo_startDate").val(window.CUR_PROJECT_ACC_YEAR),$("#dgSamplingInfo_endDate").val(window.CUR_PROJECT_ACC_YEAR),$("#samplingSet_dateType").val("2"),$("#samplingSet_startDate").datepicker({autoclose:!0,todayHighlight:!0,language:"zh-CN",format:"yyyy",minViewMode:2}),$("#samplingSet_endDate").datepicker({autoclose:!0,todayHighlight:!0,language:"zh-CN",format:"yyyy",minViewMode:2}),$("#samplingSet_startDate").val(window.CUR_PROJECT_ACC_YEAR),$("#samplingSet_endDate").val(window.CUR_PROJECT_ACC_YEAR),$("#samplistRelate_dateType").val("2"),$("#samplistRelate_startDate").datepicker({autoclose:!0,todayHighlight:!0,language:"zh-CN",format:"yyyy",minViewMode:2}),$("#samplistRelate_endDate").datepicker({autoclose:!0,todayHighlight:!0,language:"zh-CN",format:"yyyy",minViewMode:2}),$("#samplistRelate_startDate").val(window.CUR_PROJECT_ACC_YEAR),$("#samplistRelate_endDate").val(window.CUR_PROJECT_ACC_YEAR),$("#samplistResult_dataResource").html(ComboLocalDicOption(!1,"抽样数据来源")),$("#samplistResult_typeId").html(ComboLocalDicOption(!0,"凭证字")),"function"==typeof $(".js-tree-collapsed").treeview(!0).getSelected){let e=$(".js-tree-collapsed").treeview(!0).getSelected()[0];$("#samplingIndex").text("【"+e.extraOptions.indexId+"】")}"1"==e.data.samplingType?($("#samplingIsShow").css("display","none"),x.customerId=e.data.customerId,x.projectId=e.data.projectId,x.yyyy=e.data.voucherDate.substr(0,4),x.serail=e.data.serail,$("#samplingList_method").attr("disabled",!0),$("#samplingList_customerId option[value="+e.data.customerId+"]").prop("selected",!0),$("#samplingSet_customerId option[value="+e.data.customerId+"]").prop("selected",!0),$("#assItemSame_customerId option[value="+e.data.customerId+"]").prop("selected",!0),$("#samplistResult_customerId option[value="+e.data.customerId+"]").prop("selected",!0),$("#samplingSet_dateType").val("0"),$("#samplingSet_startDate").val(e.data.voucherDate),$("#samplingSet_endDate").val(e.data.voucherDate),$("#samplingSet_dateType").attr("disabled",!0),$("#samplingSet_startDate").attr("disabled",!0),$("#samplingSet_endDate").attr("disabled",!0),$("#samplingSet_subjectid").val(e.data.subjectId),$("#samplingSet_typeId").val(e.data.typeId),$("#samplingSet_voucherId").val(e.data.oldVoucherId),$("#samplingSet_subjectid").attr("disabled",!0),$("#samplingSet_typeId").attr("disabled",!0),$("#samplingSet_voucherId").attr("disabled",!0)):(x.customerId=window.CUR_CUSTOMERID,x.projectId=window.CUR_PROJECTID,x.yyyy=window.CUR_PROJECT_ACC_YEAR),I.localParam.urlparam.param3=x.projectId,I.localParam.urlparam.lockCustomerId=x.customerId,y.localParam.urlparam.lockCustomerId=x.customerId,y.localParam.urlparam.lockYyyy=x.yyyy,y.localParam.urlparam.lockProjectId=x.projectId,BdoDataTable("samplingListTable",I),OneUI.initHelper("slimscroll")})(),$("#btn_samplingList_search").click(function(){I.localParam.urlparam.param2=$("#samplingList_name").val(),BdoDataTable("samplingListTable",I),$("#samplingListTable").on("xhr.dt",function(e,t,a,r){a.recordsTotal>0?$("#samplingList_export").css("display","block"):$("#samplingList_export").css("display","none")})}),$("#btn_samplingSet_search").click(function(){C(T)}),$("#samplingSet_dateType").change(function(){var e="yyyy-mm-dd",t=0;"1"==$("#samplingSet_dateType").val()?(e="yyyy-mm",t=1):"2"==$("#samplingSet_dateType").val()&&(e="yyyy",t=2),$("#samplingSet_startDate").remove(),$("#samplingSet_endDate").remove(),$("#samplingSet_dateAddon").remove(),$("#samplingSet_dateGroup").append('<input id="samplingSet_startDate" class="form-control date-picker" size=10 type="text" value="" autocomplete="off">'),$("#samplingSet_dateGroup").append('<span id="samplingSet_dateAddon" class="input-group-addon">-</span>'),$("#samplingSet_dateGroup").append('<input id="samplingSet_endDate" class="form-control date-picker" size=10 type="text" value="" autocomplete="off">'),$("#samplingSet_startDate").datepicker({autoclose:!0,todayHighlight:!0,language:"zh-CN",format:e,minViewMode:t}),$("#samplingSet_endDate").datepicker({autoclose:!0,todayHighlight:!0,language:"zh-CN",format:e,minViewMode:t}),$("#samplingSet_endDate").change(function(){$("#subject_tree").hasClass("treeview")&&($("#subject_tree").tree("reset"),$("#subject_tree").tree("destory")),$("#samplingSet_assitem_tree").hasClass("treeview")&&($("#samplingSet_assitem_tree").tree2("reset"),$("#samplingSet_assitem_tree").tree2("destory"))}),$("#samplingSet_startDate").change(function(){$("#subject_tree").hasClass("treeview")&&($("#subject_tree").tree("reset"),$("#subject_tree").tree("destory")),$("#samplingSet_assitem_tree").hasClass("treeview")&&($("#samplingSet_assitem_tree").tree2("reset"),$("#samplingSet_assitem_tree").tree2("destory"))})}),$("#samplingSet_subjectid").change(function(){$("#samplingSet_assitem_tree").hasClass("treeview")&&($("#samplingSet_assitem_tree").tree2("reset"),$("#samplingSet_assitem_tree").tree2("destory"))}),$("#dgSamplingInfo_dateType").change(function(){var e="yyyy-mm-dd",t=0;"1"==$("#dgSamplingInfo_dateType").val()?(e="yyyy-mm",t=1):"2"==$("#dgSamplingInfo_dateType").val()&&(e="yyyy",t=2),$("#dgSamplingInfo_startDate").remove(),$("#dgSamplingInfo_endDate").remove(),$("#dgSamplingInfo_dateAddon").remove(),$("#dgSamplingInfo_dateGroup").append('<input id="dgSamplingInfo_startDate" class="form-control date-picker" size=10 type="text" value="" autocomplete="off">'),$("#dgSamplingInfo_dateGroup").append('<span id="dgSamplingInfo_dateAddon" class="input-group-addon">-</span>'),$("#dgSamplingInfo_dateGroup").append('<input id="dgSamplingInfo_endDate" class="form-control date-picker" size=10 type="text" value="" autocomplete="off">'),$("#dgSamplingInfo_startDate").datepicker({autoclose:!0,todayHighlight:!0,language:"zh-CN",format:e,minViewMode:t}),$("#dgSamplingInfo_endDate").datepicker({autoclose:!0,todayHighlight:!0,language:"zh-CN",format:e,minViewMode:t}),$("#dgSamplingInfo_endDate").change(function(){$("#subject_tree_samplingInfo").hasClass("treeview")&&($("#subject_tree_samplingInfo").tree("reset"),$("#subject_tree_samplingInfo").tree("destory"))}),$("#dgSamplingInfo_startDate").change(function(){$("#subject_tree_samplingInfo").hasClass("treeview")&&($("#subject_tree_samplingInfo").tree("reset"),$("#subject_tree_samplingInfo").tree("destory"))})}),$("#samplistRelate_dateType").change(function(){var e="yyyy-mm-dd",t=0;"1"==$("#samplistRelate_dateType").val()?(e="yyyy-mm",t=1):"2"==$("#samplistRelate_dateType").val()&&(e="yyyy",t=2),$("#samplistRelate_startDate").remove(),$("#samplistRelate_endDate").remove(),$("#samplistRelate_dateAddon").remove(),$("#samplistRelate_dateGroup").append('<input id="samplistRelate_startDate" class="form-control date-picker" size=10 type="text" value="" autocomplete="off">'),$("#samplistRelate_dateGroup").append('<span id="samplistRelate_dateAddon" class="input-group-addon">-</span>'),$("#samplistRelate_dateGroup").append('<input id="samplistRelate_endDate" class="form-control date-picker" size=10 type="text" value="" autocomplete="off">'),$("#samplistRelate_startDate").datepicker({autoclose:!0,todayHighlight:!0,language:"zh-CN",format:e,minViewMode:t}),$("#samplistRelate_endDate").datepicker({autoclose:!0,todayHighlight:!0,language:"zh-CN",format:e,minViewMode:t}),$("#samplistRelate_endDate").change(function(){$("#subject_tree_samplistRelate").hasClass("treeview")&&($("#subject_tree_samplistRelate").tree("reset"),$("#subject_tree_samplistRelate").tree("destory"))}),$("#samplistRelate_startDate").change(function(){$("#subject_tree_samplistRelate").hasClass("treeview")&&($("#subject_tree_samplistRelate").tree("reset"),$("#subject_tree_samplistRelate").tree("destory"))})}),$("#samplingSet_subjectid").focus(function(){if(""==$("#samplingSet_customerId").val())return $("#samplingSet_customerId").focus(),void bdoInfoBox("提示","请选择客户");if(""==$("#samplingSet_startDate").val())return $("#samplingSet_startDate").focus(),void bdoInfoBox("提示","请选择账套年份");if($("#modal_subjectid").modal("show"),!$("#subject_tree").hasClass("treeview")){var e="";e=""!=$("#samplingSet_endDate").val()?$("#samplingSet_endDate").val().substr(0,4):$("#samplingSet_startDate").val().substr(0,4),$("#subject_tree").tree({url:"finCenter/FinTreeCommon.findAccSubjectType.json",params:{lockCustomerId:$("#samplingSet_customerId").val(),lockYyyy:e,searchInputId:"searchInput1"},singleSelect:!0,lazyLoad:!1,onceLoad:!0,view:{leafIcon:"fa fa-building text-flat",nodeIcon:"fa fa-bank text-primary-light",folderSelectable:!1,multiSelect:!1,showCheckbox:!0,selectedColor:"",selectedBackColor:""}})}}),$("#modal_subjectid_sure").click(function(){var e=$("#subject_tree").tree("getTreeMultiValue");"object"==typeof e?$("#samplingSet_subjectid").val(""):$("#samplingSet_subjectid").val(e).change(),$("#modal_subjectid").modal("hide")}),$("#modal_subjectid_reset").click(function(){$("#subject_tree").tree("reset")}),$("#dgSamplingInfo_subjectid").focus(function(){if(""==$("#dgSamplingInfo_startDate").val())return $("#dgSamplingInfo_startDate").focus(),void bdoInfoBox("提示","请选择账套年份");if($("#modal_subjectid_samplingInfo").modal("show"),!$("#subject_tree_samplingInfo").hasClass("treeview")){var e="";e=""!=$("#dgSamplingInfo_endDate").val()?$("#dgSamplingInfo_endDate").val().substr(0,4):$("#dgSamplingInfo_startDate").val().substr(0,4),$("#subject_tree_samplingInfo").tree({url:"finCenter/FinTreeCommon.findAccSubjectType.json",params:{lockCustomerId:x.customerId,lockYyyy:e,searchInputId:"searchInput1_samplingInfo"},singleSelect:!0,lazyLoad:!1,onceLoad:!0,view:{leafIcon:"fa fa-building text-flat",nodeIcon:"fa fa-bank text-primary-light",folderSelectable:!1,multiSelect:!1,showCheckbox:!0,selectedColor:"",selectedBackColor:""}})}}),$("#modal_subjectid_sure_samplingInfo").click(function(){var e=$("#subject_tree_samplingInfo").tree("getTreeMultiValue");"object"==typeof e?$("#dgSamplingInfo_subjectid").val(""):$("#dgSamplingInfo_subjectid").val(e),$("#modal_subjectid_samplingInfo").modal("hide")}),$("#modal_subjectid_reset_samplingInfo").click(function(){$("#subject_tree_samplingInfo").tree("reset")}),$("#samplistRelate_subjectid").focus(function(){if(""==$("#samplistRelate_startDate").val())return $("#samplistRelate_startDate").focus(),void bdoInfoBox("提示","请选择账套年份");if($("#modal_subjectid_samplistRelate").modal("show"),!$("#subject_tree_samplistRelate").hasClass("treeview")){var e="";e=""!=$("#samplistRelate_endDate").val()?$("#samplistRelate_endDate").val().substr(0,4):$("#samplistRelate_startDate").val().substr(0,4),$("#subject_tree_samplistRelate").tree({url:"finCenter/FinTreeCommon.findAccSubjectType.json",params:{lockCustomerId:x.customerId,lockYyyy:e,searchInputId:"searchInput1_samplistRelate"},singleSelect:!0,lazyLoad:!1,onceLoad:!0,view:{leafIcon:"fa fa-building text-flat",nodeIcon:"fa fa-bank text-primary-light",folderSelectable:!1,multiSelect:!1,showCheckbox:!0,selectedColor:"",selectedBackColor:""}})}}),$("#modal_subjectid_sure_samplistRelate").click(function(){var e=$("#subject_tree_samplistRelate").tree("getTreeMultiValue");"object"==typeof e?$("#samplistRelate_subjectid").val(""):$("#samplistRelate_subjectid").val(e),$("#modal_subjectid_samplistRelate").modal("hide")}),$("#modal_subjectid_reset_samplistRelate").click(function(){$("#subject_tree_samplistRelate").tree("reset")}),$("#samplingSet_subjectid_cull").focus(function(){if(""==$("#samplingSet_customerId").val())return $("#samplingSet_customerId").focus(),void bdoInfoBox("提示","请选择客户");if(""==$("#samplingSet_startDate").val())return $("#samplingSet_startDate").focus(),void bdoInfoBox("提示","请选择账套年份");if($("#modal_subjectid_cull").modal("show"),!$("#subject_tree_cull").hasClass("treeview")){var e="";e=""!=$("#samplingSet_endDate").val()?$("#samplingSet_endDate").val().substr(0,4):$("#samplingSet_startDate").val().substr(0,4),$("#subject_tree_cull").tree({url:"finCenter/FinTreeCommon.findAccSubjectType.json",params:{lockCustomerId:$("#samplingSet_customerId").val(),lockYyyy:e,searchInputId:"searchInput_cull"},singleSelect:!1,lazyLoad:!1,onceLoad:!0,view:{leafIcon:"fa fa-building text-flat",nodeIcon:"fa fa-bank text-primary-light",folderSelectable:!1,multiSelect:!0,showCheckbox:!0,selectedColor:"",selectedBackColor:""}})}}),$("#modal_subjectid_sure_cull").click(function(){var e=$("#subject_tree_cull").tree("getTreeMultiValue");"object"==typeof e?$("#samplingSet_subjectid_cull").val(""):$("#samplingSet_subjectid_cull").val(e).change(),$("#modal_subjectid_cull").modal("hide")}),$("#modal_subjectid_reset_cull").click(function(){$("#subject_tree_cull").tree("reset")}),$("#cutoff_subjectid").focus(function(){$("#modal_subjectid_cutoff").modal("show"),$("#subject_tree_cutoff").hasClass("treeview")||$("#subject_tree_cutoff").tree({url:"finCenter/FinTreeCommon.findAccSubjectType.json",params:{lockCustomerId:x.customerId,lockYyyy:x.yyyy,searchInputId:"searchInput_cutoff"},singleSelect:!0,lazyLoad:!1,onceLoad:!0,view:{leafIcon:"fa fa-building text-flat",nodeIcon:"fa fa-bank text-primary-light",folderSelectable:!1,multiSelect:!1,showCheckbox:!0,selectedColor:"",selectedBackColor:""}})}),$("#modal_subjectid_sure_cutoff").click(function(){var e=$("#subject_tree_cutoff").tree("getTreeMultiValue");"object"==typeof e?$("#cutoff_subjectid").val(""):$("#cutoff_subjectid").val(e).change(),$("#modal_subjectid_cutoff").modal("hide")}),$("#modal_subjectid_reset_cutoff").click(function(){$("#subject_tree_cutoff").tree("reset")}),$("#samplingSet_dataResource").change(function(){"1"==$("#samplingSet_dataResource").val()?(document.getElementById("samplingSet_typeId_div").style.display="block",document.getElementById("samplingSet_voucherId_div").style.display="block",document.getElementById("samplingSet_summery_div").style.display="block",document.getElementById("samplingSet_dateType").disabled=!1,document.getElementById("samplingSet_amountType").disabled=!1):"2"==$("#samplingSet_dataResource").val()?(document.getElementById("samplingSet_typeId_div").style.display="none",document.getElementById("samplingSet_voucherId_div").style.display="none",document.getElementById("samplingSet_summery_div").style.display="none",document.getElementById("samplingSet_assitemid_div").style.display="block",$("#samplingSet_dateType").val("1"),$("#samplingSet_dateType").change(),$("#samplingSet_amountType").val("3"),document.getElementById("samplingSet_dateType").disabled=!0,document.getElementById("samplingSet_amountType").disabled=!0):"3"==$("#samplingSet_dataResource").val()&&(document.getElementById("samplingSet_typeId_div").style.display="none",document.getElementById("samplingSet_voucherId_div").style.display="none",document.getElementById("samplingSet_summery_div").style.display="none",$("#samplingSet_dateType").val("1"),$("#samplingSet_dateType").change(),$("#samplingSet_amountType").val("3"),document.getElementById("samplingSet_dateType").disabled=!0,document.getElementById("samplingSet_amountType").disabled=!0)}),$("#samplingSet_assitemid").focus(function(){if(""==$("#samplingSet_customerId").val())return $("#samplingSet_customerId").focus(),void bdoInfoBox("提示","请选择客户");if(""==$("#samplingSet_startDate").val())return $("#samplingSet_startDate").focus(),void bdoInfoBox("提示","请选择账套年份");if(""==$("#samplingSet_subjectid").val())return $("#samplingSet_assitemid").blur(),void bdoInfoBox("提示","请选择科目");var e="";e=""!=$("#samplingSet_endDate").val()?$("#samplingSet_endDate").val().substr(0,4):$("#samplingSet_startDate").val().substr(0,4),$("#modal_assitemid").modal("show"),$("#samplingSet_assitem_tree").hasClass("treeview")||$("#samplingSet_assitem_tree").tree2({url:"finCenter/FinTreeCommon.findSubjectAssitem.json",params:{lockCustomerId:$("#samplingSet_customerId").val(),lockYyyy:e,param11:$("#samplingSet_subjectid").val(),searchInputId:"searchInputSamplingSet"},singleSelect:!0,view:{leafIcon:"fa fa-building text-flat",nodeIcon:"fa fa-bank text-primary-light",folderSelectable:!1,multiSelect:!1,showCheckbox:!0,selectedColor:"",selectedBackColor:""}})}),$("#modal_assitemid_sure").click(function(){"object"==typeof $("#samplingSet_assitem_tree").tree2("getTreeMultiValue")?$("#samplingSet_assitemid").val(""):$("#samplingSet_assitemid").val($("#samplingSet_assitem_tree").tree2("getTreeMultiValue")),$("#modal_assitemid").modal("hide")}),$("#modal_assitemid_reset").click(function(){$("#samplingSet_assitem_tree").tree2("reset"),$("#searchInputSamplingSet").keyup()}),$("#samplingList_method").change(function(){8==$("#samplingList_method").val()?document.getElementById("samplingAdd_customizeReason").style.display="block":document.getElementById("samplingAdd_customizeReason").style.display="none"}),$("#samplingSet_add").click(function(){h="0",b="";var e="抽凭"+z("yyyyMMddhhmmss",new Date);$("#samplingAdd_name_model").val(e),$("#modal-samplingAdd").modal("show")}),$("#samplingSet_prev,#modal_cutoff_prev").click(function(){$.ajax({url:"finCenter/sampling.querySamplingList.json",type:"post",data:{lockCustomerId:x.customerId,param1:b,param2:x.projectId},dataType:"json",success:function(e){if(e.success){if("3"==e.data[0].sampleStatus)return void bdoInfoBox("提示","抽凭已完成！");$("#samplingAdd_name_model").val(e.data[0].sampleName),$("#samplingList_method").val(e.data[0].sampleMethod),8==e.data[0].sampleMethod?(document.getElementById("samplingAdd_customizeReason").style.display="block",$("#samplingList_customizeReason").val(e.data[0].customizeReason)):document.getElementById("samplingAdd_customizeReason").style.display="none",$("#modal-samplingAdd").modal("show"),$("#modal-samplingSet").modal("hide"),$("#modal_cutoff").modal("hide")}else bdoErrorBox("失败",e.resultInfo.statusText)}})}),$("#samplingAdd_submit").click(function(){var t=$("#samplingList_method").val();if(null!=t&&""!=t){var a=$("#samplingAdd_name_model").val();if(null!=a&&""!=a)if(8!=t||""!=$("#samplingList_customizeReason").val()){var r="";"1"==h&&(r=s);$.ajax({url:"finCenter/sampling.saveSamplingList.json",type:"post",data:{lockCustomerId:x.customerId,param1:x.projectId,param2:$("#samplingAdd_name_model").val(),param3:t,param4:b,param5:$("#samplingList_customizeReason").val(),param6:r},dataType:"json",success:function(a){a.success?($("#samplingListTable").DataTable().ajax.reload(null,!1),$("#dgSamplingInfoTable").DataTable().ajax.reload(null,!1),$("#modal-samplingAdd").modal("hide"),b=a.data[0].autoId,"1"==h&&(f=a.data[0].autoId,$("#samplingInfoEdit_relateSampling").val(a.data[0].sampleName)),7==t?($("#modal_cutoff").modal("show"),null!=a.data[0].cutoffNum&&""!=a.data[0].cutoffNum&&$("#cutoff_num").val(a.data[0].cutoffNum),null!=a.data[0].cutoffAmount&&""!=a.data[0].cutoffAmount&&$("#cutoff_amount").val(a.data[0].cutoffAmount),null!=a.data[0].subjectId&&""!=a.data[0].subjectId&&$("#cutoff_subjectid").val(a.data[0].subjectId)):($("#modal-samplingSet").modal("show"),document.getElementById("samplingSet_dataResource").disabled=!0,null!=a.data[0].dataResource&&""!=a.data[0].dataResource&&($("#samplingSet_dataResource").val(a.data[0].dataResource),$("#samplingSet_dataResource").change()),document.getElementById("samplingSet_customerId").disabled=!0,$("#samplingSet_customerId").val(a.data[0].customerId),null!=a.data[0].vchDateType&&""!=a.data[0].vchDateType&&($("#samplingSet_dateType").val(a.data[0].vchDateType),$("#samplingSet_dateType").change()),null!=a.data[0].vchDateStart&&""!=a.data[0].vchDateStart&&$("#samplingSet_startDate").val(a.data[0].vchDateStart),null!=a.data[0].vchDateEnd&&""!=a.data[0].vchDateEnd&&$("#samplingSet_endDate").val(a.data[0].vchDateEnd),"1"==e.data.samplingType?(null!=a.data[0].subjectId&&""!=a.data[0].subjectId&&$("#samplingSet_subjectid").val(a.data[0].subjectId),null!=a.data[0].typeId&&""!=a.data[0].typeId&&$("#samplingSet_typeId").val(a.data[0].typeId),null!=a.data[0].oldVoucherId&&""!=a.data[0].oldVoucherId&&$("#samplingSet_voucherId").val(a.data[0].oldVoucherId)):($("#samplingSet_subjectid").val(a.data[0].subjectId),$("#samplingSet_typeId").val(a.data[0].typeId),$("#samplingSet_voucherId").val(a.data[0].oldVoucherId)),$("#samplingSet_summery").val(a.data[0].summary),$("#samplingSet_assitemid").val(a.data[0].assItemId),null!=a.data[0].amountType&&""!=a.data[0].amountType&&$("#samplingSet_amountType").val(a.data[0].amountType),$("#samplingSet_amountStart").val(a.data[0].amountStart),$("#samplingSet_amountEnd").val(a.data[0].amountEnd),null!=a.data[0].cullAmountType&&""!=a.data[0].cullAmountType&&$("#samplingSet_cullAmountType").val(a.data[0].cullAmountType),$("#samplingSet_cullAmountStart").val(a.data[0].cullAmountStart),$("#samplingSet_cullAmountEnd").val(a.data[0].cullAmountEnd),$("#samplingSet_cullReason").val(a.data[0].cullReason),$("#samplingSet_subjectid_cull").val(a.data[0].cullSubjectId),$("#samplingSetTable").hasClass("dataTable")&&($("#samplingSetTable").DataTable().clear(),$("#samplingSetTable").DataTable().destroy(),$("#samplingSetTable").empty()),"1"==e.data.samplingType&&$("#btn_samplingSet_search").click())):bdoErrorBox("失败",a.resultInfo.statusText)}})}else bdoInfoBox("提示","请填写自定义方法与理由");else bdoInfoBox("提示","请填写抽样名称")}else bdoInfoBox("提示","请选择抽样方式")}),$("#samplingListTable").on("click",'button[name="samplingSetBtn"]',function(){var e=$("#samplingListTable").DataTable().data()[$(this).closest("tr").index()];if("3"!=e.sampleStatus)return b=e.autoId,$("#samplingSet_prev").click(),!1;bdoInfoBox("提示","抽凭已完成！")}),$('#tabs_sample a[href="#tab_samplingSet"]').find(".fa-times-circle").click(function(){return document.getElementById("samplingSetOpen").style.display="none",$(this).parents("ul").find("li").first().find("a").click(),!1}),$("#samplingSet_next").click(function(){if(""==$("#samplingSet_endDate").val()&&""!=$("#samplingSet_startDate").val()&&$("#samplingSet_endDate").val($("#samplingSet_startDate").val()),""==$("#samplingSet_startDate").val()&&""!=$("#samplingSet_endDate").val()&&$("#samplingSet_startDate").val($("#samplingSet_endDate").val()),""==$("#samplingSet_customerId").val())return $("#samplingSet_customerId").focus(),void bdoInfoBox("提示","请选择客户");if(""==$("#samplingSet_startDate").val())return $("#samplingSet_startDate").focus(),void bdoInfoBox("提示","请选择凭证开始日期");if(""==$("#samplingSet_endDate").val())return $("#samplingSet_endDate").focus(),void bdoInfoBox("提示","请选择凭证结束日期");if($("#samplingSet_startDate").val()>$("#samplingSet_endDate").val())return $("#samplingSet_startDate").focus(),void bdoInfoBox("提示","凭证结束日期不能小于凭证开始日期");if($("#samplingSet_startDate").val().substr(0,4)==$("#samplingSet_endDate").val().substr(0,4))if(""!=$("#samplingSet_subjectid").val()){var e=0,t=0;if(""!=$("#samplingSet_amountStart").val()&&(e=parseFloat($("#samplingSet_amountStart").val())),""!=$("#samplingSet_amountEnd").val()&&(t=parseFloat($("#samplingSet_amountEnd").val())),e>t&&""!=$("#samplingSet_amountEnd").val())return $("#samplingSet_amountStart").focus(),void bdoInfoBox("提示","开始金额不能大于结束金额");var a=0,l=0;if(""!=$("#samplingSet_cullAmountStart").val()&&(a=parseFloat($("#samplingSet_cullAmountStart").val())),""!=$("#samplingSet_cullAmountEnd").val()&&(l=parseFloat($("#samplingSet_cullAmountEnd").val())),a>l&&""!=$("#samplingSet_cullAmountEnd").val())return $("#samplingSet_cullAmountStart").focus(),void bdoInfoBox("提示","开始金额不能大于结束金额");if(""==$("#samplingSet_cullReason").val()&&(""!=$("#samplingSet_cullAmountType").val()||""!=$("#samplingSet_cullAmountStart").val()||""!=$("#samplingSet_cullAmountEnd").val()||""!=$("#samplingSet_subjectid_cull").val()))return $("#samplingSet_cullReason").focus(),void bdoInfoBox("提示","请填写剔除原因");if("1"==$("#samplingSet_dataResource").val()){if(y.localParam.urlparam.lockCustomerId=$("#samplingSet_customerId").val(),y.localParam.urlparam.param1=$("#samplingSet_startDate").val().substr(0,4),y.localParam.urlparam.param2=$("#samplingSet_endDate").val().substr(0,4),"0"==$("#samplingSet_dateType").val()?(y.localParam.urlparam.param3=$("#samplingSet_startDate").val(),y.localParam.urlparam.param4=$("#samplingSet_endDate").val(),y.localParam.urlparam.param12="",y.localParam.urlparam.param13=""):"1"==$("#samplingSet_dateType").val()?(y.localParam.urlparam.param3="",y.localParam.urlparam.param4="",y.localParam.urlparam.param12=$("#samplingSet_startDate").val().substr(5,6),y.localParam.urlparam.param13=$("#samplingSet_endDate").val().substr(5,6)):(y.localParam.urlparam.param3="",y.localParam.urlparam.param4="",y.localParam.urlparam.param12="",y.localParam.urlparam.param13=""),y.localParam.urlparam.param5=$("#samplingSet_typeId").val(),y.localParam.urlparam.param6=$("#samplingSet_voucherId").val(),y.localParam.urlparam.param7=$("#samplingSet_summery").val(),y.localParam.urlparam.param8=$("#samplingSet_amountStart").val(),y.localParam.urlparam.param9=$("#samplingSet_amountEnd").val(),y.localParam.urlparam.param10=$("#samplingSet_amountType").val(),y.localParam.urlparam.param11=$("#samplingSet_subjectid").val(),""!=$("#samplingSet_subjectid_cull").val()){var s="'"+$("#samplingSet_subjectid_cull").val().replace(/,/g,"','")+"'";y.localParam.urlparam.param14=s}else y.localParam.urlparam.param14="";y.localParam.urlparam.param15=$("#samplingSet_dataResource").val(),y.localParam.urlparam.param16=$("#samplingSet_cullAmountStart").val(),y.localParam.urlparam.param17=$("#samplingSet_cullAmountEnd").val(),y.localParam.urlparam.param21=$("#samplingSet_assitemid").val(),y.localParam.urlparam.param22=$("#samplingSet_cullAmountType").val(),y.localParam.urlparam.param23=$("#samplingSet_cullReason").val(),y.localParam.urlparam.param24=x.serail,y.localParam.urlparam.lockYyyy=$("#samplingSet_startDate").val().substr(0,4),y.localParam.urlparam.sqlId="FINCP100001",r=H(y.localParam.urlparam)}else"2"==$("#samplingSet_dataResource").val()?(v.localParam.urlparam.lockCustomerId=$("#samplingSet_customerId").val(),v.localParam.urlparam.param2=$("#samplingSet_endDate").val().substr(0,4),v.localParam.urlparam.param3=$("#samplingSet_startDate").val().substr(5,6),v.localParam.urlparam.param4=$("#samplingSet_endDate").val().substr(5,6),v.localParam.urlparam.param8=$("#samplingSet_amountStart").val(),v.localParam.urlparam.param9=$("#samplingSet_amountEnd").val(),v.localParam.urlparam.param10=$("#samplingSet_assitemid").val(),v.localParam.urlparam.param11=$("#samplingSet_subjectid").val(),v.localParam.urlparam.param14=b,v.localParam.urlparam.param15=$("#samplingSet_dataResource").val(),v.localParam.urlparam.sqlId="FA30069",r=H(v.localParam.urlparam)):"3"==$("#samplingSet_dataResource").val()&&(_.localParam.urlparam.lockCustomerId=$("#samplingSet_customerId").val(),_.localParam.urlparam.param2=$("#samplingSet_endDate").val().substr(0,4),_.localParam.urlparam.param3=$("#samplingSet_startDate").val().substr(5,6),_.localParam.urlparam.param4=$("#samplingSet_endDate").val().substr(5,6),_.localParam.urlparam.param8=$("#samplingSet_amountStart").val(),_.localParam.urlparam.param9=$("#samplingSet_amountEnd").val(),_.localParam.urlparam.param11=$("#samplingSet_subjectid").val(),_.localParam.urlparam.param14=b,_.localParam.urlparam.param15=$("#samplingSet_dataResource").val(),_.localParam.urlparam.sqlId="FA30070",r=H(_.localParam.urlparam));p=$("#samplingSet_dataResource").val();bdoInProcessingBox("处理中"),$.ajax({url:"finCenter/sampling.updateSamplingList.json",type:"post",data:{lockCustomerId:$("#samplingSet_customerId").val(),lockYyyy:x.yyyy,param1:b,param2:$("#samplingSet_dataResource").val(),param3:$("#samplingSet_dateType").val(),param4:$("#samplingSet_startDate").val(),param5:$("#samplingSet_endDate").val(),param6:$("#samplingSet_subjectid").val(),param7:$("#samplingSet_typeId").val(),param8:$("#samplingSet_voucherId").val(),param9:$("#samplingSet_summery").val(),param10:$("#samplingSet_amountType").val(),param11:$("#samplingSet_amountStart").val(),param12:$("#samplingSet_amountEnd").val(),param13:$("#samplingSet_assitemid").val(),param14:$("#samplingSet_cullAmountType").val(),param15:$("#samplingSet_cullAmountStart").val(),param16:$("#samplingSet_cullAmountEnd").val(),param17:$("#samplingSet_cullReason").val(),param18:$("#samplingSet_subjectid_cull").val(),param19:x.serail},dataType:"json",success:function(e){e.success?(8==$("#samplingList_method").val()?(k(),$("#modal-samplingSet").modal("hide")):S(),bdoSuccessBox("成功")):bdoErrorBox("失败",e.resultInfo.statusText)}})}else bdoInfoBox("提示","请选择科目");else bdoInfoBox("提示","凭证日期必须是同一年")}),$("#btn_samplingSet_cull").click(function(){var e=[],t=[],a="";if("1"==p){var r=$('input[name="sampleSelect"]:checked');$.each(r,(t,a)=>{e.push(a.value)})}else if("2"==p){r=$('input[name="assItemSelect"]:checked');$.each(r,(a,r)=>{var l=r.value.split(",");e.push(l[0]),t.push(l[1])}),a=t.join(",")}else if("3"==p){r=$('input[name="accountSelect"]:checked');$.each(r,(t,a)=>{e.push(a.value)})}e.length<1?bdoErrorBox("","未选择数据！"):bdoConfirmBox("保存",'<font color="red">确认剔除？<br>剔除后的数据标识为红色</font>',function(){$.ajax({url:"finCenter/sampling.saveSamplingCull.json",type:"post",data:{lockCustomerId:$("#samplingSet_customerId").val(),param1:b,param2:p,param3:$("#samplingSet_startDate").val().substr(0,4),param4:e.join(","),param5:a,param6:x.projectId},dataType:"json",success:function(e){e.success?(bdoSuccessBox("成功",e.resultInfo.statusText),C(D)):bdoErrorBox("失败",e.resultInfo.statusText)}})})}),$("#btn_samplingSet_cancelCull").click(function(){var e=[],t=[],a="";if("1"==p){var r=$('input[name="sampleSelect"]:checked');$.each(r,(t,a)=>{e.push(a.value)})}else if("2"==p){r=$('input[name="assItemSelect"]:checked');$.each(r,(a,r)=>{e.push(r.subjectId),t.push(r.assItemId)}),a=t.join(",")}else if("3"==p){r=$('input[name="accountSelect"]:checked');$.each(r,(t,a)=>{e.push(a.value)})}e.length<1?bdoErrorBox("","未选择数据！"):bdoConfirmBox("保存","确认取消剔除？",function(){$.ajax({url:"finCenter/sampling.saveSamplingCancelCull.json",type:"post",data:{lockCustomerId:$("#samplingSet_customerId").val(),param1:b,param2:p,param3:$("#samplingSet_startDate").val().substr(0,4),param4:e.join(","),param5:a,param6:x.projectId},dataType:"json",success:function(e){e.success?(bdoSuccessBox("成功",e.resultInfo.statusText),C(D)):bdoErrorBox("失败",e.resultInfo.statusText)}})})}),$("#btn_samplingSet_cancelCullAll").click(function(){bdoConfirmBox("保存","确认取消全部剔除？",function(){$.ajax({url:"finCenter/sampling.saveSamplingCancelCullAll.json",type:"post",data:{lockCustomerId:$("#samplingSet_customerId").val(),param1:b,param2:p,param3:$("#samplingSet_startDate").val().substr(0,4),param4:x.projectId},dataType:"json",success:function(e){e.success?(bdoSuccessBox("成功",e.resultInfo.statusText),C(D)):bdoErrorBox("失败",e.resultInfo.statusText)}})})}),$("#modal_samplingCaculation_prev").click(function(){P(),$("#modal_samplingCaculation").modal("hide")}),$("#modal_samplingInterval_prev").click(function(){P(),$("#modal_samplingInterval").modal("hide")}),$("#modal_samplingRange_prev").click(function(){S(),$("#modal_samplingRange").modal("hide")}),$("#samplingCaculation_actualImportant,#samplingCaculation_risk,#samplingCaculation_control,#samplingCaculation_analysis,#samplingCaculation_pledge,#samplingCaculation_variable").change(function(){R(null)}),$("#modal_samplingCaculation_next").click(function(){var e=parseInt($("#samplingCaculation_adjustAmount").val()),t=parseInt($("#samplingCaculation_num").val()),a=parseInt($("#samplingCaculation_calAmount").val()),r=$("#samplingCaculation_calRemark").val();e<=0?bdoInfoBox("提示","样本量必须大于0"):e>t?bdoInfoBox("提示","样本量不能大于剔除后样本总体数量,请修改参数。"):e==a||null!=r&&""!=r?($("#samplingCaculation_calRemark").val(),$.ajax({url:"finCenter/sampling.saveSamplingCalculation.json",type:"post",data:{lockCustomerId:$("#samplingSet_customerId").val(),param1:b,param2:X($("#samplingCaculation_totalAmount").val()),param3:X($("#samplingCaculation_cullAmount").val()),param4:X($("#samplingCaculation_amount").val()),param5:"",param6:X($("#samplingCaculation_actualImportant").val()),param7:$("#samplingCaculation_risk").val(),param8:$("#samplingCaculation_control").val(),param9:$("#samplingCaculation_analysis").val(),param10:$("#samplingCaculation_pledge").val(),param11:$("#samplingCaculation_r").val(),param12:$("#samplingCaculation_initialAmount").val(),param13:$("#samplingCaculation_total").val(),param14:$("#samplingCaculation_variable").val(),param15:X($("#samplingCaculation_adjustAmount").val()),param16:g,param17:x.projectId,param18:X($("#samplingCaculation_calAmount").val()),param19:$("#samplingCaculation_calRemark").val()},dataType:"json",success:function(e){e.success?("3"==$("#samplingList_method").val()?($("#modal_samplingRange").modal("show"),M.localParam.urlparam.param1=b,BdoDataTable("samplingRangeTable",M)):k(),$("#modal_samplingCaculation").modal("hide")):bdoErrorBox("失败",e.resultInfo.statusText)}})):bdoInfoBox("提示","审计确认样本量与考虑抽样方法后调整的样本量不一致,请填写备注。")}),$("#modal_samplingInterval_next").click(function(){if(""!=$("#samplingInterval_adjustAmount").val()){var e=parseInt($("#samplingInterval_adjustAmount").val()),t=parseInt($("#samplingInterval_num").val());e<=0?bdoInfoBox("提示","样本量必须大于0"):e>t?bdoInfoBox("提示","样本量不能大于剔除后样本总体数量"):$.ajax({url:"finCenter/sampling.saveSamplingCalculation.json",type:"post",data:{lockCustomerId:$("#samplingSet_customerId").val(),param1:b,param2:X($("#samplingInterval_totalAmount").val()),param3:X($("#samplingInterval_cullAmount").val()),param4:X($("#samplingInterval_amount").val()),param5:"",param6:"",param7:"",param8:"",param9:"",param10:"",param11:"",param12:"",param13:"",param14:"",param15:$("#samplingInterval_adjustAmount").val(),param16:g,param17:x.projectId},dataType:"json",success:function(e){e.success?(k(),$("#modal_samplingInterval").modal("hide")):bdoErrorBox("失败",e.resultInfo.statusText)}})}else bdoInfoBox("提示","样本量不能为空")}),$("#modal_samplistTest_prev").click(function(){$("#modal_samplistTest").modal("hide"),"7"==$("#samplingList_method").val()?P():"8"==$("#samplingList_method").val()?P():S()}),$("#modal_samplistTest_test").click(function(){bdoConfirmBox("抽凭","确认抽凭？",function(){N()})});var E={localParam:{tabNum:!0,url:"finCenter/General.findSamplingTestData.json",urlparam:{sqlId:"FINCP100007",menuId:window.sys_menuId,param1:$("#samplingSet_startDate").val(),param2:$("#samplingSet_endDate").val(),param3:"",param4:"",param5:$("#samplingSet_typeId").val(),param6:$("#samplingSet_voucherId").val(),param7:$("#samplingSet_summery").val(),param8:$("#samplingSet_amountStart").val(),param9:$("#samplingSet_amountEnd").val(),param10:"",param11:$("#samplingSet_subjectid").val(),param12:"",param13:"",param14:b,param15:$("#samplingSet_dataResource").val(),param16:$("#dgSamplingInfo_sampleMethod").val(),param21:$("#samplingSet_assitemid").val(),lockCustomerId:x.customerId,lockYyyy:x.yyyy,lockProjectId:x.projectId}},tableParam:{select:!0,lengthChange:!1,ordering:!1,serverSide:!0,scrollX:!0,scrollY:!1,autoWidth:!1,pageLength:30,createdRow(e,t,r){a!=t.oldVoucherId&&(m=m==u?"#FF8800":u,a=t.oldVoucherId),$(e).children("td").eq(2).css({"background-color":m}),$(e).children("td").eq(3).css({"background-color":m}),$(e).children("td").eq(4).css({"background-color":m})},columnDefs:[{targets:1,className:"text-left",title:"凭证日期",name:"vchDate",data:"vchDate",width:"80px",filter:{type:"date"}},{targets:2,className:"text-left",title:"字",name:"typeId",data:"typeId",width:"20px"},{targets:3,className:"text-left",title:"号",name:"oldVoucherId",data:"oldVoucherId",width:"10px"},{targets:4,className:"text-left",title:"摘要",name:"summary",data:"summary",width:"200px"},{targets:5,className:"text-left",title:"科目编号",name:"subjectId",data:"subjectId",width:"60px"},{targets:6,className:"text-left",title:"科目全路径",name:"subjectFullName",data:"subjectFullName",width:"200px"},{targets:7,className:"text-left",title:"核算类型",name:"assTotalName",data:"assTotalName",width:"200px"},{targets:8,className:"text-left",title:"对方科目",name:"oppositeAccountLast",data:"oppositeAccountLast",width:"200px",render(e,t,a,r){if(null!=e){return'<div title="'+e+'" data-toggle="tooltip" style="text-overflow: ellipsis; white-space: nowrap;overflow: hidden;width: 200px;">'+e+"</div>"}return e}},{targets:9,className:"text-right",title:"借方发生金额",name:"debitValue",data:"debitValue",width:"100px",render:function(e,t,a,r){return formatMoney(e)}},{targets:10,className:"text-right",title:"贷方发生金额",name:"crebitValue",data:"crebitValue",width:"100px",render:function(e,t,a,r){return formatMoney(e)}}]}},A={localParam:{tabNum:!0,url:"finCenter/General.findSamplingTestData.json",urlparam:{sqlId:"FINCP100007",menuId:window.sys_menuId,param1:$("#samplingSet_startDate").val(),param2:$("#samplingSet_endDate").val(),param3:"",param4:"",param5:$("#samplingSet_typeId").val(),param6:$("#samplingSet_voucherId").val(),param7:$("#samplingSet_summery").val(),param8:$("#samplingSet_amountStart").val(),param9:$("#samplingSet_amountEnd").val(),param10:"",param11:$("#samplingSet_subjectid").val(),param12:"",param13:"",param14:b,param15:$("#samplingSet_dataResource").val(),param16:$("#dgSamplingInfo_sampleMethod").val(),param21:$("#samplingSet_assitemid").val(),lockCustomerId:x.customerId,lockYyyy:x.yyyy,lockProjectId:x.projectId}},tableParam:{select:!0,lengthChange:!1,ordering:!1,serverSide:!0,scrollX:!0,scrollY:!1,autoWidth:!1,pageLength:30,createdRow(e,t,r){a!=t.oldVoucherId&&(m=m==u?"#FF8800":u,a=t.oldVoucherId),$(e).children("td").eq(2).css({"background-color":m}),$(e).children("td").eq(3).css({"background-color":m}),$(e).children("td").eq(4).css({"background-color":m})},columnDefs:[{targets:1,className:"text-left",title:"凭证日期",name:"vchDate",data:"vchDate",width:"80px",filter:{type:"date"}},{targets:2,className:"text-left",title:"字",name:"typeId",data:"typeId",width:"20px"},{targets:3,className:"text-left",title:"号",name:"oldVoucherId",data:"oldVoucherId",width:"10px"},{targets:4,className:"text-left",title:"摘要",name:"summary",data:"summary",width:"200px"},{targets:5,className:"text-left",title:"科目编号",name:"subjectId",data:"subjectId",width:"60px"},{targets:6,className:"text-left",title:"科目全路径",name:"subjectFullName",data:"subjectFullName",width:"200px"},{targets:7,className:"text-right",title:"借方发生金额",name:"debitValue",data:"debitValue",width:"100px",render:function(e,t,a,r){return formatMoney(e)}},{targets:8,className:"text-right",title:"贷方发生金额",name:"crebitValue",data:"crebitValue",width:"100px",render:function(e,t,a,r){return formatMoney(e)}}]}},O=(window.sys_menuId,$("#samplingSet_startDate").val(),$("#samplingSet_endDate").val(),$("#samplingSet_typeId").val(),$("#samplingSet_voucherId").val(),$("#samplingSet_summery").val(),$("#samplingSet_amountStart").val(),$("#samplingSet_amountEnd").val(),$("#samplingSet_subjectid").val(),$("#samplingSet_dataResource").val(),$("#dgSamplingInfo_sampleMethod").val(),$("#samplingSet_assitemid").val(),x.customerId,x.yyyy,x.projectId,{localParam:{tabNum:!0,url:"finCenter/General.findSamplingTestData.json",urlparam:{sqlId:"FA30069",menuId:window.sys_menuId,param1:"",param2:"",param3:"",param4:"",param5:"",param6:"",param7:"",param8:$("#samplingSet_amountStart").val(),param9:$("#samplingSet_amountEnd").val(),param10:"",param11:$("#samplingSet_subjectid").val(),param14:b,param15:$("#samplingSet_dataResource").val(),lockCustomerId:x.customerId,lockYyyy:x.yyyy,lockProjectId:x.projectId}},tableParam:{select:!0,lengthChange:!0,ordering:!1,serverSide:!0,pageLength:30,columnDefs:[{targets:2,className:"text-left",title:"科目编号",name:"subjectId",data:"subjectId",width:"150px"},{targets:3,className:"text-left",title:"核算项目编号",name:"assItemId",data:"assItemId",width:"200px"},{targets:4,className:"text-left",title:"核算项目名称",name:"fullName",data:"fullName",width:"250px"},{targets:5,className:"text-center",title:"币种",name:"currency",data:"currency",width:"30px"},{targets:6,className:"text-center",title:"方向",name:"qcWay",data:"qcWay",width:"30px"},{targets:7,className:"text-right",title:"期初余额",name:"remainF",data:"remainF",width:"100px",render:function(e,t,a,r){return formatMoney(e)}},{targets:8,className:"text-right",title:"借方发生额",name:"debitOccF",data:"debitOccF",width:"100px",render:function(e,t,a,r){return formatMoney(e)}},{targets:9,className:"text-right",title:"贷方发生额",name:"creditOccF",data:"creditOccF",width:"100px",render:function(e,t,a,r){return formatMoney(e)}},{targets:10,className:"text-right",title:"期末余额",name:"balanceF",data:"balanceF",width:"100px",render:function(e,t,a,r){return formatMoney(e)}}]}}),B={localParam:{tabNum:!0,url:"finCenter/General.findSamplingTestData.json",urlparam:{sqlId:"FA30070",menuId:window.sys_menuId,param1:"",param2:"",param3:"",param4:"",param5:"",param6:"",param7:"",param8:$("#samplingSet_amountStart").val(),param9:$("#samplingSet_amountEnd").val(),param10:"",param11:$("#samplingSet_subjectid").val(),param14:b,param15:$("#samplingSet_dataResource").val(),lockCustomerId:x.customerId,lockYyyy:x.yyyy,lockProjectId:x.projectId}},tableParam:{select:!0,lengthChange:!0,ordering:!1,serverSide:!0,pageLength:30,columnDefs:[{targets:2,className:"text-left",title:"科目编号",name:"subjectId",data:"subjectId",width:"150px"},{targets:3,className:"text-left",title:"科目名称",name:"fullName",data:"fullName",width:"250px"},{targets:4,className:"text-center",title:"币种",name:"currency",data:"currency",width:"30px"},{targets:5,className:"text-center",title:"方向",name:"qcWay",data:"qcWay",width:"30px"},{targets:6,className:"text-right",title:"期初余额",name:"remainF",data:"remainF",width:"100px",render:function(e,t,a,r){return formatMoney(e)}},{targets:7,className:"text-right",title:"借方发生额",name:"debitOccF",data:"debitOccF",width:"100px",render:function(e,t,a,r){return formatMoney(e)}},{targets:8,className:"text-right",title:"贷方发生额",name:"creditOccF",data:"creditOccF",width:"100px",render:function(e,t,a,r){return formatMoney(e)}},{targets:9,className:"text-right",title:"期末余额",name:"balanceF",data:"balanceF",width:"100px",render:function(e,t,a,r){return formatMoney(e)}}]}},M={localParam:{tabNum:!1,url:"finCenter/Sampling.querySamplingRange.json",urlparam:{sqlId:"FA30077",menuId:window.sys_menuId,param1:b,lockCustomerId:x.customerId,lockYyyy:x.yyyy,param2:x.projectId}},tableParam:{pageLength:1e3,dom:'<"row"<"col-sm-12"tr>>',ordering:!1,lengthChange:!1,select:!1,scrollY:!1,createdRow:function(e,t,a){0==a&&(c=0),""!=t.samplingCount&&null!=t.samplingCount&&(c+=parseInt(t.samplingCount));var r=$("#samplingCaculation_adjustAmount").val();$("#samplingRangeMessage").html("第三步:样本量计算 （审计样本确认量："+r+" 抽凭数："+c+" 差异："+(r-c)+"）")},drawCallback(){},columns:[{title:"金额区间起",className:"text-right",width:"150px",data:"startAmount",render:function(e,t,a,r){return t="disabled",null!=e?'<input class="form-control" type="text" name="startAmount" value="'+e+'" style="text-align:right" '+t+">":'<input class="form-control" type="text" name="startAmount" value="" style="text-align:right" disabled>'}},{title:"金额区间止",className:"text-right",width:"150px",data:"endAmount",render:function(e,t,a,r){return t="disabled",null!=e?'<input class="form-control" type="text" name="endAmount" value="'+e+'" style="text-align:right" '+t+">":'<input class="form-control" type="text" name="endAmount" value="" style="text-align:right" disabled>'}},{title:"总数",className:"text-right",width:"150px",data:"totalCount",render:function(e,t,a,r){return t="disabled",null!=e?'<input class="form-control" type="text" name="totalCount" value="'+e+'" style="text-align:right" '+t+">":'<input class="form-control" type="text" name="totalCount" value="" style="text-align:right" disabled>'}},{title:"抽样数",className:"text-right",width:"150px",data:"samplingCount",render:function(e,t,a,r){return null!=e?'<input class="form-control" type="text" name="samplingCount" value="'+e+'" style="text-align:right" '+t+">":'<input class="form-control" type="text" name="samplingCount" value="" style="text-align:right" '+t+">"}},{title:"id",className:"hidden",width:"50px",data:"autoId",render:function(e,t,a,r){return t="disabled",null!=e?'<input class="form-control" type="text" name="autoId" value="'+e+'" style="text-align:right" '+t+">":'<input class="form-control" type="text" name="autoId" value="" style="text-align:right" disabled>'}}]}};$("#btn_samplingRange_set").click(function(){U.localParam.urlparam.param1=b,BdoDataTable("samplingRangeSetTable",U),$("#modal_samplingRangeSet").modal("show")});var U={localParam:{tabNum:!1,url:"finCenter/Sampling.querySamplingRangeSet.json",urlparam:{sqlId:"FA30077",menuId:window.sys_menuId,param1:b,lockCustomerId:x.customerId,param2:x.projectId}},tableParam:{pageLength:100,dom:'<"row"<"col-sm-12"tr>>',ordering:!1,lengthChange:!1,select:!1,scrollY:!1,bdolxLoader:!0,columns:[{targets:1,title:"处理",width:"50px",className:"text-center",render:function(e,t,a,r){var l="",s='<input class="form-control" type="hidden" name="jnautoId" value="'+a.autoId+'">';return a.showDelete&&(l='style="visibility:hidden" disabled'),s+='<button class="btn btn-xs btn-success" type="button" name="jnadjust_plus_row" data-placement="top" title="添加一行" ><i class="fa fa-plus""></i></button>&nbsp;',s+='<button class="btn btn-xs btn-danger" type="button" name="jnDelete" data-placement="top" title="删除" data-toggle="tooltip " '+l+'><i class="fa fa-times"></i></button>'}},{targets:2,title:"金额区间起",className:"text-right",width:"150px",data:"startAmount",render:function(e,t,a,r){return null!=e?'<input class="form-control" type="text" name="startAmount" value="'+e+'" style="text-align:right" '+t+">":'<input class="form-control" type="text" name="startAmount" value="" style="text-align:right" '+t+">"}},{targets:3,title:"金额区间止",className:"text-right",width:"150px",data:"endAmount",render:function(e,t,a,r){return null!=e?'<input class="form-control" type="text" name="endAmount" value="'+e+'" style="text-align:right" '+t+">":'<input class="form-control" type="text" name="endAmount" value="" style="text-align:right" '+t+">"}}]}};$("#samplingRangeSetContent").on("blur",'[name="endAmount"]',function(e){$(this).closest("tr").next().find('[name="startAmount"]').val($(this).val())}),$("#samplingRangeSetContent").on("click",'button[name="jnadjust_plus_row"]',function(e){window.editId=0;var t=$(this).closest("tr").find("[name=endAmount]").val();$(this).closest("table").DataTable().row.add({startAmount:t,endAmount:"",totalCount:"",samplingCount:"",startName:"",endName:""}).draw()}),$("#samplingRangeSetContent").on("click",'button[name="jnDelete"]',function(e){var t=$(this).closest("table").attr("id"),a=$("#"+t),r=$(this),l=a.DataTable().row([r.closest("tr").index()]);a.DataTable().data()[r.closest("tr").index()];l.remove().draw(),a.find("[name=jnadjust_plus_row]").eq(0).css("visibility","visible").prop("disabled",!1)}),$("#modal_samplingRangeSet_sure").click(function(){var e=[],t=$("#samplingRangeSetTable").DataTable().data().length,a=1,r="";if($("#samplingRangeSetTable").find("tbody tr").each(function(){var l=$(this).find('[name="startAmount"]').val(),s=$(this).find('[name="endAmount"]').val();return""==l&&1!=a?(r="金额不能为空",!1):""==s&&a!=t?(r="金额不能为空",!1):parseFloat(l)>=parseFloat(s)?(r="开始金额不能大于等于结束金额",!1):(e.push({startAmount:l,endAmount:s}),void(a+=1))}),""!=r)return bdoInfoBox("提示",r),!1;bdoConfirmBox("保存","确认保存？",function(){$.ajax({url:"finCenter/sampling.saveSamplingRangeSet.json",type:"post",data:{lockCustomerId:x.customerId,param1:b,param2:JSON.stringify(e),param3:x.projectId},dataType:"json",success:function(e){e.success?(bdoSuccessBox("成功",e.resultInfo.statusText),M.localParam.urlparam.param1=b,BdoDataTable("samplingRangeTable",M)):bdoErrorBox("失败",e.resultInfo.statusText),$("#modal_samplingRangeSet").modal("hide")}})})}),$("#samplingRangeTable").on("blur",'[name="samplingCount"]',function(e){!function(){var e=0;$("#samplingRangeTable").find("tbody tr").each(function(){var t=$(this).find('[name="samplingCount"]').val();""!=t&&(e+=parseInt(t))});var t=$("#samplingCaculation_adjustAmount").val();$("#samplingRangeMessage").html("第三步:样本量计算 （审计样本确认量："+t+" 抽凭数："+e+" 差异："+(t-e)+"）")}()}),$("#modal_samplingRange_next").click(function(){var e=[],t=($("#samplingRangeTable").DataTable().data().length,""),a=0;return $("#samplingRangeTable").find("tbody tr").each(function(){var r=$(this).find('[name="startAmount"]').val(),l=$(this).find('[name="endAmount"]').val(),s=$(this).find('[name="totalCount"]').val(),o=$(this).find('[name="samplingCount"]').val(),n=$(this).find('[name="autoId"]').val();if(""!=o){if(parseInt(o)>parseInt(s))return t="抽凭数不能大于总数",!1;a+=parseInt(o)}e.push({startAmount:r,endAmount:l,totalCount:s,samplingCount:o,autoId:n}),1}),""!=t?(bdoInfoBox("提示",t),!1):0==a?(bdoInfoBox("提示","抽凭数不能为0"),!1):a!=$("#samplingCaculation_adjustAmount").val()?(bdoInfoBox("提示","抽凭数必须等于审计确认样本量"),!1):void $.ajax({url:"finCenter/sampling.saveSamplingRange.json",type:"post",data:{lockCustomerId:x.customerId,param1:b,param2:JSON.stringify(e),param3:x.projectId},dataType:"json",success:function(e){e.success?(k(),$("#modal_samplingRange").modal("hide")):bdoErrorBox("失败",e.resultInfo.statusText)}})}),$("#modal_samplistTest_statistics").click(function(){samplingStatisticsTab("tabs_sample",x.customerId,b,"1",e)}),$("#modal_samplistResult_statistics").click(function(){samplingStatisticsTab("tabs_sampleResult",x.customerId,b,"1",e)}),$("#samplingListTable").on("click",'button[name="samplingResultBtn"]',function(){J();var t=$("#samplingListTable").DataTable().data()[$(this).closest("tr").index()];"3"==t.sampleStatus?(SamplingResult({region:"#samplistResultPage",data:e.data,samplingId:t.autoId}),$("#modal_samplistResult1").modal("show")):bdoInfoBox("提示","抽凭未完成！")}),$("#samplingListTable").on("click",'button[name="samplingDeleteBtn"]',function(){var e=$("#samplingListTable").DataTable().data()[$(this).closest("tr").index()],t='<div style="height: 50px;overflow-y: auto"><font color="red">';t+="1.删除该条抽凭相关的所有数据<br>",t="此次删除将会执行以下操作 <br>"+(t+="2.从抽凭结果中删除此次抽凭抽中的所有凭证</font></div>")+"<br>是否确定删除？",bdoConfirmBox("删除",t,function(){bdoInProcessingBox("处理中"),$.ajax({url:"finCenter/sampling.deleteSamplingList.json",type:"post",data:{lockCustomerId:e.customerId,param1:e.autoId,param2:e.projectId},dataType:"json",success:function(e){e.success?(bdoSuccessBox("成功",e.resultInfo.statusText),$("#samplingListTable").DataTable().ajax.reload(null,!1)):bdoErrorBox("失败",e.resultInfo.statusText)}})})}),$("#modal_samplistTest_sure").click(function(){bdoConfirmBox("保存","确认保存结果？",function(){bdoInProcessingBox("处理中"),$.ajax({url:"finCenter/sampling.saveSamplingResult.json",type:"post",data:{lockCustomerId:x.customerId,lockYyyy:x.yyyy,param1:b},dataType:"json",success:function(e){e.success?(bdoSuccessBox("成功",e.resultInfo.statusText),$("#samplingListTable").DataTable().ajax.reload(null,!1),$("#dgSamplingInfoTable").DataTable().ajax.reload(null,!1),$("#modal_samplistTest").modal("hide")):bdoErrorBox("失败",e.resultInfo.statusText)}})})});var F={localParam:{tabNum:!0,url:"cpBase/General.query.json",urlparam:{sqlId:"DG10002",menuId:window.sys_menuId,param1:x.projectId,param2:"",param3:$("#dgSamplingInfo_startDate").val(),param4:$("#dgSamplingInfo_endDate").val(),param5:$("#dgSamplingInfo_sampleMethod").val(),param6:$("#dgSamplingInfo_voucherId").val(),param7:$("#dgSamplingInfo_sampleUser").val(),param11:$("#dgSamplingInfo_subjectid").val(),lockCustomerId:x.customerId}},tableParam:{select:!0,scrollX:!0,scrollY:!1,lengthChange:!1,ordering:!1,serverSide:!0,autoWidth:!1,pageLength:30,createdRow(e,t,a){""!=t.auditResultName&&null!=t.auditResultName&&$(e).css({color:"red"})},columnDefs:[{targets:1,orderable:!1,className:"text-center",title:"处理",width:"60px",render:function(e,t,a,r){var l="";return l+='<button class="btn btn-xs btn-success" type="button" name="samplingInfoFileBtn" data-placement="top" title="编辑" data-toggle="tooltip"><i class="fa fa-pencil"></i></button>&nbsp;'}},{targets:2,orderable:!1,className:"text-left",title:"凭证编号",name:"oldVoucherId",data:"oldVoucherId",width:"60px"},{targets:3,orderable:!1,className:"text-left",title:"凭证日期",name:"vchDate",data:"vchDate",width:"100px"},{targets:4,orderable:!0,className:"text-left",title:"抽凭方式",name:"sampleMethod",data:"sampleMethod",width:"150px"},{targets:5,orderable:!1,className:"text-left",title:"抽凭人",name:"sampleUserName",data:"sampleUserName",width:"60px"},{targets:6,orderable:!1,className:"text-left",title:"科目编号",name:"subjectId",data:"subjectId",width:"60px"},{targets:7,orderable:!1,className:"text-left",title:"科目名称",name:"subjectFullName",data:"subjectFullName",width:"150px"},{targets:8,className:"text-left",title:"核算类型",name:"assTotalName",data:"assTotalName",width:"200px"},{targets:9,className:"text-left",title:"对方科目",name:"oppositeAccountLast",data:"oppositeAccountLast",width:"200px",render(e,t,a,r){if(null!=e){return'<div title="'+e+'" data-toggle="tooltip" style="text-overflow: ellipsis; white-space: nowrap;overflow: hidden;width: 200px;">'+e+"</div>"}return e}},{targets:10,className:"text-right",title:"借方发生金额",name:"debitValue",data:"debitValue",width:"100px",render:function(e,t,a,r){return formatMoney(e)}},{targets:11,className:"text-right",title:"贷方发生金额",name:"crebitValue",data:"crebitValue",width:"100px",render:function(e,t,a,r){return formatMoney(e)}},{targets:12,orderable:!1,className:"text-left",title:"审计结论",name:"auditResultName",data:"auditResultName",width:"200px",render(e,t,a,r){if(null!=e){return'<div title="'+e+'" data-toggle="tooltip" style="text-overflow: ellipsis; white-space: nowrap;overflow: hidden;width: 200px;">'+e+"</div>"}return e}},{targets:13,orderable:!1,className:"text-left",title:"附件索引号",name:"fileIndexId",data:"fileIndexId",width:"200px",render(e,t,a,r){if(null!=e){return'<div title="'+e+'" data-toggle="tooltip" style="text-overflow: ellipsis; white-space: nowrap;overflow: hidden;width: 200px;">'+e+"</div>"}return e}},{targets:14,orderable:!1,className:"text-left",title:"备注",name:"remark",data:"remark",width:"200px",render(e,t,a,r){if(null!=e){return'<div title="'+e+'" data-toggle="tooltip" style="text-overflow: ellipsis; white-space: nowrap;overflow: hidden;width: 200px;">'+e+"</div>"}return e}},{targets:15,orderable:!0,className:"text-left",title:"原始凭证内容完整",name:"contentComplete",data:"contentComplete",width:"110px"},{targets:16,orderable:!0,className:"text-left",title:"有授权批准",name:"authorize",data:"authorize",width:"100px"},{targets:17,orderable:!0,className:"text-left",title:"账务处理正确",name:"handleCorrect",data:"handleCorrect",width:"100px"},{targets:18,orderable:!0,className:"text-left",title:"账证的内容相符",name:"contentMatch",data:"contentMatch",width:"100px"},{targets:19,orderable:!0,className:"text-left",title:"账证的金额相符",name:"amountMatch",data:"amountMatch",width:"100px"},{targets:20,orderable:!0,className:"text-left",title:"截止测试正确",name:"cutoffCorrect",data:"cutoffCorrect",width:"100px"},{targets:21,orderable:!0,className:"text-left",title:"核对内容6",name:"customizeResult1",data:"customizeResult1",width:"100px"},{targets:22,orderable:!0,className:"text-left",title:"核对内容7",name:"customizeResult2",data:"customizeResult2",width:"100px"},{targets:23,orderable:!0,className:"text-left",title:"核对内容8",name:"customizeResult3",data:"customizeResult3",width:"100px"},{targets:24,orderable:!0,className:"text-left",title:"核对内容9",name:"customizeResult4",data:"customizeResult4",width:"100px"},{targets:25,orderable:!0,className:"text-left",title:"抽凭名称",name:"sampleName",data:"sampleName",width:"100px",render:function(e,t,a,r){var l="";return l+='<a href="#" name="showSamplingResult">'+e+"</a>"}},{targets:26,orderable:!0,className:"text-left",title:"关联抽凭名称",name:"relateSampleName",data:"relateSampleName",width:"100px"}]}};$("#btn_dgSamplingInfo_search").click(function(){""==$("#dgSamplingInfo_endDate").val()&&""!=$("#dgSamplingInfo_startDate").val()&&$("#dgSamplingInfo_endDate").val($("#dgSamplingInfo_startDate").val()),""==$("#dgSamplingInfo_startDate").val()&&""!=$("#dgSamplingInfo_endDate").val()&&$("#dgSamplingInfo_startDate").val($("#dgSamplingInfo_endDate").val()),""!=$("#dgSamplingInfo_startDate").val()?""!=$("#dgSamplingInfo_endDate").val()?$("#dgSamplingInfo_startDate").val()>$("#dgSamplingInfo_endDate").val()?bdoInfoBox("提示","凭证结束日期不能小于凭证开始日期"):(F.localParam.urlparam.param2=$("#dgSamplingInfo_startDate").val().substr(0,4),F.localParam.urlparam.param14=$("#dgSamplingInfo_endDate").val().substr(0,4),"0"==$("#dgSamplingInfo_dateType").val()?(F.localParam.urlparam.param3=$("#dgSamplingInfo_startDate").val(),F.localParam.urlparam.param4=$("#dgSamplingInfo_endDate").val(),F.localParam.urlparam.param12="",F.localParam.urlparam.param13=""):"1"==$("#dgSamplingInfo_dateType").val()?(F.localParam.urlparam.param3="",F.localParam.urlparam.param4="",F.localParam.urlparam.param12=$("#dgSamplingInfo_startDate").val().substr(5,6),F.localParam.urlparam.param13=$("#dgSamplingInfo_endDate").val().substr(5,6)):(F.localParam.urlparam.param3="",F.localParam.urlparam.param4="",F.localParam.urlparam.param12="",F.localParam.urlparam.param13=""),F.localParam.urlparam.param5=$("#dgSamplingInfo_sampleMethod").val(),F.localParam.urlparam.param6=$("#dgSamplingInfo_voucherId").val(),F.localParam.urlparam.param7=$("#dgSamplingInfo_sampleUser").val(),F.localParam.urlparam.param11=$("#dgSamplingInfo_subjectid").val(),F.localParam.urlparam.param16=$("#dgSamplingInfo_sampleName").val(),F.localParam.urlparam.param17="1","是"==$("#dgSamplingInfo_isRelated").val()?F.localParam.urlparam.param19="1":F.localParam.urlparam.param19="",BdoDataTable("dgSamplingInfoTable",F),$("#dgSamplingInfoTable tbody").on("dblclick","tr",function(){$("#dgSamplingInfoTable").DataTable().row(this).data();J()})):bdoInfoBox("提示","请选择凭证结束日期"):bdoInfoBox("提示","请选择凭证开始日期")}),$("#btn_dgSamplingInfo_search").click(),$("#dgSamplingInfoTable").on("click",'a[name="showSamplingResult"]',function(){J();var t=$("#dgSamplingInfoTable").DataTable().data()[$(this).closest("tr").index()];SamplingResult({region:"#samplistResultPage",data:e.data,samplingId:t.samplingId}),$("#modal_samplistResult1").modal("show")}),$("#dgSamplingInfoTable").on("click",'button[name="samplingInfoEditBtn"]',function(){var e=$("#dgSamplingInfoTable").DataTable().data()[$(this).closest("tr").index()];$("#samplingInfoEdit_auditResult").val(e.auditResult),$("#samplingInfoEdit_remark").val(e.remark),"否"==e.contentComplete?$("[name='contentComplete'][data-result=0]").click():$("[name='contentComplete'][data-result=1]").click(),"否"==e.authorize?$("[name='authorize'][data-result=0]").click():$("[name='authorize'][data-result=1]").click(),"否"==e.handleCorrect?$("[name='handleCorrect'][data-result=0]").click():$("[name='handleCorrect'][data-result=1]").click(),"否"==e.contentMatch?$("[name='contentMatch'][data-result=0]").click():$("[name='contentMatch'][data-result=1]").click(),"否"==e.amountMatch?$("[name='amountMatch'][data-result=0]").click():$("[name='amountMatch'][data-result=1]").click(),"否"==e.cutoffCorrect?$("[name='cutoffCorrect'][data-result=0]").click():$("[name='cutoffCorrect'][data-result=1]").click(),$("#modal-samplingInfoEdit").modal("show"),s=e.autoId}),$("#samplingInfoEdit_submit").click(function(){var e=Y.localParam.urlparam.param2,t=Y.localParam.urlparam.lockYyyy,a=$("#samplingInfoEdit_auditResult").val(),r=$("#samplingInfoEdit_remark").val(),l=$("#samplingInfoEdit_relateSampling").val();"3"!=a||null!=r&&""!=r?"2"!=a||null!=l&&""!=l?bdoConfirmBox("保存","确认保存？",function(){$.ajax({url:"dgCenter/DgBBReport.saveSamplingInfoRemark.json",type:"post",data:{lockCustomerId:x.customerId,param1:x.projectId,param2:s,param3:$("#samplingInfoEdit_auditResult").val(),param4:$("#samplingInfoEdit_remark").val(),param5:$("[name='contentComplete']:checked").attr("data-result"),param6:$("[name='authorize']:checked").attr("data-result"),param7:$("[name='handleCorrect']:checked").attr("data-result"),param8:$("[name='contentMatch']:checked").attr("data-result"),param9:$("[name='amountMatch']:checked").attr("data-result"),param10:$("[name='cutoffCorrect']:checked").attr("data-result"),param11:e,param12:t,param13:$("#samplingInfoEdit_customizeResultName1").val(),param14:$("#samplingInfoEdit_customizeResultName2").val(),param15:$("#samplingInfoEdit_customizeResultName3").val(),param16:$("#samplingInfoEdit_customizeResultName4").val(),param17:$("[name='customizeResult1']:checked").attr("data-result"),param18:$("[name='customizeResult2']:checked").attr("data-result"),param19:$("[name='customizeResult3']:checked").attr("data-result"),param20:$("[name='customizeResult4']:checked").attr("data-result"),param21:""},dataType:"json",success:function(e){e.success?(bdoSuccessBox("成功",e.resultInfo.statusText),$("#dgSamplingInfoTable").DataTable().ajax.reload(null,!1),$("#modal-samplingFileUpload").modal("hide")):bdoErrorBox("失败",e.resultInfo.statusText)}})}):bdoInfoBox("提示","请添加关联抽凭"):bdoInfoBox("提示","请填写备注")}),$("#btn_dgSamplingInfo_statistics").click(function(){samplingStatisticsTab("navTabSampling",x.customerId,"","2",e)}),$("#btn_dgSamplingInfo_export").on("click",function(){exportExcelFin(this,"抽凭结果",F,"dgSamplingInfoTable")}),$("#dgSamplingInfoTable").on("click",'button[name="samplingInfoFileBtn"]',function(){var e=$("#dgSamplingInfoTable").DataTable().data()[$(this).closest("tr").index()];$.ajax({type:"post",url:"finCenter/sampling.querySamplingPermissions.json",data:{param1:""},dataType:"json",success(e){e.success?(d=!0,$("#samplingInfoEdit_submit").removeAttr("display")):(d=!1,$("#samplingInfoEdit_submit").css("display","none"))}}),$("#modal-samplingFileUpload").modal("show"),s=e.autoId,V.attachTableCfg.localParam.urlparam.param5="",V.attachTableCfg.localParam.urlparam.param6="2",V.attachTableCfg.tableParam.columnDefs[2].title="索引号",V.attachTableCfg.tableParam.columnDefs[2].sTitle="索引号",V.attachTableCfg.localParam.urlparam.param7="",V.attachTableCfg.localParam.urlparam.param8=e.oldVoucherId,V.attachTableCfg.localParam.urlparam.param9=e.vchDate,BdoDataTable("samplingFileUploadTable",V.attachTableCfg),$("#upload_samplingFileBtn").css("display","none"),$("#samplingInfoEdit_auditResult").val(e.auditResult),$("#samplingInfoEdit_remark").val(e.remark),$("#samplingInfoEdit_customizeResultName1").val(e.customizeResultName1),$("#samplingInfoEdit_customizeResultName2").val(e.customizeResultName2),$("#samplingInfoEdit_customizeResultName3").val(e.customizeResultName3),$("#samplingInfoEdit_customizeResultName4").val(e.customizeResultName4),"否"==e.contentComplete?$("[name='contentComplete'][data-result=0]").click():$("[name='contentComplete'][data-result=1]").click(),"否"==e.authorize?$("[name='authorize'][data-result=0]").click():$("[name='authorize'][data-result=1]").click(),"否"==e.handleCorrect?$("[name='handleCorrect'][data-result=0]").click():$("[name='handleCorrect'][data-result=1]").click(),"否"==e.contentMatch?$("[name='contentMatch'][data-result=0]").click():$("[name='contentMatch'][data-result=1]").click(),"否"==e.amountMatch?$("[name='amountMatch'][data-result=0]").click():$("[name='amountMatch'][data-result=1]").click(),"否"==e.cutoffCorrect?$("[name='cutoffCorrect'][data-result=0]").click():$("[name='cutoffCorrect'][data-result=1]").click(),"否"==e.customizeResult1?$("[name='customizeResult1'][data-result=0]").click():"是"==e.customizeResult1?$("[name='customizeResult1'][data-result=1]").click():($("[name='customizeResult1'][data-result=0]").removeAttr("checked"),$("[name='customizeResult1'][data-result=1]").removeAttr("checked")),"否"==e.customizeResult2?$("[name='customizeResult2'][data-result=0]").click():"是"==e.customizeResult2?$("[name='customizeResult2'][data-result=1]").click():($("[name='customizeResult2'][data-result=0]").removeAttr("checked"),$("[name='customizeResult2'][data-result=1]").removeAttr("checked")),"否"==e.customizeResult3?$("[name='customizeResult3'][data-result=0]").click():"是"==e.customizeResult3?$("[name='customizeResult3'][data-result=1]").click():($("[name='customizeResult3'][data-result=0]").removeAttr("checked"),$("[name='customizeResult3'][data-result=1]").removeAttr("checked")),"否"==e.customizeResult4?$("[name='customizeResult4'][data-result=0]").click():"是"==e.customizeResult4?$("[name='customizeResult4'][data-result=1]").click():($("[name='customizeResult4'][data-result=0]").removeAttr("checked"),$("[name='customizeResult4'][data-result=1]").removeAttr("checked")),Y.localParam.urlparam.param1=e.projectId,Y.localParam.urlparam.param3=e.oldVoucherId,Y.localParam.urlparam.param4=e.vchDate,Y.localParam.urlparam.param5=s,Y.localParam.urlparam.param6=e.samplingId,Y.localParam.urlparam.lockCustomerId=e.customerId,Y.localParam.urlparam.lockYyyy=e.vchDate.substr(0,4),$("#samplingFileShow").css("display","block"),$("#samplingInfoEditShow").css("display","block"),$("#show_currentVoucher").prop("checked","checked"),BdoDataTable("samplingVoucherDetail_table",Y),null!=e.relateSamplingId&&""!=e.relateSamplingId?(f=e.relateSamplingId,$("#samplingInfoEdit_relateSampling").val(e.relateSampleName)):(f="",$("#samplingInfoEdit_relateSampling").val(""))}),$("#btn_dgSamplingInfo_file").click(function(){$("#modal-samplingFileUpload").modal("show"),V.attachTableCfg.localParam.urlparam.param5="",V.attachTableCfg.localParam.urlparam.param6="2",V.attachTableCfg.localParam.urlparam.param7=CUR_USERID,V.attachTableCfg.localParam.urlparam.param8="",V.attachTableCfg.localParam.urlparam.param9="",$("#upload_samplingFileBtn").css("display","none"),$("#samplingFileShow").css("display","none"),$("#samplingInfoEditShow").css("display","none"),BdoDataTable("samplingFileUploadTable",V.attachTableCfg)});let V=new Page({container:"#modal-samplingFileUpload",events:{"#refreshAttachTableBtn_samplingFileUpload":"click,onRrefreshAttachTable","#upload_samplingFileUpload":"click,onUpload"},init(e){this.uploadWorkpagerPage=createForm(this.uploadWorkpagerPageCfg),this.listener()},uploadWorkpagerPageCfg:{options:{propsData:{jsonData:{workpager:[],customerId:x.customerId,projectId:x.projectId,subjectTreeId:"",autoId:null}}},props:{jsonData:Object},display:"tableform-one",column:1,id:"uploadSamplingFileForm",data:()=>({ajaxConfig:{type:"POST",url:"dgCenter/DgMain.updateSamplingDgFile.json",dataType:"json",success(e){e.success?(bdoSuccessBox("成功",e.resultInfo.statusText),$("#uploadSamplingFormModal").modal("hide"),$("#samplingFileUploadTable").DataTable().ajax.reload(),"2"==V.attachTableCfg.localParam.urlparam.param6&&$("#samplingVoucherDetail_table").DataTable().ajax.reload()):bdoErrorBox("失败",e.resultInfo.statusText)}},uploadMode:"STD"}),methods:{onUploadDraftFileClick(e){$("#workpager").fileinput("getFilesCount")<=0?bdoErrorBox("失败","当前无任何文件！"):this.uploadFile(!0,{param1:"SAMPLING",param2:o,param3:V.attachTableCfg.localParam.urlparam.param6,param4:n})},resetFileClick(e){$("#workpager").fileinput("refresh"),$("#workpager").fileinput("clear"),$("#workpager").fileinput("reset")}},buttons:[{id:"resetFileBtn",icon:"fa fa-refresh",style:"btn-primary",text:"重置",typeAttr:{"v-on:click":"resetFileClick"}},{id:"uploadDraftFileBtn",icon:"fa fa-upload",style:"btn-primary",text:"上传",typeAttr:{"v-on:click":"onUploadDraftFileClick"}},{id:"cancelUploadDraftFileBtn",icon:"fa-arrow-left",style:"btn-warning",text:"取消",typeAttr:{"data-dismiss":"modal"}}],items:[{id:"workpager",type:"file",label:"文件",rowspan:1,colspan:2,validate:{rules:{}},typeAttr:{multiple:!0},show:!0,plugin:{name:"fileinput",options:{allowedFileExtensions:["xls","xlsx","xltx","xlsm","xltm","xlsb","xlam","jpg","png","doc","docx","zip","rar","pdf"],uploadUrl:"dgCenter/DgDownload.uploadTempFile.json",uploadExtraData:()=>({})}}}]},uploadWorkpagerPage:null,attachTableCfg:{localParam:{url:"dgCenter/DgGeneral.query.json",urlparam:{menuId:window.sys_menuId,sqlId:"DG10006",param1:x.customerId,param2:"",param4:x.projectId,param5:"",param6:"",param7:""},tabNum:!0},tableParam:{scrollX:!0,scrollCollapse:!0,select:!0,serverSide:!0,lengthChange:!0,order:[3,"asc"],ordering:!0,createdRow(e,t,a){$(e).data("sortNum",t.sortNum),$(e).data("dataIndex",a)},columnDefs:[{targets:(()=>(cnt=0,++cnt))(),orderable:!1,className:"text-center",title:"处理",data:null,width:"120px",render:function(e,t,a,r){var l="";return"1"==e.relateType&&(l+='<button class="btn btn-xs table-btn-operate btn-success" type="button" name="relateEntry" data-placement="top" title="关联" data-toggle="tooltip" data-row="'+r.row+'">\t<i class="fa fa-eye"></i></button>'),l+='<button class="btn btn-xs table-btn-operate btn-primary" type="button" name="downloadFile" data-placement="top" title="下载" data-toggle="tooltip" data-row="'+r.row+'">\t<i class="fa fa-download"></i></button>',/^.*?\.(jpg|jpeg|bmp|gif|png|pdf)$/.test(e.fileName.toLowerCase())&&(l+='<button class="btn btn-xs table-btn-operate btn-success" type="button" name="onlinepreview" data-placement="top" title="在线预览" data-toggle="tooltip" data-row="'+r.row+'">\t<i class="fa fa-eye"></i></button>'),l+='<button class="btn btn-xs table-btn-operate btn-danger" type="button" name="delFile" data-placement="top" title="删除" data-toggle="tooltip" data-row="'+r.row+'">\t<i class="fa fa-times-circle-o"></i></button>'}},{targets:++cnt,name:"sortNum",data:"sortNum",visible:!1},{targets:++cnt,orderable:!0,className:"edit-indexid",title:"索引号",name:"fileIndexId",data:"fileIndexId",width:"150px",render:function(e,t,a,r){return"1"==a.relateType?a.tempFileIndexId:e}},{targets:++cnt,orderable:!0,title:"文件名称",name:"fileName",data:"fileName",width:"150px"},{targets:++cnt,orderable:!0,title:"上传时间",name:"uploadDate",data:"uploadDate",width:"150px",render:function(e,t,a,r){return new Date(e).format("yyyy-MM-dd HH:mm:ss")}},{targets:++cnt,orderable:!1,title:"上传人",name:"__uuploadUserName",data:"__uuploadUserName",width:"150px"}]}},onRrefreshAttachTable(e){e.preventDefault(),$("#samplingFileUploadTable").DataTable().ajax.reload()},onUpload(e){e.preventDefault(),V.uploadWorkpagerPage.jsonData.autoId=null,V.uploadMode="STD",$("#uploadSamplingFormModal").modal("show")},updateFileIndexId(e,t,a,r){let l=a.dataTable().api(!0).cell(t).data();if(l!=r&&r){let e=a.dataTable().api(!0).cell(t).row().data();$.ajax({url:"dgCenter/DgMain.updateDgIndexId.json",type:"post",data:{jsonData:JSON.stringify([{autoId:e.autoId,customerId:e.customerId,fileIndexId:r}])},dataType:"json",success(e){e.success?(t.css("padding","6px 8px"),t.html(r),a.dataTable().api(!0).cell(t).data(r)):bdoErrorBox("失败",e.resultInfo.statusText)}})}else l==r&&(t.css("padding","6px 8px"),t.html(r),a.dataTable().api(!0).cell(t).data(r))},onIndexColDbclick(e){console.log("onIndexColDbclick");let t=$("#samplingFileUploadTable").dataTable(),a=$(this),r=t.api(!0).cell(this).data(),l=$('<input style="width: 60%; height: 80%;    max-height: 2em; margin-top: 1px;"/>'),s=$('<button class="btn btn-success" style="font-size: 12px;width: 15%;height: 80%;max-height: 2em;margin-left: 5px;padding: 1px;margin-top: -4px;"><i class="fa fa-check"></i></button>');a.css("padding",0),l.val(r),a.html(l),a.append(s),s.click(function(e){V.updateFileIndexId(e,a,t,l.val())}),l.focus()},listener(){let e=(e,t)=>{$.ajax({url:"dgCenter/DgMain.querySamplingDgFileExist.json",type:"post",data:e,dataType:"json",success(e){e.success?t(e):bdoErrorBox("失败",e.resultInfo.statusText)}})};$("#samplingFileUploadTable").on("click",'button.table-btn-operate[name="reUploadFile"]',e=>{let t=$("#samplingFileUploadTable").dataTable().fnGetData($(e.currentTarget).attr("data-row"));V.uploadWorkpagerPage.jsonData.autoId=t.autoId,V.uploadWorkpagerPage.uploadMode="RE",$("#uploadSamplingFormModal").modal("show")}),$("#samplingFileUploadTable").on("click",'button.table-btn-operate[name="downloadFile"]',t=>{let a=$("#samplingFileUploadTable").dataTable().fnGetData($(t.currentTarget).attr("data-row"));e({param1:a.autoId,param2:a.customerId,param3:a.relateType},e=>{downloadFile("dgCenter/DgDownload.downloadSamplingDgFile.json",{param1:a.autoId,param2:a.customerId,param3:a.relateType})})}),$("#samplingFileUploadTable").on("click",'button.table-btn-operate[name="onlinepreview"]',t=>{var a=$("#samplingFileUploadTable").dataTable().fnGetData($(t.currentTarget).attr("data-row"));e({param1:a.autoId,param2:a.customerId,param3:a.relateType},e=>{var t=a.fileName.substring(a.fileName.lastIndexOf(".")+1).toLowerCase();if("pdf"===t||"jpg"===t||"png"===t||"jpeg"===t)null==e.data?window.open("dgCenter/DgPaper.previewFile.json?param1="+a.autoId+"&param2=type2&param3="+a.fileName,a.fileName,"location=no"):window.open("/Faith/dgcenter.do?m=previewAuditPolicyFileNoRight",a.fileName,"location=no");else if("xlsx"===t){a.pageType=2;var r={extraOptions:a,currentNode:{extraOptions:a}};$.sessionStorage("fileNode",JSON.stringify(r)),window.open("/Faith/dgcenter.do?m=previewFile")}})}),$("#samplingFileUploadTable").on("click",'button.table-btn-operate[name="relateEntry"]',e=>{var t=$("#samplingFileUploadTable").dataTable();i=t.fnGetData($(e.currentTarget).attr("data-row")),$("#modal_samplistRelate").modal("show")}),$("#samplingFileUploadTable").on("click",'button.table-btn-operate[name="delFile"]',e=>{var t=$("#samplingFileUploadTable").dataTable().fnGetData($(e.currentTarget).attr("data-row"));bdoConfirmBox("提示","确认删除文件【"+t.fileName+"】?",function(){$.ajax({url:"dgCenter/DgMain.deleteSamplingDgFile.json",type:"post",data:{param1:t.autoId,param2:t.customerId,param3:t.relateType},dataType:"json",success:function(e){e.success?($("#samplingFileUploadTable").DataTable().ajax.reload(),"2"==V.attachTableCfg.localParam.urlparam.param6&&$("#samplingVoucherDetail_table").DataTable().ajax.reload(),bdoSuccessBox("成功",e.resultInfo.statusText)):bdoErrorBox("失败",e.resultInfo.statusText)}})})}),$("#samplingFileUploadTable").on("dblclick","tbody td.edit-indexid",this.onIndexColDbclick)}});var q={localParam:{tabNum:!0,url:"cpBase/General.query.json",urlparam:{sqlId:"DG10002",menuId:window.sys_menuId,param1:x.projectId,param2:"",param3:$("#samplistRelate_startDate").val(),param4:$("#samplistRelate_endDate").val(),param5:$("#samplistRelate_sampleMethod").val(),param6:$("#samplistRelate_voucherId").val(),param7:$("#samplistRelate_sampleUser").val(),param11:$("#samplistRelate_subjectid").val(),lockCustomerId:x.customerId}},tableParam:{select:!0,scrollX:!0,lengthChange:!1,ordering:!1,serverSide:!0,pageLength:30,columnDefs:[{targets:1,className:"text-center",title:"勾选",name:"autoId",data:"autoId",width:"15px",render:function(e,t,a,r){return'<input type="checkbox" name="samplistRelateSelect" value="'+a.autoId+'"></input>'}},{targets:2,orderable:!1,className:"text-left",title:"凭证编号",name:"oldVoucherId",data:"oldVoucherId",width:"60px"},{targets:3,orderable:!1,className:"text-left",title:"凭证日期",name:"vchDate",data:"vchDate",width:"100px"},{targets:4,orderable:!0,className:"text-left",title:"抽凭方式",name:"sampleMethod",data:"sampleMethod",width:"150px"},{targets:5,orderable:!1,className:"text-left",title:"抽凭人",name:"sampleUserName",data:"sampleUserName",width:"60px"},{targets:6,orderable:!1,className:"text-left",title:"科目编号",name:"subjectId",data:"subjectId",width:"60px"},{targets:7,orderable:!1,className:"text-left",title:"科目名称",name:"subjectname1",data:"subjectname1",width:"150px"},{targets:8,className:"text-right",title:"借方发生金额",name:"debitValue",data:"debitValue",width:"100px",render:function(e,t,a,r){return formatMoney(e)}},{targets:9,className:"text-right",title:"贷方发生金额",name:"crebitValue",data:"crebitValue",width:"100px",render:function(e,t,a,r){return formatMoney(e)}},{targets:10,orderable:!1,className:"text-left",title:"审计结论",name:"auditResultName",data:"auditResultName",width:"200px"},{targets:11,orderable:!1,className:"text-left",title:"附件索引号",name:"fileIndexId",data:"fileIndexId",width:"200px"},{targets:12,orderable:!1,className:"text-left",title:"备注",name:"remark",data:"remark",width:"200px"}]}};function J(){0!=$('#tabs_sampleResult li a[href="#tab_samplingStatistics1"]').length&&($('#tabs_sampleResult a[href="#tab_samplingStatistics1"]').remove(),$("#tab_samplingStatistics1").remove(),$('#tabs_sampleResult a[href="#tab_samplingResult"]').click()),0!=$('#tabs_sampleResult li a[href="#tab_voucherdetail"]').length&&($('#tabs_sampleResult a[href="#tab_voucherdetail"]').remove(),$("#tab_voucherdetail").remove(),$('#tabs_sampleResult a[href="#tab_samplingResult"]').click()),0!=$('#tabs_sample li a[href="#tab_samplingStatistics1"]').length&&($('#tabs_sample a[href="#tab_samplingStatistics1"]').remove(),$("#tab_samplingStatistics1").remove(),$('#tabs_sample a[href="#tab_samplingTest"]').click()),0!=$('#tabs_sample li a[href="#tab_voucherdetail"]').length&&($('#tabs_sample a[href="#tab_voucherdetail"]').remove(),$("#tab_voucherdetail").remove(),$('#tabs_sample a[href="#tab_samplingTest"]').click())}function G(e){e.val(e.val().replace(/[^\d.]/g,"")),e.val(e.val().replace(/^\./g,"")),e.val(e.val().replace(/\.{2,}/g,".")),e.val(e.val().replace(".","$#$").replace(/\./g,"").replace("$#$",".")),e.val(e.val().replace(/^(\-)*(\d+)\.(\d\d).*$/,"$1$2.$3"))}function L(e){e.val(e.val().replace(/[^\d]/g,""))}function z(e,t){var a={"M+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds(),"q+":Math.floor((t.getMonth()+3)/3),S:t.getMilliseconds()};for(var r in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(t.getFullYear()+"").substr(4-RegExp.$1.length))),a)new RegExp("("+r+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?a[r]:("00"+a[r]).substr((""+a[r]).length)));return e}$("#btn_samplistRelate_search").click(function(){""==$("#samplistRelate_endDate").val()&&""!=$("#samplistRelate_startDate").val()&&$("#samplistRelate_endDate").val($("#samplistRelate_startDate").val()),""==$("#samplistRelate_startDate").val()&&""!=$("#samplistRelate_endDate").val()&&$("#samplistRelate_startDate").val($("#samplistRelate_endDate").val()),""!=$("#samplistRelate_startDate").val()?""!=$("#samplistRelate_endDate").val()?$("#samplistRelate_startDate").val()>$("#samplistRelate_endDate").val()?bdoInfoBox("提示","凭证结束日期不能小于凭证开始日期"):(q.localParam.urlparam.param2=$("#samplistRelate_startDate").val().substr(0,4),q.localParam.urlparam.param14=$("#samplistRelate_endDate").val().substr(0,4),"0"==$("#samplistRelate_dateType").val()?(q.localParam.urlparam.param3=$("#samplistRelate_startDate").val(),q.localParam.urlparam.param4=$("#samplistRelate_endDate").val(),q.localParam.urlparam.param12="",q.localParam.urlparam.param13=""):"1"==$("#samplistRelate_dateType").val()?(q.localParam.urlparam.param3="",q.localParam.urlparam.param4="",q.localParam.urlparam.param12=$("#samplistRelate_startDate").val().substr(5,6),q.localParam.urlparam.param13=$("#samplistRelate_endDate").val().substr(5,6)):(q.localParam.urlparam.param3="",q.localParam.urlparam.param4="",q.localParam.urlparam.param12="",q.localParam.urlparam.param13=""),q.localParam.urlparam.param5=$("#samplistRelate_sampleMethod").val(),q.localParam.urlparam.param6=$("#samplistRelate_voucherId").val(),q.localParam.urlparam.param7=$("#samplistRelate_sampleUser").val(),q.localParam.urlparam.param11=$("#samplistRelate_subjectid").val(),BdoDataTable("samplistRelateTable",q)):bdoInfoBox("提示","请选择凭证结束日期"):bdoInfoBox("提示","请选择凭证开始日期")}),$("#btn_samplistRelate_select").click(function(){var e=[],t=$('input[name="samplistRelateSelect"]:checked');$.each(t,(t,a)=>{e.push(a.value)}),e.length<1?bdoErrorBox("","未选择数据！"):e.length>1?bdoErrorBox("","只能选择一条数据！"):bdoConfirmBox("提示","确认关联文件【"+i.fileName+"】?",function(){$.ajax({url:"dgCenter/DgMain.relateSamplingDgFile.json",type:"post",data:{param1:"SAMPLING",param2:e[0],param3:i.autoId,param4:i.customerId,param5:x.projectId},dataType:"json",success:function(e){e.success?($("#modal_samplistRelate").modal("hide"),$("#samplingFileUploadTable").DataTable().ajax.reload(),bdoSuccessBox("成功",e.resultInfo.statusText)):bdoErrorBox("失败",e.resultInfo.statusText)}})})}),$("#samplingSet_amountStart,#samplingSet_amountEnd,#samplingCaculation_actualImportant,#samplingInterval_adjustAmount,#samplingSet_cullAmountStart,#samplingSet_cullAmountEnd").keyup(function(){G($(this))}),$("#samplingCaculation_adjustAmount").keyup(function(){L($(this))}),$("#samplingRangeSetContent").on("keyup",'[name="startAmount"]',function(e){G($(this))}),$("#samplingRangeSetContent").on("keyup",'[name="endAmount"]',function(e){G($(this))}),$("#samplingRangeContent").on("keyup",'[name="samplingCount"]',function(e){L($(this))}),$("#cutoff_num").keyup(function(){L($(this))}),$("#cutoff_amount").keyup(function(){G($(this))}),$("#modal_cutoff_next").click(function(){var e=$("#cutoff_num").val(),t=$("#cutoff_amount").val();""!=e?e<=0?bdoInfoBox("提示","张数不能小于等于0"):""!=$("#cutoff_subjectid").val()?(r={lockCustomerId:x.customerId,lockYyyy:x.yyyy,lockProjectId:x.projectId,param11:$("#cutoff_subjectid").val(),param15:"1",param16:e,param17:t},$.ajax({url:"finCenter/sampling.updateSamplingCutoff.json",type:"post",data:{lockCustomerId:$("#samplingSet_customerId").val(),lockYyyy:x.yyyy,param1:b,param2:e,param3:t,param4:x.projectId,param5:"1",param6:$("#cutoff_subjectid").val()},dataType:"json",success:function(e){e.success?(k(),$("#modal_cutoff").modal("hide")):bdoErrorBox("失败",e.resultInfo.statusText)}})):bdoInfoBox("提示","科目不能为空"):bdoInfoBox("提示","张数不能为空")});var Y={localParam:{tabNum:!0,url:"cpBase/General.query.json",urlparam:{menuId:window.sys_menuId,sqlId:"DG10009",param2:"",param3:"",param4:"",param5:"",param6:"",lockCustomerId:"",lockYyyy:""}},tableParam:{select:!0,lengthChange:!1,dom:'<"row"<"col-sm-6"i><"col-sm-6">><"row"<"col-sm-12"tr>><"row"<"col-sm-6"i><"col-sm-6">>',ordering:!1,serverSide:!0,scrollX:!0,scrollCollapse:!0,createdRow(e,t,a){$(e).addClass("edit-able"),$(e).find("td:eq(10)").addClass("bg-success-light"),t.autoId==s&&$(e).css({color:"red"})},columnDefs:[{targets:1,orderable:!1,className:"text-center",title:"处理",width:"40px",render:function(e,t,a,r){var l="";return l+='<button class="btn btn-xs btn-success" type="button" name="samplingVoucherFileBtn" data-placement="top" title="上传附件" data-toggle="tooltip"><i class="fa fa-upload"></i></button>&nbsp;'}},{targets:2,className:"text-left",title:"凭证号",name:"oldVoucherId",data:"oldVoucherId",width:"60px"},{targets:3,className:"text-left",title:"凭证日期",name:"vchDate",data:"vchDate",width:"80px"},{targets:4,className:"text-left",title:"摘要",name:"summary",data:"summary",width:"100px"},{targets:5,className:"text-left",title:"科目编号",name:"subjectId",data:"subjectId",width:"60px"},{targets:6,className:"text-left",title:"科目名称",name:"subjectFullName",data:"subjectFullName",width:"100px"},{targets:7,className:"text-right",title:"借方金额",name:"debitValue",data:"debitValue",width:"80px",render:function(e,t,a,r){return formatMoney(e)}},{targets:8,className:"text-right",title:"贷方金额",name:"crebitValue",data:"crebitValue",width:"80px",render:function(e,t,a,r){return formatMoney(e)}},{targets:9,className:"text-left",title:"附件索引号",name:"fileIndexId",data:"fileIndexId",width:"100px"},{targets:10,className:"text-left",title:"附件内容填写",name:"content",data:"content",width:"100px"}]}};function H(e){return JSON.parse(JSON.stringify(e))}function W(e){for(var t=(e=e.toFixed(2)).split(".")[0],a=e.split(".")[1],r=t.toString(),l="",s="",o=r.length-1;o>=0;o--)s++,l=r.charAt(o)+l,s%3||0==o||(l=","+l);return","==l[0]&&(l=l.replace(",","")),t<0&&","==l[1]&&(l=l.replace(",","")),l+"."+a}function X(e){if(e){var t=new RegExp(",","g");if(""==(e=e.replace(t,""))||null==e)return 0}return e}$("#samplingVoucherDetail_table").on("dblclick","td",function(){if(10!=$(this).closest("td").index()||!d)return;let e=$(this).closest("table"),t=e.DataTable().context[0].aoColumns[e.DataTable().cell(this).index().column],a=e.DataTable().row($(this).closest("tr")).data(),r=this.offsetHeight;$(this).html("<span><textarea type='text' style='width:100%; height: "+r+"px;align=right;'></textarea></span>");let l=$(this).find("textarea"),s=a[t.name];s&&l.val(s),l.focus(),l.on("keydown",function(e){13==e.keyCode&&l.blur()}),l.on("blur",function(){let e=$(this).closest("table").DataTable().row($(this).closest("tr")).data(),t=$(this).val();e.content=t,$.ajax({url:"finCenter/sampling.saveSamplingInfoContent.json",type:"post",data:{lockCustomerId:x.customerId,lockProjectId:x.projectId,param2:e.autoId,param3:t},dataType:"json",success:function(e){$("#samplingVoucherDetail_table").DataTable().ajax.reload(),e.success?bdoSuccessBox("成功",e.resultInfo.statusText):bdoErrorBox("失败",e.resultInfo.statusText)}})})}),$("#samplingVoucherDetail_table").on("click",'button[name="samplingVoucherFileBtn"]',function(){if(d){var e=$("#samplingVoucherDetail_table").DataTable().data()[$(this).closest("tr").index()];o=e.autoId,n=e.oldVoucherId,$("#upload_samplingFileUpload").click()}else bdoInfoBox("提示","没有权限")}),$("#samplingInfoEdit_relateSampling").click(function(){if(""!=$("#samplingInfoEdit_relateSampling").val())b=f,$("#samplingSet_prev").click();else{h="1",b="";var e="抽凭"+z("yyyyMMddhhmmss",new Date);$("#samplingAdd_name_model").val(e),$("#modal-samplingAdd").modal("show")}}),$("#show_currentVoucher").click(function(){$("#show_currentVoucher").is(":checked")?Y.localParam.urlparam.param5=s:Y.localParam.urlparam.param5="",BdoDataTable("samplingVoucherDetail_table",Y)}),$("#btn_samplingDetail_show_result").click(function(){J(),SamplingResult({region:"#samplistResultPage",data:e.data,samplingId:Y.localParam.urlparam.param6}),$("#modal_samplistResult1").modal("show")})});var assitemLedagerTab=function(e,t,a,r,l){0!=$("#"+e+' li a[href="#tab_assitemLedager"]').length&&($("#"+e+' li a[href="#tab_assitemLedager"]').remove(),$("#tab_assitemLedager").remove()),$("#"+e).append('<li><a href="#tab_assitemLedager">核算分类账&nbsp;&nbsp;<i class="fa fa-times-circle"></i></a></li>'),$("#"+e+"_content").append('<div class="tab-pane" id="tab_assitemLedager"></div>'),$("#"+e+' a[href="#tab_assitemLedager"]').find(".fa-times-circle").click(function(){$(this).parents("ul").find("li").first().find("a").click(),$(this).parents("li").remove(),$("#tab_assitemLedager").remove()});$("#tab_assitemLedager").html('<div class="content"><div class="block block-bordered"><div class="block-header bg-primary"><ul class="block-options"><li><button id="assitemLedager_export" type="button"><i class="si si-cloud-download" style="color: white;">&nbsp;导出</i></button></li></ul><h3 class="block-title">核算分类账一览</h3></div><div class="block-content"><table id="table_assitemLedager" class="table table-bordered table-striped table-hover"></table></div></div></div>'),$("#"+e+' a[href="#tab_assitemLedager"]').click();var s=1,o={localParam:{tabNum:!0,url:"finCenter/Account.getAssitemLedager.json",urlparam:{menuId:window.sys_menuId,param3:r,param4:l,lockCustomerId:t,lockYyyy:a}},tableParam:{param1:"jsq",select:!0,lengthChange:!1,dom:'<"row"<"col-sm-6"i><"col-sm-6">><"row"<"col-sm-12"tr>><"row"<"col-sm-6"i><"col-sm-6">>',ordering:!1,serverSide:!0,infoCallback:fnInfoCallback,fixedThead:!0,fixedHeight:"500px",columnDefs:[{targets:s++,className:"text-left",title:"科目编号",name:"subjectId",data:"subjectId",width:"50px"},{targets:s++,className:"text-left",title:"科目名称",name:"subjectFullName",data:"subjectFullName",width:"150px"},{targets:s++,className:"text-left",title:"核算编号",name:"assItemId",data:"assItemId",width:"100px"},{targets:s++,className:"text-left",title:"核算名称",name:"assTotalName",data:"assTotalName",width:"250px"},{targets:s++,className:"text-center",title:"科目方向",name:"direction",data:"direction",width:"30px"},{targets:s++,className:"text-center",title:"会计月份",name:"subMonth",data:"subMonth",width:"30px"},{targets:s++,className:"text-right",title:"借方发生金额",name:"debitOcc",data:"debitOcc",width:"150px",render:function(e,t,a,r){return formatMoney(e)}},{targets:s++,className:"text-right",title:"贷方发生金额",name:"creditOcc",data:"creditOcc",width:"150px",render:function(e,t,a,r){return formatMoney(e)}},{targets:s++,className:"text-right",title:"期末金额",name:"balance",data:"balance",width:"150px",render:function(e,t,a,r){return formatMoney(e)}}]}};jsq(o.tableParam,"table_assitemLedager"),BdoDataTable("table_assitemLedager",o),$("#table_assitemLedager tbody").on("dblclick","tr",function(){var s=$("#table_assitemLedager").DataTable().data()[$(this).closest("tr").index()];">期初"!=s.assTotalName&&(">合计"==s.assTotalName&&""==s.subMonth?(startsubMonth=1,endsubMonth=12):(startsubMonth=s.subMonth,endsubMonth=s.subMonth),assitemdetailTab(e,t,a,startsubMonth,a,endsubMonth,r,l,s.assTotalName))}),$("#table_assitemLedager").on("click","td",function(){var e=$(this).text();$(this).attr("class").indexOf("text-right")<0||e.indexOf("%")>=0||""===e||(""==$("#suanshi_table_assitemLedager").val()?(e.indexOf("-")>=0?$("#suanshi_table_assitemLedager").val("("+e+")"):$("#suanshi_table_assitemLedager").val(e),$("#jieguo_table_assitemLedager").val(e)):(value=$("#suanshi_table_assitemLedager").val(),jieguo=$("#jieguo_table_assitemLedager").val(),jieguo.indexOf(",")>=0?numjieguo=parseFloat(jieguo.split(",").join("")):numjieguo=parseFloat(jieguo),e.indexOf(",")>=0?numdata=parseFloat(e.split(",").join("")):numdata=parseFloat(e),e.indexOf("-")>=0?$("#suanshi_table_assitemLedager").val(value+"+("+e+")"):$("#suanshi_table_assitemLedager").val(value+"+"+e),$("#jieguo_table_assitemLedager").val((numjieguo+numdata).toFixed(2).replace(/(\d{1,3})(?=(\d{3})+(?:$|\.))/g,"$1,"))))}),$("#jsq_clear_table_assitemLedager").on("click",function(){$("#suanshi_table_assitemLedager").val(""),$("#jieguo_table_assitemLedager").val("")}),$("#assitemLedager_export").click(function(){exportExcelFin(this,"核算分类账一览",o,"table_assitemLedager")})},assitemdetailTab=function(e,t,a,r,l,s,o,n,i){0!=$("#"+e+' li a[href="#tab_assitemdetail"]').length&&($("#"+e+' li a[href="#tab_assitemdetail"]').remove(),$("#tab_assitemdetail").remove()),$("#"+e).append('<li><a href="#tab_assitemdetail">核算明细账&nbsp;&nbsp;<i class="fa fa-times-circle"></i></a></li>'),$("#"+e+"_content").append('<div class="tab-pane" id="tab_assitemdetail"></div>'),$("#"+e+' a[href="#tab_assitemdetail"]').find(".fa-times-circle").click(function(){$(this).parents("ul").find("li").first().find("a").click(),$(this).parents("li").remove(),$("#tab_assitemdetail").remove()});var d='<div class="content"><div class="block block-bordered"><div class="block-header bg-primary"><ul class="block-options"><li><button id="assitemdetail_export" type="button"><i class="si si-cloud-download" style="color: white;">&nbsp;导出</i></button></li></ul><h3 class="block-title">核算明细账一览\t'+a+"\t"+i+'</h3></div><div class="block-content"><table id="table_assitemdetail" class="table table-bordered table-striped table-hover"></table></div></div></div>';$("#tab_assitemdetail").empty().html(d),$("#"+e+' a[href="#tab_assitemdetail"]').click();var c=1,u={localParam:{tabNum:!0,url:"finCenter/SubjectEntry.getSubjectEntryAssitemView.json",urlparam:{menuId:window.sys_menuId,jsonData:JSON.stringify({startMonth:r,endYyyy:l,endMonth:s,subjectId:o,assItemId:n}),lockCustomerId:t,lockYyyy:a}},tableParam:{select:!0,param1:"jsq",lengthChange:!1,dom:'<"row"<"col-sm-6"i><"col-sm-6">><"row"<"col-sm-12"tr>><"row"<"col-sm-6"i><"col-sm-6">>',ordering:!1,serverSide:!0,infoCallback:fnInfoCallback,fixedThead:!0,fixedHeight:"500px",columnDefs:[{targets:c++,orderable:!1,className:"text-center",title:"凭证日期",name:"vchDate",data:"vchDate",width:"70px"},{targets:c++,orderable:!0,className:"text-left",title:"字",name:"typeId",data:"typeId",width:"20px"},{targets:c++,orderable:!0,className:"text-left",title:"系统编号",name:"voucherId",data:"voucherId",width:"20px",visible:!1},{targets:c++,orderable:!0,className:"text-left",title:"号",name:"oldVoucherId",data:"oldVoucherId",width:"20px"},{targets:c++,orderable:!0,className:"text-left",title:"摘要",name:"summary",data:"summary",width:"200px",render:function(e,t,a,r){return e&&e.length>15?'<span title="'+e+'">'+e.substring(0,15)+"...</span>":e}},{targets:c++,orderable:!0,className:"text-left",title:"对方科目",name:"oppositeSubjectValue",data:"oppositeSubjectValue",width:"200px",render:function(e,t,a,r){return e&&e.length>15?'<span title="'+e+'">'+e.substring(0,15)+"...</span>":e}},{targets:c++,orderable:!0,className:"text-right",title:"借方发生额",name:"debitOcc",data:"debitOcc",width:"100px",render:function(e,t,a,r){return formatMoney(e)}},{targets:c++,orderable:!0,className:"text-right",title:"贷方发生额",name:"creditOcc",data:"creditOcc",width:"100px",render:function(e,t,a,r){return formatMoney(e)}},{targets:c++,orderable:!0,className:"text-right",title:"余额",name:"remain",data:"remain",width:"100px",render:function(e,t,a,r){return formatMoney(e)}}]}};jsq(u.tableParam,"table_assitemdetail"),BdoDataTable("table_assitemdetail",u),$("#table_assitemdetail tbody").on("dblclick","tr",function(){var a=$("#table_assitemdetail").DataTable().data()[$(this).closest("tr").index()];a.voucherId&&a.voucherId>""&&voucherTab(e,t,a.typeId,a.oldVoucherId,a.vchDate,a.voucherId)}),$("#table_assitemdetail").on("click","td",function(){var e=$(this).text();$(this).attr("class").indexOf("text-right")<0||e.indexOf("%")>=0||""===e||(""==$("#suanshi_table_assitemdetail").val()?(e.indexOf("-")>=0?$("#suanshi_table_assitemdetail").val("("+e+")"):$("#suanshi_table_assitemdetail").val(e),$("#jieguo_table_assitemdetail").val(e)):(value=$("#suanshi_table_assitemdetail").val(),jieguo=$("#jieguo_table_assitemdetail").val(),jieguo.indexOf(",")>=0?numjieguo=parseFloat(jieguo.split(",").join("")):numjieguo=parseFloat(jieguo),e.indexOf(",")>=0?numdata=parseFloat(e.split(",").join("")):numdata=parseFloat(e),e.indexOf("-")>=0?$("#suanshi_table_assitemdetail").val(value+"+("+e+")"):$("#suanshi_table_assitemdetail").val(value+"+"+e),$("#jieguo_table_assitemdetail").val((numjieguo+numdata).toFixed(2).replace(/(\d{1,3})(?=(\d{3})+(?:$|\.))/g,"$1,"))))}),$("#jsq_clear_table_assitemdetail").on("click",function(){$("#suanshi_table_assitemdetail").val(""),$("#jieguo_table_assitemdetail").val("")}),$("#assitemdetail_export").click(function(){exportExcelFin(this,"核算明细账一览",u,"table_assitemdetail")})};$(".block").on("mousewheel",function(e){var t=$(".active .dataTables_scrollBody").scrollTop();if(1==e.deltaY){if(t<=0)return;t-=80,$(".active .dataTables_scrollBody").scrollTop(t)}else if(-1==e.deltaY){if($(".active .dataTables_scrollBody")[1]){if($(".active .dataTables_scrollBody")[1].scrollHeight-500<=t)return}else if($(".active .dataTables_scrollBody").scrollHeight-500<=t)return;t+=80,$(".active .dataTables_scrollBody").scrollTop(t)}});var samplingStatisticsTab=function(e,t,a,r,l){var s="tab_samplingStatistics"+r;0!=$("#"+e+' li a[href="#'+s+'"]').length&&($("#"+e+' a[href="#'+s+'"]').remove(),$("#"+s).remove()),$("#"+e).append('<li><a href="#'+s+'">抽凭统计&nbsp;&nbsp;<i class="fa fa-times-circle"></i></a></li>'),$("#"+e+"_content").append('<div class="tab-pane" id="'+s+'"></div>'),$("#"+e+' a[href="#'+s+'"]').find(".fa-times-circle").click(function(){$(this).parents("ul").find("li").first().find("a").click(),$(this).parents("li").remove(),$("#"+s).remove()}),$("#"+s).empty();var o='<div class="content"><div class="block block-bordered"><div class="block-header bg-primary"><ul class="block-options"></ul><h3 class="block-title">统计 </h3> </div><div class="block-content"><table id="samplingStatistics_tab'+s+'" class="table table-bordered table-hover"></table>\t<br></div></div></div>';$("#"+s).html(o),$("#"+e+' a[href="#'+s+'"]').click();var n={localParam:{tabNum:!0,url:"finCenter/Sampling.querySamplingStatistics.json",urlparam:{menuId:window.sys_menuId,sqlId:"FINCP100004",param1:a,param2:r,param3:window.CUR_PROJECTID,lockYyyy:window.CUR_PROJECT_ACC_YEAR,lockCustomerId:t,lockProjectId:window.CUR_PROJECTID}},tableParam:{select:!0,lengthChange:!1,dom:'<"row"<"col-sm-6"i><"col-sm-6">><"row"<"col-sm-12"tr>><"row"<"col-sm-6"i><"col-sm-6">>',ordering:!1,serverSide:!0,infoCallback:fnInfoCallback,rowReorder:{update:!1},fixedThead:!0,fixedHeight:"500px",columnDefs:[{targets:1,className:"text-left",title:"抽凭方式",name:"sampleMethodName",data:"sampleMethodName",width:"100px",render:function(e,t,a,l){if("2"==r){var s="";return s+='<a href="#" name="showSamplingCountResult">'+e+"</a>"}return e}},{targets:2,className:"text-center",title:"样本数量",name:"voucherNum",data:"voucherNum",width:"50px"},{targets:3,className:"text-center",title:"样本数量占发生额总数量的比例",name:"rate1",data:"rate1",width:"50px"},{targets:4,className:"text-right",title:"借方抽样金额",name:"debitOcc",data:"debitOcc",width:"50px",render:function(e,t,a,r){return formatMoney(e)}},{targets:5,className:"text-center",title:"借方抽样金额占借方总发生额比例",name:"rate2",data:"rate2",width:"50px"},{targets:6,className:"text-right",title:"贷方抽样金额",name:"creditOcc",data:"creditOcc",width:"50px",render:function(e,t,a,r){return formatMoney(e)}},{targets:7,className:"text-center",title:"贷方抽样金额占贷方总发生额比例",name:"rate3",data:"rate3",width:"50px"},{targets:8,className:"text-left",title:"抽凭名称",name:"sampleName",data:"sampleName",width:"50px"}]}};BdoDataTable("samplingStatistics_tab"+s,n),$("#samplingStatistics_tab"+s).on("click",'a[name="showSamplingCountResult"]',function(){var e=$("#samplingStatistics_tab"+s).DataTable().data()[$(this).closest("tr").index()].autoId;null!=e&&""!=e&&(SamplingResult({region:"#samplistResultPage",data:l.data,samplingId:e}),$("#modal_samplistResult1").modal("show"))})};BbReport=(agrs=>{var _template,mount,listener,tabPage;_template=agrs.template||tplLoader("dgCenter/html/dg/bbReport.html"),agrs.template=_template;let projectYear=agrs.data.projectYear,bbEditerId,bbReportId="",checkNum=0;var initbbTable=function(){let e={localParam:{tabNum:!0,url:"cpBase/General.query.json",urlparam:{sqlId:"DG20001",menuId:window.sys_menuId,start:-1,limit:-1,param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID}},tableParam:{select:!0,lengthChange:!1,dom:'<"row"<"col-sm-6"i><"col-sm-6">><"row"<"col-sm-12"tr>>',order:[2,"ASC"],pageLength:30,ordering:!1,serverSide:!0,columnDefs:[{targets:1,orderable:!1,className:"text-center",title:"处理",width:"60px",render:function(e,t,a,r){var l='<input type="hidden" name="tempAutoId" value="'+a.autoId+'">&nbsp;';return l+='<button class="btn btn-xs btn-success" type="button" name="templateEdit" id="templateEdit" data-placement="top" title="编辑" data-toggle="tooltip"><i class="fa fa-edit"></i></button>&nbsp;',l+='<button class="btn btn-xs btn-success" type="button" name="templateDownload" id="templateDelete" data-placement="top" title="下载" data-toggle="tooltip"><i class="si si-cloud-download"></i></button>&nbsp;'}},{targets:2,className:"text-center",title:"模板类型",name:"ruleTypeName",data:"ruleTypeName",width:"50px"},{targets:3,className:"text-center",title:"模板名称",name:"ruleName",data:"ruleName",width:"80px"},{targets:4,className:"text-center",title:"描述",name:"remark",data:"remark",width:"100px"},{targets:5,className:"text-center",title:"是否必须",name:"must",data:"must",width:"40px"},{targets:6,className:"text-center",title:"校验不通过数",name:"checkNum",data:"checkNum",width:"60px"},{targets:7,className:"text-center",title:"报告类型",name:"reportType",data:"reportType",width:"50px"},{targets:8,className:"text-center",title:"报备单模版",name:"fileName",data:"fileName",width:"80px"}]}};BdoDataTable("bb_table",e)};function setTbeEditerSelect(){$.ajax({type:"post",url:"dgCenter/DgProject.getProjectMember.json",data:{param1:window.CUR_PROJECTID,param2:window.CUR_CUSTOMERID},dataType:"json",success(e){if(e.success){let t='<option value="" label="" />';e.data.map(e=>{bbEditerId==e.id?t+='<option style="color: #000000"  value="'+e.id+'" label="'+e.name+'" selected />':t+='<option style="color: #000000"  value="'+e.id+'" label="'+e.name+'" />'}),$("#bb_editer").append(t)}else $("#bb_editer").val(""),bdoErrorBox(e.resultInfo.statusText)}})}mount=(()=>{$(agrs.region).empty().append(_template),initbbTable(),setTbeEditerSelect(),OneUI.initHelper("slimscroll")}),mount(),$("#bb_editer").change(function(){$.ajax({type:"post",url:"dgCenter/DgBBReport.saveBbEditer.json",data:{param2:"1",param3:$(this).val(),param4:$(this).find("option:selected").attr("label")},dataType:"json",success(e){e.success?bdoSuccessBox("保存报备编制人成功！"):bdoErrorBox(e.resultInfo.statusText)}})}),$("#bb_table").on("click",'button[name="templateEdit"]',function(){var e=$("#bb_table").DataTable().data()[$(this).closest("tr").index()];initBbReport(e.autoId,"1"),bbReportId=e.autoId,bbReportTabDetail.click()});var initBbReport=function(e,t){null!=e&&""!=e?(bdoInProcessingBox("处理中"),$.ajax({type:"post",url:"dgCenter/DgBBReport.queryBbReport.json",data:{param1:e,param2:t},dataType:"json",success(t){if(t&&t.success){if(bdoSuccessBox("成功"),null!=t.data){destroyTable("zc_bbreport_table"),destroyTable("lr_bbreport_table"),destroyTable("xj_bbreport_table"),destroyTable("qy1_bbreport_table"),destroyTable("qy2_bbreport_table"),destroyTable("zc_bbcheck_table"),destroyTable("lr_bbcheck_table"),destroyTable("xj_bbcheck_table"),destroyTable("qy1_bbcheck_table"),destroyTable("qy2_bbcheck_table"),destroyTable("hbzc_bbreport_table"),destroyTable("hblr_bbreport_table"),destroyTable("hbxj_bbreport_table"),destroyTable("hbqy1_bbreport_table"),destroyTable("hbqy2_bbreport_table"),destroyTable("hbzc_bbcheck_table"),destroyTable("hblr_bbcheck_table"),destroyTable("hbxj_bbcheck_table"),destroyTable("hbqy1_bbcheck_table"),destroyTable("hbqy2_bbcheck_table");var a="0";t.data.length>0&&(a=t.data[0].mergeType),"1"==a?$(".hbShow").css("display","block"):$(".hbShow").css("display","none"),checkNum=0,setCheckColumnDefs(t.data[r],bbCheckTableCfg,1),bbCheckTableCfg.localParam.urlparam.param1=e,BdoDataTable("bbcheck_table",bbCheckTableCfg);for(var r=0;r<t.data.length;r++)"1"==t.data[r].tableType?(bbReportZcTableCfg=$.extend(!0,{},bbReportTableCfg),setColumnDefs(t.data[r],bbReportZcTableCfg,3),bbReportZcTableCfg.localParam.urlparam.param3=e,bbReportZcTableCfg.localParam.urlparam.param4="1",BdoDataTable("zc_bbreport_table",bbReportZcTableCfg)):"3"==t.data[r].tableType?(bbReportLrTableCfg=$.extend(!0,{},bbReportTableCfg),setColumnDefs(t.data[r],bbReportLrTableCfg,3),bbReportLrTableCfg.localParam.urlparam.param3=e,bbReportLrTableCfg.localParam.urlparam.param4="3",BdoDataTable("lr_bbreport_table",bbReportLrTableCfg)):"4"==t.data[r].tableType?(bbReportXjTableCfg=$.extend(!0,{},bbReportTableCfg),setColumnDefs(t.data[r],bbReportXjTableCfg,3),bbReportXjTableCfg.localParam.urlparam.param3=e,bbReportXjTableCfg.localParam.urlparam.param4="4",BdoDataTable("xj_bbreport_table",bbReportXjTableCfg)):"5"==t.data[r].tableType?(bbReportQy1TableCfg=$.extend(!0,{},bbReportTableCfg),setColumnDefs(t.data[r],bbReportQy1TableCfg,2),bbReportQy1TableCfg.localParam.urlparam.param3=e,bbReportQy1TableCfg.localParam.urlparam.param4="5",BdoDataTable("qy1_bbreport_table",bbReportQy1TableCfg)):"6"==t.data[r].tableType?(bbReportQy2TableCfg=$.extend(!0,{},bbReportTableCfg),setColumnDefs(t.data[r],bbReportQy2TableCfg,2),bbReportQy2TableCfg.localParam.urlparam.param3=e,bbReportQy2TableCfg.localParam.urlparam.param4="6",BdoDataTable("qy2_bbreport_table",bbReportQy2TableCfg)):"7"==t.data[r].tableType?(bbReportHbZcTableCfg=$.extend(!0,{},bbReportTableCfg),setColumnDefs(t.data[r],bbReportHbZcTableCfg,3),bbReportHbZcTableCfg.localParam.urlparam.param3=e,bbReportHbZcTableCfg.localParam.urlparam.param4="7",BdoDataTable("hbzc_bbreport_table",bbReportHbZcTableCfg)):"9"==t.data[r].tableType?(bbReportHbLrTableCfg=$.extend(!0,{},bbReportTableCfg),setColumnDefs(t.data[r],bbReportHbLrTableCfg,3),bbReportHbLrTableCfg.localParam.urlparam.param3=e,bbReportHbLrTableCfg.localParam.urlparam.param4="9",BdoDataTable("hblr_bbreport_table",bbReportHbLrTableCfg)):"10"==t.data[r].tableType?(bbReportHbXjTableCfg=$.extend(!0,{},bbReportTableCfg),setColumnDefs(t.data[r],bbReportHbXjTableCfg,3),bbReportHbXjTableCfg.localParam.urlparam.param3=e,bbReportHbXjTableCfg.localParam.urlparam.param4="10",BdoDataTable("hbxj_bbreport_table",bbReportHbXjTableCfg)):"11"==t.data[r].tableType?(bbReportHbQy1TableCfg=$.extend(!0,{},bbReportTableCfg),setColumnDefs(t.data[r],bbReportHbQy1TableCfg,2),bbReportHbQy1TableCfg.localParam.urlparam.param3=e,bbReportHbQy1TableCfg.localParam.urlparam.param4="11",BdoDataTable("hbqy1_bbreport_table",bbReportHbQy1TableCfg)):"12"==t.data[r].tableType&&(bbReportHbQy2TableCfg=$.extend(!0,{},bbReportTableCfg),setColumnDefs(t.data[r],bbReportHbQy2TableCfg,2),bbReportHbQy2TableCfg.localParam.urlparam.param3=e,bbReportHbQy2TableCfg.localParam.urlparam.param4="12",BdoDataTable("hbqy2_bbreport_table",bbReportHbQy2TableCfg))}}else bdoErrorBox(t.resultInfo.statusText)}})):bdoInfoBox("提示","请先选择模板")},bbReportZcTableCfg={},bbReportLrTableCfg={},bbReportXjTableCfg={},bbReportQy1TableCfg={},bbReportQy2TableCfg={},bbReportHbZcTableCfg={},bbReportHbLrTableCfg={},bbReportHbXjTableCfg={},bbReportHbQy1TableCfg={},bbReportHbQy2TableCfg={},bbReportTableCfg={localParam:{tabNum:!0,url:"cpBase/General.query.json",urlparam:{menuId:window.sys_menuId,sqlId:"DG20003",start:-1,limit:-1,param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:"",param4:""}},tableParam:{select:!0,lengthChange:!1,dom:'<"row"<"col-sm-6"i><"col-sm-6">><"row"<"col-sm-12"tr>>',ordering:!1,serverSide:!0,scrollY:!0,createdRow:function(e,t,a){$(e).addClass("edit-able");for(var r=3;r<18;r++)$(e).find("td:eq("+r+")").addClass("bg-success-light")},columnDefs:[{targets:1,orderable:!0,className:"text-center",title:"科目代码",name:"bbSubjectId",data:"bbSubjectId",width:"100px"},{targets:2,orderable:!0,className:"text-left",title:"科目名称",name:"bbSubjectNameDisp",data:"bbSubjectNameDisp",width:"400px",render:function(e,t,a,r){if(null!=e)return e.indexOf("合计")>0||e.indexOf("总计")>0?"<b>"+e+"</b>":e.replace(" ","&nbsp;&nbsp;")}}]}},bbCheckZcTableCfg={},bbCheckLrTableCfg={},bbCheckXjTableCfg={},bbCheckQy1TableCfg={},bbCheckQy2TableCfg={},bbCheckHbZcTableCfg={},bbCheckHbLrTableCfg={},bbCheckHbXjTableCfg={},bbCheckHbQy1TableCfg={},bbCheckHbQy2TableCfg={},bbCheckTableCfg={localParam:{tabNum:!1,url:"dgCenter/DgBBReport.queryBbReportCheck.json",urlparam:{param1:"",param2:""}},tableParam:{select:!0,dom:'<"row"<"col-sm-6"i><"col-sm-6">><"row"<"col-sm-12"tr>>',ordering:!0,serverSide:!0,scrollY:!1,createdRow(e,t,a){0==t.column1&&0==t.column2||(checkNum+=1)},infoCallback(e){$("#checkNum").html("不通过数量："+checkNum)},columnDefs:[]}};function setColumnDefs(e,t,a){t.tableParam.columnDefs.push({targets:a,orderable:!1,className:"text-center width-je",title:"附注",name:"note",data:"note"});for(var r=1;r<16;r++)null!=e["columnDesc"+r]&&t.tableParam.columnDefs.push({targets:r+a,orderable:!1,className:"text-right width-je",title:e["columnDesc"+r],name:"column"+r,data:"column"+r,render:function(e,t,a,r){return null!=e?formatMoney(e):e}})}function setCheckColumnDefs(e,t,a){t.tableParam.columnDefs.push({targets:1,orderable:!1,className:"text-left width-line-break",title:"校验公式",name:"bbCheckFunName",data:"bbCheckFunName",width:"500px"}),t.tableParam.columnDefs.push({targets:2,orderable:!1,className:"text-right",title:"本期",name:"column1",data:"column1",width:"120px",render:function(e,t,a,r){return 0==e?'<div width="100%" style="text-align: center">平<div>':null!=e?formatMoney(e):void 0}}),t.tableParam.columnDefs.push({targets:3,orderable:!1,className:"text-right",title:"上期",name:"column2",data:"column2",width:"120px",render:function(e,t,a,r){return 0==e?'<div width="100%" style="text-align: center">平<div>':null!=e?formatMoney(e):void 0}})}function bbReport_save(){if(null!=bbReportId&&""!=bbReportId){var e=[];if($("#zc_bbreport_table").hasClass("dataTable"))for(var t=$("#zc_bbreport_table").DataTable().data().length,a=0;a<t;a++){let t=$("#zc_bbreport_table").DataTable().data()[a];t.isEdit&&1==t.isEdit&&e.push($("#zc_bbreport_table").DataTable().data()[a])}if($("#lr_bbreport_table").hasClass("dataTable")){var r=$("#lr_bbreport_table").DataTable().data().length;for(a=0;a<r;a++){let t=$("#lr_bbreport_table").DataTable().data()[a];t.isEdit&&1==t.isEdit&&e.push($("#lr_bbreport_table").DataTable().data()[a])}}if($("#xj_bbreport_table").hasClass("dataTable")){var l=$("#xj_bbreport_table").DataTable().data().length;for(a=0;a<l;a++){let t=$("#xj_bbreport_table").DataTable().data()[a];t.isEdit&&1==t.isEdit&&e.push($("#xj_bbreport_table").DataTable().data()[a])}}if($("#qy1_bbreport_table").hasClass("dataTable")){var s=$("#qy1_bbreport_table").DataTable().data().length;for(a=0;a<s;a++){let t=$("#qy1_bbreport_table").DataTable().data()[a];t.isEdit&&1==t.isEdit&&e.push($("#qy1_bbreport_table").DataTable().data()[a])}}if($("#qy2_bbreport_table").hasClass("dataTable")){var o=$("#qy2_bbreport_table").DataTable().data().length;for(a=0;a<o;a++){let t=$("#qy2_bbreport_table").DataTable().data()[a];t.isEdit&&1==t.isEdit&&e.push($("#qy2_bbreport_table").DataTable().data()[a])}}if($("#hbzc_bbreport_table").hasClass("dataTable")){var n=$("#hbzc_bbreport_table").DataTable().data().length;for(a=0;a<n;a++){let t=$("#hbzc_bbreport_table").DataTable().data()[a];t.isEdit&&1==t.isEdit&&e.push($("#hbzc_bbreport_table").DataTable().data()[a])}}if($("#hblr_bbreport_table").hasClass("dataTable")){var i=$("#hblr_bbreport_table").DataTable().data().length;for(a=0;a<i;a++){let t=$("#hblr_bbreport_table").DataTable().data()[a];t.isEdit&&1==t.isEdit&&e.push($("#hblr_bbreport_table").DataTable().data()[a])}}if($("#hbxj_bbreport_table").hasClass("dataTable")){var d=$("#hbxj_bbreport_table").DataTable().data().length;for(a=0;a<d;a++){let t=$("#hbxj_bbreport_table").DataTable().data()[a];t.isEdit&&1==t.isEdit&&e.push($("#hbxj_bbreport_table").DataTable().data()[a])}}if($("#hbqy1_bbreport_table").hasClass("dataTable")){var c=$("#hbqy1_bbreport_table").DataTable().data().length;for(a=0;a<c;a++){let t=$("#hbqy1_bbreport_table").DataTable().data()[a];t.isEdit&&1==t.isEdit&&e.push($("#hbqy1_bbreport_table").DataTable().data()[a])}}if($("#hbqy2_bbreport_table").hasClass("dataTable")){var u=$("#hbqy2_bbreport_table").DataTable().data().length;for(a=0;a<u;a++){let t=$("#hbqy2_bbreport_table").DataTable().data()[a];t.isEdit&&1==t.isEdit&&e.push($("#hbqy2_bbreport_table").DataTable().data()[a])}}var m={param1:JSON.stringify(e)};$.ajax({url:"dgCenter/DgBBReport.saveBbReport.json",type:"post",data:m,dataType:"json",success:function(e){e.success?initBbReport(bbReportId,"1"):bdoErrorBox("失败",e.resultInfo.statusText)}})}else bdoInfoBox("提示","请先选择模板")}$("#tab_bbReport").on("dblclick","table tbody tr.edit-able td",function(){var e="";if($(this).hasClass("bg-success-light"))e=1;else if($(this).hasClass("bg-gray-light"))e=2;else{if(!$(this).hasClass("bg-gray-lighter"))return;e=3}for(var t=$(this).closest("td"),a=(t.parent().index(),t.closest("table")),r=(a.find("tr").length,a.DataTable().context[0].aoColumns[a.DataTable().cell(this).index().column]),l=a.DataTable().row($(this).closest("tr")).data(),s=t.next().text(),o=t.prev().text(),n=0;n<o.length/3;n++)o=o.replace(",","");for(n=0;n<s.length/3;n++)s=s.replace(",","");if((3==e||1==e)&&(r.name.indexOf("column")>=0||r.name.indexOf("note")>=0)){var i=l[r.name];t.html("<span><input type='text' style='width:100%; align=right;'></span>");var d=$(this).find("input");d.val(i),d.focus(),d.on("keydown",function(e){13==e.keyCode&&d.blur()}),d.on("blur",function(){var e=$(this).val().toString().replace(/,/g,"");if(""===e)t.html("");else if(isNaN(e))r.name.indexOf("note")>=0?t.html(e):t.html(i);else{var s=1*e;t.html(s.toFixed(2))}if(t.html()!==l[r.name])if(l[r.name]=t.html(),l.isEdit=1,r.name.indexOf("note")>=0)bbReport_save();else{let e=[];e.push(l.bbSubjectId);var o=0;do{let l=[];for(var n=0;n<e.length;n++){let s=calTable(a,e[n],r.name,t.index());l.push.apply(l,s)}e=l,o++}while(e.length>=0&&o<5);bbReport_save()}})}}),$("#bbReport_refresh").on("click",function(){bdoConfirmBox("保存","重置数据会清空当前所有数据，确认重置数据？",function(){initBbReport(bbReportId,"2")})});var destroyTable=function(e){$("#"+e).hasClass("dataTable")&&($("#"+e).DataTable().clear(),$("#"+e).DataTable().destroy(),$("#"+e).empty())};$("#bb_table").on("click",'button[name="templateDownload"]',function(){var e=$("#bb_table").DataTable().data()[$(this).closest("tr").index()];bdoConfirmBox("保存","确认下载？",function(){downloadFile("dgCenter/DgBBReport.createBbReportFile.json",{param1:e.autoId})})});var calTable=function(table,subjectId,columnName,index){let updateSubjectId=[];for(var len1=table.DataTable().data().length,i=0;i<len1;i++){let obj=table.DataTable().data()[i];if(null!=obj.bbCalFun&&""!=obj.bbCalFun){let calItems=parseCalFunItems(obj.bbCalFun);for(let j=0;j<calItems.length;j++)if(subjectId===calItems[j]){let rpnQueue=parseCalFunAmount(table,calItems,obj.bbCalFun,columnName),calResult=eval(rpnQueue);obj[columnName]=calResult.toFixed(2),table.find("tr").eq(i+1).find("td").eq(index).html(calResult.toFixed(2)),obj.isEdit=1,updateSubjectId.push(obj.bbSubjectId);break}}}return updateSubjectId};function parseCalFunAmount(e,t,a,r){for(var l=e.DataTable().data().length,s=0;s<l;s++){let l=e.DataTable().data()[s];for(let e=0;e<t.length;e++)if(l.bbSubjectId===t[e]){var o=0;null!=l[r]&&""!=l[r]&&(o=l[r]),a=a.replace(t[e],o)}}return a}function parseCalFunItems(e){if(!e)return[];return e.replace(/[-+*\/()]/g," ").split(/\s+/).filter(e=>e.replace(/\d/g,"")&&e.replace(/\d+\.\d+/g,""))}let bbReportPage=new Page({container:"#modal_bbReport",events:{},init(e){}});$("#bb_search").on("click",function(){initbbTable()}),$("#bbReport_end").on("click",function(){null!=bbReportId&&""!=bbReportId?0==checkNum?($("#bbReport_end").blur(),bdoAjaxBox("系统提示","确定完成报备吗？",function(){$.ajax({url:"dgCenter/FUnAuditReport.checkBbReport.json",type:"post",data:{param1:""},dataType:"json",success:function(e){e.success?bdoSuccessBox("操作成功",e.resultInfo.statusText):bdoErrorBox("操作失败",e.resultInfo.statusText)}})})):bdoInfoBox("提示","报表校验不通过，不能完成。"):bdoInfoBox("提示","请先选择模板")})});var SamplingCountPage=e=>{var t,a;t=e.template||tplLoader("dgCenter/html/dg/samplingCount.html"),e.template=t,$("#headtitle").empty().text(e.data.text),a=(()=>{$("#samplingCountTab a").on("show.bs.tab",function(e){var t=e.target.href,a=t.lastIndexOf("#"),l=t.substring(a+1);a=l.lastIndexOf("Tab");var s=l.substring(0,a);r(s)}),$("#dgSamplingCount_subjectId").change(function(){r($("#dgSamplingCount_subjectId").val())})});let r=function(t){var a='<div class="block-content"><table id="samplingCount_table'+t+'" class="table table-bordered table-hover"></table>\t</div>';"PROJECT"==e.data.extraOptions.nodeType?$("#samplingCountProjectTab").html(a):$("#"+t+"Tab").html(a);var r={localParam:{tabNum:!1,url:"finCenter/sampling.querySamplingCount.json",urlparam:{menuId:window.sys_menuId,sqlId:"DG10012",param1:t,lockProjectId:window.CUR_PROJECTID,lockCustomerId:window.CUR_CUSTOMERID,lockYyyy:window.CUR_PROJECT_ACC_YEAR}},tableParam:{select:!0,pageLength:30,ordering:!1,serverSide:!0,columnDefs:[{targets:1,className:"text-left",title:"抽凭方式",name:"sampleMethodName",data:"sampleMethodName",width:"100px",render:function(e,t,a,r){var l="";return l+='<a href="#" name="showSamplingCountResult">'+e+"</a>"}},{targets:2,className:"text-center",title:"样本数量",name:"voucherNum",data:"voucherNum",width:"50px"},{targets:3,className:"text-center",title:"样本数量占发生额总数量的比例",name:"rate1",data:"rate1",width:"50px"},{targets:4,className:"text-right",title:"借方抽样金额",name:"debitOcc",data:"debitOcc",width:"50px",render:function(e,t,a,r){return formatMoney(e)}},{targets:5,className:"text-center",title:"借方抽样金额占借方总发生额比例",name:"rate2",data:"rate2",width:"50px"},{targets:6,className:"text-right",title:"贷方抽样金额",name:"creditOcc",data:"creditOcc",width:"50px",render:function(e,t,a,r){return formatMoney(e)}},{targets:7,className:"text-center",title:"贷方抽样金额占贷方总发生额比例",name:"rate3",data:"rate3",width:"50px"},{targets:8,className:"text-left",title:"抽凭名称",name:"sampleName",data:"sampleName",width:"50px"}]}};BdoDataTable("samplingCount_table"+t,r),$("#samplingCount_table"+t).off("click",'a[name="showSamplingCountResult"]'),$("#samplingCount_table"+t).on("click",'a[name="showSamplingCountResult"]',function(){var a=$("#samplingCount_table"+t).DataTable().data()[$(this).closest("tr").index()].autoId;null!=a&&""!=a&&(SamplingResult({region:"#samplistResultPage",data:e.data,samplingId:a}),$("#modal_samplistResult1").modal("show"))})};(()=>{$(e.region).empty().append(t),function(){var t=!1,l="";"TBSUBJECT"==e.data.extraOptions.nodeType&&""!=e.data.extraOptions.tbSubjectCode?(t=!0,l=e.data.extraOptions.tbSubjectCode):"SUBJECT"==e.data.extraOptions.nodeType&&""!=e.data.extraOptions.userSubjectId?($("#samplingCountTab").html('<li class="active"><a href="#'+e.data.extraOptions.userSubjectId+'Tab">'+e.data.text+"</a></li>"),$("#samplingCountPage").html('<div class="tab-pane active"  id="'+e.data.extraOptions.userSubjectId+'Tab"></div>'),r(e.data.extraOptions.userSubjectId)):t=!0,t&&$.ajax({url:"dgCenter/DgGeneral.query.json",type:"post",data:{menuId:window.sys_menuId,sqlId:"DG10011",lockCustomerId:window.CUR_CUSTOMERID,lockProjectId:window.CUR_PROJECTID,param1:l,start:-1,limit:-1},dataType:"json",success:function(t){if(t.success){if(null!=t.data&&t.data.length>0){for(var l="",s="",o="",n="",i=0;i<t.data.length;i++)0==i?(l=l+'<li class="active"><a href="#'+t.data[i].baseSubjectId+'Tab">'+t.data[i].baseSubjectId+"-"+t.data[i].baseSubjectName+"</a></li>",s=s+'<div class="tab-pane active"  id="'+t.data[i].baseSubjectId+'Tab"></div>',n=t.data[i].baseSubjectId):(l=l+'<li><a href="#'+t.data[i].baseSubjectId+'Tab">'+t.data[i].baseSubjectId+"-"+t.data[i].baseSubjectName+"</a></li>",s=s+'<div class="tab-pane"  id="'+t.data[i].baseSubjectId+'Tab"></div>'),o+='<option value="'+t.data[i].baseSubjectId+'">'+t.data[i].baseSubjectId+"-"+t.data[i].baseSubjectName+"</option>";if("PROJECT"==e.data.extraOptions.nodeType){s='<div class="row"  id="samplingCountProjectTab"></div>',n=t.data[0].baseSubjectId;var d='<div class="row"><div class="col-sm-3">';d+='<div class="form-material">',d+='<select class="js-select2 form-control" id="dgSamplingCount_subjectId"',d+='style="width: 100%;">',d+="</select>",d+="</div>",d+="</div></div>",$("#samplingCountTab").css("display","none"),$("#samplingCountProject").html(d+s),$("#dgSamplingCount_subjectId").html(o)}else $("#samplingCountTab").html(l),$("#samplingCountPage").html(s);r(n),a()}}else bdoErrorBox("失败",t.resultInfo.statusText)}})}(),OneUI.initHelper("slimscroll")})()};function HbAuditProgramPagePlan(e){let t,a,r,l,s,o,n=e.data,i=e.template||tplLoader("dgCenter/html/dg/auditProgramPlan.html");function d(e){return e=e.toFixed(2),(e+="").includes(".")||(e+="."),e.replace(/(\d)(?=(\d{3})+\.)/g,function(e,t){return t+","})}function c(){let e=window.CUR_CUSTOMERID,t=window.CUR_PROJECTID;null!=$("#s_customerId option:checked").val()&&""!=$("#s_customerId option:checked").val()&&(e=$("#s_customerId option:checked").val()),null!=$("#s_projectId option:checked").val()&&""!=$("#s_projectId option:checked").val()&&(t=$("#s_projectId option:checked").val()),$("#selectProjectProgramTable_length").find("label:first").nextAll().remove(),$.ajax({type:"post",url:"cpBase/General.query.json",data:{sqlId:"DG00065",menuId:window.sys_menuId,start:-1,limit:-1,param1:e,param2:t,param10:$("#s_customerSubjectId").val()},dataType:"json",success(e){if(e.success){var t='<label style="position: relative;left: 20px;">标准审计程序:<b style="color: red;">'+(null==e.data[0].companyCount?0:e.data[0].companyCount)+'</b></label><label style="position: relative;left: 20px;">&nbsp;&nbsp;部门审计程序:<b style="color: red;">'+(null==e.data[0].depCount?0:e.data[0].depCount)+'</b></label><label style="position: relative;left: 20px;">&nbsp;&nbsp;自定义审计程序：<b style="color: red;">'+(null==e.data[0].customizeCount?0:e.data[0].customizeCount)+"</b></label>";$("#selectProjectProgramTable_length").find("label").after(t)}}})}function u(t){bdoInProcessingBox("请稍后，正在生成可选项目审计程序!"),$.ajax({type:"post",url:"dgCenter/DgMain.saveProjectProgram.json",data:{param1:$("#s_customerId option:selected").val(),param2:$("#s_projectId option:selected").val(),param3:$("#s_customerSubjectId").val()},dataType:"json",success(a){a.success?(bdoSuccessBox("操作成功",a.resultInfo.statusText),$("#spreadContentDir").trigger("rebuildTree",[{param1:window.CUR_PROJECTID,param2:window.CUR_CUSTOMERID},a=>{$(".js-tree-collapsed").trigger("rebuild",[{data:[a.data[0].treeData],levels:t.deep+2,callback(a){a.expandNode(t.nodeId,{levels:t.deep+2,silent:!0}),a.selectNode(t.nodeId,{silent:!0}),t=e.data=a.getNode(t.nodeId)}}])}]),$("#s_customerId").val("").select2({allowClear:!0,language:"zh-CN",width:"100%",placeholder:"请选择"}),$("#s_projectId").val("").select2({allowClear:!0,language:"zh-CN",width:"100%",placeholder:"请选择"}),$("#s_customerId").val("").trigger("change"),$("#s_projectId").val("").trigger("change"),$("#s_customerSubjectId").val(""),$("#subjectPlanTable").DataTable().ajax.reload()):bdoErrorBox("操作失败",a.resultInfo.statusText)}})}function m(){$("#spreadContentDir").trigger("rebuildTree",[{param1:window.CUR_PROJECTID,param2:window.CUR_CUSTOMERID},t=>{$(".js-tree-collapsed").trigger("rebuild",[{data:[t.data[0].treeData],levels:n.deep+1,callback(t){t.expandNode(n.nodeId,{levels:n.deep+1,silent:!0}),t.selectNode(n.nodeId,{silent:!0}),n=e.data=t.getNode(n.nodeId)}}])}]),swal.close()}e.template=i,$(e.region).html(i),a={props:{programInfo:Object,ecavp:String,rownum:Number},data:()=>({ecavpVal:!1,score:"",originalScore:0,originalVal:!1,scoreCache:{},timer:null}),watch:{ecavpVal(e){this.programInfo["plancs"+this.ecavp]=e?"1":"0",this.originalVal!=e?this.$parent.updateRowMark[this.rownum]+=1:this.$parent.updateRowMark[this.rownum]-=1,this.$parent.updateRowMark[this.rownum]<0&&(this.$parent.updateRowMark[this.rownum]=0),0==e&&(this.score=null,this.originalVal!=e&&this.saveChange())},score(e){if(!this.ecavpVal)return void(this.score=null);if(this.scoreCache[this.score]>0)return void this.saveChange();let t=e;((t=((t=((t=((t=(t+"").replace(/[^\d.]/g,""))+"").replace(/\.{2,}/g,"."))+"").replace(".","$#$").replace(/\./g,"").replace("$#$","."))+"").replace(/^(\-)*(\d+)\.(\d\d).*$/,"$1$2.$3"))+"").indexOf(".")<0&&t+""!=""&&(t=parseFloat(t)),parseFloat(t)>3&&(t=3),this.programInfo["plans"+this.ecavp]=t,this.originalScore!=(""==t?null:t)?this.$parent.updateRowMark[this.rownum]+=1:this.$parent.updateRowMark[this.rownum]-=1,this.$parent.updateRowMark[this.rownum]<0&&(this.$parent.updateRowMark[this.rownum]=0),this.score=t,this.scoreCache[this.score]||(this.scoreCache[this.score]=1),this.originalScore!=(""==t?null:t)&&this.saveChange()}},computed:{scoreCheckClass(){return this.score!=this.programInfo["subjectScore"+this.ecavp]?"subject-score-diff":""},labelClass(){let e="css-checkbox-primary";""!=this.scoreCheckClass&&(e="css-checkbox-danger");let t=["css-input","css-checkbox","control-label",e];return this.editEcavpVal&&t.push("css-input-disabled"),t},scoreClass:()=>["form-control text-center"],editScore(){return!this.ecavpVal},editEcavpVal(){return!("1"==this.programInfo.isNeedToAudit&&this.programInfo.tbSubject>"")}},mounted(){this.initEcavp()},methods:{initEcavp(){this.originalScore=this.programInfo["plans"+this.ecavp],this.originalVal=1==this.programInfo["plancs"+this.ecavp],this.ecavpVal=this.originalVal,this.score=this.originalScore},saveChange(){if(this.originalScore==this.score&&this.originalVal==this.ecavpVal)return;if(this.ecavpVal&&""===this.score)return;this.timer&&(clearTimeout(this.timer),this.timer=null);let e=this.programInfo.autoId,t=this.score,a="1",r=this.ecavp,l=this;this.ecavpVal||(a="0",t=""),this.timer=setTimeout(function(){l=this,$.ajax({url:"dgCenter/DgMain.updateIdentifiedScore.json",dataType:"json",data:{param1:e,param2:t,param3:r,param4:a},bdolxLoader:!1}).done(function(e){e.success?(l.originalScore=t,l.originalVal=a,OneUI.notifySuccess("保存成功！")):(OneUI.notifyError(e.resultInfo.statusText),l.ecavpVal=l.originalVal,l.score=l.originalScore)}),clearTimeout(this.timer),this.timer=null}.bind(this),1e3)}},template:'<div :class="scoreCheckClass">\t<label :class="labelClass" >\t\t<input type="checkbox" v-model="ecavpVal" :disabled="editEcavpVal">\t\t<span></span>\t</label>\t<div class="has-success">\t\t<div class="form-material">\t\t\t<input :class="scoreClass" type="text" v-model="score" :disabled="editScore">\t\t</div>\t</div></div>'},s={props:{programInfo:Object,rownum:Number,currentValue:String,datas:Array},data(){return{editMan:this.currentValue,editManCach:this.currentValue,timer:null}},watch:{editMan(e){let t;this.programInfo.subjectEditors=e,this.currentValue!=e?this.$parent.updateRowMark[this.rownum]+=1:this.$parent.updateRowMark[this.rownum]-=1,this.$parent.updateRowMark[this.rownum]<0&&(this.$parent.updateRowMark[this.rownum]=0),this.datas.map(function(a){e==a.id&&(t=""==a.value?a.text:a.value)}),this.saveEditMan(this.programInfo.userSubject,t)}},computed:{editManDisabled(){return!this.programInfo.tbSubject||"1"!=this.programInfo.isNeedToAudit||CUR_USERID!=JSON.parse($.sessionStorage("projectManager"))&&void 0!=JSON.parse($.sessionStorage("projectManager"))}},mounted(){},methods:{saveEditMan(e,t){this.editManCach!==this.editMan&&(this.timer&&(clearTimeout(this.timer),this.timer=null),this.timer=setTimeout(function(){let a=this;$.ajax({url:"dgCenter/DgMain.updateIdentifiedEditor.json",dataType:"json",data:{param1:a.programInfo.autoId,param2:a.editMan,param3:e,param4:t},bdolxLoader:!1}).done(function(e){e.success?(a.editManCach=a.editMan,OneUI.notifySuccess("保存成功！")):(a.editMan=a.editManCach,OneUI.notifyError(e.resultInfo.statusText))}),clearTimeout(this.timer),this.timer=null}.bind(this),1e3))}},template:'<div class="form-material">\t<select class="form-control" v-model="editMan" style="margin-left:5px" :disabled="editManDisabled">\t\t<option v-for="(data, index) in datas" :value="data.id">{{ data.text }}</option>\t</select></div>'},o={props:{programInfo:Object,isNeedToAudit:String,rownum:Number},data:()=>({isNeedToAuditVal:!1,originalVal:!1,valCache:{},timer:null}),watch:{isNeedToAuditVal(e){this.programInfo.isNeedToAudit=e?"1":"0",this.originalVal!=e?this.$parent.updateRowMark[this.rownum]+=1:this.$parent.updateRowMark[this.rownum]-=1,this.$parent.updateRowMark[this.rownum]<0&&(this.$parent.updateRowMark[this.rownum]=0),this.originalVal!=this.programInfo.isNeedToAudit&&this.saveChange()}},computed:{checkClass:()=>"",labelClass(){let e="css-checkbox-primary";""!=this.checkClass&&(e="css-checkbox-danger");let t=["css-input","css-checkbox","control-label",e];return this.editIsNeedToAuditVal&&t.push("css-input-disabled"),t},editIsNeedToAuditVal(){return 1!=this.programInfo.isEditable}},mounted(){this.initVal()},methods:{initVal(){this.originalVal=1==this.programInfo.isNeedToAudit,this.isNeedToAuditVal=this.originalVal},saveChange(){if(this.isNeedToAuditVal==this.originalVal)return;let e="0";new Promise((t,a)=>{this.isNeedToAuditVal?(e="0",t({})):bdoConfirmBox("提示","确认不编制该科目?",a=>{if(a){let a=this,r=$("#subjectPlanTable").dataTable().fnGetData(a.rownum);0!=r.remain||0!=r.debitTotalOcc||0!=r.creditTotalOcc||0!=r.balance?($("#notAuditReasonsModal_autoId").val(r.autoId),$("#notAuditReasonsModal_isNeedToAudit").val("0"),$("#notAuditReasonsText").val(r.notAuditReasons),$("#notAuditReasonsModal").find('button[data-dismiss="modal"]').parent().hide(),$("#notAuditReasonsModal").modal("show")):(e="1",t({}))}else e="0",t({})},()=>{e="0",t({})})}).then(e=>{this.timer&&(clearTimeout(this.timer),this.timer=null);let t=this.programInfo.autoId,a="1";this.isNeedToAuditVal||(a="0");let r=this;this.timer=setTimeout(function(){$.ajax({url:"dgCenter/DgSubjectIdentify.updateHbIdentifiedNeedAudit.json",dataType:"json",data:{param1:t,param2:a},bdolxLoader:!1}).done(function(e){e.success?(r.originalVal=r.isNeedToAuditVal,r.programInfo.isNeedToAudit=r.isNeedToAuditVal,OneUI.notifySuccess("保存成功！"),r.$parent.updateEditAble(r.rownum,"1"===a)):(OneUI.notifyError(e.resultInfo.statusText),r.isNeedToAuditVal=r.originalVal)}),clearTimeout(this.timer),this.timer=null}.bind(this),1e3)})}},template:'<div >\t<label :class="labelClass" >\t\t<input type="checkbox" v-model="isNeedToAuditVal" :disabled="editIsNeedToAuditVal">\t\t<span></span>\t</label></div>'},l={el:"#subjectPlanTable tbody",components:{"score-edit":a,"edit-man-edit":s,"edit-need-audit":o},data:{rowData:[],updateRowMark:[],editMans:[]},methods:{getUpateData(){let e=this,t=[];return $.each(this.updateRowMark,(a,r)=>{r>0&&t.push(e.rowData[a])}),t},reset(){let e=this;$.each(this.$children,(e,t)=>{t.originalVal=1==t.programInfo["cs"+t.ecavp],t.originalScore=t.programInfo["s"+t.ecavp]}),$.each(this.updateRowMark,(t,a)=>{e.updateRowMark[t]=0})},updateEditAble(e,t){t||$.each(this.$children,(t,a)=>{let r=a.$options;"score-edit"==r._componentTag&&r.propsData.rownum==e&&(a.originalScore=0,a.score=0,a.originalVal=!1,a.ecavpVal=!1),"edit-man-edit"==r._componentTag&&r.propsData.rownum==e&&(a.editManCach="",a.editMan="")})}}},t=((e,t)=>{return"<score-edit :ecavp=\"'"+e+'\'" :program-info="rowData['+t+']" :rownum="'+t+'"></score-edit>'}),getEditManEdit=((e,t)=>{return'<edit-man-edit :datas="editMans" :program-info="rowData['+t+']" :rownum="'+t+'" :current-value="\''+e+"'\"></edit-man-edit>"}),getEditNeedAudit=((e,t)=>{return"<edit-need-audit :is-need-to-audit=\"'"+e+'\'" :program-info="rowData['+t+']" :rownum="'+t+'"></edit-need-audit>'});var p=new Page({random:(new Date).getTime()+parseInt(1e3*Math.random()),container:e.region,events:{"#filter":"change,onFilterChange","#filterEditor":"change,onFilterEditorChange","#exchangeSetSubjectors":"click,onExchangeSubjectEditorsClick","#checkSubjectPlan":"click,onCheckSubjectPlanClick","#editButtonAll":"click,onEditAllClick","#resetButtonAll":"click,onResetAllClick","#createDgAllButton":"click,createDgAllClick","#projectProgram":"click,createProjectProgramClick","#searchProjectBtn":"click,selectProjectProgramClick","#deleteDgAllButton":"click,deleteDgAllButtonClick","#exportAuditProgramPlan":"click,onExportAuditProgramPlanClick","#setIdentifiedEcavpRecommendValue":"click,onSetIdentifiedEcavpRecommendValueBtnClick","#editProgramPageTabLink":"shown.bs.tab,OnEditProgramPageTabLinkShownBsTab","#insertProjectProgram":"click,onInsertProjectProgramClick","#searchResetProjectBtn":"click,onResetProjectProgramClick","#initScheduleControl":"click,onInitScheduleControl","#closeMergeAuditProgramPlanButton":"click,closeMergeAuditProgramPlanButtonClick","#submitSelect":"click,onSubmitSelect","#notAuditReasonsBtn":"click,onNotAuditReasonsBtnClick"},_template:e.template||tplLoader("dgCenter/html/dg/auditProgramPlan.html"),_data:e.data,selectEditors:null,bindEvents(){$("#setIdentifiedEcavpRecommendValue").remove();$("#subjectPlanTable").unbind("initEditVm"),$("#subjectPlanTable").bind("initEditVm",((e,t)=>{e.preventDefault(),(l=$.extend(!1,{},l)).data.editMans=p.selectEditors,l.data.rowData=$.extend(!1,{},t),l.data.updateRowMark=(()=>{let e=[];for(let a=0,r=t.length;a<r;a++)e.push(0);return e})(),r=new Vue(l)}).bind(this)),$("#subjectPlanTable").on("click",'button.table-btn-operate[name="createDgSub"]',this.onCreateDgSub),$("#subjectPlanTable").on("click",'button.table-btn-operate[name="editProgramPlan"]',this.onEditProgramPlan),$("#subjectPlanTable").on("click",'button.table-btn-operate[name="repeatDgSub"]',this.onRepeatDgSub),$("#subjectPlanTable").on("click",'button.table-btn-operate[name="createMergeDgSub"]',this.onCreateMergeDgSub),$('input[name="checkSubjectAll"]').off("click"),$('input[name="checkSubjectAll"]').on("click",this.onCheckSubjectAll),$('input[name="checkBaseSubjectAll"]').off("click"),$('input[name="checkBaseSubjectAll"]').on("click",this.onCheckBaseSubjectAll),$("#subjectPlanTable").on("dblclick","tbody td",this.onEditReasons)},querySetting(){$.ajax({type:"post",url:"dgCenter/MaterialitySetting.queryMater.json",dataType:"json",data:{param1:window.CUR_PROJECTID},success:function(e){if(null!=e.data&&null!=e.data[0].data){var t=e.data[0].data;"1"==t.settingType?$("#rateA").val(d(t.settingImportValue1)):"2"==t.settingType?$("#rateA").val(d(t.settingImportValue2)):"3"==t.settingType?$("#rateA").val(d(t.settingImportValue3)):"4"==t.settingType?$("#rateA").val(d(t.settingImportValue4)):"5"==t.settingType?$("#rateA").val(d(t.settingImportValue5)):"6"==t.settingType&&$("#rateA").val(d(t.settingImportValue6)),$("#rateB").val(d(t.finalSettingTypeValue1)),$("#rateC").val(d(t.finalSettingTypeValue2))}else $("#rateA").val(0),$("#rateB").val(0),$("#rateC").val(0)}})},queryGroupMembers(){$.ajax({type:"post",url:"dgCenter/DgProject.getProjectMember.json",data:{param1:window.CUR_PROJECTID,param2:window.CUR_CUSTOMERID},dataType:"json",success(e){if(e.success){var t="";p.selectEditors=e.data.map(e=>({id:e.id,text:e.name,value:e.name})),t='<option value="" selected="selected"></option>',$.each(e.data,function(e,a){null!=a.name&&""!=a.id&&(t+='<option value="'+a.id+'" style="color: #000">'+a.name+"</option>")}),$("#filterEditor").html(t),$("#filterSubjectEditor").html(t)}}})},ECAVP_CONSTS:["E","C","A","V","P"],onSaveECAVPClick(e){if(CUR_USERID!=JSON.parse($.sessionStorage("projectManager"))&&void 0!=JSON.parse($.sessionStorage("projectManager")))bdoInfoBox("","只有当前项目负责人才能编辑科目编制人!");else{let e=r.getUpateData();if(e.length<1)return void bdoInfoBox("","没有修改数据！");let t=!0,a={},l="",s=e.map(e=>($.each(p.ECAVP_CONSTS,(r,s)=>{let o=e["plans"+s],n=e["plancs"+s];!t||1!=n||""!=o&&o&&parseFloat(o).toFixed(2)!=(0).toFixed(2)||(t=!1,a=e,l=s)}),{autoId:e.autoId,projectId:e.projectId,customerId:e.customerId,plansE:e.plansE,plansC:e.plansC,plansA:e.plansA,plansV:e.plansV,plansP:e.plansP,plancsE:e.plancsE,plancsC:e.plancsC,plancsA:e.plancsA,plancsV:e.plancsV,plancsP:e.plancsP,subjectEditors:e.subjectEditors}));if(!t)return void bdoErrorBox("保存失败","TB科目【"+a.tbSubject+"】客户科目【"+a.userSubject+"】的认定（"+l+"）没有设置分值！");$.ajax({type:"post",url:"dgCenter/dgMain.updatePlanScore.json",async:!0,data:{param1:JSON.stringify(s)},dataType:"json",success(e){e.success?($("#subjectPlanTable").DataTable().ajax.reload(),r.reset(),bdoSuccessBox("保存成功",e.resultInfo.statusText)):bdoErrorBox("保存失败",e.resultInfo.statusText)}})}},onEditAllClick(e){$("#editButtonAll").blur();var t=$("#subjectPlanTable").dataTable().fnGetData($(e.currentTarget).attr("data-row"));let a=[];$.each(t,function(e,r){null!=t[e].tbSubject&&""!=t[e].tbSubject||a.push(t[e].userSubject)}),$("#auditProgramList").empty(),$.each(a,function(e,t){let r="<label>客户科目：</label><label>"+a[e]+"</label><br/>";$("#auditProgramList").append(r)}),$("#auditProgramPlanModal").modal("show")},deleteDgAllButtonClick(e){$("#auditProgramList").empty()},createDgAllClick(t){var a=$("#subjectPlanTable").dataTable().fnGetData($(t.currentTarget).attr("data-row"));let r=[],l=[];function s(){$("#spreadContentDir").trigger("rebuildTree",[{param1:window.CUR_PROJECTID,param2:window.CUR_CUSTOMERID},t=>{$(".js-tree-collapsed").trigger("rebuild",[{data:[t.data[0].treeData],levels:n.deep+1,callback(t){t.expandNode(n.nodeId,{levels:n.deep+1,silent:!0}),t.selectNode(n.nodeId,{silent:!0}),n=e.data=t.getNode(n.nodeId)}}])}]),$("#subjectPlanTable").DataTable().ajax.reload(),$("#auditProgramPlanModal").modal("hide"),swal.close()}$.each(a,function(e,t){null!=a[e].userSubject&&""!=a[e].userSubject&&null!=a[e].tbSubject&&""!=a[e].tbSubject&&l.push(a[e])}),$.each(l,function(e,t){r.push({param1:"002",param2:window.CUR_PROJECTID,param3:window.CUR_CUSTOMERID,param4:l[e].tbSubjectName,param5:l[e].tbSubjectCode,param6:l[e].tbSubjectCode,param9:l[e].autoId,param10:window.CUR_PROJECT_ACC_YEAR})}),bdoInProcessingBox("请稍后，正在批量生成审计程序!");let o=!1;setTimeout(()=>{o||s()},6e4),$.ajax({type:"post",url:"dgCenter/DgMain.createDgTreeAll.json",data:{param13:JSON.stringify(r)},dataType:"json",bdolxLoader:!1,success:function(e){e.success?(bdoSuccessBox("操作成功",e.resultInfo.statusText),o=!0,s()):bdoErrorBox("操作失败",e.resultInfo.statusText)}})},createProjectProgramClick(e){let t=!0;$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",async:!1,data:{menuId:window.sys_menuId,sqlId:"DG00197",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,start:-1,limit:-1},dataType:"json",success(e){e.success&&CUR_USERID!=e.data[0].manager&&(bdoErrorBox("","无权限！"),t=!1)}}),$("#auditProgramPlanModal").modal("hide"),p.searchProjectForm.jsonData={s_customerId:"",s_projectId:"",s_customerSubjectId:""},p.selectProjectProgramSider.show(),p.selectProjectProgramTableCfg.localParam.urlparam=p.getDefaultFilter(),p.selectProjectProgramTableCfg.localParam.urlparam.param11=window.CUR_CUSTOMERID,p.selectProjectProgramTableCfg.localParam.urlparam.param12=window.CUR_PROJECTID,p.selectProjectProgramTableCfg.localParam.urlparam.param13=window.CUR_CUSTOMERID,p.selectProjectProgramTableCfg.localParam.urlparam.param14=window.CUR_PROJECTID,$("#s_customerId").val("").select2({allowClear:!0,language:"zh-CN",width:"100%",placeholder:"请选择"}),$("#s_projectId").val("").select2({allowClear:!0,language:"zh-CN",width:"100%",placeholder:"请选择"}),$("#s_customerId").val("").trigger("change"),$("#s_projectId").val("").trigger("change"),$("#s_customerSubjectId").val(""),$.ajax({type:"post",url:"cpBase/Combo.getCustomerList.json",data:{page:-1,start:-1},dataType:"json",async:!0,success:function(e){let t=e.data;$("#s_customerId").empty(),$("#s_customerId").append($("<option>",{value:"",text:""})),$.each(t,function(e,t){$("#s_customerId").append($("<option>",{value:t.value,text:t.label}))})}}),$("#s_customerId").change(function(){$.ajax({type:"post",url:"cpBase/Combo.getCustomerProjectList.json",data:{param1:$("#s_customerId option:selected").val(),page:-1,start:-1},dataType:"json",async:!0,success:function(e){$("#s_projectId").empty(),$.each(e.data,function(e,t){$("#s_projectId").append($("<option>",{value:t.value,text:t.label}))})}})}),t&&(BdoDataTable("selectProjectProgramTable",p.selectProjectProgramTableCfg),c(),uiBlocksApi($(".block .block-themed .block-opt-hidden"),"content_toggle"))},selectProjectProgramClick(e){p.selectProjectProgramTableCfg.localParam.urlparam=p.getDefaultFilter(),null==$("#s_customerId option:checked").val()||""==$("#s_customerId option:checked").val()?p.selectProjectProgramTableCfg.localParam.urlparam.param11=window.CUR_CUSTOMERID:p.selectProjectProgramTableCfg.localParam.urlparam.param11=$("#s_customerId option:checked").val(),null==$("#s_projectId option:checked").val()||""==$("#s_projectId option:checked").val()?p.selectProjectProgramTableCfg.localParam.urlparam.param12=window.CUR_PROJECTID:p.selectProjectProgramTableCfg.localParam.urlparam.param12=$("#s_projectId option:checked").val(),p.selectProjectProgramTableCfg.localParam.urlparam.param13=window.CUR_CUSTOMERID,p.selectProjectProgramTableCfg.localParam.urlparam.param14=window.CUR_PROJECTID,p.selectProjectProgramTableCfg.localParam.urlparam.param15=$("#s_customerSubjectId").val(),$("#selectProjectProgramTable").DataTable().ajax.reload(),c()},onResetProjectProgramClick(e){$("#s_customerId").val("").select2({allowClear:!0,language:"zh-CN",width:"100%",placeholder:"请选择"}),$("#s_projectId").val("").select2({allowClear:!0,language:"zh-CN",width:"100%",placeholder:"请选择"}),$("#s_customerId").val("").trigger("change"),$("#s_projectId").val("").trigger("change"),$("#s_customerSubjectId").val(""),p.selectProjectProgramTableCfg.localParam.urlparam=p.getDefaultFilter(),p.selectProjectProgramTableCfg.localParam.urlparam.param11=window.CUR_CUSTOMERID,p.selectProjectProgramTableCfg.localParam.urlparam.param12=window.CUR_PROJECTID,p.selectProjectProgramTableCfg.localParam.urlparam.param13=window.CUR_CUSTOMERID,p.selectProjectProgramTableCfg.localParam.urlparam.param14=window.CUR_PROJECTID,p.selectProjectProgramTableCfg.localParam.urlparam.param15=$("#s_customerSubjectId").val(),$("#selectProjectProgramTable").DataTable().ajax.reload(),c()},onInsertProjectProgramClick(e){let t=$("#selectProjectProgramTable").dataTable().fnGetData($(e.currentTarget).attr("data-row")),a=[],r=[];if(0==t.length)return bdoInfoBox("提示","请先选择一个有审计程序的项目!"),!1;$.each(t,function(e,l){null!=t[e].userSubjectId&&""!=t[e].userSubjectId&&t[e].subjectId===t[e].userSubjectId?a.push(t[e]):r.push(t[e])}),0!=r.length?bdoConfirmBox("提示","当前客户科目编号为空不会生成审计程序，科目编号不一致的需要手动生成审计程序，是否继续进行操作?",e=>{p.selectProjectProgramSider.hide(),u(n)}):(p.selectProjectProgramSider.hide(),u(n))},onResetAllClick(e){$("#resetButtonAll").blur(),bdoConfirmBox("提示","重置后会删除所有已生成的审计程序，是否继续重置？",t=>{var a=$("#subjectPlanTable").dataTable().fnGetData($(e.currentTarget).attr("data-row"));let r=[];$.each(a,function(e,t){let l=a[e].userSubject;null!=l&&(l=l.substr(0,l.indexOf("-"))),r.push({param1:"002",param2:window.CUR_PROJECTID,param3:window.CUR_CUSTOMERID,param4:window.CUR_PROJECT_ACC_YEAR,param5:a[e].tbSubjectName,param6:a[e].tbSubjectCode,param9:l})}),bdoInProcessingBox("请稍后，正在批量重置审计程序!");let l=!1;setTimeout(()=>{!0===l||m()},6e4),$.ajax({type:"post",url:"dgCenter/DgMain.resetAuditProduresAll.json",data:{param13:JSON.stringify(r)},dataType:"json",bdolxLoader:!1,success:function(e){e.success?(bdoSuccessBox("操作成功",e.resultInfo.statusText),l=!0,m()):bdoErrorBox("操作失败",e.resultInfo.statusText)}})})},onFilterChange(e){switch($("#filter").val()){case"all":p.auditProgramTableCfg.localParam.urlparam.param5=1,p.auditProgramTableCfg.localParam.urlparam.param6=null,p.auditProgramTableCfg.localParam.urlparam.param7=null;break;case"std":p.auditProgramTableCfg.localParam.urlparam.param6=1,p.auditProgramTableCfg.localParam.urlparam.param5=null,p.auditProgramTableCfg.localParam.urlparam.param7=null;break;case"sub":p.auditProgramTableCfg.localParam.urlparam.param7=1,p.auditProgramTableCfg.localParam.urlparam.param5=null,p.auditProgramTableCfg.localParam.urlparam.param6=null}$("#subjectPlanTable").DataTable().ajax.reload()},onFilterEditorChange(e){var t=$("#filterEditor option:selected").val();p.auditProgramTableCfg.localParam.urlparam.param10=t,$("#subjectPlanTable").DataTable().ajax.reload()},onExchangeSubjectEditorsClick(e){CUR_USERID==JSON.parse($.sessionStorage("projectManager"))||void 0==JSON.parse($.sessionStorage("projectManager"))?($('input[name="checkSubjectAll"]').prop("checked",!1),this.queryGroupMembers(),$("#selectSubjectUpdateEditor").modal("show"),$("#selectSubjectPlanTable").DataTable().ajax.reload()):bdoInfoBox("提示","只有当前项目负责人才能挑选科目!")},onCheckSubjectPlanClick(e){let t=$("#filterSubjectEditor option:selected").val(),a=$("#filterSubjectEditor option:selected").text(),r=[];$.each($('input[name="checkSubject"]:checkbox'),function(){this.checked&&r.push($(this).val())}),""!=t&&null!=t?r.length<1?bdoInfoBox("提示","请至少选择一项科目!"):$.ajax({type:"post",url:"dgCenter/DgMain.updateSubjectEditors.json",dataType:"json",data:{param1:t,param2:JSON.stringify(r),param3:a},success:function(e){e.success?(bdoSuccessBox("提示","修改科目编制人成功"),$("#selectSubjectPlanTable").DataTable().ajax.reload(),$("#subjectPlanTable").DataTable().ajax.reload()):bdoErrorBox("提示",e.resultInfo.statusText),$('input[name="checkSubjectAll"]').prop("checked",!1)}}):bdoInfoBox("提示","请选择科目编制人!")},exportAPPlanToDg(){let t=this.auditProgramTableCfg,a=getColumnsInfo(t.tableParam.columnDefs),r=applyIf({},t.localParam.urlparam);delete r.sort,r.page="",r.start="",r.limit="",r.queryUrl=t.localParam.url,r.columnMap=a,r=JSON.stringify(r);let l=encodeURI("计划控制表"),s={menuId:window.sys_menuId,param1:r,title:l};$.ajax({url:"dgCenter/ExportOtherDg.exportAPPlanTbl.json",data:s,type:"post",dataType:"json",success:function(t){if(t.success){if(t.data&&t.data.length>0){let a=t.data[0].fileData,r=t.data[0].fileName;t.data[0].isNew;bdoInfoBox("成功",r+"导出成功！"),saveAs(dataURLtoFile(a,r),r),getSubjecttree({param1:window.CUR_PROJECTID,param2:$("#onlyMyselfCheckBox").get(0).checked?"1":""},t=>{$(".js-tree-collapsed").trigger("rebuild",[{data:[t.data[0].treeData],levels:e.data.deep+2,callback(t){t.expandNode(e.data.nodeId,{levels:e.data.deep+2,silent:!0}),t.selectNode(e.data.nodeId,{silent:!0}),e.data=t.getNode(e.data.nodeId)}}])})}}else bdoErrorBox("失败",t.resultInfo.statusText)}})},onExportAuditProgramPlanClick(e){p.exportAPPlanToDg()},onSetIdentifiedEcavpRecommendValueBtnClick(e){$("#setIdentifiedEcavpRecommendValue").blur(),$.ajax({type:"post",url:"dgCenter/DgEcavp.setSubjectIdentifiedEcavpRecommendValue.json",dataType:"json",data:{},success:function(e){e.success?($("#subjectPlanTable").DataTable().ajax.reload(),bdoSuccessBox("成功","科目认定分值设置成功！")):bdoErrorBox("失败",e.resultInfo.statusText)}})},onInitScheduleControl(e){$.ajax({type:"post",url:"dgCenter/HbMergeTb.createScheduleControl.json",dataType:"json",data:{},success:function(e){e.success?($("#subjectPlanTable").DataTable().ajax.reload(),bdoSuccessBox("成功","初始化合并计划控制表成功！")):bdoErrorBox("失败",e.resultInfo.statusText)}})},closeMergeAuditProgramPlanButtonClick(e){$("#mergeAuditProgramList").empty()},onCreateMergeDgSub(e){var t=$("#subjectPlanTable").dataTable(),a=$(e.currentTarget).attr("data-row"),r=t.fnGetData(a);"1"==r.isNeedToAudit?($("#selectAllBaseSubjectTable").prop("tb-index",a),$("#selectAllBaseSubjectTable").DataTable().ajax.reload(),$("#selectAllBaseSubjectModal").modal("show")):bdoErrorBox("操作失败","TB科目：【"+r.tbSubject+"】请先勾选是否编制！")},selectAllBaseSubjectConfig:{localParam:{url:"dgCenter/DgGeneral.query.json",urlparam:{menuId:window.sys_menuId,sqlId:"DG00032"},tabNum:!0},tableParam:{scrollX:!0,select:!1,ordering:!1,serverSide:!0,autoWidth:!1,fixedThead:!0,lengthChange:!1,paging:!1,fixedHeight:"480px",columnDefs:[{targets:1,orderable:!1,className:"text-center",width:"20px",title:'<label class="css-input css-checkbox css-checkbox-primary"><input type="checkbox" name="checkBaseSubjectAll"/><span></span></label>',render:(e,t,a,r)=>'<label class="css-input css-checkbox css-checkbox-primary"><input type="checkbox" name="checkBaseSubject" value="'+a.label+'"/><span></span></label>'},{targets:2,title:"标准科目",name:"subjectName",data:"subjectName",className:"text-center",width:"50px",render:(e,t,a,r)=>a.subjectId+"-"+e}]}},onNotAuditReasonsBtnClick(e){var t=$("#notAuditReasonsText").val(),a=$("#notAuditReasonsModal_isNeedToAudit").val();"true"==a&&(a="1"),"1"==a||""!=t?$.ajax({url:"dgCenter/DgSubjectIdentify.updateHbIdentifiedReasons.json",dataType:"json",data:{param1:$("#notAuditReasonsModal_autoId").val(),param2:t,param3:a},bdolxLoader:!1,success(e){e.success?($("#subjectPlanTable").DataTable().draw(!1),$("#notAuditReasonsModal").modal("hide"),OneUI.notifySuccess("保存成功！")):($("#subjectPlanTable").DataTable().draw(!1),$("#notAuditReasonsModal").modal("hide"),bdoErrorBox("失败",e.resultInfo.statusText))}}):bdoInfoBox("提示","请填写不编制理由！")},onSubmitSelect(e){let t=[];if($.each($('input[name="checkBaseSubject"]:checkbox'),function(){this.checked&&t.push($(this).val())}),t.length<1)return void bdoInfoBox("提示","请至少选择一项科目!");let a=$("#subjectPlanTable").dataTable(),r=$("#selectAllBaseSubjectTable").prop("tb-index"),l=a.fnGetData(parseInt(r));$("#selectAllBaseSubjectModal").modal("hide"),$.ajax({type:"post",url:"dgCenter/HbMergeTb.createAuditProcess.json",dataType:"json",data:{param1:"002",param2:window.CUR_PROJECTID,param3:window.CUR_CUSTOMERID,param4:l.tbSubjectName,param5:l.tbSubjectCode,param6:l.tbSubjectCode,jsonData:JSON.stringify(t),param9:l.autoId},success:function(e){e.success?($("#selectSubjectPlanTable").DataTable().ajax.reload(),$("#subjectPlanTable").DataTable().ajax.reload(),m(),bdoInfoBox("提示",e.resultInfo.statusText,1e3)):bdoErrorBox("提示",e.resultInfo.statusText),$('input[name="checkBaseSubjectAll"]').prop("checked",!1)}})},init(t){$("#subjectIndex").text("【"+e.data.extraOptions.indexId+"】"),this.queryGroupMembers(),BdoDataTable("selectAllBaseSubjectTable",this.selectAllBaseSubjectConfig),BdoDataTable("subjectPlanTable",this.auditProgramTableCfg),BdoDataTable("selectSubjectPlanTable",this.selectSubjectPlanTableCfg),this.bindEvents(),OneUI.initHelper("slimscroll"),this.querySetting(),this.selectProjectProgramSider=side({el:"#selectProjectProgramSider",autoHide:!1}),this.searchProjectForm=createForm(this.searchProjectFormCfg)},searchProjectFormCfg:{options:{propsData:{jsonData:{s_customerId:"",s_projectId:"",s_customerSubjectName:""}}},props:{jsonData:Object},display:"tableform-one",column:4,id:"searchProjectForm",data:()=>({ajaxConfig:{type:"POST",url:"",dataType:"json",success(e){}}}),items:[{id:"s_customerId",label:"客户名称",colspan:1,rowspan:1,type:"select",html:""},{id:"s_projectId",label:"项目名称",colspan:1,type:"select",html:""},{id:"s_customerSubjectId",type:"input",label:"科目编号",colspan:1}]},searchProjectForm:null,selectProjectProgramSider:null,selectProjectProgramTable:null,selectProjectProgramTableCfg:{localParam:{url:"dgCenter/DgGeneral.query.json",urlparam:{menuId:window.sys_menuId,sqlId:"",start:-1,limit:-1},tabNum:!0},tableParam:{scrollX:!0,select:!0,order:[2,"asc"],pageLength:30,createdRow(e,t,a){$(e).attr("dataIndex",a)},serverSide:!0,columnDefs:[{targets:1,orderable:!0,title:"项目名称",name:"projectName",data:"projectName",width:"200px"},{targets:2,orderable:!0,title:"所选项目科目编号",name:"subjectId",data:"subjectId",className:"text-center",width:"80px"},{targets:3,orderable:!0,title:"所选项目科目名称",name:"subjectName",data:"subjectName",className:"text-center",width:"100px"},{targets:4,orderable:!0,title:"客户科目编号",name:"userSubjectId",data:"userSubjectId",className:"text-center",width:"80px",render(e,t,a,r){var l=a.subjectId,s=a.userSubjectId;return null!=s&&""!=s&&l!=s?'<label style="background-color: red;color: white">'+a.userSubjectId+"</label>":a.userSubjectId}},{targets:5,orderable:!0,title:"客户科目名称",name:"userSubjectName",data:"userSubjectName",className:"text-center",width:"100px"},{targets:6,orderable:!0,title:"索引号",name:"indexId",data:"indexId",className:"text-center",width:"100px"},{targets:7,orderable:!0,title:"程序名称",className:"text-center",name:"dgName",data:"dgName",width:"150px"},{targets:8,orderable:!0,title:"创建人",className:"text-center",name:"CREATED_BY",data:"CREATED_BY",width:"40px",render:(e,t,a,r)=>a.__ucreateUser.userName}]}},getDefaultFilter:()=>({menuId:window.sys_menuId,sqlId:"DG01005",start:-1,limit:-1}),auditProgramTable:null,bgColerMap:{},onEditProgramPlan(e){var t=$("#subjectPlanTable").dataTable().fnGetData($(e.currentTarget).attr("data-row"));let a;$.sessionStorage("subjectEditors",t.subjectEditors),searchSubjecttreeNode(JSON.parse($.sessionStorage("subjecttree")),function(e){"SUBJECT"==e.extraOptions.nodeType&&e.extraOptions.userSubjectId==t.userSubjectId&&((a=e).workpaperId=a.extraOptions.workpaperId,a.currentNode=$.extend(!1,{},e),a.currentNode.currentNode=null)}),void 0==a||null==a?bdoInfoBox("提示","请先生成审计程序"):$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",data:{menuId:window.sys_menuId,sqlId:"DG00184",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,param3:t.autoId},dataType:"json",success:function(e){let r=!1;e.success&&e.data&&e.data.length>0&&e.data[0].programCount>0&&(r=!0,p.editProgramPageNodeData=a,p.editProgramPageNodeData.tbRowData=t,$("#editProgramPageTabLink").tab("show")),r||bdoInfoBox("","没有审计程序，请先生成审计程序！",1e3)}})},editProgramPageNodeData:{},OnEditProgramPageTabLinkShownBsTab(e){$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",async:!1,data:{menuId:window.sys_menuId,sqlId:"DG00197",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,start:-1,limit:-1},dataType:"json",success(e){e.success&&(CUR_USERID==e.data[0].manager?EditProgramPage({region:"#editProgramPageTab",data:p.editProgramPageNodeData}):bdoErrorBox("","无权限！"))}})},onCreateDgSub(t){var a=$("#subjectPlanTable").dataTable().fnGetData($(t.currentTarget).attr("data-row"));null!=a.userSubject&&""!=a.userSubject&&null!=a.tbSubject&&""!=a.tbSubject?$.ajax({type:"post",url:"dgCenter/dgMain.createDgTree.json",data:{param1:"002",param2:window.CUR_PROJECTID,param3:window.CUR_CUSTOMERID,param4:a.tbSubjectName,param5:a.tbSubjectCode,param6:a.tbSubjectCode,param9:a.autoId,refreshFlg:1},dataType:"json",success:function(t){t.success?(bdoSuccessBox("操作成功",t.resultInfo.statusText),$("#spreadContentDir").trigger("rebuildTree",[{param1:window.CUR_PROJECTID,param2:window.CUR_CUSTOMERID},t=>{$(".js-tree-collapsed").trigger("rebuild",[{data:[t.data[0].treeData],levels:n.deep+1,callback(t){t.expandNode(n.nodeId,{levels:n.deep+1,silent:!0}),t.selectNode(n.nodeId,{silent:!0}),n=e.data=t.getNode(n.nodeId)}}])}])):bdoErrorBox("操作失败",t.resultInfo.statusText)}}):bdoErrorBox("操作失败","客户科目：【"+a.userSubject+"】请先添加关系对照！")},onRepeatDgSub(t){let a=$("#subjectPlanTable").dataTable().fnGetData($(t.currentTarget).attr("data-row"));bdoConfirmBox("提示","重置会删除原来的审计程序，确定重置吗？",t=>{let r=a.userSubject;$.ajax({type:"post",url:"dgCenter/dgMain.resetAuditProdures.json",data:{param1:"002",param2:window.CUR_PROJECTID,param3:window.CUR_CUSTOMERID,param4:window.CUR_PROJECT_ACC_YEAR,param5:a.tbSubjectName,param6:a.tbSubjectCode,param9:r},dataType:"json",success:function(t){t.success?(bdoSuccessBox("操作成功",t.resultInfo.statusText),$("#spreadContentDir").trigger("rebuildTree",[{param1:window.CUR_PROJECTID,param2:window.CUR_CUSTOMERID},t=>{$(".js-tree-collapsed").trigger("rebuild",[{data:[t.data[0].treeData],levels:n.deep+1,callback(t){t.expandNode(n.nodeId,{levels:n.deep+1,silent:!0}),t.selectNode(n.nodeId,{silent:!0}),n=e.data=t.getNode(n.nodeId)}}])}])):bdoErrorBox("操作失败",t.resultInfo.statusText)}})})},onCheckSubjectAll(e){1==$('input[name="checkSubjectAll"]').is(":checked")?$("input[name='checkSubject']").each(function(){this.checked=!0}):($('input[name="checkSubjectAll"]').prop("checked",!1),$("input[name='checkSubject']").each(function(){this.checked=!1}))},onCheckBaseSubjectAll(e){1==$('input[name="checkBaseSubjectAll"]').is(":checked")?$("input[name='checkBaseSubject']").each(function(){this.checked=!0}):($('input[name="checkBaseSubjectAll"]').prop("checked",!1),$("input[name='checkBaseSubject']").each(function(){this.checked=!1}))},onEditReasons(e){if("notAuditReasons"===$("#subjectPlanTable").DataTable().context[0].aoColumns[$(this).index()].name){var t=$("#subjectPlanTable").DataTable().data()[$(this).closest("tr").index()];if("1"==t.isNeedToAudit){if(null==t.notAuditReasons||""==t.notAuditReasons)return;$("#notAuditReasonsModal_isNeedToAudit").val(t.isNeedToAudit)}$("#notAuditReasonsText").val(t.notAuditReasons),$("#notAuditReasonsModal_autoId").val(t.autoId),$("#notAuditReasonsModal").find('button[data-dismiss="modal"]').parent().show(),$("#notAuditReasonsModal").modal("show")}},selectSubjectPlanTableCfg:{localParam:{url:"dgCenter/DgGeneral.query.json",urlparam:{menuId:window.sys_menuId,sqlId:"HB00019",param1:n.extraOptions.customerId,param2:n.extraOptions.projectId,param3:window.CUR_PROJECT_ACC_YEAR},tabNum:!0},tableParam:{scrollX:!0,select:!1,ordering:!1,serverSide:!0,autoWidth:!1,fixedThead:!0,lengthChange:!1,paging:!1,fixedHeight:"480px",columnDefs:[{targets:1,orderable:!1,className:"text-center",width:"50px",title:'<label class="css-input css-checkbox css-checkbox-primary"><input type="checkbox" name="checkSubjectAll"/><span></span></label>',render(e,t,a,r){let l="";return null!=a.tbSubject&&""!=a.tbSubject&&(l='<label class="css-input css-checkbox css-checkbox-primary"><input type="checkbox" name="checkSubject" value="'+a.autoId+'"/><span></span></label>'),l}},{targets:2,title:"TB科目",name:"tbSubject",data:"tbSubject",className:"text-left",width:"100px"},{targets:3,title:"科目编制人",name:"__usubjectEditorUser",data:"__usubjectEditorUser",className:"text-center",width:"80px",render:(e,t,a,r)=>e?e.userName:""}]}},auditProgramTableCfg:{localParam:{url:"dgCenter/DgGeneral.query.json",urlparam:{menuId:window.sys_menuId,sqlId:"HB00019",param1:n.extraOptions.customerId,param2:n.extraOptions.projectId,param3:window.CUR_PROJECT_ACC_YEAR,param10:$("#filterEditor option:selected").val()},tabNum:!0},tableParam:{scrollX:!0,select:!1,ordering:!1,serverSide:!0,autoWidth:!1,fixedThead:!0,fixedHeight:"480px",drawCallback(e){$("#subjectPlanTable tbody").replaceWith(e.nTBody);var t=this.fnGetData();$("#subjectPlanTable").trigger("initEditVm",[t])},preDrawCallback(e){r&&r.$destroy()},columnDefs:[{targets:(()=>(cnt=0,++cnt))(),orderable:!1,className:"text-center",title:"处理",data:null,width:"100px",render:(e,t,a,r)=>`<div class="">\n\t\t\t\t\t<button class="btn btn-xs btn-info table-btn-operate bdo-drop-btn" type="button" name="createMergeDgSub" data-placement="top" title="生成审计程序" data-toggle="tooltip" data-row="${r.row}">\n\t\t\t\t\t\t<i class="fa fa-send"></i> \n\t\t\t\t\t</button>\n\t\t\t\t\t <button class="btn btn-xs btn-info table-btn-operate bdo-drop-btn" type="button" name="repeatDgSub" data-placement="top" title="重置审计程序" data-toggle="tooltip" data-row="${r.row}">\n\t\t\t\t\t\t<i class="fa fa-repeat"></i>\n\t\t\t\t\t </button>\n\t\t\t\t\t</div>`},{targets:++cnt,orderable:!0,title:"TB科目名称",name:"tbSubjectName",data:"tbSubjectName",width:"90px",className:"hidden"},{targets:++cnt,orderable:!0,title:"TB科目",name:"tbSubject",data:"tbSubject",width:"90px",className:"text-left"},{targets:++cnt,className:"text-right",orderable:!0,title:"期初数",name:"remain",data:"remain",width:"100px",render:function(e,t,a,r){return formatMoney(e)}},{targets:++cnt,className:"text-right",orderable:!0,title:"期末数",name:"balance",data:"balance",width:"100px",render:function(e,t,a,r){return formatMoney(e)}},{targets:++cnt,title:"科目编制人",name:"科目编制人",data:"subjectEditors",width:"120px",className:"text-center",render:(e,t,a,r)=>getEditManEdit(e,r.row)},{targets:++cnt,title:"是否编制",name:"isNeedToAudit",data:"isNeedToAudit",width:"30px",className:"text-center",render:(e,t,a,r)=>getEditNeedAudit(e,r.row)},{targets:++cnt,orderable:!0,title:"不编制理由",name:"notAuditReasons",data:"notAuditReasons",width:"120px",className:"text-left"}]}}});return $("#initScheduleControl").show(),p}SamplingResult=(e=>{var t;t=e.template||tplLoader("dgCenter/html/dg/samplingResult.html"),e.template=t;let a=e.samplingId;var r,l;(new Date).getFullYear();function s(e){return parseInt(e)<10&&(e="0"+e),e}$(".date-picker").datepicker({autoclose:!0,todayHighlight:!0,language:"zh-CN",format:"yyyy-mm-dd",minViewMode:0});var o=1,n={localParam:{tabNum:!0,url:"cpBase/General.query.json",urlparam:{sqlId:"DG10002",menuId:window.sys_menuId,param1:window.CUR_PROJECTID,param17:"1",param18:a,lockCustomerId:window.CUR_CUSTOMERID}},tableParam:{select:!0,scrollX:!0,scrollY:!1,lengthChange:!0,ordering:!1,serverSide:!0,pageLength:30,columnDefs:[{targets:o++,className:"text-left",title:"凭证编号",name:"oldVoucherId",data:"oldVoucherId",width:"60px"},{targets:o++,className:"text-left",title:"凭证日期",name:"vchDate",data:"vchDate",width:"100px"},{targets:o++,className:"text-left",title:"抽凭方式",name:"sampleMethod",data:"sampleMethod",width:"150px"},{targets:o++,className:"text-left",title:"抽凭人",name:"sampleUserName",data:"sampleUserName",width:"60px"},{targets:o++,className:"text-left",title:"科目编号",name:"subjectId",data:"subjectId",width:"60px"},{targets:o++,className:"text-left",title:"科目名称",name:"subjectFullName",data:"subjectFullName",width:"150px"},{targets:o++,className:"text-left",title:"核算类型",name:"assTotalName",data:"assTotalName",width:"200px"},{targets:o++,className:"text-left",title:"对方科目",name:"oppositeAccountLast",data:"oppositeAccountLast",width:"200px",render(e,t,a,r){if(null!=e){return'<div title="'+e+'" data-toggle="tooltip" style="text-overflow: ellipsis; white-space: nowrap;overflow: hidden;width: 200px;">'+e+"</div>"}return e}},{targets:o++,className:"text-right",title:"借方发生金额",name:"debitValue",data:"debitValue",width:"100px",render:function(e,t,a,r){return formatMoney(e)}},{targets:o++,className:"text-right",title:"贷方发生金额",name:"crebitValue",data:"crebitValue",width:"100px",render:function(e,t,a,r){return formatMoney(e)}},{targets:o++,className:"text-left",title:"审计结论",name:"auditResultName",data:"auditResultName",width:"200px",render(e,t,a,r){if(null!=e){return'<div title="'+e+'" data-toggle="tooltip" style="text-overflow: ellipsis; white-space: nowrap;overflow: hidden;width: 200px;">'+e+"</div>"}return e}},{targets:o++,className:"text-left",title:"附件索引号",name:"fileIndexId",data:"fileIndexId",width:"200px",render(e,t,a,r){if(null!=e){return'<div title="'+e+'" data-toggle="tooltip" style="text-overflow: ellipsis; white-space: nowrap;overflow: hidden;width: 200px;">'+e+"</div>"}return e}},{targets:o++,className:"text-left",title:"备注",name:"remark",data:"remark",width:"200px",render(e,t,a,r){if(null!=e){return'<div title="'+e+'" data-toggle="tooltip" style="text-overflow: ellipsis; white-space: nowrap;overflow: hidden;width: 200px;">'+e+"</div>"}return e}},{targets:o++,className:"text-left",title:"原始凭证内容完整",name:"contentComplete",data:"contentComplete",width:"110px"},{targets:o++,className:"text-left",title:"有授权批准",name:"authorize",data:"authorize",width:"100px"},{targets:o++,className:"text-left",title:"账务处理正确",name:"handleCorrect",data:"handleCorrect",width:"100px"},{targets:o++,className:"text-left",title:"账证的内容相符",name:"contentMatch",data:"contentMatch",width:"100px"},{targets:o++,className:"text-left",title:"账证的金额相符",name:"amountMatch",data:"amountMatch",width:"100px"},{targets:o++,className:"text-left",title:"截止测试正确",name:"cutoffCorrect",data:"cutoffCorrect",width:"100px"},{targets:o++,className:"text-left",title:"核对内容6",name:"customizeResult1",data:"customizeResult1",width:"100px"},{targets:o++,className:"text-left",title:"核对内容7",name:"customizeResult2",data:"customizeResult2",width:"100px"},{targets:o++,className:"text-left",title:"核对内容8",name:"customizeResult3",data:"customizeResult3",width:"100px"},{targets:o++,className:"text-left",title:"核对内容9",name:"customizeResult4",data:"customizeResult4",width:"100px"},{targets:o++,className:"text-left",title:"抽凭名称",name:"sampleName",data:"sampleName",width:"100px",render(e,t,a,r){if(null!=e){return'<div title="'+e+'" data-toggle="tooltip" style="text-overflow: ellipsis; white-space: nowrap;overflow: hidden;width: 200px;">'+e+"</div>"}return e}},{targets:o++,orderable:!0,className:"text-left",title:"关联抽凭名称",name:"relateSampleName",data:"relateSampleName",width:"100px",render(e,t,a,r){if(null!=e){return'<div title="'+e+'" data-toggle="tooltip" style="text-overflow: ellipsis; white-space: nowrap;overflow: hidden;width: 200px;">'+e+"</div>"}return e}}]}},i={localParam:{tabNum:!1,url:"finCenter/sampling.querySamplingCount.json",urlparam:{menuId:window.sys_menuId,sqlId:"DG10012",param1:"",param2:a,param3:"1",lockProjectId:window.CUR_PROJECTID,lockCustomerId:window.CUR_CUSTOMERID,lockYyyy:window.CUR_PROJECT_ACC_YEAR}},tableParam:{select:!0,pageLength:30,scrollX:!0,scrollCollapse:!0,lengthChange:!1,ordering:!1,serverSide:!0,columnDefs:[{targets:1,className:"text-left",title:"抽凭方式",name:"sampleMethodName",data:"sampleMethodName",width:"100px"},{targets:2,className:"text-center",title:"样本数量",name:"voucherNum",data:"voucherNum",width:"50px"},{targets:3,className:"text-center",title:"样本数量占发生额总数量的比例",name:"rate1",data:"rate1",width:"50px"},{targets:4,className:"text-right",title:"借方抽样金额",name:"debitOcc",data:"debitOcc",width:"50px",render:function(e,t,a,r){return formatMoney(e)}},{targets:5,className:"text-center",title:"借方抽样金额占借方总发生额比例",name:"rate2",data:"rate2",width:"50px"},{targets:6,className:"text-right",title:"贷方抽样金额",name:"creditOcc",data:"creditOcc",width:"50px",render:function(e,t,a,r){return formatMoney(e)}},{targets:7,className:"text-center",title:"贷方抽样金额占贷方总发生额比例",name:"rate3",data:"rate3",width:"50px"},{targets:8,className:"text-left",title:"抽凭名称",name:"sampleName",data:"sampleName",width:"50px"}]}},d=function(e){$("#modal_samplingCountResult").modal("show"),$.ajax({url:"finCenter/sampling.querySamplingCondition.json",type:"post",data:{lockCustomerId:window.CUR_CUSTOMERID,lockYyyy:window.CUR_PROJECT_ACC_YEAR,lockProjectId:window.CUR_PROJECTID,param1:e},dataType:"json",success:function(e){if(e.success&&e.data.length>0){BdoDataTable("dgSamplingResultTable",n);var t=DicJsonlData.responseJSON["抽样方式"],a=(DicJsonlData.responseJSON["凭证字"],DicJsonlData.responseJSON["错报风险等级"]),r=DicJsonlData.responseJSON["控制测试获取的保证程度"],o=DicJsonlData.responseJSON["实质性分析程序获取的保证程度"],d=DicJsonlData.responseJSON["能否从其他实质性程序中获取该财务报表领域的相关认定的审计保证"],c=DicJsonlData.responseJSON["是否能够应对样本总体的变量因素"],u="";if(l=e.data[0].samplist.sampleMethod,"7"!==e.data[0].samplist.sampleMethod){$("#sampleResult_count_show").removeAttr("display"),i.localParam.urlparam.param1=e.data[0].firstSubjectId,BdoDataTable("dgSamplingCountTable",i),u+='<table border= "1" width="1000"><tr><td rowspan="8" algin="center" width="25%">抽凭条件</td><td width="25%">科目</td>',""!=e.data[0].samplist.subjectname&&null!=e.data[0].samplist.subjectname?u=u+'<td colspan="2">'+e.data[0].samplist.subjectname+"</td></tr>":u+='<td colspan="2"></td></tr>',u=u+'<tr><td>抽凭方式</td><td colspan="2">'+t[e.data[0].samplist.sampleMethod]+"</td></tr>",u=e.data[0].samplist.vchDateStart==e.data[0].samplist.vchDateEnd?u+'<tr><td>抽凭期间</td><td colspan="2">'+e.data[0].samplist.vchDateStart+"</td></tr>":u+'<tr><td>抽凭期间</td><td colspan="2">'+e.data[0].samplist.vchDateStart+"-"+e.data[0].samplist.vchDateEnd+"</td></tr>",""!=e.data[0].samplist.assItemName&&null!=e.data[0].samplist.assItemName?u=u+'<tr><td>核算类型</td><td colspan="2">'+e.data[0].samplist.assItemName+"</td></tr>":u+='<tr><td>核算类型</td><td colspan="2"></td></tr>';var m="",p="",b="";null!=e.data[0].samplist.amountStart&&(m=formatMoney2(e.data[0].samplist.amountStart,1)),null!=e.data[0].samplist.amountEnd&&(p=formatMoney2(e.data[0].samplist.amountEnd,1)),b=""==m||null==m||""!=p&&null!=p?""!=m&&null!=m||""==p||null==p?m+"-"+p:"小于等于"+p:"大于等于"+m;u=u+'<tr><td>抽凭范围</td><td width="25%">'+("1"==e.data[0].samplist.amountType?"借方发生额":"-1"==e.data[0].samplist.amountType?"贷方发生额":"借方或贷方发生额")+'</td><td width="25%">'+b+"</td></tr>",""!=e.data[0].samplist.cullSubjectname&&null!=e.data[0].samplist.cullSubjectname?u=u+'<tr><td rowspan="3">剔除条件</td><td>对方科目</td><td>'+e.data[0].samplist.cullSubjectname+"</td></tr>":u+='<tr><td rowspan="3">剔除条件</td><td>对方科目</td><td></td></tr>';var g="",f="",h="";null!=e.data[0].samplist.cullAmountStart&&(g=formatMoney2(e.data[0].samplist.cullAmountStart,1)),null!=e.data[0].samplist.cullAmountEnd&&(f=formatMoney2(e.data[0].samplist.cullAmountEnd,1)),h=""==g||null==g||""!=f&&null!=f?""!=g&&null!=g||""==f||null==f?g+"-"+f:"小于等于"+f:"大于等于"+g;u=(u=u+"<tr><td>"+("1"==e.data[0].samplist.cullAmountType?"借方发生额":"-1"==e.data[0].samplist.cullAmountType?"贷方发生额":"借方或贷方发生额")+"</td><td>"+h+"</td></tr>")+"<tr><td>剔除原因</td><td>"+e.data[0].samplist.cullReason+"</td></tr>",u+="</table>"}else $("#sampleResult_count_show").css("display","none"),u+='<table border= "1" width="1000"><tr><td rowspan="4" algin="center">抽凭条件</td><td>科目</td>',""!=e.data[0].samplist.subjectname&&null!=e.data[0].samplist.subjectname?u=u+'<td colspan="2">'+e.data[0].samplist.subjectname+"</td></tr>":u+='<td colspan="2"></td></tr>',u=u+'<tr><td>抽凭方式</td><td colspan="2">'+t[e.data[0].samplist.sampleMethod]+"</td></tr>";if("7"==e.data[0].samplist.sampleMethod)u=u+'<tr><td>抽取资产负债表日前后张数</td><td colspan="2">'+e.data[0].samplist.cutoffNum+"</td></tr>",null!=e.data[0].samplist.cutoffAmount?u=u+'<tr><td>截止抽样金额</td><td colspan="2">大于等于'+formatMoney2(e.data[0].samplist.cutoffAmount,1)+"</td></tr>":u+='<tr><td>截止抽样金额</td><td colspan="2"></td></tr>',u+="</table>";else if("8"==e.data[0].samplist.sampleMethod)u=(u+="\n")+'<table border= "1" width="1000"><tr><td text-algin="center" width="25%">具体参数</td><td width="25%">自定义方法与理由</td><td colspan="2">'+e.data[0].samplist.customizeReason+"</td></tr>",u+="</table>";else{var x=null!=e.data[0].risk?a[e.data[0].risk]:"&nbsp;",w=null!=e.data[0].control?r[e.data[0].control]:"",I=null!=e.data[0].analysis?o[e.data[0].analysis]:"",y=null!=e.data[0].pledge?d[e.data[0].pledge]:"&nbsp;",v=null!=e.data[0].rFactor?e.data[0].rFactor:"",_=null!=e.data[0].actualImportant?formatMoney2(e.data[0].actualImportant,1):"",j=null!=e.data[0].initialAmount?e.data[0].initialAmount:"&nbsp;",C=null!=e.data[0].intAmount?e.data[0].intAmount:"",T=null!=e.data[0].variable?c[e.data[0].variable]:"",D=null!=e.data[0].samplingCount?e.data[0].samplingCount:"&nbsp;",S=null!=e.data[0].adjustAmount?e.data[0].adjustAmount:"",P=null!=e.data[0].calAmount?e.data[0].calAmount:"",R=null!=e.data[0].calRemark&&""!=e.data[0].calRemark?e.data[0].calRemark:"&nbsp;";u+="\n",u=(u+='<table border= "1" width="1000"><tr><td rowspan="12" algin="center" width="25%">具体参数</td><td width="25%">样本总体金额</td><td width="25%">剔除条件的金额</td><td width="25%">剔除后样本总体金额</td></tr>')+"<tr><td>"+formatMoney2(e.data[0].totalAmount,1)+"</td><td>"+formatMoney2(e.data[0].cullAmount,1)+"</td><td>"+formatMoney2(e.data[0].samplingAmount,1)+"</td></tr>",u=(u+="<tr><td>错报风险等级</td><td>控制测试获取的保证程度</td><td>实质性分析程序获取的保证程度</td></tr>")+"<tr><td>"+x+"</td><td>"+w+"</td><td>"+I+"</td></tr>",u=(u+="<tr><td>能否从其他实质性程序中获取该财务报表领域的相关认定的审计保证</td><td>其他实质性程序抽样R因子</td><td>实际执行的重要性</td></tr>")+"<tr><td>"+y+"</td><td>"+v+"</td><td>"+_+"</td></tr>",u=(u+="<tr><td>初始样本量</td><td>初始样本量总计(不包括小数点)</td><td>是否能够应对样本总体的变量因素</td></tr>")+"<tr><td>"+j+"</td><td>"+C+"</td><td>"+T+"</td></tr>",u=(u+="<tr><td>剔除后样本总体数量</td><td>审计确认样本量</td><td>公式计算出的样本量</td></tr>")+"<td>"+D+"</td><td>"+S+"</td><td>"+P+"</td></tr>",u=(u+="<tr><td>备注</td><td></td><td></td></tr>")+"<td>"+R+"</td><td></td><td></td></tr>",u+="</table>"}if("3"==e.data[0].samplist.sampleMethod){u=(u+="\n")+'<table border= "1" width="1000"><tr><td rowspan="'+(e.data[0].range.length+1)+'" algin="center" width="20%">自定义金额范围</td><td width="20%">大于等于</td><td width="20%">小于</td><td width="20%">总数</td><td width="20%">抽凭数</td></tr>';for(var k=0;k<e.data[0].range.length;k++){var N="",E="";null!=e.data[0].range[k].startAmount&&(N=formatMoney2(e.data[0].range[k].startAmount,1)),null!=e.data[0].range[k].endAmount&&(E=formatMoney2(e.data[0].range[k].endAmount,1)),u=u+"<tr><td>"+N+"</td><td>"+E+"</td><td>"+e.data[0].range[k].totalCount+"</td><td>"+e.data[0].range[k].samplingCount+"</td></tr>"}u+="</table>"}$("#samplistResult_Condition").html(u),$("#sampleUser").html("抽凭人："+e.data[0].samplist.sampleUserName+"&nbsp;抽凭时间："+(A=e.data[0].samplist.sampleTime,O=new Date(A),B=O.getFullYear(),M=O.getMonth()+1,U=O.getDate(),F=O.getHours(),V=O.getMinutes(),q=O.getSeconds(),B+"-"+s(M)+"-"+s(U)+" "+s(F)+":"+s(V)+":"+s(q)))}else bdoErrorBox("失败",e.resultInfo.statusText);var A,O,B,M,U,F,V,q}})};(()=>{$(e.region).empty().append(t),$("#samplingInfoEditResult_auditResult").html(ComboLocalDicOption(!0,"抽凭结论")),d(a),OneUI.initHelper("slimscroll")})(),$("#dgSamplingResultTable").on("click",'button[name="samplingInfoFileBtn"]',function(){var e=$("#dgSamplingResultTable").DataTable().data()[$(this).closest("tr").index()];!1,$("#modal_samplingFileUpload").modal("show"),r=e.autoId,c.attachTableCfg.localParam.urlparam.param5="",c.attachTableCfg.localParam.urlparam.param6="2",c.attachTableCfg.tableParam.columnDefs[2].title="索引号",c.attachTableCfg.tableParam.columnDefs[2].sTitle="索引号",c.attachTableCfg.localParam.urlparam.param8=e.oldVoucherId,c.attachTableCfg.localParam.urlparam.param9=e.vchDate,BdoDataTable("samplingFileUploadResultTable",c.attachTableCfg),$("#upload_samplingFileBtn").css("display","none"),$("#samplingInfoEditResult_auditResult").val(e.auditResult),$("#samplingInfoEditResult_remark").val(e.remark),$("#samplingInfoEditResult_customizeResultName1").val(e.customizeResultName1),$("#samplingInfoEditResult_customizeResultName2").val(e.customizeResultName2),$("#samplingInfoEditResult_customizeResultName3").val(e.customizeResultName3),$("#samplingInfoEditResult_customizeResultName4").val(e.customizeResultName4),"否"==e.contentComplete?$("[name='samplingInfoEditResult_contentComplete'][data-result=0]").click():$("[name='samplingInfoEditResult_contentComplete'][data-result=1]").click(),"否"==e.authorize?$("[name='samplingInfoEditResult_authorize'][data-result=0]").click():$("[name='samplingInfoEditResult_authorize'][data-result=1]").click(),"否"==e.handleCorrect?$("[name='samplingInfoEditResult_handleCorrect'][data-result=0]").click():$("[name='samplingInfoEditResult_handleCorrect'][data-result=1]").click(),"否"==e.contentMatch?$("[name='samplingInfoEditResult_contentMatch'][data-result=0]").click():$("[name='samplingInfoEditResult_contentMatch'][data-result=1]").click(),"否"==e.amountMatch?$("[name='samplingInfoEditResult_amountMatch'][data-result=0]").click():$("[name='samplingInfoEditResult_amountMatch'][data-result=1]").click(),"否"==e.cutoffCorrect?$("[name='samplingInfoEditResult_cutoffCorrect'][data-result=0]").click():$("[name='samplingInfoEditResult_cutoffCorrect'][data-result=1]").click(),"否"==e.customizeResult1?$("[name='samplingInfoEditResult_customizeResult1'][data-result=0]").click():"是"==e.customizeResult1?$("[name='samplingInfoEditResult_customizeResult1'][data-result=1]").click():($("[name='samplingInfoEditResult_customizeResult1'][data-result=0]").removeAttr("checked"),$("[name='samplingInfoEditResult_customizeResult1'][data-result=1]").removeAttr("checked")),"否"==e.customizeResult2?$("[name='samplingInfoEditResult_customizeResult2'][data-result=0]").click():"是"==e.customizeResult2?$("[name='samplingInfoEditResult_customizeResult2'][data-result=1]").click():($("[name='samplingInfoEditResult_customizeResult2'][data-result=0]").removeAttr("checked"),$("[name='samplingInfoEditResult_customizeResult2'][data-result=1]").removeAttr("checked")),"否"==e.customizeResult3?$("[name='samplingInfoEditResult_customizeResult3'][data-result=0]").click():"是"==e.customizeResult3?$("[name='samplingInfoEditResult_customizeResult3'][data-result=1]").click():($("[name='samplingInfoEditResult_customizeResult3'][data-result=0]").removeAttr("checked"),$("[name='samplingInfoEditResult_customizeResult3'][data-result=1]").removeAttr("checked")),"否"==e.customizeResult4?$("[name='samplingInfoEditResult_customizeResult4'][data-result=0]").click():"是"==e.customizeResult4?$("[name='samplingInfoEditResult_customizeResult4'][data-result=1]").click():($("[name='samplingInfoEditResult_customizeResult4'][data-result=0]").removeAttr("checked"),$("[name='samplingInfoEditResult_customizeResult4'][data-result=1]").removeAttr("checked")),u.localParam.urlparam.param1=e.projectId,u.localParam.urlparam.param3=e.oldVoucherId,u.localParam.urlparam.param4=e.vchDate,u.localParam.urlparam.lockCustomerId=e.customerId,u.localParam.urlparam.lockYyyy=e.vchDate.substr(0,4),BdoDataTable("samplingVoucherDetailResult_table",u)});let c=new Page({container:"#modal_samplingFileUpload",events:{"#refreshAttachTableBtn_samplingFileUploadResult":"click,onRrefreshAttachTable","#upload_samplingFileUploadResult":"click,onUpload"},init(e){this.uploadWorkpagerPage=createForm(this.uploadWorkpagerPageCfg),this.listener()},uploadWorkpagerPageCfg:{options:{propsData:{jsonData:{workpager:[],customerId:window.CUR_CUSTOMERID,projectId:window.CUR_PROJECTID,subjectTreeId:"",autoId:null}}},props:{jsonData:Object},display:"tableform-one",column:1,id:"uploadSamplingFileResultForm",data:()=>({ajaxConfig:{type:"POST",url:"dgCenter/DgMain.updateSamplingDgFile.json",dataType:"json",success(e){e.success?(bdoSuccessBox("成功",e.resultInfo.statusText),$("#uploadSamplingFormModal").modal("hide"),$("#samplingFileUploadResultTable").DataTable().ajax.reload(),"2"==c.attachTableCfg.localParam.urlparam.param6&&$("#samplingVoucherDetailResult_table").DataTable().ajax.reload()):bdoErrorBox("失败",e.resultInfo.statusText)}},uploadMode:"STD"}),methods:{onUploadDraftFileClick(e){$("#workpager").fileinput("getFilesCount")<=0?bdoErrorBox("失败","当前无任何文件！"):this.uploadFile(!0,{param1:"SAMPLING",param2:r,param3:c.attachTableCfg.localParam.urlparam.param6})},resetFileClick(e){$("#workpager").fileinput("refresh"),$("#workpager").fileinput("clear"),$("#workpager").fileinput("reset")}},buttons:[{id:"resetFileBtn",icon:"fa fa-refresh",style:"btn-primary",text:"重置",typeAttr:{"v-on:click":"resetFileClick"}},{id:"uploadDraftFileBtn",icon:"fa fa-upload",style:"btn-primary",text:"上传",typeAttr:{"v-on:click":"onUploadDraftFileClick"}},{id:"cancelUploadDraftFileBtn",icon:"fa-arrow-left",style:"btn-warning",text:"取消",typeAttr:{"data-dismiss":"modal"}}],items:[{id:"workpager",type:"file",label:"文件",rowspan:1,colspan:2,validate:{rules:{}},typeAttr:{multiple:!0},show:!0,plugin:{name:"fileinput",options:{allowedFileExtensions:["xls","xlsx","xltx","xlsm","xltm","xlsb","xlam","jpg","png","doc","docx","zip","rar","pdf"],uploadUrl:"dgCenter/DgDownload.uploadTempFile.json",uploadExtraData:()=>({})}}}]},uploadWorkpagerPage:null,attachTableCfg:{localParam:{url:"dgCenter/DgGeneral.query.json",urlparam:{menuId:window.sys_menuId,sqlId:"DG10006",param1:window.CUR_CUSTOMERID,param2:"",param4:window.CUR_PROJECTID,param5:"",param6:"",param7:""},tabNum:!0},tableParam:{scrollX:!0,scrollCollapse:!0,select:!0,serverSide:!0,lengthChange:!0,createdRow(e,t,a){$(e).data("sortNum",t.sortNum),$(e).data("dataIndex",a)},columnDefs:[{targets:(()=>(cnt=0,++cnt))(),orderable:!1,className:"text-center",title:"处理",data:null,width:"120px",render:function(e,t,a,r){var l="";return l+='<button class="btn btn-xs table-btn-operate btn-primary" type="button" name="downloadFile" data-placement="top" title="下载" data-toggle="tooltip" data-row="'+r.row+'">\t<i class="fa fa-download"></i></button>',/^.*?\.(jpg|jpeg|bmp|gif|png|pdf)$/.test(e.fileName.toLowerCase())&&(l+='<button class="btn btn-xs table-btn-operate btn-success" type="button" name="onlinepreview" data-placement="top" title="在线预览" data-toggle="tooltip" data-row="'+r.row+'">\t<i class="fa fa-eye"></i></button>'),l}},{targets:++cnt,name:"sortNum",data:"sortNum",visible:!1},{targets:++cnt,orderable:!0,className:"edit-indexid",title:"索引号",name:"fileIndexId",data:"fileIndexId",width:"150px",render:function(e,t,a,r){return"1"==a.relateType?a.tempFileIndexId:e}},{targets:++cnt,orderable:!0,title:"文件名称",name:"fileName",data:"fileName",width:"150px"},{targets:++cnt,orderable:!0,title:"上传时间",name:"uploadDate",data:"uploadDate",width:"150px",render:function(e,t,a,r){return new Date(e).format("yyyy-MM-dd HH:mm:ss")}},{targets:++cnt,orderable:!0,title:"上传人",name:"__uuploadUserName",data:"__uuploadUserName",width:"150px"}]}},onRrefreshAttachTable(e){e.preventDefault(),$("#samplingFileUploadResultTable").DataTable().ajax.reload()},onUpload(e){e.preventDefault(),c.uploadWorkpagerPage.jsonData.autoId=null,c.uploadMode="STD",$("#uploadSamplingFormModal").modal("show")},updateFileIndexId(e,t,a,r){let l=a.dataTable().api(!0).cell(t).data();if(l!=r&&r){let e=a.dataTable().api(!0).cell(t).row().data();$.ajax({url:"dgCenter/DgMain.updateDgIndexId.json",type:"post",data:{jsonData:JSON.stringify([{autoId:e.autoId,customerId:e.customerId,fileIndexId:r}])},dataType:"json",success(e){e.success?(t.css("padding","6px 8px"),t.html(r),a.dataTable().api(!0).cell(t).data(r)):bdoErrorBox("失败",e.resultInfo.statusText)}})}else l==r&&(t.css("padding","6px 8px"),t.html(r),a.dataTable().api(!0).cell(t).data(r))},onIndexColDbclick(e){console.log("onIndexColDbclick");let t=$("#samplingFileUploadResultTable").dataTable(),a=$(this),r=t.api(!0).cell(this).data(),l=$('<input style="width: 60%; height: 80%;    max-height: 2em; margin-top: 1px;"/>'),s=$('<button class="btn btn-success" style="font-size: 12px;width: 15%;height: 80%;max-height: 2em;margin-left: 5px;padding: 1px;margin-top: -4px;"><i class="fa fa-check"></i></button>');a.css("padding",0),l.val(r),a.html(l),a.append(s),s.click(function(e){c.updateFileIndexId(e,a,t,l.val())}),l.focus()},listener(){let e=(e,t)=>{$.ajax({url:"dgCenter/DgMain.querySamplingDgFileExist.json",type:"post",data:e,dataType:"json",success(e){e.success?t(e):bdoErrorBox("失败",e.resultInfo.statusText)}})};$("#samplingFileUploadResultTable").on("click",'button.table-btn-operate[name="reUploadFile"]',e=>{let t=$("#samplingFileUploadResultTable").dataTable().fnGetData($(e.currentTarget).attr("data-row"));c.uploadWorkpagerPage.jsonData.autoId=t.autoId,c.uploadWorkpagerPage.uploadMode="RE",$("#uploadSamplingFormModal").modal("show")}),$("#samplingFileUploadResultTable").on("click",'button.table-btn-operate[name="downloadFile"]',t=>{let a=$("#samplingFileUploadResultTable").dataTable().fnGetData($(t.currentTarget).attr("data-row"));var r=!0;$.ajax({type:"post",url:"dgCenter/DgGeneral.query.json",data:{menuId:window.sys_menuId,sqlId:"DG00197",param1:window.CUR_CUSTOMERID,param2:window.CUR_PROJECTID,start:-1,limit:-1},dataType:"json",success(e){e.success&&sys_userId!=e.data[0].manager&&(r=!1)}}),r?e({param1:a.autoId,param2:a.customerId,param3:a.relateType},e=>{downloadFile("dgCenter/DgDownload.downloadSamplingDgFile.json",{param1:a.autoId,param2:a.customerId,param3:a.relateType})}):bdoInfoBox("提示","只有项目负责人才能下载该文件附件！")}),$("#samplingFileUploadResultTable").on("click",'button.table-btn-operate[name="onlinepreview"]',t=>{var a=$("#samplingFileUploadResultTable").dataTable().fnGetData($(t.currentTarget).attr("data-row"));e({param1:a.autoId,param2:a.customerId,param3:a.relateType},e=>{var t=a.fileName.substring(a.fileName.lastIndexOf(".")+1).toLowerCase();if("pdf"===t||"jpg"===t||"png"===t||"jpeg"===t)null==e.data?window.open("dgCenter/DgPaper.previewFile.json?param1="+a.autoId+"&param2=type2&param3="+a.fileName,a.fileName,"location=no"):window.open("/Faith/dgcenter.do?m=previewAuditPolicyFileNoRight",a.fileName,"location=no");else if("xlsx"===t){a.pageType=2;var r={extraOptions:a,currentNode:{extraOptions:a}};$.sessionStorage("fileNode",JSON.stringify(r)),window.open("/Faith/dgcenter.do?m=previewFile")}})}),$("#samplingFileUploadResultTable").on("click",'button.table-btn-operate[name="relateEntry"]',e=>{var t=$("#samplingFileUploadResultTable").dataTable();t.fnGetData($(e.currentTarget).attr("data-row")),$("#modal_samplistRelate").modal("show")}),$("#samplingFileUploadResultTable").on("click",'button.table-btn-operate[name="delFile"]',e=>{var t=$("#samplingFileUploadResultTable").dataTable().fnGetData($(e.currentTarget).attr("data-row"));bdoConfirmBox("提示","确认删除文件【"+t.fileName+"】?",function(){$.ajax({url:"dgCenter/DgMain.deleteSamplingDgFile.json",type:"post",data:{param1:t.autoId,param2:t.customerId,param3:t.relateType},dataType:"json",success:function(e){e.success?($("#samplingFileUploadResultTable").DataTable().ajax.reload(),"2"==c.attachTableCfg.localParam.urlparam.param6&&$("#samplingVoucherDetailResult_table").DataTable().ajax.reload(),bdoSuccessBox("成功",e.resultInfo.statusText)):bdoErrorBox("失败",e.resultInfo.statusText)}})})}),$("#samplingFileUploadResultTable").on("dblclick","tbody td.edit-indexid",this.onIndexColDbclick)}});var u={localParam:{tabNum:!0,url:"cpBase/General.query.json",urlparam:{menuId:window.sys_menuId,sqlId:"DG10009",param2:"",param3:"",param4:"",lockCustomerId:"",lockYyyy:""}},tableParam:{select:!0,lengthChange:!1,dom:'<"row"<"col-sm-6"i><"col-sm-6">><"row"<"col-sm-12"tr>><"row"<"col-sm-6"i><"col-sm-6">>',ordering:!1,serverSide:!0,scrollX:!0,scrollCollapse:!0,createdRow(e,t,a){$(e).addClass("edit-able"),""!=t.selectId&&null!=t.selectId&&$(e).css({color:"red"})},columnDefs:[{targets:1,className:"text-left",title:"凭证号",name:"oldVoucherId",data:"oldVoucherId",width:"60px"},{targets:2,className:"text-left",title:"凭证日期",name:"vchDate",data:"vchDate",width:"80px"},{targets:3,className:"text-left",title:"摘要",name:"summary",data:"summary",width:"100px"},{targets:4,className:"text-left",title:"科目编号",name:"subjectId",data:"subjectId",width:"60px"},{targets:5,className:"text-left",title:"科目名称",name:"subjectFullName",data:"subjectFullName",width:"100px"},{targets:6,className:"text-right",title:"借方金额",name:"debitValue",data:"debitValue",width:"80px",render:function(e,t,a,r){return formatMoney(e)}},{targets:7,className:"text-right",title:"贷方金额",name:"crebitValue",data:"crebitValue",width:"80px",render:function(e,t,a,r){return formatMoney(e)}},{targets:8,className:"text-left",title:"附件索引号",name:"fileIndexId",data:"fileIndexId",width:"100px"},{targets:9,className:"text-left",title:"附件内容填写",name:"content",data:"content",width:"100px"}]}};$("#sampling_pdf_close").click(function(){$("#modal_samplingFileUpload").modal("hide")}),$("#sampling_export_pdf").click(function(){var e=$("#samplistResult_Condition").html(),t=[];if("7"!==l)for(var r=$("#dgSamplingCountTable").DataTable().data(),s=0;s<r.length;s++)t.push(r[s]);var o=[],d=$("#dgSamplingResultTable").DataTable().data();for(s=0;s<d.length;s++)o.push(d[s]);var c={dgSamplingParam:e,dgSamplingCountTitle:i.tableParam.columnDefs,dgSamplingCountData:t,dgSamplingResultTitle:n.tableParam.columnDefs,dgSamplingResultData:o};downloadFile("finCenter/sampling.exportPdf.json",{jsonData:JSON.stringify(c),param1:window.CUR_PROJECTID,param2:l,param17:"1",param18:a,lockCustomerId:window.CUR_CUSTOMERID})})});var HbSubjectPagePlan=e=>{var t,a;t=e.template||tplLoader("dgCenter/html/dg/subjectPlan.html"),e.template=t,a=(()=>{$('#subPageRight [data-toggle="tabs"] a, .js-tabs a').on("show.bs.tab",function(t){var a=t.target.href,r=a.lastIndexOf("#");switch(a.substring(r+1)){case"guidePageTab":break;case"auditProgramPageTab":HbAuditProgramPagePlan({region:"#auditProgramPageTab",data:e.data});break;case"otherSubjectPlanPageTab":$("#otherSubjectPlanPageTab").tab("show"),OtherAuditProgramPagePlan({region:"#otherSubjectPlanPageTab",data:e.data})}})}),(()=>{$(e.region).empty().append(t),a(),HbAuditProgramPagePlan({region:"#subjectPlanPageTab",data:e.data}),OneUI.initHelper("slimscroll")})()};