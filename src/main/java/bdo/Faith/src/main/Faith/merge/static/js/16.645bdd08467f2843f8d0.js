webpackJsonp([16],{QVR9:function(e,t){},jxh1:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("woOf"),n=a.n(s),i=a("mvHQ"),r=a.n(i),o=a("ECGi"),l=a("j5fz"),c=a("UHag"),u=a("fH//"),d=a("e6WU"),m=a("ZHXk"),h=a.n(m),f=a("w/PL"),p=a("VzA3"),I=a("qcqk"),g={name:"checkReport",components:{balanceSheet:o.default,profitStatement:l.default,statementOfCashFlow:c.default,statementOfChangeInEquityCur:u.default,statementOfChangeInEquityLast:d.default,Postill:p.a,counter:I.a},watch:{refreshPagesCollection:{handler:function(e){if(e&&e.refreshIndexes&&window.location.hash.indexOf("/checkReport")>-1){var t=h.a.some(this.tabPaneList,function(t){return e.refreshIndexes.indexOf(t.indexId)>-1});this.tabPaneList.map(function(t){e.refreshIndexes.indexOf(t.indexId)>-1&&(t.isMark=!0)}),this.singleFresh(t)}},immediate:!0,deep:!0}},data:function(){return{activeName:"balanceSheet",tabPaneList:[{label:"资产负债表",name:"balanceSheet",indexId:"HB002-MC005-001",isMark:!1},{label:"利润表",name:"profitStatement",indexId:"HB002-MC005-002",isMark:!1},{label:"现金流量表",name:"statementOfCashFlow",indexId:"HB002-MC005-003",isMark:!1}],currentTabComponent:"balanceSheet",validColumns:[{prop:"colDisp",label:"校验项",filterOptions:{disabled:!0}},{prop:"adjustAmount",label:"本年审计调整数",filterOptions:{disabled:!0}},{prop:"auditAmount",label:"本年审定数",filterOptions:{disabled:!0}},{prop:"preAuditAmount",label:"上年审定数",filterOptions:{disabled:!0}}],validData:[],curYear:this.$route.query.curYear,type:"",statementOfChangeInEquityCurData:[],statementOfChangeInEquityLastData:[],statementOfChangeInEquityHeadTitle:[],balanceSheetData:[],profitStatementData:[],statementOfCashFlowData:[],errorText:"校验不平",isErrorText:!1,validDataModel:new f.a,customerName:"",projectName:"",singleCustomerName:"",singleProjectName:"",_strArr:[],curProjectId:"",customerId:"",validFail:!0,fullscreenLoading:!1,limitArr:[],menuID:"",userId:"",activeLabel:"资产负债表",isOpenDrawer:!1,refreshPagesCollection:{},nonSenseNum:0,number:0}},methods:{refreshIndexes:function(e){this.tabPaneList.map(function(t){e.indexOf(t.indexId)>-1&&(t.isMark=!0)});var t={key:JSON.parse(localStorage.getItem("refreshIndexes"))?JSON.parse(localStorage.getItem("refreshIndexes")).key+=1:0,refreshIndexes:e};localStorage.setItem("refreshIndexes",r()(t))},openDrawer:function(){this.isOpenDrawer=!0},closePostill:function(e){this.isOpenDrawer=e},isPostil:function(e){this.isPostilLink=!0},getPermission:function(){var e=this,t={menuId:"",sqlId:"DG00061",param1:this.projectName.split("-")[0],param2:this.customerName.split("-")[0]};this.$sacpApis.postillCheck(t).then(function(t){if(t.success){var a=t.data[0],s=[];if(a.manager==e.userId){s.push({status:"manager",limit:1})}if(a.signAccountant2==e.userId||a.signAccountant3==e.userId){s.push({status:"signAccountant2",limit:1})}if(a.audit1==e.userId){s.push({status:"audit1",limit:1})}if(a.audit2==e.userId){s.push({status:"audit2",limit:1})}if(a.reaReviewer==e.userId){s.push({status:"reaReviewer",limit:1})}if(a.signUser==e.userId){s.push({status:"signUser",limit:1})}if(a.reviewPartner==e.userId){s.push({status:"reviewPartner",limit:1})}if(a.issuedPeople==e.userId){s.push({status:"issuedPeople",limit:1})}e.limitArr=s}})},commafyFn:function(e,t){return h.a.commafy(t,{digits:2})},handleClick:function(e){var t=this.tabPaneList.filter(function(t){return t.name==e.name});if(this.currentTabComponent=t[0].name,this.menuID=t[0].indexId,this.activeLabel=t[0].label,this.activeName=t[0].name,this.$store.commit("setSingleReportIndex",this.menuID),this.closePostill(!1),this.$router.push({name:"checkReport",query:{curYear:this.curYear,menuID:this.menuID}}),this.tabPaneList.map(function(t){t.isMark=t.name!==e.name&&t.isMark}),h.a.every(this.tabPaneList,function(e){return!e.isMark})){this.refreshPagesCollection={},this.nonSenseNum=0;var a=JSON.parse(localStorage.getItem("refreshIndexes"));if(a&&a.refreshIndexes&&a.refreshIndexes.length){var s=a.refreshIndexes.split(",");s=s.filter(function(e){return-1===e.indexOf("HB002-MC005")});var n={key:a.key+=1,refreshIndexes:s.join()};localStorage.setItem("refreshIndexes",r()(n))}}},handleYear:function(){this.validColumns[1].label=this.curYear+"审计调整数",this.validColumns[2].label=this.curYear+"审定数",this.validColumns[3].label=this.curYear-1+"审定数",this.statementOfChangeInEquityInit()},singleFresh:function(e){e&&(this.statementOfChangeInEquityInit(),this.handleValidItemData())},statementOfChangeInEquityInit:function(){var e=this;this.fullscreenLoading=!0,this.$sacpApis.auditReport({customerId:this.customerId,projectId:this.curProjectId,type:this.type}).then(function(t){e.statementOfChangeInEquityHeadTitle=t[1].titleColumn,e.statementOfChangeInEquityCurData=t[1].G,e.statementOfChangeInEquityLastData=t[1].LG,e.balanceSheetData=t[0].A,e.profitStatementData=t[0].S,e.statementOfCashFlowData=t[0].F}).catch(function(t){return e.$message.error(t)}).finally(function(){e.fullscreenLoading=!1,e.getPermission()}).finally(function(){var t=window.location.hash.split("=");e.tabPaneList.map(function(e){e.isMark=(!e.isMark||e.indexId!==t[t.length-1])&&e.isMark})})},refreshValid:function(e){e&&(this.handleValidItemData(),this.statementOfChangeInEquityInit())},handleValidItemData:function(){var e=this;this.validData=[];var t={projectId:this.curProjectId};this.$sacpApis.mergeScopeReportValidList(t).then(function(t){if(t.success){if(t.data){var a=t.data[t.data.length-1].checkFlag;e.validFail=a,e.isErrorText=!e.validFail;var s=t.data.slice(0,-1);for(var i in s){var r={};for(var o in n()(r,e.validDataModel,s[i]),r)0==r[o]?r[o]="平":null===r[o]?r[o]=null:"colDisp"!=o&&(r[o]=h.a.commafy(r[o],{digits:2}));e.validData.push(r)}}}else e.$message.error(t.resultInfo.statusText)}).catch(function(t){e.$message.error(t)})},commafy:function(e,t){h.a.commafy(t,{digits:2})},handleCustomerInformation:function(){var e=JSON.parse(sessionStorage.getItem("curCustomerData"));this.customerName=e.curCustomerName,this.projectName=e.curProjectName;var t=JSON.parse(sessionStorage.getItem("projectItem"));-1!=t.mergeCustomerName.indexOf("-")?this.singleCustomerName=t.mergeCustomerName:this.singleCustomerName=t.customerId+"-"+t.mergeCustomerName,this.singleProjectName=t.projectId,this._strArr=t.projectId.split("-"),this.curProjectId=this._strArr[0],this.customerId=t.customerId,this.type=t.type,this.userId=e.userId,this.curYear=e.curYear,this.handleYear(),this.handleValidItemData(),window.addEventListener("storage",this.storageEvent,!1)},handlePostillLink:function(){var e,t=window.location.hash.split("/"),a=(t=t.pop()).split("&")[1].split("=")[1];e={name:this.tabPaneList.filter(function(e){return e.indexId==a})[0].name},this.handleClick(e)},storageEvent:function(){this.refreshPagesCollection=JSON.parse(localStorage.getItem("refreshIndexes"))},clear:function(e){this.number=e}},mounted:function(){this.handleCustomerInformation(),this.handlePostillLink()}},v={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-container",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"container"},[a("el-header",[a("el-row",[a("el-col",{attrs:{span:1}},[a("div",{staticClass:"logo"})]),e._v(" "),a("el-col",{attrs:{span:7}},[a("div",{staticClass:"customerInformation"},[a("p",[e._v("客户:"+e._s(this.customerName))]),e._v(" "),a("p",[e._v("项目:"+e._s(this.projectName))])])]),e._v(" "),a("el-col",{attrs:{span:7}},[a("div",{staticClass:"singleCustomerInformation"},[a("p",[e._v("子客户:"+e._s(this.singleCustomerName))]),e._v(" "),a("p",[e._v("子项目:"+e._s(this.singleProjectName))])])]),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"批注",placement:"top-start"}},[a("el-button",{staticClass:"postillBtn singlePostillBtn",attrs:{circle:"",size:"small",icon:"el-icon-edit-outline"},on:{click:e.openDrawer}})],1)],1)],1)],1),e._v(" "),a("el-main",[a("div",{staticClass:"checkReportTable"},[a("div",{staticClass:"validErrorInfo"},[a("span",{style:e.validFail?"color:#000":"color:red"},[e._v(e._s(e.validFail?"校验项":e.errorText))]),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"刷新校验列表",placement:"top-start"}},[a("i",{staticClass:"el-icon-refresh",staticStyle:{color:"#409eff"},on:{click:function(t){return e.refreshValid(!0)}}})]),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.isErrorText?"关闭校验项列表":"打开校验项列表",placement:"right"}},[e.isErrorText?a("i",{staticClass:"el-icon-caret-top",on:{click:function(t){e.isErrorText=!1}}}):a("i",{staticClass:"el-icon-caret-bottom",on:{click:function(t){e.isErrorText=!0}}})])],1),e._v(" "),e.isErrorText?a("div",{staticClass:"validTable"},[a("bdo-table",{staticStyle:{width:"100%"},attrs:{columns:e.validColumns,"max-height":330,"enable-filter":!1,"enable-toolbox":!1,"enable-view-type":!1,showIndexColumn:!1,showCheckBox:!1,enableHeadConfig:!1,headerListConfig:!1,setBorder:!0,"show-overflow-tooltip":"",headerCellStyleSelf:{"text-align":"center"}},scopedSlots:e._u([{key:"col-unAuditAmount",fn:function(t){return[a("span",{style:{textAlign:"平"===t.row.unAuditAmount?"center":"right",color:"平"===t.row.unAuditAmount?"":"red",display:"block"}},[e._v("\n                            "+e._s(t.row.unAuditAmount))])]}},{key:"col-adjustAmount",fn:function(t){return[a("span",{style:{textAlign:"平"===t.row.adjustAmount?"center":"right",color:"平"===t.row.adjustAmount?"":"red",display:"block"}},[e._v("\n                            "+e._s(t.row.adjustAmount))])]}},{key:"col-auditAmount",fn:function(t){return[a("span",{style:{textAlign:"平"===t.row.auditAmount?"center":"right",color:"平"===t.row.auditAmount?"":"red",display:"block"}},[e._v("\n                            "+e._s(t.row.auditAmount))])]}},{key:"col-preAuditAmount",fn:function(t){return[a("span",{style:{textAlign:"平"===t.row.preAuditAmount?"center":"right",color:"平"===t.row.preAuditAmount?"":"red",display:"block"}},[e._v("\n                            "+e._s(t.row.preAuditAmount))])]}}],null,!1,1816373129)})],1):e._e(),e._v(" "),a("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(this.tabPaneList,function(t){return a("el-tab-pane",{key:t.index,attrs:{label:t.label,name:t.name}},[a("span",{attrs:{slot:"label"},slot:"label"},[t.isMark?a("el-badge",{staticClass:"item",attrs:{"is-dot":""}}):e._e(),e._v("\n                        "+e._s(t.label)+"\n                    ")],1)])}),1),e._v(" "),a("keep-alive",[a(e.currentTabComponent,{ref:"reportContent",tag:"component",attrs:{statementOfChangeInEquityCurData:e.statementOfChangeInEquityCurData,statementOfChangeInEquityLastData:e.statementOfChangeInEquityLastData,statementOfChangeInEquityHeadTitle:e.statementOfChangeInEquityHeadTitle,balanceSheetData:e.balanceSheetData,profitStatementData:e.profitStatementData,statementOfCashFlowData:e.statementOfCashFlowData},on:{isInit:e.singleFresh,refreshIndexes:e.refreshIndexes}})],1)],1)]),e._v(" "),e.isOpenDrawer?a("Postill",{ref:"postill",attrs:{menuID:e.menuID,activeLabel:e.activeLabel,limitArr:e.limitArr},on:{closePostill:e.closePostill,isPostil:e.isPostil}}):e._e(),e._v(" "),a("counter",{ref:"counter",attrs:{count:e.number},on:{clear:e.clear}})],1)},staticRenderFns:[]};var C=a("VU/8")(g,v,!1,function(e){a("QVR9")},null,null);t.default=C.exports}});