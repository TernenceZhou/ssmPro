webpackJsonp([5],{"/829":function(e,t){},"0+Rn":function(e,t){},K4R9:function(e,t,a){a("NA/8"),e.exports=a("FeBl").Number.isNaN},MICi:function(e,t,a){e.exports={default:a("K4R9"),__esModule:!0}},"NA/8":function(e,t,a){var s=a("kM2E");s(s.S,"Number",{isNaN:function(e){return e!=e}})},NqmM:function(e,t){},XKgs:function(e,t){},Xt8x:function(e,t){},cC5m:function(e,t){},qnMx:function(e,t){},sImP:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("Gu7T"),r=a.n(s),o=a("gRE1"),n=a.n(o),i=a("fZjL"),l=a.n(i),c=a("//Fk"),u=a.n(c),f=a("pFYg"),d=a.n(f),h=a("woOf"),p=a.n(h),m=a("mvHQ"),b=a.n(m),v=a("MICi"),g=a.n(v),y=a("oGZU"),S=a.n(y),I=a("ZHXk"),w=a.n(I),C=a("UGJx"),j=a("lCTB"),T=a("lHA8"),x=a.n(T),k=a("c/Tr"),N=a.n(k),O=a("K/T8"),D={name:"transactionSummary",mixins:[],components:{},directives:{},data:function(){return{formatter:O.b,isBorder:!0,data:[],loading:!1,spanArr:[],pos:0,tabsName:"A1",tabIndex:2,tab:[],tableHeader:[],typeList:{},typeList1:{},tableAllData:[],mateShortName:[],activeTabName:"A1"}},watch:{},methods:{tabItemList:function(e){var t=[];e&&(this.tableAllData=e),this.tableAllData.forEach(function(e){"A0"!=e.classifyCode&&"G0"!=e.classifyCode&&"E0"!=e.classifyCode&&t.push(b()({label:e.classifyName,name:e.classifyCode}))});var a=N()(new x.a(t)).map(function(e){return JSON.parse(e)});this.tab=a,a&&a.length&&(this.tabsName=a[0].name),this.tabClick()},tabClick:function(e){var t=this;this.activeTabName=e?e.name:"A1";var a=[],s=[];this.tableAllData.forEach(function(e){e.classifyCode===t.tabsName&&(a[0]={title:e.classifyName,code:e.classifyCode},s.push({title:e.fieldName,dataField:e.dataField,prop:e.fieldCode,dicCode:e.dicCode,pageFieldType:e.pageFieldType}))}),a[0].children=s,a=[{title:"公司名称",prop:"shortName"},{title:"关联方名称",prop:"mergeCustomerName"}].concat(r()(a)),this.tableHeader=a,this.queryAllInternalTransactionInfo()},objectSpanMethod:function(e){e.row,e.column;var t=e.rowIndex;if(0===e.columnIndex){var a=this.spanArr[t];return{rowspan:a,colspan:a>0?1:0}}},getSpanArr:function(e){for(var t=0;t<e.length;t++)0===t?(this.spanArr.push(1),this.pos=0):e[t].mergeCustomerName===e[t-1].mergeCustomerName?(this.spanArr[this.pos]+=1,this.spanArr.push(0)):(this.spanArr.push(1),this.pos=t)},queryAllInternalTransactionInfo:function(){var e=this;this.loading=!0,this.$sacpApis.queryAllInternalTransactionInfo({param1:this.mergeProjectId}).then(function(t){t.success?(e.loading=!1,e.data=t.data[0][e.tabsName]?t.data[0][e.tabsName]:[],e.data&&e.data.length&&e.getSpanArr(e.data),e.enterpriseList()):e.$message.error(t.resultInfo.statusText)}).catch(function(t){e.$message.error(t)}).finally(function(){e.loading=!1})},cellDataHanlder:function(e,t){if("固定资产购入方式"===t.dicCode)return this.typeList[e[t.prop]];if("固定资产折旧方法"===t.dicCode)return this.typeList1[e[t.prop]];if("6"===t.pageFieldType)return e[t.prop]?e[t.prop].replace("|","-"):e[t.prop];switch(t.pageFieldType){case"1":return O.b.commafy("",e[t.prop]);case"5":return e[t.prop].slice(0,e[t.prop].lastIndexOf("-"));default:return e[t.prop]}},enterpriseList:function(){var e=this,t=sessionStorage.getItem("curCustomerData"),a=JSON.parse(t),s=a.curCustomerId,r=a.curProjectId;this.$sacpApis.enterpriseList({customerId:s,projectId:r}).then(function(t){t.success?t.data?t.data.forEach(function(t){e.data.forEach(function(a){t.mergeProjectId==a.mergeProjectId&&e.$set(a,"mergeCustomerName",t.shortName),t.mergeProjectId==a.childProjectId&&e.$set(a,"shortName",t.shortName)})}):e.dataLength=0:e.$message.error(t.resultInfo.statusText)}).catch(function(t){e.$message.error(t)}).finally(function(){})}},mounted:function(){var e={};this.$DIC("固定资产购入方式").map(function(t,a){e[t.value]=t.label}),this.typeList=e;var t={};this.$DIC("固定资产折旧方法").map(function(e,a){t[e.value]=e.label}),this.typeList1=t}},_={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-tabs",{attrs:{type:"card"},on:{"tab-click":e.tabClick},model:{value:e.tabsName,callback:function(t){e.tabsName=t},expression:"tabsName"}},e._l(e.tab,function(t,s){return a("el-tab-pane",{key:s,attrs:{label:t.label,name:t.name}},[e.activeTabName===t.name?a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"table",refInFor:!0,staticStyle:{width:"100%"},attrs:{data:e.data,border:e.isBorder,size:"small",height:"calc(100vh - 200px)"}},e._l(e.tableHeader,function(t,s){return a("el-table-column",{key:s,attrs:{"header-align":"center",stripe:!0,label:t.title,prop:t.prop,"min-width":"120px",align:"left","show-overflow-tooltip":!0}},e._l(t.children,function(t,s){return a("el-table-column",{key:s,attrs:{"header-align":"center",stripe:!0,label:t.title,prop:t.prop,"min-width":"120px","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(s){var r=s.row;return s.column,s.$index,[a("div",{style:{textAlign:isNaN(r[t.prop])?"left":"right"}},[e._v("\n                                "+e._s(e.cellDataHanlder(r,t))+"\n                            ")])]}}],null,!0)})}),1)}),1):e._e()],1)}),1)],1)},staticRenderFns:[]};var $=a("VU/8")(D,_,!1,function(e){a("0+Rn")},"data-v-4102afc4",null).exports,L=a("Dd8w"),A=a.n(L),F={name:"checkListTable",mixins:[],components:{},directives:{},props:["type"],data:function(){return{isBorder:!0,data:[],loading:!1}},methods:{submit:function(){},getTableData:function(){var e=this;this.data=[];var t={type:this.type};this.$sacpApis.insideTransactionCheck(t).then(function(t){if(t.success){var a=[];t.data.forEach(function(e){a.push(A()({},e,{sideGrossMargin:100*e.sideGrossMargin}))}),e.data=a}}).catch(function(t){e.$message.error(t)}).finally(function(){})},formatFun:function(e){return w.a.commafy(e,{digits:2})},max100:function(e,t){e>100?t.sideGrossMargin=100:e<0?t.sideGrossMargin=0:e||(t.sideGrossMargin=0)}}},E={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"table",staticStyle:{width:"100%"},attrs:{data:e.data,border:e.isBorder,size:"small"}},[a("el-table-column",{attrs:{label:"序号",width:"64px",type:"index"}}),e._v(" "),a("el-table-column",{attrs:{"header-align":"center",stripe:!0,prop:"label",label:"关联方名称","min-width":"120px",align:"right","show-overflow-tooltip":!0}}),e._v(" "),a("el-table-column",{attrs:{"header-align":"center",stripe:!0,prop:"checkData_1",label:"内部商品和劳务、租赁等交易","min-width":"120px",align:"right","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(e.formatFun(t.row.checkData_1))+"\n            ")]}}])}),e._v(" "),a("el-table-column",{attrs:{"header-align":"center",stripe:!0,prop:"checkData_2",label:"内部固定资产交易","min-width":"120px",align:"right","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(e.formatFun(t.row.checkData_2))+"\n            ")]}}])}),e._v(" "),a("el-table-column",{attrs:{"header-align":"center",stripe:!0,prop:"checkData_3",label:"内部无形资产交易","min-width":"120px",align:"right","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(e.formatFun(t.row.checkData_3))+"\n            ")]}}])}),e._v(" "),a("el-table-column",{attrs:{"header-align":"center",stripe:!0,prop:"count",label:"合计","min-width":"120px",align:"right","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(e.formatFun((t.row.checkData_1||0)+(t.row.checkData_2||0)+(t.row.checkData_3||0)))+"\n            ")]}}])})],1)],1)},staticRenderFns:[]};var M=a("VU/8")(F,E,!1,function(e){a("cC5m")},"data-v-54837d91",null).exports,B={name:"numberInput",inheritAttrs:!1,props:{value:{type:[String,Number],default:null,desc:"数值"},maxlength:{type:[String,Number],default:20,desc:"最大长度"},placeholder:{type:[String],default:"请输入内容",desc:"输入提示"},disabled:{type:[Boolean],default:!1,desc:"禁用"}},data:function(){return{formatValue:""}},computed:{inputListeners:function(){var e=this;return p()({},this.$listeners,{input:function(t){e.formatValue=t,e.$emit("input",parseFloat(e.fmoney(t).replace(/,/g,"")))},blur:function(t){e.formatValue=e.fmoney(e.value),e.$listeners.blur&&e.$listeners.blur(t)},focus:function(t){e.formatValue=e.value}})}},watch:{value:function(e){}},created:function(){this.formatValue=this.fmoney(this.value)},methods:{fmoney:function(e){if(0===e)return"0.00";if(""===e||null==e)return"";var t=2,a=parseFloat(e);t=t>0&&t<=20?t:2;for(var s=(e=a<0?(-1*parseFloat((e+"").replace(/[^\d\.-]/g,""))).toFixed(t)+"":parseFloat((e+"").replace(/[^\d\.-]/g,"")).toFixed(t)+"").split(".")[0].split("").reverse(),r=e.split(".")[1],o="",n=0;n<s.length;n++)o+=s[n]+((n+1)%3==0&&n+1!==s.length?",":"");return a<0?"-"+o.split("").reverse().join("")+"."+r:o.split("").reverse().join("")+"."+r}}},q={render:function(){var e=this,t=e.$createElement;return(e._self._c||t)("el-input",e._g(e._b({attrs:{value:e.formatValue,maxlength:e.maxlength,disabled:e.disabled,placeholder:e.placeholder}},"el-input",e.$attrs,!1),e.inputListeners))},staticRenderFns:[]};var P=a("VU/8")(B,q,!1,function(e){a("/829")},"data-v-74afe8b3",null).exports,R={name:"internalFixedOffsetTable",components:{numberInput:P,amountInput:{template:'<div class="subjectCell amountCell"\n                                @click="clickCell(true)"\n                                v-if="!showInput"\n                                >{{formatter.commafy(\'\',scope.row[scope.column.property]*1) }}</div\n                            >\n                            <el-input\n                                @blur.stop="clickCell(false)"\n                                v-else="showInput"\n                                ref="input"\n                                clearable\n                                v-model="scope.row[scope.column.property]"\n                            />',data:function(){return{formatter:O.b,showInput:!1,borrowing:!0}},props:["scope"],methods:{clickCell:function(e){var t=this;if(this.showInput=e,e)this.$nextTick(function(){t.$refs.input.focus()});else{var a=this.scope.row[this.scope.column.property];this.scope.row[this.scope.column.property]="string"==typeof a?a.replaceAll(",",""):a}}}},autocompleteInput:{template:'\n    <el-autocomplete\n                                v-model="scope.row[scope.column.property]"\n                                ref="autocomplete"\n                                :fetch-suggestions="querySearchAsync"\n                                placeholder="请输入内容"\n                                clearable\n                                @select="handleSelect"\n                                @focus="onFocus"\n                            ></el-autocomplete>',data:function(){return{showAutocomplete:!1,secondSubjectRestaurants:[]}},props:["scope","restaurants"],methods:{clickCell:function(e){var t=this;this.showAutocomplete=e,e&&this.$nextTick(function(){t.$refs.autocomplete.focus()})},onFocus:function(){this.scope&&this.scope.column&&"secondSubject"===this.scope.column.property&&this.querySecondarySubjectList(),this.scope&&this.scope.column&&"otherDescription"===this.scope.column.property&&this.queryOtherDescription()},querySecondarySubjectList:function(){var e=this,t=sessionStorage.getItem("curCustomerData"),a=JSON.parse(t),s=a.curCustomerId,r=a.curProjectId,o=this.scope.row,n={projectId:r,customerId:s,tbSubjectCode:o.subjectCode,tbSubjectName:o.subjectName};this.$sacpApis.querySecondarySubjectList(n).then(function(t){t.success?t.data&&t.data[0]&&t.data[0].list?t.data[0].list.forEach(function(t,a){e.secondSubjectRestaurants.push({label:t,value:t})}):e.secondSubjectRestaurants=[]:e.$message.error(t.resultInfo.statusText)}).catch(function(t){e.$message.error(t)})},queryOtherDescription:function(){this.scope.row},querySearchAsync:function(e,t){var a=this.scope&&this.scope.column&&"subjectName"===this.scope.column.property?this.restaurants:this.secondSubjectRestaurants,s=e?a.filter(this.createStateFilter(e)):a;clearTimeout(this.timeout),this.timeout=setTimeout(function(){t(s)},500*Math.random())},createStateFilter:function(e){return function(t){return 0===t.value.toLowerCase().indexOf(e.toLowerCase())}},handleSelect:function(e){"subjectName"===this.scope.column.property&&(this.scope.row.subjectCode=e.label)}}}},data:function(){return{activeName:"internalGoods",isBorder:!0,data:[],loading:!1,curProjectId:"",curCustomerId:"",tabList:[],columns:[{label:"科目",prop:"subjectName",align:"left"},{label:"二级科目",prop:"secondSubject",align:"center"},{label:"描述",prop:"otherDescription",align:"left"},{label:"合计",prop:"sum",align:"right"}],tbSubject:[],restaurants:[],state:"",timeout:null,data1:[],data2:[],tableColumns:[],tableData:[],checkResult:!1,borrowing:[],arrbox:"",leftTReeNode:[{children:[{label:"内部商品交易",type:"5",value:70,classify:"internalGoods"},{label:"内部租赁交易",type:"5",value:71,classify:!1},{label:"未实现对外销售的存货",type:"5",value:72,classify:!1},{label:"存货跌价准备抵销",type:"5",value:73,classify:"obsoleteStocks"},{label:"对递延所得税的影响",type:"5",value:74,classify:"deferredIncomeTax"},{label:"逆流交易抵销",type:"5",value:75,classify:"currentTrading"}],label:"内部商品和劳务、租赁等交易",type:"5",value:67,classify:!1},{children:[{label:"集团内部产品销售",type:"6",value:76,classify:"fixedAsset"},{label:"集团内部固定资产变卖交易",type:"6",value:77,classify:!1},{label:"固定资产折旧",type:"6",value:78,classify:!1},{label:"对递延所得税的影响",type:"6",value:79,classify:"deferredIncomeTax"},{label:"逆流交易抵销",type:"6",value:80,classify:"currentTrading"}],label:"内部固定资产交易",type:"6",value:68,classify:!1},{children:[{label:"",type:"7",value:81,classify:"intangibleAssets"},{label:"无形资产摊销",type:"7",value:82,classify:!1},{label:"对递延所得税的影响",type:"7",value:83,classify:"deferredIncomeTax"},{label:"逆流交易抵销",type:"7",value:84,classify:"currentTrading"}],label:"内部无形资产交易",type:"7",value:69,classify:!1}]}},watch:{tableData:{handler:function(e,t){this.sums()},immediate:!0,deep:!0}},methods:{handleClick:function(e,t){this.dataMarry(),this.arrbox?this.arrbox=new x.a([].concat(r()(e),r()(this.arrbox))):this.arrbox=[].concat(r()(e))},cellData:function(e){var t=e.row,a=e.column,s=t[a.property];return"sum"===a.property?O.b.commafy("",1*s):s},requestAll:function(){var e=this,t=sessionStorage.getItem("curCustomerData"),a=JSON.parse(t),s=a.curCustomerId,r=a.curProjectId,o=a.curYear;this.curYear=o,this.projectId=r,this.customerId=s,this.loading=!0;var n=this.$sacpApis.enterpriseList({customerId:s,projectId:r}).then(function(t){if(t.success){if(t.data)return t.data;e.dataLength=0}else e.$message.error(t.resultInfo.statusText)}).catch(function(t){e.$message.error(t)}).finally(function(){}),i=this.$sacpApis.queryInternalCommodityOffset().then(function(t){if(t.success){if(t.data)return e.$parent.treeNode=t.data,t.data[0].internalGoods.forEach(function(t){e.borrowing.push(t.direction)}),t.data}else e.$message.error(t.resultInfo.statusText)}).catch(function(t){e.$message.error(t)}).finally(function(){e.loading=!1}),c=this.$sacpApis.offsetEntrySubjectNameList().then(function(t){if(t.success){var a=t.data[0].tb;e.tbSubject=a,e.restaurants=a.map(function(e){return{value:e.label,label:e.value,direction:e.direction}})}else e.$message.error(t.resultInfo.statusText)}).catch(function(t){e.$message.error(t)}).finally(function(){});u.a.all([n,i,c]).then(function(t){e.data1=t[0],e.data2=t[1][0];var a=[{label:"抵销内部商品交易",name:"internalGoods"},{label:"存货跌价准备抵销",name:"obsoleteStocks"},{label:"对递延所得税的影响",name:"deferredIncomeTax"},{label:"内部无形资产交易",name:"intangibleAssets"},{label:"内部固定资产交易",name:"fixedAsset"},{label:"逆流交易抵销",name:"currentTrading"}],s=[];l()(e.data2).forEach(function(e){a.forEach(function(t){e===t.name&&s.push(t)})}),e.tabList=s,e.activeName=e.tabList[0].name,e.dataMarry()})},querySearchAsync:function(e,t){var a=this.restaurants,s=e?a.filter(this.createStateFilter(e)):a;clearTimeout(this.timeout),this.timeout=setTimeout(function(){t(s)},500*Math.random())},createStateFilter:function(e){return function(t){return 0===t.value.toLowerCase().indexOf(e.toLowerCase())}},handleSelect:function(e){},dataMarry:function(){var e=this,t=JSON.parse(b()(this.columns));(this.data2[this.activeName]?this.data2[this.activeName]:[]).forEach(function(a,s){l()(a).forEach(function(a,s){e.data1.forEach(function(e,s){a==e.mergeProjectId&&t.push({label:e.shortName,prop:a,align:"right"})})})}),t=N()(new x.a(t.map(function(e){return b()(e)}))).map(function(e){return JSON.parse(e)}),this.tableColumns=t;var a=.75*window.innerWidth;t.forEach(function(e){t.length<7?e.minWidth=parseInt(a/t.length):e.minWidth=120});var s=this.data2[this.activeName]?this.data2[this.activeName]:[];s.forEach(function(t){e.restaurants.forEach(function(e){t.subjectName===e.value&&(t.subjectCode=e.label)})}),this.tableData=s},sums:function(){var e=this;if(this.tableColumns.length>3){var t=this.tableColumns.map(function(e,t){if(t>3)return e.prop});this.tableData.forEach(function(a){var s=0;t.forEach(function(e){s=w.a.add(a[e],s)}),e.$set(a,"sum",s)})}},tableRowClassName:function(e){var t=e.row,a=e.rowIndex;return 1===t.direction&&a+1?"borrow-row":-1===t.direction&&a+1?"loan-row":"other-row"},getSummaries:function(e){var t=e.columns,a=e.data,s=[];t.forEach(function(e,t){if(0!==t)if(1!==t)if(2!==t){var r=a.map(function(t){return Number(t[e.property]*t.direction)});r.every(function(e){return isNaN(e)})?s[t]="":(s[t]=r.reduce(function(e,t){var a=Number(t);return isNaN(a)?e:e+t},0),s[t]+="")}else s[t]="";else s[t]="";else s[t]="核对"});var r=[];return s.forEach(function(e){var t=e&&!isNaN(1*e)?O.b.commafy("",1*e):e;r.push(t)}),this.footerStyle(r),r},footerStyle:function(e){this.checkResult="0.00"===e[3];for(var t=document.querySelectorAll(".el-table__footer-wrapper"),a=0;a<t.length+1;a++)if(t[a]){var s=t[a].querySelector("tr"),r=t[a].querySelectorAll("td");s&&r&&(this.checkResult?s.style.backgroundColor="#93ff93":s.style.backgroundColor="#ffc5ed",r.forEach(function(e){e.style.backgroundColor="unset"}))}},offsetEntryAddSave:function(e){var t=this;if(!this.checkResult)return this.$message.error("核对不为0!"),{then:function(){}};this.loading=!0;var a={};this.tableColumns.forEach(function(e,t){t>2&&(a[e.prop]=e.label)});var s="";if(e.children){for(var o=this.leftTReeNode.filter(function(t){return t.value===e.value})[0].children,n=0;n<o.length;n++)if(o[n].classify===this.activeName){s=o[n].value;break}}else s=e.value;this.arrbox=new x.a([].concat(r()(this.tableData),r()(this.arrbox))),this.tableData=[].concat(r()(this.arrbox)),this.tableData.forEach(function(e){for(var t in console.log(e,"XXXX"),e)for(var r in"number"==typeof e[t]&&(e[t]=""+e[t]),a)if(t===r){e[a[r]]=e[t];break}e.templateId=s,e.tbSubjectCode=e.subjectCode,e.tbSubjectName=e.subjectName,e["合计"]=""+e.sum});var i={yyyy:this.curYear,projectId:this.projectId,project:a,adjustType:e.type,arr:this.tableData};return this.$sacpApis.offsetEntryAddSave(i).then(function(e){return e.success?(t.loading=!1,t.$message.success("保存成功")):t.$message.error(e.resultInfo.statusText),e}).catch(function(e){return t.$message.error(e)}).finally(function(){t.loading=!1})}},mounted:function(){this.requestAll()}},V={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.loading,expression:"loading",modifiers:{fullscreen:!0,lock:!0}}]},[a("el-tabs",{attrs:{type:"card"},on:{"tab-click":function(t){return e.handleClick(e.tableData)}},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(e.tabList,function(t,s){return a("el-tab-pane",{key:s,attrs:{label:t.label,name:t.name}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,"show-summary":"","summary-method":e.getSummaries,border:"",height:"calc(100vh - 250px)","row-class-name":e.tableRowClassName}},e._l(e.tableColumns,function(t,s){return a("el-table-column",{key:s,attrs:{prop:t.prop,label:t.label,width:t.width,"min-width":t.minWdith,align:t.align,"header-align":t.align},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row,r=t.column;return["subjectName"===r.property?a("span",[e._v(e._s(1==s.direction?"借:":"贷:"))]):e._e(),e._v(" "),isNaN(1*r.property)?"subjectName"===r.property?a("autocomplete-input",{attrs:{scope:{row:s,column:r},restaurants:e.restaurants}}):"secondSubject"===r.property?a("autocomplete-input",{attrs:{scope:{row:s,column:r},restaurants:e.restaurants}}):"otherDescription"===r.property?a("autocomplete-input",{attrs:{scope:{row:s,column:r},restaurants:e.restaurants}}):a("span",[e._v(e._s(e.cellData({row:s,column:r})))]):a("amount-input",{attrs:{scope:{row:s,column:r}}})]}}],null,!0)})}),1)],1)}),1)],1)},staticRenderFns:[]};var z=a("VU/8")(R,V,!1,function(e){a("Xt8x")},"data-v-3353d700",null).exports,Y=a("rX5e"),G={props:{roleList:Array},components:{transactionSummaryChildren:Y.a},watch:{roleList:{handler:function(e){e&&e[0]&&(this.subjectNameList=(e[0].tb||[]).map(function(e){return{label:e.label,value:e.value,showLabel:e.value+"-"+e.label}}))},immediate:!0,deep:!0}},data:function(){return{colIndex:0,rowIndex:1,activeRowBackOld:{},costOffsetDialog:!1,dialogTitle:"",columnName:{},generationOffsetColumns:[],generationOffsetData:[],curCustomerId:null,curProjectId:null,changeTableFlag:!1,innerVisible:!1,yearList:[],radio:0,editTableColumns:[],editTableData:[],editTable:!1,checkedSelectedValue:[],templateId:null,mergeProjectId:"",digestArr:[],labelArr:[],subjectNameList:[],fullscreenLoading:!1,curObj:{},preObj:{},footerData:[],SummaryTableData:[],hasCheckBox:!0,contactProject:{},customerId:"",projectId:"",restaurants:[],footerObj:[],count:0,columnsInfo:[],footerTotal:0,tbSubject:[],treeNode:{},isShow:!1,queryParamRow:{},columnsData:"",arr:[]}},methods:{handleCheckedSelect:function(e){this.checkedSelectedValue=e},ofsetDialogConfirm:function(){var e=this;if(!this.editTable){if(!this.checkedSelectedValue||this.checkedSelectedValue&&!this.checkedSelectedValue.length)return this.$message.error("请选择子公司!");this.mergeProjectId=[],this.checkedSelectedValue.map(function(t){return e.mergeProjectId+=e.mergeProjectId.length?","+t.mergeProjectId:""+t.mergeProjectId});var t={param1:this.mergeProjectId},a={};this.checkedSelectedValue.map(function(e){a[e.shortName]=e.mergeProjectId}),this.sendMethods(t),this.sendChooseObj(a),this.costOffsetDialog=!1,this.checkedSelectedValue="",this.loading=!0,setTimeout(function(){e.loading=!1},400)}},sendChooseObj:function(e){this.$emit("chooseObj",e)},sendMethods:function(e){this.$emit("send",e)},costOfMethods:function(e,t,a,s){this.costOffsetDialog=!0,this.dialogTitle="成本法抵销",this.curProjectId=t,this.curCustomerId=e,this.yearList=a,this.radio=this.yearList&&this.yearList.length?this.yearList[0].label:this.radio,this.templateId=s.value,this.treeNode=s,this.changeTableFlag=!1,this.costOfMethodsInit()},mergeScopeInit:function(){var e=this;if(this.fullscreenLoading=!0,!this.curCustomerId||!this.curProjectId)return console.log("缺少客户id或项目id!");this.$sacpApis.findSubsidiary().then(function(t){t.success?t.data&&(e.hasCheckBox=!0,e.generationOffsetColumns=[{label:"公司简称",prop:"label",fixed:"left"},{label:"合并比例(本期)",prop:"curMergeProportion",fixed:"left"},{label:"合并比例(上期)",prop:"preMergeProportion",fixed:"left"},{label:"提取比例",prop:"extractionRatio",fixed:"left"}],e.generationOffsetData=t.data):e.$message.error(t.resultInfo.statusText)}).catch(function(t){e.$message.error(t)}).finally(function(){e.fullscreenLoading=!1,e.$store.commit("setMergeScopeRefresh",!1)})},costOfMethodsInit:function(){var e=this;if(this.fullscreenLoading=!0,!this.curCustomerId||!this.curProjectId)return console.log("缺少客户id或项目id!");this.$sacpApis.findSubsidiary().then(function(t){t.success?t.data&&(e.hasCheckBox=!0,e.generationOffsetColumns=[{label:"公司简称",prop:"shortName",fixed:"left"},{label:"合并比例(本期)",prop:"curMergeProportion",fixed:"left"},{label:"合并比例(上期)",prop:"preMergeProportion",fixed:"left"},{label:"提取比例",prop:"extractionRatio",fixed:"left"}],t.data.forEach(function(e){e.extractionRatio&&(e.extractionRatio=Math.round(1e4*e.extractionRatio)/100+"%"),e.curMergeProportion&&(e.curMergeProportion=Math.round(100*e.curMergeProportion)/100+"%"),e.preMergeProportion&&(e.preMergeProportion=Math.round(100*e.preMergeProportion)/100+"%")}),e.generationOffsetData=t.data):e.$message.error(t.resultInfo.statusText)}).catch(function(t){e.$message.error(t)}).finally(function(){e.fullscreenLoading=!1})},outDialogCancel:function(){this.checkedSelectedValue=[],this.innerVisible=!1,this.editTableData=[],this.editTableColumns=[],this.costOffsetDialog=!1,this.editTable=!1,this.changeTableFlag=!1,this.footerTotal=0,this.isShow=!1},currentComany:function(e){var t=this.columnName;for(var a in t)a&&a==e&&this.$refs.transactionSummaryChildren.querySingleContactSummary(t[a],a)}},mounted:function(){this.footerTotal=0}},H={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"CostOffset"},[a("el-dialog",{attrs:{title:e.dialogTitle,visible:e.costOffsetDialog,"destroy-on-close":"","before-close":e.outDialogCancel,width:"85%"},on:{"update:visible":function(t){e.costOffsetDialog=t}}},[e.editTable?e._e():a("bdo-table",{ref:"offsetTable",attrs:{border:"",data:e.generationOffsetData,"page-total":e.generationOffsetData.length||0,columns:e.generationOffsetColumns,"enable-filter":!1,"enable-toolbox":!1,"enable-view-type":!1,"responsive-height-gap":250,showIndexColumn:!1,showCheckBox:e.hasCheckBox,enableRefresh:!1,enableHeadConfig:!1,setBorder:!0,"default-expand-all":!1,exportReport:!1},on:{handleSelect:e.handleCheckedSelect,currentComany:e.currentComany}}),e._v(" "),e.changeTableFlag?e._e():a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.outDialogCancel}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.ofsetDialogConfirm}},[e._v("确 定")])],1)],1),e._v(" "),a("transaction-summary-children",{ref:"transactionSummaryChildren"})],1)},staticRenderFns:[]},W=a("VU/8")(G,H,!1,null,null,null).exports,J=a("HNYb"),X={name:"CostOffsetting",components:{numberInput:P,amountInput:{template:'<div class="subjectCell amountCell"\n                                @click="clickCell(true)"\n                                v-if="!showInput"\n                                >{{formatter.commafy(\'\',scope.row[scope.column.property]*1) }}</div\n                            >\n                            <el-input\n                                @blur.stop="clickCell(false)"\n                                v-else="showInput"\n                                ref="input"\n                                :maxlength="num"\n                                clearable\n                                v-model="scope.row[scope.column.property]"\n                            />',data:function(){return{formatter:O.b,showInput:!1,borrowing:!0,num:"16"}},props:["scope"],methods:{clickCell:function(e){var t=this;if(this.showInput=e,e)this.$nextTick(function(){t.$refs.input.focus()});else{var a=this.scope.row[this.scope.column.property];this.scope.row[this.scope.column.property]="string"==typeof a?a.replaceAll(",",""):a}}}},autocompleteInput:{template:'\n    <div class="subjectCell amountCell"\n                                @click="clickCell(true)"\n                                v-if="!showAutocomplete"\n                                >{{ scope.row[scope.column.property] }}</div\n                            >\n    <el-autocomplete\n                                v-else="showAutocomplete"\n                                v-model="scope.row[scope.column.property]"\n                                ref="autocomplete"\n                                :fetch-suggestions="querySearchAsync"\n                                placeholder="请输入内容"\n                                clearable\n                                :maxlength="num"\n                                size="large"\n                                @select="handleSelect"\n                                @blur="onBlur"\n                                @focus="onFocus"\n                            ></el-autocomplete>',data:function(){return{showAutocomplete:!1,secondSubjectRestaurants:[],num:16}},props:["scope","restaurants","adjustTableData"],methods:{clickCell:function(e){var t=this;this.showAutocomplete=e,e&&this.$nextTick(function(){t.$refs.autocomplete.focus()})},onBlur:function(){this.showAutocomplete=!this.showAutocomplete},onFocus:function(){this.scope&&this.scope.column&&"secondSubject"===this.scope.column.property&&this.querySecondarySubjectList(),this.scope&&this.scope.column&&"otherDescription"===this.scope.column.property&&this.queryOtherDescription()},querySecondarySubjectList:function(){var e,t=this,a=sessionStorage.getItem("curCustomerData"),s=JSON.parse(a),r=s.curCustomerId,o=s.curProjectId,n=this.scope.row,i={projectId:o,customerId:r,tbSubjectCode:(e=this.adjustTableData.filter(function(e){return e.tbSubjectName==n.label}))[0].tbSubjectId,tbSubjectName:e[0].tbSubjectName};this.$sacpApis.querySecondarySubjectList(i).then(function(e){e.success?e.data&&e.data[0]&&e.data[0].list?e.data[0].list.forEach(function(e,a){t.secondSubjectRestaurants.push({label:e,value:e})}):t.secondSubjectRestaurants=[]:t.$message.error(e.resultInfo.statusText)}).catch(function(e){t.$message.error(e)})},queryOtherDescription:function(){this.scope.row},querySearchAsync:function(e,t){var a=this.scope&&this.scope.column&&"label"===this.scope.column.property?this.restaurants:this.secondSubjectRestaurants;if(a instanceof Array)var s=a.filter(this.createStateFilter(e))||[].concat(r()(a));clearTimeout(this.timeout),this.timeout=setTimeout(function(){t(s)},500*Math.random())},createStateFilter:function(e){return function(t){return 0===t.value.toLowerCase().indexOf(e.toLowerCase())}},handleSelect:function(e){"label"===this.scope.column.property&&(this.scope.row.subjectCode=e.label)}}}},props:{childRow:{type:Object,default:{}},childObj:{type:Object,default:{}}},data:function(){return{activeName:"thisYear",isBorder:!0,data:[],loading:!1,curProjectId:"",curCustomerId:"",tabList:[{label:"本年",name:"thisYear"},{label:"上年",name:"oldYear"}],columns:[{label:"科目",prop:"label",align:"left",flag:"A"},{label:"二级科目",prop:"secondSubject",align:"left",flag:"B"},{label:"描述",prop:"otherDescription",align:"left",flag:"C"},{label:"合计",prop:"sum",align:"right",flag:"D"}],tbSubject:[],restaurants:[],state:"",timeout:null,data3:[],data1:[],data2:[],tableColumns:[],tableData:[],checkResult:!1,borrowing:[],arrbox:"",lsObj:{},lsColumns:[],subjectNameList:[],curYear:"",adjustTableData:[]}},computed:{},watch:{tableData:{handler:function(e,t){this.sums()},immediate:!0,deep:!0},roleList:{handler:function(e){e&&e[0]&&(this.subjectNameList=(e[0].tb||[]).map(function(e){return{label:e.label,value:e.value,showLabel:e.value+"-"+e.label}}))},immediate:!0,deep:!0}},methods:{costOfsetMethods:function(){var e=this.childRow;this.abb(e),this.dataMarry()},abb:function(e){var t=this,a=e.param1;this.loading=!0,this.$sacpApis.costOfMethodsOffset({param1:a}).then(function(e){e.success?(e.data&&(t.data3=e.data[0].pre,t.data1=e.data[0].cur,t.data2=e.data[0].columnName),t.dataMarry(),t.$nextTick(function(){t.$refs.ellTable[0].doLayout()})):t.$message.error(e.resultInfo.statusText)}).catch(function(e){t.$message.error(e)}).finally(function(){t.loading=!1})},queryOtherDescription:function(){this.scope.row},dataMarry:function(){var e=JSON.parse(b()(this.columns)),t=[],a=this.data2?this.data2:{};for(var s in a)t.push({label:s,prop:a[s],align:"right"}),e.push({label:s,prop:a[s],align:"right"});t=N()(new x.a(t.map(function(e){return b()(e)}))).map(function(e){return JSON.parse(e)}),e=N()(new x.a(e.map(function(e){return b()(e)}))).map(function(e){return JSON.parse(e)});var r=.75*window.innerWidth;t.forEach(function(e){t.length<7?e.minWidth=parseInt(r/t.length):e.minWidth=120}),this.lsColumns=e,this.tableColumns=t,"thisYear"==this.activeName&&(this.tableData=[],this.tableData=J.a.markDataList(this.data1||[])),"oldYear"==this.activeName&&(this.tableData=[],this.tableData=J.a.markDataList(this.data3||[]))},tableRowClassName:function(e){var t=e.row,a=e.rowIndex;return 1===t.direction&&a+1?"borrow-row":-1===t.direction&&a+1?"loan-row":"other-row"},sums:function(){var e=this;if(this.lsColumns.length>3){var t=this.lsColumns.map(function(e,t){if(t>3)return e.prop});this.tableData.forEach(function(a){var s=0;t.forEach(function(e){s=w.a.add(a[e],s)}),e.$set(a,"sum",s)})}},getSummaries:function(e){var t=e.columns,a=e.data,s=[];t.forEach(function(e,t){if(0!==t)if(1!==t)if(2!==t){var r=a.map(function(t){return Number(t[e.property]*t.direction)});r.every(function(e){return isNaN(e)})?s[t]="":(s[t]=r.reduce(function(e,t){var a=Number(t);return isNaN(a)?e:e+t},0),s[t]+="")}else s[t]="";else s[t]="";else s[t]="核对"});var r=[];return s.forEach(function(e){var t=e&&!isNaN(1*e)?O.b.commafy("",1*e):e;r.push(t)}),this.footerStyle(r),r},footerStyle:function(e){this.checkResult="0.00"===e[3];for(var t=document.querySelectorAll(".el-table__footer-wrapper"),a=0;a<t.length+1;a++)if(t[a]){var s=t[a].querySelector("tr"),r=t[a].querySelectorAll("td");s&&r&&(this.checkResult?s.style.backgroundColor="#93ff93":s.style.backgroundColor="#ffc5ed",r.forEach(function(e){e.style.backgroundColor="unset"}))}for(var o=document.querySelectorAll(".el-table__fixed-footer-wrapper"),n=0;n<o.length+1;n++)if(o[n]){var i=o[n].querySelector("tr"),l=o[n].querySelectorAll("td");i&&l&&(this.checkResult?i.style.backgroundColor="#93ff93":i.style.backgroundColor="#ffc5ed",l.forEach(function(e){e.style.backgroundColor="unset"}))}},handleClick:function(e,t){this.dataMarry()},cellData:function(e){var t=e.row,a=e.column,s=t[a.property];return"sum"===a.property?O.b.commafy("",1*s):s},saveAutoOffsetData:function(){var e=this;this.labelArr=this.childRow.param1.split(","),J.a.unmarkDataList(this.tableData).map(function(t){w.a.keys(t);var a=t.label;e.labelArr.map(function(e){w.a.has(t,e)&&w.a.get(t,e)}),w.a.set(t,"tbSubjectName",a);var s=e.tbSubject.filter(function(e){return a===e.label}),r=void 0,o=void 0;s&&s.length?r=(o=s[0].value)+"-"+s[0].label:(r=null,o=null),w.a.set(t,"tbSubjectCodeName",r),t["合计"]=""+t.sum,t.tbSubjectCode||w.a.set(t,"tbSubjectCode",o)})},offsetEntrySubjectNameList:function(e){var t=this;return new u.a(function(a,s){t.$sacpApis.offsetEntrySubjectNameList().then(function(s){if(s.success){var r=s.data[0].tb;t.tbSubject=r,e.forEach(function(e){r.forEach(function(t){t.label===e.subjectName&&(e.direction=t.direction)})}),a(e)}else t.$message.error(s.resultInfo.statusText)})})},offsetEntryAddSave:function(e){var t=this;if(!this.checkResult)return this.$message.error("核对不为0!"),{then:function(){}};this.loading=!0;var a={};this.tableColumns.forEach(function(e,t){t>2&&(a[e.prop]=e.label)});var s="";if(e.children){for(var r=this.leftTReeNode.filter(function(t){return t.value===e.value})[0].children,o=0;o<r.length;o++)if(r[o].classify===this.activeName){s=r[o].value;break}}else s=e.value;this.tableData.forEach(function(e){for(var t in e)for(var r in"number"==typeof e[t]&&(e[t]=""+e[t]),a)if(t===r){e[a[r]]=e[t];break}e.templateId=s,e.tbSubjectCode=e.subjectCode,e.tbSubjectName=e.subjectName,e["合计"]=""+e.sum}),this.saveAutoOffsetData();var n=JSON.parse(sessionStorage.getItem("curCustomerData"));this.curYear=n.curYear,"thisYear"==this.activeName&&(this.curYear=this.curYear),"oldYear"==this.activeName&&(this.curYear=this.curYear-1),console.log(this.tableData,"222");var i={yyyy:this.curYear,projectId:n.curProjectId,project:this.childObj,adjustType:e.type,arr:this.tableData};return this.$sacpApis.offsetEntryAddSave(i).then(function(e){return e.success?(t.loading=!1,t.$message.success("保存成功")):t.$message.error(e.resultInfo.statusText),e}).catch(function(e){return t.$message.error(e)}).finally(function(){t.loading=!1})},getSubjectNameList:function(){var e=this;this.$sacpApis.offsetEntrySubjectNameList().then(function(t){t.success?e.tbSubject=t.data[0].tb:e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)})},adjustDebTableInit:function(){var e=this;this.$sacpApis.queryProjectTb().then(function(t){t.success&&(e.adjustTableData=t.data)}).catch(function(t){return e.$message.error(t)})}},mounted:function(){this.adjustDebTableInit(),this.getSubjectNameList()}},U={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.loading,expression:"loading",modifiers:{fullscreen:!0,lock:!0}}]},[a("el-tabs",{attrs:{type:"card"},on:{"tab-click":function(t){return e.handleClick(e.tableData)}},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(e.tabList,function(t,s){return a("el-tab-pane",{key:s,attrs:{label:t.label,name:t.name,height:"calc(100vh - 250px)"}},[a("el-table",{ref:"ellTable",refInFor:!0,staticStyle:{width:"100%"},attrs:{data:e.tableData,"show-summary":"","row-class-name":e.tableRowClassName,"summary-method":e.getSummaries,"row-style":{height:"42px"},"cell-style":{padding:0},border:"",height:"calc(100vh - 250px)","max-height":"500px"}},[e._l(e.columns,function(t){return a("el-table-column",{key:t.flag,attrs:{prop:t.prop,label:t.label,width:"200",align:t.align,"header-align":t.align,fixed:""},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row,r=t.column;return["label"===r.property?a("span",[e._v(e._s(1==s.direction?"借:":"贷:"))]):e._e(),e._v(" "),isNaN(1*r.property)?"secondSubject"===r.property?a("autocomplete-input",{attrs:{scope:{row:s,column:r},restaurants:e.restaurants,adjustTableData:e.adjustTableData}}):"otherDescription"===r.property?a("autocomplete-input",{attrs:{scope:{row:s,column:r},restaurants:e.restaurants,adjustTableData:e.adjustTableData}}):a("span",[e._v(e._s(e.cellData({row:s,column:r})))]):a("amount-input",{attrs:{scope:{row:s,column:r}}})]}}],null,!0)})}),e._v(" "),e._l(e.tableColumns,function(t,s){return a("el-table-column",{key:s,attrs:{prop:t.prop,label:t.label,width:t.width,align:t.align,"min-width":200,"header-align":t.align},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row,r=t.column;return[isNaN(1*r.property)?e._e():a("amount-input",{attrs:{scope:{row:s,column:r}}})]}}],null,!0)})})],2)],1)}),1)],1)},staticRenderFns:[]};var K=a("VU/8")(X,U,!1,function(e){a("XKgs")},"data-v-d951b72e",null).exports,Z={prop:"offsetEntry",components:{checkListTable:M,AutoGenerationOffset:j.a,transactionSummary:$,internalFixedOffsetTable:z,CostOffset:W,CostOffsetting:K},computed:{refreshImportRelate:function(){return this.$store.state.refreshPagesMenuId}},watch:{refreshImportRelate:{handler:function(e){e===this.flag&&this.offsetEntryInit()}}},props:{customerId:String,projectId:String,subjectId:String,subjectName:String,offsetType:String,customerData:Array},mixins:[C.a],data:function(){var e=this;return{result:null,loading:!1,checkListTableShow:!1,secondSubject:[],isCollapse:!1,isScreen:!1,flag:"HB004-OE001",activeFlagValue:[],activeFlag:"",menuList:[],entryCategory:[],defaultProps:{children:"children",label:"label"},curMenuItem:{},isShowTable:!1,childRow:"",childObj:{},subtract:0,allAlign:"right",tbOffsetColumn:[{label:"操作",prop:"autoId",width:"50px",fixed:"left"},{label:"科目名称",prop:"tbSubjectName",fixed:"left"},{label:"二级科目",prop:"secondSubject",fixed:"left"},{label:"描述",prop:"otherDescription",fixed:"left"},{label:"借方金额",prop:"deb",align:"right",formatter:{type:"function",value:this.fixedNumber}},{label:"贷方金额",prop:"cre",align:"right",formatter:{type:"function",value:this.fixedNumber}},{label:"索引号",prop:"indexId",data:"indexId"},{label:"摘要",prop:"digest"},{label:"科目编号",prop:"tbSubjectCode"},{label:"项目",prop:"projectName"},{label:"状态",prop:"activeFlag",formatter:{type:"function",value:this.activeFlagFormatter}},{label:"未调整原因",prop:"reason"},{label:"调整年份",prop:"yyyy"}],tbOffsetColumn1:[{label:"操作",prop:"autoId",width:"150px",children:[{label:"操作",prop:"aaa",width:"150px"},{label:"操作",prop:"ddd",width:"150px"},{label:"操作",prop:"auwwwwtoId",width:"150px"}]},{label:"贷方金额",prop:"cre"},{label:"项目",prop:"projectName"},{label:"状态",prop:"activeFlag"},{label:"未调整原因",prop:"reason"},{label:"调整年份",prop:"yyyy"}],curTbOffsetData:[],spanArr:[],position:0,offsetTypes:[{label:"试算平衡表抵销",type:"2"},{label:"现金流量表抵销",type:"3"}],dataLenght:0,addDialogFormVisible:!1,addFormData:{style:"",object:""},addEditFormRule:{},formLabelWidth:"120px",addItemTableData:[],projectList:[],debDisabled:!1,creDisabled:!1,yearList:[],selectedProjectId:"",yyyy:"",editDialogFormVisible:!1,isEdit:!1,editOrAddTitle:"新建分录",selectedSubjectName:"",editItemTableData:[],selectOffsetObject:[],selectOffsetType:"",curRowIndex:-1,curRow:{},roleList:[],modelsDialogVisible:!1,changeModel:[],lastModelList:[],templateData:[],defaultPropsT:{children:"children",label:"label"},subjectNameList:[],tbSubjectNameValue:null,isNewAdjustForm:!1,curCustomerId:"",curAccYear:"",curProjectId:"",departmentIdr:"",queryConfig:function(t,a,s){return e.offsetEntryInit()},queryOffsetSummaryConfig:function(t,a,s){e.queryMergeCashFlowSummary()},activeRowBackOld:{},editTitle:"",selectYear:"",autoGenerationOffset:!1,autoGenerationOffsetDialog:!1,transactionOffentSet:!1,checkVisible:!1,checkItemTableData:[],checkItemColumn:[],checkStatus:!0,clear:!1,copyList:[],showBtnType:"",showInside:!1,InternalFixedOffsetIsShow:!1,costOffsettingIsShow:!1,treeNode:{},dialogVisible:!1,mergeCashFlowSummaryColumn:[],mergeCashFlowSummaryData:[],transactionDialogVisible:!1,fullScreen:!1,tabActive:"5",tab:[{label:"接受劳务",name:"5"},{label:"固定资产",name:"6"},{label:"无形资产",name:"7"}],queryOffsetParam:{},treeNodeValue:"",changedIdSet:[],childData:""}},methods:{fullScreenChange:function(){this.fullScreen=!this.fullScreen},saveSingleToHbInsiderTradingData:function(){var e=this;this.$sacpApis.saveSingleToHbInsiderTradingData().then(function(t){t.success?e.$message.success("初始化成功"):e.$message.error(t.resultInfo.statusText)})},loadingFalse:function(){this.loading=!1,this.InternalFixedOffsetIsShow=!1,this.offsetEntryInit()},costOffsetFalse:function(){this.loading=!1,this.costOffsettingIsShow=!1},cellClass:function(e){var t=e.row;e.rowIndex;""===this.rowIndexId?(this.rowIndexId=t.indexId,this.classCount=0):this.rowIndexId!==t.indexId&&(this.rowIndexId=t.indexId,this.classCount=!this.classCount)},closeInternalFixedOffsetShow:function(){this.InternalFixedOffsetIsShow=!1},closeCostOffsetting:function(){this.costOffsettingIsShow=!1},internalFixedOffsetTableSave:function(){var e=this;this.$refs.internalFixedOffsetTable.offsetEntryAddSave(this.treeNode).then(function(t){t.success&&(e.InternalFixedOffsetIsShow=!1)})},InternalFixedOffsetShow:function(){this.InternalFixedOffsetIsShow=!0},costOffsettingShow:function(){var e=this;this.$refs.costOffsettingModal.offsetEntryAddSave(this.treeNode).then(function(t){t.success&&(e.costOffsettingIsShow=!1)})},closeCheckListShow:function(){this.checkListTableShow=!1},showCheckList:function(){var e=this;this.checkListTableShow=!0,setTimeout(function(){e.$refs.checkListTable.getTableData()})},closeShowInside:function(){this.showInside=!1},showInsideTable:function(){var e=this;this.showInside=!0,setTimeout(function(){"5"===e.showBtnType&&e.$refs.tableType1.getTableData(),"6"===e.showBtnType&&e.$refs.tableType2.getTableData(),"7"===e.showBtnType&&e.$refs.tableType3.getTableData()})},queryMerchantInsideClassify:function(){var e=this;this.transactionDialogVisible=!0,this.$sacpApis.queryMerchantInsideClassify().then(function(t){t.success?(e.tableColumns=t.data,e.$nextTick(function(){e.$refs.transactionSummary.tabItemList(t.data)})):e.$message.error(t.resultInfo.statusText)}).catch(function(t){e.$message.error(t)}).finally(function(){e.fullscreenLoading=!1})},createFilter:function(e){return function(t){return 0===t.value.toLowerCase().indexOf(e.toLowerCase())}},querySearch:function(e,t,a){var s=a.secondSubjectList;t(e?s.filter(this.createFilter(e)):s)},queryDescription:function(e,t,a){},handleSelect:function(e){},rowStyle:function(e){e.row,e.rowIndex;return"font-size:14px !important;font-weight: bold;"},hasValue:function(e){var t=e.row,a=e.column;e.rowIndex;if(0==e.columnIndex)return"text-align:center;font-size:14px !important;font-weight:bold;color:#909399;";if(t[a.label]&&t[a.label].split(",").every(function(e){return!g()(1*e)}))return"color:red;"},handleCollapse:function(){this.isCollapse=!this.isCollapse},saveGenerationOffsetData:function(){this.$refs.autoGenerationOffsetTable.save()},changeOffsetTable:function(){this.$refs.autoGenerationOffsetTable.changeTable(this.curProjectId,this.yearList,this.curMenuItem)},initOffSetByHand:function(){this.$refs.autoGenerationOffsetTable.initOffSetByHand(this.curCustomerId,this.curProjectId,this.yearList,this.curMenuItem)},selectedActiveFlage:function(){this.offsetEntryInit()},updateFooterEvent:function(e){this.$refs.editItemTable;this.$refs.addItemTable.updateFooter()},isRefreshDataLength:function(e){this.dataLenght=e},refreshAutoOffsetTable:function(e){e&&this.offsetEntryInit()},rowClassName:function(e){e.row,e.rowIndex},rowspan:function(e,t){var a=this;this.spanArr[e]=[],this.position=0,this.curTbOffsetData.forEach(function(s,r){0===r?(a.spanArr[e].push(1),a.position=0):a.curTbOffsetData[r][t]===a.curTbOffsetData[r-1][t]?(a.spanArr[e][a.position]+=1,a.spanArr[e].push(0)):(a.curTbOffsetData.splice(),a.spanArr[e].push(1),a.position=r)}),this.spanArr[0]=this.spanArr[1];var s=0;for(var r in this.spanArr[0])this.spanArr[0][r]>0&&(s+=1,this.curTbOffsetData[r]&&this.$set(this.curTbOffsetData[r],"mergeCellOrder",s))},objectSpanMethod:function(e){e.row,e.column;for(var t=e.rowIndex,a=e.columnIndex,s=0;s<2;s++)if(a===s){var r=this.spanArr[s][t];return{rowspan:r,colspan:r>0?1:0}}},addOffsetEntry:function(e){switch(this.addDialogFormVisible=!0,this.isEdit=!1,this.selectOffsetObject=[],this.selectOffsetType="",this.lastModelList=[],this.addItemTableData=[{digest:"",tbSubjectName:"",deb:"0",cre:"0",dis:!1,secondSubject:"",projectName:"",projectId:""},{digest:"",tbSubjectName:"",deb:"0",dis:!1,cre:"0",secondSubject:"",projectName:"",projectId:""}],e){case"tb":this.selectOffsetType=2,this.isNewAdjustForm=!1,this.editOrAddTitle="新建试算平衡表抵销";break;case"cash":this.selectOffsetType=3,this.isNewAdjustForm=!1,this.editOrAddTitle="新建现金流量表抵销"}this.selectedOffsetType()},selectedOffsetType:function(){var e=this,t=[];this.selectOffsetType||(this.selectOffsetObject=[]),this.menuList.forEach(function(t){return t.type==e.selectOffsetType?e.entryCategory=t.children:""}),this.roleList.forEach(function(a){(t=e.selectOffsetType==Number(3)?a.cash:a.tb)&&t.map(function(e){e.showLabel=e.value+"-"+e.label}),e.subjectNameList=t,e.projectList=(a.project||[]).map(function(e){return{label:e.label,value:e.value,showLabel:e.label}})})},selectedOffsetObject:function(){var e=this;if(this.$refs.cascader.getCheckedNodes()[0]){var t=this.$refs.cascader.getCheckedNodes()[0].value;if(this.lastModelList.length){var a=w.a.findIndexOf(this.lastModelList,function(t){return t.data.value==w.a.last(e.selectOffsetObject)});this.$XModal.confirm("您确定要改变分录类别吗?这会导致已经填写过的内容丢失!").then(function(s){"confirm"===s?(e.$refs.addItemTable.remove(),e.modelsDialogVisible=!0,-1!=a&&e.lastModelList.splice(a,1),e.lastModelList.push(e.$refs.cascader.getCheckedNodes()[0]),e.getTemplateData(t),e.addItemTableData=[{digest:"",tbSubjectName:"",deb:"0",cre:"0",secondSubject:"",projectName:"",projectId:""},{digest:"",tbSubjectName:"",deb:"0",cre:"0",secondSubject:"",projectName:"",projectId:""}]):1==e.lastModelList.length?(e.$refs.cascader.getCheckedNodes()[0]=e.lastModelList[0],e.selectOffsetObject=e.lastModelList[0].path):(e.selectOffsetObject=e.lastModelList[e.lastModelList.length-1].path,e.$refs.cascader.getCheckedNodes()[0]=e.lastModelList[e.lastModelList.length-1])})}else this.modelsDialogVisible=!0,this.getTemplateData(t),this.lastModelList.push(this.$refs.cascader.getCheckedNodes()[0])}else this.lastModelList=[],this.addItemTableData=[{digest:"",tbSubjectName:"",dis:!1,deb:"0",cre:"0",secondSubject:"",secondSubjectList:[],projectName:"",projectId:""},{digest:"",tbSubjectName:"",deb:"0",dis:!1,cre:"0",secondSubject:"",secondSubjectList:[],projectName:"",projectId:""}]},getTemplateData:function(e){var t=this;this.$sacpApis.offsetEntryTemplate({templateId:e}).then(function(e){e.success?e.data&&(t.templateData=e.data):t.$message.error(e.resultInfo.statusText)}).catch(function(e){return t.$message.error(e)})},selectedAll:function(){var e=[];this.templateData.forEach(function(t){return e.push(t.label)}),this.$refs.tree.setCheckedKeys(e)},resetChecked:function(){var e=this;this.$nextTick(function(){e.$refs.tree.setCheckedKeys([])})},checkNote:function(e){var t=this;if(!e.tbSubjectCodeName)return this.$message.error("请先选择科目!");var a={projectId:this.curProjectId,customerId:this.curCustomerId,tbSubjectCode:e.tbSubjectCodeName.split("-")[0]};this.$sacpApis.offsetEntryView(b()(a)).then(function(e){if(e.success)if(1==e.resultInfo.status)t.$message.error("该科目未对照报表科目");else if(2==e.resultInfo.status)t.$message.error("该科目对照的报表科目未对照附注");else if(3==e.resultInfo.status)t.$alert("该科目附注未生成是否查看附注模板?",{confirmButtonText:"确定",callback:function(e){"confirm"===e&&t.viewTemplate(b()(a))}});else{var s={extraOptions:e.data[0].rowData,currentNode:{extraOptions:e.data[0].rowData}};s.autoId=s.extraOptions.autoId,sessionStorage.setItem("mergeNoteInfoNode",b()(s)),window.open("/Faith/dgcenter.do?m=openMergeNoteInfo&noteNo="+s.extraOptions.noteNo)}else t.$message.error(e.resultInfo.statusText)})},viewTemplate:function(e){this.$sacpApis.offsetViewTemplate(e).then(function(e){if(e.success&&e.data){var t={extraOptions:e.data[0].rowData,currentNode:{extraOptions:e.data[0].rowData}};t.autoId=t.extraOptions.autoId,sessionStorage.setItem("mergeNoteTemplateNode",b()(t)),window.open("/Faith/dgcenter.do?m=openMergeNoteTemplate&noteNo="+t.extraOptions.noteNo)}})},changeTbSubjectName:function(e,t){if(e&&(e.tbSubjectCodeName||e.tbSubjectName)){var a=[];e.tbSubjectName?a=this.subjectNameList.filter(function(t){return t.value==e.tbSubjectCodeName}):e.tbSubjectCodeName&&(a=this.subjectNameList.filter(function(t){return t.value==e.tbSubjectCodeName})),a.length&&this.addItemTableData.forEach(function(t){t.stdAcctCode==e.stdAcctCode&&(t.tbSubjectCode=a[0].value,t.tbSubjectName=a[0].label)})}e.tbSubjectCodeName&&this.querySecondarySubjectList(e,t),this.$refs.addItemTable.reloadData(this.addItemTableData)},clearTbSubjectName:function(e){e&&this.addItemTableData.forEach(function(t){t.stdAcctCode==e.stdAcctCode&&(t.tbSubjectCode="",t.tbSubjectName="",t.tbSubjectCodeName="")}),e.secondSubjectList=[],this.$refs.addItemTable.reloadData(this.addItemTableData)},handleCellClick:function(e){var t=e.row,a=e.rowIndex;e.column,e.columnIndex;this.curRowIndex=a,this.curRow=t},handleEditCellClick:function(e){var t=e.row,a=e.rowIndex;e.column,e.columnIndex;this.curRowIndex=a,this.curRow=t},editActivedEvent:function(e){var t=e.row,a=e.column;this.activeRowBackOld=p()({},t),this.creDisabled=!("cre"!==a.property||void 0!=t.cre||!this.isEdit),this.debDisabled=!("deb"!==a.property||void 0!=t.deb||!this.isEdit),this.debDisabled=Number(t.cre)>0&&!this.isEdit,this.creDisabled=Number(t.deb)>0&&!this.isEdit},insertEvent:function(e){this.$refs.addItemTable.insertAt(e,-1).row;this.addItemTableData.push({digest:"",tbSubjectName:"",deb:"0",cre:"0",secondSubjectList:[]})},removeEvent:function(){var e=this;this.addItemTableData.length<=2?this.$message.warning("至少需要新增2条数据"):this.$XModal.confirm("您确定要删除该数据?").then(function(t){"confirm"===t&&(e.$refs.addItemTable.remove(e.curRow),e.addItemTableData=e.addItemTableData.filter(function(t){return t.stdAcctCode!=e.curRow.stdAcctCode}))})},selectedYearDate:function(){var e=this;this.yearList.forEach(function(t){if(t.value==e.selectYear)return e.selectYear=t.label}),this.offsetEntryInit()},closeDialog:function(){var e=this;this.$XModal.confirm("您确定要取消编辑吗?").then(function(t){"confirm"===t&&(e.addDialogFormVisible=!1,e.addItemTableData=[],e.$refs.addItemTable.remove())})},selectedYear:function(){var e=this;this.yearList.forEach(function(t){if(t.value==e.yyyy)return e.yyyy=t.label})},submitAddDialogForm:function(e){var t=this;if(0==this.subtract){var a=this.$refs.addItemTable.data,s=function(e){return Number(a[e].cre)||Number(a[e].deb)?!a[e].cre&&!a[e].deb||w.a.trim(a[e].tbSubjectName)?((a[e].tbSubjectName||a[e].tbSubjectCodeName)&&t.subjectNameList.forEach(function(t){if(a[e].tbSubjectName&&a[e].tbSubjectName==w.a.trim(t.label)||a[e].tbSubjectCodeName&&(a[e].tbSubjectCodeName==w.a.trim(t.label)||a[e].tbSubjectCodeName==w.a.trim(t.value)))return a[e].tbSubjectName=t.label,void(a[e].tbSubjectCode=t.value)}),void(a[e].projectId&&(a[e].projectName=t.projectList.filter(function(t){return t.value===a[e].projectId})[0].label))):(t.$message.error("科目名称不能为空!"),{v:void 0}):(t.$message.error("无有效的可保存分录!"),{v:void 0})};for(var r in a){var o=s(r);if("object"===(void 0===o?"undefined":d()(o)))return o.v}this.saveOffSet(e,a)}else this.$message.error("差额必须为0才可以保存!")},saveOffSet:function(e,t){var a=this;for(var s in t)t[s].secondSubjectList=null;t.forEach(function(e){for(var t in e)"number"==typeof e[t]&&(e[t]=""+e[t])});var r={yyyy:this.yyyy||this.curAccYear,projectId:this.selectedProjectId,adjustType:this.selectOffsetType,arr:t};this.secondSubject.forEach(function(e,a){t.forEach(function(t,a){t.secondSubject==e.value&&(t.secondSubject=e.label)})}),this.$sacpApis.offsetEntryAddSave(r).then(function(s){s.success?(a.$message.success("保存成功"),a.hanldeSaveSuccess(e,t),a.offsetEntryInit(),a.$eventBus.$emit("page-refresh",s.resultInfo.refreshIndexes)):a.$message.error(s.resultInfo.statusText)}).catch(function(e){return a.$message.error(e)})},hanldeSaveSuccess:function(e,t){var a=this,s=this.menuList.filter(function(e){return e.type==a.selectOffsetType});this.handleNodeClick(s[0]),this.$refs.addItemTable.remove(),this.changeModel.length=0,this.selectOffsetObject=[],this.lastModelList=[],this.selectedProjectId="",this.yyyy="",e?(this.addDialogFormVisible=!1,this.$refs.addItemTable.revertData()):this.addItemTableData.forEach(function(e){w.a.clear(e,"")}),t[0].templateId&&this.curMenuItem.value==t[0].templateId&&this.offsetEntryInit(),this.$refs.addItemTable.reloadData(this.addItemTableData)},editOffset:function(e,t,a){var s=this;this.editDialogFormVisible=!0,this.curTbOffsetData.forEach(function(e){e.indexId==a.indexId&&(e.showLabel=e.tbSubjectCode&&e.tbSubjectName?e.tbSubjectCode+"-"+e.tbSubjectName:"",e.showProject=e.projectId&&e.projectName?e.projectId+"-"+e.projectName:"",s.editItemTableData.push(e))}),this.editTitle="编辑分录:"+a.indexId},submitEditDialogForm:function(){var e=this;if(0!=this.subtract)return this.$message.error("总金额存在差额,请修改");var t=this.$refs.editItemTable.data;t.forEach(function(e){for(var t in e)"number"==typeof e[t]&&(e[t]=e[t].toString())});var a={yyyy:t[0].yyyy,projectId:t[0].projectId,adjustType:t[0].adjustType,arr:t};this.$sacpApis.offsetModifySave(a).then(function(t){t.success?(e.$message.success("保存成功"),e.$eventBus.$emit("page-refresh",t.resultInfo.refreshIndexes)):e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$$message.error(t)}).finally(function(){e.editDialogFormVisible=!1,e.$refs.editItemTable.remove(),e.editItemTableData=[],e.offsetEntryInit()})},closeEditDialog:function(){var e=this;this.$XModal.confirm("您确定要取消编辑吗?").then(function(t){"confirm"===t&&(e.editDialogFormVisible=!1,e.editItemTableData=[],e.$refs.editItemTable.getUpdateRecords().length>0&&e.offsetEntryInit(),e.$refs.editItemTable.revertData(),e.$refs.editItemTable.remove())})},saveEditItem:function(){var e=this;this.copyList=[],this.modelsDialogVisible=!1,this.$refs.tree.getCheckedNodes().forEach(function(e){e.tbSubjectName=e.label,delete e.label});var t=this.$refs.tree.getCheckedNodes().filter(function(e){return e.digest&&e.tbSubjectName});if(t.map(function(t){e.subjectNameList.filter(function(e){w.a.trim(e.label)===w.a.trim(t.tbSubjectName)&&(t.tbSubjectCodeName=e.showLabel)})}),1==t.length){this.addItemTableData=t.concat([{digest:"",tbSubjectCodeName:"",tbSubjectName:"",dis:!1,deb:"0",cre:"0",secondSubjectList:[]}])}else t.length?this.addItemTableData=t:(this.addItemTableData=[{digest:"",tbSubjectCodeName:"",dis:!1,tbSubjectName:"",deb:"0",cre:"0",secondSubjectList:[]},{digest:"",dis:!1,tbSubjectName:"",deb:"0",cre:"0",secondSubjectList:[]}],this.$message("因没有对应的科目名称,有部分模板没有生成!"));this.$refs.addItemTable.remove();var a=[];this.addItemTableData.forEach(function(e,t){var s={tbSubjectName:e.tbSubjectName,tbSubjectCode:e.tbSubjectCodeName.split("-")[0]};a.push(s)}),this.querySecondarySubjectsList(a)},querySecondarySubjectsList:function(e){var t=this,a={projectId:this.curProjectId,customerId:this.curCustomerId,params:e};this.$sacpApis.querySecondarySubjectsList(a).then(function(e){if(e.success){var a=function(a){t.addItemTableData.map(function(t){if(t.tbSubjectCodeName.split("-")[0]==a){var s=[];e.data[0].list[a].map(function(e){s.push({label:e,value:e})}),t.secondSubjectList=s}})};for(var s in e.data[0].list)a(s)}})},delOffset:function(e){var t=this;this.$confirm("确定要删除这条数据吗？","确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.handleDelete(e)}).catch(function(e){})},lookOffset:function(e){this.$refs.autoGenerationOffsetTable.queryAutoOffsetInfoData(e)},handleDelete:function(e){var t=this,a={autoId:e.autoId};this.$sacpApis.offsetDelete(a).then(function(e){e.success?(t.$message.success("删除成功"),t.$eventBus.$emit("page-refresh",e.resultInfo.refreshIndexes),t.offsetEntryInit()):t.$message.error(e.resultInfo.statusText)}).catch(function(e){return t.$message.error(e)})},rowDisabled:function(e){var t=this;"0"==e.row.activeFlag?this.hanldeInvalidOffsetData(e,""):this.$confirm("确定要禁用这条数据吗？","确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.$prompt("请输入禁用理由","",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^\S{1,100}$/,inputErrorMessage:"禁用理由长度限制为100字!"}).then(function(a){var s=a.value;t.hanldeInvalidOffsetData(e,s)}).catch(function(){})}).catch(function(e){})},hanldeInvalidOffsetData:function(e,t){var a=this,s={autoId:e.row.autoId,reason:t};this.$sacpApis.invalidOffset(s).then(function(e){e.success?(a.offsetEntryInit(),a.$eventBus.$emit("page-refresh",e.resultInfo.refreshIndexes)):a.$message.error(e.resultInfo.statusText)}).catch(function(e){return a.$message.error(e)})},footerColspanMethod:function(e){e.columnIndex},footerMethod:function(e){var t=this,a=e.columns,s=e.data,r=[a.map(function(e,a){if(1===a)return"合 计";if(["deb","cre"].includes(e.property)){var r=void 0;for(var o in s){var n=s[o][e.property];-1!=String(n).indexOf(",")&&(n=String(n).replace(/,/gi,"")),n="string"==typeof n&&0==n.indexOf(0)&&n.indexOf(".")<1?0:1*n,r=w.a.add(r,t.removeComafy(n))}return w.a.commafy(r,{digits:2})}return null})];return 5===a.length?this.subtract=w.a.commafy(w.a.subtract(this.removeComafy(r[0][3]),this.removeComafy(r[0][4])),{digits:2}):4===a.length&&(this.subtract=w.a.commafy(w.a.subtract(this.removeComafy(r[0][2]),this.removeComafy(r[0][3])),{digits:2})),r},removeComafy:function(e){return-1!=String(e).indexOf(",")&&(e=String(e).replace(/,/gi,"")),Number(e)},offsetEntryInit:function(){var e=this;this.curTbOffsetData=[];var t,a=this.curCustomerId,s=this.curProjectId;return t=this.curMenuItem.value,this.queryOffsetParam={customerId:a,projectId:s,year:this.selectYear||"",value:t,offsetType:this.curMenuItem.type,activeFlage:this.activeFlag||""},new u.a(function(t,a){e.$sacpApis.queryOffsetListByTemplateId(e.queryOffsetParam).then(function(a){e.isShowTable=!0;e.curTbOffsetData=a.data,a.data?(e.handleDataLength(),e.rowspan(0,"autoId"),e.rowspan(1,"indexId")):e.dataLenght=0,t(a)}).catch(function(t){e.$message.error(t),a(t)}).finally(function(){e.$store.commit("setRefreshPagesMenuId","")})})},handleDataLength:function(){var e=this,t=this.curTbOffsetData.reduce(function(t,a){return!e.curTbOffsetData[a.indexId]&&(e.curTbOffsetData[a.indexId]=t.push(a)),t},[]);return this.dataLenght=t.length},handleMenu:function(){var e=this;this.$sacpApis.offsetEntryIndexMenu({departmentId:this.departmentIdr}).then(function(t){t.success?e.menuList=t.data:e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)}).finally(function(){})},handleNodeClick:function(e){this.debounce(this.getChangeOffsetIdCheckItem(),2e3),this.showBtnType=e.type,this.treeNode=e,e&&e.value!=this.curMenuItem.value&&("4"!=e.type||"58"!=e.value&&"59"!=e.value&&"61"!=e.value?this.isScreen=!1:this.isScreen=!0,62===e.value||63===e.value?this.autoGenerationOffset=!0:this.autoGenerationOffset=!1,"8"==e.type?(this.queryCheckItem(),this.transactionOffentSet=!0):this.transactionOffentSet=!1,this.curMenuItem=e,this.offsetEntryInit())},debounce:function(e,t){var a=void 0;return function(){var s=this,r=arguments;a&&clearTimeout(a),a=setTimeout(function(){e.apply(s,r)},t)}},setIcons:function(){S.a.setup({icon:{TABLE_EDIT:""}})},editClosedEvent:function(e){var t=e.row,a=(e.rowIndex,e.column);-1!=String(t[a.property]).indexOf(",")&&(t[a.property]=t[a.property].replace(/,/gi,"")),t[a.property]=void 0!=t[a.property]?w.a.trim(t[a.property]):t[a.property],"cre"!=a.property&&"deb"!=a.property||!(t[a.property]&&!/^(-?[1-9]\d+|-?\d?)(\.\d+)?$/.test(t[a.property])||void 0!=t[a.property]&&!t[a.property])||(t[a.property]=0)},activeFlagFormatter:function(e,t){return"0"==t?"废弃":"1"==t?"有效":void 0},formatFixedNumber:function(e,t){var a=e.cellValue;return-1!=String(a).indexOf(",")&&(a=a.replace(/,/gi,"")),w.a.commafy(a,{digits:2})},fixedNumber:function(e,t){return w.a.commafy(t,{digits:2})},getSubjectNameList:function(){var e=this;this.$sacpApis.offsetEntrySubjectNameList().then(function(t){t.success?e.roleList=t.data:e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)})},handleCurYear:function(){var e=this.curAccYear,t={value:"1",label:e},a={value:"2",label:e-1};this.yearList.push(t,a)},handleCurstomerId:function(){var e=JSON.parse(sessionStorage.getItem("curCustomerData"));this.curCustomerId=e.curCustomerId,this.curProjectId=e.curProjectId,this.curAccYear=e.curYear,this.departmentIdr=e.departmentIdr,this.handleMenu(),this.setIcons(),this.getSubjectNameList(),this.handleCurYear()},getChangeOffsetIdCheckItem:function(){var e=this;this.$sacpApis.getChangeOffsetIdCheckItem().then(function(t){t.success?e.changedIdSet=t.data[0].changedIdSet:e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)}).finally(function(){})},queryCheckItem:function(){var e=this;this.$sacpApis.queryCheckItem().then(function(t){if(t.success){var a=t.data[0].checkData,s=t.data[0].columnName;e.checkStatus=t.data[0].checkFlag,e.treeNode.checkFlag=t.data[0].checkFlag,t.data[0].checkFlag||(e.menuList[2].checkFlag=!1);var r=[];e.checkItemColumn=[{prop:"company",label:""}],e.checkItemTableData=[],a.forEach(function(e,t){r.push({company:l()(e)[0]}),n()(e).flat(1/0).forEach(function(e){p()(r[t],e)})}),r.forEach(function(e){var t=s.findIndex(function(t){return t==e.company});n()(e).forEach(function(t,a){0==t?e[l()(e)[a]]="平":t&&"number"==typeof t&&(e[l()(e)[a]]=w.a.commafy(t,{digits:2}),e.isNumber=!0)}),e.id=t}),r.sort(function(e,t){return e.id-t.id}),s.forEach(function(t){e.checkItemColumn.push({prop:t,label:t})}),e.checkItemTableData=r}else e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)}).finally(function(){})},checkTransactionSummary:function(){this.$refs.autoGenerationOffsetTable.queryContactSummary()},createOffset:function(e){64===this.treeNode.value?this.$refs.autoGenerationOffsetTable.queryContactSummary2(this.curMenuItem,this.curProjectId,this.curCustomerId,this.treeNode,e):this.$refs.autoGenerationOffsetTable.badDebt(this.curMenuItem,this.curProjectId,this.curCustomerId,this.treeNode,e)},badDebt:function(e){this.$refs.autoGenerationOffsetTable.badDebt(this.curMenuItem,this.curProjectId,this.curCustomerId,this.treeNode,e)},againCreateOffset:function(){var e=this;this.$sacpApis.initContactInformation().then(function(t){t.success?e.$message.success("子公司数据获取成功!"):e.$message.error(t.resultInfo.statusText)})},checkItemShow:function(){this.checkVisible=!0,this.queryCheckItem()},querySecondarySubjectList:function(e,t,a){var s=this;e.secondSubjectList=[],e.dis=!0;var o={projectId:this.curProjectId,customerId:this.curCustomerId,tbSubjectCode:e.tbSubjectCode,tbSubjectName:e.tbSubjectName};this.$sacpApis.querySecondarySubjectList(o).then(function(t){e.dis=!1,t.data&&t.data[0]&&t.data[0].list&&t.data[0].list.forEach(function(t,a){e.secondSubjectList.push({label:t,value:t})}),s.$forceUpdate(),a&&"1"===a&&(s.copyList.push(e),s.addItemTableData=[].concat(r()(s.copyList)))})},clearSecondSubject:function(e){e.secondSubject="",this.$refs.addItemTable.reloadData(this.addItemTableData)},renderContent:function(e,t){var a=t.node,s=t.data;t.store;return e("span",{class:"custom-tree-node",style:"color:"+(-1!=this.changedIdSet.indexOf(s.value)?"red":"")},[e("span",[a.label])])},handleClose:function(){this.dialogVisible=!1},queryMergeCashFlowSummary:function(){var e=this;this.dialogVisible=!0,this.$sacpApis.queryMergeCashFlowSummary().then(function(t){if(t.success){if(t.data){var a=t.data[0],s=a.columnName,r=[],o=[];for(var n in s)r.push({label:n,prop:s[n],miniWidth:"100px",align:"right",formatter:{type:"function",value:e.fixedNumber}}),o.push(s[n]);r.unshift({label:"科目",prop:"colName",fixed:"left",miniWidth:"200px"}),r.push({label:"合计",prop:"sum",fixed:"left",align:"right",miniWidth:"100px",formatter:{type:"function",value:e.fixedNumber}}),e.mergeCashFlowSummaryColumn=r,a.tableData.forEach(function(e){var t=0;o.forEach(function(a){t=w.a.add(t,e[a])}),e.sum=t}),e.mergeCashFlowSummaryData=a.tableData}}else e.$message.error(t.resultInfo.statusText)}).catch(function(t){return e.$message.error(t)})},initCashFlowStatementOffsetData:function(){var e=this;this.getChangedOffsetId(),this.loading=!0,setTimeout(function(){e.loading=!1},1e4),this.$sacpApis.initCashFlowStatementOffsetData().then(function(t){t.success?(e.$message.success("初始化成功!"),e.loading=!1):(e.$message.error(t.resultInfo.statusText),e.loading=!1)}).catch(function(t){return e.$message.error(t)})},cashFlowCreateOffset:function(){this.$refs.autoGenerationOffsetTable.queryMergeCashFlowSummary(this.treeNode)},costOfMethods:function(){91==this.treeNode.value&&this.$refs.costOffset.costOfMethods(this.curCustomerId,this.curProjectId,this.yearList,this.curMenuItem)},chooseObj:function(e){this.childObj=e},receiveEvent:function(e){var t=this;this.costOffsettingIsShow=!0,this.childRow=e,this.$nextTick(function(){t.$refs.costOffsettingModal.costOfsetMethods()})},handleTransactionDialogClose:function(e){this.transactionDialogVisible=!1},exportFile:function(){var e=this.queryOffsetParam,t=e.customerId,a=e.projectId,s=e.subjectName,r=e.subjectId,o=e.year,n=e.offsetType,i=e.value,l=e.mergeProject,c=e.activeFlage,u={columns:this.tbOffsetColumn,params:{param1:t,param2:a,param3:s,param4:r,param5:o,param6:n,param7:i,param8:l,param9:c},url:"dgCenter/HbOffsetEntry.queryOffsetListByTemplateId.json",fileName:"抵销分录"};this.exportExcel(u)},cellStyle:function(e){e.rowIndex;var t=e.columnIndex,a=e.row;e.column;return 6!=t&&5!==t||0!==a.dataType?{}:{color:"#E6A23C"}}},created:function(){this.handleCurstomerId();var e=this.$DIC("activeFlag");e.push({label:"全部",value:null}),this.activeFlagValue=e,this.getChangeOffsetIdCheckItem()}},Q={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"offsetEntry"},[s("div",{class:{fullScreen:e.fullScreen?"fullScreen":"",fullScreenBox:!0}},[s("el-container",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.loading,expression:"loading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"offsetEntryContainer",staticStyle:{border:"1px solid #eee"}},[s("el-aside",{class:e.isCollapse?"collapse":null,staticStyle:{height:"100%",width:"280px"}},[s("div",{staticClass:"treeList"},[s("el-tree",{attrs:{data:e.menuList,props:e.defaultProps,"render-content":e.renderContent},on:{"node-click":e.handleNodeClick}})],1)]),e._v(" "),e.isShowTable?s("el-main",[s("el-row",{staticClass:"row-bg",attrs:{type:"flex"}},[s("el-col",{staticClass:"collapseBtn",attrs:{span:1}},[s("el-button",{class:e.isCollapse?"el-icon-caret-right":"el-icon-caret-left",attrs:{type:"primary",size:"small",title:e.isCollapse?"展开":"收起"},on:{click:e.handleCollapse}})],1),e._v(" "),s("el-col",{attrs:{span:23}},[s("div",{staticClass:"headerBtnList"},[s("el-col",{staticClass:"tips"},[s("span",{directives:[{name:"show",rawName:"v-show",value:e.transactionOffentSet&&!e.checkStatus,expression:"\n                                        transactionOffentSet && !checkStatus\n                                    "}]},[e._v("校验不平")])]),e._v(" "),s("el-col",["5"===e.showBtnType?s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"初始化内部交易数据",placement:"top-start"}},["5"===e.showBtnType?s("el-button",{attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-refresh-right"},on:{click:function(t){return e.saveSingleToHbInsiderTradingData()}}}):e._e()],1):e._e(),e._v(" "),"5"===e.showBtnType?s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"生成抵销",placement:"top-start"}},["5"===e.showBtnType?s("el-button",{attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-s-order"},on:{click:function(t){return e.InternalFixedOffsetShow()}}}):e._e()],1):e._e(),e._v(" "),"5"===e.showBtnType?s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"查看校验表",placement:"top-start"}},["5"===e.showBtnType?s("el-button",{attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-tickets"},on:{click:function(t){return e.showCheckList()}}}):e._e()],1):e._e(),e._v(" "),"5"===e.showBtnType?s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"查看内部交易汇总",placement:"top-start"}},["5"===e.showBtnType?s("el-button",{staticStyle:{"margin-right":"35px !important"},attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-folder-opened"},on:{click:function(t){return e.queryMerchantInsideClassify()}}}):e._e()],1):e._e(),e._v(" "),e.transactionOffentSet||e.autoGenerationOffset||"2"!=e.showBtnType||"4"===e.showBtnType||"5"===e.showBtnType||"8"===e.showBtnType?e._e():s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"新建抵销",placement:"top-start"}},[e.transactionOffentSet||e.autoGenerationOffset?e._e():s("el-button",{staticClass:"balanceOffset",attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-folder-add"},on:{click:function(t){return e.addOffsetEntry("tb")}}})],1),e._v(" "),s("el-tooltip",{attrs:{effect:"dark",content:e.fullScreen?"取消全屏":"全屏",placement:"top-start"}},[s("el-button",{class:e.isScreen?"fullScreenBtnFlag":"fullScreenBtn",attrs:{type:"primary",circle:"",size:"small"},on:{click:e.fullScreenChange}},[e.fullScreen?e._e():s("img",{attrs:{src:a("/Dxn"),alt:""}}),e._v(" "),e.fullScreen?s("img",{attrs:{src:a("W+0t"),alt:""}}):e._e()])],1),e._v(" "),e.transactionOffentSet||e.autoGenerationOffset||"3"!=e.showBtnType||"4"===e.showBtnType||"5"===e.showBtnType||"8"===e.showBtnType?e._e():s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"新建抵销",placement:"top-start"}},[e.transactionOffentSet||e.autoGenerationOffset?e._e():s("el-button",{staticStyle:{"margin-right":"35px !important"},attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-tickets"},on:{click:function(t){return e.addOffsetEntry("cash")}}})],1),e._v(" "),!e.transactionOffentSet&&e.autoGenerationOffset?s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"生成抵销",placement:"top-start"}},[!e.transactionOffentSet&&e.autoGenerationOffset?s("el-button",{staticStyle:{"margin-right":"40px !important"},attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-s-help"},on:{click:e.initOffSetByHand}}):e._e()],1):e._e(),e._v(" "),e.transactionOffentSet?s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"重新获取子公司数据",placement:"top-start"}},[e.transactionOffentSet?s("el-button",{attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-refresh"},on:{click:e.againCreateOffset}}):e._e()],1):e._e(),e._v(" "),e.transactionOffentSet&&!e.curMenuItem.children?s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"生成抵销",placement:"top-start"}},[e.transactionOffentSet&&!e.curMenuItem.children?s("el-button",{attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-s-help"},on:{click:e.createOffset}}):e._e()],1):e._e(),e._v(" "),e.transactionOffentSet?s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"内部往来汇总",placement:"top-start"}},[e.transactionOffentSet?s("el-button",{attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-pie-chart"},on:{click:e.checkTransactionSummary}}):e._e()],1):e._e(),e._v(" "),e.transactionOffentSet?s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"查看校验项",placement:"top-start"}},[e.transactionOffentSet?s("el-button",{staticStyle:{"margin-right":"35px !important"},attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-data-analysis"},on:{click:e.checkItemShow}}):e._e()],1):e._e(),e._v(" "),"9"===e.showBtnType?s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"初始化子公司现金流量表",placement:"top-start"}},[s("el-button",{attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-refresh-right"},on:{click:function(t){return e.initCashFlowStatementOffsetData()}}})],1):e._e(),e._v(" "),"9"===e.showBtnType?s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"现金流量表自动抵销汇总查询",placement:"top-start"}},[s("el-button",{attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-pie-chart"},on:{click:function(t){return e.queryMergeCashFlowSummary()}}})],1):e._e(),e._v(" "),"9"===e.showBtnType?s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"生成抵销",placement:"top-start"}},["9"===e.showBtnType?s("el-button",{staticStyle:{"margin-right":"35px !important"},attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-s-help"},on:{click:e.cashFlowCreateOffset}}):e._e()],1):e._e(),e._v(" "),"6"===e.showBtnType?s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"生成抵销",placement:"top-start"}},["6"===e.showBtnType?s("el-button",{staticStyle:{"margin-right":"35px !important"},attrs:{circle:"",type:"primary",size:"small",icon:"el-icon-s-help"},on:{click:e.costOfMethods}}):e._e()],1):e._e()],1)],1),e._v(" "),s("BdoTable",{ref:"offsetTable",class:e.isScreen?"fullScreenFlag":"",attrs:{border:"",data:e.curTbOffsetData,"page-total":e.dataLenght,columns:e.tbOffsetColumn,"enable-filter":!1,"enable-toolbox":!1,"enable-view-type":!1,"responsive-height-gap":250,"span-method":this.spanArr&&this.spanArr.length?e.objectSpanMethod:function(){return[1,1]},"cell-style":e.cellStyle,showIndexColumn:!0,showCheckBox:!1,setBorder:!0,queryConfig:e.queryConfig,"row-class-name":{id:"indexId"}},on:{isRefreshDataLength:e.isRefreshDataLength,exportFile:e.exportFile},scopedSlots:e._u([{key:"col-autoId",fn:function(t){return[s("div",{staticClass:"buttonList"},[s("div",{staticStyle:{display:"flex","flex-direction":"column",width:"fit-content"}},[s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"编辑",placement:"top-start"}},[s("el-button",{attrs:{size:"mini",type:"success",icon:"el-icon-edit-outline normalWeight"},on:{click:function(a){return e.editOffset(t.row.autoId,t.row.customerId,t.row)}}})],1),e._v(" "),s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"删除",placement:"top-start"}},[s("el-button",{attrs:{size:"mini",type:"danger",disabled:"0"==t.row.activeFlag,icon:"el-icon-close normalWeight"},on:{click:function(a){return e.delOffset(t.row)}}})],1),e._v(" "),s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"查看",placement:"top-start"}},[s("el-button",{attrs:{size:"mini",type:"success",icon:"el-icon-view normalWeight"},on:{click:function(a){return e.lookOffset(t.row)}}})],1),e._v(" "),s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"1"==t.row.activeFlag?"禁用":"激活",placement:"top-start"}},[s("el-button",{attrs:{size:"mini",icon:"1"==t.row.activeFlag?"el-icon-unlock normalWeight":"el-icon-lock normalWeight",type:"1"==t.row.activeFlag?"info":"danger"},on:{click:function(a){return e.rowDisabled(t)}}})],1)],1)])]}}],null,!1,569962258)},[s("template",{slot:"action"},[s("div",{staticStyle:{float:"right",display:"flex"}},[s("div",{staticStyle:{"margin-right":"8px"}},[s("span",{staticStyle:{color:"#b1b1b1"}},[e._v("选择年份:")]),e._v(" "),s("el-select",{attrs:{filterable:"",clearable:"",placeholder:"请选择年份"},on:{change:e.selectedYearDate},model:{value:e.selectYear,callback:function(t){e.selectYear=t},expression:"selectYear"}},e._l(e.yearList,function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),s("div",[s("span",{staticStyle:{color:"#b1b1b1"}},[e._v("状态查询:")]),e._v(" "),s("el-select",{attrs:{filterable:"",clearable:"",placeholder:"请选择状态"},on:{change:e.selectedActiveFlage},model:{value:e.activeFlag,callback:function(t){e.activeFlag=t},expression:"activeFlag"}},e._l(e.activeFlagValue,function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)])])],2)],1)],1)],1):e._e()],1),e._v(" "),s("el-dialog",{attrs:{title:e.editOrAddTitle,visible:e.addDialogFormVisible,"before-close":e.closeDialog,width:"90%"},on:{"update:visible":function(t){e.addDialogFormVisible=t}}},[s("el-row",{staticClass:"entry",attrs:{gutter:20}},[s("el-col",{attrs:{span:e.isNewAdjustForm?8:12}},[s("span",{staticClass:"selectTitle"},[e._v("分录类别:")]),e._v(" "),s("el-cascader",{ref:"cascader",attrs:{clearable:"",options:e.entryCategory},on:{change:e.selectedOffsetObject},model:{value:e.selectOffsetObject,callback:function(t){e.selectOffsetObject=t},expression:"selectOffsetObject"}})],1),e._v(" "),s("el-col",{attrs:{span:e.isNewAdjustForm?8:12}},[s("span",{staticClass:"selectTitle"},[e._v("年份:")]),e._v(" "),s("el-select",{attrs:{filterable:"",clearable:"",placeholder:"请选择年份"},on:{change:e.selectedYear},model:{value:e.yyyy,callback:function(t){e.yyyy=t},expression:"yyyy"}},e._l(e.yearList,function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1),e._v(" "),s("vxe-grid",{ref:"addItemTable",attrs:{border:"",height:"385",data:e.addItemTableData,"edit-config":{trigger:"click",mode:"cell"},"row-key":!0,"row-id":"stdAcctCode","keep-source":"","show-footer":"","footer-span-method":e.footerColspanMethod,"footer-method":e.footerMethod,"header-align":"center"},on:{"cell-click":e.handleCellClick,"edit-actived":e.editActivedEvent,"edit-closed":e.editClosedEvent}},[s("vxe-table-column",{staticClass:"oEbtnList",attrs:{width:"30"}},[s("vxe-button",{staticClass:"addBtn",attrs:{icon:"vxe-icon--circle-plus"},on:{click:function(t){return e.insertEvent()}}}),e._v(" "),s("vxe-button",{staticClass:"delBtn",attrs:{icon:"vxe-icon--remove"},on:{click:e.removeEvent}})],1),e._v(" "),s("vxe-table-column",{attrs:{field:"digest",title:"摘要","edit-render":{name:"input",autoselect:!0}}}),e._v(" "),s("vxe-table-column",{attrs:{field:"projectId",title:"项目"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[s("el-select",{attrs:{clearable:"",disabled:e.isEdit,filterable:""},model:{value:a.projectId,callback:function(t){e.$set(a,"projectId",t)},expression:"row.projectId"}},e._l(e.projectList,function(e){return s("el-option",{key:e.value,attrs:{value:e.value,label:e.showLabel}})}),1)]}}])}),e._v(" "),s("vxe-table-column",{attrs:{field:"tbSubjectCodeName",title:"科目名称"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row,r=t.rowIndex;return[s("el-select",{attrs:{clearable:"",disabled:e.isEdit,filterable:""},on:{change:function(t){return e.changeTbSubjectName(a,r)},clear:function(t){return e.clearTbSubjectName(a,r)}},model:{value:a.tbSubjectCodeName,callback:function(t){e.$set(a,"tbSubjectCodeName",t)},expression:"row.tbSubjectCodeName"}},e._l(e.subjectNameList,function(e){return s("el-option",{key:e.value,attrs:{value:e.value,label:e.showLabel}})}),1)]}}])}),e._v(" "),s("vxe-table-column",{attrs:{title:"二级科目",field:"secondSubject","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[s("el-autocomplete",{staticStyle:{width:"100%",padding:"0 15px 0 0"},attrs:{disabled:e.isEdit||a.dis,clearable:"",filterable:"","fetch-suggestions":function(t,s){e.querySearch(t,s,a)},placeholder:"请输入内容"},on:{select:e.handleSelect,clear:function(t){return e.clearSecondSubject(a)}},model:{value:a.secondSubject,callback:function(t){e.$set(a,"secondSubject",t)},expression:"row.secondSubject"}}),e._v(" "),s("i",{staticClass:"el-icon-view check-note-viewIcon",attrs:{title:"预览附注"},on:{click:function(t){return e.checkNote(a)}}})]}}])}),e._v(" "),s("vxe-table-column",{attrs:{field:"otherDescription",title:"描述","edit-render":{name:"input",autoselect:!0}}}),e._v(" "),s("vxe-table-column",{attrs:{title:"借方金额",field:"deb","edit-render":{name:"input",autoselect:!0,immediate:!0,attrs:{disabled:e.debDisabled},events:{input:e.updateFooterEvent}},formatter:e.formatFixedNumber,align:e.allAlign,"header-align":"center"}}),e._v(" "),s("vxe-table-column",{attrs:{title:"贷方金额",field:"cre","edit-render":{name:"input",autoselect:!0,immediate:!0,attrs:{disabled:e.creDisabled},events:{input:e.updateFooterEvent}},formatter:e.formatFixedNumber,align:e.allAlign,"header-align":"center"}})],1),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:0!=e.subtract,expression:"subtract != 0"}],staticClass:"balance",staticStyle:{"text-align":"right",color:"red","padding-right":"20px"}},[e._v("\n                差 额:"+e._s(e.subtract)+"\n            ")]),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{type:"info",size:"small"},on:{click:e.closeDialog}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.submitAddDialogForm(!1)}}},[e._v("保存且继续添加分录")]),e._v(" "),s("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.submitAddDialogForm(!0)}}},[e._v("保存后关闭")])],1)],1),e._v(" "),s("el-dialog",{attrs:{title:e.editTitle,visible:e.editDialogFormVisible,"before-close":e.closeEditDialog,width:"90%"},on:{"update:visible":function(t){e.editDialogFormVisible=t}}},[s("vxe-grid",{ref:"editItemTable",attrs:{border:"",height:"385",data:e.editItemTableData,"edit-config":{trigger:"click",mode:"cell"},"row-key":!0,"row-id":"stdAcctCode","keep-source":"","show-footer":"","footer-span-method":e.footerColspanMethod,"footer-method":e.footerMethod,"header-align":"center"},on:{"cell-click":e.handleEditCellClick,"edit-actived":e.editActivedEvent,"edit-closed":e.editClosedEvent}},[s("vxe-table-column",{attrs:{field:"digest",title:"摘要","edit-render":{name:"input",autoselect:!0}}}),e._v(" "),s("vxe-table-column",{attrs:{field:"projectId",title:"项目"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[s("el-input",{attrs:{disabled:""},model:{value:a.showProject,callback:function(t){e.$set(a,"showProject",t)},expression:"row.showProject"}})]}}])}),e._v(" "),s("vxe-table-column",{attrs:{field:"showLabel",title:"科目名称"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[s("el-input",{attrs:{disabled:""},model:{value:a.showLabel,callback:function(t){e.$set(a,"showLabel",t)},expression:"row.showLabel"}})]}}])}),e._v(" "),s("vxe-table-column",{attrs:{title:"二级科目",field:"secondSubject","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[s("el-input",{attrs:{disabled:""},model:{value:a.secondSubject,callback:function(t){e.$set(a,"secondSubject",t)},expression:"row.secondSubject"}})]}}])}),e._v(" "),s("vxe-table-column",{attrs:{title:"描述",field:"otherDescription","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[s("el-input",{attrs:{disabled:""},model:{value:a.otherDescription,callback:function(t){e.$set(a,"otherDescription",t)},expression:"row.otherDescription"}})]}}])}),e._v(" "),s("vxe-table-column",{attrs:{title:"借方金额",field:"deb","edit-render":{name:"input",autoselect:!0,attrs:{disabled:e.debDisabled}},formatter:e.formatFixedNumber,align:e.allAlign,"header-align":"center"}}),e._v(" "),s("vxe-table-column",{attrs:{title:"贷方金额",field:"cre","edit-render":{name:"input",autoselect:!0,attrs:{disabled:e.creDisabled}},formatter:e.formatFixedNumber,align:e.allAlign,"header-align":"center"}})],1),e._v(" "),0!=e.subtract?s("div",{staticClass:"balance",staticStyle:{"text-align":"right",color:"red","padding-right":"20px"}},[e._v("\n                差 额:"+e._s(e.subtract)+"\n            ")]):e._e(),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{type:"info",size:"small"},on:{click:e.closeEditDialog}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.submitEditDialogForm("addForm")}}},[e._v("保存后关闭")])],1)],1),e._v(" "),s("el-dialog",{attrs:{title:"选择模板",visible:e.modelsDialogVisible,"destroy-on-close":!0,width:"80%"},on:{"update:visible":function(t){e.modelsDialogVisible=t}}},[s("el-tree",{ref:"tree",attrs:{data:e.templateData,"show-checkbox":"","default-expand-all":"","node-key":"label","highlight-current":"",props:e.defaultPropsT},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.node,r=t.data;return s("span",{staticClass:"custom-tree-node"},[s("span",[e._v(e._s(a.label))]),e._v(" "),r.secondSubject?s("span",{staticClass:"second_subject"},[e._v("\n                        "+e._s("("+r.secondSubject+")")+"\n                    ")]):e._e()])}}])}),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.selectedAll}},[e._v("全 选")]),e._v(" "),s("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.resetChecked}},[e._v("清 空")]),e._v(" "),s("el-button",{attrs:{type:"info",size:"small"},on:{click:function(t){e.modelsDialogVisible=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.saveEditItem()}}},[e._v("保 存")])],1)],1),e._v(" "),s("auto-generation-offset",{ref:"autoGenerationOffsetTable",attrs:{roleList:e.roleList},on:{refreshAutoOffsetTable:e.refreshAutoOffsetTable}}),e._v(" "),s("el-dialog",{attrs:{title:"查看校验项  (校验公式：资产类往来合计=负债类往来合计)",visible:e.checkVisible,width:"70%"},on:{"update:visible":function(t){e.checkVisible=t}}},[[s("el-table",{staticClass:"checkTable",attrs:{data:e.checkItemTableData,"row-style":e.rowStyle,"cell-style":e.hasValue,"show-overflow-tooltip":!0,border:""}},e._l(e.checkItemColumn,function(e,t){return s("el-table-column",{key:t,attrs:{prop:e.prop,label:e.label}})}),1)]],2),e._v(" "),s("el-dialog",{staticClass:"internalTransaction",attrs:{width:"80%",title:"内部交易汇总",visible:e.transactionDialogVisible,"before-close":e.handleTransactionDialogClose},on:{"update:visible":function(t){e.transactionDialogVisible=t}}},[s("transaction-summary",{ref:"transactionSummary"})],1),e._v(" "),s("el-dialog",{attrs:{title:"校验表(校验项=（A账面对B的资产合计-负债合计）+（B账面对A的资产合计-负债合计）)",visible:e.checkListTableShow,"before-close":e.closeCheckListShow,width:"90%","close-on-click-modal":!1},on:{"update:visible":function(t){e.checkListTableShow=t}}},[s("checkListTable",{ref:"checkListTable",attrs:{type:e.showBtnType},on:{closeShowInside:e.closeCheckListShow}}),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{type:"info",size:"small"},on:{click:e.closeCheckListShow}},[e._v("关 闭")])],1)],1),e._v(" "),s("el-dialog",{attrs:{title:"生成内部交易抵销",visible:e.InternalFixedOffsetIsShow,"before-close":e.closeInternalFixedOffsetShow,width:"75%","close-on-click-modal":!1},on:{"update:visible":function(t){e.InternalFixedOffsetIsShow=t}}},[e.InternalFixedOffsetIsShow?s("internalFixedOffsetTable",{ref:"internalFixedOffsetTable",attrs:{type:e.showBtnType},on:{loadingFalse:e.loadingFalse,closeShowInside:e.closeInternalFixedOffsetShow}}):e._e(),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{type:"info",size:"small"},on:{click:e.closeInternalFixedOffsetShow}},[e._v("关 闭")]),e._v(" "),s("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.internalFixedOffsetTableSave()}}},[e._v("保存后关闭")])],1)],1),e._v(" "),s("el-dialog",{attrs:{title:"现金流量表自动抵销汇总",visible:e.dialogVisible,width:"80%","before-close":e.handleClose},on:{"update:visible":function(t){e.dialogVisible=t}}},[s("BdoTable",{attrs:{columns:e.mergeCashFlowSummaryColumn,data:e.mergeCashFlowSummaryData,"enable-filter":!1,"enable-toolbox":!1,"enable-view-type":!1,showCheckBox:!1,showIndexColumn:!1,responsiveHeightGap:180,exportReport:!1,setBorder:!0,queryConfig:e.queryOffsetSummaryConfig}})],1),e._v(" "),s("el-dialog",{attrs:{title:"成本法抵销",visible:e.costOffsettingIsShow,"before-close":e.closeCostOffsetting,width:"75%","destroy-on-close":"","close-on-click-modal":!1},on:{"update:visible":function(t){e.costOffsettingIsShow=t}}},[s("CostOffsetting",{ref:"costOffsettingModal",attrs:{type:e.showBtnType,childRow:e.childRow,childObj:e.childObj},on:{costOffsetFalse:e.costOffsetFalse,closeShowInside:e.closeCostOffsetting}}),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{type:"info",size:"small"},on:{click:e.closeCostOffsetting}},[e._v("关 闭")]),e._v(" "),s("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.costOffsettingShow()}}},[e._v("保存后关闭")])],1)],1),e._v(" "),s("cost-offset",{ref:"costOffset",attrs:{roleList:e.roleList},on:{send:e.receiveEvent,chooseObj:e.chooseObj,refreshAutoOffsetTable:e.refreshAutoOffsetTable}})],1)])},staticRenderFns:[]};var ee=a("VU/8")(Z,Q,!1,function(e){a("qnMx"),a("NqmM")},"data-v-4fa0420f",null);t.default=ee.exports}});